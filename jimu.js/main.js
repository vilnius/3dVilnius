// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){function w(b,c){var e=a.clone(b),d=l.widgetProperties;"undefined"===typeof c&&(c=!1);delete e.mode;l.visitElement(e,function(b,a){b.widgets?(delete b.isOnScreen,
delete b.gid,"jimu.js/images/group_icon.png"===b.icon&&delete b.icon,delete b.openType,a.isOnScreen&&b.panel&&l.isEqual(b.panel,e.widgetOnScreen.panel)&&delete b.panel):(b.icon&&b.icon===b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete b.icon,delete b.panel,delete b.folderUrl,delete b.amdFolder,delete b.thumbnail,delete b.configFile,delete b.gid,delete b.isOnScreen,d.forEach(function(c){delete b[c]}),c?("undefined"===typeof b.openAtStart&&(b.openAtStart=!1),b.config||delete b.config):
(b.visible&&delete b.visible,b.manifest&&b.label===b.manifest.label&&delete b.label,b.isDefaultConfig&&(delete b.config,delete b.isDefaultConfig)),delete b.manifest)});delete e.rawAppConfig;delete e._ssl;delete e.getConfigElementById;delete e.getConfigElementsByName;delete e.getConfigElementByLabel;delete e.processNoUriWidgets;delete e.addElementId;delete e.getCleanConfig;delete e.visitElement;delete e.agolConfig;delete e._itemData;delete e.oldWabVersion;return e}var u=null,v;v=n(null,{urlParams:null,
appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(e){this.urlParams=e||{};this.listenBuilderEvents();this.versionManager=new c;this.widgetManager=f.getInstance();this.configLoader=b.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&a.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(h);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&
a.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(h);g(window,"resize",a.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){h.subscribe("builder/widgetChanged",a.hitch(this,this._onWidgetChanged));h.subscribe("builder/groupChanged",a.hitch(this,this._onGroupChanged));h.subscribe("builder/widgetPoolChanged",a.hitch(this,this._onWidgetPoolChanged));h.subscribe("builder/openAtStartChange",a.hitch(this,this._onOpenAtStartChanged));h.subscribe("builder/onScreenOrderChanged",
a.hitch(this,this._onScreenOrderChanged));h.subscribe("builder/layoutDefinitionChanged",a.hitch(this,this._onLayoutDefinitionChanged));h.subscribe("builder/sceneViewChanged",a.hitch(this,this._onSceneViewChanged));h.subscribe("builder/mapOptionsChanged",a.hitch(this,this._onMapOptionsChanged));h.subscribe("builder/appAttributeChanged",a.hitch(this,this._onAppAttributeChanged));h.subscribe("builder/setAppConfig",a.hitch(this,this._onAppConfigSet));h.subscribe("builder/themeChanged",a.hitch(this,this._onThemeChanged));
h.subscribe("builder/layoutChanged",a.hitch(this,this._onLayoutChanged));h.subscribe("builder/styleChanged",a.hitch(this,this._onStyleChanged));h.subscribe("builder/syncExtent",a.hitch(this,this._onSyncExtent));h.subscribe("builder/loadingPageChanged",a.hitch(this,this._onLoadingPageChanged));h.subscribe("builder/templateConfigChanged",a.hitch(this,this._onTemplateConfigChanged));h.subscribe("builder/sharedThemeChanged",a.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==
this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(a.hitch(this,function(b){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(b);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");b=this.getAppConfig();h.publish("appConfigLoaded",b);return b}),a.hitch(this,function(b){console.error(b);b&&b.message&&"string"===typeof b.message&&this._showErrorMessage(b.message)}))},_showErrorMessage:function(b){k.create("div",
{"class":"app-error",innerHTML:l.sanitizeHTML("Unable to create map: "+b)},document.body)},getAppConfig:function(){var b;window.appInfo.isRunInMobile?(b=a.clone(this._getMobileConfig(this.appConfig)),b._originConfig=a.clone(this.appConfig)):b=a.clone(this.appConfig);b.getConfigElementById=function(b){return l.getConfigElementById(this,b)};b.getConfigElementByLabel=function(b){return l.getConfigElementByLabel(this,b)};b.getConfigElementsByName=function(b){return l.getConfigElementsByName(this,b)};
b.getCleanConfig=function(b){return this._originConfig?w(this._originConfig,b):w(this,b)};b.visitElement=function(b){l.visitElement(this,b)};return b},_onWindowResize:function(){var b=this._isRunInMobile();window.appInfo.isRunInMobile!==b&&(window.appInfo.isRunInMobile=b,this.appConfig&&h.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var b=k.getMarginBox(window.jimuConfig.layoutId);if(b.w<=window.jimuConfig.breakPoints[0]||b.h<=window.jimuConfig.breakPoints[0])return k.addClass(window.jimuConfig.layoutId,
"jimu-ismobile"),!0;k.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(b){return l.mixinAppConfigPosition(b,b.mobileLayout)},_onWidgetChanged:function(b){var c=l.reCreateObject(b);b=l.getConfigElementById(this.appConfig,b.id);!1!==c.inPanel||b.uri||(c.closeable=!0);for(var a in c)b[a]=c[a];delete b.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"widgetChange",
c)},_onGroupChanged:function(b){var c=l.reCreateObject(b);b=l.getConfigElementById(this.appConfig,b.id);for(var a in c)b[a]=c[a];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"groupChange",c)},_onWidgetPoolChanged:function(b){b=l.reCreateObject(b);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=b.widgets,this.appConfig.widgetPool.groups=b.groups;else{var c=l.getConfigElementById(this.appConfig,
b.controllerId);m.forEach(c.controlledWidgets,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,b)},this);m.forEach(c.controlledGroups,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,b)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?b.widgets:this.appConfig.widgetPool.widgets.concat(b.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?b.groups:this.appConfig.widgetPool.groups.concat(b.groups);
this.configLoader.addNeedValues(this.appConfig);c.controlledWidgets=m.map(b.widgets,function(b){return b.id});c.controlledGroups=m.map(b.groups,function(b){return b.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",b)},_removeWidgetOrGroupFromPoolById:function(b,c){m.some(b.widgetPool.widgets,function(a,e){if(a.id===c)return b.widgetPool.widgets.splice(e,1),!0});m.some(b.widgetPool.groups,
function(a,e){if(a.id===c)return b.widgetPool.groups.splice(e,1),!0})},_onOpenAtStartChanged:function(b){var c=l.reCreateObject(b),e=this.appConfig;b.isOnScreen?(e=e.widgetOnScreen&&e.widgetOnScreen.widgets)&&0<e.length&&m.forEach(e,a.hitch(this,function(c){c.id===b.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})):((e=e.widgetPool)&&e.groups&&0<e.groups.length&&m.forEach(e.groups,a.hitch(this,function(c){c.id===b.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})),e&&e.widgets&&0<e.widgets.length&&
m.forEach(e.widgets,a.hitch(this,function(c){c.id===b.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})));h.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",c)},_onScreenOrderChanged:function(b){var c=l.reCreateObject(b);m.forEach(this.appConfig.widgetOnScreen.widgets,function(b){b.isController||(!1!==b.inPanel||!0!==b.closeable)&&!0!==b.inPanel&&b.uri||m.some(c,function(c){if(b.id===c.id)return b.position=c.position,!0})},this);h.publish("appConfigChanged",this.getAppConfig(),
"onScreenOrderChange",c)},_onAppAttributeChanged:function(b){b=l.reCreateObject(b);a.mixin(this.appConfig,b);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"attributeChange",b)},_onLoadingPageChanged:function(b){b=l.reCreateObject(b);var c;"backgroundColor"in b?this.appConfig.loadingPage.backgroundColor=b.backgroundColor:"backgroundImage"in b?(c=this.appConfig.loadingPage.backgroundImage||
{},this.appConfig.loadingPage.backgroundImage=a.mixin(c,b.backgroundImage)):"loadingGif"in b&&(c=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=a.mixin(c,b.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",b)},_onTemplateConfigChanged:function(b){b=l.reCreateObject(b);this.appConfig.templateConfig=b;this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",b)},_onLayoutDefinitionChanged:function(b){b=l.reCreateObject(b);l.isEqual(this.appConfig.layoutDefinition,b.layoutDefinition)||(this.appConfig.layoutDefinition=b.layoutDefinition,this.appConfig.widgetOnScreen.groups=l.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,b.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),
h.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",b.layoutDefinition))},_onSceneViewChanged:function(b){b=l.reCreateObject(b);b.itemId&&b.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&l.deleteMapOptions(this.appConfig.map.mapOptions);a.mixin(this.appConfig.map,b);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"mapChange",b)},_onMapOptionsChanged:function(b){b=l.reCreateObject(b);
this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});a.mixin(this.appConfig.map.mapOptions,b);h.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",b)},_onThemeChanged:function(b){this._getAppConfigFromTheme(b).then(a.hitch(this,function(c){this.appConfig=c;h.publish("appConfigChanged",this.getAppConfig(),"themeChange",b.getName())}))},_onLayoutChanged:function(b){this.appConfig=l.mixinAppConfigPosition(this.appConfig,b.layoutConfig);this.appConfig.layoutDefinition=b.layoutConfig.layoutDefinition;
this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);this._addDefaultPanelAndPosition(this.appConfig);h.publish("appConfigChanged",this.getAppConfig(),"layoutChange",b.name)},_onStyleChanged:function(b){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,b.name);b.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:b.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme=
{isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});h.publish("appConfigChanged",this.getAppConfig(),"styleChange",b.name)},_onSharedThemeChanged:function(b){var c=this.appConfig.theme.sharedTheme;b=l.reCreateObject(b);b.useHeader&&!c.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=
this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!b.useHeader&&c.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));b.useLogo&&!c.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:
"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!b.useLogo&&c.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});a.mixin(c,b);h.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",b)},_onSyncExtent:function(b){h.publish("syncExtent",b)},_genStyles:function(b,c){var a=[];a.push(c);
m.forEach(b,function(b){0>a.indexOf(b)&&a.push(b)});return a},_getAppConfigFromTheme:function(b){var c=new d,e,f=[],p=this.getAppConfig().getCleanConfig();p.mode=this.urlParams.mode;m.forEach(p.widgetPool.groups,function(b){delete b.panel},this);if(b.appConfig)e=a.clone(b.appConfig),e.map=p.map,e.map.position=b.appConfig.map.position,this._copyPoolToThemePool(p,e),e.links=p.links,e.title=p.title,e.subtitle=p.subtitle,e.logo=p.logo;else{var q=b.getCurrentLayout(),f=b.getCurrentStyle();e=a.clone(p);
q=a.clone(q.layoutConfig);e.widgetOnScreen=q.widgetOnScreen;q.widgetPool&&(m.forEach(q.widgetPool.widgets,function(b){b.isPreconfiguredInTheme=!0}),m.forEach(q.widgetPool.groups,function(b){b.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(p,q);e.widgetPool=q.widgetPool;q.map&&q.map.position&&(e.map.position=q.map.position);e.mobileLayout=q.mobileLayout;e.layoutDefinition=q.layoutDefinition;f=this._genStyles(m.map(b.getStyles(),function(b){return b.name}),f.name);e.theme={name:b.getName(),
styles:f,version:b.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(e.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},e.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(e.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},e.theme.customStyles={mainBackgroundColor:""});e.titleColor=p.titleColor;e.logoLink=p.logoLink}this.configLoader.addNeedValues(e);this.configLoader.loadWidgetsManifest(e).then(a.hitch(this,
function(){this._addDefaultValues(e);c.resolve(e)}));return c},_copyPoolToThemePool:function(b,c){var a=b.widgetPool;c.widgetPool||(c.widgetPool={});b=c.widgetPool;var e=m.filter(b.widgets,function(b){if(b.isPreconfiguredInTheme||!m.some(a.widgets,function(c){return c.name===b.name}))return!0}),d=m.filter(b.groups,function(b){return b.isPreconfiguredInTheme}),f=m.filter(a.widgets,function(b){return!b.isPreconfiguredInTheme}),p=m.filter(a.groups,function(b){return!b.isPreconfiguredInTheme}),f=this._getPoolWidgetsWithoutDuplicated(f,
c.widgetOnScreen.widgets||[]);b.widgets=f.concat(e);b.groups=p.concat(d)},_getPoolWidgetsWithoutDuplicated:function(b,c){for(var e=a.clone(b),d=this.getAppConfig(),f=b.length-1;0<=f;f--)for(var p=c.length-1;0<=p;p--)if(c[p].uri){var q=c[p].name;q||(q=l.getWidgetNameFromUri(c[p].uri));var g=d.getConfigElementById(b[f].id);b[f]&&b[f].name===q&&!1===g.supportMultiInstance&&(console.log("Widget",b[f].name,"is not copied to new theme because this widget exists in new theme."),e.splice(f,1))}return e},
_onAppConfigSet:function(b){b=l.reCreateObject(b);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(b);this.configLoader.addNeedValues(b);this._addDefaultValues(b);e.setPortalUrl(b.portalUrl);this.appConfig?(b.map.itemId&&b.map.itemId!==this.appConfig.map.itemId&&l.deleteMapOptions(b.map.mapOptions),this.appConfig=b,h.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,p.getPortal(b.portalUrl).loadSelfInfo().then(a.hitch(this,function(b){this.portalSelf=
b;h.publish("appConfigLoaded",this.getAppConfig())})))},_addDefaultValues:function(b){this._addDefaultPortalUrl(b);this._addDefaultGeometryService(b);this._addDefaultStyle(b);this._addDefaultMap(b);this._addDefaultVisible(b);this._addDefaultSharedTheme(b);"undefined"===typeof b.widgetOnScreen&&(b.widgetOnScreen={});"undefined"===typeof b.widgetPool&&(b.widgetPool={});this._addDefaultPanelAndPosition(b);this._addDefaultOfWidgetGroup(b);(b.widgetPool.widgets&&0<b.widgetPool.widgets.length&&void 0===
b.widgetPool.widgets[0].index||b.widgetPool.groups&&0<b.widgetPool.groups.length&&void 0===b.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(b);return b},_addDefaultPortalUrl:function(b){"undefined"===typeof b.portalUrl&&(b.portalUrl="http://www.arcgis.com/");b.portalUrl&&"/"!==b.portalUrl.substr(b.portalUrl.length-1)&&(b.portalUrl+="/")},_addDefaultGeometryService:function(b){var c=b&&b.geometryService,c=c&&"string"===typeof c&&a.trim(c)?a.trim(c):this.portalSelf.helperServices.geometry.url;
b.geometryService=c;q.geometryService=new r(b.geometryService);l.setGlobalGeometryService(b.geometryService)},_addDefaultStyle:function(b){!b.theme||b.theme.styles&&0!==b.theme.styles.length||(b.theme.styles=["default"])},_addDefaultMap:function(b){b.map.id="map";"undefined"===typeof b.map["3D"]&&"undefined"===typeof b.map["2D"]&&(b.map["2D"]=!0);"undefined"===typeof b.map.position&&(b.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof b.map.portalUrl&&(b.map.portalUrl=b.portalUrl)},
_addDefaultVisible:function(b){l.visitElement(b,function(b){void 0===b.visible&&(b.visible=!0)})},_addDefaultSharedTheme:function(b){b.theme.sharedTheme?("undefined"===typeof b.theme.sharedTheme.useHeader&&(b.theme.sharedTheme.useHeader=!1),"undefined"===typeof b.theme.sharedTheme.useLogo&&(b.theme.sharedTheme.useLogo=!1)):b.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(b){this._addOnScreenDefaultPanelAndPosition(b);this._addPoolDefaultPanelAndPosition(b)},_addOnScreenDefaultPanelAndPosition:function(b){var c,
e;if(b=b.widgetOnScreen){c=b.panel&&b.panel.positionRelativeTo?b.panel.positionRelativeTo:"map";"undefined"===typeof b.panel||"undefined"===typeof b.panel.uri?b.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:c}}:"undefined"===typeof b.panel.position?b.panel.position={relativeTo:c}:"undefined"===typeof b.panel.position.relativeTo&&(b.panel.position.relativeTo=c);if(b.widgets)for(c=0;c<b.widgets.length;c++)b.widgets[c].position||(b.widgets[c].position={}),b.widgets[c].position.relativeTo||
(b.widgets[c].position.relativeTo=b.widgets[c]&&b.widgets[c].positionRelativeTo?b.widgets[c].positionRelativeTo:"map"),!0!==b.widgets[c].inPanel||b.widgets[c].panel||(b.widgets[c].panel=a.clone(b.panel),b.widgets[c].panel.position=b.widgets[c].position,b.widgets[c].panel.position.relativeTo=b.widgets[c].position.relativeTo);if(b.groups)for(c=0;c<b.groups.length;c++)for(b.groups[c].panel||(b.groups[c].panel=b.panel),b.groups[c].panel&&!b.groups[c].panel.position&&(b.groups[c].panel.position={}),b.groups[c].panel.position.relativeTo||
(b.groups[c].panel.position.relativeTo=b.groups[c].panel.positionRelativeTo?b.groups[c].panel.positionRelativeTo:"map"),b.groups[c].widgets||(b.groups[c].widgets=[]),e=0;e<b.groups[c].widgets.length;e++)b.groups[c].widgets[e].panel=b.groups[c].panel}},_addPoolDefaultPanelAndPosition:function(b){var c,a,e=b.widgetPool;if(e){c=e.panel&&e.panel.positionRelativeTo?e.panel.positionRelativeTo:"map";"undefined"===typeof e.panel||"undefined"===typeof e.panel.uri?e.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:c}}:
"undefined"===typeof e.panel.position?e.panel.position={relativeTo:c}:"undefined"===typeof e.panel.position.relativeTo&&(e.panel.position.relativeTo=c);if(e.groups)for(c=0;c<e.groups.length;c++)for(e.groups[c].panel?e.groups[c].panel.position.relativeTo||(e.groups[c].panel.position.relativeTo=e.groups[c].panel.positionRelativeTo?e.groups[c].panel.positionRelativeTo:"map"):e.groups[c].panel=e.panel,e.groups[c].widgets||(e.groups[c].widgets=[]),a=0;a<e.groups[c].widgets.length;a++)e.groups[c].widgets[a].panel=
e.groups[c].panel;if(e.widgets)for(c=0;c<e.widgets.length;c++)!1===e.widgets[c].inPanel?(a=e.widgets[c].positionRelativeTo?e.widgets[c].positionRelativeTo:"map",e.widgets[c].position)?e.widgets[c].position.relativeTo||(e.widgets[c].position.relativeTo=a):e.widgets[c].position={relativeTo:a}:e.widgets[c].panel||(e.widgets[c].panel=b.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(b){l.visitElement(b,a.hitch(this,function(b,c){b.isOnScreen=c.isOnScreen;b.widgets?(b.gid=b.id,1===b.widgets.length?
(b.label||(b.label=b.widgets[0].label?b.widgets[0].label:"Group"),b.icon||(b.icon=b.widgets[0].uri?this._getDefaultIconFromUri(b.widgets[0].uri):"jimu.js/images/group_icon.png")):(b.icon=b.icon?b.icon:"jimu.js/images/group_icon.png",b.label=b.label?b.label:"Group_"+c.index)):(b.gid=c.groupId,b.uri&&l.processWidgetSetting(b))}))},_getDefaultIconFromUri:function(b){b=b.split("/");b.pop();return b.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(b){var c=0,e,a;if(b.widgetPool.widgets)for(e=
0;e<b.widgetPool.widgets.length;e++)b.widgetPool.widgets[e].index=c,c++;if(b.widgetPool.groups)for(e=0;e<b.widgetPool.groups.length;e++)for(b.widgetPool.groups[e].index=c,c++,a=0;a<b.widgetPool.groups[e].widgets.length;a++)b.widgetPool.groups[e].widgets[a].index=a}});v.getInstance=function(b){null===u?u=new v(b):b&&(u.urlParams=b);window.getAppConfig=a.hitch(u,u.getAppConfig);return u};return v})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),
function(n,a,m,k,h,d,g,l){n.byId=a.byId;n.isDescendant=a.isDescendant;n.setSelectable=a.setSelectable;n.getAttr=k.get;n.setAttr=k.set;n.hasAttr=k.has;n.removeAttr=k.remove;n.getNodeProp=k.getNodeProp;n.attr=function(a,c,b){return 2==arguments.length?k["string"==typeof c?"get":"set"](a,c):k.set(a,c,b)};n.hasClass=d.contains;n.addClass=d.add;n.removeClass=d.remove;n.toggleClass=d.toggle;n.replaceClass=d.replace;n._toDom=n.toDom=g.toDom;n.place=g.place;n.create=g.create;n.empty=function(a){g.empty(a)};
n._destroyElement=n.destroy=function(a){g.destroy(a)};n._getPadExtents=n.getPadExtents=l.getPadExtents;n._getBorderExtents=n.getBorderExtents=l.getBorderExtents;n._getPadBorderExtents=n.getPadBorderExtents=l.getPadBorderExtents;n._getMarginExtents=n.getMarginExtents=l.getMarginExtents;n._getMarginSize=n.getMarginSize=l.getMarginSize;n._getMarginBox=n.getMarginBox=l.getMarginBox;n.setMarginBox=l.setMarginBox;n._getContentBox=n.getContentBox=l.getContentBox;n.setContentSize=l.setContentSize;n._isBodyLtr=
n.isBodyLtr=l.isBodyLtr;n._docScroll=n.docScroll=l.docScroll;n._getIeDocumentElementOffset=n.getIeDocumentElementOffset=l.getIeDocumentElementOffset;n._fixIeBiDiScrollLeft=n.fixIeBiDiScrollLeft=l.fixIeBiDiScrollLeft;n.position=l.position;n.marginBox=function(a,c){return c?l.setMarginBox(a,c):l.getMarginBox(a)};n.contentBox=function(a,c){return c?l.setContentSize(a,c):l.getContentBox(a)};n.coords=function(d,c){n.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");d=a.byId(d);var b=
m.getComputedStyle(d),b=l.getMarginBox(d,b);d=l.position(d,c);b.x=d.x;b.y=d.y;return b};n.getProp=h.get;n.setProp=h.set;n.prop=function(a,c,b){return 2==arguments.length?h["string"==typeof c?"get":"set"](a,c):h.set(a,c,b)};n.getStyle=m.get;n.setStyle=m.set;n.getComputedStyle=m.getComputedStyle;n.__toPixelValue=n.toPixelValue=m.toPixelValue;n.style=function(a,c,b){switch(arguments.length){case 1:return m.get(a);case 2:return m["string"==typeof c?"get":"set"](a,c)}return m.set(a,c,b)};return n})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/tasks/GeometryService esri/tasks/support/ProjectParameters esri/core/urlUtils esri/request esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils ./shared/utils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M){function L(b,c){b=b||"";var e=0,a=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!Q.file.isEnabledFlash(),failure:[b+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){e++;e===a.length&&c()}}];for(b=0;b<a.length;b++)testLoad(a[b])}function R(b,c){var e=b.match(/url\([^)]+\)/gi),a,d;if(null===e||""===c)return b;for(a=0;a<e.length;a++)if(d=e[a].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=d.length){var f=
d[2];/^data:image\/.*;/.test(f)||(c.endWith("/")||(c+="/"),b=b.replace(d[1]+f+d[3],d[1]+c+f+d[3]))}return b}function O(b,c){var e=Array.isArray(c),a=e&&[]||{};e?(b=b||[],a=a.concat(b),c.forEach(function(c,e){"undefined"===typeof b[e]?a[e]=c:"object"===typeof c?a[e]=O(b[e],c):-1===b.indexOf(c)&&a.push(c)})):(b&&"object"===typeof b&&Object.keys(b).forEach(function(c){a[c]=b[c]}),Object.keys(c).forEach(function(e){a[e]="object"===typeof c[e]&&c[e]?b[e]?O(b[e],c[e]):c[e]:c[e]}));return a}function T(b){var c,
e={};c=b.indexOf("/");b.substring(0,c);c=b.substring(0,b.lastIndexOf("/")+1);e.folderUrl=require(Q.getRequireConfig()).toUrl(c);e.amdFolder=c;e.url=e.folderUrl;if(/^http(s)?:\/\//.test(b)||/^\/\//.test(b))e.isRemote=!0;return e}function U(b){b.panels.forEach(function(b){b.uri="panels/"+b.name+"/Panel.js"});b.styles.forEach(function(b){b.uri="styles/"+b.name+"/style.css"});b.layouts.forEach(function(b){b.uri="layouts/"+b.name+"/config.json";b.icon="layouts/"+b.name+"/icon.png";b.RTLIcon="layouts/"+
b.name+"/icon_rtl.png"})}function P(b,c){var e=b.map(function(b){return b.id});a.forEach(c,function(c){0>e.indexOf(c)&&b.push({id:c,widgets:[]})},this);var d=[];b=a.filter(b,function(b){return 0>c.indexOf(b.id)?(d.push(b),!1):!0},this);if(0===b.length)return[];var f=b[b.length-1];a.forEach(d,function(b){f.widgets=f.widgets.concat(b.widgets)},this);return b=b.sort(function(b,e){return c.indexOf(b.id)-c.indexOf(e.id)})}function V(b,c,e){function a(b,c){return n.isArray(b[c.key])?b[c.key][c.index]:b[c.key]}
c=function(b){var c=[];b.split("_").forEach(function(b){var e=!1,a;"--"===b.slice(b.length-2)&&(e=!0,b=b.slice(0,b.length-2));a=b.search(/\[[0-9]+\]/);-1===a&&(a=b.length);c.push({key:b.slice(0,a),index:Number(b.slice(a+1,-1)),deleteFlag:e})});return c}(c);for(var d=1;d<c.length-1;d++)if(b=a(b,c[d]),!b)return;if(c[c.length-1].deleteFlag)!0===e&&(n.isArray(b[c[c.length-1].key])?delete b[c[c.length-1].key][c[c.length-1].index]:delete b[c[c.length-1].key]);else if(n.isArray(b[c[c.length-1].key])){if(void 0===
e)return b[c[c.length-1].key][c[c.length-1].index];b[c[c.length-1].key][c[c.length-1].index]=e}else{if(void 0===e)return b[c[c.length-1].key];b[c[c.length-1].key]=e}}function W(b,c,e){function a(e){e=Q.template.getSearchRange(c,e,"]");var a=c.slice(e.firstPos,e.lastPos);return-1!==e.firstPos?(a=c.slice(e.firstPos+a.indexOf("[")+1,e.lastPos-1),e=c.slice(e.lastPos+1),(a=Q.getConfigElementById(b,a))?{object:a,key:"section_"+e,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var d=b,f=c=c.replace(/\//g,
"_"),p=a("groups\\[.+\\]");if("deleted"!==p.state&&("isSection"===p.state&&(d=p.object,f=p.key),p=a("widgets\\[.+\\]"),"delete"!==p.state))return"isSection"===p.state&&(d=p.object,f=p.key),V(d,f,e)}var Q={},Z={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};n.mixin(Q,M);window.atob||(window.atob=function(b){b=u.decode(b);for(var c="",e=0,a=b.length;e<a;e++)c+=String.fromCharCode(b[e]);return c});window.btob||(window.btob=function(b){for(var c=[],e=0,
a=b.length;e<a;e++)c.push(String.charCodeAt(b[e]));return u.encode(c)});var X="unload",aa=[];require.on("error",function(b){a.forEach(aa,function(c){b.info[0]&&-1<b.info[0].indexOf(c.resKey)&&c.def.reject(b);for(var e in b.info)-1<e.indexOf(c.resKey)&&c.def.reject(b)})});Q.checkError=function(b,c){aa.push({resKey:b,def:c})};Q.replacePlaceHolder=function(b,c){var a=e.stringify(b),d=a.match(/\$\{(\w)+\}/g);if(null===d)return b;for(b=0;b<d.length;b++){var f=d[b].match(/(\w)+/g)[0];c[f]&&(a=a.replace(d[b],
c[f]))}return e.parse(a)};Q.changeUnit=function(b){var c=Math.abs(b),e;b=Math.floor(c);e=Math.floor(60*(c-b));c=(60*(60*(c-b)-e)).toFixed(2);return b+"\u00b0"+(10>e?"0"+e:e)+"'"+(10>c?"0"+c:c)+'"'};Q.formatTime=function(b){var c=b/1E3;b=Math.floor(c/60);c=Number(c-60*b).toFixed(1);return(10>b?"0"+b:b)+":"+(10>c?"0"+c:c)};Q.parseTime=function(b){var c=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!c.test(b))return console.log("wrong time format."),-1;b=b.match(c);return 1E3*(60*parseInt(b[1],10)+parseInt(b[2],10)+
parseInt(b[3],10)/10)};Q.preloadImg=function(b,c){var e=[],e="string"===typeof b?[b]:b;a.forEach(e,function(b){(new Image).src=c?c+b:b})};Q.setWABLogoDefaultAlt=function(b){if(b){b=g("img",b);for(var c=["img_1412759111499","img_1545621838463","img_1560482577021"],e=0,a=b.length;e<a;e++){var d=b[e];-1<c.indexOf(m.getAttr(d,"id"))&&!m.getAttr(d,"alt")&&m.setAttr(d,"alt","Web AppBuilder for ArcGIS.png")}}};var da=null;Q.getImagesSize=function(c){var e=new f;if(!c||0!==c.indexOf("http"))return e.reject(),
e;null===da&&(da=m.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var a=b(da,"load",function(){clearTimeout(d);d=null;a.remove();var b=m.getContentBox(da);1===b.w&&1===b.h||0===b.w||0===b.h?e.reject():e.resolve([b.w,b.h])},{}),d=setTimeout(function(){clearTimeout(d);d=null;e.reject()},5E3);m.setAttr(da,"src",c);return e};Q.getPositionStyle=function(b){var c={};if(!b)return c;b=n.clone(b);if(window.isRTL){var e;"undefined"!==typeof b.left&&
"undefined"!==typeof b.right?(e=b.left,b.left=b.right,b.right=e):"undefined"!==typeof b.left?(b.right=b.left,delete b.left):"undefined"!==typeof b.right&&(b.left=b.right,delete b.right);"undefined"!==typeof b.paddingLeft&&"undefined"!==typeof b.paddingRight?(e=b.paddingLeft,b.paddingLeft=b.paddingRight,b.paddingRight=e):"undefined"!==typeof b.paddingLeft?(b.paddingRight=b.paddingLeft,delete b.paddingLeft):"undefined"!==typeof b.paddingRight&&(b.paddingLeft=b.paddingRight,delete b.paddingRight);"undefined"!==
typeof b.marginLeft&&"undefined"!==typeof b.marginRight?(e=b.marginLeft,b.marginLeft=b.marginRight,b.marginRight=e):"undefined"!==typeof b.marginLeft?(b.marginRight=b.marginLeft,delete b.marginLeft):"undefined"!==typeof b.marginRight&&(b.marginLeft=b.marginRight,delete b.marginRight)}e="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var a=0;a<e.length;a++){var d=e[a];"number"===typeof b[d]?
c[d]=b[d]+"px":"undefined"!==typeof b[d]?c[d]=b[d]:"padding"===d.substr(0,7)||"margin"===d.substr(0,7)?c[d]=0:c[d]="auto"}c.zIndex="undefined"===typeof b.zIndex?"auto":b.zIndex;return c};Q.isEqual=function(b,c){function e(b,c){var f;if(null===b&&null===c||"undefined"===typeof b&&"undefined"===typeof c)return!0;if(null===b&&null!==c||null===c&&null!==b||"undefined"===typeof b&&"undefined"!==typeof c||"undefined"===typeof c&&"undefined"!==typeof b)return!1;if(isNaN(b)&&isNaN(c)&&"number"===typeof b&&
"number"===typeof c||b===c)return!0;if("function"===typeof b&&"function"===typeof c||b instanceof Date&&c instanceof Date||b instanceof RegExp&&c instanceof RegExp||b instanceof String&&c instanceof String||b instanceof Number&&c instanceof Number)return b.toString()===c.toString();if(-1<a.indexOf(b)||-1<d.indexOf(c))return!1;if(null!==c){for(f in c)if(c.hasOwnProperty(f)!==b.hasOwnProperty(f)||typeof c[f]!==typeof b[f])return!1;for(f in b){if(c.hasOwnProperty(f)!==b.hasOwnProperty(f)||typeof c[f]!==
typeof b[f])return!1;switch(typeof b[f]){case "object":case "function":a.push(b);d.push(c);if(!e(b[f],c[f]))return!1;a.pop();d.pop();break;default:if(b[f]!==c[f])return!1}}}return!0}var a,d;a=[];d=[];return e(b,c)?!0:!1};Q.getUriInfo=T;Q.file={loadFileAPI:function(){var b=new f;if("unload"===X){var c=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:c+"libs/polyfills/fileAPI/",flashUrl:c+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:c+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};
L(c,n.hitch(this,function(){X="loaded";b.resolve()}));X="loading"}else"loaded"===X&&b.resolve();return b},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return k("safari")&&6>k("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var b=null;if(document.all)try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(ca){b=null}else navigator.plugins&&0<navigator.plugins.length&&(b=
navigator.plugins["Shockwave Flash"]);return!!b},containSeparator:function(b){return 0<=b.indexOf("/")?!0:0<=b.indexOf("\\")?!0:!1},getNameFromPath:function(b){var c="",c=0<=b.indexOf("/")?"/":"\\";b=b.split(c);return 0<b.length?b[b.length-1]:null},getFolderFromPath:function(b){return b.substr(0,b.length-Q.file.getNameFromPath(b).length)},readFile:function(b,c,e,a){if(this.supportHTML5()){var d=b.target.files[0];d&&(d.type.match(c)?d.size>=e?a({errCode:"exceed"}):(b=new FileReader,b.onload=function(b){a(null,
d.name,b.target.result)},b.readAsDataURL(d)):a({errCode:"invalidType"}))}else if(this.supportFileAPI()){var f=window.FileAPI.getFiles(b);f[0].type.match(c)?f[0].size>=e?a({errCode:"exceed"}):window.FileAPI.readAsDataURL(f[0],function(b){b&&b.result?a(null,f[0].name,b.result):a({errCode:"readError"})}):a({errCode:"invalidType"})}}};Q.processWidgetSetting=function(b){if(!b.uri)return b;n.mixin(b,T(b.uri));b.icon||(b.icon=b.amdFolder+"images/icon.png");b.thumbnail||(b.thumbnail=b.amdFolder+"images/thumbnail.png");
return b};Q.getRequireConfig=function(){if(jimuConfig){var b=[];jimuConfig.widgetsPackage&&(b=b.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(b=b.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(b=b.concat(jimuConfig.configsPackage));return{packages:b}}return{}};Q.getTypeByGeometryType=function(b){var c="",e="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),a=["esriGeometryRing",
"esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(b)?c="point":0<=e.indexOf(b)?c="polyline":0<=a.indexOf(b)&&(c="polygon");return c};Q.getSymbolTypeByGeometryType=function(b){var c=null;b=Q.getTypeByGeometryType(b);"point"===b?c="marker":"polyline"===b?c="line":"polygon"===b&&(c="fill");return c};Q.getServices=function(){return Z};Q.getArcGISDefaultGeometryService=function(){return new G(Z.geometryService)};Q.restoreToDefaultWebMapExtent=function(b,
c,e){var a=new f;if(!b||"esri.Map"!==b.declaredClass)return setTimeout(function(){a.reject("Invalid map.")},0),a;c=c&&c.itemInfo;if(!c)return setTimeout(function(){a.reject("Invalid itemInfo")},0),a;c=c.item&&c.item.extent;if(!c)return setTimeout(function(){a.reject("Invalid itemInfo.item.extent")}),a;var d=new t({wkid:4326}),d=new x(c[0][0],c[0][1],c[1][0],c[1][1],d);if(4326===parseInt(b.spatialReference.wkid,10))return b.setExtent(d);if(b.spatialReference.isWebMercator)return d=B.geographicToWebMercator(d),
b.setExtent(d);c=new F;c.geometries=[d];c.outSR=b.spatialReference;d=y&&y.defaults&&y.defaults.geometryService;d&&"esri.tasks.GeometryService"===d.declaredClass||(e&&"string"===typeof e&&n.trim(e)?(e=n.trim(e),d=new G(e)):d=Q.getArcGISDefaultGeometryService());d.project(c).then(function(c){if(c=c&&c[0])return b.setExtent(c);a.reject("Invalid projected geometry.");return a},function(b){console.error(b);a.reject(b);return a});return a};Q.getAncestorWindow=function(){for(var b=window;b&&b.parent&&b!==
b.parent;)b=b.parent;return b};Q.getAncestorDom=function(b,c,e){if(b&&1===b.nodeType&&c&&"function"===typeof c){var a=100,d=document.body;e&&("number"===typeof e?(e=parseInt(e,10),0<e&&(a=e)):1===e.nodeType&&(d=e));for(e=0;b.parentNode&&e<a&&m.isDescendant(b.parentNode,d);){if(c(b.parentNode))return b.parentNode;b=b.parentNode;e++}}return null};Q.bindClickAndDblclickEvents=function(c,e,a,d){var f=null;if(c&&1===c.nodeType&&e&&"function"===typeof e&&a&&"function"===typeof a){var p=200;d&&"number"===
typeof d&&(d=parseInt(d,10),0<d&&(p=d));var q=0,f=b(c,"click",function(b){q++;1===q?setTimeout(function(){1===q&&(q=0,e(b))},p):2===q&&(q=0,a(b))})}return f};Q.isScrollToBottom=function(b){var c=m.getContentBox(b);return 1>b.scrollHeight-(b.scrollTop+c.h)};Q.getAllItemTypes=function(){var b=[],b=b.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return b=b.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};Q.getItemQueryStringByTypes=function(b){var c="",e=Q.getAllItemTypes();if(b&&0<b.length&&0<b.length){var d="";a.forEach(b,function(c,e){d+=' type:"'+c+'" ';e!==b.length-1&&(d+=" OR ")});c=" ( "+d+" ) ";e=b.concat(e);e=a.filter(e,function(c){return a.every(b,
function(b){return 0>b.toLowerCase().indexOf(c.toLowerCase())})});a.forEach(e,function(b){c+=' -type:"'+b+'" '})}return c};Q.getItemQueryStringByTypeKeywords=function(b){var c="";b&&0<b.length&&(c=' typekeywords:"'+b.join(",")+'" ');return c};Q.isNotEmptyString=function(b,c){var e=b&&"string"===typeof b;return e?c?e&&n.trim(b):!0:!1};Q.isValidNumber=function(b){return"number"===typeof b&&!isNaN(b)};Q.isObject=function(b){return b&&"object"===typeof b};Q.getRandomString=function(){var b=Math.random().toString();
return b=b.slice(2,b.length)};Q._getDomainsByServerName=function(b){var c=b.split("."),e=c.length;return a.map(c,n.hitch(this,function(b,d){b=c.slice(d,e);var f="",p=b.length-1;a.forEach(b,n.hitch(this,function(b,c){f+=b;c!==p&&(f+=".")}));return f}))};Q.removeCookie=function(b,c){var e=this._getDomainsByServerName(window.location.hostname);a.forEach(e,n.hitch(this,function(e){p(b,null,{expires:-1,path:c});p(b,null,{expires:-1,path:c,domain:e});p(b,null,{expires:-1,path:c,domain:"."+e})}))};Q.isLocaleChanged=
function(b,c){return!b.startWith(c)};Q.hashToObject=function(b){b=b.replace("#","");b=d.queryToObject(b);for(var c in b)if(b.hasOwnProperty(c))try{b[c]=e.parse(b[c])}catch(ia){}return b};Q.reCreateObject=function(b){function c(b){var a=[];b.forEach(function(b){Array.isArray(b)?a.push(c(b)):"object"===typeof b?a.push(e(b)):a.push(b)});return a}function e(b){var a={},d;for(d in b)b.hasOwnProperty(d)&&(null===b[d]?a[d]=null:Array.isArray(b[d])?a[d]=c(b[d]):a[d]="object"===typeof b[d]?e(b[d]):b[d]);return a}
return Array.isArray(b)?c(b):e(b)};Q.setVerticalCenter=function(b){setTimeout(function(){var c=g(".jimu-vcenter-text",b),e,d;a.forEach(c,function(b){e=m.getContentBox(b).h;m.setStyle(b,{lineHeight:e+"px"})},this);c=g(".jimu-vcenter",b);a.forEach(c,function(b){e=m.getContentBox(b).h;d=m.getContentBox(g(b).parent()[0]).h;m.setStyle(b,{marginTop:(d-e)/2+"px"})},this)},10)};Q.merge=O;Q.loadStyleLink=function(c,e,d){var p=new f,q,l=require(Q.getRequireConfig()).toUrl(e);if(require.cache["url:"+l]){q=require.cache["url:"+
l];var g=l.split("/").pop(),l=l.substr(0,l.length-g.length);q=R(q,l);c=d?m.create("style",{id:c,type:"text/css"},m.byId(d),"before"):m.create("style",{id:c,type:"text/css"},document.getElementsByTagName("head")[0]);c.styleSheet&&!c.sheet?c.styleSheet.cssText=q:c.appendChild(m.toDom(q));p.resolve("load");return p}q=d?m.create("link",{id:c,rel:"stylesheet",type:"text/css",href:l},m.byId(d),"before"):m.create("link",{id:c,rel:"stylesheet",type:"text/css",href:l},document.getElementsByTagName("head")[0]);
b(q,"load",function(){p.resolve("load")});var u=setInterval(function(){var b;if(a.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(e),c.href.length)===e)return b=c,!0}))try{!p.isFulfilled()&&(b.cssRules&&b.cssRules.length||b.rules&&b.rules.length)&&p.resolve("load"),clearInterval(u)}catch(ja){}},50);return p};Q.changeLocation=function(b){window.history.pushState&&window.history.pushState({path:b},"",b)};Q.urlToObject=function(b){var c=null;-1===b.indexOf("#")?(c=K.urlToObject(b),
c.hash=null):(b=b.split("#"),c=K.urlToObject(b[0]),c.hash=b[1]?-1<b[1].indexOf("\x3d")?d.queryToObject(b[1]):b[1]:null);return c};Q.addManifestProperies=function(b){b.icon=b.url+"images/icon.png";"theme"===b.category?U(b):("undefined"!==typeof b["2D"]&&(b.support2D=b["2D"]),"undefined"!==typeof b["3D"]&&(b.support3D=b["3D"]),"undefined"===typeof b["2D"]&&"undefined"===typeof b["3D"]&&(b.support2D=!0),delete b["2D"],delete b["3D"],"undefined"===typeof b.properties&&(b.properties={}),M.processWidgetProperties(b))};
Q.getUniqueValues=function(b,c){var d=new f;b=b.replace(/\/*$/g,"")+"/generateRenderer";c=e.stringify({type:"uniqueValueDef",uniqueValueFields:[c]});H(b,{query:{classificationDef:c,f:"json"},responseType:"json",callbackParamName:"callback"}).then(n.hitch(this,function(b){var c=b.data;b=[];(c=c&&c.uniqueValueInfos)&&0<c.length&&(b=a.map(c,n.hitch(this,function(b){return b.value})));d.resolve(b)}),n.hitch(this,function(b){d.reject(b)}));return d};Q.combineRadioCheckBoxWithLabel=function(b,c){var e=
!1;if(b&&1===b.nodeType&&"input"===b.tagName.toLowerCase()){var a=b.getAttribute("type")||"",a=a.toLowerCase();if("radio"===a||"checkbox"===a)e=!0}a=!1;c&&1===c.nodeType&&"label"===c.tagName.toLowerCase()&&(a=!0);e&&a&&(e=b.getAttribute("id"),e||(e="input_"+Q.getRandomString(),b.setAttribute("id",e)),c.setAttribute("for",e),m.setStyle(c,"cursor","pointer"))};Q.convertExtentToPolygon=function(b){var c=b.xmin,e=b.xmax,a=b.ymin,d=b.ymax;return new E({rings:[[[c,d],[e,d],[e,a],[c,a],[c,d]]],spatialReference:b.toJson()})};
Q.combineGeometries=function(b){function c(b){var c={points:[],spatialReference:b[0].spatialReference.toJson()};a.forEach(b,function(b){c.points=c.points.concat(b.points)});return new z(c)}function e(b){var c={paths:[],spatialReference:b[0].spatialReference.toJson()};a.forEach(b,function(b){c.paths=c.paths.concat(b.paths)});return new A(c)}function d(b){var c={rings:[],spatialReference:b[0].spatialReference.toJson()};a.forEach(b,function(b){"polygon"===b.type?c.rings=c.rings.concat(b.rings):"extent"===
b.type&&(b=Q.convertExtentToPolygon(b),c.rings=c.rings.concat(b.rings))});return new E(c)}var f=null;if(b&&0<b.length)if(1===b.length)f=b[0];else{for(var p=null,q=null,l=null,g=null,u=0;u<b.length;u++){p=b[u];switch(p.type){case "point":case "multipoint":g="point";break;case "polyline":g="polyline";break;case "polygon":case "extent":g="polygon";break;default:return null}if(0===u)l=g;else if(l!==g)return null;if(u!==b.length-1&&(q=b[u+1],!p.spatialReference.equals(q.spatialReference)))return null}"point"===
g?f=c(b):"polyline"===g?f=e(b):"polygon"===g&&(f=d(b))}return f};Q.isFeaturelayerUrlSupportQuery=function(b,c){var e=!1,a=/\/featureserver\//gi.test(b);b=/\/mapserver\//gi.test(b);c=(c||"").toLowerCase();a?e=0<=c.indexOf("query"):b&&(e=0<=c.indexOf("data"));return e};Q.isImageServiceSupportQuery=function(b){return 0<=(b||"").toLowerCase().indexOf("catalog")};Q.isStringEndWith=function(b,c){return b.lastIndexOf(c)+c.length===b.length};Q.processManifestLabel=function(b,c){b.label=b.i18nLabels&&(b.i18nLabels[c]||
b.i18nLabels.defaultLabel)||b.label||b.name;b.layouts&&a.forEach(b.layouts,function(e){var a="i18nLabels_layout_"+e.name;e.label=b[a]&&(b[a][c]||b[a].defaultLabel)||e.label||e.name});b.styles&&a.forEach(b.styles,function(e){var a="i18nLabels_style_"+e.name;e.label=b[a]&&(b[a][c]||b[a].defaultLabel)||e.label||e.name})};Q.addManifest2WidgetJson=function(b,c){n.mixin(b,c.properties);b.name=c.name;b.label||(b.label=c.label);b.manifest=c};Q.widgetJson=function(){var b={addManifest2WidgetJson:function(b,
c){n.mixin(b,c.properties);b.name=c.name;b.label||(b.label=c.label);b.manifest=c;b.isRemote=c.isRemote;b.isRemote&&(b.itemId=c.itemId);c.featureActions&&(b.featureActions=c.featureActions);b.icon||(b.icon=c.icon);b.thumbnail||(b.thumbnail=c.thumbnail);b.folderUrl=c.folderUrl;b.amdFolder=c.amdFolder},removeManifestFromWidgetJson:function(b){if(b.manifest){for(var c in b.manifest.properties)b[c]=void 0;b.name=void 0;b.label=void 0;b.featureActions=void 0;b.manifest=void 0}},getUriFromItem:function(c){return c.url?
b.getFolderUrlFromItem(c)+"Widget":null},getFolderUrlFromItem:function(b){if(!b.url)return null;b=/manifest\.json$/.test(b.url)?b.url.substring(0,b.url.length-13):/\/$/.test(b.url)?b.url:b.url+"/";"https:"===window.location.protocol&&(b=b.replace(/^http:\/\//,"https://"));return b}};return b}();Q.addI18NLabel=function(b){var c=new f;if(b.i18nLabels)return c.resolve(b),c;b.i18nLabels={};if(b.properties&&!1===b.properties.hasLocale)return c.resolve(b),c;var e="widget"===b.category?"_widgetLabel":"_themeLabel";
require(Q.getRequireConfig(),["dojo/i18n!"+b.amdFolder+"nls/strings"],function(a){b.i18nLabels[dojoConfig.locale]=a[e];"theme"===b.category&&(b.layouts&&b.layouts.forEach(function(c){b["i18nLabels_layout_"+c.name]={};b["i18nLabels_layout_"+c.name][dojoConfig.locale]=a["_layout_"+c.name]}),b.styles&&b.styles.forEach(function(c){b["i18nLabels_style_"+c.name]={};b["i18nLabels_style_"+c.name][dojoConfig.locale]=a["_style_"+c.name]}));c.resolve(b)});return c};Q.localizeNumber=function(b,c){var e=(b.toString().split(".")[1]||
"").length,a="",a=c&&isFinite(c.places)&&c.places,a=0<a||0<e?"#,###,###,##0.0"+Array.prototype.join.call({length:0<a?a+1:e},"0"):"#,###,###,##0",e={locale:h.locale,pattern:a};n.mixin(e,c||{});try{return q.format(b,e)}catch(oa){return console.error(oa),b.toLocaleString()}};Q.parseNumber=function(b,c){var e={locale:h.locale};n.mixin(e,c||{});try{return q.parse(b,e)}catch(ba){return console.error(ba),b}};Q.localizeDate=function(b,c){var e={locale:h.locale,fullYear:!0};n.mixin(e,c||{});try{return r.format(b,
e)}catch(ba){return console.error(ba),"date"===e.selector?b.toLocaleDateString():"time"===e.selector?b.toLocaleTimeString():b.toLocaleString()}};Q.localizeNumberByFieldInfo=function(b,c){var e=null,e=n.exists("format.places",c)&&c.format.places,e=Q.localizeNumber(b,{places:e});return n.exists("format.digitSeparator",c)&&!c.format.digitSeparator?e.toString().replace(new RegExp("\\"+w.group,"g"),""):e};Q.fieldFormatter={getFormattedUrl:function(b){if(b&&"string"===typeof b){var c=b.indexOf("http:");
-1===c&&(c=b.indexOf("https:"));if(-1<c&&-1===b.indexOf("href\x3d")){var e=b.indexOf(" ",c);-1===e&&(e=b.length);var a=b.substring(c,e);b=b.substring(0,c)+'\x3cA href\x3d"'+a+'" target\x3d"_blank"\x3e'+a+"\x3c/A\x3e"+b.substring(e,b.length)}}return b||""},getFormattedNumber:function(b,c){if("number"===typeof b){var e=(b.toString().split(".")[1]||"").length;b=Q.localizeNumberByFieldInfo(b,{format:{places:c&&"number"===typeof c.places?parseInt(c.places,10):e,digitSeparator:c&&c.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+
(b||"")+"\x3c/span\x3e"}return b},getFormattedDate:function(b){b&&(b=Q.localizeDate(new Date(b),{fullYear:!0}));return b||""},getCodedValue:function(b,c){if(b&&b.codedValues){for(var e=0,a=b.codedValues.length;e<a;e++){var d=b.codedValues[e];if(Q.isDefined(c)&&n.exists("code",d)&&c.toString()===d.code.toString())return d.name}return c}return c||null},getTypeName:function(b,c){for(var e=c.length,a=0;a<e;a++)if(b===c[a].id)return c[a].name;return b}};Q.addRelativePathInCss=R;Q.url={isAbsolute:function(b){return b?
b.startWith("http")||b.startWith("/"):!1},removeQueryParamFromUrl:function(b,c){b=K.urlToObject(b);b.query&&delete b.query[c];c=b.path;for(var e in b.query)c=c===b.path?c+"?"+e+"\x3d"+b.query[e]:c+"\x26"+e+"\x3d"+b.query[e];return c},addQueryParamToUrl:function(b,c,e){b=K.urlToObject(b);b.query||(b.query={});b.query[c]=e;c=b.path;for(var a in b.query)c=c===b.path?c+"?"+a+"\x3d"+b.query[a]:c+"\x26"+a+"\x3d"+b.query[a];return c}};Q.processUrlInWidgetConfig=function(b,c){if(b)return b.startWith("data:")||
b.startWith("http")||b.startWith("/")?b:b.startWith("${appPath}")?b.replace("${appPath}",window.appInfo.appPath):c+b};Q.processUrlInAppConfig=function(b){if(b)return b.startWith("data:")||b.startWith("http")||b.startWith("/")?b:window.appInfo.appPath+b};Q.getLocationUrlWithoutHashAndQueryParams=function(){var b=window.location,c=b.protocol+"//"+b.host+b.pathname,b=K.urlToObject(b.href);b.query&&b.query.apiurl&&(c=Q.url.addQueryParamToUrl(c,"apiurl",b.query.apiurl));return c};Q.getDefaultWebMapThumbnail=
function(){return require.toUrl("jimu/images/webmap.png")};Q.invertColor=function(b){b=b.substring(1);3===b.length&&(b=b.slice(0,1)+b.slice(0,1)+b.slice(1,1)+b.slice(1,1)+b.slice(2,1)+b.slice(2,1));b=parseInt(b,16);return 7829367<b?"#000000":"#ffffff"};Q.mixinAppConfigPosition=function(b,c){var e=n.clone(b);if(!c)return e;c=n.clone(c);var d=e.widgetOnScreen,f=c.widgetOnScreen;f&&f.widgets&&("[object Object]"===Object.prototype.toString.call(f.widgets)?a.forEach(d.widgets,function(b,c){c=b.uri?b.uri:
"ph_"+c;f.widgets[c]&&f.widgets[c].position&&(f.widgets[c].position.relativeTo||(f.widgets[c].position.relativeTo="map"),b.position=f.widgets[c].position)},this):a.forEach(f.widgets,function(b,c){b.position&&!b.position.relativeTo&&(b.position.relativeTo="map");d.widgets[c]&&b.position&&(d.widgets[c].position=b.position)}));f&&f.groups&&("[object Object]"===Object.prototype.toString.call(f.groups)?a.forEach(d.groups,function(b,c){c=b.label?b.label:"g_"+c;f.groups[c]&&f.groups[c].panel&&f.groups[c].panel.position&&
(f.groups[c].panel.position.relativeTo||(f.groups[c].panel.position.relativeTo="map"),b.panel.position=f.groups[c].panel.position)},this):(b=b.layoutDefinition?b.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===b?a.forEach(f.groups,function(b,c){b.panel&&b.panel.position&&!b.panel.position.relativeTo&&(b.panel.position.relativeTo="map");d.groups[c]&&b.panel&&b.panel.position&&(d.groups[c].panel.position=b.panel.position)}):
"jimu/layoutManagers/GridLayoutManager"===b&&(d.groups=P(d.groups,f.groups.map(function(b){return b.id})))));c.map&&c.map.position&&(e.map?e.map.position=c.map.position:e.map={position:c.map.position});c.widgetPool&&c.widgetPool.panel&&(c.widgetPool.panel.position&&!c.widgetPool.panel.position.relativeTo&&(c.widgetPool.panel.position.relativeTo="map"),e.widgetPool.panel.position=c.widgetPool.panel.position);c.mobileLayout&&(e.mobileLayout=c.mobileLayout);return e};Q.handleGridLayoutOnScreenGroupChange=
P;Q.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(b,c,e){var a=-1;c=b.search(new RegExp(c));0<=c&&(b=b.slice(c,b.length),b=b.indexOf(e),a=c+b+e.length);return{firstPos:c,lastPos:a}},setConfigValue:function(b,c,e){V(b,c,e)},getConfigValue:function(b,c){return V(b,c)},setConfigValueWithId:function(b,c,e){W(b,c,e)},getConfigValueWithId:function(b,c){return W(b,c)},getKeyInfo:function(b){var c=this.getWidgetIdByKey(b);if(null!==c)return{type:"widget",
id:c};b=this.getGroupIdByKey(b);return null!==b?{type:"group",id:b}:{type:"unknow",id:null}},getWidgetIdByKey:function(b){var c=Q.template.getSearchRange(b,Q.template.widgetIdentification,"]");if(-1===c.firstPos)b=null;else{var e=b.slice(c.firstPos,c.lastPos);b=b.slice(c.firstPos+e.indexOf("[")+1,c.lastPos-1)}return b},getGroupIdByKey:function(b){var c=Q.template.getSearchRange(b,Q.template.groupIdentification,"]");if(-1===c.firstPos)b=null;else{var e=b.slice(c.firstPos,c.lastPos);b=b.slice(c.firstPos+
e.indexOf("[")+1,c.lastPos-1)}return b},getConfigedWidgetsByTemplateConfig:function(b){var c=[],e=Q.template.widgetIdentification+"_config",d;a.forEach(b.configurationSettings,function(b){a.forEach(b.fields,function(b){b.fieldName&&(d=Q.template.getSearchRange(b.fieldName,e,"]"),0<=d.firstPos&&(b=Q.template.getWidgetIdByKey(b.fieldName),-1===c.indexOf(b)&&c.push(b)))},this)},this);return c},mergeTemplateAppConfigToAppConfig:function(b,c,e){function d(b){var c=[];a.forEach(b,function(b){b&&c.push(b)},
this);return c}var f=b.widgetOnScreen,p=b.portalUrl;c.values.webmap&&(b.map.itemId=c.values.webmap);e&&(b.map.mapOptions&&Q.deleteMapOptions(b.map.mapOptions),b.map.portalUrl=p,c.values.app_title||(c.values.app_title=e.title),c.values.app_subtitle||(c.values.app_subtitle=e.snippet));for(var q in c.values)"webmap"!==q&&Q.template.setConfigValueWithId(b,q,c.values[q]);b.widgetPool.widgets=d(b.widgetPool.widgets);f.widgets=d(f.widgets);if(b.widgetPool.groups)for(c=0;c<b.widgetPool.groups.length;c++)b.widgetPool.groups[c].widgets=
d(b.widgetPool.groups[c].widgets);if(f.groups)for(c=0;c<f.groups.length;c++)f.groups[c].widgets=d(f.groups[c].widgets);return b}};Q.deleteMapOptions=function(b){b&&(delete b.extent,delete b.lods,delete b.center,delete b.scale,delete b.zoom,delete b.maxScale,delete b.maxZoom,delete b.minScale,delete b.minZoom,delete b.initialState)};Q.localeIsSame=function(b,c){return b.split("-")[0]===c.split("-")[0]};Q.graphicsExtent=function(){return null};Q.sanitizeHTML=function(b){return html_sanitize(b,function(b){return b},
function(b){return b})};Q.stripHTML=function(b){return b?-1<b.indexOf("\x3c")&&-1<b.indexOf("\x3e")?b.replace(/<(?:.|\s)*?>/g,""):b:b};Q.removeSuffixSlashes=function(b){return b.replace(/\/*$/g,"")};Q.getBestDisplayAttributes=function(b,c){var e={},a=null,d;for(d in b)a=Q.getBestDisplayValue(d,b,c),e[d]=a;return e};Q.getBestDisplayValue=function(b,c,e){var d="",f=null;n.isArrayLike(e)?f=Q.getFieldInfoByFieldName(e,b):"object"===typeof e&&e.name===b&&(f=e);f&&(d=c[b],"esriFieldTypeDate"===f.type?d&&
(b=new Date(parseInt(d,10)),d=Q._tryLocaleDate(b)):"number"===typeof d&&(f.domain&&"codedValue"===f.domain.type?a.some(f.domain.codedValues,function(b){if(b.code===d)return d=b.name,!0}):d=Q._tryLocaleNumber(d)));if(null===d||void 0===d)d="";return d};Q._tryLocaleNumber=function(b){var c=Q.localizeNumber(b);if(null===c||void 0===c)c=b;return c};Q._tryLocaleDate=function(b){var c=Q.localizeDate(b);c||(c=b.toLocaleDateString());return c};Q.getFieldInfoByFieldName=function(b,c){var e=null;b&&0<b.length&&
a.some(b,n.hitch(this,function(b){return b.name===c?(e=b,!0):!1}));return e};Q.containsNonLatinCharacter=function(b){for(var c=0;c<b.length;c++)if(255<b.charCodeAt(c))return!0;return!1};Q.isVersion4API=function(){return 0===v.version.indexOf("4")};Q.getEsriConfig=function(){return y};Q.getEsriConfigRequestObject=function(){var b=null;return b=Q.isVersion4API()?y.request:y.defaults.io};Q.setGlobalGeometryService=function(b){b=new G(b);Q.isVersion4API()?y.geometryService=b:y.defaults.geometryService=
b;return b};Q.getQueryableFeatureLayersFromMap=function(b){var c=[];b.layers&&(c=b.layers.filter(function(b){return"esri.layers.FeatureLayer"===b.declaredClass&&b.url&&b.supportedQueryFormats&&0<=b.supportedQueryFormats.toUpperCase().indexOf("JSON")}));return c};Q.has=function(b){var c=k(b);if(c)return c;if("ie"===b.toLowerCase()){b=0;var e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),a=!!navigator.userAgent.match(/Trident\/7.0/),d=navigator.userAgent.indexOf("rv:11.0");e&&(b=Number(RegExp.$1));-1!==
navigator.appVersion.indexOf("MSIE 10")&&(b=10);a&&-1!==d&&(b=11);return 11===b&&11||c}if("edge"===b.toLowerCase())return navigator.userAgent.split("Edge/")[1]||c};Q.detectUserAgent=function(){var b={},c={},e=navigator.userAgent,a=navigator.platform,d=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),f=e.match(/(Android);?[\s\/]+([\d.]+)?/),p=!!e.match(/\(Macintosh\; Intel /),q=e.match(/(iPad).*OS\s([\d_]+)/),l=e.match(/(iPod)(.*OS\s([\d_]+))?/),g=!q&&e.match(/(iPhone\sOS)\s([\d_]+)/),u=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),
a=/Win\d{2}|Windows/.test(a),r=e.match(/Windows Phone ([\d.]+)/),h=u&&e.match(/TouchPad/),w=e.match(/Kindle\/([\d.]+)/),t=e.match(/Silk\/([\d._]+)/),v=e.match(/(BlackBerry).*Version\/([\d.]+)/),y=e.match(/(BB10).*Version\/([\d.]+)/),k=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),x=e.match(/PlayBook/),z=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),m=e.match(/Firefox\/([\d.]+)/),A=e.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),E=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),
n=!z&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),B=n||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);c.webkit=!!d;c.webkit&&(c.version=d[1]);f&&(b.android=!0,b.version=f[2]);g&&!l&&(b.ios=b.iphone=!0,b.version=g[2].replace(/_/g,"."));q&&(b.ios=b.ipad=!0,b.version=q[2].replace(/_/g,"."));l&&(b.ios=b.ipod=!0,b.version=l[3]?l[3].replace(/_/g,"."):null);r&&(b.wp=!0,b.version=r[1]);u&&(b.webos=!0,b.version=u[2]);h&&(b.touchpad=!0);v&&(b.blackberry=!0,b.version=v[2]);
y&&(b.bb10=!0,b.version=y[2]);k&&(b.rimtabletos=!0,b.version=k[2]);x&&(c.playbook=!0);w&&(b.kindle=!0,b.version=w[1]);t&&(c.silk=!0,c.version=t[1]);!t&&b.android&&e.match(/Kindle Fire/)&&(c.silk=!0);z&&(c.chrome=!0,c.version=z[1]);m&&(c.firefox=!0,c.version=m[1]);A&&(b.firefoxos=!0,b.version=A[1]);E&&(c.ie=!0,c.version=E[1]);B&&(p||b.ios||a)&&(c.safari=!0,b.ios||(c.version=B[1]));n&&(c.webview=!0);b.tablet=!!(q||x||f&&!e.match(/Mobile/)||m&&e.match(/Tablet/)||E&&!e.match(/Phone/)&&e.match(/Touch/));
b.phone=!(b.tablet||b.ipod||!(f||g||u||v||y||z&&e.match(/Android/)||z&&e.match(/CriOS\/([\d.]+)/)||m&&e.match(/Mobile/)||E&&e.match(/Touch/)));return{os:b,browser:c}};Q.isMobileUa=function(){var b=Q.detectUserAgent();return!0===b.os.phone||!0===b.os.tablet?!0:!1};Q.isNeedHttpsButNot=function(){var b=navigator.geolocation,c=window.hasOwnProperty("isSecureContext");return(c&&window.isSecureContext||!c&&"https:"===window.location.protocol)&&b?!1:!0};Q.isInConfigOrPreviewWindow=function(){var b=!1;try{b=
!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(ca){b=!1}return!!b};Q.getAppHref=function(){var b="";return b=Q.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};Q.getAppIdFromUrl=function(){var b=!0,c=Q.getAppHref();if(-1!==c.indexOf("id\x3d")||-1!==c.indexOf("appid\x3d")||-1!==c.indexOf("apps"))b=!1;if(!0===b)return c;b=this.urlToObject(window.location.href);if(b.query&&(b.query.id||b.query.appid))return b.query.id||b.query.appid;
if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(b=window.appInfo.appPath.split("/"),b.length&&2<b.length)return b[b.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};Q.getEditorContentHeight=function(b,c,e){var a=new f;this._content=b;this._dom=c;this._domParam=e;var d=setTimeout(n.hitch(this,function(){clearTimeout(d);d=null;var b=0,c=this._domParam.contentWidth;try{var e=document.createElement("div");e.setAttribute("id","fakeContent");m.setStyle(e,
"background-size","contain");e.innerHTML=this._content;this._dom.appendChild(e);if(e){var f=g("img",e);f&&f.length&&f.style({maxWidth:c-20+"px"});m.setStyle(e,"position","absolute");m.setStyle(e,"width",c+"px");m.setStyle(e,"left","-99999px");m.setStyle(e,"top","-99999px");m.setStyle(e,"visibility","hidden");var p=m.getContentBox(e);p.h&&(b=p.h,b+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(pa){console.error("can't getEditorContentHeight"+pa),b=200}a.resolve(b)}),1500);return a};
Q.getEditorTextColor=function(b,c){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:Q.getColorRecordName(b),forceAttr:c}}};Q.getEditorBackgroundColor=function(b){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:Q.getColorRecordName(b)}}};Q.getColorRecordName=function(b){return"wab_cr_"+(b||"")};Q.isEsriDomain=function(b){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(b)};Q.b64toBlob=function(b,c,e){c=c||"";e=e||512;b=window.atob(b.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,
""));for(var a=[],d=0;d<b.length;d+=e){for(var f=b.slice(d,d+e),p=Array(f.length),q=0;q<f.length;q++)p[q]=f.charCodeAt(q);f=new Uint8Array(p);a.push(f)}return new Blob(a,{type:c})};Q.subtractionArray=function(b,c){for(var e=b.length-1;0<=e;e--)for(var a=b[e],d=c.length-1;0<=d;d--)if(a===c[d]){b.splice(e,1);c.splice(d,1);break}return b};Q.resourcesUrlToBlob=function(b){return H({url:b,handleAs:"blob"})};Q.processItemResourceOfAppConfig=function(b,e){function a(b){var c=b.obj,e=b.key,a={obj:c,key:e};
"number"===typeof b.i?(a.i=b.i,a.value=c[e][b.i]):a.value=c[e];return a}function d(b){for(var c in b)if("object"===typeof b[c])if(Array.isArray(b[c]))for(var e=b,a=c,p=0;p<e[a].length;p++)"string"===typeof e[a][p]?f(e,a,p):"object"===typeof e[a][p]&&d(e[a][p]);else d(b[c]);else"string"===typeof b[c]&&f(b,c)}function f(b,c,d){"number"===typeof d?e.test(b[c][d])&&(l=e.func(a({obj:b,key:c,i:d})),"function"===typeof l.then?q.push(l):p.push(l)):e.test(b[c])&&(l=e.func(a({obj:b,key:c})),"function"===typeof l.then?
q.push(l):p.push(l))}var p=[],q=[],l;d(b);return 0<q.length?c(q).then(function(c){0<p.length&&(c=c.concat(p));return{appConfig:b,result:c}}):{appConfig:b,result:p}};Q.isDefined=function(b){return void 0!==b&&null!==b};Q.getDefaultPopupInfo=function(b,c,e){var d=null;b&&b.fields&&(d={title:c,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},a.forEach(b.fields,function(b){var c=!1;e?a.some(e,n.hitch(this,function(c){return c&&b.name.toLowerCase()===c.toLowerCase()}))&&(c=!0):c=!0;c&&
(c=this.getDefaultPortalFieldInfo(b),c.visible=!0,c.isEditable=b.editable,d.fieldInfos.push(c))},this));return d};Q.getDefaultPortalFieldInfo=function(b){var c=b.name,c={fieldName:c,label:b.alias||c,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(b.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":c.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":c.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":c.format=
{dateFormat:"longMonthDayYear"}}return c};Q.checkEssentialAppsLicense=function(b,c,e){var a=J.getStandardPortalUrl(c.portalUrl),d=J.getSharingUrl(a),a=new I({appId:"arcgisWebApps",portalUrl:a});N.registerOAuthInfos([a]);return e?N.checkAppAccess(d,"arcgisWebApps"):c.getItemById(b).then(function(b){if("public"!==b.access)return N.checkAppAccess(d,"arcgisWebApps",{force:!0})})};Q.getStyleColorInTheme=function(b){var c=new f,e,a;window&&window.isBuilder?(a="./stemapp3d/themes/",e=window.appConfig):(a=
"./themes/",e=window.getAppConfig());if(e&&e.theme.customStyles&&e.theme.customStyles.mainBackgroundColor)return c.resolve(e.theme.customStyles.mainBackgroundColor),c.promise;var d=e.theme.name,p=e.theme.styles[0];b&&(p=b);H(a+d+"/manifest.json",{responseType:"json"}).then(n.hitch(this,function(b){if(b&&b.data){b=b.data.styles;for(var e=0;e<b.length;e++){var a=b[e];a.name===p&&c.resolve(a.styleColor)}}}),n.hitch(this,function(b){console.error(b);c.reject(null)}));return c.promise};return Q})},"dojo/NodeList-traverse":function(){define(["./query",
"./_base/lang","./_base/array"],function(n,a,m){var k=n.NodeList;a.extend(k,{_buildArrayFromCallback:function(a){for(var d=[],g=0;g<this.length;g++){var l=a.call(this[g],this[g],d);l&&(d=d.concat(l))}return d},_getUniqueAsNodeList:function(a){for(var d=[],g=0,l;l=a[g];g++)1==l.nodeType&&-1==m.indexOf(d,l)&&d.push(l);return this._wrap(d,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(a,d){a=this._getUniqueAsNodeList(a);a=d?n._filterResult(a,d):a;return a._stash(this)},_getRelatedUniqueNodes:function(a,
d){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(d),a)},children:function(h){return this._getRelatedUniqueNodes(h,function(d,g){return a._toArray(d.childNodes)})},closest:function(a,d){return this._getRelatedUniqueNodes(null,function(g,l){do if(n._filterResult([g],a,d).length)return g;while(g!=d&&(g=g.parentNode)&&1==g.nodeType);return null})},parent:function(a){return this._getRelatedUniqueNodes(a,function(a,g){return a.parentNode})},parents:function(a){return this._getRelatedUniqueNodes(a,
function(a,g){for(g=[];a.parentNode;)a=a.parentNode,g.push(a);return g})},siblings:function(a){return this._getRelatedUniqueNodes(a,function(a,g){g=[];for(var d=a.parentNode&&a.parentNode.childNodes,f=0;f<d.length;f++)d[f]!=a&&g.push(d[f]);return g})},next:function(a){return this._getRelatedUniqueNodes(a,function(a,g){for(a=a.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(a){return this._getRelatedUniqueNodes(a,function(a,g){for(g=[];a=a.nextSibling;)1==a.nodeType&&g.push(a);
return g})},prev:function(a){return this._getRelatedUniqueNodes(a,function(a,g){for(a=a.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a})},prevAll:function(a){return this._getRelatedUniqueNodes(a,function(a,g){for(g=[];a=a.previousSibling;)1==a.nodeType&&g.push(a);return g})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(a,
d){return 0!=d%2})},odd:function(){return this.filter(function(a,d){return 0==d%2})}});return k})},"dojo/number":function(){define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(n,a,m,k,h){var d={};n.setObject("dojo.number",d);d.format=function(l,f){f=n.mixin({},f||{});var c=a.normalizeLocale(f.locale),c=a.getLocalization("dojo.cldr","number",c);f.customs=c;c=f.pattern||c[(f.type||"decimal")+"Format"];return isNaN(l)||Infinity==Math.abs(l)?null:d._applyPattern(l,
c,f)};d._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;d._applyPattern=function(a,f,c){c=c||{};var b=c.customs.group,e=c.customs.decimal;f=f.split(";");var p=f[0];f=f[0>a?1:0]||"-"+p;if(-1!=f.indexOf("%"))a*=100;else if(-1!=f.indexOf("\u2030"))a*=1E3;else if(-1!=f.indexOf("\u00a4"))b=c.customs.currencyGroup||b,e=c.customs.currencyDecimal||e,f=f.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/,function(b,e,a,d){return(b=c[["symbol","currency","displayName"][a.length-1]]||c.currency||"")?e+b+d:""});else if(-1!=
f.indexOf("E"))throw Error("exponential notation not supported");var q=d._numberPatternRE,p=p.match(q);if(!p)throw Error("unable to find a number expression in pattern: "+f);!1===c.fractional&&(c.places=0);return f.replace(q,d._formatAbsolute(a,p[0],{decimal:e,group:b,places:c.places,round:c.round}))};d.round=function(a,d,c){c=10/(c||10);return(c*+a).toFixed(d)/c};if(0==(.9).toFixed()){var g=d.round;d.round=function(a,d,c){var b=Math.pow(10,-d||0),e=Math.abs(a);if(!a||e>=b)b=0;else if(e/=b,.5>e||
.95<=e)b=0;return g(a,d,c)+(0<a?b:-b)}}d._formatAbsolute=function(a,f,c){c=c||{};!0===c.places&&(c.places=0);Infinity===c.places&&(c.places=6);f=f.split(".");var b="string"==typeof c.places&&c.places.indexOf(","),e=c.places;b?e=c.places.substring(b+1):0<=e||(e=(f[1]||[]).length);0>c.round||(a=d.round(a,e,c.round));a=String(Math.abs(a)).split(".");var p=a[1]||"";f[1]||c.places?(b&&(c.places=c.places.substring(0,b)),b=void 0!==c.places?c.places:f[1]&&f[1].lastIndexOf("0")+1,b>p.length&&(a[1]=k.pad(p,
b,"0",!0)),e<p.length&&(a[1]=p.substr(0,e))):a[1]&&a.pop();e=f[0].replace(",","");b=e.indexOf("0");-1!=b&&(b=e.length-b,b>a[0].length&&(a[0]=k.pad(a[0],b)),-1==e.indexOf("#")&&(a[0]=a[0].substr(a[0].length-b)));var e=f[0].lastIndexOf(","),q,l;-1!=e&&(q=f[0].length-e-1,f=f[0].substr(0,e),e=f.lastIndexOf(","),-1!=e&&(l=f.length-e-1));f=[];for(e=a[0];e;)b=e.length-q,f.push(0<b?e.substr(b):e),e=0<b?e.slice(0,b):"",l&&(q=l,l=void 0);a[0]=f.reverse().join(c.group||",");return a.join(c.decimal||".")};d.regexp=
function(a){return d._parseInfo(a).regexp};d._parseInfo=function(l){l=l||{};var f=a.normalizeLocale(l.locale),f=a.getLocalization("dojo.cldr","number",f),c=l.pattern||f[(l.type||"decimal")+"Format"],b=f.group,e=f.decimal,p=1;if(-1!=c.indexOf("%"))p/=100;else if(-1!=c.indexOf("\u2030"))p/=1E3;else{var q=-1!=c.indexOf("\u00a4");q&&(b=f.currencyGroup||b,e=f.currencyDecimal||e)}f=c.split(";");1==f.length&&f.push("-"+f[0]);f=h.buildGroupRE(f,function(c){c="(?:"+h.escapeString(c,".")+")";return c.replace(d._numberPatternRE,
function(c){var a={signed:!1,separator:l.strict?b:[b,""],fractional:l.fractional,decimal:e,exponent:!1};c=c.split(".");var f=l.places;1==c.length&&1!=p&&(c[1]="###");1==c.length||0===f?a.fractional=!1:(void 0===f&&(f=l.pattern?c[1].lastIndexOf("0")+1:Infinity),f&&void 0==l.fractional&&(a.fractional=!0),!l.places&&f<c[1].length&&(f+=","+c[1].length),a.places=f);c=c[0].split(",");1<c.length&&(a.groupSize=c.pop().length,1<c.length&&(a.groupSize2=c.pop().length));return"("+d._realNumberRegexp(a)+")"})},
!0);q&&(f=f.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(b,c,e,a){b=h.escapeString(l[["symbol","currency","displayName"][e.length-1]]||l.currency||"");if(!b)return"";c=c?"[\\s\\xa0]":"";a=a?"[\\s\\xa0]":"";return l.strict?c+b+a:(c&&(c+="*"),a&&(a+="*"),"(?:"+c+b+a+")?")}));return{regexp:f.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:b,decimal:e,factor:p}};d.parse=function(a,f){f=d._parseInfo(f);a=(new RegExp("^"+f.regexp+"$")).exec(a);if(!a)return NaN;var c=a[1];if(!a[1]){if(!a[2])return NaN;
c=a[2];f.factor*=-1}c=c.replace(new RegExp("["+f.group+"\\s\\xa0]","g"),"").replace(f.decimal,".");return c*f.factor};d._realNumberRegexp=function(a){a=a||{};"places"in a||(a.places=Infinity);"string"!=typeof a.decimal&&(a.decimal=".");"fractional"in a&&!/^0/.test(a.places)||(a.fractional=[!0,!1]);"exponent"in a||(a.exponent=[!0,!1]);"eSigned"in a||(a.eSigned=[!0,!1]);var f=d._integerRegexp(a),c=h.buildGroupRE(a.fractional,function(b){var c="";b&&0!==a.places&&(c="\\"+a.decimal,c=Infinity==a.places?
"(?:"+c+"\\d+)?":c+("\\d{"+a.places+"}"));return c},!0),b=h.buildGroupRE(a.exponent,function(b){return b?"([eE]"+d._integerRegexp({signed:a.eSigned})+")":""}),f=f+c;c&&(f="(?:(?:"+f+")|(?:"+c+"))");return f+b};d._integerRegexp=function(a){a=a||{};"signed"in a||(a.signed=[!0,!1]);"separator"in a?"groupSize"in a||(a.groupSize=3):a.separator="";var d=h.buildGroupRE(a.signed,function(b){return b?"[-+]":""},!0),c=h.buildGroupRE(a.separator,function(b){if(!b)return"(?:\\d+)";b=h.escapeString(b);" "==b?
b="\\s":"\u00a0"==b&&(b="\\s\\xa0");var c=a.groupSize,d=a.groupSize2;return d?(b="(?:0|[1-9]\\d{0,"+(d-1)+"}(?:["+b+"]\\d{"+d+"})*["+b+"]\\d{"+c+"})",0<c-d?"(?:"+b+"|(?:0|[1-9]\\d{0,"+(c-1)+"}))":b):"(?:0|[1-9]\\d{0,"+(c-1)+"}(?:["+b+"]\\d{"+c+"})*)"},!0);return d+c};return d})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(n,a,m,k,h,d,g,l,f){function c(b,c,e,a){return a.replace(/([a-z])\1*/ig,
function(d){var f,q,l=d.charAt(0);d=d.length;var u=["abbr","wide","narrow"];switch(l){case "G":f=c[4>d?"eraAbbr":"eraNames"][0>b.getFullYear()?0:1];break;case "y":f=b.getFullYear();switch(d){case 1:break;case 2:if(!e.fullYear){f=String(f);f=f.substr(f.length-2);break}default:q=!0}break;case "Q":case "q":f=Math.ceil((b.getMonth()+1)/3);q=!0;break;case "M":case "L":f=b.getMonth();3>d?(f+=1,q=!0):(l=["months","L"==l?"standAlone":"format",u[d-3]].join("-"),f=c[l][f]);break;case "w":f=p._getWeekOfYear(b,
0);q=!0;break;case "d":f=b.getDate();q=!0;break;case "D":f=p._getDayOfYear(b);q=!0;break;case "e":case "c":if(f=b.getDay(),2>d){f=(f-k.getFirstDayOfWeek(e.locale)+8)%7;break}case "E":f=b.getDay();3>d?(f+=1,q=!0):(l=["days","c"==l?"standAlone":"format",u[d-3]].join("-"),f=c[l][f]);break;case "a":l=12>b.getHours()?"am":"pm";f=e[l]||c["dayPeriods-format-wide-"+l];break;case "h":case "H":case "K":case "k":q=b.getHours();switch(l){case "h":f=q%12||12;break;case "H":f=q;break;case "K":f=q%12;break;case "k":f=
q||24}q=!0;break;case "m":f=b.getMinutes();q=!0;break;case "s":f=b.getSeconds();q=!0;break;case "S":f=Math.round(b.getMilliseconds()*Math.pow(10,d-3));q=!0;break;case "v":case "z":if(f=p._getZone(b,!0,e))break;d=4;case "Z":l=p._getZone(b,!1,e);l=[0>=l?"+":"-",g.pad(Math.floor(Math.abs(l)/60),2),g.pad(Math.abs(l)%60,2)];4==d&&(l.splice(0,0,"GMT"),l.splice(3,0,":"));f=l.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+a);}q&&(f=g.pad(f,d));return f})}function b(b,
c,e,d){var f=function(b){return b};c=c||f;e=e||f;d=d||f;var p=b.match(/(''|[^'])+/g),q="'"==b.charAt(0);a.forEach(p,function(b,a){b?(p[a]=(q?e:c)(b.replace(/''/g,"'")),q=!q):p[a]=""});return d(p.join(""))}function e(b,c,e,a){a=d.escapeString(a);e.strict||(a=a.replace(" a"," ?a"));return a.replace(/([a-z])\1*/ig,function(a){var d;d=a.charAt(0);var f=a.length,p="",g="";e.strict?(1<f&&(p="0{"+(f-1)+"}"),2<f&&(g="0{"+(f-2)+"}")):(p="0?",g="0{0,2}");switch(d){case "y":d="\\d{2,4}";break;case "M":case "L":2<
f?(d=c["months-"+("L"==d?"standAlone":"format")+"-"+q[f-3]].slice(0).join("|"),e.strict||(d=d.replace(/\./g,""),d="(?:"+d+")\\.?")):d="1[0-2]|"+p+"[1-9]";break;case "D":d="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+p+"[1-9][0-9]|"+g+"[1-9]";break;case "d":d="3[01]|[12]\\d|"+p+"[1-9]";break;case "w":d="[1-4][0-9]|5[0-3]|"+p+"[1-9]";break;case "E":case "e":case "c":d=".+?";break;case "h":d="1[0-2]|"+p+"[1-9]";break;case "k":d="1[01]|"+p+"\\d";break;case "H":d="1\\d|2[0-3]|"+p+"\\d";break;case "K":d="1\\d|2[0-4]|"+
p+"[1-9]";break;case "m":case "s":d="[0-5]\\d";break;case "S":d="\\d{"+f+"}";break;case "a":f=e.am||c["dayPeriods-format-wide-am"];p=e.pm||c["dayPeriods-format-wide-pm"];d=f+"|"+p;e.strict||(f!=f.toLowerCase()&&(d+="|"+f.toLowerCase()),p!=p.toLowerCase()&&(d+="|"+p.toLowerCase()),-1!=d.indexOf(".")&&(d+="|"+d.replace(/\./g,"")));d=d.replace(/\./g,"\\.");break;default:d=".*"}b&&b.push(a);return"("+d+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var p={};n.setObject(f.id.replace(/\//g,"."),p);p._getZone=function(b,
c,e){return c?m.getTimezoneName(b):b.getTimezoneOffset()};p.format=function(e,a){a=a||{};var d=h.normalizeLocale(a.locale),f=a.formatLength||"short",d=p._getGregorianBundle(d),q=[];e=n.hitch(this,c,e,d,a);if("year"==a.selector)return b(d["dateFormatItem-yyyy"]||"yyyy",e);var g;"date"!=a.selector&&(g=a.timePattern||d["timeFormat-"+f])&&q.push(b(g,e));"time"!=a.selector&&(g=a.datePattern||d["dateFormat-"+f])&&q.push(b(g,e));return 1==q.length?q[0]:d["dateTimeFormat-"+f].replace(/\'/g,"").replace(/\{(\d+)\}/g,
function(b,c){return q[c]})};p.regexp=function(b){return p._parseInfo(b).regexp};p._parseInfo=function(c){c=c||{};var a=h.normalizeLocale(c.locale),a=p._getGregorianBundle(a),d=c.formatLength||"short",f=c.datePattern||a["dateFormat-"+d],q=c.timePattern||a["timeFormat-"+d],d="date"==c.selector?f:"time"==c.selector?q:a["dateTimeFormat-"+d].replace(/\{(\d+)\}/g,function(b,c){return[q,f][c]}),g=[];return{regexp:b(d,n.hitch(this,e,g,a,c)),tokens:g,bundle:a}};p.parse=function(b,c){var e=/[\u200E\u200F\u202A\u202E]/g,
d=p._parseInfo(c),f=d.tokens,q=d.bundle;b=(new RegExp("^"+d.regexp.replace(e,"")+"$",d.strict?"":"i")).exec(b&&b.replace(e,""));if(!b)return null;var g=["abbr","wide","narrow"],l=[1970,0,1,0,0,0,0],u="";b=a.every(b,function(b,e){if(!e)return!0;var d=f[e-1];e=d.length;d=d.charAt(0);switch(d){case "y":if(2!=e&&c.strict)l[0]=b;else if(100>b)b=Number(b),d=""+(new Date).getFullYear(),e=100*d.substring(0,2),d=Math.min(Number(d.substring(2,4))+20,99),l[0]=b<d?e+b:e-100+b;else{if(c.strict)return!1;l[0]=b}break;
case "M":case "L":if(2<e){if(e=q["months-"+("L"==d?"standAlone":"format")+"-"+g[e-3]].concat(),c.strict||(b=b.replace(".","").toLowerCase(),e=a.map(e,function(b){return b.replace(".","").toLowerCase()})),b=a.indexOf(e,b),-1==b)return!1}else b--;l[1]=b;break;case "E":case "e":case "c":e=q["days-"+("c"==d?"standAlone":"format")+"-"+g[e-3]].concat();c.strict||(b=b.toLowerCase(),e=a.map(e,function(b){return b.toLowerCase()}));b=a.indexOf(e,b);if(-1==b)return!1;break;case "D":l[1]=0;case "d":l[2]=b;break;
case "a":e=c.am||q["dayPeriods-format-wide-am"];d=c.pm||q["dayPeriods-format-wide-pm"];if(!c.strict){var p=/\./g;b=b.replace(p,"").toLowerCase();e=e.replace(p,"").toLowerCase();d=d.replace(p,"").toLowerCase()}if(c.strict&&b!=e&&b!=d)return!1;u=b==d?"p":b==e?"a":"";break;case "K":24==b&&(b=0);case "h":case "H":case "k":if(23<b)return!1;l[3]=b;break;case "m":l[4]=b;break;case "s":l[5]=b;break;case "S":l[6]=b}return!0});e=+l[3];"p"===u&&12>e?l[3]=e+12:"a"===u&&12==e&&(l[3]=0);e=new Date(l[0],l[1],l[2],
l[3],l[4],l[5],l[6]);c.strict&&e.setFullYear(l[0]);var r=f.join(""),d=-1!=r.indexOf("d"),r=-1!=r.indexOf("M");if(!b||r&&e.getMonth()>l[1]||d&&e.getDate()>l[2])return null;if(r&&e.getMonth()<l[1]||d&&e.getDate()<l[2])e=m.add(e,"hour",1);return e};var q=["abbr","wide","narrow"],r=[],w={};p.addCustomFormats=function(b,c){r.push({pkg:b,name:c});w={}};p._getGregorianBundle=function(b){if(w[b])return w[b];var c={};a.forEach(r,function(e){e=h.getLocalization(e.pkg,e.name,b);c=n.mixin(c,e)},this);return w[b]=
c};p.addCustomFormats(f.id.replace(/\/date\/locale$/,".cldr"),"gregorian");p.getNames=function(b,c,e,a){var d;a=p._getGregorianBundle(a);b=[b,e,c];"standAlone"==e&&(e=b.join("-"),d=a[e],1==d[0]&&(d=void 0));b[1]="format";return(d||a[b.join("-")]).concat()};p.isWeekend=function(b,c){c=k.getWeekend(c);b=(b||new Date).getDay();c.end<c.start&&(c.end+=7,b<c.start&&(b+=7));return b>=c.start&&b<=c.end};p._getDayOfYear=function(b){return m.difference(new Date(b.getFullYear(),0,1,b.getHours()),b)+1};p._getWeekOfYear=
function(b,c){1==arguments.length&&(c=0);var e=(new Date(b.getFullYear(),0,1)).getDay(),a=(e-c+7)%7,a=Math.floor((p._getDayOfYear(b)+a-1)/7);e==c&&a++;return a};return p})},"dojo/date":function(){define(["./has","./_base/lang"],function(n,a){var m={getDaysInMonth:function(a){var h=a.getMonth();return 1==h&&m.isLeapYear(a)?29:[31,28,31,30,31,30,31,31,30,31,30,31][h]},isLeapYear:function(a){a=a.getFullYear();return!(a%400)||!(a%4)&&!!(a%100)},getTimezoneName:function(a){var h=a.toString(),d="",g=h.indexOf("(");
if(-1<g)d=h.substring(++g,h.indexOf(")"));else if(g=/([A-Z\/]+) \d{4}$/,h=h.match(g))d=h[1];else if(h=a.toLocaleString(),g=/ ([A-Z\/]+)$/,h=h.match(g))d=h[1];return"AM"==d||"PM"==d?"":d},compare:function(a,h,d){a=new Date(+a);h=new Date(+(h||new Date));"date"==d?(a.setHours(0,0,0,0),h.setHours(0,0,0,0)):"time"==d&&(a.setFullYear(0,0,0),h.setFullYear(0,0,0));return a>h?1:a<h?-1:0},add:function(a,h,d){var g=new Date(+a),l=!1,f="Date";switch(h){case "day":break;case "weekday":var c;(h=d%5)?c=parseInt(d/
5):(h=0<d?5:-5,c=0<d?(d-5)/5:(d+5)/5);var b=a.getDay(),e=0;6==b&&0<d?e=1:0==b&&0>d&&(e=-1);b+=h;if(0==b||6==b)e=0<d?2:-2;d=7*c+h+e;break;case "year":f="FullYear";l=!0;break;case "week":d*=7;break;case "quarter":d*=3;case "month":l=!0;f="Month";break;default:f="UTC"+h.charAt(0).toUpperCase()+h.substring(1)+"s"}if(f)g["set"+f](g["get"+f]()+d);l&&g.getDate()<a.getDate()&&g.setDate(0);return g},difference:function(a,h,d){h=h||new Date;d=d||"day";var g=h.getFullYear()-a.getFullYear(),l=1;switch(d){case "quarter":a=
a.getMonth();h=h.getMonth();l=Math.floor(h/3)+1+4*g-(Math.floor(a/3)+1);break;case "weekday":g=Math.round(m.difference(a,h,"day"));d=parseInt(m.difference(a,h,"week"));if(0==g%7)g=5*d;else{var l=0,f=a.getDay(),c=h.getDay();d=parseInt(g/7);h=g%7;a=new Date(a);a.setDate(a.getDate()+7*d);a=a.getDay();if(0<g)switch(!0){case 6==f:l=-1;break;case 0==f:l=0;break;case 6==c:l=-1;break;case 0==c:l=-2;break;case 5<a+h:l=-2}else if(0>g)switch(!0){case 6==f:l=0;break;case 0==f:l=1;break;case 6==c:l=2;break;case 0==
c:l=1;break;case 0>a+h:l=2}g=g+l-2*d}l=g;break;case "year":l=g;break;case "month":l=h.getMonth()-a.getMonth()+12*g;break;case "week":l=parseInt(m.difference(a,h,"day")/7);break;case "day":l/=24;case "hour":l/=60;case "minute":l/=60;case "second":l/=1E3;case "millisecond":l*=h.getTime()-a.getTime()}return Math.round(l)}};a.mixin(a.getObject("dojo.date",!0),m);return m})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(n,a){var m={};n.setObject("dojo.cldr.supplemental",
m);m.getFirstDayOfWeek=function(a){a={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[m._region(a)];return void 0===a?1:a};m._region=function(k){k=a.normalizeLocale(k);
k=k.split("-");var h=k[1];h?4==h.length&&(h=k[2]):h={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",
hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",
or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",
ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",
fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",
lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",
rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",
umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[k[0]];return h};m.getWeekend=function(a){var h=m._region(a);a={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[h];h={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[h];void 0===a&&(a=6);void 0===h&&(h=0);return{start:a,end:h}};return m})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(n){n=n.getObject("dojox.encoding.base64",!0);n.encode=function(a){for(var m=[],k=a.length,h=k%3,k=k-h,d=0;d<k;){var g=a[d++]<<16|a[d++]<<8|a[d++];m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>18&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>12&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>6&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g&
63))}switch(h){case 2:g=a[d++]<<16|a[d++]<<8;m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>18&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>12&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>6&63));m.push("\x3d");break;case 1:g=a[d++]<<16,m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>18&63)),m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>
12&63)),m.push("\x3d"),m.push("\x3d")}return m.join("")};n.decode=function(a){a=a.split("");for(var m=[],k=a.length;"\x3d"==a[--k];);for(var h=0;h<k;){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[h++])<<18;h<=k&&(d|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[h++])<<12);h<=k&&(d|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[h++])<<6);h<=k&&(d|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[h++]));
m.push(d>>>16&255);m.push(d>>>8&255);m.push(d&255)}for(;0==m[m.length-1];)m.pop();return m};return n})},"esri/tasks/GeometryService":function(){define("../core/lang ../core/jsonMap ../core/accessorSupport/ensureType ../geometry/Extent ../geometry/Multipoint ../geometry/Polyline ../geometry/Polygon ../geometry/support/jsonUtils ../request ./Task ./support/ProjectParameters".split(" "),function(n,a,m,k,h,d,g,l,f,c,b){var e=new a.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",
DMS:"dms",DDM:"ddm",DD:"dd"}),p=m.ensureType(b);a=c.createSubclass({declaredClass:"esri.tasks.GeometryService",areasAndLengths:function(b,c){b={query:n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON())};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/areasAndLengths",b).then(function(b){return b.data})},autoComplete:function(b,c,a){var e=b[0].spatialReference;b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),polygons:JSON.stringify(this._encodeGeometries(b).geometries),
polylines:JSON.stringify(this._encodeGeometries(c).geometries)})};if(this.requestOptions||a)b=n.mixin({},this.requestOptions,a,b);return f(this.parsedUrl.path+"/autoComplete",b).then(function(b){return(b.data.geometries||[]).map(function(b){return new g({spatialReference:e,rings:b.rings})})})},buffer:function(b,c){var a=n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON()),e=b.outSpatialReference||b.geometries[0].spatialReference;b={query:a};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,
c,b);return f(this.parsedUrl.path+"/buffer",b).then(function(b){return(b.data.geometries||[]).map(function(b){return new g({spatialReference:e,rings:b.rings})})})},cut:function(b,c,a){var e=b[0].spatialReference,d=b.map(function(b){return b.toJSON()});b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),target:JSON.stringify({geometryType:l.getJsonType(b[0]),geometries:d}),cutter:JSON.stringify(c.toJSON())})};if(this.requestOptions||a)b=n.mixin({},this.requestOptions,a,
b);return f(this.parsedUrl.path+"/cut",b).then(function(b){b=b.data;return{cutIndexes:b.cutIndexes,geometries:(b.geometries||[]).map(function(b){return l.fromJSON(b).set("spatialReference",e)})}})},convexHull:function(b,c){var a=b[0].spatialReference;b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(a.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b))})};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/convexHull",b).then(function(b){return l.fromJSON(b.data.geometry).set("spatialReference",
a)})},densify:function(b,c){var a=n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON()),e=b.geometries[0].spatialReference;b={query:a};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/densify",b).then(function(b){return(b.data.geometries||[]).map(function(b){return l.fromJSON(b).set("spatialReference",e)})})},difference:function(b,c,a){var e=b[0].spatialReference;b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b)),
geometry:JSON.stringify({geometryType:l.getJsonType(c),geometry:c.toJSON()})})};if(this.requestOptions||a)b=n.mixin({},this.requestOptions,a,b);return f(this.parsedUrl.path+"/difference",b).then(function(b){return(b.data.geometries||[]).map(function(b){return l.fromJSON(b).set("spatialReference",e)})})},distance:function(b,c){b={query:n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON())};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/distance",b).then(this._handleDistanceResponse)},
fromGeoCoordinateString:function(b,c){var a={};a.sr=null!=b.sr&&"object"===typeof b.sr?b.sr.wkid||JSON.stringify(b.sr):b.sr;a.strings=JSON.stringify(b.strings);a.conversionType=e.toJSON(b.conversionType||"mgrs");a.conversionMode=b.conversionMode;b={query:n.mixin({},this.parsedUrl.query,{f:"json"},a)};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/fromGeoCoordinateString",b).then(this._handleFromGeoCoordinateResponse)},generalize:function(b,c){var a=
n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON()),e=b.geometries[0].spatialReference;b={query:a};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/generalize",b).then(function(b){return(b.data.geometries||[]).map(function(b){return l.fromJSON(b).set("spatialReference",e)})})},intersect:function(b,c,a){var e=b[0].spatialReference;b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b)),
geometry:JSON.stringify({geometryType:l.getJsonType(c),geometry:c.toJSON()})})};if(this.requestOptions||a)b=n.mixin({},this.requestOptions,a,b);return f(this.parsedUrl.path+"/intersect",b).then(function(b){return(b.data.geometries||[]).map(function(b){return l.fromJSON(b).set("spatialReference",e)})})},lengths:function(b,c){b={query:n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON())};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/lengths",b).then(function(b){return b.data})},
labelPoints:function(b,c){var a=b.map(function(b){return b.toJSON()}),e=b[0].spatialReference;b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:e.wkid?e.wkid:JSON.stringify(e.toJSON()),polygons:JSON.stringify(a)})};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/labelPoints",b).then(function(b){return(b.data.labelPoints||[]).map(function(b){return l.fromJSON(b).set("spatialReference",e)})})},offset:function(b,c){var a=n.mixin({},this.parsedUrl.query,
{f:"json"},b.toJSON()),e=b.geometries[0].spatialReference;b={query:a};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/offset",b).then(function(b){return(b.data.geometries||[]).map(function(b){return l.fromJSON(b).set("spatialReference",e)})})},project:function(b,c){b=p(b);var a=n.mixin({},b.toJSON(),this.parsedUrl.query,{f:"json"}),e=b.outSpatialReference,d=l.getJsonType(b.geometries[0]),q=this._decodeGeometries;b={query:a};if(this.requestOptions||c)b=
n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/project",b).then(function(b){return q(b.data,d,e)})},relation:function(b,c){b={query:n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON())};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/relation",b).then(this._handleRelationResponse)},reshape:function(b,c,a){var e=b.spatialReference;b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),target:JSON.stringify({geometryType:l.getJsonType(b),
geometry:b.toJSON()}),reshaper:JSON.stringify(c.toJSON())})};if(this.requestOptions||a)b=n.mixin({},this.requestOptions,a,b);return f(this.parsedUrl.path+"/reshape",b).then(function(b){return l.fromJSON(b.data.geometry).set("spatialReference",e)})},simplify:function(b,c){var a=b[0].spatialReference,e=n.mixin({},this.parsedUrl.query,{f:"json",sr:a.wkid?a.wkid:JSON.stringify(a.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b))}),d=l.getJsonType(b[0]),p=this._decodeGeometries;b={query:e};
if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/simplify",b).then(function(b){return p(b.data,d,a)})},toGeoCoordinateString:function(b,c){var a={};a.sr=null!=b.sr&&"object"===typeof b.sr?b.sr.wkid||JSON.stringify(b.sr):b.sr;a.coordinates=JSON.stringify(b.coordinates);a.conversionType=e.toJSON(b.conversionType||"mgrs");a.conversionMode=b.conversionMode;a.numOfDigits=b.numOfDigits;a.rounding=b.rounding;a.addSpaces=b.addSpaces;b={query:n.mixin({},this.parsedUrl.query,
{f:"json"},a)};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/toGeoCoordinateString",b).then(this._handleToGeoCoordinateResponse)},trimExtend:function(b,c){var a=n.mixin({},this.parsedUrl.query,{f:"json"},b.toJSON()),e=b.sr;b={query:a};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/trimExtend",b).then(function(b){return(b.data.geometries||[]).map(function(b){return new d({spatialReference:e,paths:b.paths})})})},
union:function(b,c){var a=b[0].spatialReference;b={query:n.mixin({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(a.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b))})};if(this.requestOptions||c)b=n.mixin({},this.requestOptions,c,b);return f(this.parsedUrl.path+"/union",b).then(function(b){return l.fromJSON(b.data.geometry).set("spatialReference",a)})},_handleRelationResponse:function(b){return b.data.relations},_handleDistanceResponse:function(b){return(b=b.data)&&b.distance},_handleToGeoCoordinateResponse:function(b){return b.data.strings},
_handleFromGeoCoordinateResponse:function(b){return b.data.coordinates},_encodeGeometries:function(b){var c=[],a,e=b.length;for(a=0;a<e;a++)c.push(b[a].toJSON());return{geometryType:l.getJsonType(b[0]),geometries:c}},_decodeGeometries:function(b,c,a){var e=l.getGeometryType(c);b=b.geometries;var d=[],f={spatialReference:a.toJSON()},p=n.mixin;b.forEach(function(b,c){d[c]=new e(p(b,f))});return d},_toProjectGeometry:function(b){var c=b.spatialReference.toJSON();return b instanceof k?new g({rings:[[[b.xmin,
b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]],spatialReference:c}):new d({paths:[[].concat(b.points)],spatialReference:c})},_fromProjectedGeometry:function(b,c,a){return"extent"===c?(b=b.rings[0],new k(b[0][0],b[0][1],b[2][0],b[2][1],a)):new h({points:b.paths[0],spatialReference:a.toJSON()})}});n.mixin(a,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});return a})},"esri/tasks/support/ProjectParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(n,a,m,k,h,d,g,l){var f=d.getLogger("esri.tasks.support.ProjectParameters");return function(c){function b(b){b=c.call(this)||this;b.geometries=null;b.outSpatialReference=null;b.transformation=null;b.transformForward=null;return b}m(b,c);Object.defineProperty(b.prototype,"outSR",{get:function(){f.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(b){f.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=b},enumerable:!0,configurable:!0});b.prototype.toJSON=function(){var b=this.geometries.map(function(b){return b.toJSON()}),c=this.geometries[0],a={};a.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());a.inSR=c.spatialReference.wkid||JSON.stringify(c.spatialReference.toJSON());a.geometries=JSON.stringify({geometryType:l.getJsonType(c),geometries:b});this.transformation&&(a.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(a.transformForward=this.transformForward);return a};k([g.property()],b.prototype,"geometries",void 0);k([g.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);k([g.property({json:{read:!1}})],b.prototype,"outSR",null);k([g.property()],b.prototype,"transformation",void 0);k([g.property()],b.prototype,"transformForward",void 0);return b=k([g.subclass("esri.tasks.support.ProjectParameters")],b)}(g.declared(h.JSONSupport))})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang",
"jimu/shared/basePortalUrlUtils"],function(n,a){var m=n.clone(a);m.declaredClass="jimu.portalUrlUtils";m.getPortalUrlFromLocation=function(){return m.getPortalServerFromLocation()+m.getDeployContextFromLocation()};m.getPortalSignInUrlFromLocation=function(){return m.getPortalUrlFromLocation()+"home/signin.html"};m.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};m.getDeployContextFromLocation=function(){var a=window.location.href.split("?")[0],h=a.indexOf("/home/");
0>h&&(h=a.indexOf("/apps/"));a=a.substring(a.indexOf(window.location.host)+window.location.host.length+1,h);"/"!==a&&(a="/"+a+"/");return a};m.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+m.getDeployContextFromLocation()+"sharing/rest/"};return m})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var n={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,
"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(a){return this.substr(0,a.length)===a});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a});n.getServerByUrl=function(a){a=(a||"").trim();a=a.replace(/^(http(s?):?)\/\//gi,"");0===a.indexOf("//")&&(a=a.slice(2));return a.split("/")[0]};n.getServerWithProtocol=function(a){var m="";if(a=(a||"").trim()){var k=
n.getServerByUrl(a);if(!k)return m;var h=n.getProtocol(a);h?m=h+"://"+k:0===a.indexOf("//")&&(m="//"+k)}return m};n.isSameServer=function(a,m){a=n.getServerByUrl(a)||"";m=n.getServerByUrl(m)||"";return a.toLowerCase()===m.toLowerCase()};n.isOnline=function(a){return 0<=n.getServerByUrl(a).toLowerCase().indexOf(".arcgis.com")};n.isArcGIScom=function(a){a=n.getServerByUrl(a).toLowerCase();return"www.arcgis.com"===a||"arcgis.com"===a};n.getStandardPortalUrl=function(a){var m=n.getServerByUrl(a);if(""===
m)return"";n.isOnline(m)?(n.isArcGIScom(m)&&(m="www.arcgis.com"),a=n.addProtocol(a),a=n.getProtocol(a)+"://"+m):(a=(a||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),a=n.addProtocol(a),a.replace(new RegExp("http(s?)://"+m,"g"),"")||(a+="/arcgis"));return a};n.isSamePortalUrl=function(a,m){var k=/^http(s?):\/\//gi,h=/^\/\//gi;a=n.getStandardPortalUrl(a).toLowerCase().replace(k,"").replace(h,"");m=n.getStandardPortalUrl(m).toLowerCase().replace(k,"").replace(h,"");return a===m};n.addProtocol=
function(a){if(-1>=a.toLowerCase().indexOf("http://")&&-1>=a.toLowerCase().indexOf("https://")){var m="";"undefined"!==typeof window&&window.location?(m=window.location.protocol,a=a.startWith("//")?m+a:a.startWith("/")?m+"//"+window.location.host+a:m+"//"+a):(m="http:",a.startWith("//")&&(a=m+a))}return a};n.getProtocol=function(a){var m="";a=a.toLowerCase();0===a.indexOf("https://")?m="https":0===a.indexOf("http://")&&(m="http");return m};n.updateUrlProtocolByOtherUrl=function(a,m){m=m.toLowerCase();
0===m.indexOf("https://")?a=n.setHttpsProtocol(a):0===m.indexOf("http://")&&(a=n.setHttpProtocol(a));return a};n.removeProtocol=function(a){return a.replace(/^http(s?):\/\//i,"//")};n.setHttpProtocol=function(a){a=n.addProtocol(a);return a.replace(/^https:\/\//,"http://")};n.setHttpsProtocol=function(a){a=n.addProtocol(a);return a.replace(/^http:\/\//,"https://")};n.setProtocol=function(a,m){return 0<=m.indexOf("https")?n.setHttpsProtocol(a):0<=m.indexOf("http")?n.setHttpProtocol(a):a};n.getSharingUrl=
function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/sharing");return m};n.getOAuth2Url=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/sharing/oauth2");return m};n.getAppIdUrl=function(a,m){var k="";(a=n.getStandardPortalUrl(a))&&(k=a+"/sharing/oauth2/apps/"+m);return k};n.getSignInUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/home/signin.html");return m};n.getBaseSearchUrl=function(a){var m="";a=n.getStandardPortalUrl(a);(a=a.replace(/\/*$/g,""))&&(m=a+"/sharing/rest/search");
return m};n.getBaseItemUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/sharing/rest/content/items");return m};n.getItemUrl=function(a,m){var k="";(a=n.getBaseItemUrl(a))&&m&&(k=a+"/"+m);return k};n.getItemDataUrl=function(a,m){var k="";(a=n.getItemUrl(a,m))&&(k=a+"/data");return k};n.getGenerateTokenUrl=function(a){var m="";a&&(a=n.getStandardPortalUrl(a),m=a+"/sharing/generateToken");return m};n.getItemDetailsPageUrl=function(a,m){var k="";a&&m&&(a=n.getStandardPortalUrl(a),k=a+"/home/item.html?id\x3d"+
m);return k};n.getUserProfilePageUrl=function(a,m){var k="";a&&m&&(a=n.getStandardPortalUrl(a),k=a+"/home/user.html?user\x3d"+m);return k};n.getBaseGroupUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/sharing/rest/community/groups");return m};n.getPortalSelfInfoUrl=function(a){var m="";(a=n.getStandardPortalUrl(a||""))&&(m=a+"/sharing/portals/self");return m};n.getCommunitySelfUrl=function(a){var m="";(a=n.getStandardPortalUrl(a||""))&&(m=a+"/sharing/rest/community/self");return m};
n.getBaseUserUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/sharing/rest/community/users");return m};n.getUserUrl=function(a,m){var k="",h=n.getBaseUserUrl(a);a&&m&&(k=h+"/"+m);return k};n.getUserTagsUrl=function(a,m){var k="",h=n.getUserUrl(a,m);a&&m&&(k=h+"/tags");return k};n.getUserThumbnailUrl=function(a,m,k){var h="";(a=n.getUserUrl(a,m))&&k&&(h=a+"/info/"+k);return h};n.getContentUrl=function(a){var m="";a&&(a=n.getStandardPortalUrl(a),m=a+"/sharing/rest/content");return m};
n.getUserContentUrl=function(a,m,k){var h="",h="";a&&m&&(h=n.getContentUrl(a),h=k?h+"/users/"+m+"/"+k:h+"/users/"+m);return h};n.getUserContentItemUrl=function(a,m,k){var h="",h="";a&&m&&k&&(h=n.getUserContentUrl(a,m),h=h+"/items/"+k);return h};n.getItemResourceUrl=function(a,m,k){var h="",h="";a&&m&&(h=n.getContentUrl(a),h=k?h+"/items/"+m+"/resources/"+k:h+"/items/"+m+"/resources");return h};n.getAddItemUrl=function(a,m,k){var h="",h="";a&&m&&(h=n.getUserContentUrl(a,m,k),h+="/addItem");return h};
n.getDeleteItemUrl=function(a,m,k){var h="";(a=n.getUserItemsUrl(a,m))&&(h=a+"/"+k+"/delete");return h};n.getUserItemsUrl=function(a,m,k){var h="",h="";a&&m&&(h=n.getUserContentUrl(a,m,k),h+="/items");return h};n.getUpdateItemUrl=function(a,m,k,h){var d="",d="";a&&m&&(d=n.getUserItemsUrl(a,m,h),d=d+"/"+k+"/update");return d};n.shareItemUrl=function(a,m,k,h){var d="",d="";a&&m&&(d=n.getUserItemsUrl(a,m,h),d=d+"/"+k+"/share");return d};n.getHomeIndexUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&
(m=a+"/home/index.html");return m};n.getHomeMapViewerUrl=function(a,m){var k="";if(a=n.getStandardPortalUrl(a))k=a+"/home/webmap/viewer.html",k=m?k+("?webmap\x3d"+m):k+"?useExisting\x3d1";return k};n.getHomeGalleryUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/home/gallery.html");return m};n.getHomeGroupsUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/home/groups.html");return m};n.getHomeMyContentUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/home/content.html");
return m};n.getHomeMyOrganizationUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/home/organization.html");return m};n.getHomeUserUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/home/user.html");return m};n.getPortalHelpUrl=function(a,m){var k="";(a=n.getStandardPortalUrl(a))&&(k=a+"/portalhelp/"+(m||"en")+"/portal/");return k};n.getPortalAdminHelpUrl=function(a,m){var k="";(a=n.getStandardPortalUrl(a))&&(k=a+"/portalhelp/"+(m||"en")+"/admin/help/");return k};n.getPortalProxyUrl=
function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/sharing/proxy");return m};n.getOAuth2SignOutUrl=function(a){var m="";(a=n.getStandardPortalUrl(a))&&(m=a+"/sharing/oauth2/signout");return m};n.getNewPrintUrl=function(a){var m="";if(a=n.getStandardPortalUrl(a))a=n.setHttpProtocol(a),m=a+"/sharing/tools/newPrint";return m};return n})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(n){function a(a,d){function g(d,f){var c,b,e,p,q="widgetOnScreen"===d;if(a[d]){if(a[d].groups)for(c=
0;c<a[d].groups.length;c++)if(e=a[d].groups[c],f(e,{index:c,isWidget:!1,groupId:e.id,isThemeWidget:!1,isOnScreen:q}),a[d].groups[c].widgets)for(b=0;b<a[d].groups[c].widgets.length;b++)p=a[d].groups[c].widgets[b],f(p,{index:b,isWidget:!0,groupId:e.id,isThemeWidget:p.uri&&-1<p.uri.indexOf("themes/"+a.theme.name),isOnScreen:q});if(a[d].widgets)for(c=0;c<a[d].widgets.length;c++)p=a[d].widgets[c],f(a[d].widgets[c],{index:c,isWidget:!0,groupId:d,isThemeWidget:p.uri&&-1<p.uri.indexOf("themes/"+a.theme.name),
isOnScreen:q})}}g("widgetOnScreen",d);g("widgetPool",d)}var m={},k="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");m.visitElement=a;m.getConfigElementById=function(h,d){var g;if("map"===d)return h.map;a(h,function(a){if(a.id===d)return g=a,!0});return g};m.getConfigElementByLabel=function(h,d){var g;if("map"===d)return h.map;
a(h,function(a){if(a.label||a.name===d)return g=a,!0});return g};m.getConfigElementsByName=function(h,d){var g=[];if("map"===d)return[h.map];a(h,function(a){a.name===d&&g.push(a)});return g};m.getWidgetNameFromUri=function(a){a=a.split("/");a.pop();return a.pop()};m.getAmdFolderFromUri=function(a){a=a.split("/");a.pop();return a.join("/")+"/"};m.widgetProperties=k;m.processWidgetProperties=function(a){"undefined"===typeof a.properties.isController&&(a.properties.isController=!1);"undefined"===typeof a.properties.isThemeWidget&&
(a.properties.isThemeWidget=!1);"undefined"===typeof a.properties.hasVersionManager&&(a.properties.hasVersionManager=!1);"undefined"===typeof a.properties.mirrorIconForRTL&&(a.properties.mirrorIconForRTL=!1);k.forEach(function(d){"undefined"===typeof a.properties[d]&&(a.properties[d]=!0)})};m.getControllerWidgets=function(a){var d=[];a.visitElement(function(a){a.isController&&d.push(a)});return d};m.isHostedService=function(a){var d=n.getServerByUrl(a);return(new RegExp(d+"/[^/]+/[^/]+/rest/services",
"gi")).test(a)};return m})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){var u=null,v=n(g,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(d.subscribe("app/sceneViewLoaded",a.hitch(this,
this._onSceneViewLoaded)),d.subscribe("app/sceneViewChanged",a.hitch(this,this._onSceneViewChanged))):(d.subscribe("sceneViewLoaded",a.hitch(this,this._onSceneViewLoaded)),d.subscribe("sceneViewChanged",a.hitch(this,this._onSceneViewChanged)));window.isBuilder?(d.subscribe("app/appConfigLoaded",a.hitch(this,this._onAppConfigLoaded)),d.subscribe("app/appConfigChanged",a.hitch(this,this._onAppConfigChanged))):(d.subscribe("appConfigLoaded",a.hitch(this,this._onAppConfigLoaded)),d.subscribe("appConfigChanged",
a.hitch(this,this._onAppConfigChanged)));d.subscribe("userSignIn",a.hitch(this,this._onUserSignIn));d.subscribe("userSignOut",a.hitch(this,this._onUserSignOut));d.subscribe("builder/actionTriggered",a.hitch(this,this._onActionTriggered));d.subscribe("/dnd/move/start",a.hitch(this,this._onMoveStart))},loadWidget:function(b){var c=new h,e;b=a.clone(b);b.folderUrl||q.processWidgetSetting(b);(e=this.getWidgetById(b.id))?c.resolve(e):p([this.loadWidgetClass(b),this.loadWidgetManifest(b)]).then(a.hitch(this,
function(b){var e=b[0],f=b[1];this.loadWidgetResources(f).then(a.hitch(this,function(b){try{var p=this.createWidget(f,e,b);console.log("widget ["+f.uri+"] created.")}catch(F){console.log("create ["+f.uri+"] error:"+F.stack),new w({message:window.jimuNls.createWidgetError+": "+f.uri}),c.reject(F)}setTimeout(a.hitch(this,function(){c.resolve(p);this.emit("widget-created",p);d.publish("widgetCreated",p)}),50)}),function(b){c.reject(b)})}),function(b){c.reject(b)});return c},loadWidgetClass:function(b){var c=
new h,e;e=b.isRemote?b.uri+".js":b.uri;require(q.getRequireConfig(),[e],a.hitch(this,function(b){c.resolve(b)}));q.checkError(b.uri,c);return c},loadWidgetResources:function(b){var c=new h,e,d,f,q=[];f=a.clone(b);b=this.tryLoadWidgetConfig(f);e=this._tryLoadResource(f,"i18n");d=this._tryLoadResource(f,"style");f=this._tryLoadResource(f,"template");q.push(b);q.push(e);q.push(f);q.push(d);p(q).then(a.hitch(this,function(b){var a={};a.config=b[0];a.i18n=b[1];a.template=b[2];a.style=b[3];c.resolve(a)}),
function(b){c.reject(b)});return c},loadWidgetManifest:function(b){var c=new h,d=q.getUriInfo(b.uri),d=d.isRemote?d.folderUrl+"manifest.json?f\x3djson":d.folderUrl+"manifest.json";if(b.manifest)return c.resolve(b),c;e(d,{handleAs:"json",headers:{"X-Requested-With":null}}).then(a.hitch(this,function(e){if(e.error&&e.error.code)return c.reject(e.error);e.amdFolder=b.amdFolder;e.category="widget";b.label?(this._processManifest(e),q.addManifest2WidgetJson(b,e),c.resolve(b)):q.addI18NLabel(e).then(a.hitch(this,
function(){this._processManifest(e);q.addManifest2WidgetJson(b,e);c.resolve(b)}))}),function(b){c.reject(b)});return c},getWidgetMarginBox:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return{};if(b._marginBox)return b._marginBox;b.setPosition({left:-9999,top:-9999,relativeTo:b.position.relativeTo});this.openWidget(b);b._marginBox=b.getMarginBox();this.closeWidget(b);return b._marginBox},_processManifest:function(b){q.addManifestProperies(b);q.processManifestLabel(b,window.dojoConfig.locale)},
createWidget:function(b,c,e){if(this.getWidgetById(b.id))return this.getWidgetById(b.id);e.config&&e.i18n&&(e.config=q.replacePlaceHolder(e.config,e.i18n));b.rawConfig=b.config;b.config=e.config||{};this.appConfig._appData&&this._mergeAgolConfig(b);b.nls=e.i18n||{};e.template&&(b.templateString=e.template);b["class"]="jimu-widget";b.label||(b.label=b.name);b.sceneView=this.sceneView;b.appConfig=this.appConfig;e={};for(var d in b)b.hasOwnProperty(d)&&(e[d]=b[d]);e.widgetManager=this;b=new c(e);b.clazz=
c;f.after(b,"startup",a.hitch(this,this._postWidgetStartup,b));f.before(b,"destroy",a.hitch(this,this._onDestroyWidget,b));l(b.domNode,"click",a.hitch(this,this._onClickWidget,b));this.loaded.push(b);return b},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var b=m.map(this.loaded,function(b){return b.id});m.forEach(b,function(b){this.destroyWidget(b)},this);this.loaded=[]},loadWidgetSettingPage:function(b){var c=new h;b=a.clone(b);b.id+="_setting";p([this.loadWidgetSettingClass(b)]).then(a.hitch(this,
function(e){var d=e[0];this.loadWidgetSettingPageResources(b).then(a.hitch(this,function(e){var p,q={nls:e.i18n,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};null!==e.template&&(q.templateString=e.template);for(var g in b)b.hasOwnProperty(g)&&(q[g]=b[g]);try{p=new d(q),f.before(p,"destroy",a.hitch(this,this._onDestroyWidgetSetting,p)),c.resolve(p)}catch(F){new w({message:window.jimuNls.createWidgetSettingError+":"+b.uri}),c.reject(F)}}),function(b){console.log(b)})}),
function(b){c.reject(b)});return c},loadWidgetSettingClass:function(b){var c=new h,e;e=b.isRemote?b.folderUrl+"setting/Setting.js":b.amdFolder+"setting/Setting";require(q.getRequireConfig(),[e],a.hitch(this,function(b){c.resolve(b)}));q.checkError(b.folderUrl+"setting/Setting.js",c);return c},loadWidgetSettingPageResources:function(b){var c=new h,e,d,f=[];b=a.clone(b);e=this._tryLoadResource(b,"settingI18n");d=this._tryLoadResource(b,"settingTemplate");b=this._tryLoadResource(b,"settingStyle");f.push(e);
f.push(d);f.push(b);p(f).then(a.hitch(this,function(b){var a={};a.i18n=b[0]||{};a.template=b[1];a.style=b[2];c.resolve(a)}),function(b){console.log(b)});return c},getWidgetById:function(b){var c;m.some(this.loaded,function(a){if(a.id===b)return c=a,!0},this);return c},getWidgetByLabel:function(b){var c;m.some(this.loaded,function(a){if(a.label===b)return c=a,!0},this);return c},getWidgetsByName:function(b){var c=[];m.some(this.loaded,function(a){a.name===b&&c.push(a)},this);return c},changeWindowStateTo:function(b,
c){"normal"===c?this.normalizeWidget(b):"minimized"===c?this.minimizeWidget(b):"maximized"===c?this.maximizeWidget(b):console.log("error state: "+c)},closeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;if("closed"!==b.state){this.activeWidget&&this.activeWidget.id===b.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);k.setStyle(b.domNode,"display","none");b.setState("closed");try{b.onClose()}catch(t){console.log(console.error("fail to close widget "+b.name+
". "+t.stack))}}},openWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;if(!b.started)try{b.started=!0,b.startup()}catch(t){console.error("fail to startup widget "+b.name+". "+t.stack)}if("closed"===b.state){k.setStyle(b.domNode,"display","");b.setState("opened");try{b.onOpen()}catch(t){console.error("fail to open widget "+b.name+". "+t.stack)}}},activateWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"opened"===b.state&&this._activeWidget(b)},
maximizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);b.setWindowState("maximized");try{b.onMaximize()}catch(t){console.log(console.error("fail to maximize widget "+b.name+". "+t.stack))}},minimizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);b.setWindowState("minimized");try{b.onMinimize()}catch(t){console.log(console.error("fail to minimize widget "+b.name+
". "+t.stack))}},normalizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);b.setWindowState("normal");try{b.onNormalize()}catch(t){console.log(console.error("fail to normalize widget "+b.name+". "+t.stack))}},destroyWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;this._removeWidget(b);try{b.destroy()}catch(t){console.log(console.error("fail to destroy widget "+b.name+". "+t.stack))}},tryLoadWidgetConfig:function(b){return this._tryLoadWidgetConfig(b).then(a.hitch(this,
function(c){return this._upgradeWidgetConfig(b,c).then(function(c){return b.config=c})}))},triggerWidgetOpen:function(b){function c(b){var c=f.after(b,"onOpen",function(){c.remove();e.resolve(b)})}var e=new h,p=this.getWidgetById(b);if(p){if("closed"!==p.state)return e.resolve(p),e;c(p)}else var q=d.subscribe("widgetCreated",a.hitch(this,function(c){c.id===b&&(q.remove(),e.resolve(c))}));d.publish("openWidget",b);return e},_tryLoadWidgetConfig:function(b){var d=new h;if(b.config&&a.isObject(b.config))return d.resolve(b.config),
d;if(b.config){if(require.cache["url:"+b.config])return d.resolve(c.parse(require.cache["url:"+b.config])),d;d=q.processUrlInAppConfig(b.config);d=d.split("/");d[d.length-1]=encodeURIComponent(d[d.length-1]);d=d.join("/");return e(d,{handleAs:"json"})}return this._tryLoadResource(b,"config").then(function(c){b.isDefaultConfig=!0;return c})},_upgradeWidgetConfig:function(b,c){var e=new h,d=b.manifest.version,f=b.version,p;if(d===f)return e.resolve(c),e;if(!1===b.hasVersionManager)return b.version=
d,e.resolve(c),e;require(q.getRequireConfig(),[b.amdFolder+"VersionManager"],a.hitch(this,function(a){a=new a;var q=a.getVersionIndex(f),g=a.getVersionIndex(d);if(q>g)e.reject("Bad widget version number, "+b.name+","+f);else try{p=a.upgrade(c,f,d),b.version=d,e.resolve(p)}catch(K){console.log("Read widget ["+b.name+"] old config error,"+K.stack),e.resolve(c)}}));return e},loadWidgetStyle:function(b){var c="widget/style/"+b.uri,a=new h,c=this._replaceId(c);return k.byId(c)?(a.resolve("load"),a):q.loadStyleLink(c,
b.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(b){var c="widget/style/"+b.uri+"/setting",a=new h,c=this._replaceId(c);return k.byId(c)?(a.resolve("load"),a):q.loadStyleLink(c,b.settingStyleFile)},loadWidgetConfig:function(b){b=require(q.getRequireConfig()).toUrl(b.configFile);if(require.cache["url:"+b]){var a=new h;a.resolve(c.parse(require.cache["url:"+b]));return a}return e(b,{handleAs:"json"})},loadWidgetI18n:function(b){var c=new h;require(q.getRequireConfig(),
["dojo/i18n!"+b.i18nFile],function(b){c.resolve(b)});return c},loadWidgetSettingI18n:function(b){var c=new h;require(q.getRequireConfig(),["dojo/i18n!"+b.settingI18nFile],function(b){c.resolve(b)});return c},loadWidgetTemplate:function(b){var c=new h;require(q.getRequireConfig(),["dojo/text!"+b.templateFile],function(b){c.resolve(b)});q.checkError(b.templateFile,c);return c},loadWidgetSettingTemplate:function(b){var c=new h;require(q.getRequireConfig(),["dojo/text!"+b.settingTemplateFile],function(b){c.resolve(b)});
q.checkError(b.settingTemplateFile,c);return c},removeWidgetStyle:function(b){k.destroy(this._replaceId("widget/style/"+b.uri))},removeWidgetSettingStyle:function(b){k.destroy(this._replaceId("widget/style/"+b.uri+"/setting"))},getControllerWidgets:function(){return m.filter(this.loaded,function(b){return b.isController})},getOffPanelWidgets:function(){return m.filter(this.loaded,function(b){return!b.inPanel})},getOnScreenOffPanelWidgets:function(){return m.filter(this.loaded,function(b){return b.isOnScreen&&
!b.inPanel})},closeOtherWidgetsInTheSameGroup:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;for(var c=0;c<this.loaded.length;c++)this.loaded[c].gid===b.gid&&this.loaded[c].id!==b.id&&this.closeWidget(this.loaded[c])},closeAllWidgetsInGroup:function(b){for(var c=0;c<this.loaded.length;c++)this.loaded[c].gid===b&&this.closeWidget(this.loaded[c])},_mergeAgolConfig:function(b){var c=this.appConfig._appData.values,a="widgets["+b.id+"]",e;for(e in c){var d=e.replace(/\//g,"_").indexOf(a+
"_config");0<=d&&q.template.setConfigValue(b,e.replace(/\//g,"_").substr(d,e.length).replace(a,"widget"),c[e])}},_onUserSignIn:function(b){m.forEach(this.loaded,function(c){c.onSignIn(b)},this)},_onUserSignOut:function(){m.forEach(this.loaded,function(b){b.onSignOut()},this)},_activeWidget:function(b){if(this.activeWidget){if(this.activeWidget.id===b.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&k.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&
(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&k.setStyle(b.domNode,"zIndex","zIndex"in b.position?b.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=b;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&k.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),d.publish("widgetActived",b))},_onClickWidget:function(c,a){var e=b(".jimu-widget",
c.domNode);if(0<e.length)for(var d=0;d<e.length;d++)if(a.target===e[d]||k.isDescendant(a.target,e[d]))return;this._activeWidget(c)},_onMoveStart:function(b){m.forEach(this.loaded,function(c){c.domNode===b.node&&this._activeWidget(c)},this)},_onAppConfigLoaded:function(b){this.appConfig=b=a.clone(b);r.setPortalUrl(b.portalUrl)},_onSceneViewLoaded:function(b){this.sceneView=b},_onSceneViewChanged:function(b){this.sceneView=b},_onAppConfigChanged:function(b,c,e,d){var f=a.clone(b);this.appConfig=f;m.forEach(this.loaded,
function(b){b&&(b.onAppConfigChanged(f,c,e,d),"widgetChange"===c&&this._onConfigChanged(e.id,e.config,d))},this)},_onConfigChanged:function(b,c){if(b=this.getWidgetById(b))b.onConfigChanged(c),a.mixin(b.config,c)},_onActionTriggered:function(b){if("map"!==b.elementId&&"app"!==b.elementId){var c=this.getWidgetById(b.elementId);if(c)c.onAction(b.action,b.data);else this.missedActions.push({id:b.elementId,action:{name:b.action,data:b.data}});m.forEach(this.getControllerWidgets(),function(c){if(c.widgetIsControlled(b.elementId))c.onAction(b.action,
{widgetId:b.elementId,data:b.data})},this)}},_postWidgetStartup:function(b){b.started=!0;q.setVerticalCenter(b.domNode);f.after(b,"resize",a.hitch(this,q.setVerticalCenter,b.domNode));this.openWidget(b);var c=r.getPortalCredential(this.appConfig.portalUrl);if(c)b.onSignIn(c);else b.onSignOut();this._triggerMissedAction(b)},_triggerMissedAction:function(b){this.missedActions.forEach(function(c){if(c.id===b.id)b.onAction(c.action.name,c.action.data)})},_remove:function(b){return m.some(this.loaded,
function(c,a){if(c.id===b)return this.loaded.splice(a,1),!0},this)},_tryLoadResource:function(b,c){var a,e=new h;if("config"===c)a=b.amdFolder+"config.json",b.configFile=a,a="hasConfig";else if("style"===c)a=b.amdFolder+"css/style.css",b.styleFile=a,a="hasStyle";else if("i18n"===c)a=b.amdFolder+"nls/strings.js",b.i18nFile=b.isRemote?a:b.amdFolder+"nls/strings",a="hasLocale";else if("template"===c)a=b.amdFolder+"Widget.html",b.templateFile=a,a="hasUIFile";else if("settingTemplate"===c)a=b.amdFolder+
"setting/Setting.html",b.settingTemplateFile=a,a="hasSettingUIFile";else if("settingI18n"===c)a=b.amdFolder+"setting/nls/strings.js",b.settingI18nFile=b.isRemote?a:b.amdFolder+"setting/nls/strings",a="hasSettingLocale";else if("settingStyle"===c)a=b.amdFolder+"setting/css/style.css",b.settingStyleFile=a,a="hasSettingStyle";else return e;b[a]?function(){var a;if("config"===c)a=this.loadWidgetConfig(b);else if("style"===c)a=this.loadWidgetStyle(b);else if("i18n"===c)a=this.loadWidgetI18n(b);else if("template"===
c)a=this.loadWidgetTemplate(b);else if("settingTemplate"===c)a=this.loadWidgetSettingTemplate(b);else if("settingStyle"===c)a=this.loadWidgetSettingStyle(b);else if("settingI18n"===c)a=this.loadWidgetSettingI18n(b);else return e;a.then(function(b){e.resolve(b)},function(a){console.error("Load widget resource error. resource:",c);console.error(a);new w({message:window.jimuNls.loadWidgetResourceError+": "+b.uri});e.reject(a)})}.apply(this):e.resolve(null);return e},_replaceId:function(b){return b.replace(/\//g,
"_").replace(/\./g,"_")},_onDestroyWidget:function(b){"closed"!==b.state&&this.closeWidget(b);this._removeWidget(b);console.log("destroy widget ["+b.uri+"].")},_onDestroyWidgetSetting:function(b){this.removeWidgetSettingStyle(b)},_removeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;this.activeWidget&&this.activeWidget.id===b.id&&(this.activeWidget=null);this._remove(b.id);0===this.getWidgetsByName(b.name).length&&this.removeWidgetStyle(b)}});v.getInstance=function(b){null===
u&&(u=new v(b),window._widgetManager=u);return u};return v})},"jimu/tokenUtils":function(){define("require dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){"function"!==typeof d.getAll&&(d.getAll=function(b){var c=[];(b=d(b))&&c.push(b);return c});p={portalUrl:null,
cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return w.isInConfigOrPreviewWindow()},isStringStartWith:function(b,c){return b.substr(0,c.length)===c},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(b){(b=r.getStandardPortalUrl(b))&&(b+="/");this.portalUrl=b},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(b){var d=new h,p=r.getStandardPortalUrl(b);b=p+"/sharing";
var q=r.setHttpsProtocol(p+"/sharing/generateToken?f\x3djson"),g=r.setHttpsProtocol(b);f.get(q,{jsonp:"callback"}).then(a.hitch(this,function(b){b.token?(this.webTierPortalUrls.push(p),this.removeWabAuthCookie(),c.id.getCredential(g).then(a.hitch(this,function(c){function a(b){var c=b.creationTime||(new Date).getTime(),e=b.expires;0<c&&0<e&&e>c&&setTimeout(function(){f.get(q,{jsonp:"callback"}).then(function(c){c.token&&(b.token=c.token,b.expires=c.expires,b.creationTime=(new Date).getTime(),b.refreshServerTokens(),
a(b))},function(b){console.error(b)})},.8*(e-c))}c.token||(c.token=b.token);c.expires||(c.expires=b.expires);var g=w.getEsriConfigRequestObject(),l=e.isTrustedServer(c.server,!0);-1<l&&g.corsEnabledServers.splice(l,1);this._pushCorsEnabledServerInfo({host:r.getServerByUrl(p),withCredentials:!0});d.resolve(!0);a(c)}),a.hitch(this,function(){d.resolve(!0)}))):d.resolve(!1)}),a.hitch(this,function(b){console.error(b);d.reject(b)}));return d},addAuthorizedCrossOriginDomains:function(b){if(b&&0<b.length)for(var c=
0;c<b.length;c++)this.addWithCredentialDomain(b[c])},addWithCredentialDomain:function(b){if(b&&"string"===typeof b){var c=w.getEsriConfigRequestObject().corsEnabledServers,a=r.getServerByUrl(b);(b=r.getServerWithProtocol(b))||(b="http://"+a);b=e.isTrustedServer(b,!0);-1<b&&c.splice(b,1);this._pushCorsEnabledServerInfo({host:a,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(b){if(b){var c=w.getEsriConfigRequestObject(),a=c.corsEnabledServers,e="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");
if("object"===typeof b&&"string"===typeof b.host){for(var d in b.host)b[d]="function"===typeof b.host[d]?function(){return b.host[d].apply(b.host,arguments)}:b.host[d];b.length=b.host.length;m.forEach(e,function(c){"function"===typeof b.host[c]&&(b[c]=function(){return b.host[c].apply(b.host,arguments)})});b.withCredentials&&c.webTierAuthServers&&0>c.webTierAuthServers.indexOf(b.host)&&c.webTierAuthServers.push(b.host)}a.push(b)}},tryRegisterCredential:function(b){return this.isValidCredential(b)?
m.some(c.id.credentials,a.hitch(this,function(c){return b.token===c.token}))?!1:(c.id.credentials.push(b),!0):!1},registerToken:function(b){var e=r.getSharingUrl(this.portalUrl);c.id.findCredential(e)&&m.some(c.id.credentials,a.hitch(this,function(b,a){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,b))return c.id.credentials.splice(a,1),!0}));return this._getTokenInfo(b).then(function(b){c.id.registerToken(b)})},_getTokenInfo:function(b){var c=r.getPortalSelfInfoUrl(this.portalUrl);return f.get(c+
("?f\x3djson\x26token\x3d"+b),{jsonp:"callback"}).then(a.hitch(this,function(c){if(c.user)return{server:r.getSharingUrl(this.portalUrl),ssl:c.allSSL,token:b,userId:c.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(b){console.error(b);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(b){return b&&"string"===typeof b&&a.trim(b)},signInPortal:function(b){var e=new h;if(this._isInvalidPortalUrl(b)){b=r.getStandardPortalUrl(b);var d=
r.getSharingUrl(b),f=this.getPortalCredential(b);f?setTimeout(a.hitch(this,function(){e.resolve(f)}),0):e=c.id.getCredential(d)}else setTimeout(a.hitch(this,function(){e.reject("Invalid portalurl.")}),0);return e},_loadPortalSelfInfo:function(c){c=r.getPortalSelfInfoUrl(c);var e=new h;b(c,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(a.hitch(this,function(b){e.resolve(b.data)}),a.hitch(this,function(b){e.reject(b)}));return e},registerOAuthInfo:function(b,a){if(!b||"string"!==
typeof b||!a||"string"!==typeof a)return null;var e=c.id.findOAuthInfo(b);e||(e=window.location.protocol+"//"+window.location.host+n.toUrl("jimu")+"/oauth-callback.html",e=new q({appId:a,expiration:20160,portalUrl:b,authNamespace:"/",popup:!0,popupCallbackUrl:e}),c.id.registerOAuthInfos([e]));e.appId=a;return e},signOutAll:function(){var b=r.getStandardPortalUrl(this.portalUrl),a=!!c.id.findCredential(b+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();
c.id.destroyCredentials();c.id._oAuthHash=null;a&&this._publishCurrentPortalUserSignOut(b)},userHaveSignInPortal:function(b){return!!this.getPortalCredential(a.trim(b||""))},isValidCredential:function(b){var c=!1;if(b){var c=b.token,e=b.server,d=b.scope,c=c&&"string"===typeof c&&a.trim(c),e=e&&"string"===typeof e&&a.trim(e),d="portal"===d||"server"===d,f=!0;b.expires&&(b=parseInt(b.expires,10),f=(new Date).getTime(),f=b>f);c=c&&e&&d&&f}return c},isValidPortalCredentialOfPortalUrl:function(b,c){var a=
!1;this.isValidCredential(c)&&(a="portal"===c.scope,b=r.isSameServer(b,c.server),a=a&&b);return a},getPortalCredential:function(b){var e=null;b=a.trim(b||"");if(!b)return null;b=r.getStandardPortalUrl(b);return e=this._filterPortalCredential(b,c.id.credentials)},saveAndRegisterCookieToCredential:function(b){b=a.clone(b);b.referer=window.location.host;b.scope="portal";b.isAdmin=!!b.isAdmin;this.saveWabCookie(b);var e=b.server+"/sharing/rest";b.server=e;c.id.registerToken(b);return c.id.findCredential(e,
b.userId)},registerAuth2Hash:function(b){b=a.clone(b);var c=1E3*parseInt(b.expires_in,10),c=(new Date).getTime()+c,e=r.getStandardPortalUrl(b.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:e,token:b.access_token,expires:c,userId:b.username,scope:"portal",isAdmin:!!b.isAdmin})},saveWabCookie:function(b){this.removeCookie("wab_auth");d("wab_auth",g.stringify(b),{expires:new Date(b.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},
removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(b,c){var e=null;c&&0<c.length&&(c=m.filter(c,a.hitch(this,function(c){return this.isValidPortalCredentialOfPortalUrl(b,c)})),0<c.length&&(e=c[c.length-1]));return e},_removePortalCredential:function(b){var e=a.trim(b||"");if(e){e=r.getStandardPortalUrl(e);
for(b=m.filter(c.id.credentials,a.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(e,b)}));0<b.length;)b[0].destroy(),b.splice(0,1);c.id.credentials=m.filter(c.id.credentials,a.hitch(this,function(b){return!this.isValidPortalCredentialOfPortalUrl(e,b)}))}},getUserIdByToken:function(e,d){var f=new h;if(e&&"string"===typeof e&&d&&"string"===typeof d){var p=r.getStandardPortalUrl(d);d=m.filter(c.id.credentials,a.hitch(this,function(b){var c=b.token===e&&b.userId;b=r.isSameServer(p,
b.server);return c&&b}));if(0<d.length){var q=d[0];setTimeout(a.hitch(this,function(){f.resolve(q.userId)}),0);return f}d=r.getCommunitySelfUrl(p);b(d,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(a.hitch(this,function(b){b=b&&b.data;f.resolve(b&&b.username||"")}),a.hitch(this,function(b){console.error(b);f.reject("fail to get userId by token")}))}else setTimeout(a.hitch(this,function(){f.reject("invalid parameters")}),0);return f},xtGetCredentialFromCookie:function(b){var a=
d("wab_auth"),e=null;if(a)try{e=g.parse(a)}catch(t){console.error(t)}if(!e||"object"!==typeof e||!r.isSameServer(b,e.server)||window.location.host!==e.referer)return null;e.expires=parseInt(e.expires,10);a=(new Date).getTime();if(!(e.expires>a))return this.removeCookie("wab_auth"),null;b+="/sharing/rest";e.server=b;(a=c.id.findCredential(b))||c.id.registerToken(e);return a=c.id.findCredential(b)},removeCookie:function(b){var c=this.getCookiePath();w.removeCookie(b,c)},_getDomainsByServerName:function(b){var c=
b.split("."),e=c.length;return m.map(c,a.hitch(this,function(b,d){b=c.slice(d,e);var f="",p=b.length-1;m.forEach(b,a.hitch(this,function(b,c){f+=b;c!==p&&(f+=".")}));return f}))},_publishCurrentPortalUserSignIn:function(b){if(this.isValidCredential(b))try{l.publish("userSignIn",b)}catch(v){console.error(v)}},_publishAnyUserSignIn:function(b){if(this.isValidCredential(b))try{l.publish("anyUserSignIn",b)}catch(v){console.error(v)}},_publishCurrentPortalUserSignOut:function(b){try{l.publish("userSignOut",
b)}catch(v){console.error(v)}},_signInSuccess:function(b){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,b)&&this._publishCurrentPortalUserSignIn(b),this._publishAnyUserSignIn(b)}catch(v){console.error(v)}},_bindEvents:function(){k.after(c.id,"signIn",a.hitch(this,function(b,c){console.log(c[1]);k.after(b,"callback",a.hitch(this,function(b,c){this._signInSuccess(c[0],!1)}));return b}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var b=
window.parent;if(b){var e=b.esri&&b.esri.id;if(e){c.id=e;n.module.deps.some(a.hitch(this,function(b){return"esri/identity/IdentityManager"===b.mid?(b.result=e,!0):!1}));var d=w.getEsriConfigRequestObject(),b=b.esriConfig.defaults.io;d.corsEnabledServers=b.corsEnabledServers;d.webTierAuthServers=b.webTierAuthServers;d._processedCorsServers=b._processedCorsServers;d.corsStatus=b.corsStatus}}}this._bindEvents();this._started=!0}}};p.startup();return p})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),
function(n,a,m,k,h,d){return n(d,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=m.create("div",{"class":"title"},this.domNode),this.titleLabeNode=m.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=m.create("div",
{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(h(this.closeBtnNode,"click",a.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:k.ENTER,onClick:a.hitch(this,this.close)})},_increaseZIndex:function(){m.setStyle(this.domNode,"zIndex",501);m.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){var p=0;return n(b,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();
this._positioning();k.place(this.domNode,this.container);setTimeout(a.hitch(this,function(){this._moveToMiddle()}),50);this.own(d(window,"resize",a.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=k.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();h.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===
typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=k.create("div",{"class":"title"},this.domNode);this.titleLabeNode=k.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=k.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var b=null,b="ontouchstart"in document?l.press:"click";this.own(d(this.closeBtnNode,
b,a.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=k.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&k.place(this.content,this.contentContainerNode));this.buttonContainer=k.create("div",{"class":"button-container"},this.domNode);0===
this.buttons.length&&k.setStyle(this.buttonContainer,"display","none");for(var b=this.buttons.length-1;-1<b;b--)this._createButton(this.buttons[b]),this.buttons[b].disable&&this.disableButton(b)},_limitButtonsMaxWidth:function(){var b=this.enabledButtons.length;if(0!==b){var c=k.getContentBox(this.buttonContainer),e=k.getMarginExtents(this.enabledButtons[0]),d=k.getPadBorderExtents(this.enabledButtons[0]),f=0,d=8===g("ie")?d.l+d.r:0,f=(c.w-(e.l+e.r+d)*b)/b;0<f&&(m.forEach(this.enabledButtons,a.hitch(this,
function(b){k.setStyle(b,"maxWidth",f+"px")})),m.forEach(this.disabledButtons,a.hitch(this,function(b){k.setStyle(b,"maxWidth",f+"px")})))}},_moveableNode:function(b,e){this.moveable&&(this.moveable.destroy(),this.moveable=null);var f=k.getMarginBox(this.container);f.l=f.l-b+e;f.w+=2*(b-e);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:f,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(d(this.moveable,"Moving",a.hitch(this,this.onMoving)));this.own(d(this.moveable,
"MoveStop",a.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===f("#header").length?{t:0,l:0,w:0,h:0}:k.getMarginBox("header")},_getFooterBox:function(){return 0===f(".footer",this.container).length?{t:0,l:0,w:0,h:0}:k.getMarginBox(f(".footer",this.container)[0])},_calculatePosition:function(){var b=k.getContentBox(this.container),c=this._getHeaderBox(),a=this._getFooterBox(),a=b.h-c.h-a.h-40,e=0;e=this._fixedHeight?this.height:this.autoHeight?a-200:this.height=a>this.maxHeight?this.maxHeight:
a;a=(a-e)/2+c.h+20;a=a<c.h?c.h:a;this.width=this.width||this.maxWidth;k.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(k.setStyle(this.domNode,"height","auto"),k.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&k.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(k.setStyle(this.domNode,"height",this.height+"px"),k.addClass(this.contentContainerNode,"content-absolute"),k.addClass(this.buttonContainer,
"button-container-absolute"),0===this.buttons.length&&k.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var b=k.getMarginBox(this.domNode),c=k.getContentBox(this.container),a=this._getHeaderBox(),e=this._getFooterBox(),e=c.h-a.h-e.h-40,d=0,d=b.h||e-200,b=(e-d)/2+a.h+20,b=b<a.h?a.h:b;k.setStyle(this.domNode,{left:(c.w-this.width)/2+"px",top:b+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();
this._calculateHeight()},_increaseZIndex:function(){k.setStyle(this.domNode,"zIndex",p+200+1);k.setStyle(this.overlayNode,"zIndex",p+200);p++},setTitleLabel:function(b){this.titleNode.innerHTML=e.stripHTML(b)},onMoving:function(b){k.setStyle(b.node,"opacity",.9)},onMoveStop:function(b){k.setStyle(b.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var b=this.domNode.parentNode,c=a.clone(this.domNode);k.setStyle(this.domNode,"display","none");k.destroy(this.overlayNode);this.destroy();
this.moveable.destroy();k.place(c,b);h.animateProperty({node:c,properties:{opacity:0},duration:200,onEnd:function(){k.destroy(c)}}).play()}},addButton:function(b){this._createButton(b)},_createButton:function(b){var c=" ";b.classNames&&0<b.classNames.length&&"function"===typeof b.classNames.join&&(c+=b.classNames.join(" "));var e=k.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+c,innerHTML:b.label,title:b.title},this.buttonContainer);this.enabledButtons.unshift(e);c=k.create("div",
{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+c,title:b.title,innerHTML:b.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(c);this.own(d(e,"click",a.hitch(this,function(c){if(b.onClick)b.onClick(c);else this.close()})))},setButtonProps:function(b,c){"number"===typeof b&&isFinite(b)||(c=b,b=0);if(c&&0!==this.enabledButtons.length)for(var a in c)"title"===a?(k.setAttr(this.enabledButtons[b],"title",c[a]),k.setAttr(this.disabledButtons[b],
"title",c[a])):"label"===a&&(k.setProp(this.enabledButtons[b],"innerHTML",c[a]),k.setProp(this.disabledButtons[b],"innerHTML",c[a]))},enableButton:function(b){"number"===typeof b&&isFinite(b)&&b<this.enabledButtons.length?(k.setStyle(this.enabledButtons[b],"display","inline-block"),k.setStyle(this.disabledButtons[b],"display","none")):(m.forEach(this.enabledButtons[b],a.hitch(this,function(b){k.setStyle(b,"display","inline-block")})),m.forEach(this.disabledButtons[b],a.hitch(this,function(b){k.setStyle(b,
"display","none")})))},disableButton:function(b){"number"===typeof b&&isFinite(b)&&b<this.disabledButtons.length?(k.setStyle(this.disabledButtons[b],"display","inline-block"),k.setStyle(this.enabledButtons[b],"display","none")):(m.forEach(this.disabledButtons,a.hitch(this,function(b){k.setStyle(b,"display","inline-block")})),m.forEach(this.enabledButtons,a.hitch(this,function(b){k.setStyle(b,"display","none")})))},showButton:function(b){this.enableButton(b)},hideButton:function(b){"number"===typeof b&&
isFinite(b)&&b<this.disabledButtons.length?(k.setStyle(this.disabledButtons[b],"display","none"),k.setStyle(this.enabledButtons[b],"display","none")):(m.forEach(this.disabledButtons,a.hitch(this,function(b){k.setStyle(b,"display","none")})),m.forEach(this.enabledButtons,a.hitch(this,function(b){k.setStyle(b,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(n,a,m,k,h,d){k=n("dojo.dnd.move.constrainedMoveable",
d,{constraints:function(){},within:!1,constructor:function(a,d){d||(d={});this.constraints=d.constraints;this.within=d.within},onFirstMove:function(d){var g=this.constraintBox=this.constraints.call(this,d);g.r=g.l+g.w;g.b=g.t+g.h;this.within&&(d=a.getMarginSize(d.node),g.r-=d.w,g.b-=d.h)},onMove:function(a,d){var f=this.constraintBox,c=a.node.style;this.onMoving(a,d);d.l=d.l<f.l?f.l:f.r<d.l?f.r:d.l;d.t=d.t<f.t?f.t:f.b<d.t?f.b:d.t;c.left=d.l+"px";c.top=d.t+"px";this.onMoved(a,d)}});h=n("dojo.dnd.move.boxConstrainedMoveable",
k,{box:{},constructor:function(a,d){var f=d&&d.box;this.constraints=function(){return f}}});n=n("dojo.dnd.move.parentConstrainedMoveable",k,{area:"content",constructor:function(d,l){var f=l&&l.area;this.constraints=function(){var c=this.node.parentNode,b=m.getComputedStyle(c),e=a.getMarginBox(c,b);if("margin"==f)return e;var d=a.getMarginExtents(c,b);e.l+=d.l;e.t+=d.t;e.w-=d.w;e.h-=d.h;if("border"==f)return e;d=a.getBorderExtents(c,b);e.l+=d.l;e.t+=d.t;e.w-=d.w;e.h-=d.h;if("padding"==f)return e;d=
a.getPadExtents(c,b);e.l+=d.l;e.t+=d.t;e.w-=d.w;e.h-=d.h;return e}}});return{constrainedMoveable:k,boxConstrainedMoveable:h,parentConstrainedMoveable:n}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],function(n){function a(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(a){return a},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(a){return a},compatible:!0},{version:"2.0.1",
description:"The version for Developer Edition 2.0.",upgrader:function(a){var k=null,h=0,d=a.widgetOnScreen.widgets;if(d&&0<d.length)for(h=0;h<d.length;h++)k=d[h],"widgets/Viz/Widget"===k.uri&&(k.uri="widgets/3DFx/Widget",k.name="3DFx");if((d=a.widgetPool.widgets)&&0<d.length)for(h=0;h<d.length;h++)k=d[h],"widgets/Viz/Widget"===k.uri&&(k.uri="widgets/3DFx/Widget",k.name="3DFx");return a},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(a){return a},compatible:!0},
{version:"2.2",description:"The version for Online 4.3.",upgrader:function(a){return a},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(a){return a},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(a){return a},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(a){return a},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(a){return a},compatible:!0},
{version:"2.7",description:"The version for Online 5.4.",upgrader:function(a){(function(){function k(h){var d=0,g=0;if(a[h].widgets)for(d=0;d<a[h].widgets.length;d++)if("widgets/Environment/Widget"===a[h].widgets[d].uri){a[h].widgets[d].uri="widgets/Daylight/Widget";break}if(a[h].groups)for(d=0;d<a[h].groups.length;d++)for(var l=a[h].groups[d],g=0;g<l.widgets.length;g++)if("widgets/Environment/Widget"===l.widgets[g].uri){l.widgets[g].uri="widgets/Daylight/Widget";break}}k("widgetOnScreen");k("widgetPool")})();
return a},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(a){return a},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(a){return a},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(a){return a},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",upgrader:function(a){return a},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(a){return a},
compatible:!0},{version:"2.13",description:"The version for Online 7.2",upgrader:function(a){return a},compatible:!0},{version:"2.14",description:"The version for Online 7.3",upgrader:function(a){return a},compatible:!0}];this.isCompatible=function(a,k){a=this.getVersionIndex(a);k=this.getVersionIndex(k);for(a+=1;a<=k;a++)if(!1===this.versions[a].compatible)return!1;return!0}}a.prototype=new n;return a.prototype.constructor=a})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=
[];this.upgrade=function(n,a,m){a=this.getVersionIndex(a);m=this.getVersionIndex(m);if(a>=m)throw Error("New version should higher than old version.");for(a+=1;a<=m;a++)this.versions[a].upgrader&&(n=this.versions[a].upgrader(n));return n};this.getVersionIndex=function(n){n=this.fixVersion(n);var a,m;for(m=0;m<this.versions.length;m++)this.versions[m].version===n&&(a=m);null===n&&(a=-1);void 0===a&&(a=this.versions.length-1);return a};this.fixVersion=function(n){return n?n:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){var t=null,x;x=n(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c,e){this._removeHash(c);this.urlParams=c||{};this.widgetManager=b.getInstance();a.mixin(this,e)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(a.hitch(this,function(b){var e=this.checkConfig(b);if(e)throw e;this.rawAppConfig=a.clone(b);u.getInstance().setRawAppConfig(this.rawAppConfig);
b=this._upgradeAppConfig(b);this._processAfterTryLoad(b);this.appConfig=b;if(this.urlParams.id)return this.loadWidgetsManifest(b).then(a.hitch(this,function(){return this._upgradeAllWidgetsConfig(b)})).then(a.hitch(this,function(b){return this.insertAppIdtoResourceUrlofAppConfig(b,this.urlParams.id)})).then(a.hitch(this,function(){this._configLoaded=!0;b.title&&(document.title=window.isBuilder?c.stripHTML(b.title)+" - Web AppBuilder for ArcGIS":c.stripHTML(b.title));this._readAndSetSharedTheme(b);
return this.getAppConfig()}));p.setPortalUrl(b.portalUrl);return this._proesssWebTierAndSignin(b).then(a.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var e=w.getStandardPortalUrl(b.portalUrl),e=q.getPortal(e);return c.checkEssentialAppsLicense(this.urlParams.appid,e,p.isInBuilderWindow()).then(a.hitch(this,function(){return this._getAppConfigFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(a.hitch(this,function(b){this._tryUpdateAppConfigByLocationUrl(b);
return this._processInPortalAppProtocol(b)}))}),a.hitch(this,function(b){console.error(b);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}return this._processNotInPortalAppProtocol(b).then(a.hitch(this,function(b){return this._getAppDataAddTemplateDataFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(a.hitch(this,function(c){c.appData.appConfig&&(b=c.appData.appConfig);b._appData=c.appData;b.templateConfig=c.templateData;b.isTemplateApp=!0;return b}))}))}return this._processNotInPortalAppProtocol(b)})).then(a.hitch(this,
function(b){this._processAfterTryLoad(b);this.appConfig=b;return b.map.itemId?b:q.getDefaultWebScene(b.portalUrl).then(function(c){b.map.itemId=c;return b})})).then(a.hitch(this,function(b){return this.loadWidgetsManifest(b)})).then(a.hitch(this,function(b){return b._appData?b._appData.values&&b._appData.values.webmap?q.getPortal(b.portalUrl).getItemById(b._appData.values.webmap).then(a.hitch(this,function(a){return c.template.mergeTemplateAppConfigToAppConfig(b,b._appData,a)})):c.template.mergeTemplateAppConfigToAppConfig(b,
b._appData):b})).then(a.hitch(this,function(){return this._upgradeAllWidgetsConfig(b)})).then(a.hitch(this,function(b){return b._wabAppId?this.processResourceInAppConfigForConfigLoader(b,this.urlParams):b.appItemId&&-1<window.JSON.stringify(b).indexOf("${itemId}")?this.insertAppIdtoResourceUrlofAppConfig(b,b.appItemId):b})).then(a.hitch(this,function(){this.appConfig=b;this._configLoaded=!0;b.title&&(document.title=c.stripHTML(b.title));this._readAndSetSharedTheme(b);return this.getAppConfig()}))}),
a.hitch(this,function(b){this.showError(b)}))},processResourceInAppConfigForConfigLoader:function(b,c){var e=b.portalUrl,d=b.appItemId,f=c.appid,p=new g,l=a.clone(b);this.insertAppIdtoResourceUrlofAppConfig(l,f).then(function(){if("config"===c.mode){var a=this.getResourceUrlsOfAppConfig(b).result;0!==a.length?q.getItemResources(e,f).then(function(b){if(0===b.length)return a=a.map(function(b){return{resUrl:b}}),r.AddResourcesToItemForAppSave(e,a,d,f).then(function(){p.resolve(l)},function(b){console.warn("Add resource to template based app error:"+
b.message||b);p.resolve(l)});p.resolve(l)},function(b){console.warn("Get resource of template based item error:"+b.message||b);p.resolve(l)}):p.resolve(l)}else p.resolve(l)}.bind(this),function(b){console.warn("Insert appId to resource url of appConfig error:"+b.message||b);p.resolve(l)});return p},getResourceUrlsOfAppConfig:function(b){var e={test:function(b){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(b)},func:a.hitch(this,function(b){return b.value})};return c.processItemResourceOfAppConfig(b,
e)},insertAppIdtoResourceUrlofAppConfig:function(b,e){function d(b){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(b)}function f(b,c){var a=c.obj,e=c.key,d={obj:a,key:e};"number"===typeof c.i?(d.i=c.i,d.value=a[e][c.i]):d.value=a[e];c=d;b=g.processItemIdAndTokenOfResources(c.value,b);a=c.obj;e=c.key;"number"===typeof c.i?a[e][c.i]=b:a[e]=b;return!0}var p=b.portalUrl,g=this;return q.getPortal(p).getItemById(e).then(a.hitch(this,function(q){q={test:d,func:a.hitch(this,f,{appId:e,isPublic:"public"===
q.access,portalUrl:p})};return c.processItemResourceOfAppConfig(b,q).appConfig}))},processItemIdAndTokenOfResources:function(b,c){0<b.indexOf("${itemId}")&&(b=b.replace("${itemId}",c.appId));/(\?|\&)token=.+/.test(b)&&(b=b.replace(/(\?|\&)token=.+/,""));c.isPublic||(c=p.getPortalCredential(c.portalUrl))&&(b+="?token\x3d"+c.token);return b},getAppConfig:function(){var b=a.clone(this.appConfig);b.getConfigElementById=function(b){return c.getConfigElementById(this,b)};b.getConfigElementsByName=function(b){return c.getConfigElementsByName(this,
b)};b.visitElement=function(b){c.visitElement(this,b)};this._addAuthorizedCrossOriginDomains(this.portalSelf,b);return b},_addAuthorizedCrossOriginDomains:function(b,c){b&&b.authorizedCrossOriginDomains&&p.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains);c&&c.authorizedCrossOriginDomains&&p.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains)},checkConfig:function(b){return(b=this._getRepeatedId(b))?"repeated id:"+b:null},processProxy:function(b){var a=c.getEsriConfigRequestObject();
a.alwaysUseProxy=b.httpProxy&&b.httpProxy.useProxy&&b.httpProxy.alwaysUseProxy;a.proxyUrl="";a.proxyRules=[];b.httpProxy&&b.httpProxy.useProxy&&b.httpProxy.url&&(a.proxyUrl=b.httpProxy.url);b.httpProxy&&b.httpProxy.useProxy&&b.httpProxy.rules&&m.forEach(b.httpProxy.rules,function(b){y.addProxyRule(b)})},addNeedValues:function(b){this._processNoUriWidgets(b);this._processEmptyGroups(b);this._addElementId(b);this._processWidgetJsons(b)},showError:function(b){k.create("div",{"class":"app-error",innerHTML:c.sanitizeHTML(b.message)},
document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,f(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(a.hitch(this,function(b){p.setPortalUrl(b.portalUrl);return this.urlParams.token?p.registerToken(this.urlParams.token).then(function(){return b}):b}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var b=w.getPortalUrlFromLocation(),e=new g;p.setPortalUrl(b);var d;this.urlParams.token?d=p.registerToken(this.urlParams.token):
(d=new g,d.resolve());d.then(a.hitch(this,function(){var d=q.getPortal(b);d.loadSelfInfo().then(a.hitch(this,function(f){this.portalSelf=f;f.allSSL&&"http:"===window.location.protocol?(window.location.href=w.setHttpsProtocol(window.location.href),e.reject()):this._processSignIn(b).then(a.hitch(this,function(){this._getAppConfigFromAppId(b,this.urlParams.id).then(a.hitch(this,function(b){return c.checkEssentialAppsLicense(this.urlParams.id,d,p.isInBuilderWindow()).then(a.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(b);
return this._processInPortalAppProtocol(b)}),a.hitch(this,function(b){console.error(b);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(b){e.resolve(b)},function(b){e.reject(b)})}))}))}),a.hitch(this,function(b){this.showError(b)}));return e}this.configFile="config.json";return f(this.configFile,{handleAs:"json"}).then(a.hitch(this,function(b){p.setPortalUrl(b.portalUrl);return this.urlParams.token?p.registerToken(this.urlParams.token).then(function(){return b}):b}))},
_upgradeAppConfig:function(b){var c=window.wabVersion,a=b.wabVersion;if(c===a)return b;var e=this.versionManager.getVersionIndex(a),d=this.versionManager.getVersionIndex(c);if(e>d)throw Error("Bad version number, "+a);b=this.versionManager.upgrade(b,a,c);b.wabVersion=c;b.isUpgraded=!0;return b},_upgradeAllWidgetsConfig:function(b){var c=new g,d=[];if(!b.isUpgraded)return c.resolve(b),c;delete b.isUpgraded;e.visitElement(b,a.hitch(this,function(b){b.uri&&(b.config?(b=this.widgetManager.tryLoadWidgetConfig(b),
d.push(b)):b.version=b.manifest.version)}));l(d).then(a.hitch(this,function(){c.resolve(b)}),function(b){c.reject(b)});return c},_processAfterTryLoad:function(b){this._setPortalUrl(b);this._tryUpdateAppConfigByLocationUrl(b);this._processUrlParams(b);this.addNeedValues(b);this.processProxy(b);v.tokenValidity=10080;return b},_readAndSetSharedTheme:function(b){b.theme.sharedTheme||(b.theme.sharedTheme={useHeader:!1,useLogo:!1},b.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?
!0:!1);b.theme.sharedTheme.useHeader&&(b.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(b.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},b.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));b.theme.sharedTheme.useLogo&&(b.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(b.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?
this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!b.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(b.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),b.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(b){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var c=w.getPortalUrlFromLocation(),
c=w.getStandardPortalUrl(c);w.isOnline(c)&&(c=w.updateUrlProtocolByOtherUrl(c,b.portalUrl),b.map.portalUrl&&w.isSamePortalUrl(b.portalUrl,b.map.portalUrl)&&(b.map.portalUrl=c),b.portalUrl=c,b.httpProxy&&b.httpProxy.url&&(b.httpProxy.url=w.getPortalProxyUrl(c)))}},_processWidgetJsons:function(b){e.visitElement(b,function(b,a){a.isWidget&&b.uri&&c.processWidgetSetting(b)})},_processNoUriWidgets:function(b){var c=0;e.visitElement(b,function(b,a){a.isWidget&&!b.uri&&(c++,b.placeholderIndex=c)})},_processEmptyGroups:function(b){var c=
0;b.widgetOnScreen.groups&&m.forEach(b.widgetOnScreen.groups,function(b){if(!b.widgets||b.widgets&&0===b.widgets.length)c++,b.placeholderIndex=c})},_addElementId:function(b){var c=0,a;e.visitElement(b,function(b){if(b.id){b.id=b.id.replace(/\//g,"_");var e=b.id.lastIndexOf("_");-1<e&&(a=b.id.substr(e+1),c=Math.max(c,a))}});e.visitElement(b,function(b){b.id||(c++,b.id=b.uri?b.uri.replace(/\//g,"_")+"_"+c:"_"+c)})},_setPortalUrl:function(b){if(b.portalUrl){var c=w.getPortalUrlFromLocation(),a=w.isOnline(c);
w.isSamePortalUrl(b.portalUrl,c)||a||(window.appInfo.isRunInPortal=!1)}else window.isXT&&d("wab_portalurl")?b.portalUrl=d("wab_portalurl"):(window.appInfo.isRunInPortal=!0,b.portalUrl=w.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(b,c){b.portalUrl=w.setProtocol(b.portalUrl,c);b.map.portalUrl&&(b.map.portalUrl=w.setProtocol(b.map.portalUrl,c));b.httpProxy&&(b.httpProxy.url=w.setProtocol(b.httpProxy.url,c),b.httpProxy&&b.httpProxy.rules&&m.forEach(b.httpProxy.rules,a.hitch(this,function(b){b.proxyUrl=
w.setProtocol(b.proxyUrl,c)})))},_processInPortalAppProtocol:function(b){var c=new g,e=q.getPortal(b.portalUrl),d=a.hitch(this,function(a){if("https:"===window.location.protocol)this._changePortalUrlProtocol(b,"https");else{if(a){window.location.href=w.setHttpsProtocol(window.location.href);c.reject();return}this._changePortalUrlProtocol(b,"http")}this._checkLocale();c.resolve(b)});e.loadSelfInfo().then(a.hitch(this,function(c){this.portalSelf=c;"private"===c.access?(c=0===b.portalUrl.toLowerCase().indexOf("https://"),
d(c)):d(c.allSSL)}),a.hitch(this,function(b){c.reject(b)}));return c},_processNotInPortalAppProtocol:function(b){var c=new g;b.portalUrl?q.getPortal(b.portalUrl).loadSelfInfo().then(a.hitch(this,function(a){this.portalSelf=a;var e="https:"===window.location.protocol;(a.allSSL||e)&&this._changePortalUrlProtocol(b,"https");0!==b.portalUrl.toLowerCase().indexOf("https://")||e||p.isInConfigOrPreviewWindow()?c.resolve(b):(window.location.href=w.setHttpsProtocol(window.location.href),c.reject())}),a.hitch(this,
function(b){c.reject(b)})):c.resolve(b);return c},_proesssWebTierAndSignin:function(b){var c=new g,e=!1,d=b.portalUrl;this._processWebTier(b).then(a.hitch(this,function(b){e=b;return q.getPortal(d).loadSelfInfo()})).then(a.hitch(this,function(b){this.portalSelf=b;return this._processSignIn(d,e)})).then(a.hitch(this,function(){c.resolve()}),function(b){c.reject(b)});return c},_processWebTier:function(b){var c=new g,e=b.portalUrl;b.isWebTier?(p.addAuthorizedCrossOriginDomains([e]),p.isWebTierPortal(e).then(a.hitch(this,
function(){var a=p.getPortalCredential(e);a&&a.ssl&&"http:"===window.location.protocol&&!p.isInConfigOrPreviewWindow()?window.location.href=w.setHttpsProtocol(window.location.href):c.resolve(b.isWebTier)}),a.hitch(this,function(b){c.reject(b)}))):c.resolve(!1);return c},_processSignIn:function(b,c){var e=new g,d=q.getPortal(b),f=w.getSharingUrl(b);window.appInfo.isRunInPortal?(c=v.checkSignInStatus(f),c.always(a.hitch(this,function(){e.resolve()}))):(p.isInBuilderWindow()||p.isInConfigOrPreviewWindow()||
!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||c||p.registerOAuthInfo(b,this.rawAppConfig.appId),c=v.checkSignInStatus(f),c.always(a.hitch(this,function(){p.xtGetCredentialFromCookie(b);d.loadSelfInfo().then(a.hitch(this,function(b){this.portalSelf=b;this._checkLocale();e.resolve()}))})));return e},_checkLocale:function(){if(!p.isInConfigOrPreviewWindow()){var b=this.portalSelf.user&&this.portalSelf.user.culture||h.locale,b=b.toLowerCase();!this.urlParams.locale&&c.isLocaleChanged(h.locale,
b)&&(d("wab_app_locale",b),window.location.reload())}},_getAppConfigFromTemplateAppId:function(b,c){var e=q.getPortal(b);return this._getWabAppIdAndDataFromTemplateAppId(b,c).then(a.hitch(this,function(c){var d=c.appId,f=c.appData;return l([this._getAppConfigFromAppId(b,d),e.getItemData(f.source)]).then(a.hitch(this,function(b){var c;f.appConfig?(c=f.appConfig,delete f.appConfig):c=b[0];c=this._upgradeAppConfig(c);b=b[1];c._appData=f;c._wabAppId=d;c.templateConfig=b;c.isTemplateApp=!0;return c}))}))},
_getAppDataAddTemplateDataFromTemplateAppId:function(b,c){var a=q.getPortal(b);return a.getItemData(c).then(function(b){return a.getItemData(b.source).then(function(c){return{appData:b,templateData:c}})})},_getWabAppIdAndDataFromTemplateAppId:function(b,c){var e=new g,d=q.getPortal(b);d.getItemData(c).then(a.hitch(this,function(b){d.getItemById(b.source).then(a.hitch(this,function(c){c=y.urlToObject(c.url);e.resolve({appId:c.query.id,appData:b})}))}),function(b){e.reject(b)});return e},_getAppConfigFromAppId:function(b,
c){return q.getPortal(b).getItemData(c)},_removeHash:function(b){for(var c in b)b[c]&&(b[c]=b[c].replace("#",""))},loadWidgetsManifest:function(b){function d(a,e,d){function g(c){return a.loadWidgetManifest(c).then(function(b){return b},function(a){console.log("Widget failed to load, it is removed.",c.name);a.stack?console.error(a.stack):console.log(a);f(b,c)})}return e.itemId?q.getPortal(d).getItemById(e.itemId).then(function(a){var d;d=c.isEsriDomain(a.url)?!0:p.getPortalCredential(b.portalUrl)?
!0:!1;if(d)return e.uri=c.widgetJson.getUriFromItem(a),g(e);console.log("Widget is not useable, it is removed.",e.name);f(b,e)}):g(e)}function f(b,c){function a(a){b[a]&&b[a].widgets&&(b[a].widgets=b[a].widgets.filter(function(b){if(c)return b.id!==c.id;b.uri&&!b.manifest&&console.error("Widget is removed because it is not loaded successfully.",b.uri);return b.manifest}));b[a]&&b[a].groups&&b[a].groups.forEach(function(b){b.widgets&&(b.widgets=b.widgets.filter(function(b){if(c)return b.id!==c.id;
b.uri&&!b.manifest&&console.error("Widget is removed because it is not loaded successfully.",b.uri);return b.manifest}))})}a("widgetOnScreen");a("widgetPool")}var u=[],r=new g;b._buildInfo&&b._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(a.hitch(this,function(f){e.visitElement(b,a.hitch(this,function(a){a.widgets||!a.uri&&!a.itemId||(a.uri&&f[a.uri]?(this._addNeedValuesForManifest(f[a.uri],a.uri),c.widgetJson.addManifest2WidgetJson(a,f[a.uri])):u.push(d(this.widgetManager,
a,b.portalUrl)))}));l(u).then(function(){r.resolve(b)})})):(e.visitElement(b,a.hitch(this,function(c){c.widgets||!c.uri&&!c.itemId||u.push(d(this.widgetManager,c,b.portalUrl))})),l(u).then(function(){r.resolve(b)}));setTimeout(function(){r.isResolved()||(f(b),r.resolve(b))},6E4);return r},_addNeedValuesForManifest:function(b,e){a.mixin(b,c.getUriInfo(e));c.addManifestProperies(b);c.processManifestLabel(b,h.locale)},_loadMergedWidgetManifests:function(){return f(window.appInfo.appPath+"widgets/widgets-manifest.json",
{handleAs:"json"})},_getRepeatedId:function(b){var c=[],a;e.visitElement(b,function(b){if(0<c.indexOf(b.id))return a=b.id,!0;c.push(b.id)});return a},_processUrlParams:function(b){var a=this.urlParams.itemid||this.urlParams.webmap;a&&b.map.itemId!==a&&(b.map.mapOptions&&c.deleteMapOptions(b.map.mapOptions),b.map.itemId=a);this.urlParams.mode&&(b.mode=this.urlParams.mode);b.map.mapOptions||(b.map.mapOptions={});this.urlParams.scale&&(b.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||
this.urlParams.zoom)b.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});x.getInstance=function(b,c){null===t?t=new x(b,c):(t.urlParams=b,t.options=c);return t};return x})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(n,a,m,k,h,d,g,l,f,c,b){var e=n([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,
portalUrl:null,credential:null,constructor:function(b){this.portalUrl=c.getStandardPortalUrl(b);this.selfUrl=c.getPortalSelfInfoUrl(b)},loadSelfInfo:function(){var b=new h,c={query:{f:"json"},responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(c.query.token=this.credential.token);l(this.selfUrl,c).then(a.hitch(this,function(c){c=c.data;var e=c.user;delete c.user;a.mixin(this,c);c.user=e;b.resolve(c)}),a.hitch(this,function(c){console.error(c);b.reject(c)}));return b},
_checkCredential:function(){var c=b.isValidCredential(this.credential);c||this.clearCredentialAndUser();return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=b.getPortalCredential(this.portalUrl))},signIn:function(){var c=new h;this.updateCredential();this.isValidCredential()?setTimeout(a.hitch(this,function(){c.resolve(this.credential)}),0):c=b.signInPortal(this.portalUrl);return c},haveSignIn:function(){return b.userHaveSignInPortal(this.portalUrl)},
clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var c=new h;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(a.hitch(this,function(){this.user.updateCredential();c.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(a.hitch(this,function(b){this.user=b;c.resolve(this.user)}),a.hitch(this,function(b){console.error(b);c.reject(b)})):b.getUserIdByToken(this.credential.token,
this.portalUrl).then(a.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(a.hitch(this,function(b){this.user=b;c.resolve(this.user)}),a.hitch(this,function(b){console.error(b);c.reject(b)}))}),a.hitch(this,function(b){console.error(b);c.reject(b)})):setTimeout(a.hitch(this,function(){c.reject("credential is null.")}),0);return c},queryItems:function(b){this.updateCredential();var e=new h,d=c.getBaseSearchUrl(this.portalUrl),f={f:"json"};b&&(f=a.mixin(f,b));
this.isValidCredential()&&(f.token=this.credential.token);f.sortField||f.sortOrder||(f.sortField="title",f.sortOrder="asc");l(d,{responseType:"json",query:f,callbackParamName:"callback"}).then(a.hitch(this,function(b){b=b.data;b.results=m.map(b.results,a.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;return new r(b)}));e.resolve(b)}),a.hitch(this,function(b){console.error(b);e.reject(b)}));return e},getItemData:function(b){this.updateCredential();b=c.getItemDataUrl(this.portalUrl,
b);var e={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential.token);var d=new h;l(b,e).then(a.hitch(this,function(b){d.resolve(b.data)}),a.hitch(this,function(b){d.reject(b)}));return d},getItemById:function(b){var e=new h;this.updateCredential();b=c.getItemUrl(this.portalUrl,b);var d={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(d.query.token=this.credential.token);l(b,d).then(a.hitch(this,
function(b){b=b.data;b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;b=new r(b);e.resolve(b)}),a.hitch(this,function(b){console.error(b);e.reject(b)}));return e},getAppById:function(b){var e=new h;this.updateCredential();this.isValidCredential()?(b=c.getAppIdUrl(this.portalUrl,b),l(b,{responseType:"json",query:{f:"json",token:this.credential.token}}).then(a.hitch(this,function(b){e.resolve(b.data)}),a.hitch(this,function(b){e.reject(b)}))):setTimeout(a.hitch(this,function(){e.reject("token is null.")}),
0);return e},queryGroups:function(b){this.updateCredential();var e=new h,d=c.getBaseGroupUrl(this.portalUrl),f={f:"json"};b&&(f=a.mixin(f,b));this.isValidCredential()&&(f.token=this.credential.token);l(d,{responseType:"json",query:f,callbackParamName:"callback"}).then(a.hitch(this,function(b){b=b.data;b.results=m.map(b.results,a.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;return new q(b)}));e.resolve(b)}),a.hitch(this,function(b){console.error(b);e.reject(b)}));
return e},registerApp:function(b,e,d){var f=new h;this.updateCredential();if(this.isValidCredential()){var p=this.credential&&this.credential.token,q=c.getOAuth2Url(this.portalUrl);l(q+"/registerApp",{query:{itemId:b,appType:e,redirect_uris:g.stringify(d),token:p,f:"json"},responseType:"json",method:"post"}).then(a.hitch(this,function(b){f.resolve(b.data)}),a.hitch(this,function(b){f.reject(b)}))}else setTimeout(a.hitch(this,function(){f.reject("token is null.")}),0);return f},createAndRegisterApp:function(b){var c=
new h;this.updateCredential();this.isValidCredential()?this.getUser().then(a.hitch(this,function(e){e.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(a.hitch(this,function(e){e.success?this.registerApp(e.id,"browser",b).then(a.hitch(this,function(b){c.resolve(b)}),a.hitch(this,function(b){console.error(b);c.reject(b)})):c.reject("create app failed")}),a.hitch(this,function(b){console.error(b);c.reject(b)}))}),a.hitch(this,
function(b){console.error(b);c.reject(b)})):setTimeout(a.hitch(this,function(){c.reject("token is null.")}),0);return c},_getUser:function(b){this.updateCredential();var e=new h;b=c.getUserUrl(this.portalUrl,b);var d={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(d.query.token=this.credential&&this.credential.token);l(b,d).then(a.hitch(this,function(b){b=b.data;b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;this.user=new p(b);
e.resolve(this.user)}),a.hitch(this,function(b){console.error(b);e.reject(b)}));return e},getItemResources:function(b,a,e){e||(e=100);b=c.getStandardPortalUrl(b);b=c.getItemResourceUrl(b,a);return l({url:b,content:{f:"json",num:e}}).then(function(b){if(b&&b.resources)return b.resources})},addResource:function(b,a,e,d,f){b=c.getStandardPortalUrl(b);var p=this.getPortal(b),q=new FormData;q.append("file",e,d);q.append("fileName",d);q.append("f","json");var g="";f?(q.append("resourcesPrefix",f),g=f+"/"+
d):g=d;return p.getItemById(a,!0).then(function(e){e=c.getUserContentItemUrl(b,e.owner,a);return l({url:e+"/addResources",form:q}).then(function(a){var e="";a&&a.success&&(e=c.getItemResourceUrl(b,"${itemId}",g));return e},function(b){console.error(b.message||b);return b})})},removeResources:function(b,a,e,d){var f={resource:d?d+"/"+e:e,f:"json"};b=c.getStandardPortalUrl(b);return this.getPortal(b).getItemById(a,!0).then(function(e){e=c.getUserContentItemUrl(b,e.owner,a);return l({url:e+"/removeResources",
content:f},{usePost:!0}).then(function(b){return b},function(b){console.error(b.message||b);return b})})}}),p=n([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(b){b&&a.mixin(this,b)},_checkCredential:function(){var c=b.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),
this.credential=this.portal.credential)},getGroups:function(){var b=[];this.groups&&(b=m.map(this.groups,a.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this.portal;return new q(b)})));return b},getItemsByKeywords:function(b,c){return this.portal.queryItems({start:c||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+b+'"'})},getContent:function(){this.updateCredential();var b=c.getUserContentUrl(this.portalUrl,this.username),e={responseType:"json",
query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(e.query.token=this.credential.token);var d=new h;l(b,e).then(a.hitch(this,function(b){d.resolve(b.data)}),a.hitch(this,function(b){d.reject(b)}));return d},getTags:function(){this.updateCredential();var b=c.getUserTagsUrl(this.portalUrl,this.username),e={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential.token);var d=new h;l(b,e).then(a.hitch(this,function(b){d.resolve(b.data)}),
a.hitch(this,function(b){d.reject(b)}));return d},addItem:function(b,e){this.updateCredential();var d=new h;if(this.isValidCredential()){var f={f:"json",token:this.credential.token};b&&(f=a.mixin(f,b));b=c.getAddItemUrl(this.portalUrl,this.username,e);l(b,{responseType:"json",callbackParamName:"callback",query:f,method:"post"}).then(a.hitch(this,function(b){d.resolve(b.data)}),a.hitch(this,function(b){console.error(b);d.reject(b)}))}else setTimeout(a.hitch(this,function(){d.reject("token is null.")}),
0);return d},deleteItem:function(b){this.updateCredential();var e=new h;this.isValidCredential()?(b=c.getDeleteItemUrl(this.portalUrl,this.username,b),l(b,{query:{token:this.credential.token,f:"json"},responseType:"json",method:"post"}).then(a.hitch(this,function(b){e.resolve(b.data)}),a.hitch(this,function(b){e.reject(b)}))):setTimeout(a.hitch(this,function(){e.reject("token is null.")}),0);return e},getItemById:function(b,e){this.updateCredential();var d=new h;e=c.getUserItemsUrl(this.portalUrl,
this.username,e);var f={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(f.query.token=this.credential.token);l(e+"/"+b,f).then(a.hitch(this,function(b){b=b.data;b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;b=new r(b);d.resolve(b)}),a.hitch(this,function(b){console.error(b);d.reject(b)}));return d},shareItem:function(b,e,d){this.updateCredential();var f=new h;this.isValidCredential()?(e=c.shareItemUrl(this.portalUrl,this.username,
e,d),d={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},b&&(b.content&&!b.query&&(b.query=b.content),d.query=a.mixin(d.query,b)),l(e,d).then(a.hitch(this,function(b){f.resolve(b.data)}),a.hitch(this,function(b){console.error(b);f.reject(b)}))):setTimeout(a.hitch(this,function(){f.reject("token is null.")}),0);return f},updateItem:function(b,e){this.updateCredential();var d=new h;this.isValidCredential()?this.portal.getItemById(b).then(a.hitch(this,
function(f){var p={f:"json",token:this.credential.token};e&&(p=a.mixin(p,e));f=c.getUpdateItemUrl(this.portalUrl,this.username,b,f.ownerFolder);l(f,{responseType:"json",callbackParamName:"callback",timeout:1E5,query:p,method:"post"}).then(a.hitch(this,function(b){d.resolve(b.data)}),a.hitch(this,function(b){console.error(b);d.reject(b)}))}),a.hitch(this,function(b){console.error(b);d.reject(b)})):setTimeout(a.hitch(this,function(){d.reject("token is null.")}),0);return d},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),q=n([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(b){b&&a.mixin(this,b)},_checkCredential:function(){var c=b.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(b){b.q="group:"+this.id+" AND "+b.q;return this.portal.queryItems(b)}}),r=n([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(b){b&&a.mixin(this,b);this.itemUrl=c.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&
this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=c.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=c.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var c=b.isValidCredential(this.credential);c||(this.credential=null);
return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)}}),w={portals:[],webMapQueryStr:" "+f.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+f.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(b){for(var a=0;a<this.portals.length;a++){var e=
this.portals[a];if(c.isSamePortalUrl(b,e.portalUrl))return e.updateCredential(),e}return null},getPortal:function(d){if(!d||"string"!==typeof d||!a.trim(d))return null;d=c.getStandardPortalUrl(d);var f=this._findPortal(d);f||(f=new e(d),f.credential=b.getPortalCredential(f.portalUrl),f.updateCredential(),this.portals.push(f));return f},getPortalSelfInfo:function(b){return this.getPortal(b).loadSelfInfo()},getBasemapGalleryGroup:function(b){return this._getPortalSelfGroup(b,"basemapGalleryGroupQuery")},
getTemplatesGroup:function(b){return this._getPortalSelfGroup(b,"templatesGroupQuery")},getUnits:function(b){var c="english",e="",d=new h;this.getPortal(b).getUser().then(a.hitch(this,function(b){b&&b.units?c=b.units:(e=k.locale,c=e.startWith("en")?"english":"metric");d.resolve(c)}),a.hitch(this,function(f){console.warn(f);this.getPortalSelfInfo(b).then(a.hitch(this,function(b){var c=null;b&&b.units?c=b.units:(e=b&&b.culture||k.locale,c=e.startWith("en")?"english":"metric");d.resolve(c)}),a.hitch(this,
function(b){console.warn(b);e=k.locale;c=e.startWith("en")?"english":"metric";d.resolve(c)}))}));return d.promise},_getPortalSelfGroup:function(b,c){var e=new h,d=this.getPortal(b);d||setTimeout(a.hitch(this,function(){e.reject()}),0);this.getPortalSelfInfo(b).then(a.hitch(this,function(b){d.queryGroups({f:"json",q:b[c]}).then(a.hitch(this,function(b){0<b.results.length?(b=b.results[0],b.portalUrl=d.portalUrl,b.credential=d.credential,b.portal=d,b=new q(b),e.resolve(b)):e.reject("Can't find portal self group.")}),
a.hitch(this,function(b){console.error(b);e.reject(b)}))}),a.hitch(this,function(b){console.error(b);e.reject(b)}));return e},getWebMapsFromBasemapGalleryGroup:function(b){var c=new h;this.getBasemapGalleryGroup(b).then(a.hitch(this,function(b){b?b.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(a.hitch(this,function(b){c.resolve(b)}),a.hitch(this,function(b){console.error(b);c.reject(b)})):c.reject()}),a.hitch(this,function(b){console.error(b);c.reject(b)}));return c},getDefaultWebScene:function(b){var c=
new h,e=this.getPortal(b);e.getUser().then(a.hitch(this,function(b){e.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+b.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(a.hitch(this,function(b){b=b.results;b=m.filter(b,a.hitch(this,function(b){return b.type&&"web scene"===b.type.toLowerCase()}));0<b.length?c.resolve(b[0].id):c.resolve(null)}),a.hitch(this,function(b){c.reject(b)}))}),a.hitch(this,function(){c.reject("not sign in")}));return c},getDefaultWebMap:function(b){var c=
new h;this.getPortalSelfInfo(b).then(a.hitch(this,function(e){var d=e.defaultBasemap&&e.defaultBasemap.id;d?c.resolve(d):this._getDefaultWebMapByBasemapGallery(b,e).then(a.hitch(this,function(e){e?c.resolve(e):this._getMostNumViewsWebMap(b).then(a.hitch(this,function(b){b?c.resolve(b):c.reject()}),a.hitch(this,function(b){console.error(b);c.reject(b)}))}),a.hitch(this,function(b){console.error(b);c.reject(b)}))}),a.hitch(this,function(b){console.error(b);c.reject(b)}));return c},_getDefaultWebMapByBasemapGallery:function(b,
c){var e=new h,d=this.getPortal(b),f=c.defaultBasemap&&c.defaultBasemap.title;d.queryGroups({f:"json",q:c.basemapGalleryGroupQuery}).then(a.hitch(this,function(b){b=b.results;0<b.length?d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+b[0].id+" AND title:"+f}).then(a.hitch(this,function(b){b=b.results;b=m.filter(b,a.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));0<b.length?e.resolve(b[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),
d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+f}).then(a.hitch(this,function(b){b=b.results;b=m.filter(b,a.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));if(0<b.length){var c=b[0];d.getItemData(c.id).then(a.hitch(this,function(b){b&&(b.operationalLayers||b.baseMap||b.version)?e.resolve(c.id):e.resolve(null)}),a.hitch(this,function(){e.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),e.resolve(null)}),a.hitch(this,
function(b){console.error(b);e.reject(b)})))}),a.hitch(this,function(b){console.error(b);e.reject(b)})):(console.log("Can't find group by basemapGalleryGroupQuery."),e.resolve(null))}),a.hitch(this,function(b){console.error(b);e.reject(b)}));return e},_getMostNumViewsWebMap:function(b){var c=new h;this.getPortal(b).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(a.hitch(this,function(b){b=b.results;b=m.filter(b,
a.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));0<b.length?c.resolve(b[0].id):c.reject("Can't find most-num-views web map.")}),a.hitch(this,function(b){console.error(b);c.reject(b)}));return c}};d.subscribe("userSignOut",function(b){(b=w._findPortal(b))&&b.clearCredentialAndUser()});return w})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(n,a,m,k){return{AddResourcesToItemForAppSave:function(h,
d,g,l){d=d||[];if(0===d.length){var f=new n;f.resolve(d);return f}d=d.map(function(c){var b=c.resUrl.split("resources/")[1],a=new n;c.b64?(c=k.b64toBlob(c.b64),a.resolve({blob:c,fileName:b.split("/")[1],prefixName:b.split("/")[0]})):(c=c.resUrl,0<c.indexOf("${itemId}")&&(c=c.replace("${itemId}",g)),k.resourcesUrlToBlob(c).then(function(c){a.resolve({blob:c,fileName:b.split("/")[1],prefixName:b.split("/")[0]},function(b){console.error(b.message||b);a.reject(b)})}));return a});return a(d).then(function(c){if(c instanceof
Array&&0<c.length)return c=c.map(function(b){var c=g;l&&(c=l);return m.addResource(h,c,b.blob,b.fileName,b.prefixName)}.bind(this)),a(c).then(function(b){return b})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(n,a,m,k,h,d,g,l,f){var c=null,b=n(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(b){this.rawAppConfig=
b},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var b=k.stringify(this.rawAppConfig.map);this.mapMd5=l(b)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var b=new m,c={};if(f.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return b.resolve(c),b;var a=this._getAppStateKey(),l=g.get(a);l&&l.appStateMd5===this._getAppStateMd5()?
(a=l.map&&l.map.extent,l=l.map&&l.map.layers,a&&(c.extent=new h(a.xmin,a.ymin,a.xmax,a.ymax,new d(a.spatialReference))),l&&(c.layers=l)):g.remove(a);b.resolve(c);return b},saveWabAppState:function(b,c){if(b&&!f.isInConfigOrPreviewWindow()){var e=this._getAppStateKey(),d={extent:{xmin:b.extent.xmin,xmax:b.extent.xmax,ymin:b.extent.ymin,ymax:b.extent.ymax,spatialReference:{wkid:b.extent.spatialReference.wkid,wkt:b.extent.spatialReference.wkt}},layers:{}};c&&c.traversalLayerInfosOfWebmap&&c.traversalLayerInfosOfWebmap(a.hitch(this,
function(b){d.layers[b.id]={visible:b.isShowInMap()}}));g.set(e,{map:d,appStateMd5:this._getAppStateMd5()})}}});b.getInstance=function(a){null===c&&(c=new b);c.urlParams=a;return c};return b})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p){var q=null,r;r=n([k],{constructor:function(b,e){this.own(h.subscribe("appConfigLoaded",
a.hitch(this,this._onAppConfigLoaded)));this.own(h.subscribe("appConfigChanged",a.hitch(this,this._onAppConfigChanged)));this.own(h.subscribe("sceneViewLoaded",a.hitch(this,this._onSceneViewLoaded)));this.own(h.subscribe("sceneViewChanged",a.hitch(this,this._onSceneViewChanged)));this.own(h.subscribe("beforeSceneViewDestory",a.hitch(this,this._onBeforeSceneViewDestroy)));this.own(h.subscribe("builder/actionTriggered",a.hitch(this,this._onActionTriggered)));this.own(h.subscribe("openWidget",a.hitch(this,
this._onOpenWidgetRequest)));this.own(d(window,"resize",c(a.hitch(this,this.resize),200)));this.id=e},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",mapDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},_onAppConfigLoaded:function(b){this.appConfig=a.clone(b);this._loadLayoutManager(this.appConfig).then(a.hitch(this,function(b){this.layoutManager=b;this.layoutManager.onEnter(this.appConfig,this.mapId).then(a.hitch(this,
function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(c){c=c.layoutDefinition?c.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";var e=new l;b([c],a.hitch(this,function(b){b=b.getInstance();this.sceneView&&b.setSceneView(this.sceneView);e.resolve(b)}));return e},_loadMap:function(){this.mapManager=e.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},
this.mapId);this.mapManager.showMap()},_onSceneViewLoaded:function(b){this.sceneView=b;this.layoutManager.setSceneView(b);this.layoutManager.loadAndLayout(this.appConfig)},_loadTheme:function(c){var e=new l;b(["themes/"+c.name+"/main"],a.hitch(this,function(){f([this._loadThemeCommonStyle(c),this._loadThemeCurrentStyle(c)]).then(a.hitch(this,function(){this._addCustomStyle(c);this.layoutManager.onThemeLoad();e.resolve()}))}));return e},_loadThemeCommonStyle:function(b){m.addClass(this.domNode,b.name);
return p.loadStyleLink(this._getThemeCommonStyleId(b),"themes/"+b.name+"/common.css")},_loadThemeCurrentStyle:function(b){m.addClass(this.domNode,b.styles[0]);return p.loadStyleLink(this._getThemeCurrentStyleId(b),"themes/"+b.name+"/styles/"+b.styles[0]+"/style.css")},_addCustomStyle:function(b){var c=a.getObject("customStyles",!1,b);if(c){var e=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(b=this._getFixedThemeStyles(b))&&(e+=b);e=a.replace(e,c,/\$\{([^\}]+)\}/g);
c=m.create("style",{type:"text/css"});try{c.appendChild(document.createTextNode(e))}catch(y){c.styleSheet.cssText=e}c.setAttribute("source","custom");document.head.appendChild(c)}},_getFixedThemeStyles:function(b){var c=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===b.name?c+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===b.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":
"BoxTheme"===b.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===b.name?c+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":
"DashboardTheme"===b.name?c+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===b.name&&(c+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return c},_onAppConfigChanged:function(b,c,e){b=a.clone(b);switch(c){case "themeChange":this._onThemeChange(b);break;case "styleChange":this._onStyleChange(b);break;case "layoutChange":this._onLayoutChange(b);break;case "widgetChange":this._onWidgetChange(b,e);break;case "groupChange":this._onGroupChange(b,
e);break;case "widgetPoolChange":this._onWidgetPoolChange(b,e);break;case "resetConfig":this._onResetConfig(b);break;case "loadingPageChange":this._onLoadingPageChange(b,e);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(b,e);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(b,e);break;case "onScreenOrderChange":this._onOnScreenOrderChange(b,e)}this.appConfig=b},_onSceneViewChanged:function(b){this.sceneView=b;this.layoutManager.setSceneView(b);this.layoutManager.loadAndLayout(this.appConfig)},
_onBeforeSceneViewDestroy:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onActionTriggered:function(b){this.layoutManager.onActionTriggered(b)},_onWidgetChange:function(b,c){this.layoutManager.onWidgetChange(b,c)},_onGroupChange:function(b,c){this.layoutManager.onGroupChange(b,c)},_onWidgetPoolChange:function(b,c){this.layoutManager.onWidgetPoolChange(b,c)},_onLayoutDefinitionChange:function(b,c){this.layoutManager.onLayoutDefinitionChange(b,c)},_onOnScreenGroupsChange:function(b,
c){this.layoutManager.onOnScreenGroupsChange(b,c)},_onOnScreenOrderChange:function(b,c){this.layoutManager.onOnScreenOrderChange(b,c)},_onThemeChange:function(b){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();f([this._loadLayoutManager(b),this._loadTheme(b.theme)]).then(a.hitch(this,function(c){var e=c[0];this.layoutManager.name!==e.name?(this.layoutManager.onLeave(),
e.onEnter(b,this.mapId).then(a.hitch(this,function(){this.layoutManager=e;this.layoutManager.loadAndLayout(b)}))):this.layoutManager.loadAndLayout(b)}))},_onResetConfig:function(b){var c=this.appConfig;h.publish("appConfigChanged",b,"mapChange",b);this.appConfig=c;this._loadLayoutManager(b).then(a.hitch(this,function(b){this.layoutManager=b;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},
_onLoadingPageChange:function(b,c){"backgroundColor"in c?m.setStyle(jimuConfig.loadingId,"background-color",b.loadingPage.backgroundColor):"backgroundImage"in c?(b=b.loadingPage.backgroundImage,b.visible&&b.uri?(m.setStyle(jimuConfig.loadingImageId,"background-image","url('"+b.uri+"')"),m.setStyle(jimuConfig.loadingImageId,"width",b.width+"px"),m.setStyle(jimuConfig.loadingImageId,"height",b.height+"px")):(m.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),m.setStyle(jimuConfig.loadingImageId,
"width","0px"),m.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in c&&(b=b.loadingPage.loadingGif,b.visible&&b.uri?(m.setStyle(jimuConfig.loadingGifId,"background-image","url('"+b.uri+"')"),m.setStyle(jimuConfig.loadingGifId,"width",b.width+"px"),m.setStyle(jimuConfig.loadingGifId,"height",b.height+"px")):(m.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),m.setStyle(jimuConfig.loadingGifId,"width","0px"),m.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(b){this._removeThemeCurrentStyle(this.appConfig.theme);
this._loadThemeCurrentStyle(b.theme);this._removeCustomStyle();this._addCustomStyle(b.theme)},_onLayoutChange:function(b){this.layoutManager.onLayoutChange(b)},_removeThemeCommonStyle:function(b){m.removeClass(this.domNode,b.name);m.destroy(this._getThemeCommonStyleId(b))},_removeThemeCurrentStyle:function(b){m.removeClass(this.domNode,b.styles[0]);m.destroy(this._getThemeCurrentStyleId(b))},_removeCustomStyle:function(){g('style[source\x3d"custom"]',document.head).forEach(function(b){m.destroy(b)})},
_getThemeCommonStyleId:function(b){return"theme_"+b.name+"_style_common"},_getThemeCurrentStyleId:function(b){return"theme_"+b.name+"_style_"+b.styles[0]},_doPostLoad:function(){b(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(b){this.layoutManager.openWidget(b)}});r.getInstance=function(b,c){null===q&&(q=new r(b,c),window._layoutManager=q);return q};return r})},"dojo/debounce":function(){define([],function(){return function(n,a){var m;return function(){m&&clearTimeout(m);var k=this,
h=arguments;m=setTimeout(function(){n.apply(k,h)},a)}}})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){var r=null,w=n(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,
constructor:function(b,c){this.appConfig=b.appConfig;this.urlParams=b.urlParams;this.id=this.mapDivId=c;this.appStateManager=e.getInstance(this.urlParams);h.subscribe("appConfigChanged",a.hitch(this,this.onAppConfigChanged));h.subscribe("changeMapPosition",a.hitch(this,this.onChangeMapPosition));h.subscribe("syncViewpoint",a.hitch(this,this.onSyncViewpoint));d(window,"resize",a.hitch(this,this.onWindowResize));d(window,"beforeunload",a.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},
_showMap:function(c){console.time("Load Map");this.loading=new b;this.loading.placeAt(this.mapDivId);this.loading.startup();c.map["3D"]?c.map.itemId?this._show3DWebScene(c):console.log("No webscene found. Please set map.itemId in config.json."):c.map.itemId?this._show2DWebMap(c):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),
this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(b){b&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(b){var c=a.clone(this.mapPosition);
a.mixin(c,b);this.setMapPosition(c)},setMapPosition:function(b){this.mapPosition=b;b=c.getPositionStyle(b);k.setStyle(this.mapDivId,b);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(b){this.sceneView&&(this.sceneView.viewpoint=b.clone())},_visitConfigMapLayers:function(b,c){m.forEach(b.map.basemaps,function(b,a){b.isOperationalLayer=!1;c(b,a)},this);m.forEach(b.map.operationallayers,function(b,a){b.isOperationalLayer=!0;c(b,
a)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(u){console.error(u)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(b){var c=b.map.portalUrl,e=b.map.itemId;this._destroySceneView();p.createMap(this.mapDivId,c,e).then(a.hitch(this,function(c){this._publishSceneViewEvent(c);if(b.map.mapOptions)if((c=b.map.mapOptions.initialState)&&c.viewpoint)try{var a=q.fromJSON(c.viewpoint);a&&(this.sceneView.map.initialViewProperties.viewpoint=a,this.sceneView.viewpoint=
a.clone())}catch(z){console.error(z)}else this.sceneView.map.initialViewProperties.viewpoint=this.sceneView.viewpoint}),a.hitch(this,function(){this.loading&&this.loading.destroy();h.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(b){window._sceneView=b;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?(this.sceneView=b,console.log("sceneView changed"),h.publish("sceneViewChanged",this.sceneView)):(this.sceneView=b,console.log("sceneView loaded"),h.publish("sceneViewLoaded",
this.sceneView))},_show2DWebMap:function(b){b.map.mapOptions||(b.map.mapOptions={});var e=this._processMapOptions(b.map.mapOptions)||{};e.isZoomSlider=!1;c.createWebMap(b.map.portalUrl,b.map.itemId,this.mapDivId,{mapOptions:e,bingMapsKey:b.bingMapsKey,usePopupManager:!0}).then(a.hitch(this,function(c){var a=c.map;a.hideZoomSlider();a.infoWindow.resize(270,316);a.itemId=b.map.itemId;a.itemInfo=c.itemInfo;a.webMapResponse=c;a.enableSnapping({snapKey:g.copyKey});k.setStyle(a.root,"zIndex",0);a._initialExtent=
a.extent;m.forEach("extent center marker find query scale level".split(" "),function(b){},this);this._publishMapEvent(a)}),a.hitch(this,function(){this.loading&&this.loading.destroy();h.publish("mapCreatedFailed")}))},_processMapOptions:function(b){if(b)return b.lods||delete b.lods,b.lods&&0===b.lods.length&&delete b.lods,b=a.clone(b),b.extent&&(b.extent=new l(b.extent)),b.center&&!a.isArrayLike(b.center)&&(b.center=new f(b.center)),b},onAppConfigChanged:function(b,c,a){this.appConfig=b;"mapChange"===
c?this._recreateMap(b):"mapOptionsChange"===c&&a.initialState&&(b=a.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=q.fromJSON(b),this.sceneView.animateTo(q.fromJSON(b)))},_recreateMap:function(b){this.sceneView&&(h.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());this._showMap(b)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});w.getInstance=function(b,c){null===r&&(r=new w(b,c));return r};return w})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare",
"dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(n,a,m,k,h){return n([a,m],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:k,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&h.setStyle(this.domNode,"display","none");h.setStyle(this.domNode,{width:"100%",height:"100%"});
this.showLoading||h.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(a){this.domNode&&this.hidden&&("string"===typeof a&&(this.textNode.innerHTML=a),h.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(h.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/has ./utils ./portalUtils ./portalUrlUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){return{createMap:function(c,e,d){var f=new n;b("esri-webgl")?f=this._createMap(c,e,d):(f.reject("The browser doesn't support webgl."),(c=a.getObject("webSceneLoader.webglSupportTip",!1,window.jimuNls))||(c="3D web apps aren't supported in your browser."),k.create("div",{"class":"app-error",innerHTML:c},document.body));return f},_createMap:function(b,d,u){e.getEsriConfig().portalUrl=q.getStandardPortalUrl(d);var r=new n,w=[];f._default=null;var k=new g({portalItem:new c({id:u})}),
x=new l({map:k,container:b,constraints:{collision:{enabled:!1},tilt:{max:179.99}}});w.push(x.when());d=p.getPortal(d);w.push(d.getItemById(u));w.push(d.getItemData(u));h(w).then(a.hitch(this,function(c){x.popup&&(x.popup.closeOnViewChangeEnabled=!0);k.id=b;k.itemId=u;k.itemInfo={item:c[1],itemData:c[2]};this._handleLocalScene(x);r.resolve(x)}),a.hitch(this,function(b){console.error(b);r.reject(b)}));return r},_handleLocalScene:function(b){try{b.viewingMode&&"local"===b.viewingMode.toLowerCase()&&
(a.setObject("constraints.collision.enabled",!1,b),a.setObject("constraints.tilt.max",179.99,b))}catch(w){console.error(w)}},_handleAttribution:function(b){try{if("4.0"!==d.version){var c=b.ui&&b.ui._components;c&&0<c.length&&m.some(c,function(b){return(b=b&&b._widget)&&"esri.widgets.Attribution"===b.declaredClass?(b.domNode.parentNode.style.width="100%",k.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},b.domNode),!0):!1})}}catch(u){console.error(u)}}}})},"esri/WebScene":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L,R,O,T,U,P,V,W,Q,Z){var X=x.getLogger("esri.WebScene"),aa=new Z.default(1,17);return function(c){function a(b){b=c.call(this)||this;b._handles=new r;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.presentation=new Q;b.initialViewProperties=new W;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=null;
b._isAuthoringAppSetByUser=!1;b._isAuthoringAppVersionSetByUser=!1;return b}m(a,c);a.prototype.initialize=function(){var b=this;this.when().catch(function(b){X.error("#load()","Failed to load web scene",b)});if(this.resourceInfo){var c=void 0;try{c=this._validateJSON(this.resourceInfo)}catch(ba){this.addResolvingPromise(A.reject(ba));return}this.read(c);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return b._scheduleLayersIdGC()}))};a.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};a.prototype.writeClippingArea=function(b,c){c.clippingArea||(c.clippingArea={});c.clippingArea.geometry=b.toJSON()};a.prototype.readClippingEnabled=function(b,c){return c.clippingArea?!!c.clippingArea.clip:!1};a.prototype.writeClippingEnabled=function(b,c){this.clippingArea&&(c.clippingArea||(c.clippingArea={}),c.clippingArea.clip=b)};a.prototype.writeLayers=function(b,
c,a,e){var f=this,p=d({},e,{layerContainerType:"operational-layers"});b=b.map(function(b){return f.verifyWriteLayer(b,e)?b.write(null,p):null}).filter(function(b){return!!b});c[a]=b.toArray()};a.prototype.verifyWriteLayer=function(b,c){return"write"in b?!0:(c&&c.messages&&c.messages.push(new q("layer:unsupported","Layers ("+b.title+", "+b.id+") of type '"+b.declaredClass+"' cannot be persisted in web scenes",{layer:b})),!1)};a.prototype.readSourceVersion=function(b,c){b=c.version.split(".");c=b[1];
return new Z.default(parseInt(b[0],10),parseInt(c,10))};a.prototype.writeSourceVersion=function(b,c,a){c[a]=aa.major+"."+aa.minor};Object.defineProperty(a.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(b){b?this._override("thumbnailUrl",b):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"authoringApp",{set:function(b){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",b)},
enumerable:!0,configurable:!0});a.prototype.writeAuthoringApp=function(b,c){c.authoringApp=b&&this._isAuthoringAppSetByUser?b:"ArcGIS API for JavaScript"};Object.defineProperty(a.prototype,"authoringAppVersion",{set:function(b){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",b)},enumerable:!0,configurable:!0});a.prototype.writeAuthoringAppVersion=function(b,c){c.authoringAppVersion=b&&this._isAuthoringAppVersionSetByUser?b:f.version};a.prototype.writeGround=function(b,c,a,
e){c[a]=b?b.write(null,e):{transparency:0,layers:[]}};a.prototype.readInitialViewProperties=function(c,a){c={};a.initialState&&a.initialState.environment&&(c.environment=V.fromJSON(a.initialState.environment));c.spatialReference=a.spatialReference?N.fromJSON(a.spatialReference):N.WebMercator;c.viewingMode=a.viewingMode||"global";a.initialState&&a.initialState.viewpoint&&(c.viewpoint=b.fromJSON(a.initialState.viewpoint));return new W(c)};a.prototype.writeInitialViewProperties=function(b,c,a,e){b&&
(a={},b.environment&&(a.environment=b.environment.write({},e)),b.viewpoint&&(a.viewpoint=b.viewpoint.write({},e)),0!==Object.keys(a).length&&(c.initialState=a),c.spatialReference=b.spatialReference?b.spatialReference.write({},e):N.WebMercator.toJSON(),c.viewingMode=null!=b.viewingMode?b.viewingMode:"global")};a.prototype.load=function(b){this.addResolvingPromise(this._loadFromSource());return this.when()};a.prototype.loadAll=function(){var b=this;return e.safeCast(t.default(this,function(c){var a=
b.presentation&&b.presentation.slides;c(b.ground,b.basemap,b.layers,a&&a.map(function(b){return b.basemap}))}))};a.prototype.read=function(b,c){var a=this;c=d({},c,{origin:"web-scene"});var e=this._isAuthoringAppVersionSetByUser,f=this._isAuthoringAppSetByUser,p=arguments;F.readLoadable(this,b,function(c){return a.inherited(p,[b,c])},c);f||(this._isAuthoringAppSetByUser=!1);e||(this._isAuthoringAppVersionSetByUser=!1);if(b.baseMap&&Array.isArray(b.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var e=
b.baseMap.elevationLayers.map(function(b){return{id:b.id}}),q=this.presentation.slides,g=function(b,c){return b.visibleLayers.some(function(b){return b.id===c})},l=e.filter(function(b){return!q.some(function(c){return g(c,b.id)})});q.forEach(function(b){b.visibleLayers.addMany(l)})}};a.prototype._writeBasemapElevationLayers=function(b){var c=b.ground&&b.ground.layers;!b.baseMap&&c&&c.length&&(b.baseMap={title:"Basemap",baseMapLayers:[]});b.baseMap&&(b.baseMap.elevationLayers=v.clone(c))};a.prototype.write=
function(b,c){if("loaded"!==this.loadStatus){var a=new q("webscene:not-loaded","Web scene must be loaded before it can be serialized");X.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw a;}this._runLayersIdGC();c=d({},c,{origin:"web-scene"});a=this.inherited(arguments,[b,c]);this._writeBasemapElevationLayers(a);return a};a.prototype.save=function(b){return l(this,void 0,void 0,function(){var c,a,e;return g(this,function(d){switch(d.label){case 0:if(this.portalItem)return[3,
2];X.error("save(): requires the .portalItem property to be set");return[4,A.reject(new q("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:d.sent(),d.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,A.reject(new q("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:d.sent(),d.label=4;case 4:return c=this._updateFromPromise,[4,this.load()];case 5:return d.sent(),[4,this._loadObjectsWithLayers()];
case 6:return d.sent(),a=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&E.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||M.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),e=this.write(null,a),[4,this._verifySave(e,a,b)];case 7:return d.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:e})];case 8:return d.sent(),G.updateOrigins(a),c?[4,c]:[3,10];case 9:d.sent(),d.label=10;case 10:return[4,
this._saveThumbnail()];case 11:return d.sent(),[2,this.portalItem]}})})};a.prototype.saveAs=function(b,c){return l(this,void 0,void 0,function(){var a,e,d,f,p;return g(this,function(g){switch(g.label){case 0:if(b)return[3,2];X.error("saveAs(portalItem): requires a portal item parameter");return[4,A.reject(new q("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:g.sent(),g.label=2;case 2:return b.id&&(b=b.clone(),b.id=null),a=b.portal||M.getDefault(),[4,this.load()];
case 3:return g.sent(),[4,this._loadObjectsWithLayers()];case 4:return g.sent(),e=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:a,writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,e),[4,this._verifySaveAs(d,e,c)];case 5:return g.sent(),[4,a._signIn()];case 6:return g.sent(),f=this.thumbnailUrl,p=!this._isOverridden("thumbnailUrl"),b.type="Web Scene",b.portal=a,this._updateTypeKeywords(b),[4,a.user.addItem({item:b,folder:c&&c.folder,data:d})];case 7:return g.sent(),
this.portalItem=b,u.JSONSupport.prototype.read.call(this,{version:d.version,authoringApp:d.authoringApp,authoringAppVersion:d.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:b.itemUrl&&E.urlToObject(b.itemUrl)}),G.updateOrigins(e),f&&(this.thumbnailUrl=p?E.addQueryParameter(f,"w","8192"):f),[4,this._saveThumbnail()];case 8:return g.sent(),[2,b]}})})};a.prototype._saveThumbnail=function(){return l(this,void 0,void 0,function(){return g(this,function(b){switch(b.label){case 0:return this._isOverridden("thumbnailUrl")?
[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:b.sent(),this._clearOverride("thumbnailUrl"),b.label=2;case 2:return[2]}})})};a.prototype._verifySave=function(b,c,a,e){void 0===e&&(e=!1);var d=c.messages.filter(function(b){return"error"===b.type}).map(function(b){return new q(b.name,b.message,b.details)});c.blockedRelativeUrls&&(d=d.concat(c.blockedRelativeUrls.map(function(b){return new q("url:unsupported","Relative url '"+b+"' is not supported in Web Scene")})));
a&&a.ignoreUnsupported&&(d=d.filter(function(b){return"layer:unsupported"!==b.name&&"symbol:unsupported"!==b.name&&"symbol-layer:unsupported"!==b.name&&"property:unsupported"!==b.name&&"url:unsupported"!==b.name}));a&&a.strictSchemaValidationEnabled||(d=d.filter(function(b){return"web-document-write:property-required"!==b.name}));var f=a&&a.strictSchemaValidationEnabled;return(f?A.create(function(b){return n(["./webscene/validator"],b)}).then(function(c){c=c.validate(b);if(0<c.length){var a="webscene did not validate:\n"+
c.join("\n");X.error((e?"saveAs":"save")+"(): "+a)}return c.map(function(b){return new q("webscene:schema-validation",b)})}).then(function(b){return f&&0<b.length?(b=R.createSchemaValidationError(b.concat(d)),A.reject(b)):d}):A.resolve(d)).then(function(b){if(0<b.length)return A.reject(new q("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:b}))})};a.prototype._verifySaveAs=function(b,c,a){return this.canSaveAs(c)?
A.reject(R.createCopyError()):this._verifySave(b,c,a,!0)};a.prototype.verifySaveAs=function(b){var c=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),a=this.write(null,c);return this._verifySaveAs(a,c,b)};a.prototype.canSaveAs=function(b){b||(b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,b));return b.verifyItemRelativeUrls&&0<b.verifyItemRelativeUrls.writtenUrls.length};a.prototype.updateFrom=function(b,c){void 0===c&&(c={});return l(this,
void 0,void 0,function(){var a,e;return g(this,function(d){switch(d.label){case 0:return this._updateFromPromise=a=this._updateFromInternal(b,c),[4,a];case 1:d.sent();if(e=this._updateFromPromise===a)this._updateFromPromise=null;return[2]}})})};a.prototype._updateFromInternal=function(b,c){void 0===c&&(c={});return l(this,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return[4,b.whenReady()];case 1:return a.sent(),!c.environmentExcluded&&b.environment&&(this.initialViewProperties.environment=
V.prototype.clone.apply(b.environment)),!c.viewpointExcluded&&b.viewpoint&&(this.initialViewProperties.viewpoint=b.viewpoint.clone()),this.initialViewProperties.spatialReference=b.spatialReference.clone(),this.initialViewProperties.viewingMode=b.viewingMode,b.clippingArea?b.clippingArea!==this.clippingArea&&(this.clippingArea=b.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,b.heightModelInfo&&(this.heightModelInfo=b.heightModelInfo.clone()),b.map===this&&b.allLayerViews.forEach(function(b){b.layer.visible=
b.visible}),!1===c.thumbnailExcluded||null==c.thumbnailExcluded&&!c.viewpointExcluded?[4,this._updateFromThumbnail(b,c.thumbnailSize||void 0)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}})})};a.prototype._updateFromThumbnail=function(b,c){return l(this,void 0,void 0,function(){var a,e;return g(this,function(d){switch(d.label){case 0:return a=U.getOptimalThumbnailSize(b,c),[4,b.takeScreenshot({format:"jpg",width:a.width,height:a.height,disableSlice:!0})];case 1:return e=d.sent(),this.thumbnailUrl=
e.dataUrl,[2]}})})};a.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};a.prototype._readAndLoadFromJSON=function(b,c){b=this._validateJSON(b);this.read(b,c);return this._loadFromJSON(b,c)};a.prototype._extractOperationalLayers=function(b){var c=this,a=[];if(!this.sourceVersion.supportsGround&&b.baseMap&&Array.isArray(b.baseMap.elevationLayers))for(var e=
0,d=b.baseMap.elevationLayers;e<d.length;e++)a.push(d[e]);var f=[],p=function(b){b.layers&&(b.layers=b.layers.filter(p));return"ArcGISTiledElevationServiceLayer"===b.layerType?(c.sourceVersion.supportsGround||f.push(b),!1):!0};return{operationalLayers:b.operationalLayers?b.operationalLayers.filter(p):[],operationalElevationLayers:f,basemapElevationLayers:a}};a.prototype._loadFromJSON=function(b,c){var a=this,f=new p;return this._validateSpatialReference().then(function(){return a._validateHeightModelInfo()}).then(function(){return A.create(function(b){return n(["./portal/support/layersCreator"],
b)})}).then(function(p){var q=a._extractOperationalLayers(b),g=q.operationalLayers,l=q.operationalElevationLayers,q=q.basemapElevationLayers,r=[],h={context:d({},c,{layerContainerType:"operational-layers"})};a.portalItem&&(h.context.portal=a.portalItem.portal||M.getDefault());if(0<q.length){var w=d({},h,{context:d({},h.context,{layerContainerType:"ground"})});w.defaultLayerType="ArcGISTiledElevationServiceLayer";r.push(e.safeCast(p.populateOperationalLayers(a.ground.layers,q,w)))}0<l.length&&(w=d({},
h,{context:d({},h.context,{layerContainerType:"ground"})}),w.defaultLayerType="ArcGISTiledElevationServiceLayer",r.push(e.safeCast(p.populateOperationalLayers(f,l,w))));g&&0<g.length&&r.push(e.safeCast(p.populateOperationalLayers(a.layers,g,h)));return A.eachAlways(r).then(function(){})}).then(function(){return a._loadObjectsWithLayers()}).then(function(){a.ground.layers.addMany(f)})};a.prototype._loadObjectsWithLayers=function(){var b=[];this.ground&&b.push(this.ground.load());this.basemap&&b.push(this.basemap.load());
this.presentation.slides.forEach(function(c){c.basemap&&b.push(c.basemap.load())});return A.eachAlways(b).then(function(){})};a.prototype._loadFromItem=function(b){var c=this;return b.load().catch(function(b){throw new q("webscene:load-portal-item","Failed to load portal item",{error:b});}).then(function(){if("Web Scene"!==b.type)throw new q("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:b.type});}).then(function(){return b.fetchData()}).then(function(a){c.resourceInfo=
a;return c._readAndLoadFromJSON(a,{origin:"web-scene",url:E.urlToObject(b.itemUrl),portal:b.portal||M.getDefault()})})};a.prototype._validateSpatialReference=function(){var b=this.initialViewProperties,c=this._sceneSpatialReference,a;if("local"!==b.viewingMode){if(!T.isSpatialReferenceSupported(c,"global"))return A.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",
{spatialReference:c,viewingMode:b.viewingMode}));a=function(b){return!b||O.canProject(b,c)}}else{if(!T.isSpatialReferenceSupported(c,"local"))return A.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:c,viewingMode:b.viewingMode}));a=function(b){return!b||b.equals(c)}}var e=function(b){return b&&(b.camera&&b.camera.position&&b.camera.position.spatialReference||
b.targetGeometry&&b.targetGeometry.spatialReference)},d=e(b.viewpoint);return d&&!a(d)?A.reject(new q("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:d,sceneSpatialReference:c,viewingMode:b.viewingMode})):(d=this.presentation.slides.find(function(b){return!a(e(b.viewpoint))}))?(d=e(d.viewpoint),A.reject(new q("webscene:incompatible-slide-spatial-reference",
"Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:d,sceneSpatialReference:c,viewingMode:b.viewingMode}))):A.resolve()};a.prototype._validateHeightModelInfo=function(){var b=I.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return b?A.reject(b):A.resolve()};a.prototype._validateJSON=function(b){var c=Z.default.parse(b.version||"","webscene");aa.validate(c);b.version=
c.major+"."+c.minor;1===c.major&&2>=c.minor&&(b.spatialReference=N.WebMercator.toJSON());return b};a.prototype._updateTypeKeywords=function(b){"local"===this.initialViewProperties.viewingMode?b.typeKeywords?-1===b.typeKeywords.indexOf("ViewingMode-Local")&&b.typeKeywords.push("ViewingMode-Local"):b.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&b.typeKeywords&&(b.typeKeywords=b.typeKeywords.filter(function(b){return"ViewingMode-Local"!==b}));b.typeKeywords&&
(b.typeKeywords=b.typeKeywords.filter(function(b,c,a){return a.indexOf(b)===c}))};Object.defineProperty(a.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||N.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?E.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});a.prototype._enableVerifyItemRelativeUrls=
function(b){var c=this._verifyItemRelativeRootPath;c&&(b.verifyItemRelativeUrls={rootPath:c,writtenUrls:[]});return b};a.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};a.prototype._scheduleLayersIdGC=function(){var b=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){b._layersIdGCTimeoutId=0;b._runLayersIdGC()},3E3)};a.prototype._runLayersIdGC=function(){var b=this;this._unscheduleLayersIdGC();
var c=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,a=function(c){return!!b.allLayers.find(function(b){return b.id===c})};c&&c.layers&&(c.layers=c.layers.filter(function(b){return a(b.id)}));(c=this.presentation&&this.presentation.slides)&&c.forEach(function(b){b.visibleLayers&&(b.visibleLayers=b.visibleLayers.filter(function(b){return a(b.id)}))})};a.fromJSON=function(b){if(!b)throw new q("webscene:empty-resource","Expected a JSON resource but got nothing");
return new this({resourceInfo:b})};a.VERSION=aa;k([B.property({type:P,json:{write:!0}})],a.prototype,"applicationProperties",void 0);k([B.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],a.prototype,"basemap",void 0);k([B.property({type:K,json:{read:{source:"clippingArea.geometry",reader:J.fromJSON},write:{target:"clippingArea.geometry"}}})],a.prototype,"clippingArea",void 0);k([B.writer("clippingArea")],a.prototype,"writeClippingArea",null);k([B.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],
a.prototype,"clippingEnabled",void 0);k([B.reader("clippingEnabled",["clippingArea"])],a.prototype,"readClippingEnabled",null);k([B.writer("clippingEnabled")],a.prototype,"writeClippingEnabled",null);k([B.property({type:H,json:{write:!0}})],a.prototype,"heightModelInfo",void 0);k([B.property({json:{write:{target:"operationalLayers"}}})],a.prototype,"layers",void 0);k([B.writer("layers")],a.prototype,"writeLayers",null);k([B.property({readOnly:!0,type:Z.default,json:{type:String,write:{allowNull:!0,
target:"version",isRequired:!0}}})],a.prototype,"sourceVersion",void 0);k([B.reader("sourceVersion",["version"])],a.prototype,"readSourceVersion",null);k([B.writer("sourceVersion")],a.prototype,"writeSourceVersion",null);k([B.property({dependsOn:["portalItem.thumbnailUrl"]})],a.prototype,"thumbnailUrl",null);k([B.property({type:String,json:{write:{allowNull:!0}}})],a.prototype,"authoringApp",null);k([B.writer("authoringApp")],a.prototype,"writeAuthoringApp",null);k([B.property({type:String,json:{write:{allowNull:!0}}})],
a.prototype,"authoringAppVersion",null);k([B.writer("authoringAppVersion")],a.prototype,"writeAuthoringAppVersion",null);k([B.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],a.prototype,"ground",void 0);k([B.writer("ground")],a.prototype,"writeGround",null);k([B.property({type:Q,nonNullable:!0,json:{write:function(b,c,a,e){b.slides&&0<b.slides.length&&(a=d({},e,{isPresentation:!0}),c.presentation=b.write(null,a))}}})],a.prototype,"presentation",void 0);k([B.property({type:W,nonNullable:!0,
json:{default:function(){return new W({viewingMode:"global",spatialReference:N.WebMercator})}}})],a.prototype,"initialViewProperties",void 0);k([B.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],a.prototype,"readInitialViewProperties",null);k([B.writer("initialViewProperties",{"initialState.environment":{type:V},spatialReference:{type:N},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],a.prototype,"writeInitialViewProperties",
null);k([B.property({type:L})],a.prototype,"portalItem",void 0);k([B.property()],a.prototype,"resourceInfo",void 0);k([h(0,B.cast(L))],a.prototype,"saveAs",null);k([B.property()],a.prototype,"_sceneSpatialReference",null);k([B.property()],a.prototype,"_verifyItemRelativeRootPath",null);return a=k([B.subclass("esri.WebScene")],a)}(B.declared(y.LoadableMixin(z.EsriPromiseMixin(u.JSONSupportMixin(c)))))})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(function(a){var d=a.target;a.newOrigin&&a.oldOrigin!==a.newOrigin&&m.isMultiOriginJSONMixin(d)&&d.updateOrigin(a.propName,a.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.createCopyError=function(){return new m("webscene:failed-to-copy-embedded-resources",
"Copying of embedded resources is currently not supported")};a.isCopyError=function(a){return a&&"webscene:failed-to-copy-embedded-resources"===a.name};a.createSchemaValidationError=function(a){return new m("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:a})};a.isSchemaValidationError=function(a){return a&&"webscene:schema-validation"===a.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(b,c,a,e){2===b.length?(X[0]=b[0],X[1]=b[1],X[2]=0,b=X):b===a&&(g.vec3.copy(X,b),b=X);return w(b,c,0,a,e,0,1)}function w(b,c,a,e,d,f,p){void 0===p&&(p=1);c=F(c,d,P).projector;if(k.isNone(c))return!1;if(c===v){if(b===e&&a===f)return!0;for(c=a+3*p;a<c;a++,f++)e[f]=b[a];return!0}for(p=a+3*p;a<p;a+=3,f+=3)c(b,a,e,f);return!0}function u(b,c){if(c.spatialReference===b)return c.spatialReferenceId;c.spatialReference=b;"metersPerUnit"in c&&(c.metersPerUnit=h.getMetersPerUnitForSR(b,
1));return b.wkt===a.SphericalECEFSpatialReference.wkt?c.spatialReferenceId=1:b.isWGS84?c.spatialReferenceId=2:b.isWebMercator?c.spatialReferenceId=3:b.wkt===a.WGS84ECEFSpatialReference.wkt?c.spatialReferenceId=4:4490===b.wkid?c.spatialReferenceId=5:c.spatialReferenceId=0}function v(b,c,a,e){a[e++]=b[c++];a[e++]=b[c++];a[e]=b[c]}function y(b,c,a,e){a[e++]=Q*(b[c++]/p.earthRadius);a[e++]=Q*(Math.PI/2-2*Math.atan(Math.exp(-1*b[c++]/p.earthRadius)));a[e]=b[c]}function t(b,c,a,e){var d=.4999999*Math.PI,
d=m.clamp(W*b[c+1],-d,d),d=Math.sin(d);a[e++]=W*b[c]*p.earthRadius;a[e++]=p.halfEarthRadius*Math.log((1+d)/(1-d));a[e]=b[c+2]}function x(b,c,a){c=u(c,T);c=O[c][6];if(k.isNone(c))return!1;c(b,0,X,0);a!==X&&(a[0]=X[0],a[1]=X[1],2<a.length&&(a[2]=X[2]));return!0}function z(b,c){X[0]=b.x;X[1]=b.y;X[2]=b.hasZ?b.z:0;return x(X,b.spatialReference,c)}function A(b,c,a,e){var d=p.earthRadius+b[c+2],f=W*b[c+1];b=W*b[c];c=Math.cos(f);a[e++]=Math.cos(b)*c*d;a[e++]=Math.sin(b)*c*d;a[e]=Math.sin(f)*d}function E(b,
c,a,e){var d=q.Vec3Compact.length(b,c),f=m.asinClamped(b[c+2]/(0===d?1:d)),g=Math.cos(f)*d;b=(0<b[c+1]?1:-1)*m.acosClamped(b[c]/(0===g?1:g));a[e++]=Q*b;a[e++]=Q*f;a[e]=d-p.earthRadius}function B(b,c,a,e){var d=Z,f=W*b[c],p=W*b[c+1];b=b[c+2];c=Math.sin(p);var p=Math.cos(p),q=d.a/Math.sqrt(1-d.e2*c*c);a[e++]=(q+b)*p*Math.cos(f);a[e++]=(q+b)*p*Math.sin(f);a[e++]=(q*(1-d.e2)+b)*c}function G(b,c,a,e){var d=Z,f=b[c],p=b[c+1];b=b[c+2];var q,g,l,r,h,w;c=Math.abs(b);q=f*f+p*p;g=Math.sqrt(q);l=q+b*b;r=Math.sqrt(l);
f=Math.atan2(p,f);h=b*b/l;l=q/l;p=d.a2/r;q=d.a3-d.a4/r;.3<l?(h=c/r*(1+l*(d.a1+p+h*q)/r),r=Math.asin(h),p=h*h,l=Math.sqrt(1-p)):(l=g/r*(1-h*(d.a5-p-l*q)/r),r=Math.acos(l),p=1-l*l,h=Math.sqrt(p));w=1-d.e2*p;p=d.a/Math.sqrt(w);d=d.a6*p;p=g-p*l;q=c-d*h;c=l*p+h*q;g=l*q-h*p;d=g/(d/w+c);r+=d;0>b&&(r=-r);a[e++]=Q*f;a[e++]=Q*r;a[e]=c+g*d/2}function F(b,c,a){if(a.source.spatialReference===b&&a.dest.spatialReference===c)return a;var e=u(b,a.source),d=u(c,a.dest);0===e&&0===d?b.equals(c)?a.projector=v:a.projector=
null:a.projector=O[e][d];return a}Object.defineProperty(a,"__esModule",{value:!0});var K,H,N,I,J,M,L,R;a.SphericalECEFSpatialReference=new c({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});a.WGS84ECEFSpatialReference=new c({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});
a.canProject=function(b,c){return!!F(b,c,P).projector};a.vectorToVector=r;a.pointToPoint=function(b,c,a,e){void 0===a&&(a=c.spatialReference);void 0===e&&(e=0);X[0]=b.x;X[1]=b.y;var d=b.z;X[2]=void 0!==d?d:e;if(!w(X,b.spatialReference,0,X,a,0,1))return!1;c.x=X[0];c.y=X[1];c.spatialReference=a;void 0!==d?(c.z=X[2],c.hasZ=!0):(c.z=void 0,c.hasZ=!1);return!0};a.pointToVector=function(b,c,a,e){void 0===e&&(e=0);X[0]=b.x;X[1]=b.y;var d=b.z;X[2]=void 0!==d?d:e;return w(X,b.spatialReference,0,c,a,0,1)};
a.vectorToPoint=function(b,c,a,d){a instanceof f?d=d||a.spatialReference:e.isPoint(a)?(a.hasZ=!0,d=d||a.spatialReference):(d=a,a=new f({spatialReference:d}));return w(b,c,0,X,d,0,1)?(a.x=X[0],a.y=X[1],a.z=X[2],a.spatialReference=d,a):null};a.xyzToVector=function(b,c,a,e,d,f){X[0]=b;X[1]=c;X[2]=a;return w(X,e,0,d,f,0,1)};a.bufferToBuffer=w;a.computeLinearTransformation=function(b,c,a,e){var f=u(b,T),p=u(e,U);if(f===p&&1!==p&&(0!==f||b.equals(e)))return d.mat4.identity(a),d.mat4.translate(a,a,c),!0;
if(1===p){b=O[f][6];p=O[6][p];if(k.isNone(b)||k.isNone(p))return!1;b(c,0,aa,0);p(aa,0,da,0);b=W*aa[0];p=W*aa[1];c=Math.sin(b);b=Math.cos(b);e=Math.sin(p);p=Math.cos(p);a[0]=-c;a[4]=-e*b;a[8]=p*b;a[12]=da[0];a[1]=b;a[5]=-e*c;a[9]=p*c;a[13]=da[1];a[2]=0;a[6]=p;a[10]=e;a[14]=da[2];a[3]=0;a[7]=0;a[11]=0;a[15]=1;return!0}if(3===p&&(2===f||1===f)){b=O[f][6];p=O[6][3];if(k.isNone(b)||k.isNone(p))return!1;b(c,0,aa,0);c=W*aa[1];p(aa,0,da,0);d.mat4.identity(a);d.mat4.translate(a,a,da);c=1/Math.cos(c);d.mat4.scale(a,
a,[c,c,1]);return!0}return!1};a.transformDirection=function(b,c,a,e,d){g.vec3.copy(ga,b);g.vec3.add(ca,b,c);r(ga,a,ga,d);r(ca,a,ca,d);g.vec3.subtract(e,ca,ga);g.vec3.normalize(e,e)};a.mbsToMbs=function(b,c,a,e){c=F(c,e,V);if(c.projector===v)return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],!0;if(k.isNone(c.projector))return!1;e=c.source;var d=c.dest;if(3===d.spatialReferenceId){c=O[e.spatialReferenceId][2];if(k.isNone(c))return!1;c(b,0,aa,0);c=Math.abs(W*aa[1])+Math.asin(b[3]/(p.earthRadius+b[2]));t(aa,
0,a,0);a[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*b[3];return!0}c.projector(b,0,a,0);a[3]=b[3]*e.metersPerUnit/d.metersPerUnit;return!0};a.extentToBoundingBox=function(b,c,a){if(null==b)return!1;var e;X[0]=null!=b.xmin?b.xmin:0;X[1]=null!=b.ymin?b.ymin:0;X[2]=null!=b.zmin?b.zmin:0;e=w(X,b.spatialReference,0,c,a,0,1);X[0]=null!=b.xmax?b.xmax:0;X[1]=null!=b.ymax?b.ymax:0;X[2]=null!=b.zmax?b.zmax:0;e=e&&w(X,b.spatialReference,0,c,a,3,1);null==b.xmin&&(c[0]=-Infinity);null==b.ymin&&(c[1]=-Infinity);
null==b.zmin&&(c[2]=-Infinity);null==b.xmax&&(c[3]=Infinity);null==b.ymax&&(c[4]=Infinity);null==b.zmax&&(c[5]=Infinity);return e};a.extentToBoundingRect=function(b,c,a){if(null==b)return!1;var e;X[0]=null!=b.xmin?b.xmin:0;X[1]=null!=b.ymin?b.ymin:0;X[2]=null!=b.zmin?b.zmin:0;e=w(X,b.spatialReference,0,X,a,0,1);c[0]=X[0];c[1]=X[1];X[0]=null!=b.xmax?b.xmax:0;X[1]=null!=b.ymax?b.ymax:0;X[2]=null!=b.zmax?b.zmax:0;e=e&&w(X,b.spatialReference,0,X,a,0,1);c[2]=X[0];c[3]=X[1];null==b.xmin&&(c[0]=-Infinity);
null==b.ymin&&(c[1]=-Infinity);null==b.xmax&&(c[2]=Infinity);null==b.ymax&&(c[3]=Infinity);return e};a.boundingRectToBoundingRect=function(c,a,e,d){if(null==c)return!1;if(a.equals(d))return b.set(e,c),!0;var f;X[0]=c[0];X[1]=c[1];X[2]=0;f=w(X,a,0,X,d,0,1);e[0]=X[0];e[1]=X[1];X[0]=c[2];X[1]=c[3];X[2]=0;f=f&&w(X,a,0,X,d,0,1);e[2]=X[0];e[3]=X[1];return f};(function(b){b.x2lon=function(b){return b/p.earthRadius};b.y2lat=function(b){return Math.PI/2-2*Math.atan(Math.exp(-1*b/p.earthRadius))};b.lon2x=function(b){return b*
p.earthRadius};b.lat2y=function(b){b=Math.sin(b);return p.earthRadius/2*Math.log((1+b)/(1-b))}})(a.webMercator||(a.webMercator={}));a.canProjectToWGS84ComparableLonLat=function(b){b=u(b,T);return!!O[b][6]};a.vectorToWGS84ComparableLonLat=x;a.pointToWGS84ComparableLonLat=z;a.pointToWGS84ComparableLonLatPoint=function(b,c){var a=u(c.spatialReference,U);return k.isNone(O[6][a])?!1:z(b,X)?(c.x=X[0],c.y=X[1],c.z=X[2],!0):!1};a.wgs84ComparableLonLatToECEF=function(b,c,a,e){void 0===e&&(e=0);e=p.earthRadius+
e;var d=Math.cos(a);b[0]=Math.cos(c)*d*e;b[1]=Math.sin(c)*d*e;b[2]=Math.sin(a)*e};var O=(K={},K[2]=(H={},H[5]=null,H[6]=v,H[1]=A,H[0]=null,H[3]=t,H[2]=v,H[4]=B,H),K[5]=(N={},N[5]=v,N[6]=v,N[1]=A,N[0]=null,N[3]=null,N[2]=null,N[4]=B,N),K[3]=(I={},I[5]=null,I[6]=y,I[1]=function(b,c,a,e){y(b,c,a,e);A(a,e,a,e)},I[0]=null,I[3]=v,I[2]=y,I[4]=function(b,c,a,e){y(b,c,a,e);B(a,e,a,e)},I),K[4]=(J={},J[5]=G,J[6]=G,J[1]=function(b,c,a,e){G(b,c,a,e);A(a,e,a,e)},J[0]=null,J[3]=function(b,c,a,e){G(b,c,a,e);t(a,
e,a,e)},J[2]=G,J[4]=v,J),K[1]=(M={},M[5]=E,M[6]=E,M[1]=v,M[0]=null,M[3]=function(b,c,a,e){E(b,c,a,e);t(a,e,a,e)},M[2]=E,M[4]=function(b,c,a,e){E(b,c,a,e);B(a,e,a,e)},M),K[0]=(L={},L[5]=null,L[6]=null,L[1]=null,L[0]=v,L[3]=null,L[2]=null,L[4]=null,L),K[6]=(R={},R[5]=null,R[6]=v,R[1]=A,R[0]=null,R[3]=null,R[2]=v,R[4]=B,R),K),T={spatialReference:null,spatialReferenceId:0},U={spatialReference:null,spatialReferenceId:0},P={source:{spatialReference:null,spatialReferenceId:0},dest:{spatialReference:null,
spatialReferenceId:0},projector:v},V={source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:v},W=m.deg2rad(1),Q=m.rad2deg(1),Z={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},X=l.vec3f64.create(),aa=l.vec3f64.create(),da=l.vec3f64.create(),ga=l.vec3f64.create(),ca=l.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require",
"exports","./math/mat4"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat4=m})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(n,a,m,k){function h(c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c}function d(c,b,a){var e=b[0],d=b[1],f=b[2],g=b[3],l=b[4],h=b[5],k=b[6],t=b[7],x=b[8],m=b[9],A=b[10],n=b[11],B=b[12],G=b[13],F=b[14];
b=b[15];var K=a[0],H=a[1],N=a[2],I=a[3];c[0]=K*e+H*l+N*x+I*B;c[1]=K*d+H*h+N*m+I*G;c[2]=K*f+H*k+N*A+I*F;c[3]=K*g+H*t+N*n+I*b;K=a[4];H=a[5];N=a[6];I=a[7];c[4]=K*e+H*l+N*x+I*B;c[5]=K*d+H*h+N*m+I*G;c[6]=K*f+H*k+N*A+I*F;c[7]=K*g+H*t+N*n+I*b;K=a[8];H=a[9];N=a[10];I=a[11];c[8]=K*e+H*l+N*x+I*B;c[9]=K*d+H*h+N*m+I*G;c[10]=K*f+H*k+N*A+I*F;c[11]=K*g+H*t+N*n+I*b;K=a[12];H=a[13];N=a[14];I=a[15];c[12]=K*e+H*l+N*x+I*B;c[13]=K*d+H*h+N*m+I*G;c[14]=K*f+H*k+N*A+I*F;c[15]=K*g+H*t+N*n+I*b;return c}function g(c,b,a){var e=
b[0],d=b[1],f=b[2],g=b[3],l=e+e,h=d+d,k=f+f;b=e*l;var t=e*h,e=e*k,x=d*h,d=d*k,f=f*k,l=g*l,h=g*h,g=g*k;c[0]=1-(x+f);c[1]=t+g;c[2]=e-h;c[3]=0;c[4]=t-g;c[5]=1-(b+f);c[6]=d+l;c[7]=0;c[8]=e+h;c[9]=d-l;c[10]=1-(b+x);c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c}function l(c,b,a){c[0]=b[0]-a[0];c[1]=b[1]-a[1];c[2]=b[2]-a[2];c[3]=b[3]-a[3];c[4]=b[4]-a[4];c[5]=b[5]-a[5];c[6]=b[6]-a[6];c[7]=b[7]-a[7];c[8]=b[8]-a[8];c[9]=b[9]-a[9];c[10]=b[10]-a[10];c[11]=b[11]-a[11];c[12]=b[12]-a[12];c[13]=b[13]-
a[13];c[14]=b[14]-a[14];c[15]=b[15]-a[15];return c}Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];c[9]=b[9];c[10]=b[10];c[11]=b[11];c[12]=b[12];c[13]=b[13];c[14]=b[14];c[15]=b[15];return c};a.set=function(c,b,a,d,f,g,l,h,k,m,t,x,z,A,n,B,G){c[0]=b;c[1]=a;c[2]=d;c[3]=f;c[4]=g;c[5]=l;c[6]=h;c[7]=k;c[8]=m;c[9]=t;c[10]=x;c[11]=z;c[12]=A;c[13]=n;c[14]=B;c[15]=G;return c};a.identity=h;a.transpose=
function(c,b){if(c===b){var a=b[1],d=b[2],f=b[3],g=b[6],l=b[7],h=b[11];c[1]=b[4];c[2]=b[8];c[3]=b[12];c[4]=a;c[6]=b[9];c[7]=b[13];c[8]=d;c[9]=g;c[11]=b[14];c[12]=f;c[13]=l;c[14]=h}else c[0]=b[0],c[1]=b[4],c[2]=b[8],c[3]=b[12],c[4]=b[1],c[5]=b[5],c[6]=b[9],c[7]=b[13],c[8]=b[2],c[9]=b[6],c[10]=b[10],c[11]=b[14],c[12]=b[3],c[13]=b[7],c[14]=b[11],c[15]=b[15];return c};a.invert=function(c,b){var a=b[0],d=b[1],f=b[2],g=b[3],l=b[4],h=b[5],k=b[6],m=b[7],t=b[8],x=b[9],z=b[10],A=b[11],n=b[12],B=b[13],G=b[14];
b=b[15];var F=a*h-d*l,K=a*k-f*l,H=a*m-g*l,N=d*k-f*h,I=d*m-g*h,J=f*m-g*k,M=t*B-x*n,L=t*G-z*n,R=t*b-A*n,O=x*G-z*B,T=x*b-A*B,U=z*b-A*G,P=F*U-K*T+H*O+N*R-I*L+J*M;if(!P)return null;P=1/P;c[0]=(h*U-k*T+m*O)*P;c[1]=(f*T-d*U-g*O)*P;c[2]=(B*J-G*I+b*N)*P;c[3]=(z*I-x*J-A*N)*P;c[4]=(k*R-l*U-m*L)*P;c[5]=(a*U-f*R+g*L)*P;c[6]=(G*H-n*J-b*K)*P;c[7]=(t*J-z*H+A*K)*P;c[8]=(l*T-h*R+m*M)*P;c[9]=(d*R-a*T-g*M)*P;c[10]=(n*I-B*H+b*F)*P;c[11]=(x*H-t*I-A*F)*P;c[12]=(h*L-l*O-k*M)*P;c[13]=(a*O-d*L+f*M)*P;c[14]=(B*K-n*N-G*F)*P;
c[15]=(t*N-x*K+z*F)*P;return c};a.adjoint=function(c,b){var a=b[0],d=b[1],f=b[2],g=b[3],l=b[4],h=b[5],k=b[6],m=b[7],t=b[8],x=b[9],z=b[10],A=b[11],n=b[12],B=b[13],G=b[14];b=b[15];c[0]=h*(z*b-A*G)-x*(k*b-m*G)+B*(k*A-m*z);c[1]=-(d*(z*b-A*G)-x*(f*b-g*G)+B*(f*A-g*z));c[2]=d*(k*b-m*G)-h*(f*b-g*G)+B*(f*m-g*k);c[3]=-(d*(k*A-m*z)-h*(f*A-g*z)+x*(f*m-g*k));c[4]=-(l*(z*b-A*G)-t*(k*b-m*G)+n*(k*A-m*z));c[5]=a*(z*b-A*G)-t*(f*b-g*G)+n*(f*A-g*z);c[6]=-(a*(k*b-m*G)-l*(f*b-g*G)+n*(f*m-g*k));c[7]=a*(k*A-m*z)-l*(f*A-
g*z)+t*(f*m-g*k);c[8]=l*(x*b-A*B)-t*(h*b-m*B)+n*(h*A-m*x);c[9]=-(a*(x*b-A*B)-t*(d*b-g*B)+n*(d*A-g*x));c[10]=a*(h*b-m*B)-l*(d*b-g*B)+n*(d*m-g*h);c[11]=-(a*(h*A-m*x)-l*(d*A-g*x)+t*(d*m-g*h));c[12]=-(l*(x*G-z*B)-t*(h*G-k*B)+n*(h*z-k*x));c[13]=a*(x*G-z*B)-t*(d*G-f*B)+n*(d*z-f*x);c[14]=-(a*(h*G-k*B)-l*(d*G-f*B)+n*(d*k-f*h));c[15]=a*(h*z-k*x)-l*(d*z-f*x)+t*(d*k-f*h);return c};a.determinant=function(c){var b=c[0],a=c[1],d=c[2],f=c[3],g=c[4],l=c[5],h=c[6],k=c[7],m=c[8],t=c[9],x=c[10],z=c[11],A=c[12],n=c[13],
B=c[14];c=c[15];return(b*l-a*g)*(x*c-z*B)-(b*h-d*g)*(t*c-z*n)+(b*k-f*g)*(t*B-x*n)+(a*h-d*l)*(m*c-z*A)-(a*k-f*l)*(m*B-x*A)+(d*k-f*h)*(m*n-t*A)};a.multiply=d;a.translate=function(c,b,a){var e=a[0],d=a[1];a=a[2];var f=void 0,g=void 0,l=void 0,h=void 0,k=void 0,t=void 0,x=void 0,m=void 0,A=void 0,n=void 0,B=void 0,G=void 0;b===c?(c[12]=b[0]*e+b[4]*d+b[8]*a+b[12],c[13]=b[1]*e+b[5]*d+b[9]*a+b[13],c[14]=b[2]*e+b[6]*d+b[10]*a+b[14],c[15]=b[3]*e+b[7]*d+b[11]*a+b[15]):(f=b[0],g=b[1],l=b[2],h=b[3],k=b[4],t=
b[5],x=b[6],m=b[7],A=b[8],n=b[9],B=b[10],G=b[11],c[0]=f,c[1]=g,c[2]=l,c[3]=h,c[4]=k,c[5]=t,c[6]=x,c[7]=m,c[8]=A,c[9]=n,c[10]=B,c[11]=G,c[12]=f*e+k*d+A*a+b[12],c[13]=g*e+t*d+n*a+b[13],c[14]=l*e+x*d+B*a+b[14],c[15]=h*e+m*d+G*a+b[15]);return c};a.scale=function(c,b,a){var e=a[0],d=a[1];a=a[2];c[0]=b[0]*e;c[1]=b[1]*e;c[2]=b[2]*e;c[3]=b[3]*e;c[4]=b[4]*d;c[5]=b[5]*d;c[6]=b[6]*d;c[7]=b[7]*d;c[8]=b[8]*a;c[9]=b[9]*a;c[10]=b[10]*a;c[11]=b[11]*a;c[12]=b[12];c[13]=b[13];c[14]=b[14];c[15]=b[15];return c};a.rotate=
function(c,b,a,d){var e=d[0],f=d[1];d=d[2];var p=Math.sqrt(e*e+f*f+d*d),g=void 0,l=void 0,h=void 0,t=void 0,x=void 0,m=void 0,A=void 0,n=void 0,B=void 0,G=void 0,F=void 0,K=void 0,H=void 0,N=void 0,I=void 0,J=void 0,M=void 0,L=void 0,R=void 0,O=void 0,T=void 0,U=void 0,l=g=void 0;if(p<k.EPSILON)return null;p=1/p;e*=p;f*=p;d*=p;g=Math.sin(a);l=Math.cos(a);h=1-l;t=b[0];x=b[1];m=b[2];A=b[3];n=b[4];B=b[5];G=b[6];F=b[7];K=b[8];H=b[9];N=b[10];I=b[11];J=e*e*h+l;M=f*e*h+d*g;L=d*e*h-f*g;R=e*f*h-d*g;O=f*f*
h+l;T=d*f*h+e*g;U=e*d*h+f*g;g=f*d*h-e*g;l=d*d*h+l;c[0]=t*J+n*M+K*L;c[1]=x*J+B*M+H*L;c[2]=m*J+G*M+N*L;c[3]=A*J+F*M+I*L;c[4]=t*R+n*O+K*T;c[5]=x*R+B*O+H*T;c[6]=m*R+G*O+N*T;c[7]=A*R+F*O+I*T;c[8]=t*U+n*g+K*l;c[9]=x*U+B*g+H*l;c[10]=m*U+G*g+N*l;c[11]=A*U+F*g+I*l;b!==c&&(c[12]=b[12],c[13]=b[13],c[14]=b[14],c[15]=b[15]);return c};a.rotateX=function(c,b,a){var e=Math.sin(a);a=Math.cos(a);var d=b[4],f=b[5],g=b[6],l=b[7],h=b[8],k=b[9],t=b[10],x=b[11];b!==c&&(c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3],c[12]=b[12],
c[13]=b[13],c[14]=b[14],c[15]=b[15]);c[4]=d*a+h*e;c[5]=f*a+k*e;c[6]=g*a+t*e;c[7]=l*a+x*e;c[8]=h*a-d*e;c[9]=k*a-f*e;c[10]=t*a-g*e;c[11]=x*a-l*e;return c};a.rotateY=function(c,b,a){var e=Math.sin(a);a=Math.cos(a);var d=b[0],f=b[1],g=b[2],l=b[3],h=b[8],k=b[9],t=b[10],x=b[11];b!==c&&(c[4]=b[4],c[5]=b[5],c[6]=b[6],c[7]=b[7],c[12]=b[12],c[13]=b[13],c[14]=b[14],c[15]=b[15]);c[0]=d*a-h*e;c[1]=f*a-k*e;c[2]=g*a-t*e;c[3]=l*a-x*e;c[8]=d*e+h*a;c[9]=f*e+k*a;c[10]=g*e+t*a;c[11]=l*e+x*a;return c};a.rotateZ=function(c,
b,a){var e=Math.sin(a);a=Math.cos(a);var d=b[0],f=b[1],g=b[2],l=b[3],h=b[4],k=b[5],t=b[6],x=b[7];b!==c&&(c[8]=b[8],c[9]=b[9],c[10]=b[10],c[11]=b[11],c[12]=b[12],c[13]=b[13],c[14]=b[14],c[15]=b[15]);c[0]=d*a+h*e;c[1]=f*a+k*e;c[2]=g*a+t*e;c[3]=l*a+x*e;c[4]=h*a-d*e;c[5]=k*a-f*e;c[6]=t*a-g*e;c[7]=x*a-l*e;return c};a.fromTranslation=function(c,b){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c};a.fromScaling=function(c,
b){c[0]=b[0];c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=b[1];c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=b[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.fromRotation=function(c,b,a){var e=a[0],d=a[1];a=a[2];var f=Math.sqrt(e*e+d*d+a*a),g=void 0,l=void 0,h=void 0;if(f<k.EPSILON)return null;f=1/f;e*=f;d*=f;a*=f;g=Math.sin(b);l=Math.cos(b);h=1-l;c[0]=e*e*h+l;c[1]=d*e*h+a*g;c[2]=a*e*h-d*g;c[3]=0;c[4]=e*d*h-a*g;c[5]=d*d*h+l;c[6]=a*d*h+e*g;c[7]=0;c[8]=e*a*h+d*g;c[9]=d*a*h-e*g;c[10]=a*a*h+l;c[11]=0;c[12]=0;c[13]=0;
c[14]=0;c[15]=1;return c};a.fromXRotation=function(c,b){var a=Math.sin(b);b=Math.cos(b);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=b;c[6]=a;c[7]=0;c[8]=0;c[9]=-a;c[10]=b;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.fromYRotation=function(c,b){var a=Math.sin(b);b=Math.cos(b);c[0]=b;c[1]=0;c[2]=-a;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=a;c[9]=0;c[10]=b;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.fromZRotation=function(c,b){var a=Math.sin(b);b=Math.cos(b);c[0]=b;c[1]=a;c[2]=0;c[3]=0;c[4]=
-a;c[5]=b;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.fromRotationTranslation=g;a.fromQuat2=function(c,b){var a=f,d=-b[0],l=-b[1],h=-b[2],k=b[3],u=b[4],v=b[5],m=b[6],t=b[7],x=d*d+l*l+h*h+k*k;0<x?(a[0]=2*(u*k+t*d+v*h-m*l)/x,a[1]=2*(v*k+t*l+m*d-u*h)/x,a[2]=2*(m*k+t*h+u*l-v*d)/x):(a[0]=2*(u*k+t*d+v*h-m*l),a[1]=2*(v*k+t*l+m*d-u*h),a[2]=2*(m*k+t*h+u*l-v*d));g(c,b,a);return c};var f=m.create();a.getTranslation=function(c,b){c[0]=b[12];c[1]=b[13];c[2]=b[14];return c};
a.getScaling=function(c,b){var a=b[0],d=b[1],f=b[2],g=b[4],l=b[5],h=b[6],k=b[8],m=b[9];b=b[10];c[0]=Math.sqrt(a*a+d*d+f*f);c[1]=Math.sqrt(g*g+l*l+h*h);c[2]=Math.sqrt(k*k+m*m+b*b);return c};a.getRotation=function(c,b){var a=b[0]+b[5]+b[10],d=0;0<a?(d=2*Math.sqrt(a+1),c[3]=.25*d,c[0]=(b[6]-b[9])/d,c[1]=(b[8]-b[2])/d,c[2]=(b[1]-b[4])/d):b[0]>b[5]&&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),c[3]=(b[6]-b[9])/d,c[0]=.25*d,c[1]=(b[1]+b[4])/d,c[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-b[0]-b[10]),
c[3]=(b[8]-b[2])/d,c[0]=(b[1]+b[4])/d,c[1]=.25*d,c[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),c[3]=(b[1]-b[4])/d,c[0]=(b[8]+b[2])/d,c[1]=(b[6]+b[9])/d,c[2]=.25*d);return c};a.fromRotationTranslationScale=function(c,b,a,d){var e=b[0],f=b[1],p=b[2],g=b[3],l=e+e,h=f+f,k=p+p;b=e*l;var x=e*h,e=e*k,m=f*h,f=f*k,p=p*k,l=g*l,h=g*h,g=g*k,k=d[0],A=d[1];d=d[2];c[0]=(1-(m+p))*k;c[1]=(x+g)*k;c[2]=(e-h)*k;c[3]=0;c[4]=(x-g)*A;c[5]=(1-(b+p))*A;c[6]=(f+l)*A;c[7]=0;c[8]=(e+h)*d;c[9]=(f-l)*d;c[10]=(1-(b+m))*
d;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};a.fromRotationTranslationScaleOrigin=function(c,b,a,d,f){var e=b[0],p=b[1],g=b[2],l=b[3],q=e+e,h=p+p,k=g+g;b=e*q;var m=e*h,A=e*k,e=p*h,p=p*k,n=g*k,g=l*q,h=l*h,B=l*k,G=d[0],F=d[1],k=d[2];d=f[0];l=f[1];f=f[2];var q=(1-(e+n))*G,K=(m+B)*G,G=(A-h)*G,m=(m-B)*F,n=(1-(b+n))*F,F=(p+g)*F,A=(A+h)*k,p=(p-g)*k;b=(1-(b+e))*k;c[0]=q;c[1]=K;c[2]=G;c[3]=0;c[4]=m;c[5]=n;c[6]=F;c[7]=0;c[8]=A;c[9]=p;c[10]=b;c[11]=0;c[12]=a[0]+d-(q*d+m*l+A*f);c[13]=a[1]+l-(K*
d+n*l+p*f);c[14]=a[2]+f-(G*d+F*l+b*f);c[15]=1;return c};a.fromQuat=function(c,b){var a=b[0],d=b[1],f=b[2];b=b[3];var g=a+a,l=d+d,h=f+f,a=a*g,k=d*g,d=d*l,m=f*g,t=f*l,f=f*h,g=b*g,l=b*l;b*=h;c[0]=1-d-f;c[1]=k+b;c[2]=m-l;c[3]=0;c[4]=k-b;c[5]=1-a-f;c[6]=t+g;c[7]=0;c[8]=m+l;c[9]=t-g;c[10]=1-a-d;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};a.frustum=function(c,b,a,d,f,g,l){var e=1/(a-b),p=1/(f-d),q=1/(g-l);c[0]=2*g*e;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=2*g*p;c[6]=0;c[7]=0;c[8]=(a+b)*e;c[9]=(f+d)*p;c[10]=
(l+g)*q;c[11]=-1;c[12]=0;c[13]=0;c[14]=l*g*2*q;c[15]=0;return c};a.perspective=function(c,b,a,d,f){b=1/Math.tan(b/2);var e=void 0;c[0]=b/a;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=b;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[11]=-1;c[12]=0;c[13]=0;c[15]=0;null!=f&&Infinity!==f?(e=1/(d-f),c[10]=(f+d)*e,c[14]=2*f*d*e):(c[10]=-1,c[14]=-2*d);return c};a.perspectiveFromFieldOfView=function(c,b,a,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),p=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*
Math.PI/180);var g=2/(p+b),l=2/(e+f);c[0]=g;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=l;c[6]=0;c[7]=0;c[8]=-((p-b)*g*.5);c[9]=(e-f)*l*.5;c[10]=d/(a-d);c[11]=-1;c[12]=0;c[13]=0;c[14]=d*a/(a-d);c[15]=0;return c};a.ortho=function(c,b,a,d,f,g,l){var e=1/(b-a),p=1/(d-f),q=1/(g-l);c[0]=-2*e;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=-2*p;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=2*q;c[11]=0;c[12]=(b+a)*e;c[13]=(f+d)*p;c[14]=(l+g)*q;c[15]=1;return c};a.lookAt=function(c,b,a,d){var e=void 0,f=void 0,p=void 0,g=void 0,l=void 0,m=void 0,
t=void 0,x=void 0,z=void 0,A=void 0,n=b[0],B=b[1];b=b[2];p=d[0];g=d[1];d=d[2];t=a[0];x=a[1];a=a[2];if(Math.abs(n-t)<k.EPSILON&&Math.abs(B-x)<k.EPSILON&&Math.abs(b-a)<k.EPSILON)return h(c);t=n-t;x=B-x;z=b-a;A=1/Math.sqrt(t*t+x*x+z*z);t*=A;x*=A;z*=A;e=g*z-d*x;f=d*t-p*z;p=p*x-g*t;(A=Math.sqrt(e*e+f*f+p*p))?(A=1/A,e*=A,f*=A,p*=A):p=f=e=0;g=x*p-z*f;l=z*e-t*p;m=t*f-x*e;(A=Math.sqrt(g*g+l*l+m*m))?(A=1/A,g*=A,l*=A,m*=A):m=l=g=0;c[0]=e;c[1]=g;c[2]=t;c[3]=0;c[4]=f;c[5]=l;c[6]=x;c[7]=0;c[8]=p;c[9]=m;c[10]=z;
c[11]=0;c[12]=-(e*n+f*B+p*b);c[13]=-(g*n+l*B+m*b);c[14]=-(t*n+x*B+z*b);c[15]=1;return c};a.targetTo=function(c,b,a,d){var e=b[0],f=b[1];b=b[2];var p=d[0],g=d[1],l=d[2];d=e-a[0];var h=f-a[1];a=b-a[2];var k=d*d+h*h+a*a;0<k&&(k=1/Math.sqrt(k),d*=k,h*=k,a*=k);var x=g*a-l*h,l=l*d-p*a,p=p*h-g*d,k=x*x+l*l+p*p;0<k&&(k=1/Math.sqrt(k),x*=k,l*=k,p*=k);c[0]=x;c[1]=l;c[2]=p;c[3]=0;c[4]=h*p-a*l;c[5]=a*x-d*p;c[6]=d*l-h*x;c[7]=0;c[8]=d;c[9]=h;c[10]=a;c[11]=0;c[12]=e;c[13]=f;c[14]=b;c[15]=1;return c};a.str=function(c){return"mat4("+
c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+", "+c[9]+", "+c[10]+", "+c[11]+", "+c[12]+", "+c[13]+", "+c[14]+", "+c[15]+")"};a.frob=function(c){return Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)+Math.pow(c[2],2)+Math.pow(c[3],2)+Math.pow(c[4],2)+Math.pow(c[5],2)+Math.pow(c[6],2)+Math.pow(c[7],2)+Math.pow(c[8],2)+Math.pow(c[9],2)+Math.pow(c[10],2)+Math.pow(c[11],2)+Math.pow(c[12],2)+Math.pow(c[13],2)+Math.pow(c[14],2)+Math.pow(c[15],2))};a.add=function(c,b,
a){c[0]=b[0]+a[0];c[1]=b[1]+a[1];c[2]=b[2]+a[2];c[3]=b[3]+a[3];c[4]=b[4]+a[4];c[5]=b[5]+a[5];c[6]=b[6]+a[6];c[7]=b[7]+a[7];c[8]=b[8]+a[8];c[9]=b[9]+a[9];c[10]=b[10]+a[10];c[11]=b[11]+a[11];c[12]=b[12]+a[12];c[13]=b[13]+a[13];c[14]=b[14]+a[14];c[15]=b[15]+a[15];return c};a.subtract=l;a.multiplyScalar=function(c,b,a){c[0]=b[0]*a;c[1]=b[1]*a;c[2]=b[2]*a;c[3]=b[3]*a;c[4]=b[4]*a;c[5]=b[5]*a;c[6]=b[6]*a;c[7]=b[7]*a;c[8]=b[8]*a;c[9]=b[9]*a;c[10]=b[10]*a;c[11]=b[11]*a;c[12]=b[12]*a;c[13]=b[13]*a;c[14]=b[14]*
a;c[15]=b[15]*a;return c};a.multiplyScalarAndAdd=function(c,b,a,d){c[0]=b[0]+a[0]*d;c[1]=b[1]+a[1]*d;c[2]=b[2]+a[2]*d;c[3]=b[3]+a[3]*d;c[4]=b[4]+a[4]*d;c[5]=b[5]+a[5]*d;c[6]=b[6]+a[6]*d;c[7]=b[7]+a[7]*d;c[8]=b[8]+a[8]*d;c[9]=b[9]+a[9]*d;c[10]=b[10]+a[10]*d;c[11]=b[11]+a[11]*d;c[12]=b[12]+a[12]*d;c[13]=b[13]+a[13]*d;c[14]=b[14]+a[14]*d;c[15]=b[15]+a[15]*d;return c};a.exactEquals=function(c,b){return c[0]===b[0]&&c[1]===b[1]&&c[2]===b[2]&&c[3]===b[3]&&c[4]===b[4]&&c[5]===b[5]&&c[6]===b[6]&&c[7]===b[7]&&
c[8]===b[8]&&c[9]===b[9]&&c[10]===b[10]&&c[11]===b[11]&&c[12]===b[12]&&c[13]===b[13]&&c[14]===b[14]&&c[15]===b[15]};a.equals=function(c,b){var a=c[0],d=c[1],f=c[2],g=c[3],l=c[4],h=c[5],v=c[6],m=c[7],t=c[8],x=c[9],z=c[10],A=c[11],n=c[12],B=c[13],G=c[14];c=c[15];var F=b[0],K=b[1],H=b[2],N=b[3],I=b[4],J=b[5],M=b[6],L=b[7],R=b[8],O=b[9],T=b[10],U=b[11],P=b[12],V=b[13],W=b[14];b=b[15];return Math.abs(a-F)<=k.EPSILON*Math.max(1,Math.abs(a),Math.abs(F))&&Math.abs(d-K)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(K))&&
Math.abs(f-H)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(H))&&Math.abs(g-N)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(l-I)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-J)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(v-M)<=k.EPSILON*Math.max(1,Math.abs(v),Math.abs(M))&&Math.abs(m-L)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(t-R)<=k.EPSILON*Math.max(1,Math.abs(t),Math.abs(R))&&Math.abs(x-O)<=k.EPSILON*Math.max(1,Math.abs(x),Math.abs(O))&&Math.abs(z-
T)<=k.EPSILON*Math.max(1,Math.abs(z),Math.abs(T))&&Math.abs(A-U)<=k.EPSILON*Math.max(1,Math.abs(A),Math.abs(U))&&Math.abs(n-P)<=k.EPSILON*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(B-V)<=k.EPSILON*Math.max(1,Math.abs(B),Math.abs(V))&&Math.abs(G-W)<=k.EPSILON*Math.max(1,Math.abs(G),Math.abs(W))&&Math.abs(c-b)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))};a.mul=d;a.sub=l})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),
function(n,a,m,k,h,d,g,l){function f(b,c,e,d){var f,p;b instanceof g&&c instanceof g&&(e=c.longitude,d=c.latitude,p=b.latitude,f=b.longitude);b=m.deg2rad(p);d=m.deg2rad(d);f=m.deg2rad(f);c=m.deg2rad(e);e=Math.sin((b-d)/2);f=Math.sin((f-c)/2);e=2*m.asinClamped(Math.sqrt(e*e+Math.cos(b)*Math.cos(d)*f*f))*a.earthRadius;return Math.round(1E4*e)/1E4}function c(b,c,e){b=e/a.earthRadius;c=m.deg2rad(c);b=Math.sin(b/2);c=Math.cos(c);c=2*m.asinClamped(Math.sqrt(b*b/(c*c)));return m.rad2deg(c)}function b(b,
c,e){return m.rad2deg(e/a.earthRadius)}function e(b,c){b/=15;c||(b=Math.round(b));return b}Object.defineProperty(a,"__esModule",{value:!0});a.earthRadius=k.wgs84Radius;a.halfEarthRadius=a.earthRadius/2;a.halfEarthCircumference=Math.PI*a.earthRadius;a.earthCircumference=2*a.halfEarthCircumference;a.metersPerDegree=a.halfEarthCircumference/180;a.getGreatCircleDistance=f;a.getGreatCircleSpanAt=function(b,c,a){var e=c.spatialReference,d=new g(c.x,b.y,e),p=new g(a.x,b.y,e);c=new g(b.x,c.y,e);b=new g(b.x,
a.y,e);return{lon:f(d,p),lat:f(c,b)}};a.getLonDeltaForDistance=c;a.getLatDeltaForDistance=b;a.getLatLonDeltaForDistance=function(a,e,d){return{lat:b(a,e,d),lon:c(a,e,d)}};a.getMaxCameraAltitude=function(b){b=m.deg2rad(b/2);return(1-Math.sin(b))*a.earthRadius/Math.sin(b)};a.getViewExtentDistance=function(b,c){c=m.deg2rad(c/2);return 2*m.acosClamped((Math.pow(b+a.earthRadius,2)+Math.pow(a.earthRadius,2)-Math.pow((b+a.earthRadius)*Math.cos(c)-Math.sqrt(Math.pow(Math.cos(c)*(b+a.earthRadius),2)-b*b-2*
b*a.earthRadius),2))/(2*(b+a.earthRadius)*a.earthRadius))*a.earthRadius};a.computeCartesianDistance=function(b,c){b=l.wgs84ComparableLonLatToECEF(p,b.longitude,b.latitude,b.z||0);c=l.wgs84ComparableLonLatToECEF(q,c.longitude,c.latitude,c.z||0);c=[c[0]-b[0],c[1]-b[1],c[2]-b[2]];return Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])};a.longitudeToTimezone=e;a.positionToTimezone=function(b,c){c||(c={hours:0,minutes:0,seconds:0});c.hours=e(b[0],!0);b=c.hours%1;c.hours-=b;c.minutes=60*b;b=c.minutes%1;c.minutes-=
b;c.seconds=Math.round(60*b);return c};a.distanceToIdealHorizon=function(b,c){c=c||a.earthRadius;b=h.vec3.dot(b,b);return Math.sqrt(Math.abs(b-c*c))};var p=d.vec3f64.create(),q=d.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});(function(a){a.length=function(a,h){var d=a[h],g=a[h+1];a=a[h+2];return Math.sqrt(d*d+g*g+a*a)};a.normalize=function(a,h){var d=a[h],g=a[h+1],l=a[h+2],
d=1/Math.sqrt(d*d+g*g+l*l);a[h]*=d;a[h+1]*=d;a[h+2]*=d};a.scale=function(a,h,d){a[h]*=d;a[h+1]*=d;a[h+2]*=d};a.add=function(a,h,d,g,l,f){void 0===f&&(f=h);l=l||a;l[f]=a[h]+d[g];l[f+1]=a[h+1]+d[g+1];l[f+2]=a[h+2]+d[g+2]};a.subtract=function(a,h,d,g,l,f){void 0===f&&(f=h);l=l||a;l[f]=a[h]-d[g];l[f+1]=a[h+1]-d[g+1];l[f+2]=a[h+2]-d[g+2]}})(a.Vec3Compact||(a.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",
{value:!0});a.isSpatialReferenceSupported=function(a,k){return null==a?!1:"2d"===k?!0:"local"===k?!a.isGeographic:a.isWebMercator||a.isWGS84||4490===a.wkid}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});var m={width:600,height:400};a.getOptimalThumbnailSize=function(a,h){h=h||m;var d=h.width;h=h.height;var g=d/h;1.5>g?h=d/1.5:1.5<g&&(d=1.5*h);d>a.width&&(h*=a.width/d,d=a.width);h>a.height&&(d*=a.height/
h,h=a.height);return{width:Math.round(d),height:Math.round(h)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),function(n,a,m,k,h,d,g){return function(a){function f(b){b=a.call(this,b)||this;b.viewing=null;return b}m(f,a);c=f;f.prototype.clone=function(){return new c({viewing:this.viewing?this.viewing.clone():
null})};var c;k([d.property({type:g,json:{write:!0}})],f.prototype,"viewing",void 0);return f=c=k([d.subclass("esri.webscene.ApplicationProperties")],f)}(d.declared(h.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),function(n,a,m,k,h,d,g,l){return function(a){function c(b){b=a.call(this,
b)||this;b.search=null;return b}m(c,a);b=c;c.prototype.clone=function(){return new b(d.clone({search:this.search}))};var b;k([g.property({type:l,json:{write:!0}})],c.prototype,"search",void 0);return c=b=k([g.subclass("esri.webdoc.applicationProperties.Viewing")],c)}(g.declared(h.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(n,a,m,k,h,d,g,l,f){var c=h.ofType(f);return function(b){function a(a){a=b.call(this,a)||this;a.addressSearchEnabled=!0;a.enabled=!0;a.hintText=null;a.layers=new c;return a}m(a,b);d=a;a.prototype.readAddressSearchEnabled=function(b,c){return!b};a.prototype.writeAddressSearchEnabled=function(b,c,a){c[a]=!b};a.prototype.clone=function(){return new d(g.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var d;k([l.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"addressSearchEnabled",void 0);k([l.reader("addressSearchEnabled")],a.prototype,"readAddressSearchEnabled",null);k([l.writer("addressSearchEnabled")],a.prototype,"writeAddressSearchEnabled",null);k([l.property({type:Boolean,json:{write:!0,default:!0}})],a.prototype,"enabled",void 0);k([l.property({type:String,json:{write:!0}})],a.prototype,"hintText",void 0);
k([l.property({type:c,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"layers",void 0);return a=d=k([l.subclass("esri.webdoc.applicationProperties.Search")],a)}(l.declared(d.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(n,a,m,k,h,d,g,l,f){return function(c){function b(b){b=c.call(this,b)||this;b.field=null;b.id=null;b.subLayer=null;return b}m(b,c);a=b;b.prototype.clone=function(){return new a(d.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var a;k([g.property({type:f,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);k([g.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);k([g.property({type:l.Integer,json:{write:!0}})],b.prototype,
"subLayer",void 0);return b=a=k([g.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(g.declared(h.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(n,a,m,k,h,d,g){return function(a){function f(b){b=a.call(this,b)||this;b.exactMatch=!1;b.name=
null;b.type=null;return b}m(f,a);c=f;f.prototype.clone=function(){return new c({exactMatch:this.exactMatch,type:this.type,name:this.name})};var c;k([d.property({type:Boolean,json:{write:!0}})],f.prototype,"exactMatch",void 0);k([d.property({type:String,json:{write:!0}})],f.prototype,"name",void 0);k([d.enumeration.serializable()(g.kebabDict)],f.prototype,"type",void 0);return f=c=k([d.subclass("esri.webdoc.applicationProperties.SearchLayerField")],f)}(d.declared(h.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(n,a,m,k,h,d,g,l,f){var c=function(b,c,a){return{enabled:!a||!a.isPresentation}};return function(b){function a(c){c=b.call(this,c)||this;c.lighting=new l;c.background=null;c.atmosphereEnabled=!0;c.starsEnabled=!0;return c}m(a,b);p=a;a.prototype.clone=function(){return new p(this.cloneConstructProperties())};a.prototype.cloneConstructProperties=function(){return{lighting:l.prototype.clone.call(this.lighting),background:d.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var p;k([g.property({type:l,json:{write:!0}})],a.prototype,"lighting",void 0);k([g.property(f.backgroundProperty)],a.prototype,"background",void 0);k([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:c}}})],a.prototype,"atmosphereEnabled",void 0);k([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:c}}})],a.prototype,"starsEnabled",void 0);return a=p=k([g.subclass("esri.webscene.Environment")],a)}(g.declared(h.JSONSupport))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(n,a,m,k,h,d){return function(a){function g(c){c=a.call(this,c)||this;c.date=null;c.directShadowsEnabled=!1;c.displayUTCOffset=null;return c}m(g,a);f=g;g.prototype.readDate=function(c,b){return null!=b.datetime&&new Date(b.datetime)||null};g.prototype.writeDate=function(c,b,a){b[a]=c.getTime()};g.prototype.readDirectShadowsEnabled=function(c,b){return!!b.directShadows};g.prototype.writedirectShadowsEnabled=function(c,b,a){c&&(b[a]=c)};g.prototype.writeDisplayUTCOffset=function(c,b){null!=
c&&(b.displayUTCOffset=c)};g.prototype.clone=function(){return new f(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){var c={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(c.date=new Date(this.date.getTime()));return c};var f;k([d.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],g.prototype,"date",void 0);k([d.reader("date",["datetime"])],g.prototype,"readDate",
null);k([d.writer("date")],g.prototype,"writeDate",null);k([d.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],g.prototype,"directShadowsEnabled",void 0);k([d.reader("directShadowsEnabled",["directShadows"])],g.prototype,"readDirectShadowsEnabled",null);k([d.writer("directShadowsEnabled")],g.prototype,"writedirectShadowsEnabled",null);k([d.property({type:Number,json:{write:!0}})],g.prototype,"displayUTCOffset",void 0);k([d.writer("displayUTCOffset")],g.prototype,"writeDisplayUTCOffset",
null);return g=f=k([d.subclass("esri.webscene.Lighting")],g)}(d.declared(h.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n={base:m,key:"type",typeMap:{color:k}};a.backgroundProperty={types:n,json:{read:function(a){return function(d,g,l){if(!d)return d;for(var f in a.typeMap)if(d.type===f)return g=new a.typeMap[f],g.read(d,l),g}}(n),write:{overridePolicy:function(a,
d,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d,g,l){var f=d.strict()({color:"color"});return function(c){function b(b){return c.call(this)||this}m(b,c);b.prototype.normalizeCtorArgs=function(b){b&&b.type&&
(b=h({},b),delete b.type);return b};b.prototype.clone=function(){};k([l.property({type:f.apiValues,readOnly:!0,json:{type:f.jsonValues,read:!1,write:f.write}})],b.prototype,"type",void 0);return b=k([l.subclass("esri.webscene.background.Background")],b)}(l.declared(g.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(n,a,m,k,h,d,g,l,f){var c=h({},l.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function a(c){c=b.call(this)||this;c.type="color";c.color=new d([0,0,0,1]);return c}m(a,b);f=a;a.prototype.clone=function(){return new f(this.cloneProperties())};a.prototype.cloneProperties=function(){return{color:this.color.clone()}};var f;k([g.enumeration.serializable()({color:"color"})],a.prototype,"type",void 0);k([g.property(c)],a.prototype,"color",void 0);return a=f=k([g.subclass("esri.webscene.background.ColorBackground")],
a)}(g.declared(f))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(n,a,m,k,h,d,g,l,f){return function(c){function b(b){b=c.call(this,b)||this;b.environment=new f;b.spatialReference=null;b.viewpoint=null;return b}m(b,c);a=b;Object.defineProperty(b.prototype,"viewingMode",{set:function(b){this._set("viewingMode",
b)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new a({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var a;k([g.property({type:f,json:{write:{isRequired:!0}}})],b.prototype,"environment",void 0);k([g.property({type:l})],b.prototype,"spatialReference",void 0);k([g.property({type:["local","global"]})],b.prototype,"viewingMode",
null);k([g.property({type:h,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);return b=a=k([g.subclass("esri.webscene.InitialViewProperties")],b)}(g.declared(d))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(n,a,m,k,h,d,g,l,f){var c=h.ofType(f);return function(b){function a(a){a=
b.call(this,a)||this;a.slides=new c;return a}m(a,b);Object.defineProperty(a.prototype,"slides",{set:function(b){b&&(b=b.filter(function(b){return!!b.viewpoint}));this._set("slides",d.referenceSetter(b,this._get("slides"),c))},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};k([l.property({type:c,nonNullable:!0,json:{write:!0}}),l.cast(d.castForReferenceSetter)],a.prototype,"slides",null);return a=k([l.subclass("esri.webscene.Presentation")],
a)}(l.declared(g.JSONSupport))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H){function N(b){if("building-scene"===b.type||"map-image"===b.type)return b.allSublayers}function I(b){if(b=N(b))return b.filter(function(b){return b.visible}).map(function(b){return b.id}).toArray()}function J(b,c){b=c-b;b>T&&(b-=O);b<-T&&(b+=O);return b}var M=0,L=b.ofType(K.default),R=q.getLogger("esri.webscene.Slide"),O=86400,T=43200;return function(a){function p(b){b=a.call(this,b)||this;b._applyToController=null;b.id=Date.now().toString(16)+
"-slide-"+M++;b.title=new H.default;b.description=new G.default;b.thumbnail=new A.default;b.viewpoint=null;b.basemap=null;b.ground=null;b.environment=new E;b.visibleLayers=new L;return b}k(p,a);p.prototype.castTitle=function(b){return"string"===typeof b?new H.default({text:b}):u.ensureType(H.default,b)};p.prototype.castDescription=function(b){return"string"===typeof b?new G.default({text:b}):u.ensureType(G.default,b)};p.prototype.castThumbnail=function(b){return"string"===typeof b?new A.default({url:b}):
u.ensureType(A.default,b)};p.prototype.castBasemap=function(b){return x.ensureType(b)};Object.defineProperty(p.prototype,"visibleLayers",{set:function(b){this._set("visibleLayers",e.referenceSetter(b,this._get("visibleLayers"),L))},enumerable:!0,configurable:!0});p.prototype.castVisibleLayers=function(b){return b&&"function"===typeof b.map?b.map(function(b){if("string"===typeof b)return{id:b};if(b instanceof t){var c=I(b);return{id:b.id,sublayerIds:c}}if(b.id)return{id:b.id,sublayerIds:b.sublayerIds};
R.warn('Invalid visible layer, expected { id }, Layer or "id"');return b}):null};p.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};p.prototype._updateVisibleLayersFrom=function(b){var c=this,a=[];return r.eachAlways(this._allLayers(b.map).map(function(c){return b.whenLayerView(c).then(function(b){if(b.visible){var e=I(c);a.push(new K.default({id:b.layer.id,sublayerIds:e}))}})}).toArray()).then(function(){c.visibleLayers.removeAll();c.visibleLayers.addMany(a)})};p.prototype.updateFrom=function(b,c){var a=this;c={screenshot:m({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},c&&c.screenshot)};return b.when(function(){a.viewpoint=
b.viewpoint.clone();a.environment.lighting=B.prototype.clone.apply(b.environment.lighting);a.basemap=b.map.basemap&&b.map.basemap.clone()||null;a.ground=b.map.ground?F.default.fromGround(b.map.ground):null;return a._updateVisibleLayersFrom(b)}).then(function(){return b.takeScreenshot(c.screenshot)}).then(function(b){a.thumbnail=new A.default({url:b.dataUrl});return a})};p.prototype.applyTo=function(b,c){return g(this,void 0,void 0,function(){var a,e,f;return d(this,function(d){this._applyToController&&
this._applyToController.abort();this._applyToController=a=r.createAbortController();r.onAbortOrThrow(c,function(){return a.abort()});e=m({animate:!0},c,{signal:this._applyToController.signal});f=r.createDeferred(function(){a.abort()});this._applyTo(b,e,a).then(f.resolve,f.reject);return[2,f.promise]})})};p.prototype._applyTo=function(b,a,e){return g(this,void 0,void 0,function(){var f,p=this;return d(this,function(l){switch(l.label){case 0:return[4,c.result(function(){return g(p,void 0,void 0,function(){return d(this,
function(c){switch(c.label){case 0:return[4,this._applyBasemap(b,a)];case 1:return c.sent(),this._applyLayerVisibility(b),this._applyGround(b),[4,this._applyViewpoint(b,a)];case 2:return c.sent(),[2]}})})}())];case 1:f=l.sent();this._applyToController===e&&(this._applyToController=null);if(!1===f.ok)throw f.error;return[2,this]}})})};p.prototype._applyBasemap=function(b,c){return g(this,void 0,void 0,function(){var a;return d(this,function(e){switch(e.label){case 0:if(!this.basemap)return[3,5];e.label=
1;case 1:return e.trys.push([1,3,,4]),[4,this.basemap.load(c)];case 2:return e.sent(),[3,4];case 3:a=e.sent();if(r.isAbortError(a))throw a;return[3,4];case 4:b.map.basemap=x.clonePreservingTiledLayers(this.basemap,b.map.basemap),e.label=5;case 5:return[2]}})})};p.prototype._applyGround=function(b){this.ground&&(b.map.ground=this.ground.cloneAndApplyTo(b.map.ground))};p.prototype._allLayers=function(c){var a=new b;this._collectLayers(c,a);this._collectLayers(c.ground,a);return a};p.prototype._collectLayers=
function(b,c){var a=this;b.layers.forEach(function(b){c.add(b);b.layers&&a._collectLayers(b,c)})};p.prototype._applyLayerVisibility=function(b){var c=this;this.visibleLayers&&this._allLayers(b.map).forEach(function(b){var a=c.visibleLayers.find(function(c){return c.id===b.id});b.visible=null!=a;var e=a&&a.sublayerIds,a=N(b);e&&a&&a.forEach(function(b){return b.visible=0<=e.indexOf(b.id)})})};p.prototype._applyViewpoint=function(b,c){return g(this,void 0,void 0,function(){return d(this,function(a){switch(a.label){case 0:if(!this.viewpoint||
c.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=b.camera.fov;return c.animate?this.get("environment.lighting.date")?[4,this._animateToLighting(b,c)]:[3,2]:[3,4];case 1:return a.sent(),[2];case 2:return b.environment.lighting=this.environment.lighting.clone(),[4,b.goTo(this.viewpoint,c)];case 3:a.sent(),a.label=4;case 4:return b.viewpoint=this.viewpoint,b.environment.lighting=this.environment.lighting.clone(),[3,6];case 5:b.environment.lighting=this.environment.lighting.clone(),a.label=6;case 6:return[2]}})})};
p.prototype._animateToLighting=function(b,c){return g(this,void 0,void 0,function(){var a,e,f,p=this;return d(this,function(d){a=null;"global"===b.viewingMode&&(a=this._animateLightingWithCamera(b));b.environment.lighting.cameraTrackingEnabled=!1;b.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(b.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);e=b.goTo(this.viewpoint,c);e.then(function(){b.environment.lighting=
p.environment.lighting.clone()});f=function(){a&&a.remove();b.environment.lighting.cameraTrackingEnabled=!0};e.catch(function(b){f();throw b;}).then(f);return[2,e]})})};p.prototype._getTime=function(b){var c=b.getTime();b=3600*b.getUTCHours()+60*b.getUTCMinutes()+b.getUTCSeconds();return[c,b]};p.prototype._setTime=function(b,c,a){b.setTime(c);b.setUTCHours(a/3600);b.setUTCMinutes(a%3600/60);b.setUTCSeconds(a%3600%60);return b};p.prototype._animateLightingWithCamera=function(b){var c=this,a=this._getTime(new Date(b.environment.lighting.date.toString())),
e=a[0],d=a[1],a=this._getTime(this.environment.lighting.date),f=a[0],p=J(d,a[1]),g=b.renderCoordsHelper,l=y.vec3f64.create();g.toRenderCoords(b.camera.position,l);var q=y.vec3f64.create();g.toRenderCoords(this.viewpoint.camera.position,q);var h=y.vec3f64.create(),r=new Date;return b.watch("camera",function(a){g.toRenderCoords(a.position,h);var k=v.vec3.squaredDistance(l,h),u=v.vec3.squaredDistance(q,h);a=0;0!==k+u&&(a=k/(k+u));k=e+(f-e)*a;a=z.moduloPositive(d+p*a,O);b.environment.lighting.date=c._setTime(r,
k,a)})};p.createFrom=function(b,c){return(new this).updateFrom(b,c)};h([w.property({type:String,json:{write:{isRequired:!0}}})],p.prototype,"id",void 0);h([w.property({type:H.default,json:{default:function(){return new H.default({text:""})},write:{isRequired:!0}}})],p.prototype,"title",void 0);h([w.cast("title")],p.prototype,"castTitle",null);h([w.property({type:G.default,json:{write:{overridePolicy:function(b){return{enabled:!(!b||!b.text)}}}}})],p.prototype,"description",void 0);h([w.cast("description")],
p.prototype,"castDescription",null);h([w.property({type:A.default,json:{default:function(){return new A.default({url:""})},write:{isRequired:!0}}})],p.prototype,"thumbnail",void 0);h([w.cast("thumbnail")],p.prototype,"castThumbnail",null);h([w.property({type:f,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"viewpoint",void 0);h([w.property({type:l,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],p.prototype,"basemap",void 0);h([w.cast("basemap")],p.prototype,"castBasemap",null);
h([w.property({type:F.default,json:{write:!0}})],p.prototype,"ground",void 0);h([w.property({type:L,json:{write:{isRequired:!0}}})],p.prototype,"visibleLayers",null);h([w.cast("visibleLayers")],p.prototype,"castVisibleLayers",null);h([w.property({type:E,json:{write:!0}})],p.prototype,"environment",void 0);return p=h([w.subclass("esri.webscene.Slide")],p)}(w.declared(p.JSONSupport))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(){var c=null!==a&&a.apply(this,arguments)||this;c.url="";return c}m(g,a);f=g;g.prototype.clone=function(){return new f({url:this.url})};var f;k([d.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"url",void 0);return g=f=k([d.subclass("esri.webdoc.support.Thumbnail")],g)}(d.declared(h.JSONSupport));a.default=n})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(){var c=null!==a&&a.apply(this,arguments)||this;c.text="";return c}m(g,a);f=g;g.prototype.clone=function(){return new f({text:this.text})};var f;k([d.property({type:String,json:{write:!0}})],g.prototype,"text",void 0);return g=f=k([d.subclass("esri.webscene.support.Description")],g)}(d.declared(h.JSONSupport));a.default=n})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(c){function b(){var b=null!==c&&c.apply(this,arguments)||this;b.opacity=null;return b}m(b,c);a=b;b.prototype.clone=function(){return new a({opacity:this.opacity})};b.prototype.cloneAndApplyTo=function(b){if(null==this.opacity)return b;b=null!=b?b.clone():new h;b.opacity=this.opacity;return b};b.fromGround=function(b){return new a({opacity:b.opacity})};var a;k([g.property({type:Number,json:{type:l.Integer,read:{reader:f.transparencyToOpacity,
source:"transparency"},write:{writer:function(b,c){c.transparency=f.opacityToTransparency(b)},target:"transparency"}}})],b.prototype,"opacity",void 0);return b=a=k([g.subclass("esri.webscene.support.SlideGround")],b)}(g.declared(d.JSONSupport));a.default=n})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b){b=a.call(this)||this;b.id="";b.sublayerIds=null;return b}m(c,a);b=c;c.prototype.clone=function(){return new b({id:this.id,sublayerIds:d.clone(this.sublayerIds)})};var b;k([g.property({type:String,json:{write:!0}})],c.prototype,"id",void 0);k([g.property({type:[l.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],c.prototype,"sublayerIds",void 0);return c=b=k([g.subclass("esri.webscene.support.SlideVisibleLayer")],
c)}(g.declared(h.JSONSupport));a.SlideVisibleLayer=n;a.default=n})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(){var c=null!==a&&a.apply(this,arguments)||this;c.text="";return c}m(g,a);f=g;g.prototype.clone=function(){return new f({text:this.text})};
var f;k([d.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"text",void 0);return g=f=k([d.subclass("esri.webscene.support.Title")],g)}(d.declared(h.JSONSupport));a.default=n})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,l){return a.call(this,d,l,"webscene")||this}m(d,a);Object.defineProperty(d.prototype,"supportsGround",
{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return d}(k.Version);a.Version=n;a.default=n})},"esri/core/Version":function(){define(["require","exports","./Error"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g){void 0===g&&(g="");this.major=a;this.minor=d;this._context=g}a.prototype.lessThan=
function(a,d){return this.major<a||a===this.major&&this.minor<d};a.prototype.since=function(a,d){return!this.lessThan(a,d)};a.prototype.validate=function(a){if(this.major!==a.major)throw new m((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(h,d){void 0===
d&&(d="");var g=h.split("."),l=g[0],g=g[1],f=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(f))throw new m((d&&d+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:h});if(!g||!g.match||!g.match(f))throw new m((d&&d+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:h});h=parseInt(l,10);l=parseInt(g,10);return new a(h,l,d)};return a}();a.Version=n})},"esri/views/SceneView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/asyncUtils ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../support/arcadeOnDemand ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/MemoryManagedLayerView ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/index ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/screenshotUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment @dojo/framework/shim/Promise".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L,R,O,T,U,P,V,W,Q,Z,X,aa,da,ga,ca,ia,ba,oa,ha,la,ra,va,ja,pa,C,ua,wa,D,qa,na,S,Ca,Ea,Fa,Ha,Ka,ka,Da,La,ta){function Ia(b,c){b.layerUids||(b.layerUids=new Set);b.layerUids.add(c)}function Ja(b,c){b.graphicUids||(b.graphicUids=new Set);b.graphicUids.add(c)}function za(b){return 1099511627776<=b?Math.round(b/1099511627776)+"TB":1073741824<=b?Math.round(b/1073741824)+"GB":1048576<=b?Math.round(b/1048576)+"MB":1024<=b?Math.round(b/
1024)+"KB":b.toFixed(0)+"B"}var Ga=y.getLogger("esri.views.SceneView");a=function(a){function g(b){var c=a.call(this)||this;c._clippingArea=null;c._userClippingArea=null;c._initialDefaultSpatialReference=null;c._defaults={};c._externallySet={environment:!1};c._createGraphicsViewController=null;c._updateDrawingOrderHandle=null;c.onViewExtentUpdateHandle=null;c._resolveWhenReady=[];c.propertiesPool=new C.default({slicePlane:qa.BoundedPlaneClass},c);c._resourceController=va.newResourceController(c);
c._defaultToMapOptions={include:new Set};c._defaultHitTestOptions={exclude:new Set};c.deconflictor=new Z.Deconflictor({view:c});c.labeler=new X.Labeler({view:c});c.renderSpatialReference=null;c.sharedSymbolResources=null;c.basemapTerrain=null;c.elevationProvider=null;c.camera=null;c.canvas=null;c.center=null;c.constraints=new P.default;c.extent=null;c.windowDevicePixelRatio=1;c.fullOpacity=1;c.graphicsView=null;c.groundView=null;c.map=null;c.screenSizePerspectiveEnabled=!0;c.state=null;c.scale=null;
c.spatialReference=null;c.isHeightModelInfoRequired=!0;c.alphaCompositingEnabled=!1;c.supersampleScreenhotsEnabled=!0;c.type="3d";c.ui=new La;c.updatingPercentage=0;c.viewpoint=null;c.zoom=null;c.highlightOptions=new ra;b&&b.environment||(c._defaults.environment=new V,c.environment=c._defaults.environment);b=function(){c.notifyChange("dataExtent");c.updatingChanged();c.map&&c.map.allLayers.forEach(function(b){b.when(function(){return c.updatingChanged()},function(){return c.updatingChanged()})})};
c.handles.add([A.when(c,"ready",function(b,a){return c._viewReadyHandler(a)}),A.on(c,"map.allLayers","after-changes",b,b,b,!0),c.allLayerViews.on("after-changes",function(){return c._updateUpdatingMonitors()}),c.watch("map",function(b){b&&b.load&&b.load()})]);c.inputManager=new Q({view:c});c.stateManager=new ca.ViewStateManager({view:c,updateDevicePixelRatio:function(){var b=window.devicePixelRatio;b!==c.windowDevicePixelRatio&&(c.windowDevicePixelRatio=b,c.notifyChange("pixelRatio"))}});return c}
m(g,a);g.prototype.initialize=function(){var b=this;this.groundView=new R({view:this});this.environmentManager=new W.default({view:this});this._updateUpdatingMonitors();var c=function(){return b._updateDefaultToMapOptions()};this.handles.add([A.whenNot(this,"ready",function(c,a){return b._viewUnreadyHandler(a)}),A.on(this,"map.allLayers","after-changes",c,c,c)]);this.updatingHandles.add(this.qualitySettings,"memoryLimit",function(c){b.resourceController&&(b.resourceController.memoryController.maxMemory=
c)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",function(c){b.resourceController&&(b.resourceController.memoryController.additionalCacheMemory=c)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",function(b){return z.setFrameDuration(0<b?1E3/Math.ceil(b):0)},2);this.updatingHandles.add(oa,"SCENEVIEW_LOCKING_LOG",function(c){return b.defaultsFromMap.logDebugInformation=c},2);this.updatingHandles.add(this,"map.ground",c,3);this.updatingHandles.add(this,"map.ground.opacity",
function(){return b._updateDefaultHitTestOptions()},3)};g.prototype.destroy=function(){this.activeTool=null;this.layerViewManager.clear();this.stateManager.deinit();this.groundView.destroy();this.groundView=null;this.destroyViewData();this._disposeSurface();this._disposeGraphicsView();this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this.state&&
this.state.destroy();this._stage&&(this._stage.destroy(),this._stage=null,this.handles.remove("stage"));this._set("canvas",null);this.labeler.destroy();this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this._resourceController.destroy();this._resourceController=null;this.environmentManager.destroy();this._set("environmentManager",null);this.stateManager.destroy();this._set("stateManager",null);this.inputManager.destroy();this._set("inputManager",null);this.propertiesPool.destroy();
this.propertiesPool=null};Object.defineProperty(g.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var b=this.get("map.clippingEnabled"),c=this.get("map.clippingArea");if(!b||!c)return this._clippingArea=null;if(!(c instanceof f.Extent))return Ga.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(!I.canProject(c.spatialReference,this.spatialReference))return Ga.error("#clippingArea",
"setting clippingArea with incompatible SpatialReference"),this._clippingArea;c=I.project(c,this.spatialReference);return this._clippingArea&&c&&this._clippingArea.equals(c)?this._clippingArea:this._clippingArea=c},set:function(b){this.ready&&"global"===this.viewingMode&&b?Ga.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=b,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"dataExtent",{get:function(){var b=
[],c=this.spatialReference||f.SpatialReference.WGS84,a=this.clippingArea;a&&(a=I.project(a,c));var e=function(e){e&&(e=I.project(e,c))&&(a&&(e=e.intersection(a)),e&&b.push(e))},d=this._get("basemapTerrain");d&&d.spatialReference&&e(new f.Extent({xmin:d.extent[0],ymin:d.extent[1],zmin:0,xmax:d.extent[2],ymax:d.extent[3],zmax:0,spatialReference:d.spatialReference}));this.map&&this.map.allLayers.forEach(function(b){return e(b.fullExtent)});return 0<b.length?(d=b.reduce(function(b,c){return b.union(c)}),
d.hasZ?(d.zmin=Math.min(0,d.zmin),d.zmax=Math.max(0,d.zmax)):(d.zmin=0,d.zmax=0),d):new f.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:c})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"environment",{set:function(b){b!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",b)},enumerable:!0,configurable:!0});g.prototype.castEnvironment=function(b){return b?b instanceof V?b:b instanceof ta?V.fromWebsceneEnvironment(b):G.ensureType(V,
b):new V};Object.defineProperty(g.prototype,"pixelRatio",{get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(b){t.isSome(b)?this._override("pixelRatio",b):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumPixelRatio",{get:function(){var b=Infinity,c=this.qualitySettings,a=c.maximumPixelRatio,c=c.maximumRenderResolution;null!=a&&(b=Math.min(b,a));null!=c&&(b=Math.min(b,c/Math.max(this.width,this.height)));
return b},set:function(b){t.isSome(b)?this._override("maximumPixelRatio",b):this._clearOverride("maximumPixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"groundExtent",{get:function(){var b=this._get("basemapTerrain");if(b&&b.spatialReference){var c=b.extent;return new f.Extent({xmin:c[0],ymin:c[1],xmax:c[2],ymax:c[3],spatialReference:b.spatialReference})}return new f.Extent({spatialReference:this.spatialReference||f.SpatialReference.WGS84})},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||ha.getDefaultProfile()},set:function(b){ha.isValidProfile(b)&&(ha.apply(b,this.qualitySettings),
this._set("qualityProfile",b))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"slicePlane",{set:function(b){this._stage.renderView.setRenderParameters({slicePlane:b});if(b){var c=this.propertiesPool.get("slicePlane");la.boundedPlane.copy(b,c);this._set("slicePlane",c)}else this._set("slicePlane",null)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"resolution",{get:function(){return null!=this.spatialReference?N.getResolutionForScale(this.scale,this.spatialReference):
0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"heightModelInfo",{get:function(){var b=this.getDefaultHeightModelInfo();return null!=b?K.deriveUnitFromSR(b,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){var b=0,c=0,a=!1;this.allLayerViews.forEach(function(e){e.isFulfilled()?e.updating&&(a=!0,e="updatingPercentage"in e?e.updatingPercentage:null,null!=e&&(++c,b+=e)):a=!0});a=!!(a||!this.ready||!this.stationary||
this._createGraphicsViewController||t.isSome(this.graphicsView)&&this.graphicsView.updating||this.basemapView&&this.basemapView.updating||this.basemapTerrain&&this.basemapTerrain.updating||this.layerViewManager&&this.layerViewManager.updating||this._resourceController&&this._resourceController.updating||this._stage&&this._stage.renderView&&this._stage.renderView.updating||this.featureTiles&&this.featureTiles.updating||this.pointsOfInterest&&this.pointsOfInterest.updating||this.labeler&&this.labeler.updating||
this.deconflictor&&this.deconflictor.updating||this.environmentManager&&this.environmentManager.updating||this.inputManager&&this.inputManager.hasPendingInputs||this.map&&this.map.allLayers&&this.map.allLayers.some(function(b){return!b.isFulfilled()})||this.overlay&&this.overlay.updating||this.updatingHandles&&this.updatingHandles.updating||this.featureTreeDebugger&&this.featureTreeDebugger.updating);b=0!==c?b/c:a?100:0;this._get("updatingPercentage")!==b&&this._set("updatingPercentage",b);return a},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"viewingMode",{get:function(){var b=this.get("map.initialViewProperties.viewingMode"),c=this.spatialReference;b||(b=!c||ka.isSpatialReferenceSupported(c,"global")?"global":"local");return b},set:function(b){this.internallyReady?Ga.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(b)?this._override("viewingMode",b):void 0===b&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"resourceController",{get:function(){return this._resourceController},enumerable:!0,configurable:!0});g.prototype.on=function(b,c,a){var e=this.inputManager.viewEvents.register(b,c,a);return e?e:this.inherited(arguments)};g.prototype.hasEventListener=function(b){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(b)};g.prototype.toMap=function(b,c){if(!this.ready)return Ga.error("#toMap()","Scene view cannot be used before it is ready"),
null;c=c?this._externalToInternalIntersectOptions(c):this._defaultToMapOptions;var a=t.isSome(c.graphics)&&(t.isSome(c.graphics.include)||t.isSome(c.graphics.exclude));c.allEnabled=a;b=E.isSupportedScreenPointEvent(b)?E.createScreenPointFromSupportedEvent(this,b):b;b=E.screenPointObjectToArray(b);var e=c.include&&!c.include.has(Ha.TERRAIN_ID)||c.exclude&&c.exclude.has(Ha.TERRAIN_ID);b=this.sceneIntersectionHelper.intersectIntersectorScreen(b,null,c,!0,e).results;if(a){a=0;for(b=b.all;a<b.length;a++){var e=
b[a],d=e.toGraphic(this);if(t.isNone(d)||this._testGraphicUidFilter(c.graphics,d))return this._intersectResultToMapPoint(e)}return null}return this._intersectResultToMapPoint(b.min)};g.prototype.toScreen=function(b){if(!this.ready)return Ga.error("#toScreen()","Scene view cannot be used before it is ready"),null;var c=null==b.z&&this.basemapTerrain.getElevation(b)||0;pa.pointToVector(b,fa,this.renderSpatialReference,c);return this.engineToScreen(fa)};g.prototype.pixelSizeAt=function(b,c){if(!this.ready)return Ga.error("#pixelSizeAt()",
"Scene view cannot be used before it is ready"),null;if("number"===typeof b){if(b=this.sceneIntersectionHelper.intersectIntersectorScreen(E.createScreenPointArray(b,c)).results.min,!b.getIntersectionPoint(fa))return 0}else if(b instanceof f.Point)pa.pointToVector(b,fa,this.renderSpatialReference);else if(b=this.sceneIntersectionHelper.intersectIntersectorScreen(E.createScreenPointArray(b.x,b.y)).results.min,!b.getIntersectionPoint(fa))return 0;return this.state.camera.computeScreenPixelSizeAt(fa)};
g.prototype.hitTest=function(b,c){if(!this.ready)return Ga.error("#hitTest()","Scene view cannot be used before it is ready"),null;b=E.isSupportedScreenPointEvent(b)?E.createScreenPointFromSupportedEvent(this,b):b;var a=E.createScreenPointArray(b.x,b.y),e=c?this._externalToInternalIntersectOptions(c):this._defaultHitTestOptions;e.allEnabled=!0;e.terrainLocationFeedbackEnabled=!0;c=this.sceneIntersectionHelper.intersectIntersectorScreen(a,null,e,!0,!0);a=this._intersectResultsToHits(c.results.all,
e.graphics);e=c.results.terrain;b={screenPoint:b,results:a,ground:{mapPoint:this._intersectResultToMapPoint(e),distance:e.hasIntersectionPoint?e.distanceInRenderSpace:0}};oa.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(b.intersector=c);return x.resolve(b)};g.prototype.popupHitTest=function(b){return this.hitTest(b).then(function(c){for(var a=[],e=c.results.length?c.results[0].distance:0,d=0,f=c.results;d<f.length;d++){var g=f[d];if(g.distance!==e)break;a.push(g)}d=null;if(0===a.length||1E-5>Math.abs(e-
c.ground.distance))d=c.ground.mapPoint;return{results:a,screenPoint:b,mapPoint:d}})};g.prototype.goTo=function(b,c){return p.safeCast(this.stateManager.goTo(b,c))};g.prototype.takeScreenshot=function(b){var c=this;return this.whenReady().then(function(){var a=Ka.toRenderSettings(b,c);a.pixelRatio/=c.pixelRatio;return c._stage.renderView.takeScreenshot(Ka.screenshotSuperSampleSettings(a,c.supersampleScreenhotsEnabled))})};g.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};g.prototype.getDefaultSpatialReference=
function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};g.prototype.validate=function(){var b=Da.check();v("safari")&&9>v("safari")&&(b=new w("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:v("safari")}));return b?(Ga.warn("#validate()",b.message),
x.reject(b)):p.safeCast(J.loadArcade()).then(function(){},function(){})};g.prototype.isSpatialReferenceSupported=function(b,c,a){var e=b.isGeographic,d=b.isWebMercator,f=ka.isSpatialReferenceSupported(b,"global"),g="local"===this.viewingMode,p=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(p){if(g&&e)return a&&a("Layer "+c.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!f)return a&&a("Layer "+c.id+" is ignored because its spatial reference is not supported in global viewing mode"),
!1}else if(e&&!f)return a&&a("Layer "+c.id+" is ignored because its spatial reference is geographic but unsupported"),!1;if(c)if(Ca.isTiledLayer(c)){if(e=void 0,p?p=Ca.getTiledLayerInfo(c,b,this.viewingMode):(p=Ca.getTiledLayerInfo(c,b,"global"),null==p.tileInfo&&(p=Ca.getTiledLayerInfo(c,b,"local"))),e=null!=p.tileInfo,!e)return a&&a("Layer "+c.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((b.isWGS84||d)&&
!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=b),p||this.internallyReady||(this.viewingMode="global",a&&a("Viewing mode locked to global due to reprojectable layer "+c.id)),a&&a("Layer "+c.id+" is ignored because it supports server-side reprojection"),!1;return!0};g.prototype.whenReady=function(){var b=this;return x.create(function(c){b.internallyReady?c(b):b._resolveWhenReady.push(c)})};g.prototype.computeMapPointFromVec3d=function(b,c){var a=this.spatialReference||
f.SpatialReference.WGS84;pa.vectorToVector(b,this.renderSpatialReference,b,a)||(a=f.SpatialReference.WGS84,pa.vectorToVector(b,this.renderSpatialReference,b,a));c?(c.x=b[0],c.y=b[1],c.z=b[2],c.spatialReference=a):c=new f.Point(b,a);return c};g.prototype.engineToScreen=function(b,c){var a=E.createRenderScreenPointArray3();this.state.camera.projectPoint(b,a);b=E.screenPointArrayToObject(a);return E.renderToScreen(this,b,c)};g.prototype.flushDisplayModifications=function(){this._stage.processDirty()};
g.prototype.getDrawingOrder=function(b){return this.allLayerViews.findIndex(function(c){return c.layer&&c.layer.uid===b})};g.prototype.getViewForGraphic=function(b){return b.layer===this.graphics?this.graphicsView:b.layer?this.allLayerViews.find(function(c){return c.layer===b.layer}):null};g.prototype.graphicChanged=function(b){t.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(b)};g.prototype.whenViewForGraphic=function(b){var c=this;return b.layer===this?A.whenOnce(this,"graphicsView").then(function(){return c.graphicsView}):
b.layer?this.whenLayerView(b.layer):x.reject()};g.prototype.getStats=function(){var b=this.resourceController.memoryController,c=this.resourceController.scheduler,a={Memory:(b.usedMemory*b.maxMemory).toFixed(0)+"/"+b.maxMemory.toFixed(0)+"MB"};a.Quality=Math.round(100*b.memoryFactor)+"%";a.Load=c.load.toFixed(1);this.basemapTerrain&&(a.Terrain=za(this.basemapTerrain.getUsedMemory()));this.allLayerViews.items.forEach(function(b){da.isMemoryManagedLayerView(b)&&(a[b.layer.title]=za(b.getUsedMemory()))});
if(b=this._stage&&this._stage.renderView&&this._stage.renderView.edgeView)b=b.getUsedMemory(),1024<b&&(a.Edges=za(b));return a};g.prototype._intersectResultToMapPoint=function(b,c){if(b.getIntersectionPoint(fa)){c=this.computeMapPointFromVec3d(fa,c);var a=this.basemapTerrain;"TerrainRenderer"===b.intersector&&a&&(c.z=a.getElevation(c)||0);return c}return null};g.prototype._intersectResultsToHits=function(b,c){for(var a=[],e=null,d=0;d<b.length;d++){var f=b[d],g=f.toOwner(this);if(t.isSome(g)&&(g===
this.map.ground||"type"in g&&"integrated-mesh"===g.type))break;g=f.toGraphic(this);if(t.isSome(g)){t.isNone(e)&&d!==b.length-1&&(e=new Set);if(t.isSome(e)){var p=this._getGraphicFilterUid(g);if(e.has(p))continue;e.add(p)}this._testGraphicUidFilter(c,g)&&(p=this._intersectResultToMapPoint(f),a.push({graphic:g,mapPoint:p,distance:f.distanceInRenderSpace}))}}return a};g.prototype._getGraphicFilterUid=function(b){if(b.layer&&"objectIdField"in b.layer){var c=b.attributes[b.layer.objectIdField];if(c)return"o-"+
b.layer.id+"-"+c}return"u-"+b.uid};g.prototype._testGraphicUidFilter=function(b,c){c=this._getGraphicFilterUid(c);return t.isNone(b)||(t.isNone(b.include)||b.include.has(c))&&(t.isNone(b.exclude)||!b.exclude.has(c))};g.prototype._externalToInternalRenderItems=function(a,e,d){var f=this;void 0===d&&(d={layerUids:null,graphicUids:null});if(!a)return d;a instanceof c?(Ja(d,this._getGraphicFilterUid(a)),0===e&&(t.isSome(this.graphicsView)&&a.layer===this.graphicsView?Ia(d,this.graphicsView.mockLayerId):
a.layer&&Ia(d,a.layer.uid))):"forEach"in a?a.forEach(function(c){Array.isArray(c)?f._externalToInternalRenderItems(c,e,d):q.isCollection(c)?c===f.graphics&&t.isSome(f.graphicsView)?Ia(d,f.graphicsView.mockLayerId):f._externalToInternalRenderItems(c,e,d):c instanceof b?c===f.map.ground&&Ia(d,Ha.TERRAIN_ID):f._externalToInternalRenderItems(c,e,d)}):Ia(d,a.uid);return d};g.prototype._externalToInternalIntersectOptions=function(b){var c=this._externalToInternalRenderItems(b.include,0);b=this._externalToInternalRenderItems(b.exclude,
1);return{include:c.layerUids,exclude:b.layerUids,graphics:{include:c.graphicUids,exclude:b.graphicUids}}};g.prototype._viewingModeToManifold=function(b){switch(b){case "global":return"spherical";case "local":return"planar"}};g.prototype._initBasemapTerrain=function(b){var c=this;this._disposeBasemapTerrain();this._set("basemapTerrain",new S(this,this._viewingModeToManifold(b)));this._set("elevationProvider",new ba({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this.handles.add([this.updatingHandles.add(this,
"map.ground.opacity",function(b){return c.basemapTerrain.baseOpacity=null==b?1:b},3),this.updatingHandles.add(this,"map.ground.surfaceColor",function(b){c.basemapTerrain.backgroundColor=b},2)],"basemapTerrain")};g.prototype._initGlobe=function(b){var c=this;this._initCoordinateSystem();this._initState();this._initBasemapTerrain(b);this._set("pointsOfInterest",new na.default({view:this}));this._set("featureTiles",new aa.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,
focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));b=function(){var b=c.basemapTerrain&&c.basemapTerrain.extent;c.clippingArea||b?b&&c.basemapTerrain.spatialReference?(b=H.toExtent(c.basemapTerrain.extent,c.basemapTerrain.spatialReference),c.featureTiles.filterExtent=c.clippingArea?b.intersection(c.clippingArea):b):c.featureTiles.filterExtent=c.clippingArea:c.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(oa,
"FEATURE_TILE_TREE_SHOW_TILES",function(b){b&&c.featureTiles&&!c.featureTreeDebugger?(new Promise(function(b,c){n(["./3d/layers/support/FeatureTileTree3DDebugger"],b,c)})).then(function(b){b=b.FeatureTileTree3DDebugger;!c.featureTreeDebugger&&oa.FEATURE_TILE_TREE_SHOW_TILES&&(c.featureTreeDebugger=new b({view:c}))}):b||!c.featureTreeDebugger||oa.FEATURE_TILE_TREE_SHOW_TILES||(c.featureTreeDebugger.destroy(),c.featureTreeDebugger=null)},2),this.updatingHandles.add(this,"clippingArea",b,3),this.updatingHandles.add(this,
"basemapTerrain.extent",b,3)],"feature-tiles");this.stateManager.init()};g.prototype._initCoordinateSystem=function(){var b=this;if(this.spatialReference){var c=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(c)||this._set("mapCoordsHelper",new ja.default(this.map,c));var a="global"===this.viewingMode,c=a?pa.SphericalECEFSpatialReference:c;c!==this.renderSpatialReference&&(this.renderSpatialReference=c,this._set("renderCoordsHelper",wa.RenderCoordsHelper.createMode(this.viewingMode,
c)),a||this.handles.add(this.watch("basemapTerrain.extent",function(c){if(0!==c[0]||0!==c[1]||0!==c[2]||0!==c[3])b.renderCoordsHelper.extent=c},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Fa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null),this.renderSpatialReference=null};g.prototype.updatingChanged=function(){this.notifyChange("updating")};g.prototype._updateUpdatingMonitors=
function(){var b=this;this.handles.remove("updatingMonitors");this.allLayerViews.forEach(function(c){c.destroyed||(b.handles.add([c.watch(["updating","updatingPercentage"],function(){return b.updatingChanged()},!0)],"updatingMonitors"),c.when(function(){return b.updatingChanged()},function(){return b.updatingChanged()}))});this.updatingChanged()};g.prototype._disposeSurface=function(){var b=function(b){b&&b.remove();return null};this._updateDrawingOrderHandle=b(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=
b(this.onViewExtentUpdateHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this.handles.remove("feature-tiles");this.handles.remove("render-coords-helper");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};g.prototype._disposeBasemapTerrain=function(){var b=this._get("basemapTerrain");b&&(this.handles.remove("basemapTerrain"),
b.destroy(),this._set("basemapTerrain",null))};g.prototype._renderScreenshotOverlay=function(b,c){if(this.overlay&&this.overlay.hasVisibleItems){var a=b.getContext("2d");a.putImageData(c,0,0);this.overlay.renderCanvas(b);b=a.getImageData(0,0,c.width,c.height);for(a=0;a<b.data.length;a++)c.data[a]=b.data[a]}};g.prototype._initStage=function(){var b=this,c={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,viewingMode:this.viewingMode,
alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:function(c,a){return b._renderScreenshotOverlay(c,a)}}},a=new ia.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(c){b._stage.getLayers().forEach(c)}},this);this._set("sceneIntersectionHelper",a);var e=r.byId(this.surface);this._stage=new Ea.Stage({viewingMode:this.viewingMode,container:e,options:c,sceneIntersectionHelper:a});this._lostWebGLContextHandle=u.on(this._stage.renderView.getCanvas(),"webglcontextlost",
function(){return b.fatalError=new w("webgl-context-lost")});this.handles.add(this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",function(){b._stage.renderView.setRenderParameters({antialiasingEnabled:b.qualitySettings.antialiasingEnabled})},2),"stage");c=function(){b._stage.renderView.setRenderParameters({defaultHighlightOptions:ra.toEngineOptions(b.highlightOptions)})};a=0;for(e=["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity",
"highlightOptions.fillOpacity"];a<e.length;a++)this.handles.add(this.updatingHandles.add(this,e[a],c),"stage");c();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Fa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.getCanvas())};g.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new D.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,
pointsOfInterest:this.pointsOfInterest,viewState:this.state})};g.prototype._createGraphicsViewIfNeeded=function(){var b=this;if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=x.createAbortController();var c=function(){b._createGraphicsViewController=null;b.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(c,c);this.updatingChanged()}};g.prototype._createGraphicsViewAsync=
function(b){return d(this,void 0,void 0,function(){var c,a;return h(this,function(e){switch(e.label){case 0:return[4,x.create(function(b){return n(["./3d/layers/GraphicsView3D"],b)})];case 1:return c=e.sent(),x.throwIfAborted(b),[4,A.whenTrueOnce(this.basemapTerrain,"ready",b)];case 2:return e.sent(),a=new c({view:this}),this._set("graphicsView",a),[2]}})})};g.prototype._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=
null);this.handles.remove("graphics-view");t.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};g.prototype._initState=function(){this._set("state",new ga.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};g.prototype._viewReadyHandler=function(b){var c=this;b||("global"===this.viewingMode&&(this._clippingArea=null),this.internallyReady=!0,this._initSurface(),this.handles.add(A.on(this,
"graphics","after-changes",function(){return c._createGraphicsViewIfNeeded()}),"graphics-view"),this._createGraphicsViewIfNeeded(),this.updatingChanged(),!this._externallySet.environment&&(b=this.get("map.initialViewProperties.environment"))&&(this.environment=b),this._updateDrawingOrderHandle=this.allLayerViews.on("change",function(){return c._updateDrawingOrder()}),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0),this.inputManager.connect(),b=this._resolveWhenReady,
this._resolveWhenReady=[],b.forEach(function(b){return b(c)}))};g.prototype._viewUnreadyHandler=function(b){b&&(t.isSome(this.activeTool)&&(this.activeTool.deactivate&&this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this.internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",null),this.sharedSymbolResources&&
(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._stage&&(this._stage.destroy(),this._stage=null),this.handles.remove("stage"),this._set("canvas",null))};g.prototype._updateDrawingOrder=function(){var b=this.allLayerViews.length-1;this.allLayerViews.forEach(function(c,a){"drawingOrder"in c&&(c.drawingOrder=b-a)})};g.prototype._updateDefaultToMapOptions=
function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ha.TERRAIN_ID);for(var b=0,c=this.map.allLayers.items;b<c.length;b++){var a=c[b];"integrated-mesh"===a.type&&this._defaultToMapOptions.include.add(a.uid)}}};g.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ha.TERRAIN_ID);for(var b=0,c=this.map.allLayers.items;b<
c.length;b++){var a=c[b];"integrated-mesh"===a.type&&1>a.opacity&&this._defaultToMapOptions.exclude.add(a.uid)}}};k([B.property()],g.prototype,"_resourceController",void 0);k([B.property()],g.prototype,"_stage",void 0);k([B.property()],g.prototype,"deconflictor",void 0);k([B.property()],g.prototype,"labeler",void 0);k([B.property({type:U,readOnly:!0,aliasOf:"state.animation"})],g.prototype,"animation",void 0);k([B.property({readOnly:!0})],g.prototype,"basemapTerrain",void 0);k([B.property({readOnly:!0})],
g.prototype,"elevationProvider",void 0);k([B.property({type:l,aliasOf:"stateManager.camera"})],g.prototype,"camera",void 0);k([B.property({readOnly:!0})],g.prototype,"canvas",void 0);k([B.property({type:f.Point,aliasOf:"stateManager.center"})],g.prototype,"center",void 0);k([B.property({type:f.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],g.prototype,"clippingArea",null);k([B.property({type:P.default})],g.prototype,"constraints",void 0);k([B.property({type:f.Extent,
dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],g.prototype,"dataExtent",null);k([B.property({value:null,type:V})],g.prototype,"environment",null);k([B.cast("environment")],g.prototype,"castEnvironment",null);k([B.property()],g.prototype,"environmentManager",void 0);k([B.property({type:f.Extent,aliasOf:"stateManager.extent"})],g.prototype,"extent",void 0);k([B.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],g.prototype,"screenCenter",void 0);k([B.property({type:Number,
dependsOn:["maximumPixelRatio"]})],g.prototype,"pixelRatio",null);k([B.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],g.prototype,"maximumPixelRatio",null);k([B.property({aliasOf:"stateManager.frustum"})],g.prototype,"frustum",void 0);k([B.property({type:Number,readOnly:!0})],g.prototype,"fullOpacity",void 0);k([B.property({readOnly:!0})],g.prototype,"graphicsView",void 0);k([B.property({type:f.Extent,dependsOn:["basemapTerrain.extent"],
readOnly:!0})],g.prototype,"groundExtent",null);k([B.property()],g.prototype,"groundView",void 0);k([B.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],g.prototype,"initialExtentRequired",null);k([B.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],g.prototype,"interacting",null);k([B.property()],g.prototype,"map",void 0);k([B.property({readOnly:!0})],g.prototype,"mapCoordsHelper",void 0);k([B.property({aliasOf:"stateManager.padding"})],g.prototype,"padding",
void 0);k([B.property({type:na.default,readOnly:!0})],g.prototype,"pointsOfInterest",void 0);k([B.property({type:aa.default,readOnly:!0})],g.prototype,"featureTiles",void 0);k([B.property()],g.prototype,"featureTreeDebugger",void 0);k([B.property({type:Boolean})],g.prototype,"screenSizePerspectiveEnabled",void 0);k([B.property({constructOnly:!0})],g.prototype,"deactivatedWebGLExtensions",void 0);k([B.property({constructOnly:!0})],g.prototype,"debugWebGLExtensions",void 0);k([B.property({constructOnly:!0})],
g.prototype,"renderCanvas",void 0);k([B.property({readOnly:!0})],g.prototype,"state",void 0);k([B.property({readOnly:!0})],g.prototype,"inputManager",void 0);k([B.property({readOnly:!0})],g.prototype,"stateManager",void 0);k([B.property({type:["low","medium","high"]})],g.prototype,"qualityProfile",null);k([B.property({type:ua,get:function(){var b=this._get("qualitySettings");b||(b=new ua,ha.apply(this.qualityProfile,b));return b}})],g.prototype,"qualitySettings",void 0);k([B.property()],g.prototype,
"slicePlane",null);k([B.property({dependsOn:["viewingMode"]})],g.prototype,"ready",void 0);k([B.property({readOnly:!0})],g.prototype,"renderCoordsHelper",void 0);k([B.property({readOnly:!0})],g.prototype,"sceneIntersectionHelper",void 0);k([B.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],g.prototype,"resolution",null);k([B.property({type:Number,aliasOf:"stateManager.scale"})],g.prototype,"scale",void 0);k([B.property()],g.prototype,"heightModelInfo",null);k([B.property({dependsOn:["map.initialViewProperties?.spatialReference",
"defaultsFromMap.isSpatialReferenceDone"]})],g.prototype,"spatialReference",void 0);k([B.property({type:Boolean,constructOnly:!0})],g.prototype,"alphaCompositingEnabled",void 0);k([B.property({type:Boolean})],g.prototype,"supersampleScreenhotsEnabled",void 0);k([B.property({readOnly:!0})],g.prototype,"type",void 0);k([B.property({type:La})],g.prototype,"ui",void 0);k([B.property({type:Boolean,readOnly:!0,dependsOn:"_resourceController.updating labeler.updating layerViewManager.updating deconflictor.updating environmentManager.updating inputManager.hasPendingInputs basemapView.updating basemapTerrain.updating featureTiles.updating pointsOfInterest.updating graphicsView.updating _stage.renderView.updating ready stationary overlay.updating updatingHandles.updating featureTreeDebugger.updating".split(" ")})],
g.prototype,"updating",null);k([B.property({type:Number,readOnly:!0})],g.prototype,"updatingPercentage",void 0);k([B.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],g.prototype,"viewingMode",null);k([B.property({type:e,aliasOf:"stateManager.viewpoint"})],g.prototype,"viewpoint",void 0);k([B.property({type:Number,aliasOf:"stateManager.zoom"})],g.prototype,"zoom",void 0);k([B.property({type:ra})],g.prototype,"highlightOptions",void 0);return g=
k([B.subclass("esri.views.SceneView")],g)}(B.declared(M.BreakpointsOwner(L.DOMContainer(O.PopupView(T)))));var fa=F.vec3f64.create();return a})},"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../config","../../core/unitUtils"],function(n,a,m,k){function h(a,g){g=k.getMetersPerUnitForSR(g);return a/(g*k.inchesPerMeter*m.screenDPI)}Object.defineProperty(a,"__esModule",{value:!0});a.getScale=function(a,g){g=g||a.extent;a=a.width;var d=k.getMetersPerUnitForSR(g&&g.spatialReference);
return g&&a?g.width/a*d*k.inchesPerMeter*m.screenDPI:0};a.getResolutionForScale=h;a.getScaleForResolution=function(a,g){g=k.getMetersPerUnitForSR(g);return a*g*k.inchesPerMeter*m.screenDPI};a.getExtentForScale=function(a,g){var d=a.extent;a=a.width;g=h(g,d.spatialReference);return d.clone().expand(g*a/d.width)}})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators".split(" "),
function(n,a,m,k,h,d,g,l,f){function c(c,a){return a?b[c].valueToClassName[a].split(" "):[]}Object.defineProperty(a,"__esModule",{value:!0});var b={widthBreakpoint:{getValue:function(b){var c=b.viewSize[0];b=b.breakpoints;var a=this.values;return c<=b.xsmall?a.xsmall:c<=b.small?a.small:c<=b.medium?a.medium:c<=b.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(b){var c=b.viewSize[1];b=b.breakpoints;var a=this.values;return c<=b.xsmall?a.xsmall:c<=b.small?a.small:c<=b.medium?a.medium:c<=b.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(b){b=b.viewSize;var c=this.values;return b[1]>=b[0]?c.portrait:c.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},e={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=
function(a){return function(a){function p(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._breakpointsHandles=new g;b.orientation=null;b.widthBreakpoint=null;b.heightBreakpoint=null;b.breakpoints=e;return b}m(p,a);p.prototype.initialize=function(){this._breakpointsHandles.add(l.init(this,["breakpoints","size"],this._updateClassNames))};p.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=
null)};Object.defineProperty(p.prototype,"breakpoints",{set:function(b){var c=this._get("breakpoints");if(b!==c){c=(c=b)&&c.xsmall<c.small&&c.small<c.medium&&c.medium<c.large;if(!c){var a=JSON.stringify(e,null,2);console.warn("provided breakpoints are not valid, using defaults:"+a)}b=c?b:e;this._set("breakpoints",h({},b))}},enumerable:!0,configurable:!0});p.prototype._updateClassNames=function(){if(this.container){var a=d.acquire(),e=d.acquire(),f=!1,g;for(g in b){var p=this[g],l=b[g].getValue({viewSize:this.size,
breakpoints:this.breakpoints});p!==l&&(f=!0,this[g]=l,c(g,p).forEach(function(b){return e.push(b)}),c(g,l).forEach(function(b){return a.push(b)}))}f&&(this._applyClassNameChanges(a,e),d.release(a),d.release(e))}};p.prototype._applyClassNameChanges=function(b,c){var a=this.container;a&&(c.forEach(function(b){return a.classList.remove(b)}),b.forEach(function(b){return a.classList.add(b)}))};p.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var e in b)c(e,this[e]).forEach(function(b){return a.classList.remove(b)})};
k([f.property()],p.prototype,"breakpoints",null);k([f.property()],p.prototype,"orientation",void 0);k([f.property()],p.prototype,"widthBreakpoint",void 0);k([f.property()],p.prototype,"heightBreakpoint",void 0);return p=k([f.subclass("esri.views.BreakpointsOwner")],p)}(f.declared(a))}})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),
function(n,a,m,k,h,d,g,l,f,c){return function(b){function a(c){c=b.call(this)||this;c.handles=new g;c.view=null;c.layerViews=new d;return c}m(a,b);a.prototype.initialize=function(){var b=this;this.handles.add(l.when(this,"view.map.ground",function(b){return b.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return b.layerViewsAfterChangesHandler()}))};a.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(a.prototype,
"elevationSampler",{get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new c({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(b){return b.updating})},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});
a.prototype.layerViewsAfterChangesHandler=function(){var b=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(c){return c.watch("updating",function(){return b.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};a.prototype.updateUpdating=function(){this.notifyChange("updating")};k([f.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],a.prototype,"elevationSampler",null);k([f.property({type:Boolean,dependsOn:["suspended"],
readOnly:!0})],a.prototype,"updating",null);k([f.property({constructOnly:!0})],a.prototype,"view",void 0);k([f.property({type:d,readOnly:!0})],a.prototype,"layerViews",void 0);k([f.property({readOnly:!0,dependsOn:["view.suspended"]})],a.prototype,"suspended",null);return a=k([f.subclass("esri.views.GroundView")],a)}(f.declared(h))})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){var p=d.getLogger("esri.views.support.GroundViewElevationSampler");return function(a){function d(b){b=a.call(this,b)||this;b.demResolution={min:-1,max:-1};b.noDataValue=e.ELEVATION_NODATA_VALUE;return b}m(d,a);d.prototype.initialize=function(){var b=this;this.view.basemapTerrain.on("elevation-change",function(){return b.emit("changed",{})})};Object.defineProperty(d.prototype,"extent",{get:function(){var b=this.view.basemapTerrain;return b.extent&&b.spatialReference?
l.toExtent(b.extent,b.spatialReference):null},enumerable:!0,configurable:!0});d.prototype.elevationAt=function(b){var a=b.spatialReference,e=this.spatialReference;if(!c.canProject(a,e))return p.error("Cannot sample elevation at a location with spatial reference ("+(a?a.wkid:"unknown")+") different from the view ("+e.wkid+")"),null;f.extentContainsPoint(this.extent,b)||(a=this.extent,p.warn("#elevationAt()","Point used to sample elevation ("+b.x+", "+b.y+") is outside of the sampler extent ("+(a.xmin+
", "+a.ymin+", "+a.xmax+", "+a.ymax)+")"));return this.view.basemapTerrain.getElevation(b)};d.prototype.queryElevation=function(c){return b.updateGeometryElevation(c.clone(),this)};k([g.property({readOnly:!0})],d.prototype,"demResolution",void 0);k([g.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],d.prototype,"extent",null);k([g.property({readOnly:!0})],d.prototype,"noDataValue",void 0);k([g.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
d.prototype,"spatialReference",void 0);k([g.property({constructOnly:!0})],d.prototype,"view",void 0);return d=k([g.subclass("esri.views.support.GroundViewElevationSampler")],d)}(g.declared(h.EventedAccessor))})},"esri/layers/support/ElevationSampler":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c){function b(b,c){var a=e(b,c.spatialReference);if(!a)return null;switch(b.type){case "point":b.z=c.elevationAt(a)||0;break;case "polyline":r.spatialReference=a.spatialReference;for(var d=b.hasM&&!b.hasZ,f=0;f<b.paths.length;f++)for(var g=b.paths[f],p=a.paths[f],l=0;l<g.length;l++){var q=g[l],k=p[l];r.x=k[0];r.y=k[1];k=c.elevationAt(r)||0;d&&(q[3]=q[2]);q[2]=k}b.hasZ=!0;break;case "multipoint":r.spatialReference=a.spatialReference;d=b.hasM&&!b.hasZ;for(f=0;f<b.points.length;f++)g=
b.points[f],p=a.points[f],r.x=p[0],r.y=p[1],p=c.elevationAt(r)||0,d&&(g[3]=g[2]),g[2]=p;b.hasZ=!0;break;default:h.neverReached(b)}return b}function e(b,a){var e=b.spatialReference;return e.equals(a)?b:c.canProject(e,a)?c.project(b,a):(p.error("Cannot project geometry spatial reference (wkid:"+e.wkid+") to elevation sampler spatial reference (wkid:"+a.wkid+")"),null)}Object.defineProperty(a,"__esModule",{value:!0});var p=d.getLogger("esri.layers.support.ElevationSampler");n=function(){function c(){}
c.prototype.queryElevation=function(c){return b(c.clone(),this)};c.prototype.on=function(b,c){return w};c.prototype.projectIfRequired=function(b,c){return e(b,c)};return c}();a.ElevationSamplerBase=n;var q=function(b){function c(c,a,e){var d=b.call(this)||this;d.tile=c;d.noDataValue=e;d.extent=l.toExtent(c.tile.extent,a.spatialReference);e=g.getMetersPerUnitForSR(a.spatialReference);c=a.lodAt(c.tile.level).resolution*e;d.demResolution={min:c,max:c};return d}m(c,b);Object.defineProperty(c.prototype,
"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});c.prototype.contains=function(b){b=this.projectIfRequired(b,this.spatialReference);return f.extentContainsPoint(this.extent,b)};c.prototype.elevationAt=function(b){var c=this.projectIfRequired(b,this.spatialReference);if(!c)return null;if(!this.contains(b)){var a=this.extent;p.warn("#elevationAt()","Point used to sample elevation ("+b.x+", "+b.y+") is outside of the sampler extent ("+(a.xmin+", "+
a.ymin+", "+a.xmax+", "+a.ymax)+")")}return this.tile.sample(c.x,c.y)};return c}(n);a.TileElevationSampler=q;n=function(b){function c(c,a,e){var d=b.call(this)||this,f;"number"===typeof a?(d.noDataValue=a,f=null):(f=a,d.noDataValue=e);d.samplers=f?c.map(function(b){return new q(b,f,d.noDataValue)}):c;if(c=d.samplers[0])for(d.extent=c.extent.clone(),c=c.demResolution,d.demResolution={min:c.min,max:c.max},c=1;c<d.samplers.length;c++)a=d.samplers[c],d.extent.union(a.extent),d.demResolution.min=Math.min(d.demResolution.min,
a.demResolution.min),d.demResolution.max=Math.max(d.demResolution.max,a.demResolution.max);else d.extent=l.toExtent(l.create(),f.spatialReference),d.demResolution={min:0,max:0};return d}m(c,b);Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});c.prototype.elevationAt=function(b){var c=this.projectIfRequired(b,this.spatialReference);if(!c)return null;for(var a=0,e=this.samplers;a<e.length;a++){var d=e[a];if(d.contains(c))return d.elevationAt(c)}p.warn("#elevationAt()",
"Point used to sample elevation ("+b.x+", "+b.y+") is outside of the sampler");return null};return c}(n);a.MultiTileElevationSampler=n;a.updateGeometryElevation=b;var r=new k.Point,w={remove:function(){}}})},"esri/views/3d/terrain/TerrainConst":function(){define("require exports ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ../../../layers/support/TilemapCache ./TilingScheme".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});a.TILE_LOADING_DEBUGLOG=
!1;a.MAX_ROOT_TILES=64;a.MAX_PATCH_TESSELATION=512;a.MAX_MEMORY_LOD_BIAS=2.5;a.ELEVATION_NODATA_VALUE=m.clampFloat32(m.NUMBER_MAX_FLOAT32/10);a.START_LOADING_LEVEL_DELTA=8;a.LOADING_LEVEL_MODULO=2;a.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;a.TILEMAP_SIZE=1<<h.TILEMAP_SIZE_EXP;a.WEBMERCATOR_WORLD_EXTENT=k.create();d.WebMercatorAuxiliarySphere.getExtent(0,0,0,a.WEBMERCATOR_WORLD_EXTENT);a.GEOGRAPHIC_WORLD_EXTENT=k.create([-180,-90,180,90]);a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";
a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.GEOMETRY_VERTEX_STRIDE=5})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/projectionUtils".split(" "),function(n,a,m,k,h,d,g,l,f,c){var b=c.webMercator.x2lon,e=c.webMercator.y2lat;n=function(){function a(b){var e=a.checkUnsupported(b);if(e)throw e;this.spatialReference=
b.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84Comparable=c.canProjectToWGS84ComparableLonLat(this.spatialReference);this.origin=[b.origin.x,b.origin.y];this.pixelSize=b.size[0];this.dpi=b.dpi;var d=b.lods.reduce(function(b,c,a){c.level<b.min&&(b.min=c.level,b.minIndex=a);b.max=Math.max(b.max,c.level);return b},{min:Infinity,minIndex:0,max:-Infinity}),f=b.lods[d.minIndex],g=Math.pow(2,f.level),e=f.resolution*g,f=f.scale*g;this.levels=Array(d.max+1);for(d=0;d<
this.levels.length;d++)this.levels[d]={resolution:e,scale:f,tileSize:[e*b.size[0],e*b.size[1]]},e/=2,f/=2}a.prototype.clone=function(){return new a(this.toTileInfo())};a.prototype.toTileInfo=function(){return new f({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(function(b,c){return{level:c,scale:b.scale,resolution:b.resolution}})})};a.prototype.getExtent=
function(c,a,d,f,g){void 0===f&&(f=l.create());var p=this.levels[c];c=p.tileSize[0];p=p.tileSize[1];f[0]=this.origin[0]+d*c;f[2]=f[0]+c;f[3]=this.origin[1]-a*p;f[1]=f[3]-p;g&&(this._isWebMercator?(g[0]=b(f[0]),g[1]=e(f[1]),g[2]=b(f[2]),g[3]=e(f[3])):this._isWGS84Comparable&&(g[0]=h.deg2rad(f[0]),g[1]=h.deg2rad(f[1]),g[2]=h.deg2rad(f[2]),g[3]=h.deg2rad(f[3])));return f};a.prototype.getExtentGeometry=function(b,c,a,e){void 0===e&&(e=new m.Extent);this.getExtent(b,c,a,p);e.spatialReference=this.spatialReference;
e.xmin=p[0];e.ymin=p[1];e.xmax=p[2];e.ymax=p[3];e.zmin=void 0;e.zmax=void 0;return e};a.prototype.ensureMaxLod=function(b){if(null==b)return!1;for(var c=!1;this.levels.length<=b;){var c=this.levels[this.levels.length-1],a=c.resolution/2;this.levels.push({resolution:a,scale:c.scale/2,tileSize:[a*this.pixelSize,a*this.pixelSize]});c=!0}return c};a.prototype.capMaxLod=function(b){this.levels.length>b+1&&(this.levels.length=b+1)};a.prototype.getMaxLod=function(){return this.levels.length-1};a.prototype.scaleAtLevel=
function(b){return this.levels[0].scale/Math.pow(2,b)};a.prototype.levelAtScale=function(b){var c=this.levels[0].scale;return b>=c?0:Math.log(c/b)*Math.LOG2E};a.prototype.resolutionAtLevel=function(b){return this.levels[0].resolution/Math.pow(2,b)};a.prototype.compatibleWith=function(b){if(!(b instanceof a)){if(a.checkUnsupported(b))return!1;b=new a(b)}if(!b.spatialReference.equals(this.spatialReference)||b.pixelSize!==this.pixelSize)return!1;var c=Math.min(this.levels.length,b.levels.length)-1,e=
this.levels[c].resolution,d=.5*e;if(!h.floatEqualAbsolute(b.origin[0],this.origin[0],d)||!h.floatEqualAbsolute(b.origin[1],this.origin[1],d))return!1;d=.5*e/Math.pow(2,c)/this.pixelSize*12;return h.floatEqualAbsolute(e,b.levels[c].resolution,d)};a.prototype.rootTilesInExtent=function(b,c,e){var d=this.levels[0].tileSize;if(0===d[0]||0===d[1])return[];a.computeRowColExtent(b,d,this.origin,p);b=p[1];var f=p[3],g=p[0],l=p[2],q=l-g,h=f-b;q*h>e&&(e=Math.floor(Math.sqrt(e)),h>e&&(b=b+Math.floor(.5*h)-Math.floor(.5*
e),f=b+e),q>e&&(g=g+Math.floor(.5*q)-Math.floor(.5*e),l=g+e));e=Array((l-g)*(f-b));q=0;for(h=b;h<f;h++)for(var k=g;k<l;k++)e[q++]=[0,h,k];c&&(c[0]=this.origin[0]+g*d[0],c[1]=this.origin[1]-f*d[1],c[2]=this.origin[0]+l*d[0],c[3]=this.origin[1]-b*d[1]);return e};a.computeRowColExtent=function(b,c,a,e){var d=.001*(b[2]-b[0]+(b[3]-b[1]));e[0]=Math.floor((b[0]+d-a[0])/c[0]);e[2]=Math.ceil((b[2]-d-a[0])/c[0]);e[1]=Math.floor((a[1]-b[3]+d)/c[1]);e[3]=Math.ceil((a[1]-b[1]-d)/c[1])};a.isPowerOfTwo=function(b){b=
b.lods;var c=b[0].resolution*Math.pow(2,b[0].level);return!b.some(function(b){return!h.floatEqualRelative(b.resolution,c/Math.pow(2,b.level))})};a.hasGapInLevels=function(b){b=b.lods.map(function(b){return b.level});b.sort(function(b,c){return b-c});for(var c=1;c<b.length;c++)if(b[c]!==b[0]+c)return!0;return!1};a.tileSizeSupported=function(b){var c=b.size[1];return c===b.size[0]&&0===(c&c-1)&&128<=c&&512>=c};a.checkUnsupported=function(b){return b?1>b.lods.length?new k("tilingscheme:generic","Tiling scheme must have at least one level"):
a.isPowerOfTwo(b)?a.hasGapInLevels(b)?new k("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):a.tileSizeSupported(b)?null:new k("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new k("tilingscheme:power-of-two","Tiling scheme must be power of two"):new k("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};a.fromExtent=function(b,c){var e=b[2]-b[0],g=b[3]-b[1],p=d.getMetersPerUnitForSR(c),l=1.2*
Math.max(e,g);b=new a(new f({size:[256,256],origin:{x:b[0]-.5*(l-e),y:b[3]+.5*(l-g)},lods:[{level:0,resolution:l/256,scale:1/(256/96*.0254/(l*p))}],spatialReference:c}));b.ensureMaxLod(20);return b};a.makeWebMercatorAuxiliarySphere=function(b){var c=new a(a.WebMercatorAuxiliarySphereTileInfo);c.ensureMaxLod(b);return c};a.makeGCSWithTileSize=function(b,c,e){void 0===c&&(c=256);void 0===e&&(e=16);var d=256/c;b=new a(new f({size:[c,c],origin:{x:-180,y:90,spatialReference:b},spatialReference:b,lods:[{level:0,
resolution:.703125*d,scale:2.95497598570834E8*d}]}));b.ensureMaxLod(e);return b};Object.defineProperty(a.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!0,configurable:!0});a.WebMercatorAuxiliarySphereTileInfo=new f({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:g.WebMercator},spatialReference:g.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});a.WebMercatorAuxiliarySphere=
a.makeWebMercatorAuxiliarySphere(19);return a}();var p=l.create();return n})},"esri/views/PopupView":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/arrayUtils ../core/asyncUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});
a.PopupView=function(a){return function(a){function p(){return null!==a&&a.apply(this,arguments)||this}k(p,a);p.prototype.when=function(b,c){return this.inherited(arguments)};p.prototype.fetchPopupFeatures=function(b,c){return f.safeCast(this._fetchPopupFeaturesAsync(b,c))};p.prototype._fetchPopupFeaturesAsync=function(c,a){return d(this,void 0,void 0,function(){var e,d,f,p,q,h;return g(this,function(g){switch(g.label){case 0:return[4,this.when()];case 1:return g.sent(),[4,this._prepareFetchPopupFeatures(c,
a)];case 2:return e=g.sent(),d=e.location,f=this._queryLayerPopupFeatures(e,a),p=b.resolve(e.clientOnlyGraphics),q=[p].concat(f),h=b.eachAlwaysValues(q).then(l.flatten),[2,{promise:h,location:d,promises:q}]}})})};p.prototype._queryLayerPopupFeatures=function(b,a){var e=b.queryArea;return b.layerViewsAndGraphics.map(function(b){var d=b.layerView;b={clientGraphics:b.graphics,signal:c.isSome(a)?a.signal:null,defaultPopupTemplateEnabled:c.isSome(a)?!!a.defaultPopupTemplateEnabled:!1};return d.fetchPopupFeatures(e,
b)})};p.prototype._isValidPopupGraphic=function(b,a){return b&&!!b.getEffectivePopupTemplate(c.isSome(a)&&a.defaultPopupTemplateEnabled)};p.prototype._prepareFetchPopupFeatures=function(b,c){return d(this,void 0,void 0,function(){var a,e,d,f,p,l,q,h;return g(this,function(g){switch(g.label){case 0:return[4,this._popupHitTestGraphics(b,c)];case 1:return a=g.sent(),e=a.clientGraphics,d=a.queryArea,f=a.location,p=this._getFetchPopupLayerViews(),l=this._graphicsPerFetchPopupLayerView(e,p),q=l.layerViewsAndGraphics,
h=l.clientOnlyGraphics,[2,{clientOnlyGraphics:h,layerViewsAndGraphics:q,queryArea:d,location:f}]}})})};p.prototype._popupHitTestGraphics=function(b,c){return d(this,void 0,void 0,function(){var a,e,d,f,p,l,q=this;return g(this,function(g){switch(g.label){case 0:return[4,this.popupHitTest(b)];case 1:return a=g.sent(),e=a.results,d=a.mapPoint,f=e.filter(function(b){return q._isValidPopupGraphic(b.graphic,c)}),p=f.length?f[0].mapPoint:null,l=f.map(function(b){return b.graphic}),[2,{clientGraphics:l,
queryArea:d,location:d||p}]}})})};p.prototype._getFetchPopupLayerViews=function(){var b=this,a=[];this.allLayerViews.forEach(function(c){b._isValidPopupLayerView(c)&&a.push(c)});c.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&a.push(this.graphicsView);return a.reverse()};p.prototype._isValidPopupLayerView=function(b){return c.isSome(b)&&(!("layer"in b)||!b.suspended)&&"fetchPopupFeatures"in b};p.prototype._graphicsPerFetchPopupLayerView=function(b,c){var a=[],e=new Map;
c=c.map(function(b){var c=[];"layer"in b?e.set(b.layer,c):e.set(b.graphics,c);return{layerView:b,graphics:c}});for(var d=0;d<b.length;d++){var f=b[d],g=e.get(f.layer)||null;g?g.push(f):a.push(f)}return{layerViewsAndGraphics:c,clientOnlyGraphics:a}};return p=h([e.subclass("esri.views.PopupView")],p)}(e.declared(a))}})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});n=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.tilt=new c.default;a.altitude=new g.default;a.clipDistance=new l.default;a.collision=new f.default;return a}m(a,b);k([d.property({type:c.default})],a.prototype,"tilt",void 0);k([d.property({type:g.default})],a.prototype,"altitude",void 0);k([d.property({type:l.default})],a.prototype,"clipDistance",void 0);k([d.property({type:f.default})],a.prototype,
"collision",void 0);return a=k([d.subclass("esri.views.3d.constraints.Constraints")],a)}(d.declared(h));a.Constraints=n;a.default=n})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(){var b=
null!==a&&a.apply(this,arguments)||this;b.min=l.AltitudeDefault.min;b.max=l.AltitudeDefault.max;return b}m(c,a);Object.defineProperty(c.prototype,"mode",{get:function(){h.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(b){h.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});k([g.property({type:Number})],c.prototype,"min",void 0);k([g.property({type:Number})],c.prototype,"max",void 0);return c=k([g.subclass("esri.views.3d.constraints.AltitudeConstraint")],c)}(g.declared(d));a.AltitudeConstraint=n;a.default=n})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});var e=d.getLogger("esri.views.3d.state.Constraints");n=function(c){function d(b){b=c.call(this)||this;b.collision=new q;b.distance=Infinity;b.minimumPoiDistance=4;return b}m(d,c);Object.defineProperty(d.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(b){"local"===this.mode?e.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",b)},enumerable:!0,
configurable:!0});d.prototype.clampAltitude=function(b){return this.altitude?g.clamp(b,this.altitude.min,this.altitude.max):b};d.prototype.clampTilt=function(b,c){if(!this.tilt)return c;b=this.tilt(b);return g.clamp(c,b.min,b.max)};d.prototype.clampDistance=function(b){return Math.min(b,this.distance)};d.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};d.prototype.createConstantMaxTilt=function(b){return function(c,e){void 0===
e&&(e=p);e.min=a.TiltDefault.min;e.max=b;return e}};d.prototype.createDefaultTiltLocal=function(){var c=this.collision.enabled?b.makePiecewiseLinearFunction([[4E3,a.TiltDefault.max],[1E4,l.deg2rad(88)],[6E6,l.deg2rad(88)]]):function(){return a.TiltDefault.max};return function(b,e){void 0===e&&(e=p);e.min=a.TiltDefault.min;e.max=c(b);return e}};d.prototype.createDefaultTiltGlobal=function(){var c=this.collision.enabled?b.makePiecewiseLinearFunction([[4E3,a.TiltDefault.max],[5E4,l.deg2rad(88)],[6E6,
l.deg2rad(88)],[2E7,a.TiltDefault.min]]):b.makePiecewiseLinearFunction([[3E5,a.TiltDefault.max],[3E6,l.deg2rad(88)],[6E6,l.deg2rad(88)],[2E7,a.TiltDefault.min]]);return function(b,e){void 0===e&&(e=p);e.min=a.TiltDefault.min;e.max=c(b);return e}};k([f.property()],d.prototype,"altitude",null);k([f.property({readOnly:!0})],d.prototype,"collision",void 0);k([f.property()],d.prototype,"distance",void 0);k([f.property({readOnly:!0})],d.prototype,"minimumPoiDistance",void 0);k([f.property()],d.prototype,
"tilt",void 0);k([f.property({constructOnly:!0})],d.prototype,"mode",void 0);return d=k([f.subclass("esri.views.3d.state.Constraints")],d)}(f.declared(h));a.Constraints=n;a.AltitudeDefault={min:-2E5,max:4*c.earthRadius};a.TiltDefault={min:l.deg2rad(.5),max:l.deg2rad(179.5)};var p={min:0,max:0},q=function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c.enabled=!0;c.elevationMargin=5;return c}m(c,b);k([f.property({type:Boolean})],c.prototype,"enabled",void 0);k([f.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=k([f.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(f.declared(h));a.default=n})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(){var d=
null!==a&&a.apply(this,arguments)||this;d.mode="auto";return d}m(g,a);Object.defineProperty(g.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});g.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(g.prototype,"far",{get:function(){return this._get("far")},set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});g.prototype.castFar=function(a){return Math.max(1E-8,a)};g.prototype.autoUpdate=function(a,c){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==c&&this._set("far",c))};k([d.property({type:Number,value:1E-8})],g.prototype,"near",null);k([d.cast("near")],g.prototype,"castNear",null);k([d.property({type:Number,value:1E-8})],g.prototype,"far",null);k([d.cast("far")],g.prototype,"castFar",null);k([d.property({type:["auto","manual"]})],
g.prototype,"mode",void 0);return g=k([d.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],g)}(d.declared(h));a.ClipDistanceConstraint=n;a.default=n})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){return null!==
a&&a.apply(this,arguments)||this}m(d,a);Object.defineProperty(d.prototype,"enabled",{set:function(c){h.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",c)},enumerable:!0,configurable:!0});k([g.property({value:!0})],d.prototype,"enabled",null);return d=k([g.subclass("esri.views.3d.constraints.CollisionConstraint")],d)}(g.declared(d));a.CollisionConstraint=n;a.default=n})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});var f=d.rad2deg(l.TiltDefault.min),c=d.rad2deg(l.TiltDefault.max);n=function(b){function a(){var c=null!==b&&b.apply(this,arguments)||this;c.mode="auto";return c}m(a,b);Object.defineProperty(a.prototype,"max",{get:function(){return this._get("max")},set:function(b){this._set("max",b);this.mode="manual"},enumerable:!0,configurable:!0});a.prototype.castMax=function(b){return d.clamp(b,f,c)};a.prototype.autoUpdate=function(b){"auto"===
this.mode&&this._get("max")!==b&&this._set("max",b)};k([g.property({type:["auto","manual"]})],a.prototype,"mode",void 0);k([g.property({type:Number,value:c})],a.prototype,"max",null);k([g.cast("max")],a.prototype,"castMax",null);return a=k([g.subclass("esri.views.3d.constraints.TiltConstraint")],a)}(g.declared(h));a.TiltConstraint=n;a.default=n})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){return function(b){function a(c){c=b.call(this,c)||this;c.atmosphere=new f.default;return c}m(a,b);p=a;a.fromWebsceneEnvironment=function(b){b=b.cloneConstructProperties();return new p(h({},b,{lighting:c.SceneViewLighting.fromWebsceneLighting(b.lighting)}))};a.prototype.castLighting=function(b){return b?b instanceof c.SceneViewLighting?b:b instanceof e?this.lighting?this.lighting.cloneWithWebsceneLighting(b):c.SceneViewLighting.fromWebsceneLighting(b):l.ensureType(c.SceneViewLighting,
b):new c.SceneViewLighting};a.prototype.clone=function(){return new p({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:d.clone(this.background)})};var p;k([g.property({type:f.default,json:{read:!1}})],a.prototype,"atmosphere",void 0);k([g.property()],a.prototype,"lighting",void 0);k([g.cast("lighting")],a.prototype,"castLighting",null);return a=p=k([g.subclass("esri.views.3d.environment.SceneViewEnvironment")],
a)}(g.declared(b))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(){return null!==a&&a.apply(this,arguments)||this}m(g,a);f=g;Object.defineProperty(g.prototype,"quality",{set:function(c){-1!==["low","high"].indexOf(c)&&
this._set("quality",c)},enumerable:!0,configurable:!0});g.prototype.clone=function(){return new f({quality:this.quality})};var f;k([d.property({type:["low","high"],value:"low"})],g.prototype,"quality",null);return g=f=k([d.subclass("esri.views.3d.environment.SceneViewAtmosphere")],g)}(d.declared(h));a.SceneViewAtmosphere=n;a.default=n})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(c){function b(b){b=c.call(this,b)||this;b.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};b.cameraTrackingEnabled=!0;b.ambientOcclusionEnabled=!1;var a=(new Date).getFullYear(),a=new Date("March 15, "+a+" 12:00:00 UTC");b._set("defaultDate",a);b._set("date",a);return b}m(b,c);a=b;b.fromWebsceneLighting=function(b){return new a(h({},b.cloneConstructProperties()))};Object.defineProperty(b.prototype,
"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(b){var c=this._get("date")===this._get("defaultDate");b=new Date(b.getTime());this._set("defaultDate",b);c&&this._set("date",b)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"date",{set:function(b){null!=b&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(b.getTime())))},enumerable:!0,configurable:!0});b.prototype.autoUpdate=function(b,c){var a=this._calculateTimezoneOffset(this.positionTimezoneInfo);
this.positionTimezoneInfo.hours=c.hours;this.positionTimezoneInfo.minutes=c.minutes;this.positionTimezoneInfo.seconds=c.seconds;c=null;null!=b&&(this.positionTimezoneInfo.autoUpdated=!0,c=this.date&&this.date.getTime(),this._set("date",new Date(b.getTime())));var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);a!==e&&(f.target=this,f.timezoneOffset=e,this.emit("timezone-will-change",f));if(null!=b)return c!==b.getTime()};b.prototype.clone=function(){var b=this._get("date")===this._get("defaultDate"),
c=new a(h({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));b&&c._set("date",c._get("defaultDate"));c.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;c.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;c.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;c.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return c};b.prototype.cloneWithWebsceneLighting=
function(b){var c=this.clone();null!=b.date&&(c.date=b.date);c.directShadowsEnabled=b.directShadowsEnabled;c.displayUTCOffset=b.displayUTCOffset;return c};b.prototype._calculateTimezoneOffset=function(b){return Math.round(b.hours+b.minutes/60+b.seconds/3600)};var a;k([g.property({type:Boolean})],b.prototype,"cameraTrackingEnabled",void 0);k([g.property({type:Boolean})],b.prototype,"ambientOcclusionEnabled",void 0);k([g.property({type:Date})],b.prototype,"defaultDate",null);k([g.property({type:Date})],
b.prototype,"date",null);return b=a=k([g.subclass("esri.views.3d.environment.SceneViewLighting")],b)}(g.declared(d.EventedMixin(l)));a.SceneViewLighting=n;var f={target:null,timezoneOffset:0};a.default=n})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/projectionUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){Object.defineProperty(a,"__esModule",{value:!0});var A=r.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);n=function(a){function l(b){b=a.call(this)||this;b._referencePointUpdateDelay=200;b._referencePointUpdateInterval=3E3;b._referencePointUpdateDistThreshold=1E6;b._referencePosUpdateQuery=null;b._referencePosMapCoordsRequested=null;b._viewHandles=new f;b._preserveAbsoluteDateTime=!1;b._trackingEnabled=!1;b._viewConnected=
!1;b._referencePosResetPreserveAbsoluteTime=!1;b.referencePosUpdateTimer=null;b._referencePosWGS84Comparable=null;b._referencePosMapCoords=null;b._mainLight=new x.MainLight;b._ambientLight=new x.AmbientLight;b._moonLight=new x.FillLight;b._renderer=null;b._resetReferencePosition();return b}m(l,a);l.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(l.prototype,"updating",{get:function(){return this._viewConnected?!!(!this.disableQueries&&(this._referencePosUpdateQuery||
this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating):!1},enumerable:!0,configurable:!0});l.prototype.updateReadyChange=function(b){b&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view),this.notifyChange("updating")):!b&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view),this.notifyChange("updating"))};l.prototype.disposeRendering=function(){this._renderer&&(this._renderer.destroy(),this._renderer=null);this._resetReferencePosition()};
l.prototype.connectView=function(b){var c=this;this._renderer=new u({view:b});this._viewHandles.add([this.view.watch("environment.lighting.date",function(b){return c._lightingDateHandler(b)},!0),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],function(){return c._updateRenderParamsHandler()},!0),this.view.watch("spatialReference",
function(){return c._resetReferencePosition()},!0),e.init(this.view,"viewingMode",function(){return c._resetReferencePosition()},!0),e.init(this.view,"environment.lighting.cameraTrackingEnabled",function(b){return c._updateCameraTracking(b)},!0),e.init(this,"view.state.camera",function(){return c._cameraHandler(null)},!0),this.watch("disableQueries",function(){return c._cameraHandler(null)})]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};l.prototype._updateCameraTracking=
function(b){if(this._trackingEnabled=b)this._cameraHandler();else if(b=this.get("view.environment.lighting"))b.positionTimezoneInfo.autoUpdated=!1};l.prototype.disconnectView=function(b){this.disposeRendering();this._viewHandles.removeAll()};l.prototype._lightingDateHandler=function(b){if(b){var a=this.view.environment.lighting;if(!a.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!y.canProjectToWGS84ComparableLonLat(this.view.spatialReference)){var e=this.view.camera.position;
if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e)){this._requestReferencePositionUpdate(e);return}}this._preupdateTracking(b);this._referencePosWGS84Comparable&&(e=v.positionToTimezone(this._referencePosWGS84Comparable,B),c.isSome(e)&&(a.autoUpdate(null,e),this._trackingEnabled&&(a.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(b)}};l.prototype._preupdateTracking=function(b){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&
this._cameraHandler(b)};l.prototype._cameraHandler=function(b){void 0===b&&(b=null);if(this.view.ready){var c=this.view.camera;c&&(this._cameraHandlerClientSide(c,b)||this._cameraHandlerServerSide(c,b))}};l.prototype._cameraHandlerClientSide=function(b,c){if(!y.canProjectToWGS84ComparableLonLat(this.view.spatialReference))return!1;b=b.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=r.vec3f64.create());y.pointToWGS84ComparableLonLat(b,this._referencePosWGS84Comparable);
this._autoUpdateTimezone(this._referencePosWGS84Comparable,c)||this._updateLightParams(c);return!0};l.prototype._cameraHandlerServerSide=function(b,c){b=b.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(b))&&this._requestReferencePositionUpdate(b,!0);this.view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=b.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};l.prototype._interactingStationaryHandler=
function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};l.prototype._updateLightParams=function(b){var c=this.view.environment.lighting;b=b||c.date;var c=this.view._stage,a;this._referencePosWGS84Comparable?(a=t.computeColorAndIntensity(b,this._referencePosWGS84Comparable),t.computeDirection(b,this._referencePosWGS84Comparable,this.view.viewingMode,a.diffuse.direction)):a={diffuse:{color:[1,1,1],intensity:.55,direction:A},ambient:{color:[1,1,1],intensity:.55},
noonFactor:.5,globalFactor:0};q.vec3.scale(this._mainLight.intensity,a.diffuse.color,a.diffuse.intensity*Math.PI);q.vec3.negate(this._mainLight.direction,a.diffuse.direction);q.vec3.scale(this._ambientLight.intensity,a.ambient.color,a.ambient.intensity);q.vec3.lerp(this._moonLight.intensity,G,F,a.globalFactor);q.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*a.globalFactor)*(1-.4*a.noonFactor*(1-a.globalFactor)));q.vec3.copy(this._moonLight.direction,a.diffuse.direction);c.setLighting({lights:[this._mainLight,
this._ambientLight,this._moonLight],globalFactor:a.globalFactor,groundLightingFactor:1-a.noonFactor});this._updateRenderParamsHandler()};l.prototype._autoUpdateTimezone=function(b,a){void 0===a&&(a=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var e=E;e.setTime((a||this.view.environment.lighting.date).getTime());b=v.positionToTimezone(b,B);if(c.isNone(b))return!1;var d=this.view.environment.lighting.positionTimezoneInfo;if(!d.autoUpdated)d=b;else if(d.hours===b.hours&&
d.minutes===b.minutes&&d.seconds===b.seconds)return!1;var f=e.getUTCHours()-(b.hours-d.hours),g=e.getUTCMinutes()-(b.minutes-d.minutes),d=e.getUTCSeconds()-(b.seconds-d.seconds);e.setUTCHours(f);e.setUTCMinutes(g);e.setUTCSeconds(d);return a?!1:this.view.environment.lighting.autoUpdate(e,b)};l.prototype._updateRenderParamsHandler=function(){var b=this.view._stage;if(b){var c=this._referencePosWGS84Comparable?t.computeShadowsEnabled(this._referencePosWGS84Comparable,this.view.viewingMode):!0,a=this.view.environment.background,
a=a instanceof z?{type:"color",color:w.vec4f64.fromArray(g.toUnitRGBA(a.color))}:{type:"color",color:w.vec4f64.fromValues(0,0,0,1)};b.renderView.setRenderParameters({shadowMap:this.view.environment.lighting.directShadowsEnabled&&c,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:a})}};l.prototype._resetReferencePosition=function(){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=
this._referencePosMapCoords=null;this.notifyChange("updating")};l.prototype._requestReferencePositionUpdate=function(c,a){var e=this;void 0===a&&(a=!1);if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(c):this._referencePosMapCoordsRequested=c.clone(),this._referencePosResetPreserveAbsoluteTime=!!a,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var d=this._referencePosUpdateQuery=
b.after(this._referencePointUpdateDelay).then(function(){if(e._referencePosUpdateQuery===d)return e._doReferencePositionUpdateQuery(function(){return e._referencePosUpdateQuery!==d})}).catch(function(b){"mapcoordshelper:missing-geometry-service"===b.name&&(e.disableQueries=!0)}).then(function(){e._referencePosUpdateQuery===d&&(e._referencePosUpdateQuery=null,e.referencePosUpdateTimer||e._executePendingReferencePositionUpdate(),e.notifyChange("updating"))}),f=this.referencePosUpdateTimer=b.after(this._referencePointUpdateInterval).then(function(){e.referencePosUpdateTimer===
f&&(e.referencePosUpdateTimer=null,e._referencePosUpdateQuery||e._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};l.prototype._doReferencePositionUpdateQuery=function(b){return d(this,void 0,void 0,function(){var c,a;return h(this,function(e){switch(e.label){case 0:return this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=
this._referencePosMapCoordsRequested.clone(),this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null,[4,this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords)];case 1:return c=e.sent(),b()||isNaN(c[0])||isNaN(c[1])||(a=this._referencePosMapCoords.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=c[0],this._referencePosWGS84Comparable[1]=c[1],this._referencePosWGS84Comparable[2]=a):this._referencePosWGS84Comparable=
[c[0],c[1],a],this._referencePosChanged()),[2]}})})};l.prototype._executePendingReferencePositionUpdate=function(){var b=this._referencePosMapCoordsRequested;b&&this._requestReferencePositionUpdate(b,this._referencePosResetPreserveAbsoluteTime)};l.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams()};l.prototype._exceedsReferencePosDistThreshold=function(b){return this._referencePosMapCoords?
(b=this._referencePosMapCoords.distance(b),this.view.mapCoordsHelper&&(b*=this.view.mapCoordsHelper.unitInMeters),b>this._referencePointUpdateDistThreshold):!0};l.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=this._referencePosUpdateQuery=null};Object.defineProperty(l.prototype,"test",{get:function(){var b=this;return{renderer:this._renderer,set referencePointUpdateInterval(c){b._referencePointUpdateInterval=c},set referencePointUpdateDistThreshold(c){b._referencePointUpdateDistThreshold=
c},set referencePosUpdateTimer(c){b.referencePosUpdateTimer=c},set referencePointUpdateDelay(c){b._referencePointUpdateDelay=c}}},enumerable:!0,configurable:!0});l.FIXED_LIGHT_DIRECTION=A;k([p.property({type:Boolean,dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],l.prototype,"updating",null);k([p.property()],l.prototype,"disableQueries",void 0);k([p.property({constructOnly:!0})],l.prototype,"view",void 0);k([p.property()],l.prototype,"_renderer",void 0);return l=k([p.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],
l)}(p.declared(l.EventedAccessor));a.SceneViewEnvironmentManager=n;var E=new Date,B={hours:0,minutes:0,seconds:0},G=r.vec3f64.fromValues(.22,.22,.33),F=r.vec3f64.fromValues(.22,.22,.22);a.default=n})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.vec4f64=m})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require","exports"],function(n,a){function m(){return[0,
0,0,0]}function k(){return[1,1,1,1]}function h(){return[1,0,0,0]}function d(){return[0,1,0,0]}function g(){return[0,0,1,0]}function l(){return[0,0,0,1]}Object.defineProperty(a,"__esModule",{value:!0});a.create=m;a.clone=function(a){return[a[0],a[1],a[2],a[3]]};a.fromValues=function(a,c,b,e){return[a,c,b,e]};a.fromArray=function(a){for(var c=m(),b=Math.min(4,a.length),e=0;e<b;++e)c[e]=a[e];return c};a.createView=function(a,c){return new Float64Array(a,c,4)};a.zeros=function(){return m()};a.ones=k;
a.unitX=h;a.unitY=d;a.unitZ=g;a.unitW=l;a.ZEROS=m();a.ONES=k();a.UNIT_X=h();a.UNIT_Y=d();a.UNIT_Z=g();a.UNIT_W=l()})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){var q=[13,14];return function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b._handles=new g;b._initContext=null;b._pendingAtmosphere=null;b._atmosphere=null;b._stars=null;return b}m(h,a);Object.defineProperty(h.prototype,"canRender",{get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return null!=
this._pendingAtmosphere},enumerable:!0,configurable:!0});h.prototype.initialize=function(){this.view._stage.addRenderPlugin(q,this)};h.prototype.destroy=function(){this._pendingAtmosphere&&(this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))};h.prototype.initializeRenderContext=
function(b){this._initContext=b;this.setup()};h.prototype.setup=function(){var b=this;this._handles.add(l.when(this.view,"basemapTerrain",function(){return b._updateBasemapTerrain()},!0));this._handles.add([l.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return b._updateAtmosphere()},!0),l.init(this.view,"environment.starsEnabled",function(){return b._updateStars()},!0)])};h.prototype.uninitializeRenderContext=function(b){this._stars&&(this._stars.uninitializeRenderContext(b),
this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(b),this._atmosphere.destroy(),this._atmosphere=null)};h.prototype.render=function(b){var c=!0;this._stars&&this._stars.canRender&&(c=this._stars.render(b)&&c);this._atmosphere&&this._atmosphere.canRender&&(c=this._atmosphere.render(b)&&c);return c};h.prototype._setNeedsRender=function(){this._initContext&&this._initContext.requestRender()};h.prototype._updateStars=function(){var b=this.view.get("environment.starsEnabled")||
!1;b&&!this._stars?(this._stars=new p(this.view),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!b&&this._stars&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};h.prototype._updateAtmosphere=function(){var b=this,c=this._getAtmosphereType();this.atmosphereType!==c&&(this.atmosphereType=c,this._pendingAtmosphere&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),(c=this._getAtmosphereClass())?
(c=new c(this.view),c.initializeRenderContext(this._initContext),null==this._atmosphere&&(this._atmosphere=c,this._setNeedsRender()),this._pendingAtmosphere=c,c.when(function(){b._pendingAtmosphere!==b._atmosphere&&(b._atmosphere.destroy(),b._atmosphere=b._pendingAtmosphere);b._pendingAtmosphere=null;b._setNeedsRender();b._updateBasemapTerrain()})):(this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()))};h.prototype._getAtmosphereClass=
function(){var a=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(a);switch(a){case "none":return null;case "realistic":return b.RealisticAtmosphere;case "panoramic":return c;case "simple":return e;default:d.neverReached(a)}};h.prototype._getAtmosphereType=function(){var c=this.view.get("environment.atmosphereEnabled"),a=this.view.get("environment.atmosphere.quality");return c&&null!=a?"local"===this.view.viewingMode?"panoramic":"high"===a&&b.RealisticAtmosphere.isSupported(this._initContext)?
"realistic":"simple":"none"};h.prototype._updateBasemapTerrain=function(){var b=this.view.basemapTerrain;b&&(b.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};Object.defineProperty(h.prototype,"test",{get:function(){return{atmosphere:this._atmosphere}},enumerable:!0,configurable:!0});k([f.property({constructOnly:!0})],h.prototype,"view",void 0);k([f.property({constructOnly:!0})],h.prototype,"atmosphereClassFromType",void 0);k([f.property({dependsOn:["_pendingAtmosphere"]})],
h.prototype,"updating",null);k([f.property()],h.prototype,"_pendingAtmosphere",void 0);return h=k([f.subclass("esri.views.3d.environment.EnvironmentRenderer")],h)}(f.declared(h))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x){n=function(){function b(b){this.slot=13;this._readyResolver=h.createResolver();this._readyController=h.createAbortController();this.view=b}Object.defineProperty(b.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._readyResolver.reject();this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&
(this._readyController.abort(),this._readyController=null)};b.prototype.when=function(b){return k(this,void 0,void 0,function(){return m(this,function(c){switch(c.label){case 0:return[4,this._readyResolver.promise];case 1:return c.sent(),b(),[2]}})})};b.prototype.initializeRenderContext=function(b){var c=this,a=b.rctx;this._program=w.createProgram(a,q.colorPass,{panoramic:!0});this._pipelineState=u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),culling:u.backFaceCullingParams,
depthTest:{func:515},colorWrite:u.defaultColorWriteParams});this._vao=this._createVertexArrayObject(a);this._vaoCount=t.vertexCount(this._vao,"geometry");f.requestImage(l,{signal:this._readyController.signal}).then(function(a){c._texture=new v(b.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);b.requestRender();c._readyController=null;c._readyResolver.resolve()})};b.prototype.uninitializeRenderContext=function(b){this.destroy()};b.prototype.render=function(b){if(b.slot!==
this.slot||0!==b.pass)return!1;var c=b.rctx,a=this._program;c.bindProgram(a);c.setPipelineState(this._pipelineState);c.bindTexture(this._texture);a.setUniform1i("tex",0);a.setUniformMatrix4fv("proj",b.camera.projectionMatrix);var e=z;d.mat4.copy(e,b.camera.viewMatrix);e[12]=0;e[13]=0;e[14]=0;e[15]=1;a.setUniformMatrix4fv("view",z);a.setUniform4f("color",1,1,1,1);b.scenelightingData.setLightDirectionUniform(a);c.bindVAO(this._vao);y.assertCompatibleVertexAttributeLocations(this._vao,a);c.drawArrays(4,
0,this._vaoCount);return!0};b.prototype._createVertexArrayObject=function(b){for(var a=e.createPolySphereGeometry(1,2,!1),d=a.indices[p.VertexAttrConstants.POSITION],f=0;f<d.length;f+=3){var g=d[f];d[f]=d[f+2];d[f+2]=g}for(var a=a.vertexAttributes[p.VertexAttrConstants.POSITION].data,g=A.createBuffer(d.length),l=g.position,f=0;f<d.length;++f){var h=3*d[f];l.set(f,0,a[h]);l.set(f,1,a[h+1]);l.set(f,2,a[h+2])}return new x(b,q.colorPass.attributes,{geometry:c.glLayout(A)},{geometry:r.createVertex(b,35044,
g.buffer)})};return b}();var z=g.mat4f64.create(),A=b.newLayout().vec3f("position");return n})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat4f64=m})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.clone=function(a){return[a[0],
a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]};a.fromValues=function(a,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v){return[a,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v]};a.createView=function(a,k){return new Float64Array(a,k,16)}})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(n,a){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../core/tsSupport/assignHelper","../../../request"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.dataURItoBlob=function(a){var d=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var g=new ArrayBuffer(d.length),l=new Uint8Array(g),f=0;f<d.length;f++)l[f]=d.charCodeAt(f);return new Blob([g],{type:a})};a.requestImage=function(a,d){return k(a,m({responseType:"image"},d)).then(function(a){return a.data})}})},
"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});var k={divisor:0,prefixA:!1};a.glLayout=function(a,g){void 0===g&&(g={});g=m({},k,g);var d=a.stride;return a.fieldNames.filter(function(d){d=a.fields.get(d).optional;return!(d&&d.glPadding)}).map(function(f){var c=a.fields.get(f),b=c.constructor.ElementCount,e;e=h[c.constructor.ElementType];if(!e)throw Error("BufferType not supported in WebGL");
var p=c.offset,c=!(!c.optional||!c.optional.glNormalized);return{name:g.prefixA?"a"+f[0].toUpperCase()+f.substr(1):f,stride:d,count:b,type:e,offset:p,normalized:c,divisor:g.divisor}})};var h={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=function(){function a(a,d){this.layout=a;this.buffer="number"===
typeof d?new ArrayBuffer(d*a.stride):d;d=0;for(var c=a.fieldNames;d<c.length;d++){var b=c[d],e=a.fields.get(b);this[b]=new e.constructor(this.buffer,e.offset,this.stride)}}Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteLength",{get:function(){return this.buffer.byteLength},
enumerable:!0,configurable:!0});a.prototype.getField=function(a,d){return(a=this[a])&&a.elementCount===d.ElementCount&&a.elementType===d.ElementType?a:null};a.prototype.slice=function(d,f){return new a(this.layout,this.buffer.slice(d*this.stride,f*this.stride))};a.prototype.copyFrom=function(a,d,c,b){var e=this.stride;0===e%4?(a=new Uint32Array(a.buffer,d*e,b*e/4),c=new Uint32Array(this.buffer,c*e,b*e/4)):(a=new Uint8Array(a.buffer,d*e,b*e),c=new Uint8Array(this.buffer,c*e,b*e));c.set(a)};return a}();
a.InterleavedBuffer=h;var d=function(){function a(){this.stride=0;this.fields=new Map;this.fieldNames=[]}a.prototype.vec2f=function(a,d){this.appendField(a,m.BufferViewVec2f,d);return this};a.prototype.vec2f64=function(a,d){this.appendField(a,m.BufferViewVec2f64,d);return this};a.prototype.vec3f=function(a,d){this.appendField(a,m.BufferViewVec3f,d);return this};a.prototype.vec3f64=function(a,d){this.appendField(a,m.BufferViewVec3f64,d);return this};a.prototype.vec4f=function(a,d){this.appendField(a,
m.BufferViewVec4f,d);return this};a.prototype.vec4f64=function(a,d){this.appendField(a,m.BufferViewVec4f64,d);return this};a.prototype.mat3f=function(a,d){this.appendField(a,m.BufferViewMat3f,d);return this};a.prototype.mat3f64=function(a,d){this.appendField(a,m.BufferViewMat3f64,d);return this};a.prototype.mat4f=function(a,d){this.appendField(a,m.BufferViewMat4f,d);return this};a.prototype.mat4f64=function(a,d){this.appendField(a,m.BufferViewMat4f64,d);return this};a.prototype.vec4u8=function(a,
d){this.appendField(a,m.BufferViewVec4u8,d);return this};a.prototype.f32=function(a,d){this.appendField(a,m.BufferViewFloat,d);return this};a.prototype.f64=function(a,d){this.appendField(a,m.BufferViewFloat64,d);return this};a.prototype.u8=function(a,d){this.appendField(a,m.BufferViewUint8,d);return this};a.prototype.u16=function(a,d){this.appendField(a,m.BufferViewUint16,d);return this};a.prototype.i8=function(a,d){this.appendField(a,m.BufferViewInt8,d);return this};a.prototype.vec2i8=function(a,
d){this.appendField(a,m.BufferViewVec2i8,d);return this};a.prototype.vec2i16=function(a,d){this.appendField(a,m.BufferViewVec2i16,d);return this};a.prototype.vec2u8=function(a,d){this.appendField(a,m.BufferViewVec2u8,d);return this};a.prototype.vec4u16=function(a,d){this.appendField(a,m.BufferViewVec4u16,d);return this};a.prototype.u32=function(a,d){this.appendField(a,m.BufferViewUint32,d);return this};a.prototype.appendField=function(a,d,c){var b=d.ElementCount*k.elementTypeSize(d.ElementType);this.fields.set(a,
{size:b,constructor:d,offset:this.stride,optional:c});this.stride+=b;this.fieldNames.push(a)};a.prototype.alignTo=function(a){this.stride=Math.floor((this.stride+a-1)/a)*a;return this};a.prototype.hasField=function(a){return 0<=this.fieldNames.indexOf(a)};a.prototype.createBuffer=function(a){return new h(this,a)};a.prototype.createView=function(a){return new h(this,a)};a.prototype.clone=function(){var d=new a;d.stride=this.stride;d.fields=new Map;this.fields.forEach(function(a,c){return d.fields.set(c,
a)});d.fieldNames=this.fieldNames.slice();d.BufferType=this.BufferType;return d};return a}();a.InterleavedLayout=d;a.newLayout=function(){return new d}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(c){function b(b,a,d,f){void 0===
a&&(a=0);b=c.call(this,Float32Array,b,a,d,f)||this;b.elementType="f32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f32";return b}(d.BufferViewScalarImpl);a.BufferViewFloat=n;n=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float32Array,b,a,d,f)||this;b.elementType="f32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f32";
return b}(g.BufferViewVec2Impl);a.BufferViewVec2f=n;n=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float32Array,b,a,d,f)||this;b.elementType="f32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f32";return b}(l.BufferViewVec3Impl);a.BufferViewVec3f=n;n=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float32Array,b,a,d,f)||this;b.elementType="f32";return b}m(b,c);b.fromTypedArray=function(c,
a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f32";return b}(f.BufferViewVec4Impl);a.BufferViewVec4f=n;n=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float32Array,b,a,d,f)||this;b.elementType="f32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f32";return b}(k.BufferViewMat3Impl);a.BufferViewMat3f=n;k=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,
Float64Array,b,a,d,f)||this;b.elementType="f64";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f64";return b}(k.BufferViewMat3Impl);a.BufferViewMat3f64=k;k=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float32Array,b,a,d,f)||this;b.elementType="f32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f32";return b}(h.BufferViewMat4Impl);
a.BufferViewMat4f=k;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float64Array,b,a,d,f)||this;b.elementType="f64";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f64";return b}(h.BufferViewMat4Impl);a.BufferViewMat4f64=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float64Array,b,a,d,f)||this;b.elementType="f64";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,
c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f64";return b}(d.BufferViewScalarImpl);a.BufferViewFloat64=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float64Array,b,a,d,f)||this;b.elementType="f64";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f64";return b}(g.BufferViewVec2Impl);a.BufferViewVec2f64=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float64Array,b,a,
d,f)||this;b.elementType="f64";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f64";return b}(l.BufferViewVec3Impl);a.BufferViewVec3f64=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Float64Array,b,a,d,f)||this;b.elementType="f64";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="f64";return b}(f.BufferViewVec4Impl);a.BufferViewVec4f64=
h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint8Array,b,a,d,f)||this;b.elementType="u8";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u8";return b}(d.BufferViewScalarImpl);a.BufferViewUint8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint8Array,b,a,d,f)||this;b.elementType="u8";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+
c.byteLength)};b.ElementType="u8";return b}(g.BufferViewVec2Impl);a.BufferViewVec2u8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint8Array,b,a,d,f)||this;b.elementType="u8";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u8";return b}(l.BufferViewVec3Impl);a.BufferViewVec3u8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint8Array,b,a,d,f)||this;b.elementType="u8";return b}
m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u8";return b}(f.BufferViewVec4Impl);a.BufferViewVec4u8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint16Array,b,a,d,f)||this;b.elementType="u16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u16";return b}(d.BufferViewScalarImpl);a.BufferViewUint16=h;h=function(c){function b(b,
a,d,f){void 0===a&&(a=0);b=c.call(this,Uint16Array,b,a,d,f)||this;b.elementType="u16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u16";return b}(g.BufferViewVec2Impl);a.BufferViewVec2u16=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint16Array,b,a,d,f)||this;b.elementType="u16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType=
"u16";return b}(l.BufferViewVec3Impl);a.BufferViewVec3u16=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint16Array,b,a,d,f)||this;b.elementType="u16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u16";return b}(f.BufferViewVec4Impl);a.BufferViewVec4u16=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint32Array,b,a,d,f)||this;b.elementType="u32";return b}m(b,c);b.fromTypedArray=
function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u32";return b}(d.BufferViewScalarImpl);a.BufferViewUint32=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint32Array,b,a,d,f)||this;b.elementType="u32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u32";return b}(g.BufferViewVec2Impl);a.BufferViewVec2u32=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=
0);b=c.call(this,Uint32Array,b,a,d,f)||this;b.elementType="u32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u32";return b}(l.BufferViewVec3Impl);a.BufferViewVec3u32=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Uint32Array,b,a,d,f)||this;b.elementType="u32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="u32";return b}(f.BufferViewVec4Impl);
a.BufferViewVec4u32=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int8Array,b,a,d,f)||this;b.elementType="i8";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i8";return b}(d.BufferViewScalarImpl);a.BufferViewInt8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int8Array,b,a,d,f)||this;b.elementType="i8";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,
a,c.byteOffset+c.byteLength)};b.ElementType="i8";return b}(g.BufferViewVec2Impl);a.BufferViewVec2i8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int8Array,b,a,d,f)||this;b.elementType="i8";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i8";return b}(l.BufferViewVec3Impl);a.BufferViewVec3i8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int8Array,b,a,d,f)||this;b.elementType=
"i8";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i8";return b}(f.BufferViewVec4Impl);a.BufferViewVec4i8=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int16Array,b,a,d,f)||this;b.elementType="i16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i16";return b}(d.BufferViewScalarImpl);a.BufferViewInt16=h;h=function(c){function b(b,
a,d,f){void 0===a&&(a=0);b=c.call(this,Int16Array,b,a,d,f)||this;b.elementType="i16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i16";return b}(g.BufferViewVec2Impl);a.BufferViewVec2i16=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int16Array,b,a,d,f)||this;b.elementType="i16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType=
"i16";return b}(l.BufferViewVec3Impl);a.BufferViewVec3i16=h;h=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int16Array,b,a,d,f)||this;b.elementType="i16";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i16";return b}(f.BufferViewVec4Impl);a.BufferViewVec4i16=h;d=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int32Array,b,a,d,f)||this;b.elementType="i32";return b}m(b,c);b.fromTypedArray=
function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i32";return b}(d.BufferViewScalarImpl);a.BufferViewInt32=d;g=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int32Array,b,a,d,f)||this;b.elementType="i32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i32";return b}(g.BufferViewVec2Impl);a.BufferViewVec2i32=g;l=function(c){function b(b,a,d,f){void 0===a&&(a=0);
b=c.call(this,Int32Array,b,a,d,f)||this;b.elementType="i32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i32";return b}(l.BufferViewVec3Impl);a.BufferViewVec3i32=l;f=function(c){function b(b,a,d,f){void 0===a&&(a=0);b=c.call(this,Int32Array,b,a,d,f)||this;b.elementType="i32";return b}m(b,c);b.fromTypedArray=function(c,a){return new b(c.buffer,c.byteOffset,a,c.byteOffset+c.byteLength)};b.ElementType="i32";return b}(f.BufferViewVec4Impl);
a.BufferViewVec4i32=f})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,h,d,g,l){void 0===d&&(d=0);this.TypedArrayConstructor=a;this.elementCount=9;a=this.TypedArrayConstructor;void 0===g&&(g=9*a.BYTES_PER_ELEMENT);var f=0===h.byteLength?0:d;this.typedBuffer=null==l?new a(h,f):new a(h,f,(l-d)/a.BYTES_PER_ELEMENT);this.typedBufferStride=g/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/
this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getMat=function(a,h){a*=this.typedBufferStride;for(var d=0;9>d;d++)h[d]=this.typedBuffer[a+d];return h};a.prototype.setMat=function(a,h){a*=this.typedBufferStride;for(var d=0;9>d;d++)this.typedBuffer[a+d]=h[d]};a.prototype.get=function(a,h){return this.typedBuffer[a*this.typedBufferStride+h]};a.prototype.set=function(a,h,d){this.typedBuffer[a*this.typedBufferStride+h]=d};a.prototype.copyFrom=
function(a,h,d){var g=this.typedBuffer,l=h.typedBuffer;a*=this.typedBufferStride;h=d*h.typedBufferStride;for(d=0;9>d;++d)g[a+d]=l[h+d]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=9;return a}();a.BufferViewMat3Impl=n})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,h,d,g,l){void 0===
d&&(d=0);this.TypedArrayConstructor=a;this.elementCount=16;a=this.TypedArrayConstructor;void 0===g&&(g=16*a.BYTES_PER_ELEMENT);var f=0===h.byteLength?0:d;this.typedBuffer=null==l?new a(h,f):new a(h,f,(l-d)/a.BYTES_PER_ELEMENT);this.typedBufferStride=g/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getMat=function(a,h){a*=this.typedBufferStride;for(var d=0;16>d;d++)h[d]=
this.typedBuffer[a+d];return h};a.prototype.setMat=function(a,h){a*=this.typedBufferStride;for(var d=0;16>d;d++)this.typedBuffer[a+d]=h[d]};a.prototype.get=function(a,h){return this.typedBuffer[a*this.typedBufferStride+h]};a.prototype.set=function(a,h,d){this.typedBuffer[a*this.typedBufferStride+h]=d};a.prototype.copyFrom=function(a,h,d){var g=this.typedBuffer,l=h.typedBuffer;a*=this.typedBufferStride;h=d*h.typedBufferStride;for(d=0;16>d;++d)g[a+d]=l[h+d]};Object.defineProperty(a.prototype,"buffer",
{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=16;return a}();a.BufferViewMat4Impl=n})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,h,d,g,l){void 0===d&&(d=0);this.TypedArrayConstructor=a;this.elementCount=1;a=this.TypedArrayConstructor;void 0===g&&(g=a.BYTES_PER_ELEMENT);var f=0===h.byteLength?0:d;this.typedBuffer=null==
l?new a(h,f):new a(h,f,(l-d)/a.BYTES_PER_ELEMENT);this.typedBufferStride=g/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.get=function(a){return this.typedBuffer[a*this.typedBufferStride]};a.prototype.set=function(a,h){this.typedBuffer[a*this.typedBufferStride]=h};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,
configurable:!0});a.ElementCount=1;return a}();a.BufferViewScalarImpl=n})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g,l,f){void 0===g&&(g=0);this.TypedArrayConstructor=a;this.elementCount=2;a=this.TypedArrayConstructor;void 0===l&&(l=2*a.BYTES_PER_ELEMENT);var c=0===d.byteLength?0:g;this.typedBuffer=null==f?new a(d,c):
new a(d,c,(f-g)/a.BYTES_PER_ELEMENT);this.typedBufferStride=l/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,d){return m.vec2.set(d,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1])};a.prototype.setVec=function(a,d){this.typedBuffer[a*this.typedBufferStride]=d[0];this.typedBuffer[a*this.typedBufferStride+1]=d[1]};
a.prototype.get=function(a,d){return this.typedBuffer[a*this.typedBufferStride+d]};a.prototype.set=function(a,d,g){this.typedBuffer[a*this.typedBufferStride+d]=g};a.prototype.copyFrom=function(a,d,g){var l=this.typedBuffer,f=d.typedBuffer;a*=this.typedBufferStride;d=g*d.typedBufferStride;l[a]=f[d];l[a+1]=f[d+1]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=2;return a}();a.BufferViewVec2Impl=n})},"esri/core/libs/gl-matrix-2/vec2":function(){define(["require",
"exports","./math/vec2"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.vec2=m})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["require","exports","./common"],function(n,a,m){function k(b,c,a){b[0]=c[0]-a[0];b[1]=c[1]-a[1];return b}function h(b,c,a){b[0]=c[0]*a[0];b[1]=c[1]*a[1];return b}function d(b,c,a){b[0]=c[0]/a[0];b[1]=c[1]/a[1];return b}function g(b,c){var a=c[0]-b[0];b=c[1]-b[1];return Math.sqrt(a*a+b*b)}function l(b,c){var a=c[0]-b[0];b=c[1]-b[1];return a*
a+b*b}function f(b){var c=b[0];b=b[1];return Math.sqrt(c*c+b*b)}function c(b){var c=b[0];b=b[1];return c*c+b*b}Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(b,c){b[0]=c[0];b[1]=c[1];return b};a.set=function(b,c,a){b[0]=c;b[1]=a;return b};a.add=function(b,c,a){b[0]=c[0]+a[0];b[1]=c[1]+a[1];return b};a.subtract=k;a.multiply=h;a.divide=d;a.ceil=function(b,c){b[0]=Math.ceil(c[0]);b[1]=Math.ceil(c[1]);return b};a.floor=function(b,c){b[0]=Math.floor(c[0]);b[1]=Math.floor(c[1]);return b};
a.min=function(b,c,a){b[0]=Math.min(c[0],a[0]);b[1]=Math.min(c[1],a[1]);return b};a.max=function(b,c,a){b[0]=Math.max(c[0],a[0]);b[1]=Math.max(c[1],a[1]);return b};a.round=function(b,c){b[0]=Math.round(c[0]);b[1]=Math.round(c[1]);return b};a.scale=function(b,c,a){b[0]=c[0]*a;b[1]=c[1]*a;return b};a.scaleAndAdd=function(b,c,a,d){b[0]=c[0]+a[0]*d;b[1]=c[1]+a[1]*d;return b};a.distance=g;a.squaredDistance=l;a.length=f;a.squaredLength=c;a.negate=function(b,c){b[0]=-c[0];b[1]=-c[1];return b};a.inverse=
function(b,c){b[0]=1/c[0];b[1]=1/c[1];return b};a.normalize=function(b,c){var a=c[0],d=c[1],a=a*a+d*d;0<a&&(a=1/Math.sqrt(a),b[0]=c[0]*a,b[1]=c[1]*a);return b};a.dot=function(b,c){return b[0]*c[0]+b[1]*c[1]};a.cross=function(b,c,a){c=c[0]*a[1]-c[1]*a[0];b[0]=b[1]=0;b[2]=c;return b};a.lerp=function(b,c,a,d){var e=c[0];c=c[1];b[0]=e+d*(a[0]-e);b[1]=c+d*(a[1]-c);return b};a.random=function(b,c){c=c||1;var a=2*m.RANDOM()*Math.PI;b[0]=Math.cos(a)*c;b[1]=Math.sin(a)*c;return b};a.transformMat2=function(b,
c,a){var d=c[0];c=c[1];b[0]=a[0]*d+a[2]*c;b[1]=a[1]*d+a[3]*c;return b};a.transformMat2d=function(b,c,a){var d=c[0];c=c[1];b[0]=a[0]*d+a[2]*c+a[4];b[1]=a[1]*d+a[3]*c+a[5];return b};a.transformMat3=function(b,c,a){var d=c[0];c=c[1];b[0]=a[0]*d+a[3]*c+a[6];b[1]=a[1]*d+a[4]*c+a[7];return b};a.transformMat4=function(b,c,a){var d=c[0];c=c[1];b[0]=a[0]*d+a[4]*c+a[12];b[1]=a[1]*d+a[5]*c+a[13];return b};a.rotate=function(b,c,a,d){var e=c[0]-a[0];c=c[1]-a[1];var f=Math.sin(d);d=Math.cos(d);b[0]=e*d-c*f+a[0];
b[1]=e*f+c*d+a[1];return b};a.angle=function(b,c){var a=b[0];b=b[1];var d=c[0];c=c[1];var e=a*a+b*b;0<e&&(e=1/Math.sqrt(e));var f=d*d+c*c;0<f&&(f=1/Math.sqrt(f));a=(a*d+b*c)*e*f;return 1<a?0:-1>a?Math.PI:Math.acos(a)};a.str=function(b){return"vec2("+b[0]+", "+b[1]+")"};a.exactEquals=function(b,c){return b[0]===c[0]&&b[1]===c[1]};a.equals=function(b,c){var a=b[0];b=b[1];var d=c[0];c=c[1];return Math.abs(a-d)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(b-c)<=m.EPSILON*Math.max(1,Math.abs(b),
Math.abs(c))};a.len=f;a.sub=k;a.mul=h;a.div=d;a.dist=g;a.sqrDist=l;a.sqrLen=c})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g,l,f){void 0===g&&(g=0);this.TypedArrayConstructor=a;this.elementCount=3;a=this.TypedArrayConstructor;void 0===l&&(l=3*a.BYTES_PER_ELEMENT);var c=0===d.byteLength?0:g;this.typedBuffer=null==f?new a(d,
c):new a(d,c,(f-g)/a.BYTES_PER_ELEMENT);this.typedBufferStride=l/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,d){return m.vec3.set(d,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1],this.typedBuffer[a*this.typedBufferStride+2])};a.prototype.setVec=function(a,d){this.typedBuffer[a*this.typedBufferStride]=d[0];
this.typedBuffer[a*this.typedBufferStride+1]=d[1];this.typedBuffer[a*this.typedBufferStride+2]=d[2]};a.prototype.get=function(a,d){return this.typedBuffer[a*this.typedBufferStride+d]};a.prototype.set=function(a,d,g){this.typedBuffer[a*this.typedBufferStride+d]=g};a.prototype.copyFrom=function(a,d,g){var l=this.typedBuffer,f=d.typedBuffer;a*=this.typedBufferStride;d=g*d.typedBufferStride;l[a]=f[d];l[a+1]=f[d+1];l[a+2]=f[d+2]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},
enumerable:!0,configurable:!0});a.ElementCount=3;return a}();a.BufferViewVec3Impl=n})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g,l,f){void 0===g&&(g=0);this.TypedArrayConstructor=a;this.elementCount=4;a=this.TypedArrayConstructor;void 0===l&&(l=4*a.BYTES_PER_ELEMENT);var c=0===d.byteLength?0:g;this.typedBuffer=null==
f?new a(d,c):new a(d,c,(f-g)/a.BYTES_PER_ELEMENT);this.typedBufferStride=l/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,d){return m.vec4.set(d,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1],this.typedBuffer[a*this.typedBufferStride+2],this.typedBuffer[a*this.typedBufferStride+3])};a.prototype.setVec=function(a,
d){this.typedBuffer[a*this.typedBufferStride]=d[0];this.typedBuffer[a*this.typedBufferStride+1]=d[1];this.typedBuffer[a*this.typedBufferStride+2]=d[2];this.typedBuffer[a*this.typedBufferStride+3]=d[3]};a.prototype.get=function(a,d){return this.typedBuffer[a*this.typedBufferStride+d]};a.prototype.set=function(a,d,g){this.typedBuffer[a*this.typedBufferStride+d]=g};a.prototype.copyFrom=function(a,d,g){var l=this.typedBuffer,f=d.typedBuffer;a*=this.typedBufferStride;d=g*d.typedBufferStride;l[a]=f[d];
l[a+1]=f[d+1];l[a+2]=f[d+2];l[a+3]=f[d+3]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=4;return a}();a.BufferViewVec4Impl=n})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require","exports","./math/vec4"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.vec4=m})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(n,a,m){function k(b,
c,a){b[0]=c[0]-a[0];b[1]=c[1]-a[1];b[2]=c[2]-a[2];b[3]=c[3]-a[3];return b}function h(b,c,a){b[0]=c[0]*a[0];b[1]=c[1]*a[1];b[2]=c[2]*a[2];b[3]=c[3]*a[3];return b}function d(b,c,a){b[0]=c[0]/a[0];b[1]=c[1]/a[1];b[2]=c[2]/a[2];b[3]=c[3]/a[3];return b}function g(b,c){var a=c[0]-b[0],d=c[1]-b[1],e=c[2]-b[2];b=c[3]-b[3];return Math.sqrt(a*a+d*d+e*e+b*b)}function l(b,c){var a=c[0]-b[0],d=c[1]-b[1],e=c[2]-b[2];b=c[3]-b[3];return a*a+d*d+e*e+b*b}function f(b){var c=b[0],a=b[1],d=b[2];b=b[3];return Math.sqrt(c*
c+a*a+d*d+b*b)}function c(b){var c=b[0],a=b[1],d=b[2];b=b[3];return c*c+a*a+d*d+b*b}Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(b,c){b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=c[3];return b};a.set=function(b,c,a,d,f){b[0]=c;b[1]=a;b[2]=d;b[3]=f;return b};a.add=function(b,c,a){b[0]=c[0]+a[0];b[1]=c[1]+a[1];b[2]=c[2]+a[2];b[3]=c[3]+a[3];return b};a.subtract=k;a.multiply=h;a.divide=d;a.ceil=function(b,c){b[0]=Math.ceil(c[0]);b[1]=Math.ceil(c[1]);b[2]=Math.ceil(c[2]);b[3]=Math.ceil(c[3]);
return b};a.floor=function(b,c){b[0]=Math.floor(c[0]);b[1]=Math.floor(c[1]);b[2]=Math.floor(c[2]);b[3]=Math.floor(c[3]);return b};a.min=function(b,c,a){b[0]=Math.min(c[0],a[0]);b[1]=Math.min(c[1],a[1]);b[2]=Math.min(c[2],a[2]);b[3]=Math.min(c[3],a[3]);return b};a.max=function(b,c,a){b[0]=Math.max(c[0],a[0]);b[1]=Math.max(c[1],a[1]);b[2]=Math.max(c[2],a[2]);b[3]=Math.max(c[3],a[3]);return b};a.round=function(b,c){b[0]=Math.round(c[0]);b[1]=Math.round(c[1]);b[2]=Math.round(c[2]);b[3]=Math.round(c[3]);
return b};a.scale=function(b,c,a){b[0]=c[0]*a;b[1]=c[1]*a;b[2]=c[2]*a;b[3]=c[3]*a;return b};a.scaleAndAdd=function(b,c,a,d){b[0]=c[0]+a[0]*d;b[1]=c[1]+a[1]*d;b[2]=c[2]+a[2]*d;b[3]=c[3]+a[3]*d;return b};a.distance=g;a.squaredDistance=l;a.length=f;a.squaredLength=c;a.negate=function(b,c){b[0]=-c[0];b[1]=-c[1];b[2]=-c[2];b[3]=-c[3];return b};a.inverse=function(b,c){b[0]=1/c[0];b[1]=1/c[1];b[2]=1/c[2];b[3]=1/c[3];return b};a.normalize=function(b,c){var a=c[0],d=c[1],e=c[2];c=c[3];var f=a*a+d*d+e*e+c*
c;0<f&&(f=1/Math.sqrt(f),b[0]=a*f,b[1]=d*f,b[2]=e*f,b[3]=c*f);return b};a.dot=function(b,c){return b[0]*c[0]+b[1]*c[1]+b[2]*c[2]+b[3]*c[3]};a.lerp=function(b,c,a,d){var e=c[0],f=c[1],g=c[2];c=c[3];b[0]=e+d*(a[0]-e);b[1]=f+d*(a[1]-f);b[2]=g+d*(a[2]-g);b[3]=c+d*(a[3]-c);return b};a.random=function(b,c){c=c||1;var a,d,e,f,g,l;do a=2*m.RANDOM()-1,d=2*m.RANDOM()-1,g=a*a+d*d;while(1<=g);do e=2*m.RANDOM()-1,f=2*m.RANDOM()-1,l=e*e+f*f;while(1<=l);g=Math.sqrt((1-g)/l);b[0]=c*a;b[1]=c*d;b[2]=c*e*g;b[3]=c*f*
g;return b};a.transformMat4=function(b,c,a){var d=c[0],f=c[1],e=c[2];c=c[3];b[0]=a[0]*d+a[4]*f+a[8]*e+a[12]*c;b[1]=a[1]*d+a[5]*f+a[9]*e+a[13]*c;b[2]=a[2]*d+a[6]*f+a[10]*e+a[14]*c;b[3]=a[3]*d+a[7]*f+a[11]*e+a[15]*c;return b};a.transformQuat=function(b,c,a){var d=c[0],f=c[1],e=c[2],g=a[0],l=a[1],p=a[2];a=a[3];var h=a*d+l*e-p*f,k=a*f+p*d-g*e,m=a*e+g*f-l*d,d=-g*d-l*f-p*e;b[0]=h*a+d*-g+k*-p-m*-l;b[1]=k*a+d*-l+m*-g-h*-p;b[2]=m*a+d*-p+h*-l-k*-g;b[3]=c[3];return b};a.str=function(b){return"vec4("+b[0]+", "+
b[1]+", "+b[2]+", "+b[3]+")"};a.exactEquals=function(b,c){return b[0]===c[0]&&b[1]===c[1]&&b[2]===c[2]&&b[3]===c[3]};a.equals=function(b,c){var a=b[0],d=b[1],f=b[2];b=b[3];var e=c[0],g=c[1],l=c[2];c=c[3];return Math.abs(a-e)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(e))&&Math.abs(d-g)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(f-l)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(l))&&Math.abs(b-c)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(c))};a.sub=k;a.mul=h;a.div=d;a.dist=g;a.sqrDist=
l;a.len=f;a.sqrLen=c})},"esri/views/3d/support/buffer/types":function(){define(["require","exports","../../../../core/compilerUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.elementTypeSize=function(a){switch(a){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:m.neverReached(a)}};a.isSigned=function(a){switch(a){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;
default:m.neverReached(a)}};a.isInteger=function(a){switch(a){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:m.neverReached(a)}};a.maximumValue=function(a){switch(a){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:m.neverReached(a)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),
function(n,a,m,k,h,d,g,l,f){var c=g.Vec3Compact,b;(function(b){for(var c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],a=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],d=[0,0,1,0,1,1,0,1],e=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],g=Array(36),p=0;6>p;p++)for(var h=0;6>h;h++)g[6*p+h]=p;for(var q=Array(36),p=0;6>p;p++)q[6*p+0]=0,q[6*p+1]=1,q[6*p+2]=2,q[6*p+3]=2,q[6*p+4]=3,q[6*p+5]=0;b.createGeometry=function(b){Array.isArray(b)||
(b=[b,b,b]);for(var p=new Float32Array(24),h=0;8>h;h++)p[3*h]=c[h][0]*b[0],p[3*h+1]=c[h][1]*b[1],p[3*h+2]=c[h][2]*b[2];b={};b[f.VertexAttrConstants.POSITION]=new Uint32Array(e);b[f.VertexAttrConstants.NORMAL]=new Uint32Array(g);b[f.VertexAttrConstants.UV0]=new Uint32Array(q);h={};h[f.VertexAttrConstants.POSITION]={size:3,data:p};h[f.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(a)};h[f.VertexAttrConstants.UV0]={size:2,data:new Float32Array(d)};return new l.GeometryData(h,b)}})(b||(b={}));
var e;(function(b){var c=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],a=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],d=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],e=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];b.createGeometry=function(b){Array.isArray(b)||(b=[b,b,b]);for(var g=new Float32Array(18),p=0;6>p;p++)g[3*p]=c[p][0]*b[0],g[3*p+1]=c[p][1]*b[1],g[3*p+2]=c[p][2]*b[2];b={};b[f.VertexAttrConstants.POSITION]=new Uint32Array(d);b[f.VertexAttrConstants.NORMAL]=
new Uint32Array(e);p={};p[f.VertexAttrConstants.POSITION]={size:3,data:g};p[f.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(a)};return new l.GeometryData(p,b)}})(e||(e={}));var p;(function(b){var c=k.vec3f32.fromValues(-.5,0,-.5),a=k.vec3f32.fromValues(.5,0,-.5),d=k.vec3f32.fromValues(0,0,.5),e=k.vec3f32.fromValues(0,.5,0),g=k.vec3f32.create(),p=k.vec3f32.create(),h=k.vec3f32.create(),q=k.vec3f32.create(),r=k.vec3f32.create();m.vec3.subtract(g,c,e);m.vec3.subtract(p,c,a);m.vec3.cross(h,
g,p);m.vec3.normalize(h,h);m.vec3.subtract(g,a,e);m.vec3.subtract(p,a,d);m.vec3.cross(q,g,p);m.vec3.normalize(q,q);m.vec3.subtract(g,d,e);m.vec3.subtract(p,d,c);m.vec3.cross(r,g,p);m.vec3.normalize(r,r);var u=[c,a,d,e],w=[0,-1,0,h[0],h[1],h[2],q[0],q[1],q[2],r[0],r[1],r[2]],v=[0,1,2,3,1,0,3,2,1,3,0,2],n=[0,0,0,1,1,1,2,2,2,3,3,3];b.createGeometry=function(b){Array.isArray(b)||(b=[b,b,b]);for(var c=new Float32Array(12),a=0;4>a;a++)c[3*a]=u[a][0]*b[0],c[3*a+1]=u[a][1]*b[1],c[3*a+2]=u[a][2]*b[2];b={};
b[f.VertexAttrConstants.POSITION]=new Uint32Array(v);b[f.VertexAttrConstants.NORMAL]=new Uint32Array(n);a={};a[f.VertexAttrConstants.POSITION]={size:3,data:c};a[f.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(w)};return new l.GeometryData(a,b)}})(p||(p={}));var q;(function(a){function q(b,c,a,d,f){if(Math.abs(m.vec3.dot(c,b))>f)return!1;m.vec3.cross(a,b,c);m.vec3.normalize(a,a);m.vec3.cross(d,a,b);m.vec3.normalize(d,d);return!0}function t(b,c,a,d,f,e,g){return q(b,c,f,e,g)||q(b,a,f,e,
g)||q(b,d,f,e,g)}a.createBoxGeometry=b.createGeometry;a.createDiamondGeometry=e.createGeometry;a.createTetrahedronGeometry=p.createGeometry;a.createSphereGeometry=function(b,c,a,d,e,g,p){b=b||50;d=void 0!==d?d:-Math.PI;e=void 0!==e?e:2*Math.PI;g=void 0!==g?g:.5*-Math.PI;p=void 0!==p?p:Math.PI;var h=Math.max(3,Math.floor(c)||8),q=Math.max(2,Math.floor(a)||6),k=(h+1)*(q+1);a=new Float32Array(3*k);c=new Float32Array(3*k);for(var k=new Float32Array(2*k),r=[],t=0,u=0;u<=q;u++){for(var w=[],x=u/q,m=g+x*
p,v=Math.cos(m),z=0;z<=h;z++){var y=z/h,A=d+y*e,n=Math.cos(A)*v,E=Math.sin(m),A=-Math.sin(A)*v;a[3*t]=n*b;a[3*t+1]=E*b;a[3*t+2]=A*b;c[3*t]=n;c[3*t+1]=E;c[3*t+2]=A;k[2*t]=y;k[2*t+1]=x;w.push(t);++t}r.push(w)}b=new Uint32Array(2*h*(q-1)*3);for(u=t=0;u<q;u++)for(z=0;z<h;z++)d=r[u][z],e=r[u][z+1],g=r[u+1][z+1],p=r[u+1][z],0===u?(b[t++]=d,b[t++]=g,b[t++]=p):u===q-1?(b[t++]=d,b[t++]=e,b[t++]=g):(b[t++]=d,b[t++]=e,b[t++]=g,b[t++]=g,b[t++]=p,b[t++]=d);f.assert(t===b.length);h={};h[f.VertexAttrConstants.POSITION]=
b;h[f.VertexAttrConstants.NORMAL]=b;h[f.VertexAttrConstants.UV0]=b;q={};q[f.VertexAttrConstants.POSITION]={size:3,data:a};q[f.VertexAttrConstants.NORMAL]={size:3,data:c};q[f.VertexAttrConstants.UV0]={size:2,data:k};return new l.GeometryData(q,h)};a.createPolySphereGeometry=function(b,a,d){function e(a,d){a>d&&(d=[d,a],a=d[0],d=d[1]);var f=a.toString()+"."+d.toString();if(h[f])return h[f];var e=g.length;g.length+=3;c.add(g,3*a,g,3*d,g,e);c.scale(g,e,b/c.length(g,e));e/=3;return h[f]=e}var g;d?(g=[0,
-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],d=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(d=b*(1+Math.sqrt(5))/2,g=[-b,d,0,b,d,0,-b,-d,0,b,-d,0,0,-b,d,0,b,d,0,-b,-d,0,b,-d,d,0,-b,d,0,b,-d,0,-b,-d,0,b],d=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var p=0;p<g.length;p+=3)c.scale(g,p,b/c.length(g,p));for(var h={},p=0;p<a;p++){for(var q=d.length,k=new Uint32Array(4*q),t=0;t<
q;t+=3){var r=d[t],u=d[t+1],w=d[t+2],x=e(r,u),m=e(u,w),v=e(w,r),z=4*t;k[z]=r;k[z+1]=x;k[z+2]=v;k[z+3]=u;k[z+4]=m;k[z+5]=x;k[z+6]=w;k[z+7]=v;k[z+8]=m;k[z+9]=x;k[z+10]=m;k[z+11]=v}d=k;h={}}a=new Float32Array(g);for(p=0;p<a.length;p+=3)c.normalize(a,p);p={};p[f.VertexAttrConstants.POSITION]=d;p[f.VertexAttrConstants.NORMAL]=d;d={};d[f.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(g)};d[f.VertexAttrConstants.NORMAL]={size:3,data:a};return new l.GeometryData(d,p)};a.createPointGeometry=function(b,
c,a,d,e,g,p,h){c=c?new Float64Array([c[0],c[1],c[2]]):new Float32Array([0,0,0]);b=b?new Float32Array([b[0],b[1],b[2]]):new Float32Array([0,0,1]);g=g?new Float32Array(g):new Float32Array([0,0]);a=a?new Uint8Array([255*a[0],255*a[1],255*a[2],3<a.length?255*a[3]:255]):new Uint8Array([255,255,255,255]);var q=null!=d&&2===d.length?new Float32Array(d):new Float32Array([1,1]);d={};d[f.VertexAttrConstants.POSITION]={size:3,data:c};d[f.VertexAttrConstants.NORMAL]={size:3,data:b};d[f.VertexAttrConstants.UV0]=
{size:g.length,data:g};d[f.VertexAttrConstants.COLOR]={size:4,data:a};d[f.VertexAttrConstants.SIZE]={size:2,data:q};null!=e&&(e=new Float32Array([e[0],e[1],e[2],e[3]]),d[f.VertexAttrConstants.AUXPOS1]={size:4,data:e});null!=p&&(p=new Float32Array([p[0],p[1],p[2],p[3]]),d[f.VertexAttrConstants.AUXPOS2]={size:4,data:p});return null!=h?(l.GeometryData.call(h,d,l.GeometryData.DefaultIndices,l.GeometryData.DefaultOffsets,"point"),h):new l.GeometryData(d,l.GeometryData.DefaultIndices,l.GeometryData.DefaultOffsets,
"point")};a.updatePointGeometry=function(b,c,a,d,e,g,l,p){var h=p.vertexAttributes;if(null!=b){var q=h[f.VertexAttrConstants.NORMAL].data;q[0]=b[0];q[1]=b[1];q[2]=b[2]}null!=c&&(q=h[f.VertexAttrConstants.POSITION].data,q[0]=c[0],q[1]=c[1],q[2]=c[2]);null!=a&&(q=h[f.VertexAttrConstants.COLOR].data,q[0]=a[0],q[1]=a[1],q[2]=a[2],q[3]=a[3]);null!=d&&(q=h[f.VertexAttrConstants.SIZE].data,q[0]=d[0],q[1]=d[1]);null!=e&&(q=h[f.VertexAttrConstants.AUXPOS1].data,q[0]=e[0],q[1]=e[1],q[2]=e[2],q[3]=e[3]);null!=
g&&(q=h[f.VertexAttrConstants.UV0].data,q[0]=g[0],q[1]=g[1]);null!=l&&(q=h[f.VertexAttrConstants.AUXPOS2].data,q[0]=l[0],q[1]=l[1],q[2]=l[2],q[3]=l[3]);return p};a.createPointArrayGeometry=function(b,c){for(var a=new Float32Array(3*b.length),d=new Float32Array(c?3*b.length:3),e=new Uint32Array(b.length),g=new Uint32Array(b.length),p=0;p<b.length;p++)a[3*p]=b[p][0],a[3*p+1]=b[p][1],a[3*p+2]=b[p][2],c&&(d[3*p]=c[p][0],d[3*p+1]=c[p][1],d[3*p+2]=c[p][2]),e[p]=p,g[p]=0;c||(d[0]=0,d[1]=1,d[2]=0);b=new Float32Array(2);
b[0]=0;b[1]=0;p={};p[f.VertexAttrConstants.POSITION]=e;p[f.VertexAttrConstants.NORMAL]=c?e:g;p[f.VertexAttrConstants.UV0]=g;c={};c[f.VertexAttrConstants.POSITION]={size:3,data:a};c[f.VertexAttrConstants.NORMAL]={size:3,data:d};c[f.VertexAttrConstants.UV0]={size:2,data:b};return new l.GeometryData(c,p,l.GeometryData.DefaultOffsets,"point")};a.createTriangleGeometry=function(){var b=new Float32Array([0,0,0,0,0,100,100,0,0]),c=new Uint32Array([0,1,2]),a=new Float32Array([0,1,0]),d=new Uint32Array([0,
0,0]),e=new Float32Array([0,0]),g=new Uint32Array([0,0,0]),p={};p[f.VertexAttrConstants.POSITION]=c;p[f.VertexAttrConstants.NORMAL]=d;p[f.VertexAttrConstants.UV0]=g;c={};c[f.VertexAttrConstants.POSITION]={size:3,data:b};c[f.VertexAttrConstants.NORMAL]={size:3,data:a};c[f.VertexAttrConstants.UV0]={size:2,data:e};return new l.GeometryData(c,p)};a.createSquareGeometry=function(b){var c=new Float32Array(12);if(b)for(var a=0;4>a;a++)for(var d=0;3>d;d++)c[3*a+d]=b[a][d];else c[0]=-1,c[1]=-1,c[2]=0,c[3]=
1,c[4]=-1,c[5]=0,c[6]=1,c[7]=1,c[8]=0,c[9]=-1,c[10]=1,c[11]=0;var e=new Uint32Array([0,1,2,2,3,0]);b=new Float32Array([0,0,1]);var g=new Uint32Array([0,0,0,0,0,0]),a=new Float32Array([0,0,1,0,1,1,0,1]),d=new Uint8Array([255,255,255,255]),p={};p[f.VertexAttrConstants.POSITION]=e;p[f.VertexAttrConstants.NORMAL]=g;p[f.VertexAttrConstants.UV0]=e;p[f.VertexAttrConstants.COLOR]=g;e={};e[f.VertexAttrConstants.POSITION]={size:3,data:c};e[f.VertexAttrConstants.NORMAL]={size:3,data:b};e[f.VertexAttrConstants.UV0]=
{size:2,data:a};e[f.VertexAttrConstants.COLOR]={size:4,data:d};return new l.GeometryData(e,p)};a.createConeGeometry=function(b,c,a,d,e,g){void 0===e&&(e=!0);void 0===g&&(g=!0);var p=0,q=k.vec3f32.fromValues(0,p,0),h=k.vec3f32.fromValues(0,p+b,0),t=k.vec3f32.fromValues(0,-1,0),r=k.vec3f32.fromValues(0,1,0);d&&(p=b,h=k.vec3f32.fromValues(0,0,0),q=k.vec3f32.fromValues(0,p,0),t=k.vec3f32.fromValues(0,1,0),r=k.vec3f32.fromValues(0,-1,0));q=[h,q];t=[t,r];r=a+2;h=Math.sqrt(b*b+c*c);if(d)for(d=a-1;0<=d;d--)u=
2*Math.PI/a*d,w=k.vec3f32.fromValues(Math.cos(u)*c,p,Math.sin(u)*c),q.push(w),u=k.vec3f32.fromValues(b*Math.cos(u)/h,-c/h,b*Math.sin(u)/h),t.push(u);else for(d=0;d<a;d++){var u=2*Math.PI/a*d,w=k.vec3f32.fromValues(Math.cos(u)*c,p,Math.sin(u)*c);q.push(w);u=k.vec3f32.fromValues(b*Math.cos(u)/h,c/h,b*Math.sin(u)/h);t.push(u)}b=new Uint32Array(6*(a+2));a=new Uint32Array(6*(a+2));p=c=0;if(e){for(d=3;d<q.length;d++)b[c++]=1,b[c++]=d-1,b[c++]=d,a[p++]=0,a[p++]=0,a[p++]=0;b[c++]=q.length-1;b[c++]=2;b[c++]=
1;a[p++]=0;a[p++]=0;a[p++]=0}if(g){for(d=3;d<q.length;d++)b[c++]=d,b[c++]=d-1,b[c++]=0,a[p++]=d,a[p++]=d-1,a[p++]=1;b[c++]=0;b[c++]=2;b[c++]=q.length-1;a[p++]=1;a[p++]=2;a[p++]=t.length-1}e=new Float32Array(3*r);for(d=0;d<r;d++)e[3*d]=q[d][0],e[3*d+1]=q[d][1],e[3*d+2]=q[d][2];g=new Float32Array(3*r);for(d=0;d<r;d++)g[3*d]=t[d][0],g[3*d+1]=t[d][1],g[3*d+2]=t[d][2];q={};q[f.VertexAttrConstants.POSITION]=b;q[f.VertexAttrConstants.NORMAL]=a;t={};t[f.VertexAttrConstants.POSITION]={size:3,data:e};t[f.VertexAttrConstants.NORMAL]=
{size:3,data:g};return new l.GeometryData(t,q)};a.createCylinderGeometry=function(b,c,a,d,e,g){d=d?k.vec3f32.clone(d):k.vec3f32.fromValues(1,0,0);e=e?k.vec3f32.clone(e):k.vec3f32.fromValues(0,0,0);g=void 0===g?!0:g;var p=k.vec3f32.create();m.vec3.normalize(p,d);d=k.vec3f32.create();m.vec3.scale(d,p,Math.abs(b));var q=k.vec3f32.create();m.vec3.scale(q,d,-.5);m.vec3.add(q,q,e);var h=k.vec3f32.fromValues(0,1,0);.2>Math.abs(1-m.vec3.dot(p,h))&&m.vec3.set(h,0,0,1);var t=k.vec3f32.create();m.vec3.cross(t,
p,h);m.vec3.normalize(t,t);m.vec3.cross(h,t,p);var r=2*a+(g?2:0),u=a+(g?2:0);b=new Float32Array(3*r);e=new Float32Array(3*u);var w=new Float32Array(2*r),x=new Uint32Array(3*a*(g?4:2)),v=new Uint32Array(3*a*(g?4:2));g&&(b[3*(r-2)+0]=q[0],b[3*(r-2)+1]=q[1],b[3*(r-2)+2]=q[2],w[2*(r-2)]=0,w[2*(r-2)+1]=0,b[3*(r-1)+0]=b[3*(r-2)+0]+d[0],b[3*(r-1)+1]=b[3*(r-2)+1]+d[1],b[3*(r-1)+2]=b[3*(r-2)+2]+d[2],w[2*(r-1)]=1,w[2*(r-1)+1]=1,e[3*(u-2)+0]=-p[0],e[3*(u-2)+1]=-p[1],e[3*(u-2)+2]=-p[2],e[3*(u-1)+0]=p[0],e[3*
(u-1)+1]=p[1],e[3*(u-1)+2]=p[2]);for(var p=function(b,c,a){x[b]=c;v[b]=a},z=0,y=k.vec3f32.create(),A=k.vec3f32.create(),n=0;n<a;n++){var E=2*Math.PI/a*n;m.vec3.scale(y,h,Math.sin(E));m.vec3.scale(A,t,Math.cos(E));m.vec3.add(y,y,A);e[3*n+0]=y[0];e[3*n+1]=y[1];e[3*n+2]=y[2];m.vec3.scale(y,y,c);m.vec3.add(y,y,q);b[3*n+0]=y[0];b[3*n+1]=y[1];b[3*n+2]=y[2];w[2*n+0]=n/a;w[2*n+1]=0;b[3*(n+a)+0]=b[3*n+0]+d[0];b[3*(n+a)+1]=b[3*n+1]+d[1];b[3*(n+a)+2]=b[3*n+2]+d[2];w[2*(n+a)+0]=n/a;w[2*n+1]=1;E=(n+1)%a;p(z++,
n,n);p(z++,n+a,n);p(z++,E,E);p(z++,E,E);p(z++,n+a,n);p(z++,E+a,E)}if(g){for(n=0;n<a;n++)E=(n+1)%a,p(z++,r-2,u-2),p(z++,n,u-2),p(z++,E,u-2);for(n=0;n<a;n++)E=(n+1)%a,p(z++,n+a,u-1),p(z++,r-1,u-1),p(z++,E+a,u-1)}c={};c[f.VertexAttrConstants.POSITION]=x;c[f.VertexAttrConstants.NORMAL]=v;c[f.VertexAttrConstants.UV0]=x;a={};a[f.VertexAttrConstants.POSITION]={size:3,data:b};a[f.VertexAttrConstants.NORMAL]={size:3,data:e};a[f.VertexAttrConstants.UV0]={size:2,data:w};return new l.GeometryData(a,c)};a.createTubeGeometry=
function(b,c,d,e,g){d=d||10;e=null!=e?e:!0;f.assert(1<b.length);for(var l=[],p=[],q=0;q<d;q++){l.push([0,-q-1,-((q+1)%d)-1]);var h=q/d*2*Math.PI;p.push([Math.cos(h)*c,Math.sin(h)*c])}return a.createPathExtrusionGeometry(p,b,[[0,0,0]],l,e,g)};a.createPathExtrusionGeometry=function(b,c,a,e,g,p){void 0===p&&(p=k.vec3f32.fromValues(0,0,0));var q=b.length,u=new Float32Array(c.length*q*3+(6*a.length||0)),w=new Float32Array(c.length*q+(2*a.length||0)),x=new Float32Array(c.length*q*3+(a?6:0)),v=(c.length-
1)*q*6+6*e.length,z=new Uint32Array(v),v=new Uint32Array(v),y=0,A=0,n=0,E=0,B=0,G=k.vec3f32.create(),P=k.vec3f32.create(),V=k.vec3f32.create(),W=k.vec3f32.create(),Q=k.vec3f32.create(),Z=k.vec3f32.create(),X=k.vec3f32.create(),aa=h.vec3f64.create(),da=k.vec3f32.create(),ga=k.vec3f32.create(),ca=k.vec3f32.create(),ia=k.vec3f32.create(),ba=k.vec3f32.create(),oa=d.plane.create();m.vec3.set(da,0,1,0);m.vec3.subtract(P,c[1],c[0]);m.vec3.normalize(P,P);g?(m.vec3.add(aa,c[0],p),m.vec3.normalize(V,aa)):m.vec3.set(V,
0,0,1);t(P,V,da,da,Q,V,r);m.vec3.copy(W,V);m.vec3.copy(ia,Q);for(var ha=0;ha<a.length;ha++)m.vec3.scale(Z,Q,a[ha][0]),m.vec3.scale(aa,V,a[ha][2]),m.vec3.add(Z,Z,aa),m.vec3.add(Z,Z,c[0]),u[y++]=Z[0],u[y++]=Z[1],u[y++]=Z[2],w[n++]=0;x[A++]=-P[0];x[A++]=-P[1];x[A++]=-P[2];for(ha=0;ha<e.length;ha++)z[E++]=0<e[ha][0]?e[ha][0]:-e[ha][0]-1+a.length,z[E++]=0<e[ha][1]?e[ha][1]:-e[ha][1]-1+a.length,z[E++]=0<e[ha][2]?e[ha][2]:-e[ha][2]-1+a.length,v[B++]=0,v[B++]=0,v[B++]=0;for(var la=a.length,ha=a.length-1,
ra=0;ra<c.length;ra++){var va=!1;0<ra&&(m.vec3.copy(G,P),ra<c.length-1?(m.vec3.subtract(P,c[ra+1],c[ra]),m.vec3.normalize(P,P)):va=!0,m.vec3.add(ga,G,P),m.vec3.normalize(ga,ga),m.vec3.add(ca,c[ra-1],W),d.plane.fromPositionAndNormal(c[ra],ga,oa),d.plane.intersectRay(oa,d.ray.wrap(ca,G),aa)?(m.vec3.subtract(aa,aa,c[ra]),m.vec3.normalize(V,aa),m.vec3.cross(Q,ga,V),m.vec3.normalize(Q,Q)):t(ga,W,ia,da,Q,V,r),m.vec3.copy(W,V),m.vec3.copy(ia,Q));g&&(m.vec3.add(aa,c[ra],p),m.vec3.normalize(ba,aa));for(var ja=
0;ja<q;ja++)if(m.vec3.scale(Z,Q,b[ja][0]),m.vec3.scale(aa,V,b[ja][1]),m.vec3.add(Z,Z,aa),m.vec3.normalize(X,Z),x[A++]=X[0],x[A++]=X[1],x[A++]=X[2],g?w[n++]=m.vec3.dot(Z,ba):w[n++]=Z[2],m.vec3.add(Z,Z,c[ra]),u[y++]=Z[0],u[y++]=Z[1],u[y++]=Z[2],!va){var pa=(ja+1)%q;z[E++]=la+ja;z[E++]=la+q+ja;z[E++]=la+pa;z[E++]=la+pa;z[E++]=la+q+ja;z[E++]=la+q+pa;for(pa=0;6>pa;pa++)v[B++]=z[E-6+pa]-ha}la+=q}b=c[c.length-1];for(ha=0;ha<a.length;ha++)m.vec3.scale(Z,Q,a[ha][0]),m.vec3.scale(aa,V,a[ha][1]),m.vec3.add(Z,
Z,aa),m.vec3.add(Z,Z,b),u[y++]=Z[0],u[y++]=Z[1],u[y++]=Z[2],w[n++]=0;a=A/3;x[A++]=P[0];x[A++]=P[1];x[A++]=P[2];q=la-q;for(ha=0;ha<e.length;ha++)z[E++]=0<=e[ha][0]?la+e[ha][0]:-e[ha][0]-1+q,z[E++]=0<=e[ha][2]?la+e[ha][2]:-e[ha][2]-1+q,z[E++]=0<=e[ha][1]?la+e[ha][1]:-e[ha][1]-1+q,v[B++]=a,v[B++]=a,v[B++]=a;e={};e[f.VertexAttrConstants.POSITION]=z;e[f.VertexAttrConstants.NORMAL]=v;z={};z[f.VertexAttrConstants.POSITION]={size:3,data:u};z.zOffset={size:1,data:w};z[f.VertexAttrConstants.NORMAL]={size:3,
data:x};return new l.GeometryData(z,e)};a.createPolylineGeometry=function(b,c){f.assert(1<b.length,"createPolylineGeometry(): polyline needs at least 2 points");f.assert(3===b[0].length,"createPolylineGeometry(): malformed vertex");f.assert(void 0===c||c.length===b.length,"createPolylineGeometry: need same number of points and normals");f.assert(void 0===c||3===c[0].length,"createPolylineGeometry(): malformed normal");for(var a=new Float32Array(3*b.length),d=new Uint32Array(2*(b.length-1)),e=0,g=
0,p=0;p<b.length;p++){for(var q=0;3>q;q++)a[e++]=b[p][q];0<p&&(d[g++]=p-1,d[g++]=p)}e={};g={};e[f.VertexAttrConstants.POSITION]=d;g[f.VertexAttrConstants.POSITION]={size:3,data:a};if(c){for(var a=new Float32Array(3*c.length),h=0,p=0;p<b.length;p++)for(q=0;3>q;q++)a[h++]=c[p][q];e[f.VertexAttrConstants.NORMAL]=d;g[f.VertexAttrConstants.NORMAL]={size:3,data:a}}return new l.GeometryData(g,e,l.GeometryData.DefaultOffsets,"line")};a.createExtrudedTriangle=function(b,c,a,d){var e,g,p=new Float32Array(18);
b=[[-c,0,d/2],[a,0,d/2],[0,b,d/2],[-c,0,-d/2],[a,0,-d/2],[0,b,-d/2]];for(c=0;6>c;c++)p[3*c]=b[c][0],p[3*c+1]=b[c][1],p[3*c+2]=b[c][2];b=(e={},e[f.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),e);e=(g={},g[f.VertexAttrConstants.POSITION]={size:3,data:p},g);return new l.GeometryData(e,b)};a.transformInPlace=function(b,c){b=b.vertexAttributes[f.VertexAttrConstants.POSITION].data;for(var a=0;a<b.length;a+=3)m.vec3.set(w,b[a],b[a+1],b[a+2]),m.vec3.transformMat4(w,
w,c),b[a]=w[0],b[a+1]=w[1],b[a+2]=w[2]};a.addVertexColors=function(b,c){var a=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*a[0];c[1]=255*a[1];c[2]=255*a[2];c[3]=255*(3<a.length?a[3]:1);var a={},d=b.getVertexAttr(),e;for(e in d)a[e]=d[e];a[f.VertexAttrConstants.COLOR]={size:4,data:c};c={};for(e in b.indices)c[e]=b.indices[e];c[f.VertexAttrConstants.COLOR]=new Uint32Array(c[f.VertexAttrConstants.POSITION].length);return b=new l.GeometryData(a,c,b.componentOffsets,b.primitiveType)};a.addNormals=function(b){var c=
b.getVertexAttr();b=b.indices;for(var a=g.Vec3Compact.subtract,d=new Float32Array(b.position.length/3*3),e=c.position.data,l=0,p=b.position,q=new Uint32Array(p.length),h=0;h<p.length;h+=3){a(e,3*p[h],e,3*p[h+2],u,0);a(e,3*p[h],e,3*p[h+1],w,0);m.vec3.cross(w,w,u);m.vec3.normalize(w,w);var k=l/3;d[l++]=w[0];d[l++]=w[1];d[l++]=w[2];q[h]=k;q[h+1]=k;q[h+2]=k}c[f.VertexAttrConstants.NORMAL]={size:3,data:d,offsetIdx:0,strideIdx:3};b[f.VertexAttrConstants.NORMAL]=q};a.cgToGIS=function(b,c){void 0===c&&(c=
b);var a=b.getVertexAttr();b=a.position.data;var a=a.normal.data,d=c.getVertexAttr(),e=d.position.data,d=d.normal.data;if(a)for(var f=0;f<a.length;f+=3){var g=a[f+1];d[f+1]=-a[f+2];d[f+2]=g}if(b)for(f=0;f<b.length;f+=3)g=b[f+1],e[f+1]=-b[f+2],e[f+2]=g;return c};a.makeOrthoBasisDirUp=q;a.makeOrthoBasisDirUpFallback=t})(q||(q={}));var r=.99619469809,w=k.vec3f32.create(),u=k.vec3f32.create();return q})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require","exports","./factories/vec3f32"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.vec3f32=m})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require","exports"],function(n,a){function m(){return new Float32Array(3)}function k(a,c,b){var d=new Float32Array(3);d[0]=a;d[1]=c;d[2]=b;return d}function h(){return k(1,1,1)}function d(){return k(1,0,0)}function g(){return k(0,1,0)}function l(){return k(0,0,1)}Object.defineProperty(a,"__esModule",{value:!0});a.create=m;a.clone=function(a){var c=new Float32Array(3);
c[0]=a[0];c[1]=a[1];c[2]=a[2];return c};a.fromValues=k;a.createView=function(a,c){return new Float32Array(a,c,3)};a.zeros=function(){return m()};a.ones=h;a.unitX=d;a.unitY=g;a.unitZ=l;a.ZEROS=m();a.ONES=h();a.UNIT_X=d();a.UNIT_Y=g();a.UNIT_Z=l()})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});a.plane=g;a.boundedPlane=k;a.triangle=c;a.lineSegment=d;a.ray=l;a.sphere=f;a.frustum=h;a.vector=b;a.axisAngle=m})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(n,a,m,k,h){function d(d){void 0===d&&(d=a.UP);return[d[0],d[1],d[2],d[3]]}function g(a,f,c,b,e){void 0===e&&(e=d());e[0]=a;e[1]=f;e[2]=c;e[3]=b;return e}
Object.defineProperty(a,"__esModule",{value:!0});a.create=d;a.wrap=function(a,d,c,b){return g(a,d,c,b,k.sv4d.get())};a.wrapAxisAngle=function(a,d){return g(a[0],a[1],a[2],d,k.sv4d.get())};a.copy=function(a,f){void 0===f&&(f=d());return g(a[0],a[1],a[2],a[3],f)};a.fromValues=g;a.fromAxisAndAngle=function(a,f,c){void 0===c&&(c=d());m.vec3.copy(c,a);c[3]=f;return c};a.fromPoints=function(a,f,c){void 0===c&&(c=d());m.vec3.cross(c,a,f);m.vec3.normalize(c,c);c[3]=h.angle(a,f);return c};a.UP=[0,0,1,0]})},
"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.sv2d=m.VectorStack.createVec2f64();a.sv3d=m.VectorStack.createVec3f64();a.sv4d=m.VectorStack.createVec4f64();a.sm3d=m.VectorStack.createMat3f64();a.sm4d=m.VectorStack.createMat4f64();a.sq4d=m.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function b(b,c,a){var d=this;this.itemByteSize=b;this.itemCreate=c;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(a/this.itemByteSize);this.tickHandle=m.before(function(){return d.reset()})}b.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.itemsPtr=0;this.buffers=this.items=null};b.prototype.get=function(){0===
this.itemsPtr&&m(function(){});for(var b=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=b;){for(var c=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),a=0;a<this.itemsPerBuffer;++a)this.items.push(this.itemCreate(c,a*this.itemByteSize));this.buffers.push(c)}return this.items[this.itemsPtr++]};b.prototype.reset=function(){for(var b=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>b;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;
this.itemsPtr=0};b.createVec2f64=function(a){void 0===a&&(a=c);return new b(16,g.vec2f64.createView,a)};b.createVec3f64=function(a){void 0===a&&(a=c);return new b(24,l.vec3f64.createView,a)};b.createVec4f64=function(a){void 0===a&&(a=c);return new b(32,f.vec4f64.createView,a)};b.createMat3f64=function(a){void 0===a&&(a=c);return new b(72,k.mat3f64.createView,a)};b.createMat4f64=function(a){void 0===a&&(a=c);return new b(128,h.mat4f64.createView,a)};b.createQuatf64=function(a){void 0===a&&(a=c);return new b(32,
d.quatf64.createView,a)};Object.defineProperty(b.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0});return b}();a.VectorStack=n;var c=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat3f64=m})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(n,
a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,0,0,1,0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]};a.fromValues=function(a,k,h,d,g,l,f,c,b){return[a,k,h,d,g,l,f,c,b]};a.createView=function(a,k){return new Float64Array(a,k,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.quatf64=m})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3]]};a.fromValues=function(a,k,h,d){return[a,k,h,d]};a.createView=function(a,k){return new Float64Array(a,k,4)}})},"esri/core/libs/gl-matrix-2/vec2f64":function(){define(["require","exports","./factories/vec2f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.vec2f64=m})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[0,0]};a.clone=function(a){return[a[0],a[1]]};a.fromValues=function(a,k){return[a,k]};a.fromArray=function(a){for(var k=[0,0],h=Math.min(2,a.length),d=0;d<h;++d)k[d]=a[d];return k};a.createView=function(a,k){return new Float64Array(a,k,2)};a.zeros=function(){return[0,0]};a.ones=function(){return[1,1]};a.unitX=function(){return[1,0]};a.unitY=function(){return[0,1]};a.ZEROS=[0,0];a.ONES=[1,1];a.UNIT_X=
[1,0];a.UNIT_Y=[0,1]})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(n,a,m,k){function h(a,g){return k.vec3.dot(a,g)/k.vec3.length(a)}Object.defineProperty(a,"__esModule",{value:!0});a.projectPoint=function(a,g,l){g=h(a,g);return k.vec3.scale(l,a,g)};a.projectPointSignedLength=h;a.angle=function(a,g){a=k.vec3.dot(a,g)/(k.vec3.length(a)*k.vec3.length(g));return-m.acosClamped(a)}})},
"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){function u(b){void 0===b&&(b=
a.UP);return{plane:q.create(b.plane),origin:c.vec3f64.clone(b.origin),basis1:c.vec3f64.clone(b.basis1),basis2:c.vec3f64.clone(b.basis2)}}function v(b,c){void 0===c&&(c=u());return y(b.origin,b.basis1,b.basis2,c)}function y(b,c,a,d){void 0===d&&(d=u());f.vec3.copy(d.origin,b);f.vec3.copy(d.basis1,c);f.vec3.copy(d.basis2,a);q.fromVectorsAndPoint(a,c,b,d.plane);b=d;1E-6<Math.abs(f.vec3.dot(b.basis1,b.basis2)/(f.vec3.length(b.basis1)*f.vec3.length(b.basis2)))&&J.warn("fromValues()","Provided basis vectors are not perpendicular");
1E-6<Math.abs(f.vec3.dot(b.basis1,b.plane))&&J.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-f.vec3.dot(b.plane,b.origin)-b.plane[3])&&J.warn("fromValues()","Plane offset is not consistent with plane origin");return d}function t(b,c,a){b!==a&&v(b,a);b=f.vec3.scale(e.sv3d.get(),b.plane,c);f.vec3.add(a.origin,a.origin,b);a.plane[3]-=c;return a}function x(b,c){void 0===c&&(c=u());var a=(b[2]-b[0])/2,d=(b[3]-b[1])/2;f.vec3.set(c.origin,b[0]+a,b[1]+d,0);f.vec3.set(c.basis1,
a,0,0);f.vec3.set(c.basis2,0,d,0);q.fromValues(0,0,1,0,c.plane);return c}function z(b,c,a){return q.intersectRay(b.plane,c,a)?K(b,a):!1}function A(c,a,d){var g=M.get(),l=M.get();I(c,a,g,l);for(var l=Number.POSITIVE_INFINITY,p=0,k=T;p<k.length;p++){var t=N(c,k[p],L.get()),r=e.sv3d.get();q.intersectLineSegment(g,t,r)&&(t=b.directionFromTo(e.sv3d.get(),a.origin,r),t=Math.abs(h.acosClamped(f.vec3.dot(a.direction,t))),t<l&&(l=t,f.vec3.copy(d,r)))}return l===Number.POSITIVE_INFINITY?E(c,a,d):d}function E(b,
c,a){if(z(b,c,a))return a;var d=M.get(),g=M.get();I(b,c,d,g);for(var l=Number.POSITIVE_INFINITY,p=0,h=T;p<h.length;p++){var k=N(b,h[p],L.get()),t=e.sv3d.get();q.intersectLineSegmentClamp(d,k,t)&&(k=r.distance2(c,t),q.isPointInside(g,t)&&k<l&&(l=k,f.vec3.copy(a,t)))}G(b,c.origin)<l&&f.vec3.copy(a,c.origin);return a}function B(b,c,a){var d=b.origin,g=b.basis1,l=b.basis2;c=f.vec3.subtract(e.sv3d.get(),c,d);g=w.projectPointSignedLength(g,c)/f.vec3.length(g);l=w.projectPointSignedLength(l,c)/f.vec3.length(l);
b=w.projectPointSignedLength(b.plane,c);return f.vec3.set(a,g,l,b)}function G(b,c){c=B(b,c,e.sv3d.get());var a=b.basis2;b=f.vec3.length(b.basis1);a=f.vec3.length(a);b=Math.max(Math.abs(c[0])-b,0);a=Math.max(Math.abs(c[1])-a,0);c=c[2];return b*b+a*a+c*c}function F(b,c){var a=-b.plane[3];return w.projectPointSignedLength(b.plane,c)-a}function K(b,c){var a=f.vec3.subtract(e.sv3d.get(),c,b.origin);c=f.vec3.squaredLength(b.basis1);var d=f.vec3.squaredLength(b.basis2),g=f.vec3.dot(b.basis1,a);b=f.vec3.dot(b.basis2,
a);return 0>-g-c&&0>g-c&&0>-b-d&&0>b-d}function H(b,c){var a=L.get();f.vec3.copy(a.origin,b.origin);f.vec3.copy(a.vector,c);return a}function N(b,c,a){var d=b.basis1,g=b.basis2;b=b.origin;var l=f.vec3.scale(e.sv3d.get(),d,c.origin[0]),p=f.vec3.scale(e.sv3d.get(),g,c.origin[1]);f.vec3.add(a.origin,l,p);f.vec3.add(a.origin,a.origin,b);d=f.vec3.scale(e.sv3d.get(),d,c.direction[0]);c=f.vec3.scale(e.sv3d.get(),g,c.direction[1]);f.vec3.scale(a.vector,f.vec3.add(d,d,c),2);return a}function I(b,c,a,d){b=
b.plane;q.fromVectorsAndPoint(b,c.direction,c.origin,a);q.fromVectorsAndPoint(a,b,c.origin,d)}Object.defineProperty(a,"__esModule",{value:!0});var J=k.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");n=function(){return function(){this.plane=q.create();this.origin=c.vec3f64.create();this.basis1=c.vec3f64.create();this.basis2=c.vec3f64.create()}}();a.BoundedPlaneClass=n;a.create=u;a.wrap=function(b,c,a){var d=O.get();d.origin=b;d.basis1=c;d.basis2=a;d.plane=q.fromVectorsAndPoint(a,c,b,
q.wrap(0,0,0,0));return d};a.copy=v;a.fromValues=y;a.elevate=t;a.setExtent=function(b,c,a){x(c,a);t(a,F(b,b.origin),a);return a};a.fromAABoundingRect=x;a.intersectRay=z;a.intersectRayClosestSilhouette=function(b,c,a){if(z(b,c,a))return a;b=A(b,c,e.sv3d.get());f.vec3.add(a,c.origin,f.vec3.scale(e.sv3d.get(),c.direction,f.vec3.distance(c.origin,b)/f.vec3.length(c.direction)));return a};a.closestPointOnSilhouette=A;a.closestPoint=E;a.projectPoint=function(b,c,a){var d=q.projectPoint(b.plane,c,e.sv3d.get());
c=p.projectPointClamp(H(b,b.basis1),d,-1,1,e.sv3d.get());d=p.projectPointClamp(H(b,b.basis2),d,-1,1,e.sv3d.get());f.vec3.subtract(a,f.vec3.add(e.sv3d.get(),c,d),b.origin);return a};a.projectPointLocal=B;a.distance2=G;a.distance=function(b,c){return Math.sqrt(G(b,c))};a.distanceToSilhouette=function(b,c){for(var a=Number.NEGATIVE_INFINITY,d=0,e=T;d<e.length;d++){var f=N(b,e[d],L.get()),f=p.distance2(f,c);f>a&&(a=f)}return Math.sqrt(a)};a.extrusionContainsPoint=function(b,c){return q.isPointInside(b.plane,
c)&&K(b,c)};a.axisAt=function(b,c,a,d){switch(a){case 0:f.vec3.copy(d,b.basis1);f.vec3.normalize(d,d);break;case 1:f.vec3.copy(d,b.basis2);f.vec3.normalize(d,d);break;case 2:f.vec3.copy(d,b.plane);break;default:m.neverReached(a)}return d};a.altitudeAt=F;a.setAltitudeAt=function(b,c,a,d){var e=F(b,c);b=f.vec3.scale(R,b.plane,a-e);f.vec3.add(d,c,b);return d};a.transform=function(b,c,a){b!==a&&v(b,a);g.mat4.invert(U,c);g.mat4.transpose(U,U);f.vec3.transformMat4(a.basis1,b.basis1,U);f.vec3.transformMat4(a.basis2,
b.basis2,U);f.vec3.transformMat4(a.plane,b.plane,U);f.vec3.transformMat4(a.origin,b.origin,c);q.setOffsetFromPoint(a.plane,a.origin,a.plane);return a};a.UP={plane:q.create(),origin:c.vec3f64.fromValues(0,0,0),basis1:c.vec3f64.fromValues(1,0,0),basis2:c.vec3f64.fromValues(0,1,0)};var M=new d.ObjectStack(q.create),L=new d.ObjectStack(p.create),R=c.vec3f64.create(),O=new d.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),T=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],
direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],U=l.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require","exports","./nextTick"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){var d=this;this.allocator=a;this.items=[];this.itemsPtr=0;this.tickHandle=m.before(function(){return d.reset()});this.grow()}a.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.items=
null};a.prototype.get=function(){0===this.itemsPtr&&m(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};a.prototype.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*k),this.items.length);this.itemsPtr=0};a.prototype.grow=function(){for(var a=0;a<Math.max(8,Math.min(this.items.length,k));a++)this.items.push(this.allocator())};return a}();a.ObjectStack=n;var k=1024;a.default=n})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,a,m,k,h,d,g){function l(b){return b?{origin:d.vec3f64.clone(b.origin),vector:d.vec3f64.clone(b.vector)}:{origin:d.vec3f64.create(),vector:d.vec3f64.create()}}function f(b,c){var a=r.get();a.origin=b;a.vector=c;return a}function c(b,c,a){void 0===a&&(a=l());h.vec3.copy(a.origin,b);h.vec3.copy(a.vector,c);return a}function b(b,c){c=h.vec3.subtract(g.sv3d.get(),c,b.origin);var a=h.vec3.dot(b.vector,c),d=h.vec3.dot(b.vector,b.vector),a=m.clamp(a/d,0,1);b=h.vec3.subtract(g.sv3d.get(),h.vec3.scale(g.sv3d.get(),
b.vector,a),c);return h.vec3.dot(b,b)}function e(b,c,a,d,e){var f=b.vector,l=b.origin;c=h.vec3.subtract(g.sv3d.get(),c,l);l=h.vec3.length(f);c=h.vec3.dot(f,c)/l;h.vec3.scale(e,f,m.clamp(c,a,d));return h.vec3.add(e,e,b.origin)}function p(b,c,a,d){var e=b.origin,f=h.vec3.add(g.sv3d.get(),e,b.vector);b=c.origin;var l=h.vec3.add(g.sv3d.get(),b,c.vector),p=g.sv3d.get();c=g.sv3d.get();p[0]=e[0]-b[0];p[1]=e[1]-b[1];p[2]=e[2]-b[2];c[0]=l[0]-b[0];c[1]=l[1]-b[1];c[2]=l[2]-b[2];if(1E-6>Math.abs(c[0])&&1E-6>
Math.abs(c[1])&&1E-6>Math.abs(c[2]))return!1;l=g.sv3d.get();l[0]=f[0]-e[0];l[1]=f[1]-e[1];l[2]=f[2]-e[2];if(1E-6>Math.abs(l[0])&&1E-6>Math.abs(l[1])&&1E-6>Math.abs(l[2]))return!1;var f=p[0]*c[0]+p[1]*c[1]+p[2]*c[2],q=c[0]*l[0]+c[1]*l[1]+c[2]*l[2],k=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],r=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*k-q*q;if(1E-6>Math.abs(r))return!1;p=(f*q-(p[0]*l[0]+p[1]*l[1]+p[2]*l[2])*k)/r;f=(f+q*p)/k;a&&(p=m.clamp(p,0,1),f=m.clamp(f,0,1));a=g.sv3d.get();q=g.sv3d.get();a[0]=e[0]+p*l[0];a[1]=e[1]+p*
l[1];a[2]=e[2]+p*l[2];q[0]=b[0]+f*c[0];q[1]=b[1]+f*c[1];q[2]=b[2]+f*c[2];d.tA=p;d.tB=f;d.pA=a;d.pB=q;d.distance2=h.vec3.squaredDistance(a,q);return!0}Object.defineProperty(a,"__esModule",{value:!0});a.create=l;a.wrap=f;a.copy=function(b,a){void 0===a&&(a=l());return c(b.origin,b.vector,a)};a.fromValues=c;a.fromPoints=function(b,c,a){void 0===a&&(a=l());h.vec3.copy(a.origin,b);h.vec3.subtract(a.vector,c,b);return a};a.distance2=b;a.distance=function(c,a){return Math.sqrt(b(c,a))};a.projectPoint=function(b,
c,a){return e(b,c,0,1,a)};a.projectPointClamp=e;a.closestRayDistance2=function(b,c){if(p(b,f(c.origin,c.direction),!1,q)){c=q.tA;var a=q.pB,d=q.distance2;if(0<=c&&1>=c)return d;if(0>c)return h.vec3.squaredDistance(b.origin,a);if(1<c)return h.vec3.squaredDistance(h.vec3.add(g.sv3d.get(),b.origin,b.vector),a)}return null};a.closestLineSegmentPoint=function(b,c,a){return p(b,c,!0,q)?(h.vec3.copy(a,q.pA),!0):!1};a.closestLineSegmentDistance2=function(b,c){return p(b,c,!0,q)?q.distance2:null};var q={tA:0,
tB:0,pA:d.vec3f64.create(),pB:d.vec3f64.create(),distance2:0},r=new k.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../stack"],function(n,a,m,k,h){function d(b){void 0===b&&(b=a.UP);return[b[0],b[1],b[2],b[3]]}function g(b,c){void 0===c&&(c=d());return l(b[0],b[1],b[2],b[3],c)}function l(b,c,a,e,f){void 0===f&&(f=d());f[0]=b;f[1]=c;
f[2]=a;f[3]=e;return f}function f(b,a,e){void 0===e&&(e=d());k.vec3.copy(e,a);a=k.vec3.dot(a,a);1E-5<Math.abs(a-1)&&1E-12<a&&k.vec3.scale(e,e,1/Math.sqrt(a));c(e,b,e);return e}function c(b,c,a){b!==a&&g(b,a);a[3]=-k.vec3.dot(a,c);return a}function b(b,c,a,e){void 0===e&&(e=d());b=k.vec3.cross(h.sv3d.get(),c,b);return f(a,b,e)}function e(b,c,a){b=k.vec3.scale(h.sv3d.get(),b,k.vec3.dot(b,c));k.vec3.subtract(a,c,b);return a}function p(b,c){return k.vec3.dot(b,c)+b[3]}function q(b,c,a,d,e,f){var g=k.vec3.dot(b,
a);if(0===g)return!1;b=-(k.vec3.dot(b,c)+b[3])/g;e&&(b=d?Math.max(0,b):m.clamp(b,0,1));if(0>b||!d&&1<b)return!1;k.vec3.add(f,c,k.vec3.scale(f,a,b));return!0}Object.defineProperty(a,"__esModule",{value:!0});a.create=d;a.wrap=function(b,c,a,d){return l(b,c,a,d,h.sv4d.get())};a.copy=g;a.fromValues=l;a.fromNormalAndOffset=function(b,c,a){void 0===a&&(a=d());k.vec3.copy(a,b);a[3]=c;return a};a.fromPositionAndNormal=f;a.fromPoints=function(c,a,e,f){void 0===f&&(f=d());return b(k.vec3.subtract(h.sv3d.get(),
c,a),k.vec3.subtract(h.sv3d.get(),e,a),c,f)};a.setOffsetFromPoint=c;a.negate=function(b,c){c[0]=-b[0];c[1]=-b[1];c[2]=-b[2];c[3]=-b[3];return c};a.fromVectorsAndPoint=b;a.intersectRay=function(b,c,a){return q(b,c.origin,c.direction,!0,!1,a)};a.intersectLineSegment=function(b,c,a){return q(b,c.origin,c.vector,!1,!1,a)};a.intersectLineSegmentClamp=function(b,c,a){return q(b,c.origin,c.vector,!1,!0,a)};a.isSphereFullyInside=function(b,c){var a=c.radius;return 0<=p(b,c.center)-a};a.isSphereFullyOutside=
function(b,c){var a=c.radius;return 0>p(b,c.center)+a};a.isPointInside=function(b,c){return 0<=p(b,c)};a.isPointOutside=function(b,c){return 0>p(b,c)};a.isAABBFullyInside=function(b,c){var a=c[0],d=c[1],e=c[2],f=c[3],g=c[4];c=c[5];return 0<=b[0]*(0<b[0]?a:f)+b[1]*(0<b[1]?d:g)+b[2]*(0<b[2]?e:c)+b[3]};a.clip=function(b,c){var a=k.vec3.dot(b,c.ray.direction);b=-p(b,c.ray.origin);if(0>b&&0<=a)return!1;if(-1E-6<a&&1E-6>a)return 0<b;if((0>b||0>a)&&!(0>b&&0>a))return!0;b/=a;0<a?b<c.c1&&(c.c1=b):b>c.c0&&
(c.c0=b);return c.c0<=c.c1};a.projectPoint=function(b,c,a){var d=k.vec3.scale(h.sv3d.get(),b,-b[3]);c=k.vec3.subtract(h.sv3d.get(),c,d);b=e(b,c,h.sv3d.get());k.vec3.add(a,b,d);return a};a.projectVector=e;a.distance=function(b,c){return Math.abs(p(b,c))};a.signedDistance=p;a.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,a,m,k,h,d,g,l){function f(b){return b?{origin:g.vec3f64.clone(b.origin),direction:g.vec3f64.clone(b.direction)}:{origin:g.vec3f64.create(),direction:g.vec3f64.create()}}function c(b,c,a){void 0===a&&(a=f());d.vec3.copy(a.origin,b);d.vec3.copy(a.direction,c);return a}function b(b,c,a){void 0===a&&(a=f());var e=k.castRenderScreenPointArray3(h.vec2.copy(l.sv3d.get(),c));e[2]=0;b.unprojectPoint(e,a.origin);c=k.castRenderScreenPointArray3(h.vec2.copy(l.sv3d.get(),c));c[2]=1;b=b.unprojectPoint(c,
l.sv3d.get());d.vec3.subtract(a.direction,b,a.origin);return a}function e(b,c,a){void 0===a&&(a=f());d.vec3.copy(a.origin,b.eye);c=d.vec3.set(l.sv3d.get(),c[0],c[1],1);b=b.unprojectPoint(c,l.sv3d.get());d.vec3.subtract(a.direction,b,a.origin);return a}function p(b,c){b=d.vec3.cross(l.sv3d.get(),d.vec3.normalize(l.sv3d.get(),b.direction),d.vec3.subtract(l.sv3d.get(),c,b.origin));return d.vec3.dot(b,b)}function q(){return{origin:null,direction:null}}Object.defineProperty(a,"__esModule",{value:!0});
a.create=f;a.wrap=function(b,c){var a=r.get();a.origin=b;a.direction=c;return a};a.copy=function(b,a){void 0===a&&(a=f());return c(b.origin,b.direction,a)};a.fromPoints=function(b,c,a){void 0===a&&(a=f());d.vec3.copy(a.origin,b);d.vec3.subtract(a.direction,c,b);return a};a.fromValues=c;a.fromScreen=function(c,a,d){void 0===d&&(d=f());return b(c,c.screenToRender(a,k.castRenderScreenPointArray3(l.sv3d.get())),d)};a.fromRender=b;a.fromScreenAtEye=function(b,c,a){void 0===a&&(a=f());return e(b,b.screenToRender(c,
k.castRenderScreenPointArray3(l.sv3d.get())),a)};a.fromRenderAtEye=e;a.distance2=p;a.distance=function(b,c){return Math.sqrt(p(b,c))};a.closestPoint=function(b,c,a){c=d.vec3.dot(b.direction,d.vec3.subtract(a,c,b.origin));d.vec3.add(a,b.origin,d.vec3.scale(a,b.direction,c));return a};a.createWrapper=q;var r=new m.ObjectStack(q)})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){function e(c){if(c){var a=c.planes;c=c.points;return{planes:[b.create(a[0]),b.create(a[1]),b.create(a[2]),b.create(a[3]),b.create(a[4]),b.create(a[5])],points:[d.vec3f64.clone(c[0]),d.vec3f64.clone(c[1]),d.vec3f64.clone(c[2]),d.vec3f64.clone(c[3]),d.vec3f64.clone(c[4]),d.vec3f64.clone(c[5]),d.vec3f64.clone(c[6]),d.vec3f64.clone(c[7])]}}return{planes:[b.create(),b.create(),b.create(),b.create(),b.create(),b.create()],points:[d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),
d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create()]}}function p(c,a,d){void 0===d&&(d=e());for(var f=0;6>f;f++)b.copy(c[f],d.planes[f]);for(f=0;8>f;f++)h.vec3.copy(d.points[f],a[f]);return d}function q(c){var a=c.planes;c=c.points;b.fromPoints(c[4],c[0],c[3],a[0]);b.fromPoints(c[1],c[5],c[6],a[1]);b.fromPoints(c[4],c[5],c[1],a[2]);b.fromPoints(c[3],c[2],c[6],a[3]);b.fromPoints(c[0],c[1],c[2],a[4]);b.fromPoints(c[5],c[4],c[7],a[5])}function r(c,a){for(var d=
0;6>d;d++)if(!b.clip(c[d],a))return!1;return!0}Object.defineProperty(a,"__esModule",{value:!0});a.create=e;a.copy=function(b,c){void 0===c&&(c=e());return p(b.planes,b.points,c)};a.fromValues=p;a.fromMatrix=function(b,c,a){void 0===a&&(a=e());var d=a.points;b=k.mat4.multiply(f.sm4d.get(),c,b);k.mat4.invert(b,b);for(c=0;8>c;++c){var l=g.vec4.transformMat4(f.sv4d.get(),w[c],b);h.vec3.set(d[c],l[0]/l[3],l[1]/l[3],l[2]/l[3])}q(a);return a};a.recomputePlanes=q;a.intersectsSphere=function(c,a){for(var d=
0;6>d;d++)if(b.isSphereFullyInside(c[d],a))return!1;return!0};a.intersectsRay=function(b,a){return r(b,c.fromRay(a,u.get()))};a.intersectsLineSegment=function(b,a,d){return r(b,c.fromLineSegmentAndDirection(a,d,u.get()))};a.intersectsPoint=function(c,a){for(var d=0;6>d;d++)if(0<b.signedDistance(c[d],a))return!1;return!0};a.intersectsAABB=function(c,a){for(var d=0;6>d;d++)if(b.isAABBFullyInside(c[d],a))return!1;return!0};a.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,
6,2],left:[4,0,3,7],top:[7,3,2,6]};var w=[l.vec4f64.fromValues(-1,-1,-1,1),l.vec4f64.fromValues(1,-1,-1,1),l.vec4f64.fromValues(1,1,-1,1),l.vec4f64.fromValues(-1,1,-1,1),l.vec4f64.fromValues(-1,-1,1,1),l.vec4f64.fromValues(1,-1,1,1),l.vec4f64.fromValues(1,1,1,1),l.vec4f64.fromValues(-1,1,1,1)],u=new m.ObjectStack(c.create)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),
function(n,a,m,k,h,d){function g(b){return b?{ray:d.create(b.ray),c0:b.c0,c1:b.c1}:{ray:d.create(),c0:0,c1:Number.MAX_VALUE}}function l(b,c,a,f){void 0===f&&(f=g());d.copy(b,f.ray);f.c0=c;f.c1=a;return f}function f(b,c,a){void 0===a&&(a=g());var e=k.vec3.length(b.vector);d.fromValues(b.origin,c,a.ray);a.c0=0;a.c1=e;return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=g;a.wrap=function(b,a,d){var e=c.get();e.ray=b;e.c0=a;e.c1=d;return e};a.copy=function(b,c){void 0===c&&(c=g());return l(b.ray,
b.c0,b.c1,c)};a.fromValues=l;a.fromRay=function(b,c){void 0===c&&(c=g());d.copy(b,c.ray);c.c0=0;c.c1=Number.MAX_VALUE;return c};a.fromLineSegment=function(b,c){void 0===c&&(c=g());var a=k.vec3.normalize(h.sv3d.get(),b.vector);return f(b,a,c)};a.fromLineSegmentAndDirection=f;var c=new m.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){function q(b){return b?{radius:b.radius,center:f.vec3f64.clone(b.center)}:{radius:1,center:f.vec3f64.create()}}function r(b,c){void 0===c&&(c=q());return w(b.radius,b.center,c)}function w(b,c,a){void 0===a&&(a=q());l.vec3.copy(a.center,c);a.radius=b;return a}function u(b,c,a){var d=l.vec3.subtract(e.sv3d.get(),c.origin,b.center),f=l.vec3.dot(c.direction,c.direction),g=2*l.vec3.dot(c.direction,d);b=l.vec3.dot(d,d)-b.radius*b.radius;b=g*g-4*f*b;if(0>b)return!1;d=
Math.sqrt(b);b=(-g-d)/(2*f);f=(-g+d)/(2*f);if(0>b||f<b&&0<f)b=f;if(0>b)return!1;a&&l.vec3.add(a,c.origin,l.vec3.scale(e.sv3d.get(),c.direction,b));return!0}function v(b,a,d){var f=e.sv3d.get(),p=e.sm4d.get();l.vec3.cross(f,a.origin,a.direction);l.vec3.cross(d,f,a.origin);l.vec3.scale(d,d,1/l.vec3.length(d)*b.radius);b=t(b,a.origin);a=c.vector.angle(a.origin,d);g.mat4.identity(p);g.mat4.rotate(p,p,a+b,f);l.vec3.transformMat4(d,d,p);return d}function y(b,c,a){c=l.vec3.subtract(e.sv3d.get(),c,b.center);
c=l.vec3.scale(e.sv3d.get(),c,b.radius/l.vec3.length(c));return l.vec3.add(a,c,b.center)}function t(b,c){c=l.vec3.subtract(e.sv3d.get(),c,b.center);c=l.vec3.length(c);return h.acosClamped(b.radius/(b.radius+Math.abs(b.radius-c)))}function x(c,a,d,e){c=l.vec3.subtract(E,a,c.center);switch(d){case 0:return c=b.cartesianToSpherical(c,E),c=c[2],l.vec3.set(e,-Math.sin(c),Math.cos(c),0);case 1:return c=b.cartesianToSpherical(c,E),d=c[1],c=c[2],a=Math.sin(d),l.vec3.set(e,-a*Math.cos(c),-a*Math.sin(c),Math.cos(d));
case 2:return l.vec3.normalize(e,c);default:m.neverReached(d)}}function z(b,c){c=l.vec3.subtract(K,c,b.center);return l.vec3.length(c)-b.radius}Object.defineProperty(a,"__esModule",{value:!0});var A=k.getLogger("esri.views.3d.support.geometryUtils.sphere");a.create=q;a.wrap=function(b,c){var a=B.get();a.radius=b;a.center=c||F;return a};a.copy=r;a.fromValues=w;a.elevate=function(b,c,a){b!==a&&l.vec3.copy(a.center,b.center);a.radius=b.radius+c;return a};a.setExtent=function(b,c,a){A.error("sphere.setExtent is not yet supported");
return b===a?a:r(b,a)};a.intersectRay=u;a.intersectScreen=function(b,c,a,d){c=p.fromScreenAtEye(c,a,G);return u(b,c,d)};a.intersectsRay=function(b,c){return u(b,c,null)};a.intersectRayClosestSilhouette=function(b,c,a){if(u(b,c,a))return a;b=v(b,c,e.sv3d.get());l.vec3.add(a,c.origin,l.vec3.scale(e.sv3d.get(),c.direction,l.vec3.distance(c.origin,b)/l.vec3.length(c.direction)));return a};a.closestPointOnSilhouette=v;a.closestPoint=function(b,c,a){if(u(b,c,a))return a;p.closestPoint(c,b.center,a);return y(b,
a,a)};a.projectPoint=y;a.distanceToSilhouette=function(b,c){c=l.vec3.subtract(e.sv3d.get(),c,b.center);c=l.vec3.squaredLength(c);return Math.sqrt(Math.abs(c-b.radius*b.radius))};a.angleToSilhouette=t;var E=f.vec3f64.create();a.axisAt=x;a.altitudeAt=z;a.setAltitudeAt=function(b,c,a,d){var e=z(b,c);b=x(b,c,2,K);a=l.vec3.scale(K,b,a-e);l.vec3.add(d,c,a);return d};var B=new d.ObjectStack(function(){return{center:null,radius:0}}),G=p.create(),F=f.vec3f64.create(),K=f.vec3f64.create();Object.freeze(F)})},
"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),function(n,a,m,k,h,d,g,l){function f(b){return b?{p0:d.vec3f64.clone(b.p0),p1:d.vec3f64.clone(b.p1),p2:d.vec3f64.clone(b.p2)}:{p0:d.vec3f64.create(),p1:d.vec3f64.create(),p2:d.vec3f64.create()}}function c(b,c,a,d){void 0===d&&(d=f());h.vec3.copy(d.p0,
b);h.vec3.copy(d.p1,c);h.vec3.copy(d.p2,a);return d}function b(b,c,a){var d=k.vec2.distance(b,c);c=k.vec2.distance(c,a);b=k.vec2.distance(a,b);a=(d+c+b)/2;d=a*(a-d)*(a-c)*(a-b);return 0>=d?0:Math.sqrt(d)}Object.defineProperty(a,"__esModule",{value:!0});a.create=f;a.wrap=function(b,c,a){var d=p.get();d.p0=b;d.p1=c;d.p2=a;return d};a.copy=function(b,a){void 0===a&&(a=f());return c(b.p0,b.p1,b.p2,a)};a.fromValues=c;a.distance2=function(b,c){var a=b.p0,d=b.p1;b=b.p2;var f=h.vec3.subtract(g.sv3d.get(),
d,a),p=h.vec3.subtract(g.sv3d.get(),b,d),q=h.vec3.subtract(g.sv3d.get(),a,b),k=h.vec3.subtract(g.sv3d.get(),c,a),r=h.vec3.subtract(g.sv3d.get(),c,d),m=h.vec3.subtract(g.sv3d.get(),c,b),n=h.vec3.cross(f,f,q),B=h.vec3.dot(h.vec3.cross(g.sv3d.get(),f,n),k),r=h.vec3.dot(h.vec3.cross(g.sv3d.get(),p,n),r),m=h.vec3.dot(h.vec3.cross(g.sv3d.get(),q,n),m);if(0<B&&0<r&&0<m)return c=h.vec3.dot(n,k),c*c/h.vec3.dot(n,n);a=l.distance2(l.fromValues(a,f,e.get()),c);d=l.distance2(l.fromValues(d,p,e.get()),c);c=l.distance2(l.fromValues(b,
q,e.get()),c);return Math.min(a,d,c)};a.intersectRay=function(b,c,a){var d=c.direction;c=c.origin;var e=b.p0,f=b.p1,g=b.p2,l=f[0]-e[0],p=f[1]-e[1],q=f[2]-e[2],f=g[0]-e[0];b=g[1]-e[1];var g=g[2]-e[2],k=d[1]*g-b*d[2],r=d[2]*f-g*d[0],m=d[0]*b-f*d[1],w=l*k+p*r+q*m;if(-1E-5<w&&1E-5>w)return!1;var w=1/w,n=c[0]-e[0],H=c[1]-e[1],e=c[2]-e[2],k=w*(n*k+H*r+e*m);if(0>k||1<k)return!1;r=H*q-p*e;q=e*l-q*n;l=n*p-l*H;p=w*(d[0]*r+d[1]*q+d[2]*l);if(0>p||1<k+p)return!1;a&&(h.vec3.scale(a,d,w*(f*r+b*q+g*l)),h.vec3.add(a,
c,a));return!0};a.areaPoints2d=b;a.area2d=function(c){return b(c.p0,c.p1,c.p2)};var e=new m.ObjectStack(l.create),p=new m.ObjectStack(function(){return{p0:null,p1:null,p2:null}})})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(d,l,f,c){void 0===l&&(l=a.DefaultIndices);void 0===f&&(f=a.DefaultOffsets);void 0===c&&(c=
"triangle");this.preinterleaved=!1;var b={},e;for(e in d){var g=d[e],q=g.size;b[e]={data:g.data,size:q,offsetIdx:0,strideIdx:q}}if(l===a.DefaultIndices){l=h.getFirstObjectValue(b);l=null==l?0:l.data.length/l.size;d=k.generateDefaultIndexArray(l);l={};for(var r in b)l[r]=d}this._id=k.getNewId();this._vertexAttributes=b;this._indices=l;this._componentOffsets=m.createOffsets(f);this._primitiveType=c}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexCount",{get:function(){var a=h.getFirstObjectValue(this._indices);return null==a?0:
a.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});a.prototype.getVertexAttr=function(){return this.vertexAttributes};a.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};a.prototype.getIndices=function(a){return this._indices[a]};a.prototype.getAttribute=function(a){return this._vertexAttributes[a]};
a.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices[h.VertexAttrConstants.POSITION]&&(a+=12*this._indices[h.VertexAttrConstants.POSITION].length);this._indices[h.VertexAttrConstants.NORMAL]&&(a+=12*this._indices[h.VertexAttrConstants.NORMAL].length);this._indices[h.VertexAttrConstants.UV0]&&(a+=8*this._indices[h.VertexAttrConstants.UV0].length);this._indices[h.VertexAttrConstants.COLOR]&&(a+=4*this._indices[h.VertexAttrConstants.COLOR].length);return a};a.DefaultIndices={};a.DefaultOffsets=
new Uint32Array(0);return a}();a.GeometryData=n})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe"],function(n,a,m,k){function h(b,c){if(null!=b){var a=b.isVisibleBit,d=b.data,e=8*d.BYTES_PER_ELEMENT;return c<d.length*e?q(a,d,c,e):!b.isVisibleBit}return!0}function d(b){return k.isSome(b.component)?b.component:-1}function g(b,c,a,d,e){h(c,d)&&l(b,c,a,a[d],a[d+1]-1,e)}function l(b,c,a,d,e,f){a=(c=0<b.length?
b[b.length-1]:null)?c.range[1]:-1;var g=c?c.options:null;a>=d||(a+1===d&&g===f?c.range[1]=e:b.push({range:[d,e],options:f}))}function f(b){void 0===b&&(b=!0);return{isVisibleBit:!b,data:new Uint32Array(0)}}function c(b,c){return e(b,c,!0)}function b(b,c){return e(b,c,!1)}function e(b,c,a){var d=!1;b=b||w;d=b.isVisibleBit;b=b.data;c=r(c);var e=8*b.BYTES_PER_ELEMENT,f=b.length*e;a=a===d;if(0===b.length||0===c)d=!a;else if(f<c&&!a)d=!0;else{for(var g=u[e],f=u[0],l=0;l<b.length-1;l++)if(d=!a&&b[l]!==
g||a&&b[l]!==f)return d;d=b.length-1;c=u[(c-1)%e+1];d=!a&&(b[d]&c)!==c||a&&(b[d]&c)!==f}return d}function p(b){return 0<b.length}function q(b,c,a,d){var e=a/d|0;return 0!==(c[e]&1<<a-e*d)===b}function r(b){return Math.max(0,b.length-1)}Object.defineProperty(a,"__esModule",{value:!0});a.updateVisibility=function(b,c,a,d){if(a<r(c)){null==b&&(b=f());var e=b.isVisibleBit,g=b.data,l=8*g.BYTES_PER_ELEMENT,p=a/l|0,q=a-l*p;c=(r(c)-1)/l|0;var h=g;d=d===e;a<h.length*l||!d||(a=Math.max(p+1,Math.ceil(1.5*h.length)),
a=Math.min(a,c+1),g=new Uint32Array(a),g.set(h));p<g.length&&(g[p]=g[p]&~(1<<q)|(d?1:0)<<q);b.data=g}return b};a.getVisibility=h;a.hideAllComponents=function(b){if(null==b)b=f(!1);else{b.isVisibleBit=!0;for(var c=0;c<b.data.length;c++)b.data[c]=0}return b};a.unhideAllComponents=function(b){var c;if(null!=b)for(c=b,c.isVisibleBit=!1,b=0;b<c.data.length;b++)c.data[b]=0;return c};a.generateVisibleIndexRanges=function(b,c){var a;if(b)if(p(c))if(0===b.data.length)a=[],c=[[c[0],c[c.length-1]-1]],a=b.isVisibleBit?
a:c;else{a=[];for(var d=b.isVisibleBit,e=b.data,f=8*e.BYTES_PER_ELEMENT,g=e.length*f,l=r(c),h=!1,k=0;k<g&&k<l;k++){var u=q(d,e,k,f);if(u!==h){var w=c[k];u?a.push([w,0]):(h=a[a.length-1],h[1]=w-1);h=u}}b=!b.isVisibleBit;l>g&&b&&!h?a.push([c[g],c[l]-1]):h&&(h=a[a.length-1],h[1]=c[b?l:Math.min(l,g)]-1)}else a=[],a=b.isVisibleBit?a:null;else a=null;return a};a.addHighlight=function(b,c,a,e){b=b||[];c={component:c,options:a,id:e};b.push(c);a=d(c);for(e=b.length-1;0<e&&a<d(b[e-1]);)c=[b[e],b[e-1]],b[e-
1]=c[0],b[e]=c[1],--e;return b};a.removeHighlight=function(b,c){if(!b)return b;b=b.filter(function(b){return b.id!==c});return 0===b.length?null:b};a.generateHighlightedIndexRanges=function(c,a,d){if(!a)return null;if(!p(d))return c&&c.isVisibleBit?null:a.map(function(b){return{range:null,options:b.options}});for(var e=d[0],f=d[d.length-1]-1,h=[],q=!b(c,d),t=0;t<a.length;++t){var u=a[t].options,w=a[t].component;if(k.isSome(w))g(h,c,d,w,u);else if(q)l(h,c,d,e,f,u);else for(w=0;w<r(d);++w)g(h,c,d,w,
u)}return 0<h.length?h:null};a.hasHighlights=function(c,a,d){if(!a)return!1;if(!p(d))return c&&c.isVisibleBit?!1:0<a.length;c=!b(c,d);for(var e=0;e<a.length;e++)if(k.isSome(a[e].component)||c||0<r(d))return!0;return!1};a.defaultVisibilities=f;a.isAllVisible=function(c,a){return!b(c,a)};a.isAllHidden=function(b,a){return!c(b,a)};a.hasVisible=c;a.hasHidden=b;var w=f();a.createOffsets=function(b){return Array.isArray(b)?new Uint32Array(b):b};a.hasComponent=function(b,c){return c<r(b)};a.hasComponents=
p;var u=[];for(n=0;65>n;n++)u.push(Math.pow(2,n)-1);a.componentCount=r;a.componentFind=function(b,c){b=m.binaryIndexOf(b,c,!0);return 0<=b?b:null}})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});var m=1,k=null,h=new Uint32Array([0]);a.generateDefaultIndexArray=function(a){if(1===a)return h;if(a>m||null==k){for(;a>m;)m*=2;k=new Uint32Array(m);for(var d=0;d<m;d++)k[d]=d}return new Uint32Array(k.buffer,
0,a)};var d=0;a.getNewId=function(){return d++}})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(n,a,m,k,h,d,g,l,f){function c(b,c){if(!b)throw c=c||"assert",b=Error(c),b.stack&&console.log(b.stack),
new w(c);}function b(b){for(var c in b)return c}function e(b,c){b[12]=c[0];b[13]=c[1];b[14]=c[2]}function p(b,c){void 0===c&&(c=0);for(var a=0,d=0;4>d;d++)a+=b[c+d]*v[d];return a}function q(b){return b-Math.floor(b)}Object.defineProperty(a,"__esModule",{value:!0});var r=f.vec4f64.create(),w=function(){function b(b){this.message=b}b.prototype.toString=function(){return"AssertException: "+this.message};return b}();a.AssertException=w;a.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",
UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"aTangent"};a.assert=c;a.verify=function(b,c){b||console.warn("Verify failed: "+(c||"")+"\n"+Error("verify").stack)};a.encodeInt16=function(b){return m.clamp(Math.round(32767*b),-32767,32767)};a.encodeNormal=function(b,c){var a=Math.abs(b[0]),d=Math.abs(b[1]),e=1/(a+d+Math.abs(b[2])),f=Math.min(b[2]*e,0);c[0]=(0>b[0]?-1:1)*(a*e-f);c[1]=(0>b[1]?-1:
1)*(d*e-f)};a.fallbackIfUndefined=function(b,c){return void 0===b?c:b};a.hex2rgb=function(b){b=Math.floor(b);return[(b>>16&255)/255,(b>>8&255)/255,(b&255)/255]};a.rgb2hex=function(b){var c=m.clamp(Math.round(255*b[0]),0,255),a=m.clamp(Math.round(255*b[1]),0,255);b=m.clamp(Math.round(255*b[2]),0,255);return"0x"+((c<<16)+(a<<8)+b).toString(16)};a.dec2hex=function(b){b=b.toString(16);return"00000000".substr(0,8-b.length)+b};a.rayTriangle3D=function(b,c,a,d,e,f,l,p,h){void 0===h&&(h=g.vec3f64.create());
var q=d[l]-a[f],k=d[l+1]-a[f+1],r=d[l+2]-a[f+2];d=e[p]-a[f];l=e[p+1]-a[f+1];e=e[p+2]-a[f+2];var t=c[1]*e-l*c[2],u=c[2]*d-e*c[0],w=c[0]*l-d*c[1];p=q*t+k*u+r*w;if(-1E-5<p&&1E-5>p)return!1;p=1/p;var m=b[0]-a[f],x=b[1]-a[f+1];b=b[2]-a[f+2];h[1]=p*(m*t+x*u+b*w);if(0>h[1]||1<h[1])return!1;a=x*r-k*b;b=b*q-r*m;q=m*k-q*x;h[2]=p*(c[0]*a+c[1]*b+c[2]*q);if(0>h[2]||1<h[1]+h[2])return!1;h[0]=p*(d*a+l*b+e*q);return!0};a.rayBoxTest=function(b,c,a,d){var e,f=(a[0]-b[0])/c[0],g=(d[0]-b[0])/c[0];f>g&&(e=f,f=g,g=e);
var l=(a[1]-b[1])/c[1],p=(d[1]-b[1])/c[1];l>p&&(e=l,l=p,p=e);if(f>p||l>g)return!1;l>f&&(f=l);p<g&&(g=p);a=(a[2]-b[2])/c[2];b=(d[2]-b[2])/c[2];a>b&&(e=a,a=b,b=e);if(f>b||a>g)return!1;b<g&&(g=b);return 0>g?!1:!0};a.rayRay2D=function(b,c,a,e,f,g){void 0===g&&(g=d.vec2f64.create());var l=(e[f]-a[f])*(c[0]-b[0])-(e[0]-a[0])*(c[f]-b[f]);if(0===l)return!1;a=((e[0]-a[0])*(b[f]-a[f])-(e[f]-a[f])*(b[0]-a[0]))/l;g[0]=b[0]+a*(c[0]-b[0]);g[1]=b[f]+a*(c[f]-b[f]);return!0};a.project=function(b,a,d,e,f){f||(f=b);
r[0]=b[0];r[1]=b[1];r[2]=b[2];r[3]=1;l.vec4.transformMat4(r,r,a);2<f.length&&(f[2]=-r[2]);l.vec4.transformMat4(r,r,d);c(0!==r[3]);f[0]=r[0]/r[3];f[1]=r[1]/r[3];f[2]=r[2]/r[3];f[0]=(.5*f[0]+.5)*e[2]+e[0];f[1]=(.5*f[1]+.5)*e[3]+e[1]};a.getFirstObjectKey=b;a.getFirstObjectValue=function(c){return c[b(c)]};a.objectEmpty=function(b){for(var c in b)return!1;return!0};a.logWithBase=function(b,c){return Math.log(b)/Math.log(c)};a.setMatrixTranslation=e;a.setMatrixTranslation3=function(b,c,a,d){b[12]=c;b[13]=
a;b[14]=d};a.getMatrixTranslation=function(b,c){void 0===c&&(c=g.vec3f64.create());c[0]=b[12];c[1]=b[13];c[2]=b[14];return c};a.createTranslationMatrix=function(b,c){b=k.mat4.identity(b);e(b,c);return b};a.isTranslationMatrix=function(b){return 1===b[0]&&0===b[1]&&0===b[2]&&0===b[3]&&0===b[4]&&1===b[5]&&0===b[6]&&0===b[7]&&0===b[8]&&0===b[9]&&1===b[10]&&0===b[11]&&1===b[15]};a.fovx2fovy=function(b,c,a){return 2*Math.atan(a*Math.tan(.5*b)/c)};a.fovy2fovx=function(b,c,a){return 2*Math.atan(c*Math.tan(.5*
b)/a)};a.fovx2fovd=function(b,c,a){return 2*Math.atan(Math.sqrt(c*c+a*a)*Math.tan(.5*b)/c)};a.fovy2fovd=function(b,c,a){return 2*Math.atan(Math.sqrt(c*c+a*a)*Math.tan(.5*b)/a)};a.fovd2fovx=function(b,c,a){return 2*Math.atan(c*Math.tan(.5*b)/Math.sqrt(c*c+a*a))};a.fovd2fovy=function(b,c,a){return 2*Math.atan(a*Math.tan(.5*b)/Math.sqrt(c*c+a*a))};a.packFloatRGBA=function(b,c,a){void 0===a&&(a=0);b=m.clamp(b,0,y);for(var d=0;4>d;d++)c[a+d]=Math.floor(256*q(b*u[d]))};a.unpackFloatRGBA=p;var u=[1,256,
65536,16777216],v=[1/256,1/65536,1/16777216,1/4294967296],y=p(new Uint8ClampedArray([255,255,255,255]));a.inverseProjectionInfo=function(b,c,a,d,e){0===b[11]?(d[0]=2/(c*b[0]),d[1]=2/(a*b[5]),d[2]=(1+b[12])/b[0],d[3]=(1+b[13])/b[5],h.vec2.set(e,0,1)):(d[0]=-2/(c*b[0]),d[1]=-2/(a*b[5]),d[2]=(1-b[8])/b[0],d[3]=(1-b[9])/b[5],h.vec2.set(e,1,0))}})},"esri/views/3d/webgl-engine/shaders/SimpleAtmospherePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver",
"../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});a.colorPass={name:"simple-atmosphere-color",shaders:function(a){return{vertexShader:h.glslifyDefineMap({PANORAMIC:a.panoramic})+k.resolveIncludes("environment/simpleAtmosphere.vert"),fragmentShader:h.glslifyDefineMap({PANORAMIC:a.panoramic})+k.resolveIncludes("environment/simpleAtmosphere.frag")}},attributes:m.Default3D};a.fadePass={name:"simple-atmosphere-fade",shaders:{vertexShader:k.resolveIncludes("environment/simpleAtmosphereFade.vert"),
fragmentShader:k.resolveIncludes("environment/simpleAtmosphereFade.frag")},attributes:m.Default3D}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,aTangent:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,
modelOriginLo:15}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=new k(function(a){var d=m;a.split("/").forEach(function(a){d&&(d=d[a])});return d});a.resolveIncludes=function(a){return h.resolveIncludes(a)}})},"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require","exports"],function(n,
a){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\nuniform vec2 uViewportDimInv;\nbool isNaN(float val) {\n  return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n}\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n  float offsetXY \x3d uDepthBias.x;\n  float offsetZ  \x3d uDepthBias.y;\n  vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n}\nfloat calculateProjectedBiasZ(vec4 projPos) {\n  float offsetZ \x3d uDepthBias.y;\n  return sqrt(projPos.z) * offsetZ;\n}\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n  vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n  if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n    projPos.xy +\x3d offsetXY;\n  }\n  projPos.z +\x3d calculateProjectedBiasZ(projPos);\n  return projPos;\n}",
"edgeRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying vec4 vColor;\nvarying float vRadius;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\nvarying float vLineIndex;\n#define COVERAGE_TEST_THRESHOLD 0.01\n#include \x3cedgeRenderer/lineOffset.glsl\x3e\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n  float lineOffset \x3d calculateLineOffset();\n  float positionX \x3d position.x - lineOffset;\n  if (radius \x3c 1.0) {\n    float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n    float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n    float coverage \x3d min(coverageX, coverageY);\n    return vec2(0.5 - coverage, 0.0);\n  }\n  else {\n    float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n    vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n  }\n}\nvoid main() {\n  float radius \x3d vRadius * calculateLinePressure();\n  vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n  float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n#ifdef ANTIALIASING\n  const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\n#else\n  float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n#endif\n  if (coverage \x3c coverageLimit) {\n    discard;\n  }\n  discardBySlice(vWorldPosition);\n  float alpha \x3d vColor.a * coverage;\n  gl_FragColor \x3d vec4(vColor.rgb, alpha);\n}",
"edgeRenderer.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 uProj;\nuniform mat4 uView;\nuniform mat4 uModel;\nuniform vec3 uCameraPosition;\nuniform vec2 uPixelToNDC;\nuniform vec2 uNDCToPixel;\nuniform float uPixelRatio;\nattribute vec3 aPosition0;\nattribute vec3 aPosition1;\nattribute float aVariantOffset;\nattribute float aVariantStroke;\nattribute float aVariantExtension;\n#ifdef SILHOUETTE\nattribute vec3 aNormalA;\nattribute vec3 aNormalB;\n#else\nattribute vec3 aNormal;\n#endif\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\nstruct UnpackedAttributes {\nvec2 sideness;\nvec2 sidenessNorm;\nfloat lineWidthPixels;\nfloat extensionLengthPixels;\n#if (MODE \x3d\x3d MODE_UBER)\nfloat type;\n#endif\n};\nvarying vec4 vColor;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vRadius;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\n#include \x3cedgeRenderer/adjustProjectedPosition.glsl\x3e\n#include \x3cedgeRenderer/styleOutputs.glsl\x3e\n#include \x3cedgeRenderer/lineAmplitude.glsl\x3e\n#include \x3cedgeRenderer/util.glsl\x3e\nconst float opaqueCutoff \x3d 1.0 / 255.0;\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  vec2 sideness \x3d unpackedAttributes.sideness;\n  vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n  vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n  vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n  vec4 projPosV0 \x3d uProj * viewPosV0;\n  vec4 projPosV1 \x3d uProj * viewPosV1;\n  vec4 projPos \x3d uProj * viewPos;\n  vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n  vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n  float lineLengthPixels \x3d length(screenSpaceLinePixels);\n  float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n  vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n  float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n  float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n  float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n  float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n  vSizeFalloffFactor \x3d falloffFactor;\n  float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n  float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n#ifdef ANTIALIASING\n  const float aaPaddingPixels \x3d 1.0;\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n  float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n  float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n  float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\n#else\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n  float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n  float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\n#endif\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n  vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n  vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n  vec2 ndcOffset \x3d (\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n  );\n  projPos.xy +\x3d ndcOffset * projPos.w;\n  projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n  projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n  float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n  float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n  vPosition \x3d vec3(\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n    pixelPositionAlongLine,\n    pixelPositionAlongLine / extendedLineLengthPixels\n  );\n  vRadius \x3d lineWidthPixels * 0.5;\n  vLineLengthPixels \x3d extendedLineLengthPixels;\n#ifdef SILHOUETTE\n  gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10.0, 10.0, 10.0, 1.0);\n#else\n  gl_Position \x3d projPos;\n#endif\n  if (vColor.a \x3c opaqueCutoff) {\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n  }\n#if (MODE \x3d\x3d MODE_UBER)\n  if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n  }\n#elif (MODE \x3d\x3d MODE_SKETCH)\n  if (lineLengthPixels \x3c\x3d 3.0) {\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n  }\n#endif\n  return projPos;\n}\n#if (MODE \x3d\x3d MODE_UBER)\nUnpackedAttributes unpackAttributes(ComponentData component) {\n  vec2 sidenessNorm \x3d aSideness;\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n  float fType \x3d component.type;\n  float extensionLengthPixels \x3d component.extensionLength;\n  float lineWidth \x3d component.lineWidth;\n  if (fType \x3c\x3d 0.0) {\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\n  }\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n}\n#else\nUnpackedAttributes unpackAttributes(ComponentData component) {\n  vec2 sidenessNorm \x3d aSideness;\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n  float extensionLengthPixels \x3d component.extensionLength;\n#if (MODE \x3d\x3d MODE_SKETCH)\n  extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\n#endif\n  float lineWidth \x3d component.lineWidth;\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n}\n#endif\nvoid main() {\n  ComponentData component \x3d readComponentData();\n  UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n  vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\n  vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\n  vec4 viewPosV0 \x3d uView * worldPosV0;\n  vec4 viewPosV1 \x3d uView * worldPosV1;\n#ifdef SILHOUETTE\n  vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\n#else\n  vec3 worldNormal \x3d modelToWorldNormal(aNormal);\n#endif\n  vColor \x3d component.color;\n  vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n}",
"lineAmplitude.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\n  float calculateLineAmplitudeSolid() {\n    return 0.0;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SOLID)\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSolid();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\n  uniform float uStrokesAmplitude;\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SKETCH)\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER)\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type \x3d unpackedAttributes.type;\n    if (type \x3c\x3d 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeSolid();\n    }\n  }\n#endif",
"lineOffset.glsl":"#include \x3cutil/encoding.glsl\x3e\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n  varying vec2 vStrokeUV;\n  float calculateLineOffsetSketch() {\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SKETCH)\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\n  float calculateLineOffsetSolid() {\n    return 0.0;\n  }\n  float calculateLinePressureSolid() {\n    return 1.0;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SOLID)\n  float calculateLineOffset() {\n    return calculateLineOffsetSolid();\n  }\n  float calculateLinePressure() {\n    return calculateLinePressureSolid();\n  }\n#endif\n#if (MODE \x3d\x3d MODE_UBER)\n  varying float vType;\n  float calculateLineOffset() {\n    if (vType \x3c\x3d 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetSolid();\n    }\n  }\n  float calculateLinePressure() {\n    if (vType \x3c\x3d 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureSolid();\n    }\n  }\n#endif",
"styleOutputs.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x +\x3d aVariantOffset;\n    vLineIndex \x3d lineIndex;\n  }\n#endif\n#if (MODE \x3d\x3d MODE_SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif (MODE \x3d\x3d MODE_SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif (MODE \x3d\x3d MODE_UBER)\n  varying float vType;\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType \x3d unpackedAttributes.type;\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif",
"util.glsl":"uniform float uDistanceFalloffFactor;\nfloat distanceBasedPerspectiveFactor(float distance) {\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n}\nuniform sampler2D uComponentDataTex;\nuniform vec2 uComponentDataTexInvDim;\nattribute float aComponentIndex;\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n#define COMPONENT_FIELD_COUNT 2.0\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\n#define EXTENSION_LENGTH_OFFSET 128.0\n#define COMPONENT_TEX_WIDTH 4096.0\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n  float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n  float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n  float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n  vec2 linearIndex \x3d vec2(\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\n  );\n  return linearIndex;\n}\nstruct ComponentData {\n  vec4 color;\n  float lineWidth;\n  float extensionLength;\n  float type;\n};\nComponentData readComponentData() {\n  vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n  vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n  vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n  vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n  return ComponentData(\n    vec4(colorValue.rgb, colorValue.a * otherValue.w),\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n    -(otherValue.z * 255.0) + 0.5\n  );\n}\nvec3 modelToWorldNormal(vec3 normal) {\n  return (uModel * vec4(normal, 0.0)).xyz;\n}\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n  return modelToWorldNormal(normalize(normalA + normalB));\n}\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n}\n#ifdef SILHOUETTE\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n  vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\n  vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\n  vec3 viewDir \x3d -viewPos.xyz;\n  float faceAVisible \x3d dot(viewDir, viewNormalA);\n  float faceBVisible \x3d dot(viewDir, viewNormalB);\n  return faceAVisible * faceBVisible \x3c 0.0;\n}\n#endif"},
environment:{"realisticAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/color.glsl\x3e\nuniform vec3 lightingMainDirection;\nuniform vec3 invWavelength;\nuniform vec3 invWavelengthScaled;\nconst float krESun \x3d 0.075;\nconst float kmESun \x3d 0.015;\nuniform vec2 radii;\n#define innerRadius radii[0]\n#define outerRadius radii[1]\nuniform vec4 atmosParams1;\nuniform vec4 atmosParams2;\n#define shellScale atmosParams1.x\n#define shellDepth vec2(atmosParams1.y, atmosParams2.y)\n#define scaleOverScaleDepth vec2(atmosParams1.z, atmosParams2.z)\n#define oneOverScaleDepth vec2(atmosParams1.w, atmosParams2.w)\n#ifndef HAZE\nuniform vec3 atmosParams3;\nuniform float innerFadeDistance;\nuniform float altitudeFade;\n#define g atmosParams2.x\n#define gSq atmosParams3.x\n#define miePhaseCoefficients atmosParams3.y\n#define lowerAlphaBlendBound atmosParams3.z\n#endif\nuniform vec3 cameraPosition;\nuniform vec2 nearFar;\nuniform vec4 sphereComp;\n#define cameraHeight sphereComp[0]\n#define cameraHeightSq sphereComp[1]\n#define C sphereComp[2]\n#define CSur sphereComp[3]\n#ifdef HAZE\nconst float exposure \x3d 1.5;\n#else\nconst float exposure \x3d 2.0;\n#endif\n#ifdef HAZE\nuniform sampler2D depthTex;\n#endif\nvarying vec3 eyeDir;\nvarying vec3 worldRay;\nvarying vec2 vtc;\nconst float samples \x3d 5.0;\nconst int maxSamples \x3d 5;\n#ifdef HAZE\n  const vec3 oneOverGamma \x3d vec3(1.0);\n#else\n  const vec3 oneOverGamma \x3d vec3(0.454545);\n#endif\nvec3 expTM(vec3 inputColor,float _exposure) {\n    return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n}\n#ifndef HAZE\nvec3 reinhardTM(vec3 inputColor, float _exposure) {\n  vec3 intermediate \x3d inputColor * _exposure;\n  intermediate /\x3d ( 1.0 + intermediate );\n  return pow(intermediate, oneOverGamma);\n}\n#endif\nfloat scale(float _cos) {\n  float x \x3d 1.0 - _cos;\n  return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n}\nvoid main() {\n  vec3 worldSpaceRay \x3d normalize(worldRay);\n  float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay);\n  float det \x3d B * B - 4.0 * C;\n  float detSur \x3d B * B - 4.0 * CSur;\n  float minRayStart \x3d 0.0;\n#ifndef HAZE\n  float surfaceBlend \x3d 0.0;\n  vec4 surfaceColor \x3d vec4(0.0);\n  if (detSur \x3e\x3d 0.0) {\n    float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n    float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n    if (nearSurface \x3d\x3d 0.0) {\n      minRayStart \x3d farSurface;\n    }\n    vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n    float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n    float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n    surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n    float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n    if (relDist \x3e 1.0) {\n      gl_FragColor \x3d surfaceColor;\n      return;\n    }\n    surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n  }\n#endif\n  if (det \x3e\x3d 0.0) {\n#ifdef HAZE\n    float depthSample \x3d texture2D(depthTex, vtc).r;\n    float zNear \x3d nearFar[0];\n    float zFar \x3d nearFar[1];\n    float zNorm \x3d 2.0 * depthSample - 1.0;\n    float linDepth \x3d 2.0 * zNear * zFar /\n      (zFar + zNear - zNorm * (zFar - zNear));\n    float rayEnd;\n    float altitudeAlpha \x3d 1.0;\n    if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n      vec3 cameraSpaceRay \x3d normalize(eyeDir);\n      cameraSpaceRay /\x3d cameraSpaceRay.z;\n      cameraSpaceRay *\x3d linDepth;\n      float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n      vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n      float worldRadiusSq \x3d dot(world, world);\n      float transitionStart \x3d innerRadius + 20000.0;\n      float transitionHeight \x3d 25000.0;\n      float transitionEnd \x3d transitionStart + transitionHeight;\n      float edge0 \x3d transitionStart * transitionStart;\n      float edge1 \x3d transitionEnd * transitionEnd;\n      altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n      rayEnd \x3d cameraSpaceRayLength;\n      if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n        float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n        float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n        rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n      }\n    }\n#endif\n    float rayStart \x3d 0.5 *(-B - sqrt(det));\n#ifdef HAZE\n    float near \x3d abs(rayStart);\n    float far \x3d abs(rayEnd);\n#else\n    float rayEnd \x3d 0.5 *(-B + sqrt(det));\n#endif\n    float scatterDistance;\n    if (rayStart \x3c minRayStart)\n    {\n      rayStart \x3d minRayStart;\n#ifndef HAZE\n      scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);\n#endif\n    }\n#ifndef HAZE\n    else\n    {\n      scatterDistance \x3d -1.0;\n    }\n#endif\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n#ifdef HAZE\n    vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n    float endLength \x3d length(end);\n    float altitudeEnd \x3d endLength - innerRadius;\n    float altitudeStart \x3d length(start) - innerRadius;\n    if (altitudeStart \x3c 0.0) {\n      altitudeStart \x3d -altitudeStart;\n      altitudeEnd \x3d -altitudeEnd;\n    }\n    float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n    if (near \x3e far)\n    {\n      if (altitudeStart \x3c altitudeEnd)\n      {\n        end \x3d cameraPosition + worldSpaceRay * rayStart;\n        start \x3d cameraPosition + worldSpaceRay * rayEnd;\n        worldSpaceRay *\x3d -1.0;\n        float tmp \x3d altitudeStart;\n        altitudeStart \x3d altitudeEnd;\n        altitudeEnd \x3d tmp;\n      }\n      else if (altitudeStart \x3d\x3d altitudeEnd)\n      {\n        altitudeStart +\x3d 1.0;\n      }\n    }\n    if (altitudeStart \x3e outerRadius - innerRadius)\n    {\n      scatterDistance \x3d innerRadius - outerRadius;\n    } else\n    {\n      scatterDistance \x3d altitudeEnd - altitudeStart;\n    }\n#endif\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n#ifdef HAZE\n    float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n    float scaleCameraAngle \x3d scale(cameraAngle);\n    vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n    float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n    vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n#else\n    float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n    float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n    float scaleCameraAngle \x3d scale(cameraAngle);\n    vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n#endif\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n#ifdef HAZE\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n#else\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n#endif\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n      samplePoint +\x3d sampleRay;\n    }\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n#ifdef HAZE\n    vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n    vec3 color \x3d colorCoefficients * frontColor;\n    vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n#else\n    vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n    float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n    vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n    vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n#endif\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n#ifdef HAZE\n    LDR *\x3d (1.0 - cameraAngle);\n    vec3 hsv \x3d rgb2hsv(LDR);\n    hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0);\n    LDR \x3d hsv2rgb(hsv);\n    vec3 finalColor \x3d LDR;\n#else\n    vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n    LDR +\x3d angleMultiplier * ldrReinhard;\n    float side \x3d (rayEnd + rayStart) * 0.5;\n    float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n    float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n    vec3 finalColor \x3d LDR * h2;\n    vec3 hsv \x3d rgb2hsv(finalColor);\n    hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0);\n    finalColor \x3d hsv2rgb(hsv);\n#endif\n#ifndef HAZE\n    float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n    gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n    if (surfaceBlend \x3e 0.0) {\n      gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n    }\n#else\n    gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\n#endif\n  } else {\n    gl_FragColor \x3d vec4(0.0);\n  }\n}",
"realisticAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform vec2 halfSizeNearPlane;\nuniform vec3 cameraUp;\nuniform vec3 cameraRight;\nuniform vec3 cameraDir;\nuniform vec2 cameraCenterOffset;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 worldRay;\nvarying vec2 vtc;\n#ifdef HAZE\nvarying vec3 eyeDir;\n#endif\nvoid main(void) {\n  vec3 v3Pos \x3d position;\n  vtc \x3d uv0;\n  vec2 rayvtc \x3d uv0 - cameraCenterOffset;\n#ifdef HAZE\n  eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);\n#else\n  vec3 eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);\n#endif\n  worldRay \x3d eyeDir.z * cameraDir + eyeDir.y * cameraUp + eyeDir.x * cameraRight;\n  gl_Position \x3d vec4(v3Pos, 1.0);\n}",
"simpleAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvarying float falloff;\n#ifndef PANORAMIC\nuniform float altitudeFade;\nvarying float innerFactor;\n#endif\nvoid main() {\n  vec4 texColor \x3d texture2D(tex, vtc);\n#ifdef PANORAMIC\n  gl_FragColor \x3d texColor * falloff;\n#else\n  vec4 atmosphereColor \x3d texColor * falloff;\n  vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n  gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n#endif\n}",
"simpleAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\n#ifndef PANORAMIC\nconst float TWICEPI \x3d 2.0*3.14159265;\nconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\nuniform vec3 silCircleCenter;\nuniform vec3 silCircleV1;\nuniform vec3 silCircleV2;\nuniform vec2 texV;\nuniform float innerScale;\nvarying float innerFactor;\n#endif\nuniform vec3 lightingMainDirection;\nattribute vec3 position;\nvarying vec2 vtc;\nvarying float falloff;\nvoid main(void) {\n  vec3 lightDirection \x3d -lightingMainDirection;\n#ifdef PANORAMIC\n  vec3 pos \x3d position;\n  float ndotl \x3d lightDirection.z;\n  vtc \x3d vec2(0.0, position.z+0.05);\n#else\n  innerFactor \x3d clamp(-position.z, 0.0, 1.0);\n  float scale \x3d position.y * (1.0 + innerFactor * innerScale);\n  float phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n  vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n  float ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n  vtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n  vtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n#endif\n  falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n  gl_Position \x3d transformPosition(proj, view, pos);\n  gl_Position.z \x3d gl_Position.w;\n}",
"simpleAtmosphereFade.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec4 color;\nvoid main() {\n  gl_FragColor \x3d color;\n}","simpleAtmosphereFade.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nuniform vec3 lightingMainDirection;\nuniform vec3 cameraPosition;\nuniform float undergroundFadeAlpha;\nvarying vec4 color;\nvoid main(void) {\n  float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n  float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n  color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n  gl_Position \x3d vec4(position.xy, 1.0, 1.0);\n}",
"stars.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec4 vcolor;\nvarying float vsize;\nvoid main() {\n  float cap \x3d 0.7;\n  float scale \x3d 1.0/cap;\n  float helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\n  float alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\n  float intensity \x3d alpha*alpha*alpha;\n  if (vsize \x3c 3.0)\n    intensity *\x3d 0.5;\n  gl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\n  gl_FragColor.xyz *\x3d vcolor.xyz;\n}","stars.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec4 viewport;\nuniform float pixelRatio;\nattribute vec3 position;\nattribute vec4 color;\nattribute float size;\nvarying vec4 vcolor;\nvarying float vsize;\nvoid main(void) {\n  vec4 posProj \x3d proj * view * model*vec4(position*1.0e25,1.0);\n  gl_Position \x3d alignToPixelCenter(posProj, viewport.zw);\n  gl_Position.z \x3d gl_Position.w;\n  vcolor \x3d color / 1.2;\n  vsize \x3d size * 5.0 * pixelRatio;\n  gl_PointSize \x3d vsize;\n}"},
materials:{checkerBoard:{"checkerBoard.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\nvarying vec2 vUV;\nvoid main() {\n  vec2 uvScaled \x3d vUV / (2.0 * size);\n  vec2 uv \x3d fract(uvScaled - 0.25);\n  vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n  float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n  float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\n  gl_FragColor \x3d mix(color2, color1, t);\n}",
"checkerBoard.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec2 vUV;\nvoid main(void) {\n  vUV \x3d uv0;\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}"},color:{"color.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec4 eColor;\n#ifdef VERTEX_COLORS\nvarying vec4 vColor;\n#endif\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n#ifdef VERTEX_COLORS\n  gl_FragColor \x3d vColor * eColor;\n#else\n  gl_FragColor \x3d eColor;\n#endif\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"color.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\n#ifdef VERTEX_COLORS\nattribute vec4 color;\nvarying vec4 vColor;\n#endif\nvarying vec3 vpos;\nvoid main(void) {\n#ifdef VERTEX_COLORS\n  vColor \x3d color * 0.003921568627451;\n#endif\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}"},defaultMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha \x3d 0.0;\n  const float maxTint \x3d 85.0;\n  const float maxReplace \x3d 170.0;\n  const float scaleAlpha \x3d 3.0;\n  if (symbolColor.a \x3e maxReplace) {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n  } else if (symbolColor.a \x3e maxTint) {\n    colorMixMode \x3d 3;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n  } else if (symbolColor.a \x3e 0.0) {\n    colorMixMode \x3d 0;\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\n  } else {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d 0.0;\n  }\n  return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n}\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n  vec3 internalMixed \x3d internalColor * textureColor;\n  vec3 allMixed \x3d internalMixed * externalColor;\n  if (mode \x3d\x3d 1 ) {\n    return allMixed;\n  }\n  else if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalColor;\n  }\n  else {\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n  float internalMixed \x3d internalOpacity * textureOpacity;\n  float allMixed \x3d internalMixed * externalOpacity;\n  if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalOpacity;\n  }\n  else {\n    return allMixed;\n  }\n}",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/sceneLighting.glsl\x3e\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#define FRAGMENT_SHADER\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\n#include \x3cmaterials/defaultMaterial/textureNormals.glsl\x3e\nuniform vec3 camPos;\nuniform vec3 localOrigin;\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode;\n#else\nuniform int colorMixMode;\n#endif\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\nvarying vec3 vpos;\nvarying vec3 localvpos;\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\nvarying vec4 vcolorExt;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include \x3cutil/shadow.glsl\x3e\n#endif\n#ifdef TREE_RENDERING\n  uniform mat4 view;\n#endif\n#ifdef USE_PBR\n    uniform float roughnessFactor;\n    uniform float metalnessFactor;\n    uniform vec3 emissionFactor;\n    uniform float reflectanceFactor;\n  #ifdef PBR_TEX_METALLNESS_ROUGHNESS\n    uniform sampler2D texMetallicRoughness;\n  #endif\n  #ifdef PBR_TEX_EMISSION\n    uniform sampler2D texEmission;\n  #endif\n  #ifdef PBR_TEX_OCCLUSION\n    uniform sampler2D texOcclusion;\n  #endif\n#endif\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\nvoid main() {\n  discardBySlice(vpos);\n#if defined(TEXTURE_COLOR)\n  vec4 texColor \x3d textureLookup(tex, vtc);\n  #if defined(TEXTURE_ALPHA_PREMULTIPLIED)\n    texColor.rgb /\x3d texColor.a;\n  #endif\n  discardOrAdjustTextureAlpha(texColor);\n#else\n  vec4 texColor \x3d vec4(1.0);\n#endif\n  vec3 viewDir \x3d vpos - camPos;\n#ifdef GROUND_NORMAL_SHADING\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    vec3 normal \x3d normalize(vpos + localOrigin);\n  #else\n    vec3 normal \x3d vec3(0.0, 0.0, 1.0);\n  #endif\n#else\n  #if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\n    vec3 normal \x3d normalize(cross(dFdx(localvpos),dFdy(localvpos)));\n  #else\n    #ifdef DOUBLESIDED\n      vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\n    #elif defined(WINDINGORDERDOUBLESIDED)\n      vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\n    #else\n      vec3 normal \x3d vnormal;\n    #endif\n    normal \x3d normalize(normal);\n  #endif\n#endif\n#ifdef USE_PBR\n    float reflectance \x3d reflectanceFactor;\n    float roughness \x3d roughnessFactor;\n    float metalness \x3d metalnessFactor;\n  #ifdef PBR_TEX_METALLNESS_ROUGHNESS\n    vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, vtc).rgb;\n    roughness *\x3d metallicRoughness.g ;\n    metalness *\x3d metallicRoughness.b ;\n  #endif\n    vec3 emission \x3d emissionFactor;\n  #ifdef PBR_TEX_EMISSION\n    emission *\x3d textureLookup(texEmission, vtc).rgb;\n  #endif\n    float bakedOcclusion \x3d 1.0;\n  #ifdef PBR_TEX_OCCLUSION\n    bakedOcclusion *\x3d textureLookup(texOcclusion, vtc).r;\n  #endif\n#endif\n#ifdef RECEIVE_SSAO\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n#else\n  float ssao \x3d 1.0;\n#endif\n#ifdef USE_PBR\n  ssao *\x3d bakedOcclusion;\n#endif\n  float additionalAmbientScale;\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n  float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n  vec3 matColor \x3d max(ambient, diffuse);\n#if defined(VERTEXCOLORS)\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#else\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#endif\n#if defined(USE_PBR)\n  if (int(colorMixMode) \x3d\x3d 3 ) {\n    reflectance \x3d 0.2;\n    roughness \x3d 0.6;\n    metalness \x3d 0.0;\n  }\n#endif\n  #if defined(TEXTURE_NORMALS)\n    #ifdef VERTEX_TANGENTS\n      mat3 tangentSpace \x3d computeTangentSpace(normal);\n    #else\n      mat3 tangentSpace \x3d computeTangentSpace(normal, vpos, vtc);\n    #endif\n    vec3 shadingNormal \x3d computeTextureNormal(tangentSpace);\n  #else\n    vec3 shadingNormal \x3d normal;\n  #endif\n  #ifdef TREE_RENDERING\n    shadingNormal \x3d normalize(vnormal);\n    albedo_ *\x3d 1.2;\n    vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n    float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n    float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadingNormal), 0.0, 1.0);\n    float treeRadialFalloff \x3d vcolor.r;\n    float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n    additionalLight +\x3d backLightFactor * lightingMainIntensity;\n  #endif\n  #ifdef USE_PBR\n    float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n    vec3 normalGround \x3d normalize(vpos + localOrigin);\n    vec3 shadedColor \x3d evaluateSceneLightingPBR(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDir, normalGround, roughness, metalness, emission, reflectance, additionalAmbientIrradiance);\n  #else\n    vec3 shadedColor \x3d evaluateSceneLighting(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  #endif\n  gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cutil/offset.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\n#define VERTEX_SHADER\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\n#ifdef INSTANCEDCOLOR\nattribute vec4 instanceColor;\n#endif\nattribute vec3 position;\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n  #define HAS_NORMALS 1\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n  #define HAS_NORMALS 1\n#else\n  #define HAS_NORMALS 0\n#endif\nvarying vec3 vpos;\nvarying vec3 localvpos;\n#ifdef TEXTURE_COORDINATES\n    attribute vec2 uv0;\n    varying vec2 vtc;\n  #ifdef TEXTURE_ATLAS\n    attribute vec4 region;\n    varying vec4 regionV;\n  #endif\n#endif\n#ifdef COMPONENTCOLORS\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\n#endif\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\n#ifdef SYMBOLVERTEXCOLORS\nattribute vec4 symbolColor;\n#endif\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\nuniform vec4 externalColor;\nvarying vec4 vcolorExt;\n#ifdef VERTEX_TRANSPARENCY_DISCARD_ENABLED\nuniform float discardTransparentVertices;\n#endif\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode;\n#endif\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_SIZE) || defined(VV_COLOR)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/constants.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\nvoid main() {\n#ifdef VERTEXCOLORS\n  vcolor \x3d color * 0.003921568627451;\n#endif\n  vcolorExt \x3d externalColor;\n#ifdef INSTANCEDCOLOR\n  vcolorExt *\x3d instanceColor;\n#endif\n#ifdef VV_COLOR\n  vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n#ifdef SYMBOLVERTEXCOLORS\n  int symbolColorMixMode;\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n#endif\n#ifdef COMPONENTCOLORS\n  int symbolColorMixMode;\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451;\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n#endif\n#ifdef VERTEX_TRANSPARENCY_DISCARD_ENABLED\n  float opaqueCutoff \x3d 1.0 - 1.0 / 255.0;\n  if (discardTransparentVertices \x3e 0.5 ? vcolorExt.a \x3c\x3d opaqueCutoff : vcolorExt.a \x3e opaqueCutoff) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#endif\n  if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n  }\n  else {\n    vpos \x3d calculateVPos();\n    localvpos \x3d vpos - view[3].xyz;\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if HAS_NORMALS\n    vnormal \x3d normalize(modelNormal * localNormal().xyz);\n  #endif\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#else\n  #if HAS_NORMALS\n    vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n  #endif\n#endif\n    #ifdef VERTICAL_OFFSET\n      vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n    #endif\n    #if defined(VERTEX_TANGENTS)\n      transformVertexTangent(mat3(modelNormal));\n    #endif\n    gl_Position \x3d transformPosition(proj, view, vpos);\n    #if HAS_NORMALS \x26\x26 defined(OFFSET_BACKFACES)\n      gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vnormal, camPos);\n    #endif\n  }\n#ifdef RECEIVE_SHADOWS\n  linearDepth \x3d gl_Position.w;\n#endif\n#ifdef TEXTURE_COORDINATES\n  #ifndef FLIPV\n    vtc \x3d uv0;\n  #else\n    vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n  #endif\n  #ifdef TEXTURE_ATLAS\n    regionV \x3d region;\n  #endif\n#endif\n}",
"commonFunctions.glsl":"#include \x3cmaterials/defaultMaterial/localPosition.glsl\x3e\n#include \x3cutil/doublePrecision.glsl\x3e\nvec3 calculateVPos() {\n#ifdef INSTANCED_DOUBLE_PRECISION\n  return model * localPosition().xyz;\n#else\n  return (model * localPosition()).xyz;\n#endif\n}\n#ifdef VERTICAL_OFFSET\n#ifdef SCREEN_SIZE_PERSPECTIVE\n#include \x3cutil/screenSizePerspective.glsl\x3e\n#endif\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n  float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec3 worldNormal \x3d normalize(worldPos + localOrigin);\n#else\n  vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n  float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n  return worldNormal * worldOffset;\n}\n#endif",
"commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\n#ifdef INSTANCED_DOUBLE_PRECISION\nuniform vec3 viewOriginHi;\nuniform vec3 viewOriginLo;\n#endif\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n#ifdef INSTANCED\n#ifdef INSTANCED_DOUBLE_PRECISION\nattribute vec3 modelOriginHi;\nattribute vec3 modelOriginLo;\nattribute mat3 model;\nattribute mat3 modelNormal;\n#else\nattribute mat4 model;\nattribute mat4 modelNormal;\n#endif\n#else\nuniform mat4 model;\nuniform mat4 modelNormal;\n#endif\n#ifdef VERTICAL_OFFSET\nuniform vec4 verticalOffset;\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspectiveAlignment;\n#endif\n#endif",
"componentColors.glsl":"uniform sampler2D uComponentColorTex;\nuniform vec2 uComponentColorTexInvDim;\nattribute float componentIndex;\nvec4 readComponentColor() {\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord \x3d vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  vec4 componentColor \x3d texture2D(uComponentColorTex, indexCoord);\n  return vec4( componentColor.r, componentColor.g, componentColor.b - mod(componentColor.b*255.0, 2.0)/255.0, componentColor.a);\n}\nbool readComponentCastShadowsFlag(){\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord \x3d vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  if( mod(texture2D(uComponentColorTex, indexCoord).b*255.0, 2.0) \x3c 1.0 )\n      return false;\n  return true;\n}",
"constants.glsl":"#define SYMBOL_ALPHA_CUTOFF 0.001","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying float depth;\nvarying vec3 vpos;\n#if defined(TEXTURE_COLOR)\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#endif\nvoid main() {\n  discardBySlice(vpos);\n  #if defined(TEXTURE_COLOR)\n    vec4 texColor \x3d textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n  #ifndef BIAS_SHADOWMAP\n    gl_FragColor \x3d float2rgba(depth);\n  #else\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n  #endif\n}",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\nuniform vec2 nearFar;\nattribute vec3 position;\nvarying float depth;\nvarying vec3 vpos;\n#ifdef TEXTURE_COLOR\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\n#if defined(COMPONENTCOLORS)\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\n#endif\nvoid main(void) {\n  vpos \x3d calculateVPos();\n#if defined(COMPONENTCOLORS)\n  if( !readComponentCastShadowsFlag() ){\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n  }else\n  {\n#endif\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#endif\n  #ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n  #endif\n  gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n#if defined(COMPONENTCOLORS)\n  }\n#endif\n#ifdef TEXTURE_COLOR\n#ifndef FLIPV\n  vtc \x3d uv0;\n#else\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV \x3d region;\n#endif\n#endif\n}",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nvarying vec3 vpos;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n#if defined(TEXTURE_COLOR)\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#endif\nvoid main() {\n  discardBySlice(vpos);\n  #if defined(TEXTURE_COLOR)\n    vec4 texColor \x3d textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\nattribute vec3 position;\nvarying vec3 vpos;\n#if defined(TEXTURE_COLOR)\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#endif\n  #ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n  #endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#if defined(TEXTURE_COLOR)\n#ifndef FLIPV\n  vtc \x3d uv0;\n#else\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV \x3d region;\n#endif\n#endif\n}",
"localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vvTransformPosition(vec3(0.0), instanceFeatureAttribute); }\n# endif\n#else\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vec4(vec3(0.0), 1.0); }\n# endif\n#endif","localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n    vec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\n  # endif\n#else\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n    vec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vec4 localNormal() { return vec4(normal, 1.0); }\n  # endif\n#endif",
"localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\n#else\nvec4 localPosition() { return vec4(position, 1.0); }\n#endif","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\nvarying vec3 vpos;\nvarying vec3 vPositionView;\n#if defined(TEXTURE_COLOR)\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\n#endif\nvoid main() {\n  discardBySlice(vpos);\n  #if defined(TEXTURE_COLOR)\n    vec4 texColor \x3d textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n#if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\n  vec3 normal \x3d normalize(cross(dFdx(vPositionView),dFdy(vPositionView)));\n#else\n  vec3 normal \x3d normalize(vnormal);\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#endif\n  #ifndef ALPHA_ZERO\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n  #else\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n  #endif\n}",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\nuniform mat4 viewNormal;\nattribute vec3 position;\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n#endif\n#if defined(TEXTURE_COLOR)\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\nvarying vec3 vpos;\nvarying vec3 vPositionView;\n#include \x3cutil/visualVariables.glsl\x3e\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\n  #endif\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  vpos -\x3d originDelta;\n#else\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\n    vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n  #endif\n#endif\n  #ifdef VERTICAL_OFFSET\n    vpos +\x3d calculateVerticalOffset(vpos, localOrigin);\n  #endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#if defined(TEXTURE_COLOR)\n#ifndef FLIPV\n  vtc \x3d uv0;\n#else\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV \x3d region;\n#endif\n#endif\n}",
"textureNormals.glsl":"#if defined(TEXTURE_NORMALS)\n  uniform sampler2D texNormal;\n  vec3 computeTextureNormal(mat3 tangentSpace) {\n    vec3 rawNormal \x3d textureLookup(texNormal, vtc).rgb * 2.0 - 1.0;\n    return tangentSpace * rawNormal;\n  }\n#endif","texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\n}\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\n  vec2 atlasScale \x3d region.zw - region.xy;\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\n  vec4 texColor;\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\n#ifdef GL_EXT_shader_texture_lod\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\n#else\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}\nvec4 textureLookup(sampler2D tex, vec2 uv) {\n#if defined(TEXTURE_ATLAS)\n  return textureAtlasLookup(tex, uv, regionV, atlasSize);\n#else\n  return texture2D(tex, uv);\n#endif\n}\nvoid discardOrAdjustTextureAlpha(inout vec4 texColor) {\n  #if defined(TEXTURE_COLOR)\n  #if defined(TEXTURE_ALPHA_MODE_MASK)\n    if (texColor.a \x3c textureAlphaCutoff) {\n      discard;\n    } else {\n      texColor.a \x3d 1.0;\n    }\n  #elif defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\n    if (texColor.a \x3c textureAlphaCutoff) {\n      discard;\n    }\n  #elif defined(TEXTURE_ALPHA_MODE_OPAQUE)\n    texColor.a \x3d 1.0;\n  #else\n  #endif\n  #endif\n}",
"texturingInputs.glsl":"#ifdef TEXTURE_COLOR\n  uniform sampler2D tex;\n  #if defined(TEXTURE_ALPHA_MODE_MASK) || defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\n    uniform float textureAlphaCutoff;\n  #endif\n#endif\n#if defined(TEXTURE_COORDINATES)\n  varying vec2 vtc;\n  #ifdef TEXTURE_ATLAS\n    varying vec4 regionV;\n    uniform vec2 atlasSize;\n  #endif\n#endif","vertexTangents.glsl":"#if defined(VERTEX_SHADER)\n  #if defined(VERTEX_TANGENTS)\n    attribute vec4 aTangent;\n    varying vec4 vTangent;\n    void transformVertexTangent(mat3 modelTransformForNormals) {\n      vTangent.xyz \x3d modelTransformForNormals * aTangent.xyz;\n      vTangent.w \x3d aTangent.w;\n    }\n  #endif\n#elif defined(FRAGMENT_SHADER)\n  #if defined(VERTEX_TANGENTS)\n    varying vec4 vTangent;\n    #if defined(WINDINGORDERDOUBLESIDED)\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #else\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #endif\n  #else\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1;\n      T \x3d T - normal * dot(normal, T);\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10));\n      vec3 B \x3d sign(det) * cross(normal, T);\n      return mat3(T, B, normal);\n    }\n  #endif\n#endif"},
hud:{"colorPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\nvoid main() {\n#include \x3cmaterials/hud/hudMain.glsl\x3e\n}","highlightPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvoid main() {\n#include \x3cmaterials/hud/hudMain.glsl\x3e\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  if (voccluded \x3d\x3d 1.0) {\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n  } else {\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n  }\n#else\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n#endif\n}",
"hud.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\n#include \x3cutil/hud.glsl\x3e\n#include \x3cutil/visualVariables.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec2 screenOffset;\nuniform vec2 anchorPos;\nuniform vec2 textureCoordinateScaleFactor;\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\n#endif\n#ifdef DEBUG_DRAW_BORDER\nvarying vec4 debugBorderCoords;\n#endif\nattribute vec2 uv0;\nattribute vec4 color;\nattribute vec2 size;\nattribute vec4 auxpos2;\nvarying vec4 vcolor;\nvarying vec2 vtc;\nvarying vec2 vsize;\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\nvoid main(void) {\n  ProjectHUDAux projectAux;\n  vec4 posProj \x3d projectPositionHUD(projectAux);\n  if (rejectBySlice(projectAux.posModel)) {\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    return;\n  }\n  vec2 inputSize;\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n  vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n#else\n  inputSize \x3d size;\n  vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n#ifdef VV_SIZE\n  inputSize *\x3d vvGetScale(auxpos2).xx;\n#endif\n  vec2 combinedSize \x3d inputSize * pixelRatio;\n  vec4 quadOffset \x3d vec4(0.0);\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n  bool visible \x3d testVisibilityHUD(posProj);\n#endif\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvoccluded \x3d visible ? 0.0 : 1.0;\n#endif\n#ifdef OCCL_TEST\n  if (visible) {\n#endif\n    vec2 uv01 \x3d floor(uv0);\n    vec2 uv \x3d uv0 - uv01;\n    quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n#ifdef SIGNED_DISTANCE_FIELD\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n    posProj +\x3d quadOffset;\n    if (inputSize.x \x3d\x3d size.x) {\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n    }\n#endif\n    gl_Position \x3d posProj;\n    vtc \x3d uv * textureCoordinateScaleFactor;\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);\n#endif\n    vsize \x3d inputSize;\n#ifdef OCCL_TEST\n  } else {\n    vtc \x3d vec2(.0);\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);\n#endif\n  }\n#endif\n  gl_Position \x3d posProj;\n#ifdef VV_COLOR\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\n#else\n  vcolor \x3d color / 255.0;\n#endif\n}",
"hudHeader.glsl":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/color.glsl\x3e\nuniform sampler2D tex;\nuniform vec4 overrideColor;\nuniform vec4 outlineColor;\nuniform float outlineSize;\nvarying vec4 vcolor;\nvarying vec2 vtc;\nvarying vec2 vsize;\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n#ifdef DEBUG_DRAW_BORDER\nvarying vec4 debugBorderCoords;\n#endif","hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\n  vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 fillPixelColor \x3d overrideColor * vcolor;\n  const float txSize \x3d 128.0;\n  const float texelSize \x3d 1.0 / txSize;\n  vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n  vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n  float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n  float dist \x3d d * vsize.x;\n  fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  if (outlineSize \x3e 0.25) {\n    vec4 outlinePixelColor \x3d outlineColor;\n    float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n    outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n    float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n    vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n  }\n  else {\n    gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n  }\n#else\n  gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\n#endif\n#ifdef DEBUG_DRAW_BORDER\n   float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));\n   gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);\n#endif\n  if (gl_FragColor.a \x3c 0.1) {\n    discard;\n  }",
"occlusionTest.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 color;\nvoid main() {\n  gl_FragColor \x3d color;\n}","occlusionTest.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\n#include \x3cutil/hud.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvoid main(void) {\n  vec4 posProjCenter;\n  if (dot(position, position) \x3e 0.0) {\n    ProjectHUDAux projectAux;\n    vec4 posProj \x3d projectPositionHUD(projectAux);\n    posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n    vec3 vpos \x3d projectAux.posModel;\n    if (rejectBySlice(vpos)) {\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n  }\n  else {\n    posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n  }\n  gl_Position \x3d posProjCenter;\n  gl_PointSize \x3d 1.0;\n}"},
lineCallout:{"lineCallout.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 color;\nuniform vec4 borderColor;\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\nvoid main() {\n  vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n  float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n  float colorAlpha \x3d color.a * coverage.x;\n  float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n#ifdef DEPTH_HUD\n  if (finalAlpha \x3c 0.01) {\n    discard;\n  }\n#else\n  vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n  gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n#endif\n}",
"lineCallout.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/alignPixel.glsl\x3e\n#include \x3cutil/hud.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nattribute vec2 uv0;\nuniform float lineSize;\nuniform vec2 pixelToNDC;\nuniform float borderSize;\nuniform vec2 screenOffset;\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\nvoid main(void) {\n  ProjectHUDAux projectAux;\n  vec4 endPoint \x3d projectPositionHUD(projectAux);\n  vec3 vpos \x3d projectAux.posModel;\n  if (rejectBySlice(vpos)) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#ifdef OCCL_TEST\n  if (!testVisibilityHUD(endPoint)) {\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n  vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n  vec2 screenOffsetScaled \x3d screenOffset;\n#endif\n  vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n  vec4 startPoint \x3d proj * vec4(posView, 1.0);\n  vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n  startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n  endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n  vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n  vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n#ifdef DEPTH_HUD\n#ifdef DEPTH_HUD_ALIGN_START\n  endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n  startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n#endif\n  vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n  vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n  float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n#else\n  float lineSizeScaled \x3d lineSize;\n  float borderSizeScaled \x3d borderSize;\n#endif\n  float halfPixelSize \x3d lineSizeScaled * 0.5;\n  float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n  float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n  float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n  float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n  float padding \x3d 1.0 + borderSizeScaled;\n  vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n  projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n  float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n  float halfBorderSize \x3d 0.5 * borderSizeScaled;\n  float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n  float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n  float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n  coverageSampling \x3d vec4(\n    outerEdgeCoverageSampler,\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n    halfPixelSize - 0.5,\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n  );\n  lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n  gl_Position \x3d projectedPosition;\n}"},
measurementArrow:{"measurementArrow.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform float outlineSize;\nuniform vec4 outlineColor;\nuniform float stripeLength;\nuniform vec4 stripeEvenColor;\nuniform vec4 stripeOddColor;\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n#define INV_SQRT2 (1.0 / sqrt(2.0))\nvec4 arrowColor(vec2 tc, float len) {\n  float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\n  d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n  d \x3d min(d, 1.0 - abs(tc.y));\n  if (d \x3c 0.0) {\n    return vec4(0.0);\n  } else if (d \x3c outlineSize) {\n    return outlineColor;\n  } else {\n    return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\n  }\n}\nvoid main(void) {\n  vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\n  vec4 color \x3d arrowColor(ntc, vlength / vradius);\n  if (color.a \x3d\x3d 0.0) {\n    discard;\n  }\n  gl_FragColor \x3d color;\n}",
"measurementArrow.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform float width;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv0;\nattribute float auxpos1;\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\nvoid main(void) {\n  vec3 bitangent \x3d normal;\n  vtc \x3d uv0;\n  vlength \x3d auxpos1;\n  vradius \x3d 0.5 * width;\n  vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\n  gl_Position \x3d proj * pos;\n}"},
nativeLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec4 constantColor;\nvarying vec3 vpos;\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\nvoid main() {\n  discardBySlice(vpos);\n#ifdef VERTEXCOLORS\n  gl_FragColor \x3d highlightSlice(vcolor, vpos);\n#else\n  gl_FragColor \x3d highlightSlice(constantColor, vpos);\n#endif\n}","highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nvarying vec3 vpos;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvoid main() {\n  discardBySlice(vpos);\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"nativeLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\nvarying vec3 vpos;\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\nvoid main(void) {\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\n  #ifdef VERTEXCOLORS\n    vcolor \x3d color * 0.003921568627451;\n  #endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}"},
pathMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha \x3d 0.0;\n  const float maxTint \x3d 85.0;\n  const float maxReplace \x3d 170.0;\n  const float scaleAlpha \x3d 3.0;\n  if (symbolColor.a \x3d\x3d 0.0) {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d 0.0;\n  }\n  else if (symbolColor.a \x3c\x3d maxTint) {\n    colorMixMode \x3d 0;\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a \x3c\x3d maxReplace) {\n    colorMixMode \x3d 3;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode \x3d 1;\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n  }\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n  vec3 internalMixed \x3d internalColor * textureColor;\n  vec3 allMixed \x3d internalMixed * externalColor;\n  if (mode \x3d\x3d 1 ) {\n    return allMixed;\n  }\n  else if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalColor;\n  }\n  else {\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n  float internalMixed \x3d internalOpacity * textureOpacity;\n  float allMixed \x3d internalMixed * externalOpacity;\n  if (mode \x3d\x3d 2  ) {\n    return internalMixed;\n  }\n  else if (mode \x3d\x3d 3  ) {\n    return externalOpacity;\n  }\n  else {\n    return allMixed;\n  }\n}",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/sceneLighting.glsl\x3e\nuniform vec3 camPos;\nuniform vec3 localOrigin;\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\nuniform int colorMixMode;\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying vec4 vcolor;\nvarying vec4 vcolorExt;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include \x3cutil/shadow.glsl\x3e\n#endif\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\nvoid main() {\n  discardBySlice(vpos);\n  vec4 texColor \x3d vec4(1.0);\n  vec3 viewDir \x3d vpos - camPos;\n#ifdef GROUND_NORMAL_SHADING\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec3 normal \x3d normalize(vpos + localOrigin);\n#else\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\n#endif\n#else\n#ifdef DOUBLESIDED\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\n#elif defined(WINDINGORDERDOUBLESIDED)\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\n#else\n  vec3 normal \x3d vnormal;\n#endif\n  normal \x3d normalize(normal);\n#endif\n#ifdef RECEIVE_SSAO\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n#else\n  float ssao \x3d 1.0;\n#endif\n  float additionalAmbientScale;\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n  float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n  vec3 matColor \x3d max(ambient, diffuse);\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  albedo_+\x3d 0.25 * specular;\n#ifdef TRANSPARENCY_DISCARD\n  if (opacity_ \x3c 0.001) {\n    discard;\n  }\n#endif\n  vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  gl_FragColor \x3d vec4(shadedColor, opacity_);\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nvarying vec3 vpos;\nvarying vec3 vnormal;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\nuniform vec4 externalColor;\nvarying vec4 vcolor;\nvarying vec4 vcolorExt;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main() {\n  vpos \x3d calculateVPos();\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#ifdef RECEIVE_SHADOWS\n  linearDepth \x3d gl_Position.w;\n#endif\n  vcolorExt \x3d externalColor;\n  vcolor \x3d getColor();\n}",
"commonFunctions.glsl":"#include \x3cutil/doublePrecision.glsl\x3e\nattribute vec4 featureValue;\nbool isCapVertex() {\n  return featureValue.w \x3d\x3d 1.0;\n}\nuniform vec3 size;\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n  vec2 getSize() {\n    float value \x3d featureValue.x;\n    return size.xy*clamp(vvSizeOffset + value * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n  }\n#else\n  vec2 getSize(){\n    return size.xy;\n  }\n#endif\n#ifdef VV_OPACITY\n  #define VV_OPACITY_N 8\n  uniform float vvOpacityValues[VV_OPACITY_N];\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\n  vec4 applyOpacity(vec4 color) {\n    float value \x3d featureValue.z;\n    if (value \x3c\x3d vvOpacityValues[0]) {\n      return vec4( color.xyz, vvOpacityOpacities[0]);\n    }\n    for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n      if (vvOpacityValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n        return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n      }\n    }\n    return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n  }\n#else\n  vec4 applyOpacity(vec4 color){\n    return color;\n  }\n#endif\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n  vec4 getColor() {\n    float value \x3d featureValue.y;\n    if (value \x3c\x3d vvColorValues[0]) {\n      return applyOpacity(vvColorColors[0]);\n    }\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n      if (vvColorValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n        return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n      }\n    }\n    return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n  }\n#else\n  vec4 getColor(){\n    return applyOpacity(vec4(1, 1, 1, 1));\n  }\n#endif\nvec3 calculateVPos() {\n  vec2 size \x3d getSize();\n  vec3 origin \x3d position;\n  vec3 right \x3d profileRight.xyz;\n  vec3 up \x3d profileUp.xyz;\n  vec3 forward \x3d cross(up, right);\n  vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n  vec2 profileNormal \x3d profileVertexAndNormal.zw;\n  float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n  float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n  if(!isCapVertex()) {\n    vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n    float maxDistance \x3d length(rotationRight);\n    rotationRight \x3d normalize(rotationRight);\n    float rx \x3d dot(profileVertex, rotationRight);\n    if (abs(rx) \x3e maxDistance) {\n      vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n      float ry \x3d dot(profileVertex, rotationUp);\n      profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n    }\n  }else{\n     positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n     normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n  }\n  vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n  vec4 localPosition \x3d vec4(origin + offset, 1.0);\n  return (model * localPosition).xyz;\n}\nvec4 localNormal() {\n  vec3 right \x3d profileRight.xyz;\n  vec3 up \x3d profileUp.xyz;\n  vec3 forward \x3d cross(up, right);\n  vec2 profileNormal \x3d profileVertexAndNormal.zw;\n  vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n  if(isCapVertex()) {\n    normal +\x3d forward * profileUp.w;\n  }\n  return vec4(normal, 1.0);\n}",
"commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\nuniform vec3 camPos;\nuniform vec3 localOrigin;\nuniform mat4 model;\nuniform mat4 modelNormal;\nattribute vec3 position;\nattribute vec4 profileRight;\nattribute vec4 profileUp;\nattribute vec4 profileVertexAndNormal;","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying float depth;\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor \x3d float2rgba(depth);\n#else\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n}",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nuniform vec2 nearFar;\nvarying float depth;\nvarying vec3 vpos;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n}","highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\nvarying vec3 vpos;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvoid main() {\n  discardBySlice(vpos);\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nvarying vec3 vpos;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n  vec3 normal \x3d normalize(vnormal);\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#ifndef ALPHA_ZERO\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\nuniform mat4 viewNormal;\nvarying vec3 vnormal;\nvarying vec3 vpos;\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}"},ribbonLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform vec4 symbolColor;\nvarying vec4 vColor;\nvarying vec2 vtc;\nvarying vec3 vpos;\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\nvoid main() {\n  discardBySlice(vpos);\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n    discard;\n  }\n#endif\n  gl_FragColor \x3d highlightSlice(symbolColor * vColor, vpos);\n}",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nvarying vec2 vtc;\nvarying vec3 vpos;\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\nvoid main() {\n  discardBySlice(vpos);\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\n    discard;\n  }\n#endif\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","inputs.glsl":"uniform float symbolLineWidth;\n#ifdef VV_SIZE\n  attribute float sizeFeatureAttribute;\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n  float getSize() {\n    float value \x3d sizeFeatureAttribute;\n    return symbolLineWidth * clamp(vvSizeOffset + value * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n  }\n#else\n  attribute float size;\n  float getSize(){\n    return symbolLineWidth * size;\n  }\n#endif\n#ifdef VV_OPACITY\n  attribute float opacityFeatureAttribute;\n  #define VV_OPACITY_N 8\n  uniform float vvOpacityValues[VV_OPACITY_N];\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\n  float interpolateOpacity( float value ){\n    if (value \x3c\x3d vvOpacityValues[0]) {\n      return vvOpacityOpacities[0];\n    }\n    for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n      if (vvOpacityValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n        return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n      }\n    }\n    return vvOpacityOpacities[VV_OPACITY_N - 1];\n  }\n  vec4 applyOpacity( vec4 color ){\n    return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n  }\n#else\n  vec4 applyOpacity( vec4 color ){\n    return color;\n  }\n#endif\n#ifdef VV_COLOR\n  attribute float colorFeatureAttribute;\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n  vec4 interpolateColor( float value ) {\n    if (value \x3c\x3d vvColorValues[0]) {\n      return vvColorColors[0];\n    }\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n      if (vvColorValues[i] \x3e\x3d value) {\n        float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n        return mix(vvColorColors[i-1], vvColorColors[i], f);\n      }\n    }\n    return vvColorColors[VV_COLOR_N - 1];\n  }\n  vec4 getColor(){\n    return applyOpacity(interpolateColor(colorFeatureAttribute));\n  }\n#else\n  attribute vec4 color;\n  vec4 getColor(){\n    return applyOpacity(color);\n  }\n#endif",
"ribbonLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cmaterials/ribbonLine/inputs.glsl\x3e\nconst float PI \x3d 3.1415926535897932384626433832795;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform float nearPlane;\nuniform float pixelRatio;\nattribute vec3 position;\nattribute float subdivisionFactor;\nattribute vec2 uv0;\nvarying vec2 vtc;\nvarying vec4 vColor;\nvarying vec3 vpos;\nuniform float miterLimit;\nattribute vec3 auxpos1;\nattribute vec3 auxpos2;\nuniform vec2 screenSize;\nvec4 toScreenCoords(vec3 vertex) {\n  vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n  vClipSpace.xy *\x3d screenSize;\n  return vClipSpace/abs(vClipSpace.w);\n}\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\nfloat interp(float ncp, vec4 a, vec4 b) {\n  return (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\n\tfloat s \x3d sin(a);\n\tfloat c \x3d cos(a);\n\tmat2 m \x3d mat2(c, -s, s, c);\n\treturn m * v;\n}\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n  float vnp \x3d nearPlane*0.99;\n  if(pos.z \x3e -nearPlane) {\n    if (!isStartVertex) {\n      if(prev.z \x3c -nearPlane) {\n        pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n        next \x3d pos;\n      } else {\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n    if(isStartVertex) {\n      if(next.z \x3c -nearPlane) {\n        pos \x3d mix(pos, next, interp(vnp, pos, next));\n        prev \x3d pos;\n      } else {\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n  } else {\n    if (prev.z \x3e -nearPlane) {\n      prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n    }\n    if (next.z \x3e -nearPlane) {\n      next \x3d mix(next, pos, interp(vnp, next, pos));\n    }\n  }\n  pos\x3d proj * pos;\n  pos.xy *\x3d screenSize;\n  pos /\x3d pos.w;\n  next \x3d proj * next;\n  next.xy *\x3d screenSize;\n  next /\x3d next.w;\n  prev \x3d proj * prev;\n  prev.xy *\x3d screenSize;\n  prev /\x3d prev.w;\n}\nvoid main(void) {\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\n  if (uv0.y \x3d\x3d 0.0) {\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n  }\n  else {\n    bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n    bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n    float lineWidth \x3d getSize() * pixelRatio;\n    vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n    vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n    vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n    clipAndTransform(pos, prev, next, isStartVertex);\n    vec2 left \x3d (pos - prev).xy;\n    vec2 right \x3d (next - pos).xy;\n    float leftLen \x3d length(left);\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    float rightLen \x3d length(right);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n    if( isJoin ){\n      bool isOutside \x3d ISOUTSIDE;\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg*left - joinDisplacementDir);\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\n#ifdef JOIN_ROUND\n        vec2 startDir;\n        vec2 endDir;\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate( startDir, -sign(uv0.y)*subdivisionFactor*rotationAngle );\n        displacementLen \x3d lineWidth;\n#else\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n        displacementLen \x3d lineWidth;\n#endif\n      }\n    } else {\n      if (leftLen \x3c 0.001) {\n        joinDisplacementDir \x3d right;\n      }\n      else if (rightLen \x3c 0.001) {\n        joinDisplacementDir \x3d left;\n      }\n      else {\n        joinDisplacementDir \x3d isStartVertex ? right : left;\n      }\n      joinDisplacementDir \x3d normalize(joinDisplacementDir);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n      displacementLen \x3d lineWidth;\n      capDisplacementDir \x3d isStartVertex ? -right : left;\n  #ifdef CAP_ROUND\n      float angle \x3d subdivisionFactor*PI*0.5;\n      joinDisplacementDir *\x3d cos(angle);\n      capDisplacementDir *\x3d sin(angle);\n  #else\n      capDisplacementDir *\x3d subdivisionFactor;\n  #endif\n    }\n    pos.xy +\x3d joinDisplacementDir * sign(uv0.y) * displacementLen;\n    pos.xy +\x3d capDisplacementDir * displacementLen;\n    pos.xy /\x3d screenSize;\n    vtc \x3d uv0;\n    vColor \x3d getColor();\n    gl_Position \x3d pos;\n  }\n}"},
slicePlane:{"slicePlane.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 backgroundColor;\nuniform vec4 gridColor;\nuniform float ratio;\nuniform float gridWidth;\nvarying vec2 vUV;\nvoid main() {\n  const float LINE_WIDTH \x3d 1.0;\n  vec2 uvScaled \x3d vUV * gridWidth;\n  vec2 gridUV \x3d (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n  vec2 grid \x3d (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n  grid.x *\x3d step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n  grid.y *\x3d step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n  float gridFade \x3d max(grid.x, grid.y);\n  float gridAlpha \x3d gridColor.a * gridFade;\n  gl_FragColor \x3d\n    vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n    vec4(gridColor.rgb, 1.0) * gridAlpha;\n}",
"slicePlane.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec2 vUV;\nvoid main(void) {\n  vUV \x3d uv0;\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}"},water:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\n#include \x3cmaterials/water/waterDistortion.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\nvarying float linearDepth;\n#include \x3cutil/shadow.glsl\x3e\n#endif\n#include \x3cmaterials/water/waterSurface.glsl\x3e\nuniform vec4 waterColor;\nuniform vec3 lightingMainDirection;\nuniform vec3 lightingMainIntensity;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nvoid main() {\n  discardBySlice(vpos);\n  vec3 localUp \x3d vnormal;\n  vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n  vec3 n \x3d normalize(vtbnMatrix * tangentNormal);\n  vec3 v \x3d -normalize(vpos - camPos);\n  vec3 l \x3d normalize(-lightingMainDirection);\n  float shadow \x3d 1.0;\n#ifdef RECEIVE_SHADOWS\n    shadow \x3d 1.0 - evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n  vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n  gl_FragColor \x3d delinearizeGamma(final);\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec3 localOrigin;\nattribute vec3 position;\nattribute vec2 uv0;\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\nvoid main(void) {\n  vuv \x3d uv0;\n  vpos \x3d calculateVPos();\n  vnormal \x3d getLocalUp(vpos, localOrigin);\n  vtbnMatrix \x3d getTBNMatrix(vnormal);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n  #ifdef RECEIVE_SHADOWS\n    linearDepth \x3d gl_Position.w;\n  #endif\n}",
"drapedColorPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform vec4 waterColor;\nvoid main() {\n  gl_FragColor \x3d waterColor;\n}","drapedColorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec3 localOrigin;\nattribute vec3 position;\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\nvarying vec3 vpos;\nvoid main(void) {\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}",
"normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\n#include \x3cmaterials/water/waterDistortion.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvoid main() {\n  discardBySlice(vpos);\n  vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n  tangentNormal \x3d normalize(tangentNormal);\n  gl_FragColor \x3d vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n}",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec3 localOrigin;\nattribute vec3 position;\nattribute vec2 uv0;\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\nvarying vec3 vpos;\nvarying vec2 vuv;\nvoid main(void) {\n  vuv \x3d uv0;\n  vpos \x3d calculateVPos();\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}",
"normalsUtils.glsl":"vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    return normalize(pos + origin);\n  #else\n    return vec3(0.0, 0.0, 1.0);\n  #endif\n}\nmat3 getTBNMatrix(in vec3 n) {\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n    vec3 b \x3d normalize(cross(n, t));\n    return mat3(t, b, n);\n  #else\n    vec3 t \x3d vec3(1.0, 0.0, 0.0);\n    vec3 b \x3d normalize(cross(n, t));\n    return mat3(t, b, n);\n  #endif\n}",
"waterDistortion.glsl":"uniform vec3 octaveTextureRepeat;\nuniform vec4 waveParams;\nuniform vec2 waveDirection;\nconst vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n  return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\n  return texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n  return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\n  return fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\n  float progress \x3d computeProgress(uv, time);\n  return 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n  float flowStrength \x3d waveParams[2];\n  float flowOffset \x3d waveParams[3];\n  vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n  float progress \x3d computeProgress(uv, time + phaseOffset);\n  float weight \x3d computeWeight(uv, time + phaseOffset);\n  vec2 result \x3d uv;\n  result -\x3d flowVector * (progress + flowOffset);\n  result +\x3d phaseOffset;\n  result +\x3d (time - progress) * FLOW_JUMP;\n  return vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\nconst float TIME_NOISE_STRENGTH \x3d 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n  float waveStrength \x3d waveParams[0];\n  vec2 waveMovement \x3d time * -_waveDir;\n  float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n  vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n  vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n  vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n  vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n  vec3 mixNormal \x3d normalize(normal_A + normal_B);\n  mixNormal.xy *\x3d waveStrength;\n  mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n  return mixNormal;\n}\nvec3 getSurfaceNormal(vec2 _uv, float _time) {\n  float waveTextureRepeat \x3d waveParams[1];\n  return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n}",
"waterSurface.glsl":"const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 5.0);\nconst vec2 fresnelMaterial \x3d  vec2(0.02, 0.1);\nconst float roughness \x3d 0.06;\nconst vec3 skyZenitColor \x3d vec3(0, 0.6, 0.9);\nconst vec3 skyColor \x3d vec3(0.72, 0.92, 1.0);\n#include \x3cutil/pbrUtils.glsl\x3e\n#include \x3cutil/gamma.glsl\x3e\nPBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n  float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n  return mix(zenit, horizon, exponent);\n}\nvec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n  vec3 seaWaterColor \x3d linearizeGamma(color);\n  vec3 h \x3d normalize(l + v);\n  shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n  shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n  shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n  shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n  shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n  shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n  float upDotV \x3d max(dot(localUp,v), 0.0);\n  vec3 skyHorizon \x3d linearizeGamma(skyColor);\n  vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n  vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n  float upDotL \x3d max(dot(localUp,l),0.0);\n  skyColor *\x3d 0.1 + upDotL * 0.9;\n  float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n  vec3 reflSky \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n  vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n  vec3 specular \x3d vec3(0.0);\n  if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n    vec3 specularSun \x3d brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n    vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n    specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n  }\n  return tonemapACES(reflSky + reflSea + specular);\n}"}},
misc:{"blendLayers.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec2 uv;\nuniform sampler2D tex;\nuniform float opacity;\nvoid main() {\n  vec4 color \x3d texture2D(tex, uv);\n  gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n}","blendLayers.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec3 position;\nattribute vec2 uv0;\nuniform float scale;\nuniform vec2 offset;\nvarying vec2 uv;\nvoid main(void) {\n  gl_Position \x3d vec4(position, 1.0);\n  uv \x3d uv0 * scale + offset;\n}",
"texOnly.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nuniform vec4 color;\nvarying vec2 vtc;\nvoid main() {\n  vec4 texColor \x3d texture2D(tex, vtc);\n  gl_FragColor \x3d texColor * color;\n}","texOnly.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec2 vtc;\nvoid main(void) {\n  gl_Position \x3d vec4(position, 1.0);\n  vtc \x3d uv0;\n}"},pointRenderer:{"pointRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#ifdef HIGHLIGHT_PASS\n#include \x3cutil/highlight.glsl\x3e\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n#endif\n#ifdef DEPTH_PASS\nvarying float depth;\n#elif defined(HIGHLIGHT_PASS)\n#else\nvarying vec3 vColor;\n#endif\nvoid main(void) {\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n  float r2 \x3d dot(vOffset, vOffset);\n  if (r2 \x3e 0.25) {\n    discard;\n  }\n#ifdef DEPTH_PASS\n  gl_FragColor \x3d float2rgba(depth);\n#elif defined(HIGHLIGHT_PASS)\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n#else\n  gl_FragColor \x3d vec4(vColor, 1.0);\n#endif\n}",
"pointRenderer.vert":"#include \x3cutil/slice.glsl\x3e\n#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec3 aPosition;\nattribute vec3 aColor;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform vec2 uScreenMinMaxSize;\nuniform vec2 uPointScale;\nuniform vec3 uClipMin;\nuniform vec3 uClipMax;\n#ifdef DEPTH_PASS\nuniform vec2 nearFar;\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\nvoid main(void) {\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize \x3d 0.0;\n    return;\n  }\n  if (rejectBySlice(aPosition)) {\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize \x3d 0.0;\n    return;\n  }\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\n  float pointSize \x3d uPointScale.x;\n  vec4 position \x3d uProjectionMatrix * camera;\n#ifdef DRAW_SCREEN_SIZE\n    float clampedScreenSize \x3d pointSize;\n#else\n    float pointRadius \x3d 0.5 * pointSize;\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n    float radius \x3d abs(positionOffset.y - position.y);\n    float viewHeight \x3d uPointScale.y;\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n    position \x3d uProjectionMatrix * camera;\n#endif\n  gl_PointSize \x3d clampedScreenSize;\n  gl_Position \x3d position;\n#ifdef DEPTH_PASS\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n#else\n  vColor \x3d aColor;\n#endif\n}"},
renderer:{highlight:{"apply.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nuniform sampler2D origin;\nuniform vec4 color;\nuniform vec4 haloColor;\nuniform float outlineSize;\nuniform float blurSize;\nuniform vec4 opacities;\nvarying vec2 uv;\nvoid main() {\n  #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\n    gl_FragColor \x3d vec4(uv, 0.0, 1.0);\n  #else\n    vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n    float highlightIntensity \x3d blurredHighlightValue.a;\n    if (highlightIntensity \x3d\x3d 0.0) {\n      discard;\n    }\n    vec4 origin_color \x3d texture2D(origin, uv);\n    float outlineIntensity;\n    float fillIntensity;\n    if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n      outlineIntensity \x3d haloColor.w * opacities[1];\n      fillIntensity \x3d color.w * opacities[3];\n    }\n    else {\n      outlineIntensity \x3d haloColor.w * opacities[0];\n      fillIntensity \x3d color.w * opacities[2];\n    }\n    float inner \x3d 1.0 - outlineSize / 9.0;\n    float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n    float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n    float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n    float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n    gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n  #endif\n}",
"apply.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 uv;\n#ifdef GRID_OPTIMIZATION\n  attribute vec2 uv0;\n  uniform sampler2D coverageTex;\n#endif\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    #ifdef GRID_DEBUG\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\n        gl_Position \x3d vec4(0.0);\n        return;\n      }\n      gl_Position \x3d vec4(position, .0, 1.0);\n      uv \x3d uv0;\n      return;\n    #else\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n        return;\n      }\n    #endif\n  #endif\n  gl_Position \x3d vec4(position, .0, 1.0);\n  uv \x3d position.xy * .5 + vec2(.5);\n}",
"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\n#ifdef GRID_OPTIMIZATION\n  uniform vec2 blurSize;\n  varying vec3 blurCoordinate;\n#else\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    vec2 uv \x3d blurCoordinate.xy;\n    vec4 center \x3d texture2D(tex, uv);\n    if (blurCoordinate.z \x3d\x3d 1.0) {\n      gl_FragColor \x3d center;\n    }\n    else {\n      vec4 sum \x3d vec4(0.0);\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\n        sum +\x3d center * 0.204164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n        sum +\x3d center * 0.204164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n        sum +\x3d center * 0.204164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\n        sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n        sum +\x3d center * 0.154164;\n        sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n        sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n        sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n        sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\n        sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\n      #endif\n      gl_FragColor \x3d sum;\n    }\n  #else\n    vec4 sum \x3d vec4(0.0);\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\n      sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\n      sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\n    #endif\n    gl_FragColor \x3d sum;\n  #endif\n}",
"blur.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nattribute vec2 uv0;\n#ifdef GRID_OPTIMIZATION\n  uniform sampler2D coverageTex;\n  varying vec3 blurCoordinate;\n#else\n  uniform vec2 blurSize;\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\nvoid main() {\n  gl_Position \x3d vec4(position, 0.0, 1.0);\n  #ifdef GRID_OPTIMIZATION\n    vec4 cov \x3d texture2D(coverageTex, uv0);\n    if (cov.r \x3d\x3d 0.0) {\n      gl_Position \x3d vec4(0.0);\n    }\n    blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n  #else\n    vec2 uv \x3d position.xy * .5 + vec2(.5);\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\n      blurCoordinates[7] \x3d uv + blurSize * 7.1;\n      blurCoordinates[8] \x3d uv - blurSize * 7.1;\n    #endif\n  #endif\n}",
"downsample.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nuniform vec2 invFramebufferDim;\nvoid main() {\n  vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n  vec4 value \x3d texture2D(tex, coord);\n  float mx \x3d floor(max(value.g, value.b));\n  gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n}","downsample.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvoid main() {\n  gl_Position \x3d vec4(vec2(1.0) - position * 2.0, .0, 1.0);\n}"},
laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\nuniform sampler2D depthMap;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 zScale;\nuniform float maxPixelDistance;\nuniform vec4 focusPlane;\nuniform vec4 focusSphere;\nuniform vec4 segmentPlane;\nuniform vec3 segmentStart;\nuniform vec3 segmentEnd;\nuniform vec3 glowColor;\nuniform float glowWidth;\nuniform vec3 innerColor;\nuniform float innerWidth;\nuniform float globalAlpha;\nvarying vec2 uv;\n#define INFINITY 100000.0\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\n  float width \x3d fwidth(dist);\n  dist /\x3d min(width, maxPixelDistance);\n  return abs(dist);\n}\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\n  float width \x3d fwidth(dist);\n  dist /\x3d min(width, maxPixelDistance);\n  return abs(dist);\n}\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\n  return vec4(\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\n    source.a + dest.a * oneMinusSourceAlpha\n  );\n}\nvec4 premultipliedColor(vec3 rgb, float alpha) {\n  return vec4(rgb * alpha, alpha);\n}\nvec4 laserLineProfile(float dist) {\n  if (dist \x3e glowWidth) {\n    return vec4(0.0);\n  }\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\n  return blendPremultiplied(\n    premultipliedColor(innerColor, innerAlpha),\n    premultipliedColor(glowColor, glowAlpha)\n  );\n}\nvoid main() {\n  float depth \x3d linearDepth(depthMap, uv, nearFar);\n  if (-depth \x3d\x3d nearFar[0]) {\n    discard;\n  }\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\n  float ddepth \x3d fwidth(depth);\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\n  float segmentDistance \x3d INFINITY;\n  float segmentLength \x3d length(segmentEnd - segmentStart);\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\n  float t \x3d dot(segmentDir, pos - segmentStart);\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\n  }\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\n  vec4 color \x3d max(\n    focusPlaneColor * focusPlaneAlpha,\n    max(\n      focusSphereColor * focusSphereAlpha,\n      segmentColor * segmentAlpha\n    )\n  );\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\n}"},
offscreen:{"composite.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvoid main() {\n  gl_FragColor \x3d texture2D(tex, vtc);\n}","compositeOccluded.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D occludedColorMap;\nuniform float opacity;\nvarying vec2 vtc;\nvoid main() {\n  vec4 occludedColor \x3d texture2D(occludedColorMap, vtc);\n  gl_FragColor \x3d occludedColor * opacity;\n}","compositeTransparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvoid main() {\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\n}",
"offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 vtc;\nvoid main(void) {\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\n  vtc \x3d position.xy * 0.5 + 0.5;\n}"},ssao:{"blur.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#ifndef RADIUS\n#define RADIUS 4\n#endif\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\nuniform sampler2D tex;\nuniform vec2 blurSize;\nuniform float g_BlurFalloff;\nuniform float projScale;\nuniform vec2 nearFar;\nuniform vec2 zScale;\nvarying vec2 uv;\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n  float c \x3d texture2D(tex, uv).r;\n  float d \x3d linearDepth(depthMap, uv, nearFar);\n  float ddiff \x3d d - center_d;\n  float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n  w_total +\x3d w;\n  return w*c;\n}\nvoid main(void) {\n  float b \x3d 0.0;\n  float w_total \x3d 0.0;\n  float center_d \x3d linearDepth(depthMap, uv, nearFar);\n  float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n  for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n    float rf \x3d float(r);\n    vec2 uvOffset \x3d uv + rf*blurSize;\n    b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n  }\n  gl_FragColor \x3d vec4(b/w_total);\n}",
"ssao.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\n#ifndef SAMPLES\n#define SAMPLES 4\n#endif\nuniform mat4 projMatrixInv;\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\nuniform float intensity;\nuniform float projScale;\nuniform float radius;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 screenDimensions;\nuniform vec3 pSphere[SAMPLES];\nuniform vec2 rnmScale;\nuniform sampler2D rnm;\nuniform vec2 zScale;\nvarying vec2  uv;\nvarying vec4  camPos;\nfloat fallOffFunction(float vv, float vn, float bias) {\n  float radius2 \x3d radius * radius;\n  float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n}\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n  vec3 v \x3d Q - C;\n  float vv \x3d dot(v, v);\n  float vn \x3d dot(normalize(v), n_C);\n  return fallOffFunction(vv, vn, 0.1);\n}\nvec3 reconstructCSPosition(vec2 S, float z) {\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n}\nvoid main(void) {\n  vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n  float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\n  if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n    gl_FragColor \x3d vec4(0.0);\n    return;\n  }\n  vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n  vec4 norm4 \x3d texture2D(normalMap, uv);\n  vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n  bool isTerrain \x3d norm4.w\x3c0.5;\n  float sum \x3d .0;\n  vec4 occluderFragment;\n  vec3 ray;\n  vec3 tapPixelPos;\n  float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n  for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n    vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n    vec2 offset \x3d vec2(-unitOffset*radius*ps);\n    if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n    vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n    if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n    vec2 tcTap \x3d tc/screenDimensions;\n    float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\n    if (isTerrain) {\n      bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n      if (isTerrainTap) {\n        continue;\n      }\n    }\n    tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\n    sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n  }\n  float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n  A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n  gl_FragColor \x3d vec4(A);\n}"}},
terrainRenderer:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/sceneLighting.glsl\x3e\n#include \x3cutil/screenSizePerspective.glsl\x3e\n#include \x3cutil/shadow.glsl\x3e\n#include \x3cutil/slice.glsl\x3e\n#include \x3cterrainRenderer/overlay.glsl\x3e\nuniform vec3 camPos;\nuniform vec3 viewDirection;\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\nuniform sampler2D tex;\nuniform float opacity;\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n#if defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n#ifdef ATMOSPHERE\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n#endif\nconst vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\nconst vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\nconst float diffuseHardness \x3d 2.5;\nconst float sliceOpacity \x3d 0.2;\n#ifdef OVERLAY\nuniform sampler2D ovInnerColorTex;\nuniform sampler2D ovOuterColorTex;\nuniform sampler2D ovInnerWaterTex;\nuniform sampler2D ovOuterWaterTex;\nuniform float overlayOpacity;\nvarying vec4 vtcOverlay;\nvarying vec3 tbnTangent;\nvarying vec3 tbnBiTangent;\n#endif\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\nfloat lum(vec3 c) {\n  float max \x3d max(max(c.r, c.g), c.b);\n  float min \x3d min(min(c.r, c.g), c.b);\n  return (min + max) * 0.5;\n}\n#ifdef ATMOSPHERE\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n  vec3 surfaceColor   \x3d vec3(0.0);\n  vec3 fuzzySpecColor \x3d vec3(1.0);\n  vec3 subColor       \x3d vec3(0.0);\n  float rollOff       \x3d 1.0;\n  vec3 Ln \x3d normalize(lightPos);\n  vec3 Nn \x3d normalize(normal);\n  vec3 Hn \x3d normalize(view + Ln);\n  float ldn \x3d dot(Ln, Nn);\n  float diffComp \x3d max(0.0, ldn);\n  float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n  float ndv \x3d dot(view, Ln);\n  vec3 diffContrib \x3d surfaceColor * diffComp;\n  float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n  vec3 subContrib \x3d subLamb * subColor;\n  vec3 vecColor \x3d vec3(vdn);\n  vec3 diffuseContrib \x3d (subContrib + diffContrib);\n  vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n  return (diffContrib + specularContrib) * rollOff;\n}\n#endif\nvoid main() {\n  float shadow \x3d 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n  float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n  float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n  vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n  float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\n#ifdef OVERLAY\n  vec4 overlayColor  \x3d overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n  tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\n#endif\n  if (rejectBySlice(vpos)) {\n    tileColor *\x3d sliceOpacity;\n  }\n  vec3 atm \x3d vec3(0.0);\n#ifdef ATMOSPHERE\n  float ndotl \x3d max(0.0, min(1.0, vndl));\n  atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n  atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5)));\n  atm *\x3d max(0.0, min(1.0, ndotl*2.0));\n  atm *\x3d tileColor.a;\n#endif\n  vec3 albedo \x3d atm + tileColor.rgb;\n  vec3 normal \x3d normalize(vnormal);\n  float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n  vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n  gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n#ifdef OVERLAY\n  vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n  float waterNormalLength \x3d length(overlayWaterMask);\n  if (waterNormalLength \x3e 0.95) {\n    mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n    vec4 waterColor \x3d overlayOpacity * getOverlayWaterColor(tileColor, overlayWaterMask, overlayColor, vpos, shadow, vnormal, camPos, tbnMatrix);\n    vec4 groundColor \x3d vec4(pow(gl_FragColor.rgb, vec3(2.2)), gl_FragColor.w);\n    waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n    gl_FragColor \x3d delinearizeGamma(waterColor);\n  }\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n  if (perspectiveScale \x3c\x3d 0.25) {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n  }\n  else if (perspectiveScale \x3c\x3d 0.5) {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n  }\n  else if (perspectiveScale \x3e\x3d 0.99) {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n  }\n  else {\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n  }\n#endif\n#if defined(TILE_BORDERS)\n  vec2 dVuv \x3d fwidth(vuv);\n  vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n  float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n  gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n#endif\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n}",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\n#include \x3cmaterials/water/normalsUtils.glsl\x3e\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec3 origin;\nuniform vec4 texOffsetAndScale;\nuniform mat4 viewNormal;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n#if defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n#ifdef ATMOSPHERE\nuniform vec3 lightingMainDirection;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n#ifdef OVERLAY\nuniform vec4 overlayTexOffset;\nuniform vec4 overlayTexScale;\nvarying vec4 vtcOverlay;\nvarying vec3 tbnTangent;\nvarying vec3 tbnBiTangent;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n#endif\nvoid main(void) {\n  vpos \x3d position;\n  vnormal \x3d getLocalUp(vpos, origin);\n  vec2 uv \x3d uv0;\n  vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n#ifdef ATMOSPHERE\n  wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n  wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;\n#endif\n#if defined(TILE_BORDERS)\n  vuv \x3d uv;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n  screenSizeDistanceToCamera \x3d length(viewPos);\n  vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n  screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\n#endif\n  gl_Position \x3d transformPosition(proj, view, vpos);\n#ifdef RECEIVE_SHADOWS\n  linearDepth \x3d gl_Position.w;\n#endif\n  vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n#ifdef OVERLAY\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), vnormal));\n    tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n  #else\n    tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n    tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n  #endif\n#endif\n}",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\nvarying float depth;\nvoid main() {\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor \x3d float2rgba(depth);\n#else\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\n#endif\n}","depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec2 nearFar;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying float depth;\nvoid main(void) {\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec3 normal \x3d normalize(position + origin);\n#else\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\n#endif\n  vec2 uv \x3d uv0;\n  vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n  gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n}",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/highlight.glsl\x3e\n#include \x3cterrainRenderer/overlay.glsl\x3e\nuniform sampler2D ovInnerColorTex;\nuniform sampler2D ovOuterColorTex;\nuniform float overlayOpacity;\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\nvarying vec4 vtcOverlay;\nvoid main() {\n  vec4 overlayColor \x3d getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay) * overlayOpacity;\n  if (overlayColor.a \x3d\x3d 0.0) {\n    gl_FragColor \x3d vec4(0.0);\n    return;\n  }\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec4 overlayTexScale;\nuniform vec4 overlayTexOffset;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 vpos;\nvarying vec4 vtcOverlay;\nvoid main() {\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    vec3 vnormal \x3d normalize(position + origin);\n  #else\n    vec3 vnormal \x3d vec3(0.0, 0.0, 1.0);\n  #endif\n  vec2 uv \x3d uv0;\n  vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n  gl_Position \x3d transformPosition(proj, view, vpos);\n}",
"normalPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvoid main() {\n  vec3 normal \x3d normalize(vnormal);\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n#ifndef ALPHA_ZERO\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}","normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\n#include \x3cutil/transform.glsl\x3e\n#include \x3cterrainRenderer/skirts.glsl\x3e\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 viewNormal;\nuniform float skirtScale;\nattribute vec3 position;\nattribute vec2 uv0;\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvoid main(void) {\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n  vec4 normal \x3d vec4(normalize(position + origin), 1.0);\n#else\n  vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\n#endif\n  vec2 uv \x3d uv0;\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n  gl_Position \x3d transformPosition(proj, view, vpos);\n  vnormal \x3d normalize((viewNormal * normal).xyz);\n}",
"overlay.glsl":"#include \x3cmaterials/water/waterSurface.glsl\x3e\n#include \x3cutil/color.glsl\x3e\nvec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n  vec4 color \x3d vec4(0.0);\n  vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n  vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n  if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\n    color \x3d color0;\n  } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\n    color \x3d color1;\n  }\n  return color;\n}\n#ifdef OVERLAY\nvec4 getOverlayWaterColor( in vec4 tileColor, vec4 maskInput, vec4 colorInput,\n                     vec3 vpos, float shadow, vec3 localUp, vec3 eye, mat3 tbn) {\n  vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n  vec3 v \x3d -normalize(vpos - eye);\n  vec3 l \x3d normalize(-lightingMainDirection);\n  vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow);\n  return premultiplyAlpha(vec4(final, colorInput.w));\n}\n#endif",
"skirts.glsl":"vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n  float skirtLength \x3d 0.0;\n  if (uv.x \x3e\x3d 2.0) {\n    skirtLength \x3d uv.y * skirtScale;\n    vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n    uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n  }\n  return vpos - vnormal * skirtLength;\n}"},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n  vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n  vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n  return vec4(result, clipCoord.zw);\n}\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n  vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n  vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n  return vec4(result, clipCoord.zw);\n}",
"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\n  return vec4(v.rgb * v.a, v.a);\n}\nvec3 rgb2hsv(vec3 c) {\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n  float d \x3d q.x - min(q.w, q.y);\n  float e \x3d 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}",
"depth.glsl":"#include \x3cutil/encoding.glsl\x3e\nfloat linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n  return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n}\nfloat calcFragDepth(const in float depth) {\n  const float SLOPE_SCALE \x3d 2.0;\n  const float BIAS \x3d 2.0 * .000015259;\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\n  return clamp(result, .0, .999999);\n}","doublePrecision.glsl":"#ifdef REQUIRES_FLOAT_OPERATIONS_FIX\nvec3 dpPlusFrc(vec3 a, vec3 b) {\n  return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\n  return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n  vec3 e \x3d dpMinusFrc(t1, hiA);\n  vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n  return t1 + t2;\n}\n#else\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 \x3d hiA + hiB;\n  vec3 e \x3d t1 - hiA;\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n#endif",
"enableExtensions.glsl":"#define EXTENSIONS_ENABLED\n#extension GL_OES_standard_derivatives : enable\n#extension GL_EXT_shader_texture_lod : enable","encoding.glsl":"const float MAX_RGBA_FLOAT \x3d\n  255.0 / 256.0 +\n  255.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\nconst vec4 fixedPointFactors \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\nvec4 float2rgba(const float value) {\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n  const float toU8AsFloat \x3d 1.0 / 255.0;\n  return fixedPointU8 * toU8AsFloat;\n}\nconst vec4 rgba2float_factors \x3d vec4(\n  255.0 / (256.0),\n  255.0 / (256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif","gamma.glsl":"const float GAMMA \x3d 2.2;\nconst float INV_GAMMA \x3d 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\n  return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\n  return pow(color, vec3(GAMMA));\n}","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\n  float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\n  if (fragCoord.z \x3e sceneDepth + 5e-7) {\n    return vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    return vec4(1.0, 0.0, 1.0, 1.0);\n  }\n}",
"hud.glsl":"#include \x3cutil/screenSizePerspective.glsl\x3e\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 auxpos1;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 viewNormal;\nuniform mat4 model;\nuniform mat4 modelNormal;\nuniform vec4 viewport;\nuniform vec3 camPos;\nuniform float polygonOffset;\nuniform float cameraGroundRelative;\nuniform float pixelRatio;\nuniform float perDistancePixelRatio;\n#ifdef VERTICAL_OFFSET\nuniform vec4 verticalOffset;\n#endif\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspectiveAlignment;\n#endif\nuniform sampler2D hudVisibilityTexture;\nconst float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\nstruct ProjectHUDAux {\n  vec3 posModel;\n  vec3 posView;\n  vec3 vnormal;\n  float distanceToCamera;\n  float absCosAngle;\n};\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n  float pointGroundSign \x3d sign(pointGroundDistance);\n  if (pointGroundSign \x3d\x3d 0.0) {\n    pointGroundSign \x3d cameraGroundRelative;\n  }\n  float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n  if (polygonOffset \x3e .0) {\n    float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n    float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n    float factor \x3d (1.0 - tanAlpha / viewport[2]);\n    if (groundRelative \x3e 0.0) {\n      posView *\x3d factor;\n    }\n    else {\n      posView /\x3d factor;\n    }\n  }\n  return groundRelative;\n}\nvoid applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n  float distanceToCamera \x3d length(posView);\n  float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n  vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n  posModel +\x3d modelOffset;\n  posView +\x3d viewOffset;\n}\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\n  vec3 centerOffset \x3d auxpos1.xyz;\n  float pointGroundDistance \x3d auxpos1.w;\n  aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\n  aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n  aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\n  applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n  aux.distanceToCamera \x3d length(aux.posView);\n  vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n  float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n  aux.absCosAngle \x3d abs(cosAngle);\n#ifdef SCREEN_SIZE_PERSPECTIVE\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n#endif\n#ifdef VERTICAL_OFFSET\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\n#endif\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n  vec3 modelOffset \x3d aux.vnormal * worldOffset;\n  aux.posModel +\x3d modelOffset;\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n  aux.posView +\x3d viewOffset;\n  pointGroundDistance +\x3d worldOffset;\n#endif\n  float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n  aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n  if (centerOffset.z !\x3d 0.0) {\n    aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n  }\n#endif\n  vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n  float centerOffsetY \x3d centerOffset.y;\n#endif\n  posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\n#endif\n  posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n  return posProj;\n}\nuniform float uRenderTransparentlyOccludedHUD;\nbool testVisibilityHUD(vec4 posProj) {\n  vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n  vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n  if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n  }\n  return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n}",
"normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}","offset.glsl":"vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n  vec3 camToVert \x3d posWorld - camPosWorld;\n  bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n  if (isBackface) {\n    posClip.z +\x3d 0.0000003 * posClip.w;\n  }\n  return posClip;\n}","pbrUtils.glsl":"struct PBRShadingWater\n{\n    float NdotL;\n    float NdotV;\n    float NdotH;\n    float VdotH;\n    float LdotH;\n    float VdotN;\n};\n#ifdef USE_PBR\n  struct PBRShadingInfo\n  {\n      float NdotL;\n      float NdotV;\n      float NdotH;\n      float VdotH;\n      float LdotH;\n      float NdotNG;\n      float LdotNG;\n      float RdotNG;\n      float VdotNG;\n      float NdotAmbDir;\n      float NdotH_Horizon;\n      vec3 skyRadianceToSurface;\n      vec3 groundRadianceToSurface;\n      vec3 skyIrradianceToSurface;\n      vec3 groundIrradianceToSurface;\n      float averageAmbientRadiance;\n      #ifdef USE_PBR_CLEAR_COATING\n      vec3 skyRadianceToClearCoat;\n      vec3 groundRadianceToClearCoat;\n      #endif\n      float ssao;\n      vec3 groundReflectance;\n      vec3 albedoLinear;\n      vec3 f0;\n      vec3 f90;\n      vec3 f0_ClearCoating;\n      vec3 f90_ClearCoating;\n      vec3 diffuseColor;\n      float roughnessClearCoating;\n      float coating;\n      float metalness;\n      float roughness;\n  };\n  const float fillLightIntensity \x3d 0.25;\n  const float horizonLightDiffusion \x3d 0.4;\n  const vec3  skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n  const float additionalAmbientIrradianceFactor \x3d 0.02;\n  const vec3 clearCoatingFresnel \x3d vec3(0.04);\n#endif\nconst float PI \x3d 3.14159265359;\nconst float LIGHT_NORMALIZATION \x3d 1.0 / PI;\nconst float INV_PI \x3d 0.318309886;\nconst float HALF_PI \x3d 1.5707964;\n#ifdef OVERLAY\n  float dtrExponent \x3d 2.0;\n#else\n  float dtrExponent \x3d 2.2;\n#endif\n  vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n    return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n  }\nfloat normalDistributionWater(float NdotH, float roughness)\n{\n  float r2 \x3d roughness * roughness;\n  float NdotH2 \x3d NdotH * NdotH;\n  float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n  return r2 / denom;\n}\nfloat geometricOcclusionKelemen(float LoH)\n{\n    return 0.25 / (LoH * LoH);\n}\nvec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n{\n  vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n  float D \x3d normalDistributionWater(props.NdotH, roughness);\n  float V \x3d geometricOcclusionKelemen(props.LdotH);\n  return (D * V) * F;\n}\nvec3 tonemapACES(const vec3 x) {\n  return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n}\n#ifdef USE_PBR\n  vec3 fresnelReflection(float angle, vec3 f0, vec3 f90) {\n    return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n  }\n  vec3 calculateDiffuseReflectanceFactor(PBRShadingInfo inputs)\n  {\n    return (1.0 - inputs.metalness) * inputs.albedoLinear * INV_PI;\n  }\n  float normalDistribution(float NdotH, float roughness)\n  {\n      float a \x3d NdotH * roughness;\n      float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n      return b * b * INV_PI;\n  }\n  float geometricOcclusion(float NdotV, float NdotL, float roughness)\n  {\n      float a2 \x3d roughness * roughness;\n      float GGXL \x3d NdotV * sqrt((-NdotL * a2 + NdotL) * NdotL + a2);\n      float GGXV \x3d NdotL * sqrt((-NdotV * a2 + NdotV) * NdotV + a2);\n      return 0.5 / (GGXV + GGXL);\n  }\n  float geometricOcclusion_Fast(float NdotV, float NdotL, float roughness)\n  {\n      float r_1 \x3d (roughness + 1.0);\n      float a \x3d r_1 * r_1 / 8.0;\n      float GGXV \x3d (NdotV * (1.0 - a) + a);\n      float GGXL \x3d (NdotL * (1.0 - a) + a);\n      return 0.25 / (GGXV + GGXL);\n  }\n  float geometricOcclusionKelemenClearCoat(float LoH)\n  {\n      return 0.25 / (LoH * LoH);\n  }\n  vec3 calculateSpecularReflectanceFactor(PBRShadingInfo inputs, float roughness, vec3 f0, vec3 f90)\n  {\n    vec3  F \x3d fresnelReflection(inputs.VdotH, f0, f90);\n    float D \x3d normalDistribution(inputs.NdotH, roughness);\n    float V \x3d geometricOcclusion(inputs.NdotV, inputs.NdotL, roughness);\n      return (D * V) * F;\n  }\n  vec3 brdfPBR(PBRShadingInfo inputs)\n  {\n    vec3 diffuseComponent  \x3d calculateDiffuseReflectanceFactor(inputs);\n    vec3 specularComponent   \x3d calculateSpecularReflectanceFactor(inputs, inputs.roughness, inputs.f0, inputs.f90);\n    #ifdef USE_PBR_CLEAR_COATING\n      vec3  Fc \x3d fresnelReflection(inputs.LdotH, inputs.f0_ClearCoating, , inputs.f90_ClearCoating) * inputs.coating;\n      float Vc \x3d geometricOcclusionKelemenClearCoat(inputs.LdotH);\n      float Dc \x3d normalDistribution(inputs.NdotH, inputs.roughnessClearCoating);\n      vec3 specularComponentCoating \x3d  (Dc * Vc) * Fc;\n      vec3 complFc \x3d (1.0-Fc);\n      return (1.0 - inputs.ssao) * (diffuseComponent * complFc + specularComponent * complFc * complFc + specularComponentCoating);\n    #else\n      return (1.0 - inputs.ssao) * (diffuseComponent + specularComponent);\n    #endif\n  }\n  vec2 prefilteredDFG_Analytical(float roughness, float NdotV) {\n      const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n      const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n      vec4 r \x3d roughness * c0 + c1;\n      float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n      return vec2(-1.04, 1.04) * a004 + r.zw;\n  }\n  vec3 evaluateDiffuseIllumination_Hemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n  {\n    float ground \x3d 1.0 - NdotNG;\n    float sky \x3d 1.0 + NdotNG;\n    return (ground * ambientGround + sky * ambientSky)  * 0.5;\n  }\n  vec3 evaluateIrradianceIntegral(float firstAngle, float secondAngle, vec3 ambientGround, vec3 ambientSky)\n  {\n    float sin_firstAngleClamped \x3d sin(clamp(firstAngle, 0.0, HALF_PI));\n    float sin_secondAngleClamped \x3d sin(clamp(secondAngle, 0.0, HALF_PI));\n    float ground \x3d sin_firstAngleClamped + 1.0 - sin_secondAngleClamped;\n    float sky \x3d sin_secondAngleClamped - sin_firstAngleClamped;\n    return ground * ambientGround + sky * ambientSky;\n  }\n  vec3 evaluateDiffuseIllumination_Cone(vec3 ambientGround, vec3 ambientSky, float NdotNG, float skyIlluminationAngle)\n  {\n    float theta \x3d acos(clamp(NdotNG, -1.0, 1.0));\n    float firstAngle \x3d HALF_PI + theta - skyIlluminationAngle;\n    float secondAngle \x3d HALF_PI + theta + skyIlluminationAngle;\n    vec3 LeftIntegral \x3d evaluateIrradianceIntegral(HALF_PI - secondAngle, HALF_PI - firstAngle, ambientGround, ambientSky);\n    vec3 RightIntegral \x3d evaluateIrradianceIntegral(firstAngle - HALF_PI, secondAngle - HALF_PI, ambientGround, ambientSky);\n    vec3 ambientDiffuseLight \x3d (LeftIntegral + RightIntegral)  * 0.5;\n    return ambientDiffuseLight;\n  }\n  float integratedRadiance(float cosTheta2, float roughness)\n  {\n    return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n  }\n  vec3 evaluateSpecularIllumination_Hemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n  {\n    float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n    float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n    float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n    float sky \x3d 2.0 - ground;\n    vec3 enviromentSpecularLight \x3d (ground * ambientGround + sky * ambientSky) * 0.5;\n    return enviromentSpecularLight;\n  }\n  vec3 evaluateRadianceIntegral(float firstAngle, float secondAngle, vec3 ambientGround, vec3 ambientSky, float roughness)\n  {\n    float firstAngleClamped \x3d clamp(firstAngle, 0.0, HALF_PI);\n    float secondAngleClamped \x3d clamp(secondAngle, 0.0, HALF_PI);\n    float ro \x3d roughness;\n    float intRadFirstAngle \x3d integratedRadiance(pow(cos(firstAngleClamped), 2.0), ro);\n    float intRadSecondAngle \x3d integratedRadiance(pow(cos(secondAngleClamped), 2.0), ro);\n    float ground \x3d intRadFirstAngle - integratedRadiance(1.0, ro) + integratedRadiance(0.0, ro) - intRadSecondAngle;\n    float sky \x3d intRadSecondAngle - intRadFirstAngle;\n    return ground * ambientGround + sky * ambientSky;\n  }\n  vec3 evaluateSpecularIllumination_Cone(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness, float skyIlluminationAngle)\n  {\n    float theta \x3d acos(clamp(RdotNG, -1.0, 1.0));\n    float firstPoint \x3d - HALF_PI + theta + skyIlluminationAngle;\n    float secondPoint \x3d - HALF_PI + theta - skyIlluminationAngle;\n    vec3 LeftIntegral \x3d evaluateRadianceIntegral(HALF_PI - firstPoint, HALF_PI - secondPoint, ambientGround, ambientSky, roughness);\n    vec3 RightIntegral \x3d evaluateRadianceIntegral(secondPoint - HALF_PI, firstPoint - HALF_PI, ambientGround, ambientSky, roughness);\n    vec3 enviromentSpecularLight \x3d (LeftIntegral + RightIntegral) * 0.5;\n    return enviromentSpecularLight;\n  }\n  vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n    vec3 indirectDiffuse \x3d evaluateDiffuseIllumination_Hemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n    vec3 indirectSpecular \x3d evaluateSpecularIllumination_Hemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n    vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n    vec2 dfg \x3d prefilteredDFG_Analytical(inputs.roughness, inputs.NdotV);\n    vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n    vec3 specularComponent \x3d specularColor * indirectSpecular;\n    #ifdef USE_PBR_CLEAR_COATING\n      vec3 Fc \x3d fresnelReflection(inputs.NdotV, inputs.f0_ClearCoating) * inputs.coating;\n      diffuseComponent  *\x3d 1.0 - Fc;\n      specularComponent *\x3d (1.0 - Fc) * (1.0 - Fc);\n      specularComponent +\x3d evaluateSpecularIllumination_Hemisphere(inputs.groundRadianceToClearCoat, inputs.skyRadianceToClearCoat, inputs.RdotNG, inputs.roughnessClearCoating) * Fc;\n    #endif\n    return (diffuseComponent + specularComponent);\n  }\n  float gamutMapChanel(float x, vec2 p){\n    return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n  }\n  vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n    vec3 outColor;\n    vec2 p \x3d vec2(0.02*(inputs.averageAmbientRadiance), 0.0075*(inputs.averageAmbientRadiance));\n    outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n    outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n    outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n    return outColor;\n  }\n#endif",
"quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 uv;\nvoid main(void) {\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\n  uv \x3d position * .5 + vec2(.5);\n}","sceneLighting.glsl":"#include \x3cutil/pbrUtils.glsl\x3e\nuniform vec3 lightingMainDirection;\nuniform vec3 lightingMainIntensity;\n#ifndef SH_ORDER\n  #define SH_ORDER 2\n#endif\n#if SH_ORDER \x3d\x3d 0\n  uniform vec3 lightingAmbientSH0;\n#elif SH_ORDER \x3d\x3d 1\n  uniform vec4 lightingAmbientSH_R;\n  uniform vec4 lightingAmbientSH_G;\n  uniform vec4 lightingAmbientSH_B;\n#elif SH_ORDER \x3d\x3d 2\n  uniform vec3 lightingAmbientSH0;\n  uniform vec4 lightingAmbientSH_R1;\n  uniform vec4 lightingAmbientSH_G1;\n  uniform vec4 lightingAmbientSH_B1;\n  uniform vec4 lightingAmbientSH_R2;\n  uniform vec4 lightingAmbientSH_G2;\n  uniform vec4 lightingAmbientSH_B2;\n#endif\nuniform float lightingFixedFactor;\nuniform float lightingGlobalFactor;\nuniform float ambientBoostFactor;\nconst float GROUND_REFLECTANCE \x3d 0.2;\nconst float GAMMA_SRGB \x3d 2.1;\nconst float INV_GAMMA_SRGB \x3d 0.4761904;\n#ifdef USE_PBR\n  #ifdef USE_PBR_CLEAR_COATING\n    uniform float clearCoating;\n    uniform float clearCoatRoughness;\n  #endif\n#endif\n#ifdef USE_PBR\n  vec3 calculateAmbientRadiance(float ssao)\n  {\n    vec3 ambientLight ;\n    ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n    return ambientLight *\x3d (1.0 - ssao) * skyTransmittance;\n  }\n#endif\nvec3 calculateAmbientIrradiance(vec3 normal, float ssao)\n{\n  #if SH_ORDER \x3d\x3d 0\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n  #elif SH_ORDER \x3d\x3d 1\n    vec4 sh0 \x3d vec4(\n      0.282095,\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y\n    );\n    vec3 ambientLight \x3d vec3(\n      dot(lightingAmbientSH_R, sh0),\n      dot(lightingAmbientSH_G, sh0),\n      dot(lightingAmbientSH_B, sh0)\n    );\n  #elif SH_ORDER \x3d\x3d 2\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n    vec4 sh1 \x3d vec4(\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y,\n      1.092548 * normal.x * normal.y\n    );\n    vec4 sh2 \x3d vec4(\n      1.092548 * normal.y * normal.z,\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\n      1.092548 * normal.x * normal.z,\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\n    );\n    ambientLight +\x3d vec3(\n      dot(lightingAmbientSH_R1, sh1),\n      dot(lightingAmbientSH_G1, sh1),\n      dot(lightingAmbientSH_B1, sh1)\n    );\n    ambientLight +\x3d vec3(\n      dot(lightingAmbientSH_R2, sh2),\n      dot(lightingAmbientSH_G2, sh2),\n      dot(lightingAmbientSH_B2, sh2)\n    );\n  #endif\n  ambientLight *\x3d (1.0 - ssao);\n  return ambientLight;\n}\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n  #if defined(TREE_RENDERING)\n    float minDot \x3d -0.5;\n    float dotRange \x3d 1.0 - minDot;\n    float dotNormalization \x3d 0.66;\n    float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n  #else\n    float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n  #endif\n  dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n  vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n  vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n  vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n  vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n  totalLight \x3d min(totalLight, vec3(PI, PI, PI));\n  vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n  outColor \x3d pow(outColor, vec3(1.0/GAMMA_SRGB));\n  return outColor;\n}\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\n    float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\n#else\n    float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n#endif\n  additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n}\n#ifdef USE_PBR\n  vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, float _roughness, float _metalness, vec3 _emission, float _reflectance, float additionalAmbientIrradiance)\n  {\n      vec3 viewDirection \x3d - normalize(viewDir);\n      vec3 mainLightDirection \x3d -lightingMainDirection;\n      vec3 h \x3d normalize(viewDirection + mainLightDirection);\n      PBRShadingInfo inputs;\n      inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n      inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n      inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n      inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n      inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n      inputs.LdotNG \x3d clamp(dot(normalGround, mainLightDirection), 0.001, 1.0);\n      inputs.VdotNG \x3d clamp(dot(-viewDirection, normalGround), -1.0, 1.0);\n      vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n      inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n      inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n      inputs.groundReflectance \x3d vec3(GROUND_REFLECTANCE);\n      inputs.ssao \x3d ssao;\n      inputs.roughness \x3d clamp(_roughness * _roughness, 0.001, 0.99);\n      inputs.metalness \x3d _metalness;\n      inputs.f0 \x3d (0.16 * _reflectance * _reflectance) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n      inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\n      inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      #ifdef USE_PBR_CLEAR_COATING\n        inputs.f0_ClearCoating \x3d clearCoatingFresnel;\n        inputs.f90_ClearCoating \x3d vec3(clamp(dot(inputs.f0_ClearCoating, vec3(50.0 * 0.33)), 0.0, 1.0));\n        float clearCoatRoughnessLinear \x3d mix(0.089, 0.6, clearCoatRoughness);\n        inputs.roughnessClearCoating \x3d clearCoatRoughnessLinear * clearCoatRoughnessLinear;\n        inputs.coating \x3d clearCoating;\n      #endif\n      vec3 ambientDir \x3d normalize(vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2],\n                                     - 5.0 * normalGround[0] - normalGround[2] * normalGround[1],\n                                       normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]));\n      inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n      vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n      vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n      vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n      inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      inputs.groundIrradianceToSurface \x3d inputs.groundReflectance * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n      vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n      inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n      vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n      vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n      vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight;\n      inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n      inputs.groundRadianceToSurface \x3d inputs.groundReflectance * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n      #ifdef USE_PBR_CLEAR_COATING\n      vec3 mainLightRadianceComponentClearCoat  \x3d normalDistribution(inputs.NdotH, inputs.roughnessClearCoating) * lightingMainIntensity * (1.0 - shadow);\n      vec3 horizonLightRadianceComponentClearCoat \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughnessClearCoating + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n      inputs.skyRadianceToClearCoat    \x3d  ambinetLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n      inputs.groundRadianceToClearCoat \x3d inputs.groundReflectance * (ambinetLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n      #endif\n      inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + inputs.groundReflectance[1]);\n      vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n      vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n      vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n      vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n      vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));\n  return outColor;\n  }\n#endif",
"screenSizePerspective.glsl":"float screenSizePerspectiveMinSize(float size, vec4 factor) {\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize)\n      )\n    )\n  );\n}\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}",
"shadow.glsl":"#include \x3cutil/encoding.glsl\x3e\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n  int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n  if (i \x3e\x3d num) { return .0; }\n  mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\n  vec4 lv \x3d mat * vec4(vpos, 1.0);\n  lv.xy /\x3d lv.w;\n  vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\n  if (lvpos.z \x3e\x3d 1.0) { return .0; }\n  if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) { return .0; }\n  vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n  float texSize \x3d .5 / halfPxSz;\n  vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\n  float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}",
"slice.glsl":"#ifdef SLICE\nuniform vec3 slicePlaneOrigin;\nuniform vec3 slicePlaneBasis1;\nuniform vec3 slicePlaneBasis2;\nstruct SliceFactors {\n  float front;\n  float side0;\n  float side1;\n  float side2;\n  float side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\n  vec3 rel \x3d pos - slicePlaneOrigin;\n  vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n  float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n  float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n  float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n  float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n  float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n  return SliceFactors(\n    dot(slicePlaneNormal, pos) + slicePlaneW,\n    -basis1Dot - basis1Len2,\n    basis1Dot - basis1Len2,\n    -basis2Dot - basis2Len2,\n    basis2Dot - basis2Len2\n  );\n}\nbool sliceByFactors(SliceFactors factors) {\n  return factors.front \x3c 0.0\n    \x26\x26 factors.side0 \x3c 0.0\n    \x26\x26 factors.side1 \x3c 0.0\n    \x26\x26 factors.side2 \x3c 0.0\n    \x26\x26 factors.side3 \x3c 0.0;\n}\nbool sliceByPlane(vec3 pos) {\n  return sliceByFactors(calculateSliceFactors(pos));\n}\n#ifdef EXTENSIONS_ENABLED\nvec4 applySliceHighlight(vec4 color, vec3 pos) {\n  SliceFactors factors \x3d calculateSliceFactors(pos);\n  if (sliceByFactors(factors)) {\n    return color;\n  }\n  const float HIGHLIGHT_WIDTH \x3d 1.0;\n  const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n  factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n  factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n  factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n  factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n  factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n  float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n    * (1.0 - step(0.5, factors.side0))\n    * (1.0 - step(0.5, factors.side1))\n    * (1.0 - step(0.5, factors.side2))\n    * (1.0 - step(0.5, factors.side3));\n  return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n}\n#else\n#endif\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n#ifdef SLICE_HIGHLIGHT_DISABLED\n#define highlightSlice(_color_, _pos_) (_color_)\n#else\n#define highlightSlice(_color_, _pos_) applySliceHighlight(_color_, _pos_)\n#endif\n#else\n#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n#define highlightSlice(_color_, _pos_) (_color_)\n#endif",
"transform.glsl":"vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n  return proj * (view * vec4(pos, 1.0));\n}\nvec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n  vec4 eye \x3d view * vec4(pos, 1.0);\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n  return proj * eye;\n}","visualVariables.glsl":"#if defined(VV_SIZE)\n  #define VV_CUSTOM_MODEL_MATRIX\n#endif\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  uniform vec3 vvSizeValue;\n#endif\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform mat3 vvSymbolRotationMatrix;\n#endif\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform vec3 vvSymbolAnchor;\n#endif\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n#if defined(VV_SIZE)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n  }\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return vvSizeValue;\n  }\n#endif\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n    return vec4(vvSymbolRotationMatrix * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n  }\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n    return vec4(vvSymbolRotationMatrix * normal / vvGetScale(featureAttribute), 1.0);\n  }\n#endif\n#ifdef VV_COLOR\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value \x3d featureAttribute.y;\n    if (value \x3c\x3d values[0]) {\n      return colors[0];\n    }\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n      if (values[i] \x3e\x3d value) {\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n    return colors[VV_COLOR_N - 1];\n  }\n#endif",
"vsPrecision.glsl":"precision highp float;\nprecision highp sampler2D;"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(n,a){return function(){function a(a){this.readFile=a}a.prototype.resolveIncludes=function(a){return this.resolve(a)};a.prototype.resolve=function(a,h){var d=this;void 0===h&&(h=new Map);if(h.has(a))return h.get(a);var g=this.read(a);if(!g)throw Error("cannot find shader file "+a);for(var l=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,f=l.exec(g),
c=[];null!=f;)c.push({path:f[1],start:f.index,length:f[0].length}),f=l.exec(g);var b=0,e="";c.forEach(function(c){e+=g.slice(b,c.start);e+=h.has(c.path)?"":d.resolve(c.path,h);b=c.start+c.length});e+=g.slice(b);h.set(a,e);return e};a.prototype.read=function(a){return this.readFile(a)};return a}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.glslifyDefineMap=function(a){var h="",d;for(d in a){var g=
a[d];if("boolean"===typeof g)g&&(h+="#define "+d+"\n");else if("number"===typeof g)h+="#define "+d+" "+g.toFixed()+"\n";else if("object"===typeof g){var l=g.options,f=0,c;for(c in l)h+="#define "+l[c]+" "+(f++).toFixed()+"\n";h+="#define "+d+" "+l[g.value]+"\n"}}return h};a.createProgram=function(a,h,d,g){d=d||{};g=g||"";d="function"===typeof h.shaders?h.shaders(d):h.shaders;return new m(a,g+d.vertexShader,g+d.fragmentShader,h.attributes)}})},"esri/views/webgl/Program":function(){define(["require",
"exports","../../core/has","../../core/maybe","./ShaderTranspiler"],function(n,a,m,k,h){function d(a,d){if(k.isNone(a)||a.length!==d.length)return!0;for(var f=0;f<a.length;++f)if(a[f]!==d[f])return!0;return!1}return function(){function a(d,f,c,b,e){void 0===e&&(e={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v=
{};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};d||console.error("RenderingContext isn't initialized!");0===f.length&&console.error("Shaders source should not be empty!");this._context=d;this._vertexShaderSource=f;this._fragmentShaderSource=c;if(Array.isArray(e))for(f=0;f<e.length;f++)this._defines[e[f]]="1";else this._defines=e;this._id=a._nextId++;this._locations=b;m("esri-webgl-debug")&&d.instanceCounter.incrementCount(3)}
Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),
this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(3);this._context=null}};a.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,d=a.createProgram();a.attachShader(d,
this._vShader);a.attachShader(d,this._fShader);for(var c in this._locations)a.bindAttribLocation(d,this._locations[c],c);a.linkProgram(d);m("esri-validate-shaders")&&!a.getProgramParameter(d,a.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(d,a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(d));this._glName=d;this._initialized=!0}};a.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&
(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};a.prototype.setUniform1i=function(a,d){var c=this._nameToUniform1[a];if(void 0===
c||d!==c)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),d),this._nameToUniform1[a]=d};a.prototype.setUniform1iv=function(g,f){var c=this._nameToUniform1v[g];d(c,f)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(g),f),void 0===c?this._nameToUniform1v[g]=a._arrayCopy(f):a._arrayAssign(f,c))};a.prototype.setUniform1f=function(a,d){var c=this._nameToUniform1[a];if(void 0===c||d!==c)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),
d),this._nameToUniform1[a]=d};a.prototype.setUniform1fv=function(g,f){var c=this._nameToUniform1v[g];d(c,f)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(g),f),void 0===c?this._nameToUniform1v[g]=a._arrayCopy(f):a._arrayAssign(f,c))};a.prototype.setUniform2f=function(a,d,c){var b=this._nameToUniform2[a];if(void 0===b||d!==b[0]||c!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),d,c),void 0===b?this._nameToUniform2[a]=
[d,c]:(b[0]=d,b[1]=c)};a.prototype.setUniform2fv=function(g,f){var c=this._nameToUniform2[g];d(c,f)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(g),f),void 0===c?this._nameToUniform2[g]=a._arrayCopy(f):a._arrayAssign(f,c))};a.prototype.setUniform3f=function(a,d,c,b){var e=this._nameToUniform3[a];if(void 0===e||d!==e[0]||c!==e[1]||b!==e[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),d,c,b),void 0===e?this._nameToUniform3[a]=
[d,c,b]:(e[0]=d,e[1]=c,e[2]=b)};a.prototype.setUniform3fv=function(g,f){var c=this._nameToUniform3[g];d(c,f)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(g),f),void 0===c?this._nameToUniform3[g]=a._arrayCopy(f):a._arrayAssign(f,c))};a.prototype.setUniform4f=function(a,d,c,b,e){var f=this._nameToUniform4[a];if(void 0===f||d!==f[0]||c!==f[1]||b!==f[2]||e!==f[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),d,c,b,e),void 0===
f?this._nameToUniform4[a]=[d,c,b,e]:(f[0]=d,f[1]=c,f[2]=b,f[3]=e)};a.prototype.setUniform4fv=function(g,f){var c=this._nameToUniform4[g];d(c,f)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(g),f),void 0===c?this._nameToUniform4[g]=a._arrayCopy(f):a._arrayAssign(f,c))};a.prototype.setUniformMatrix3fv=function(g,f,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix3[g],e;e=k.isNone(b)?!0:9!==b.length?d(b,f):9!==b.length||b[0]!==f[0]||b[1]!==f[1]||b[2]!==f[2]||
b[3]!==f[3]||b[4]!==f[4]||b[5]!==f[5]||b[6]!==f[6]||b[7]!==f[7]||b[8]!==f[8];e&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(g),c,f),void 0===b?this._nameToUniformMatrix3[g]=a._arrayCopy(f):a._arrayAssign(f,b))};a.prototype.setUniformMatrix4fv=function(g,f,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix4[g],e;e=k.isNone(b)?!0:16!==b.length?d(b,f):16!==b.length||b[0]!==f[0]||b[1]!==f[1]||b[2]!==f[2]||b[3]!==f[3]||b[4]!==f[4]||b[5]!==f[5]||b[6]!==
f[6]||b[7]!==f[7]||b[8]!==f[8]||b[9]!==f[9]||b[10]!==f[10]||b[11]!==f[11]||b[12]!==f[12]||b[13]!==f[13]||b[14]!==f[14]||b[15]!==f[15];e&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(g),c,f),void 0===b?this._nameToUniformMatrix4[g]=a._arrayCopy(f):a._arrayAssign(f,b))};a._padToThree=function(a){var d=a.toString();1E3>a&&(d=("  "+a).slice(-3));return d};a.prototype._addLineNumbers=function(d){var f=2;return d.replace(/\n/g,function(){return"\n"+a._padToThree(f++)+
":"})};a.prototype._loadShader=function(a){var d=35633===a,c=d?this._vertexShaderSource:this._fragmentShaderSource,b;b="";for(var e in this._defines)b+="#define "+e+" "+this._defines[e]+"\n";b+=c;"webgl2"===this._context.contextVersion&&(b=h.transpileShader(b,d?"vertex":"fragment"));d=this._context.gl;a=d.createShader(a);d.shaderSource(a,b);d.compileShader(a);m("esri-validate-shaders")&&!d.getShaderParameter(a,d.COMPILE_STATUS)&&(console.error(d.getShaderInfoLog(a)),console.error(this._addLineNumbers(b)),
"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(c)));return a};a._arrayCopy=function(a){for(var d=[],c=0;c<a.length;++c)d.push(a[c]);return d};a._arrayAssign=function(a,d){for(var c=0;c<a.length;++c)d[c]=a[c]};a._nextId=0;return a}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(n,a,m,k){function h(a){return a.map(function(c){return"eof"!==c.type?
c.data:""}).join("")}function d(a,c,b,e){e=e||b;for(var f=0;f<a.length;f++){var g=a[f];if("ident"===g.type&&g.data===b)return e in c?c[e]++:c[e]=0,d(a,c,e+"_"+c[e],e)}return b}function g(a,c,b){void 0===b&&(b="afterVersion");var d={data:"\n",type:"whitespace"},f=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},g=function(c){for(var a=-1,d=0,e=-1,f=0;f<c.length;f++){var g=c[f];"preprocessor"===g.type&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:g.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===
b||"afterPrecision"===b)&&"preprocessor"===g.type&&/^#version/.test(g.data)&&(e=Math.max(e,f));if("afterPrecision"===b&&"keyword"===g.type&&"precision"===g.data){a:{for(g=f;g<c.length;g++){var l=c[g];if("operator"===l.type&&";"===l.data)break a}g=null}if(null===g)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,g)}a<e&&0===d&&(a=f)}return a+1}(a);f(g-1)&&a.splice(g++,0,d);for(var l=0;l<c.length;l++){var h=c[l];a.splice(g++,0,h)}f(g-1)&&f(g)&&a.splice(g,0,d)}Object.defineProperty(a,
"__esModule",{value:!0});var l=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];a.transpileShader=function(a,c){a=k(a);var b;a:{b="100";var e="300 es";void 0===b&&(b="100");void 0===e&&(e="300 es");for(var f=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,q=0;q<a.length;q++){var r=a[q];if("preprocessor"===r.type){var w=f.exec(r.data);if(w){f=w[1].replace(/\s\s+/g," ");if(f===e){b=f;break a}if(f===b){r.data="#version "+e;break a}throw Error("unknown glsl version: "+
f);}}}a.splice(0,0,{type:"preprocessor",data:"#version "+e},{type:"whitespace",data:"\n"});b=null}if("300 es"===b)throw Error("shader is already glsl 300 es");f=r=null;q={};w={};for(b=0;b<a.length;++b)switch(e=a[b],e.type){case "keyword":"vertex"===c&&"attribute"===e.data?e.data="in":"varying"===e.data&&(e.data="vertex"===c?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(e.data.trim())&&(e.data=e.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===c&&"gl_FragColor"===
e.data){if(!r){var r=d(a,q,"fragColor"),u=void 0;void 0===u&&(u="lowp");g(a,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:r},{type:"operator",data:";"}],"afterPrecision")}e.data=r}else"fragment"===c&&"gl_FragDepthEXT"===e.data&&(f||(f=d(a,q,"gl_FragDepth")),e.data=f);break;case "ident":if(0<=m.indexOf(e.data)){if(u="vertex"===c)a:{for(u=b-1;0<=u;u--){var v=
a[u];if("whitespace"!==v.type&&"block-comment"!==v.type)if("keyword"===v.type){if("attribute"===v.data||"in"===v.data){u=!0;break a}}else break}u=!1}if(u)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");e.data in w||(w[e.data]=d(a,q,e.data));e.data=w[e.data]}}for(b=a.length-1;0<=b;--b)e=a[b],"preprocessor"===e.type&&((c=e.data.match(/\#extension\s+(.*)\:/))&&c[1]&&0<=l.indexOf(c[1].trim())&&(c=a[b+1],a.splice(b,c&&"whitespace"===c.type?2:1)),(c=e.data.match(/\#ifdef\s+(.*)/))&&
c[1]&&0<=l.indexOf(c[1].trim())&&(e.data="#if 1"),(c=e.data.match(/\#ifndef\s+(.*)/))&&c[1]&&0<=l.indexOf(c[1].trim())&&(e.data="#if 0"));return h(a)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(n,a){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(n){"use strict;";return function(a){var m=n(),k=[],k=k.concat(m(a));return k=k.concat(m(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(n,a,m){"use strict;";var k="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function h(b){b.length&&v.push({type:k[q],
data:b,position:x,line:y,column:t})}function d(){u=u.length?[]:u;if("/"===w&&"*"===r)return x=p+e-1,q=0,w=r,e+1;if("/"===w&&"/"===r)return x=p+e-1,q=1,w=r,e+1;if("#"===r)return q=2,x=p+e,e;if(/\s/.test(r))return q=9,x=p+e,e;z=/\d/.test(r);A=/[^\w_]/.test(r);x=p+e;q=z?4:A?3:9999;return e}function g(){if(("\r"===r||"\n"===r)&&"\\"!==w)return h(u.join("")),q=999,e;u.push(r);w=r;return e+1}function l(){if("."===w&&/\d/.test(r))return q=5,e;if("/"===w&&"*"===r)return q=0,e;if("/"===w&&"/"===r)return q=
1,e;if("."===r&&u.length){for(;f(u););q=5;return e}if(";"===r||")"===r||"("===r){if(u.length)for(;f(u););h(r);q=999;return e+1}var b=2===u.length&&"\x3d"!==r;if(/[\w_\d\s]/.test(r)||b){for(;f(u););q=999;return e}u.push(r);w=r;return e+1}function f(b){var c=0,d,e;do{d=a.indexOf(b.slice(0,b.length+c).join(""));e=a[d];if(-1===d){if(0<c--+b.length)continue;e=b.slice(0,1).join("")}h(e);x+=e.length;u=u.slice(e.length);return u.length}while(1)}function c(){if("."===r||/[eE]/.test(r))return u.push(r),q=5,
w=r,e+1;if("x"===r&&1===u.length&&"0"===u[0])return q=11,u.push(r),w=r,e+1;if(/[^\d]/.test(r))return h(u.join("")),q=999,e;u.push(r);w=r;return e+1}function b(){"f"===r&&(u.push(r),w=r,e+=1);if(/[eE]/.test(r)||"-"===r&&/[eE]/.test(w))return u.push(r),w=r,e+1;if(/[^\d]/.test(r))return h(u.join("")),q=999,e;u.push(r);w=r;return e+1}var e=0,p=0,q=999,r,w,u=[],v=[],y=1,t=0,x=0,z=!1,A=!1,E="",B;return function(a){v=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;e=0;E+=a;for(B=E.length;r=E[e],e<
B;){a=e;switch(q){case 0:"/"===r&&"*"===w?(u.push(r),h(u.join("")),q=999):(u.push(r),w=r);e+=1;break;case 1:e=g();break;case 2:e=g();break;case 3:e=l();break;case 4:e=c();break;case 11:/[^a-fA-F0-9]/.test(r)?(h(u.join("")),q=999):(u.push(r),w=r,e+=1);break;case 5:e=b();break;case 9999:if(/[^\d\w_]/.test(r)){var f=u.join("");q=-1<n.indexOf(f)?8:-1<m.indexOf(f)?7:6;h(u.join(""));q=999}else u.push(r),w=r,e+=1;break;case 9:/[^\s]/g.test(r)?(h(u.join("")),q=999):(u.push(r),w=r,e+=1);break;case 999:e=d()}if(a!==
e)switch(E[a]){case "\n":t=0;++y;break;default:++t}}p+=e;E=E.slice(e);return v}u.length&&h(u.join(""));q=10;h("(eof)");return v}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../../core/typedArrayUtil"],function(n,a,m,k){return function(){function a(d,g,l,f,c){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=d;this._bufferType=g;this._usage=l;this._id=a._nextId++;this._glName=this._context.gl.createBuffer();m("esri-webgl-debug")&&d.instanceCounter.incrementCount(1);f&&this.setData(f,c)}a.createIndex=function(d,
g,l,f){return new a(d,34963,g,l,f)};a.createVertex=function(d,g,l){return new a(d,34962,g,l)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usage",{get:function(){return this._usage},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._glName&&
(this._context.gl.deleteBuffer(this._glName),this._glName=null),m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(1),this._context=null)};a.prototype.setData=function(a,g){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&g)switch(this._indexType=g,this._size=a,g){case 5123:a*=2;break;case 5125:a*=4}}else g=a.byteLength,k.isUint16Array(a)&&(g/=2,this._indexType=5123),k.isUint32Array(a)&&(g/=4,this._indexType=5125),this._size=
g;g=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(g)}};a.prototype.setSubData=function(a,g,l,f){void 0===g&&(g=0);void 0===l&&(l=0);if(a){(0>g||g>=this._size)&&console.error("offset is out of range!");var c=g,b=l,d=f,p=a.byteLength;k.isUint16Array(a)&&(p/=2,c*=2,b*=2,d*=2);k.isUint32Array(a)&&(p/=4,c*=4,b*=4,d*=4);void 0===f&&(f=p-1);l>=f&&console.error("end must be bigger than start!");
g+l-f>this._size&&console.error("An attempt to write beyond the end of the buffer!");g=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);l=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;l.bufferSubData(this._bufferType,c,a.slice(b,d));this._context.bindVAO(g)}};a._nextId=0;return a}()})},"esri/views/webgl/renderState":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(n,a,m){function k(b){return x.intern(b)}function h(b){return z.intern(b)}
function d(b){return A.intern(b)}function g(b){return E.intern(b)}function l(b){return B.intern(b)}function f(b){return G.intern(b)}function c(b){return F.intern(b)}function b(b){return K.intern(b)}function e(b){return"["+b.join(",")+"]"}function p(b){return b?e([b.srcRgb,b.srcAlpha,b.dstRgb,b.dstAlpha,b.opRgb,b.opAlpha,b.color.r,b.color.g,b.color.b,b.color.a]):null}function q(b){return b?e([b.face,b.mode]):null}function r(b){return b?e([b.factor,b.units]):null}function w(b){return b?e([b.func]):
null}function u(b){return b?e([b.function.func,b.function.ref,b.function.mask,b.operation.fail,b.operation.zFail,b.operation.zPass]):null}function v(b){return b?e([b.zNear,b.zFar]):null}function y(b){return b?e([b.r,b.g,b.b,b.a]):null}function t(b){return b?e([b.mask]):null}Object.defineProperty(a,"__esModule",{value:!0});a.simpleBlendingParams=function(b,c,a,d){void 0===a&&(a=32774);void 0===d&&(d=[0,0,0,0]);return{srcRgb:b,srcAlpha:b,dstRgb:c,dstAlpha:c,opRgb:a,opAlpha:a,color:{r:d[0],g:d[1],b:d[2],
a:d[3]}}};a.separateBlendingParams=function(b,c,a,d,e,f,g){void 0===e&&(e=32774);void 0===f&&(f=32774);void 0===g&&(g=[0,0,0,0]);return{srcRgb:b,srcAlpha:c,dstRgb:a,dstAlpha:d,opRgb:e,opAlpha:f,color:{r:g[0],g:g[1],b:g[2],a:g[3]}}};a.backFaceCullingParams={face:1029,mode:2305};a.defaultDepthWriteParams={zNear:0,zFar:1};a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.makeBlending=k;a.makeCulling=h;a.makePolygonOffset=d;a.makeDepthTest=g;a.makeStencilTest=l;a.makeDepthWrite=f;a.makeColorWrite=c;a.makeStencilWrite=
b;a.makePipelineState=function(b){return H.intern(b)};n=function(){function b(b,c){this.makeKey=b;this.makeRef=c;this.interns=new Map}b.prototype.intern=function(b){if(!b)return null;var c=this.makeKey(b),a=this.interns;a.has(c)||a.set(c,this.makeRef(b));return a.get(c)};return b}();var x=new n(p,function(b){return m({__tag:"Blending"},b)}),z=new n(q,function(b){return m({__tag:"Culling"},b)}),A=new n(r,function(b){return m({__tag:"PolygonOffset"},b)}),E=new n(w,function(b){return m({__tag:"DepthTest"},
b)}),B=new n(u,function(b){return m({__tag:"StencilTest"},b)}),G=new n(v,function(b){return m({__tag:"DepthWrite"},b)}),F=new n(y,function(b){return m({__tag:"ColorWrite"},b)}),K=new n(t,function(b){return m({__tag:"StencilWrite"},b)}),H=new n(function(b){return b?e([p(b.blending),q(b.culling),r(b.polygonOffset),w(b.depthTest),u(b.stencilTest),v(b.depthWrite),y(b.colorWrite),t(b.stencilWrite)]):null},function(a){return{blending:k(a.blending),culling:h(a.culling),polygonOffset:d(a.polygonOffset),depthTest:g(a.depthTest),
stencilTest:l(a.stencilTest),depthWrite:f(a.depthWrite),colorWrite:c(a.colorWrite),stencilWrite:b(a.stencilWrite)}});n=function(){function b(b){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=b}b.prototype.setPipeline=function(b){if(this._pipelineInvalid||b!==this._pipeline)this.setBlending(b.blending),this.setCulling(b.culling),
this.setPolygonOffset(b.polygonOffset),this.setDepthTest(b.depthTest),this.setStencilTest(b.stencilTest),this.setDepthWrite(b.depthWrite),this.setColorWrite(b.colorWrite),this.setStencilWrite(b.stencilWrite),this._pipeline=b;this._pipelineInvalid=!1};b.prototype.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};b.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};b.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=
!0};b.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};b.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};b.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};b.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};b.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};b.prototype.setBlending=
function(b){this._blending=this.setSubState(b,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};b.prototype.setCulling=function(b){this._culling=this.setSubState(b,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};b.prototype.setPolygonOffset=function(b){this._polygonOffset=this.setSubState(b,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};b.prototype.setDepthTest=
function(b){this._depthTest=this.setSubState(b,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};b.prototype.setStencilTest=function(b){this._stencilTest=this.setSubState(b,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};b.prototype.setDepthWrite=function(b){this._depthWrite=this.setSubState(b,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=
!1};b.prototype.setColorWrite=function(b){this._colorWrite=this.setSubState(b,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};b.prototype.setStencilWrite=function(b){this._stencilWrite=this.setSubState(b,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};b.prototype.setSubState=function(b,c,a,d){if(a||b!==c)d(b),this._pipelineInvalid=!0;return b};return b}();a.StateTracker=n})},"esri/views/webgl/Texture":function(){define(["require",
"exports","../../core/has","../../core/mathUtils"],function(n,a,m,k){return function(){function a(d,g,l){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=d;this._desc={pixelFormat:g.pixelFormat,internalFormat:g.internalFormat,dataType:g.dataType,target:g.target?g.target:3553,samplingMode:g.samplingMode?g.samplingMode:9729,wrapMode:g.wrapMode?g.wrapMode:10497,maxAnisotropy:g.maxAnisotropy,flipped:void 0!==
g.flipped?g.flipped:!1,hasMipmap:void 0!==g.hasMipmap?g.hasMipmap:!1,unpackAlignment:g.unpackAlignment?g.unpackAlignment:4,width:g.width,height:g.height,preMultiplyAlpha:void 0!==g.preMultiplyAlpha?g.preMultiplyAlpha:!1,textureCoordinateScaleFactor:g.textureCoordinateScaleFactor||null};this._id=++a._nextId;m("esri-webgl-debug")&&d.instanceCounter.incrementCount(0);this.setData(l)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});a.prototype.dispose=function(){var a=this;if(this._context&&this._context.gl){if(this._glName){var g=this._context.gl;this._boundToUnits.forEach(function(d){a._context.bindTexture(null,d)});g.deleteTexture(this._glName);this._glName=null}m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0);
this._context=null}};a.prototype.release=function(){this.dispose()};a.prototype.resize=function(a,g){var d=this._desc;if(d.width!==a||d.height!==g)d.width=a,d.height=g,this.setData(null)};a.prototype.setData=function(d){var g=this._context.gl;this._glName||(this._glName=g.createTexture());void 0===d&&(d=null);null===d&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var l=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var f=this._desc;a._validateTexture(f);
g.pixelStorei(g.UNPACK_ALIGNMENT,f.unpackAlignment);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,f.flipped?1:0);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.preMultiplyAlpha?1:0);var c=f.pixelFormat,b=f.internalFormat?f.internalFormat:c;if(d instanceof ImageData||d instanceof HTMLImageElement||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement)f.width&&f.height&&console.assert(d.width===f.width&&d.height===f.height),g.texImage2D(g.TEXTURE_2D,0,b,c,f.dataType,d),f.hasMipmap&&this.generateMipmap(),
void 0===this._desc.width&&(this._desc.width=d.width),void 0===this._desc.height&&(this._desc.height=d.height);else{null!=f.width&&null!=f.height||console.error("Width and height must be specified!");g.DEPTH24_STENCIL8&&b===g.DEPTH_STENCIL&&(b=g.DEPTH24_STENCIL8);var e=f.width,p=f.height;if(null!=d&&"type"in d&&"compressed"===d.type){c=Math.round(Math.log(Math.max(e,p))/Math.LN2)+1;f.hasMipmap=f.hasMipmap&&c===d.levels.length;for(var q=0;;++q){g.compressedTexImage2D(g.TEXTURE_2D,q,b,e,p,0,d.levels[Math.min(q,
d.levels.length-1)]);if(1===e&&1===p||!f.hasMipmap)break;e=Math.max(1,e>>1);p=Math.max(1,p>>1)}}else if(d)g.texImage2D(g.TEXTURE_2D,0,b,e,p,0,c,f.dataType,d),f.hasMipmap&&this.generateMipmap();else for(q=0;;++q){g.texImage2D(g.TEXTURE_2D,q,b,e,p,0,c,f.dataType,null);if(1===e&&1===p||!f.hasMipmap)break;e=Math.max(1,e>>1);p=Math.max(1,p>>1)}}a._applySamplingMode(g,this._desc);a._applyWrapMode(g,this._desc);a._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(l,
0)};a.prototype.updateData=function(a,g,l,f,c,b){b||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var d=this._context.gl,p=this._desc,q=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>g||0>l||f>p.width||c>p.height||g+f>p.width||l+c>p.height)&&console.error("An attempt to update out of bounds of the texture!");d.pixelStorei(d.UNPACK_ALIGNMENT,p.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,
p.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p.preMultiplyAlpha?1:0);b instanceof ImageData||b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement?(console.assert(b.width===f&&b.height===c),d.texSubImage2D(d.TEXTURE_2D,a,g,l,p.pixelFormat,p.dataType,b)):d.texSubImage2D(d.TEXTURE_2D,a,g,l,f,c,p.pixelFormat,p.dataType,b);this._context.bindTexture(q,0)};a.prototype.generateMipmap=function(){var d=this._desc;d.hasMipmap||(d.hasMipmap=!0,a._validateTexture(d));
9729===d.samplingMode?(this._samplingModeDirty=!0,d.samplingMode=9985):9728===d.samplingMode&&(this._samplingModeDirty=!0,d.samplingMode=9984);d=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var g=this._context.gl;g.generateMipmap(g.TEXTURE_2D);this._context.bindTexture(d,0)};a.prototype.setSamplingMode=function(d){d!==this._desc.samplingMode&&(this._desc.samplingMode=d,a._validateTexture(this._desc),this._samplingModeDirty=!0)};a.prototype.setWrapMode=function(d){d!==this._desc.wrapMode&&
(this._desc.wrapMode=d,a._validateTexture(this._desc),this._wrapModeDirty=!0)};a.prototype.applyChanges=function(){var d=this._context.gl,g=this._desc;this._samplingModeDirty&&(a._applySamplingMode(d,g),this._samplingModeDirty=!1);this._wrapModeDirty&&(a._applyWrapMode(d,g),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,g){g?this._boundToUnits.add(a):this._boundToUnits.delete(a)};a._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");
k.isPowerOfTwo(a.width)&&k.isPowerOfTwo(a.height)||("number"===typeof a.wrapMode?33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===a.wrapMode.s&&33071===a.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};a._applySamplingMode=function(a,g){var d=g.samplingMode,f=g.samplingMode;if(9985===d||9987===d)d=9729,g.hasMipmap||
(f=9729);else if(9984===d||9986===d)d=9728,g.hasMipmap||(f=9728);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,f)};a._applyWrapMode=function(a,g){"number"===typeof g.wrapMode?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,g.wrapMode),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,g.wrapMode)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,g.wrapMode.s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,g.wrapMode.t))};a._applyAnisotropicFilteringParameters=
function(a,g){if(null!=g.maxAnisotropy){var d=a.capabilities.textureFilterAnisotropic;d&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,d.TEXTURE_MAX_ANISOTROPY,g.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],function(n,a,m,k){function h(a){return a[0].stride}function d(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;
case 5121:return 1;default:throw Error("Unknown data type");}}function g(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:k.neverReached(a)}return 0}function l(a){if(!a)return 0;if("colorAttachment"in a)return a.glName?
l(a.colorAttachment)+l(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?l(a.descriptor):0;var c=a.internalFormat||"pixelFormat"in a&&a.pixelFormat;if(!c)return 0;var b="hasMipmap"in a&&a.hasMipmap?1.3:1;a=a.width*a.height;return g(c)*a*b}Object.defineProperty(a,"__esModule",{value:!0});a.vertexCount=function(a,c){return a.vertexBuffers[c].size/h(a.layout[c])};a.getStride=h;a.getBytesPerElement=d;a.addDescriptor=function(a,c,b,e,g,l){var f=d(e);if(0<a.length){var p=a[0].stride,q=p+f*
b;a.forEach(function(b){return b.stride=q});a.push({name:c,count:b,type:e,offset:p,stride:q,normalized:g,divisor:l})}else a.push({name:c,count:b,type:e,offset:0,stride:f*b,normalized:g,divisor:l})};a.assertCompatibleVertexAttributeLocations=function(a,c){(a=a.locations===c.locations)||console.error("VertexAttributeLocations are incompatible");return a};a.hasAttribute=function(a,c){for(var b=0;b<a.length;b++)if(a[b].name===c)return!0;return!1};a.findAttribute=function(a,c){for(var b=0;b<a.length;b++)if(a[b].name===
c)return a[b];return null};a.copyFramebufferToTexture=function(a,c,b,d,g){void 0===g&&(g=0);var e=a.getBoundFramebufferObject(),f=a.getBoundTexture(0);a.bindFramebuffer(c);a.bindTexture(b,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,g,b.descriptor.pixelFormat,d[0],d[1],d[2],d[3],0);a.gl.flush();a.bindFramebuffer(e);a.bindTexture(f,0)};a.setBaseInstanceOffset=function(a,c){var b={},d;for(d in a)b[d]=a[d].map(function(b){return b.divisor?m({},b,{baseInstance:c}):b});return b};a.bindVertexBufferLayout=function(a,
c,b,d,g){var e=a.gl,f=a.capabilities.instancing;a.bindBuffer(b);for(a=0;a<d.length;a++){b=d[a];var l=c[b.name],p=(g?g:0+b.baseInstance?b.baseInstance:0)*b.stride;void 0===l&&console.error("There is no location for vertex attribute '"+b.name+"' defined.");b.baseInstance&&!b.divisor&&console.error("Vertex attribute '"+b.name+"' uses baseInstanceOffset without divisor.");if(4>=b.count)e.vertexAttribPointer(l,b.count,b.type,b.normalized,b.stride,b.offset+p),e.enableVertexAttribArray(l),b.divisor&&0<b.divisor&&
f&&f.vertexAttribDivisor(l,b.divisor);else if(9===b.count)for(var h=0;3>h;h++)e.vertexAttribPointer(l+h,3,b.type,b.normalized,b.stride,b.offset+12*h+p),e.enableVertexAttribArray(l+h),b.divisor&&0<b.divisor&&f&&f.vertexAttribDivisor(l+h,b.divisor);else if(16===b.count)for(h=0;4>h;h++)e.vertexAttribPointer(l+h,4,b.type,b.normalized,b.stride,b.offset+16*h+p),e.enableVertexAttribArray(l+h),b.divisor&&0<b.divisor&&f&&f.vertexAttribDivisor(l+h,b.divisor);else console.error("Unsupported vertex attribute element count: "+
b.count)}};a.unbindVertexBufferLayout=function(a,c,b,d){var e=a.gl,f=a.capabilities.instancing;a.bindBuffer(b);for(b=0;b<d.length;b++){var g=d[b],l=c[g.name];if(4>=g.count)e.disableVertexAttribArray(l),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(l,0);else if(9===g.count)for(var h=0;3>h;h++)e.disableVertexAttribArray(l+h),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(l+h,0);else if(16===g.count)for(h=0;4>h;h++)e.disableVertexAttribArray(l+h),g.divisor&&0<g.divisor&&f&&f.vertexAttribDivisor(l+
h,0);else console.error("Unsupported vertex attribute element count: "+g.count)}a.unbindBuffer(34962)};a.getBytesPerElementFormat=g;a.getGpuMemoryUsage=l})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(n,a,m,k){return function(){function a(d,g,l,f,c){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=d;this._layout=l;this._buffers=f;this._locations=
g;c&&(this._indexBuffer=c);this._id=a._nextId++;m("esri-webgl-debug")&&d.instanceCounter.incrementCount(2)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexBuffer",{get:function(){return this._indexBuffer},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(d,l){return d+a._buffers[l].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.dispose=
function(a){void 0===a&&(a=!0);if(this._context){var d=this._context.capabilities.vao;d&&this._glName&&(d.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var l in this._buffers)this._buffers[l].dispose(),delete this._buffers[l];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(2);this._context=null}};a.prototype.initialize=function(){if(!this._initialized){var a=
this._context.capabilities.vao;if(a){var g=a.createVertexArray();a.bindVertexArray(g);this._bindLayout();a.bindVertexArray(null);this._glName=g}this._initialized=!0}};a.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};a.prototype._bindLayout=function(){var a=this._buffers,g=!!this._context.capabilities.vao,l=this._layout,f=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");
var c=this._context.gl,b;for(b in a){var e=a[b];e||console.error("Vertex buffer is uninitialized!");var p=l[b];p||console.error("Vertex element descriptor is empty!");k.bindVertexBufferLayout(this._context,this._locations,e,p)}f&&(g?c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,f.glName):this._context.bindBuffer(f))};a.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};a.prototype._unbindLayout=function(){var a=this._buffers,g=
this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var l in a){var f=a[l];f||console.error("Vertex buffer is uninitialized!");k.unbindVertexBufferLayout(this._context,this._locations,f,g[l])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};a._nextId=0;return a}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Handles ../../../core/watchUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./atmosphereUtils ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/RealisticAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(b){this._view=b;this.canRender=!0;this._skyslot=13;this._hazeSlot=14;this._renderData={texDepth:l.vec2f64.create(),cameraPosition:c.vec3f64.create(),cameraUp:c.vec3f64.create(),cameraRight:c.vec3f64.create(),cameraDir:c.vec3f64.create(),halfSizeNearPlane:l.vec2f64.create(),cameraCenterOffset:l.vec2f64.create(),sphereComp:e.vec4f64.create(),atmosParams1:e.vec4f64.create(),
atmosParams2:e.vec4f64.create(),atmosParams3:c.vec3f64.create(),invWavelength:A,invWavelengthScaled:E,radii:l.vec2f64.create(),scale:0,scaleDepth:B,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:G,oneOverScaleDepthBlue:K,scaleOverScaleDepthBlue:0,g:H,g2:H*H,miePhaseCoefficients:N,nearFar:l.vec2f64.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=q.earthRadius;this._updateRadius(q.earthRadius)}
a.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._vao&&(this._vao.dispose(),this._vao=null)};a.prototype.when=function(b){return k(this,void 0,void 0,function(){return m(this,function(a){b();return[2]})})};a.prototype.initializeRenderContext=function(b){var a=this;b=b.rctx;this._handles=new h;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,
tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(d.on(this._view,"basemapTerrain","elevation-change",function(b){return a._updateElevation(b)},function(){return a._updateElevation()}));this._handles.add(d.on(this._view,"basemapTerrain","elevation-bounds-change",function(){return a._updateVisibleElevationBounds()},function(){return a._updateVisibleElevationBounds()}));this._hazeProgram=y.createProgram(b,u.program,
{haze:!0});this._skyProgram=y.createProgram(b,u.program);this._hazePipelineState=t.makePipelineState({blending:t.separateBlendingParams(1,0,769,1),colorWrite:t.defaultColorWriteParams});this._skyPipelineState=t.makePipelineState({blending:t.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:t.defaultColorWriteParams});this._vao=this._createVertexArrayObject(b)};a.prototype.uninitializeRenderContext=function(b){this.destroy()};a.prototype.render=function(b){if(b.slot!==this._hazeSlot&&
b.slot!==this._skyslot||0!==b.pass)return!1;this._update(b.camera);b.slot===this._skyslot&&this._renderSky(b);b.slot===this._hazeSlot&&this._renderHaze(b);return!0};a.prototype._renderSky=function(b){var a=b.rctx,c=this._skyProgram;a.bindProgram(c);a.setPipelineState(this._skyPipelineState);c.setUniform3fv("atmosParams3",this._renderData.atmosParams3);this._renderCommon(c,b)};a.prototype._renderHaze=function(b){var a=this,c=b.rctx,d=b.offscreenRenderingHelper,e=this._hazeProgram;c.bindProgram(e);
c.setPipelineState(this._hazePipelineState);d.renderDepthDetached(function(){c.bindTexture(d.depthTexture,0);e.setUniform1i("depthTex",0);a._renderCommon(e,b)})};a.prototype._renderCommon=function(b,a){var c=a.rctx;b.setUniform3fv("invWavelength",this._renderData.invWavelength);b.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);a.scenelightingData.setLightDirectionUniform(b);b.setUniform4fv("sphereComp",this._renderData.sphereComp);b.setUniform3fv("cameraPosition",this._renderData.cameraPosition);
b.setUniform3fv("cameraUp",this._renderData.cameraUp);b.setUniform3fv("cameraRight",this._renderData.cameraRight);b.setUniform3fv("cameraDir",this._renderData.cameraDir);b.setUniform2fv("nearFar",this._renderData.nearFar);b.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);b.setUniform2fv("cameraCenterOffset",this._renderData.cameraCenterOffset);b.setUniform2fv("radii",this._renderData.radii);b.setUniform4fv("atmosParams1",this._renderData.atmosParams1);b.setUniform4fv("atmosParams2",
this._renderData.atmosParams2);b.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);b.setUniform1f("altitudeFade",this._renderData.altitudeFade);c.bindVAO(this._vao);x.assertCompatibleVertexAttributeLocations(this._vao,b);c.drawArrays(5,0,4)};a.prototype._createVertexArrayObject=function(b){var a=I.createBuffer(4);a.position.setVec(0,[-1,-1,1]);a.position.setVec(1,[1,-1,1]);a.position.setVec(2,[-1,1,1]);a.position.setVec(3,[1,1,1]);a.uv0.setVec(0,[0,0]);a.uv0.setVec(1,[1,0]);a.uv0.setVec(2,
[0,1]);a.uv0.setVec(3,[1,1]);return new z(b,u.program.attributes,{geometry:r.glLayout(I)},{geometry:v.createVertex(b,35044,a.buffer)})};a.prototype._adjustRadiusForTesselation=function(b){return b*Math.cos(Math.PI/Math.pow(2,4)/16)};a.prototype._updateElevation=function(b){b=b?b.tile:this._view.basemapTerrain.rootTiles[0];0===b.lij[0]&&(b=this._adjustRadiusForTesselation(q.earthRadius+b.elevationBounds[0]),b!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=b,this._earthRadius=-1,
this._updateVisibleElevationBounds()))};a.prototype._updateVisibleElevationBounds=function(){var b=this._adjustRadiusForTesselation(q.earthRadius+this._view.basemapTerrain.elevationBounds.min);(0>this._earthRadius||b<this._earthRadius)&&this._updateRadius(b)};a.prototype._updateRadius=function(a){this._earthRadius=a;var c=a/10*10.25,d=1/(c-a),e=d/B,l=d/G,q=.3*(c-a)+a,h=this._renderData;b.vec4.set(h.atmosParams1,d,B,e,F);b.vec4.set(h.atmosParams2,H,G,l,K);f.vec3.set(h.atmosParams3,H*H,N,q);g.vec2.set(h.radii,
a,c);h.scale=d;h.lowerAlphaBlendBound=q;h.scaleOverScaleDepth=e;h.scaleOverScaleDepthBlue=l;c=p.INNER_ATMOSPHERE_DEPTH;h.innerFadeDistance=2*Math.sqrt((2*a-c)*c)};a.prototype._update=function(b){b&&(f.vec3.negate(this._renderData.cameraDir,b.viewForward),f.vec3.copy(this._renderData.cameraUp,b.viewUp),f.vec3.copy(this._renderData.cameraRight,b.viewRight),this._renderData.cameraHeight=f.vec3.length(b.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=
this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.sphereComp=e.vec4f64.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,this._renderData.C,this._renderData.CSur),f.vec3.copy(this._renderData.cameraPosition,b.eye),g.vec2.set(this._renderData.halfSizeNearPlane,Math.tan(b.fovX/2)/(b.width/b.fullWidth),Math.tan(b.fovY/2)/(b.height/
b.fullHeight)),g.vec2.set(this._renderData.cameraCenterOffset,(b.padding[3]+b.width/2)/b.fullWidth-.5,(b.padding[2]+b.height/2)/b.fullHeight-.5),g.vec2.set(this._renderData.nearFar,b.near,b.far),this._renderData.altitudeFade=p.computeInnerAltitudeFade(this._renderData.cameraHeight-this._earthRadius))};a.isSupported=function(b){return b.rctx.capabilities.depthTexture};return a}();a.RealisticAtmosphere=n;a=.02*Math.PI;n=.004*Math.PI;var A=c.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,
4)),E=c.vec3f64.clone(A);f.vec3.scale(E,E,a);f.vec3.add(E,E,c.vec3f64.fromValues(n,n,n));var B=.25,G=.05,F=1/B,K=1/G,H=-.99999,N=(1-H*H)/(2+H*H)*1.5,I=w.newLayout().vec3f("position").vec2f("uv0")})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.computeInnerAltitudeFade=function(a){return Math.min(1,Math.max(0,(a-1E5)/9E5))};a.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/webgl-engine/shaders/RealisticAtmospherePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});a.program={name:"realistic-atmosphere-color",shaders:function(a){return{vertexShader:h.glslifyDefineMap({HAZE:a.haze})+k.resolveIncludes("environment/realisticAtmosphere.vert"),fragmentShader:h.glslifyDefineMap({HAZE:a.haze})+k.resolveIncludes("environment/realisticAtmosphere.frag")}},attributes:m.Default3D}})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/mathUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N){function I(b,a,c,d,e){var f=p.vec3.length(b),g=d*Math.sqrt(f*f-d*d)/f,l=e.silCircleV1,h=e.silCircleV2;p.vec3.scale(e.silCircleCenter,b,Math.sqrt(d*d-g*g)/f);p.vec3.cross(l,b,a);1>p.vec3.squaredLength(l)&&p.vec3.cross(l,b,c);p.vec3.scale(l,l,g/p.vec3.length(l));p.vec3.cross(h,l,b);p.vec3.scale(h,h,g/p.vec3.length(h));return g}function J(b,a,c,d){p.vec3.add(P,d.silCircleCenter,d.silCircleV2);p.vec3.scale(V,P,O);f.mat4.lookAt(U,a,
P,c);A.project(P,U,b.projectionMatrix,b.viewport);A.project(V,U,b.projectionMatrix,b.viewport);return p.vec3.distance(P,V)/b.height}var M=-r.INNER_ATMOSPHERE_DEPTH,L=(u.earthRadius+M)/u.earthRadius,R=(u.earthRadius+0)/u.earthRadius,O=(u.earthRadius+3E5)/u.earthRadius,T=y.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);n=function(){function a(b){this.slot=13;this._renderData={texV:e.vec2f64.create(),silCircleCenter:q.vec3f64.create(),silCircleV1:q.vec3f64.create(),
silCircleV2:q.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=g.createResolver();this._readyController=g.createAbortController();this.view=b}Object.defineProperty(a.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});a.prototype.when=function(b){return k(this,void 0,void 0,function(){return m(this,function(a){switch(a.label){case 0:return[4,this._readyResolver.promise];case 1:return a.sent(),
b(),[2]}})})};a.prototype.initializeRenderContext=function(b){var a=this,c=b.rctx;this._cameraChangeHandle=l.init(this.view,"state.camera",function(){return b.requestRender()},!0);this._program=G.createProgram(c,E.colorPass);this._fadeProgram=G.createProgram(c,E.fadePass);this._vao=this._createRibbon(c);this._vaoCount=H.vertexCount(this._vao,"geometry");this._fadeVao=z.createQuadVAO(c);this._fadeVaoCount=H.vertexCount(this._fadeVao,"geometry");v.requestImage(w,{signal:this._readyController.signal}).then(function(d){a._texture=
new K(c,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},d);b.requestRender();a._readyController=null;a._readyResolver.resolve()});this._pipelineState=F.makePipelineState({blending:F.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:F.defaultColorWriteParams})};a.prototype.uninitializeRenderContext=function(b){this.destroy()};a.prototype.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=
null);this._texture&&(this._texture.dispose(),this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};a.prototype.render=function(b){if(b.slot!==this.slot||0!==b.pass)return!1;this._update(b.camera);var a=b.rctx;a.setPipelineState(this._pipelineState);if(1>this._renderData.undergroundFadeAlpha){var c=
this._program;a.bindProgram(c);c.setUniformMatrix4fv("proj",b.camera.projectionMatrix);c.setUniformMatrix4fv("view",b.camera.viewMatrix);c.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);c.setUniform3fv("silCircleV1",this._renderData.silCircleV1);c.setUniform3fv("silCircleV2",this._renderData.silCircleV2);c.setUniform2fv("texV",this._renderData.texV);a.bindTexture(this._texture,0);c.setUniform1i("tex",0);b.scenelightingData.setLightDirectionUniform(c);c.setUniform1f("altitudeFade",
this._renderData.altitudeFade);c.setUniform1f("innerScale",this._renderData.innerScale);a.bindVAO(this._vao);a.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(c=this._fadeProgram,a.bindProgram(c),c.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),b.scenelightingData.setLightDirectionUniform(c),c.setUniform3fv("cameraPosition",b.camera.eye),a.bindVAO(this._fadeVao),a.drawArrays(5,0,this._fadeVaoCount));return!0};a.prototype._update=function(a){var c=
q.vec3f64.create(),e=u.earthRadius,f=p.vec3.length(a.eye),g=f-e;this._renderData.undergroundFadeAlpha=0>g?Math.min(-g/5E3,1):0;var l=e+M,k=e+Math.max(50,g);this._renderData.innerScale=k*k/(Math.sqrt(k*k-e*e)*Math.sqrt(k*k-l*l)+e*l)-1;this._renderData.altitudeFade=r.computeInnerAltitudeFade(g);p.vec3.scale(c,a.eye,(e+50)/f);I(c,a.center,a.up,e,this._renderData);c=J(a,c,a.up,this._renderData);f=T(g);l=.001953125;k=0+c*f*1;50<g&&(I(a.eye,a.center,a.up,e,this._renderData),a=J(a,a.eye,a.up,this._renderData),
a=h.clamp((a-1.5)/(c-1.5),0,1),l=0+.001953125*a,k=0+1*d.lerp(1,c*f,a));b.vec2.set(this._renderData.texV,l,k)};a.prototype._createRibbon=function(b){var a=new Float32Array(1155),c=new Uint32Array(1920);a[0]=0;a[1]=0;a[2]=-1;for(var d=0;128>d;d++){var e=9*d+3;a[e+0]=d;a[e+1]=L;a[e+2]=-1;a[e+3]=d;a[e+4]=R;a[e+5]=0;a[e+6]=d;a[e+7]=O;a[e+8]=1;var e=3*d+1,f=127===d?1:e+3,g=15*d;c[g+0]=e;c[g+1]=e+1;c[g+2]=f+1;c[g+3]=f+1;c[g+4]=f;c[g+5]=e;c[g+6]=e+1;c[g+7]=e+2;c[g+8]=f+2;c[g+9]=f+2;c[g+10]=f+1;c[g+11]=e+
1;c[g+12]=e;c[g+13]=f;c[g+14]=0}e=W.createBuffer(c.length);f=e.position;for(d=0;d<c.length;++d)g=3*c[d],f.set(d,0,a[g]),f.set(d,1,a[g+1]),f.set(d,2,a[g+2]);return new N(b,E.colorPass.attributes,{geometry:t.glLayout(W)},{geometry:B.createVertex(b,35044,e.buffer)})};return a}();var U=c.mat4f64.create(),P=q.vec3f64.create(),V=q.vec3f64.create(),W=x.newLayout().vec3f("position");return n})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});a.createQuadVAO=function(a,d){void 0===d&&(d=k.Pos2);var c=null;switch(d){case k.Pos3Tex:c=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case k.Pos3:c=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case k.Pos2Tex:c=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:c=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new g(a,m.Default3D,{geometry:d},{geometry:h.createVertex(a,35044,
c)})};a.createEmptyTexture=function(a,f){void 0===f&&(f=4);return new d(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:f,height:f})};a.createColorTexture=function(a,f,c){void 0===c&&(c=4);for(var b=new Uint8Array(c*c*4),e=0;e<b.length;e+=4)b[e+0]=255*f[0],b[e+1]=255*f[1],b[e+2]=255*f[2],b[e+3]=255*f[3];return new d(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:c,height:c},b)}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];a.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];a.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,
normalized:!1}];a.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];a.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];a.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/StarsPrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t){var x=l.getLogger("esri.views.3d.environment.Stars");a=function(){function a(b){this.slot=13;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this._loadDataController=f.createAbortController();this._numStars=0;this._modelMatrix=e.mat4f64.create();this.view=b;this._loadDataPromise=this._loadBrightStarCatalogue()}Object.defineProperty(a.prototype,"canRender",{get:function(){return null!=this._vao},enumerable:!0,configurable:!0});a.prototype.destroy=
function(){this._loadDataController&&(this._loadDataController.abort(),this._loadDataController=null);this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};a.prototype.initializeRenderContext=function(b){var a=this;this._initContext=b;var d=b.rctx;this._program=u.createProgram(d,r.program);this._pipelineState=v.makePipelineState({blending:v.separateBlendingParams(770,1,771,771),
depthTest:{func:515},colorWrite:v.defaultColorWriteParams});this._dateHandle=c.init(this.view,"environment.lighting.date",function(b){return a._update(b)});this._loadDataPromise.then(function(){a._numStars=a._starData.byteLength/a.bytesPerStar;var c=new Float32Array(a._starData,0,a._numStars*a.numBinaryFloats),e=new Uint8Array(a._starData,a._numStars*a.numBinaryFloats*4,a._numStars*a.numBinaryUInt8);a._vao=a._createVertexArrayObject(d,c,e);b.requestRender()})};a.prototype.uninitializeRenderContext=
function(b){this.destroy()};a.prototype.render=function(b){if(b.slot!==this.slot||0!==b.pass)return!1;var a=b.rctx,c=this._program;a.bindProgram(c);b=b.camera;c.setUniformMatrix4fv("view",b.viewMatrix);c.setUniformMatrix4fv("proj",b.projectionMatrix);c.setUniform4fv("viewport",b.fullViewport);c.setUniformMatrix4fv("model",this._modelMatrix);c.setUniform1f("pixelRatio",b.pixelRatio);a.setPipelineState(this._pipelineState);a.bindVAO(this._vao);y.assertCompatibleVertexAttributeLocations(this._vao,c);
a.drawArrays(0,0,this._numStars);return!0};a.prototype._computeDayDuration=function(b){var a=new Date(b.getFullYear(),0,1,11,58,56),c=new Date(b.getFullYear()+1,0,1,11,58,55);return(+b-+a)/(+c-+a)};a.prototype._update=function(a){if(a){var c=a.getHours()/12,d=a.getMinutes()/60*(2/24),e=a.getSeconds()/60*(2/1440),c=(c+d+e-.9972222)%2;a=2*this._computeDayDuration(a);d=this._modelMatrix;b.mat4.copy(d,E);b.mat4.rotateZ(d,d,-a*Math.PI);b.mat4.multiply(d,A,d);b.mat4.rotateZ(d,d,-c*Math.PI);this._initContext.requestRender()}};
a.prototype._hexToRGB=function(b){return[parseInt(b.substring(0,2),16),parseInt(b.substring(2,4),16),parseInt(b.substring(4,6),16)]};a.prototype._unpackUint8Attributes=function(b){return 192<=b?[2.9,b-192]:160<=b?[2.5,b-160]:128<=b?[2,b-128]:96<=b?[1.5,b-96]:64<=b?[1,b-64]:32<=b?[.7,b-32]:[.4,b]};a.prototype._createVertexArrayObject=function(b,a,c){for(var d=B.createBuffer(this._numStars),e=d.position,f=d.color,g=d.size,l=0;l<this._numStars;l++){var h=a[2*l+0],q=a[2*l+1];e.set(l,0,-Math.cos(h)*Math.sin(q));
e.set(l,1,-Math.sin(h)*Math.sin(q));e.set(l,2,-Math.cos(q));h=this._unpackUint8Attributes(c[l]);q=this._hexToRGB(z[h[1]]);f.set(l,0,255*q[0]);f.set(l,1,255*q[1]);f.set(l,2,255*q[2]);f.set(l,3,255);g.set(l,h[0])}return new t(b,r.program.attributes,{geometry:p.glLayout(B)},{geometry:w.createVertex(b,35044,d.buffer)})};a.prototype._verifyStartData=function(b){if(!b)throw new g("stars:no-data-received","Failed to create stars because star catalogue is missing");b=b.byteLength/this.bytesPerStar;if(0!==
b%1||5E4<b||5E3>b)throw new g("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};a.prototype._loadBrightStarCatalogue=function(){return k(this,void 0,void 0,function(){var b,a,c;return m(this,function(e){switch(e.label){case 0:return G?(this._starData=G,[2]):[4,d.result(h(n.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",signal:this._loadDataController.signal}))];case 1:b=e.sent();this._loadDataController=null;if(!1===b.ok){if(f.isAbortError(b.error))throw b.error;
x.error("loadBrightStarCatalogue",b.error.message);return[2]}a=b.value;c=a.data;try{this._verifyStartData(c)}catch(J){throw x.error("loadBrightStarCatalogue",J),J;}this._starData=G=c;return[2]}})})};return a}();var z="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),A=e.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,
0,0,0,0,1),E=e.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),B=q.newLayout().vec3f("position").vec4u8("color").f32("size"),G=null;return a})},"esri/views/3d/webgl-engine/shaders/StarsPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.program={name:"stars",shaders:{vertexShader:k.resolveIncludes("environment/stars.vert"),
fragmentShader:k.resolveIncludes("environment/stars.frag")},attributes:m.Default3D}})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),function(n,a,m,k,h,d,g,l){function f(b,a,c,d){for(var e=[],f=0;f<c.length;f++)e[f]=(d[f]-c[f])*b/a+c[f];return e}Object.defineProperty(a,"__esModule",
{value:!0});a.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};a.computeColorAndIntensity=function(b,c){var p,h,q,k,y=c[2],t=e;d.vec3.set(t.ambient.color,1,1,1);t.ambient.intensity=a.settings.global.ambient;d.vec3.set(t.diffuse.color,1,1,1);t.diffuse.intensity=a.settings.global.diffuse;
y=(Math.abs(y)-a.settings.local.altitude)/(a.settings.global.altitude-a.settings.local.altitude);y=m.clamp(y,0,1);t.globalFactor=y;c=l.getTimes(b,c[1],c[0]);if(1>y){q=b.valueOf();var x,z;c.polarException===l.POLAR_EXCEPTION.MIDNIGHT_SUN?(x=q-36E5*(b.getHours()+48)-6E4*b.getMinutes(),z=x+432E6):c.polarException===l.POLAR_EXCEPTION.POLAR_NIGHT?(x=q-2,z=q-1):(x=c.sunrise.valueOf(),z=c.sunset.valueOf());var A=z-x;k=x+A/2;h=A/4;p=k-h;h=k+h;var n=.06*A,A=x-n/2;x+=n/2;var B=z-n/2,G=z+n/2;z=a.settings.local;
var F=[.01,z.ambientAtNight],K=[.8,.8,1],H=[.01,.01,.01],N=[z.diffuseAtTwilight,z.ambientAtTwilight],I=[1,.75,.75],J=[.8,.8,1],M=[.9*z.diffuseAtNoon,z.ambientAtNoon],L=[1,.98,.98],R=[.98,.98,1],O=[z.diffuseAtNoon,z.ambientAtNoon],T=[1,1,1],U=[1,1,1];z=[0,0];var P=[0,0,0],n=[0,0,0];q<A||q>G?(z=F,P=H,n=K):q<x?(n=x-A,z=f(q-A,n,F,N),P=f(q-A,n,H,I),n=f(q-A,n,K,J)):q<p?(n=p-x,z=f(q-x,n,N,M),P=f(q-x,n,I,L),n=f(q-x,n,J,R)):q<k?(n=k-p,z=f(q-p,n,M,O),P=f(q-p,n,L,T),n=f(q-p,n,R,U)):q<h?(n=h-k,z=f(q-k,n,O,M),
P=f(q-k,n,T,L),n=f(q-k,n,U,R)):q<B?(n=B-h,z=f(q-h,n,M,N),P=f(q-h,n,L,I),n=f(q-h,n,R,J)):q<G&&(n=G-B,z=f(q-B,n,N,F),P=f(q-B,n,I,H),n=f(q-B,n,J,K));q=z[0];k=g.vec3f64.fromValues(P[0],P[1],P[2]);p=z[1];h=g.vec3f64.fromValues(n[0],n[1],n[2]);d.vec3.lerp(t.ambient.color,h,t.ambient.color,y);t.ambient.intensity=m.lerp(p,t.ambient.intensity,y);d.vec3.lerp(t.diffuse.color,k,t.diffuse.color,y);t.diffuse.intensity=m.lerp(q,t.diffuse.intensity,y)}y=b.valueOf();c.polarException===l.POLAR_EXCEPTION.MIDNIGHT_SUN?
(b=y-36E5*(b.getHours()+48)-6E4*b.getMinutes(),c=b+432E6):c.polarException===l.POLAR_EXCEPTION.POLAR_NIGHT?(b=y-2,c=y-1):(b=c.sunrise.valueOf(),c=c.sunset.valueOf());b=1-m.clamp(Math.abs(y-(b+(c-b)/2))/432E5,0,1);t.noonFactor=b;return t};a.computeDirection=function(e,f,h,w){w||(w=g.vec3f64.create());var p=b,q=k.mat4.identity(c);if("global"===h)l.getPosition(e,0,0,p),d.vec3.set(w,0,0,-1),k.mat4.rotateX(q,q,-p.azimuth),k.mat4.rotateY(q,q,-p.altitude);else{var r=a.settings.planarDirection;h=r.globalAngles;
r=(Math.abs(f[2])-r.localAltitude)/(r.globalAltitude-r.localAltitude);r=m.clamp(r,0,1);1>r?(l.getPosition(e,f[1],f[0],p),p.azimuth=(1-r)*p.azimuth+r*h.azimuth,p.altitude=(1-r)*p.altitude+r*h.altitude):(p.azimuth=h.azimuth,p.altitude=h.altitude);d.vec3.set(w,0,-1,0);k.mat4.rotateZ(q,q,-p.azimuth);k.mat4.rotateX(q,q,-p.altitude)}d.vec3.transformMat4(w,w,q);return w};a.computeShadowsEnabled=function(b,c){return"global"===c?!0:Math.abs(b[2])<a.settings.planarDirection.localAltitude};var c=h.mat4f64.create(),
b={azimuth:0,altitude:0},e={ambient:{color:g.vec3f64.create(),intensity:0},diffuse:{color:g.vec3f64.create(),intensity:0,direction:g.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function n(b){return new Date(864E5*(b+.5-2440588))}function a(a,c){return r(b(a)*e(y)-p(c)*b(y),e(a))}function m(a,c){return q(b(c)*e(y)+e(c)*b(y)*b(a))}function k(a,c,d){return r(b(a),e(a)*b(c)-p(d)*e(c))}function h(a,c,d){return q(b(c)*b(d)+e(c)*e(d)*e(a))}
function d(a){return u*(1.9148*b(a)+.02*b(2*a)+3E-4*b(3*a))}function g(b,e){b=u*(357.5291+.98560028*b);var f=d(b);b=b+f+102.9372*u+c;e||(e={dec:0,ra:0});e.dec=m(b,0);e.ra=a(b,0);return e}function l(a,c,d){return 2451545+a+.0053*b(c)-.0069*b(2*d)}function f(c){var d=u*(134.963+13.064993*c),f=u*(93.272+13.22935*c);c=u*(218.316+13.176396*c)+6.289*u*b(d);f=5.128*u*b(f);d=385001-20905*e(d);return{ra:a(c,f),dec:m(c,f),dist:d}}var c=Math.PI,b=Math.sin,e=Math.cos,p=Math.tan,q=Math.asin,r=Math.atan2,w=Math.acos,
u=c/180,v={dec:0,ra:0},y=23.4397*u,t={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(b,a,c,d){c=u*-c;a*=u;var e=b.valueOf()/864E5-.5+2440588-2451545;b=g(e,v);c=u*(280.16+360.9856235*e)-c-b.ra;d||(d={azimuth:0,altitude:0});d.azimuth=k(c,a,b.dec);d.altitude=h(c,a,b.dec);return d}},x=[[-.83,"sunrise","sunset"]];t.addTime=function(b,a,c){x.push([b,a,c])};t.getTimes=function(a,f,g){function p(a){var d=q,f=y;a=w((b(a)-b(d)*b(f))/(e(d)*e(f)));return l(9E-4+(a+h)/(2*c)+k,r,v)}
var h=u*-g,q=u*f,k=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-h/(2*c));a=9E-4+(0+h)/(2*c)+k;var r=u*(357.5291+.98560028*a);f=d(r);var v=r+f+102.9372*u+c,y=m(v,0);a=l(a,r,v);f={solarNoon:n(a),nadir:n(a-.5),polarException:t.POLAR_EXCEPTION.NORMAL};var z,A,E,R;g=0;for(z=x.length;g<z;g+=1)A=x[g],E=p(A[0]*u),R=a-(E-a),f[A[1]]=n(R),f[A[2]]=n(E);f.polarException=function(a){a=(b(a)-b(q)*b(y))/(e(q)*e(y));return-1>a?t.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?t.POLAR_EXCEPTION.POLAR_NIGHT:t.POLAR_EXCEPTION.NORMAL}(x[0][0]*
u);return f};t.getMoonPosition=function(b,a,c){c=u*-c;a*=u;var d=b.valueOf()/864E5-.5+2440588-2451545;b=f(d);c=u*(280.16+360.9856235*d)-c-b.ra;d=h(c,a,b.dec);d+=.017*u/p(d+10.26*u/(d+5.1*u));return{azimuth:k(c,a,b.dec),altitude:d,distance:b.dist}};t.getMoonFraction=function(a){var c=a.valueOf()/864E5-.5+2440588-2451545;a=g(c);c=f(c);a=w(b(a.dec)*b(c.dec)+e(a.dec)*e(c.dec)*e(a.ra-c.ra));a=r(149598E3*b(a),c.dist-149598E3*e(a));return(1+e(a))/2};return t})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){return function(a,h,d){void 0===a&&(a=m.vec3f64.create());void 0===h&&(h=m.vec3f64.fromValues(.57735,.57735,.57735));void 0===d&&(d=!0);this.intensity=a;this.direction=h;this.castShadows=d}}();a.MainLight=n;n=function(){return function(a,h){void 0===a&&(a=m.vec3f64.create());void 0===h&&(h=m.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=m.vec3f64.create();
this.direction=m.vec3f64.create();this.intensity=a;this.direction=h}}();a.FillLight=n;n=function(){return function(a){void 0===a&&(a=m.vec3f64.create());this.intensity=a}}();a.AmbientLight=n;n=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();a.SphericalHarmonicsLight=n})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G){n=function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b._handles=new d;return b}m(h,a);h.prototype.initialize=function(){this.viewEvents=new x.ViewEvents(this.view)};h.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(h.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(b){"pan"!==b&&"rotate"!==
b||b===this._get("primaryDragAction")||(this._set("primaryDragAction",b),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mode",{get:function(){return this._get("mode")},set:function(b){"default"!==b&&"pro"!==b||b===this._get("mode")||(this._set("mode",b),this._updateMode())},enumerable:!0,configurable:!0});h.prototype.disconnect=function(){this.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),
this._source=null)};h.prototype.connect=function(){var a=this.view;this._source=new y.BrowserEventSource(this.view.surface,a.input);var d=[new E.PointerClickHoldAndDrag,new B.SingleAndDoubleClick,new A.Drag,new G.VerticalTwoFingerDrag];this._inputManager=d=new t.InputManager(this._source,d);d.installHandlers("prevent-context-menu",[new z.PreventContextMenu]);this._modeDragPan=new q.PinchAndPanNavigation(a,"primary");this._modeDragRotate=new f.DragRotate(a,"secondary","center");this._modeDragZoom=
new c.DragZoom(a,"tertiary");d.installHandlers("navigation",[new r.PointerDownCancelAnimation(a),new l.DoubleClickZoom(a),new b.GamepadNavigation(a),new e.KeyboardNavigation(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s"}),new p.MouseWheelZoom(a),new u.SingleKeyResetTilt(a,"p"),new w.SingleKeyResetHeading(a,"n"),new f.DragRotate(a,"primary","eye",["b"]),new f.DragRotate(a,"secondary","center",["b"]),
new q.PinchAndPanNavigation(a,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new v.TwoFingerTilt(a)]);this.viewEvents.connect(d);this._updateMode()};h.prototype._updateMode=function(){var b=this.primaryDragAction,b=F.get(this.mode).get(b);this._modeDragPan&&(this._modeDragPan.pointerAction=b.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=b.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=b.zoom)};Object.defineProperty(h.prototype,"debug",{get:function(){return{inputManager:this._inputManager}},
enumerable:!0,configurable:!0});k([g.property()],h.prototype,"view",void 0);k([g.property({value:"pan"})],h.prototype,"primaryDragAction",null);k([g.property({value:"default"})],h.prototype,"mode",null);k([g.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],h.prototype,"hasPendingInputs",void 0);k([g.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],h.prototype,"latestPointerType",void 0);k([g.property()],h.prototype,"_inputManager",void 0);return h=k([g.subclass("esri.views.3d.input.SceneInputManager")],
h)}(g.declared(h));var F=new Map;a=new Map;h=new Map;a.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});a.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});h.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});h.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});F.set("default",a);F.set("pro",h);return n})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,c){var d=a.call(this,!0)||this;d.view=b;d.registerIncoming("double-click",c,function(b){return d.handleDoubleClick(b)});return d}m(c,a);c.prototype.handleDoubleClick=function(b){var a=b.data;if(l.eventMatchesPointerAction(a,"primary")){var c=this.view.state.isGlobal?new h.ZoomStepController(this.view,"animation"):new d.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(c);
c.zoomStep(Math.log(.5)/Math.log(.6),k.createScreenPointArray(a.x,a.y));b.stopPropagation()}};return c}(g.InputHandler);a.DoubleClickZoom=n})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(b,d){var e=a.call(this,b.state,b.sceneIntersectionHelper,"interaction"===d?null:void 0)||this;e.view=b;e.mode=d;e.zoomLocation=h.vec3f64.create();e.tmpCamera=new c.default;e.tmpViewDir=h.vec3f64.create();e.targetOnSphere=h.vec3f64.create();e.tmpCenter=h.vec3f64.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new c.default,interactionDirection:null,
tiltMode:0};e.sphere=f.sphere.create();return e}m(e,a);Object.defineProperty(e.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});e.prototype.zoomStep=function(b,a){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);d=!1;0<b&&this.intersectionHelper.intersectScreen(a,this.zoomLocation)&&(d=!0);this.tmpCamera.copyFrom(c.camera);d?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,b),this.zoomLocation,a);this.begin(this.tmpCamera)}};e.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:b.outExpo}};e.prototype.updateCamera=function(b,a,c,e){this.sphere.radius=k.vec3.length(c);k.vec3.subtract(this.tmpViewDir,
b.center,b.eye);var g=k.vec3.length(this.tmpViewDir),p=g*a;1>=a&&4>p&&(p=4,a=p/g);1E-6>Math.abs(g-p)||(g=k.vec3.length(b.center),this.sphere.radius!==g&&k.vec3.scale(b.center,b.center,(this.sphere.radius+a*(g-this.sphere.radius))/g),k.vec3.scale(this.tmpViewDir,this.tmpViewDir,-a),k.vec3.add(b.eye,b.center,this.tmpViewDir),d.applyAll(this.view,b,this.constraintOptions),1E-12<k.vec3.squaredDistance(c,b.center)&&f.sphere.intersectScreen(this.sphere,b,e,this.targetOnSphere)&&l.panToPosition(this.sphere,
b,c,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),d.applySurfaceCollision(this.view,b))};return e}(g.PointToPointAnimationController);a.ZoomStepController=n})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});a.applyTilt=c.apply;a.tiltError=c.error;a.applyAltitude=b.apply;a.altitudeError=b.error;a.applyDistance=e.apply;a.distanceError=e.error;a.applySurfaceCollision=p.apply;a.applyAll=function(b,a,c,d){void 0===c&&(c=r);void 0===d&&(d=a);var e=!1;d!==a&&d.copyFrom(a);d.markViewDirty();d.computeUp(b.state.mode);for(a=0;a<w;a++){for(var f=0,l=0,p=q;l<p.length;l++){var k=p[l];if(h.hasConstraintType(c.selection,k.type)){var t=
Math.abs(k.error(b,d,c));k.apply(b,d,c)&&(e=!0,f+=t)}}if(0===f)break}a=h.hasConstraintType(c.selection,8);a:switch(c.interactionType){case 4:c=1;break a;case 5:c=b.state.isGlobal?2:1;break a;default:c=0}a&&g.apply(b,d,c)&&(e=!0);e&&d.computeUp(b.state.mode);return e};a.pixelDistanceToInteractionFactor=function(b,a){b="number"===typeof b?b:m.vec2.distance(b,a);return f.inOutCubic(Math.min(1,b/150))};var q=[{type:1,error:function(b,a,c){return l.error(b,a,c)*a.distance},apply:l.apply},{type:2,error:k.error,
apply:k.apply},{type:4,error:d.error,apply:d.apply}],r={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},w=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils".split(" "),function(n,a,m,k,h,d,g,l){function f(a,c,e){void 0===
e&&(e=d.defaultApplyOptions);var g;g=a.state.constraints.altitude;g=a.state.isGlobal&&g?2===e.interactionType&&d.hasConstraintType(e.selection,1)?!1:!0:!1;if(!g)return 0;var l=a.state.constraints.altitude;g=b;g.min=l.min;g.max=l.max;var p=e.interactionType;if(0!==p){var l=g.min,h=g.max,q=e.interactionStartCamera;e=e.interactionFactor;var p=2===p||1===p,k=f(a,q),q=0===k?0:a.renderCoordsHelper.getAltitude(q.eye);g.min=l;g.max=h;d.adjustRangeForInteraction(k,q,p,e,.05*q,g)}a=a.renderCoordsHelper.getAltitude(c.eye);
a=m.clamp(a,g.min,g.max)-a;return 1E-6>=Math.abs(a)?0:a}function c(b,a,c,d){b.renderCoordsHelper.worldUpAtPosition(a.eye,d);k.vec3.scale(d,d,c);return d}Object.defineProperty(a,"__esModule",{value:!0});a.apply=function(b,a,h,v){void 0===h&&(h=d.defaultApplyOptions);void 0===v&&(v=a);v!==a&&v.copyFrom(a);var r=f(b,a,h);if(0===r)return!1;var t=b.renderCoordsHelper,u=t.getAltitude(a.eye)+r;b=d.interactionDirectionTowardsConstraintMinimization(a,h.interactionDirection,c(b,a,m.sign(r),p),e);h=k.vec3.copy(q,
a.viewForward);t.intersectInfiniteManifold(g.ray.wrap(a.eye,b),u,v.eye)||t.setAltitude(u,v.eye);l.closestPointOnRay(a.eye,h,a.center,a.center);v.markViewDirty();return!0};a.error=f;var b={min:0,max:0},e=h.vec3f64.create(),p=h.vec3f64.create(),q=h.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.hasConstraintType=
function(a,d){return 0!==(a&d)};a.adjustRangeForInteraction=function(a,d,g,l,f,c){0!==a&&(g?(c.min=Math.min(c.min,d),c.max=Math.max(c.max,d)):null!=l?(c.min-=Math.max(0,(d-c.min)*(1-l)),c.max+=Math.max(0,(d-c.max)*(1-l))):f&&(c.min-=Math.max(0,d-c.min-f),c.max+=Math.max(0,d-c.max-f)))};a.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};a.interactionDirectionTowardsConstraintMinimization=function(a,d,g,l){d=d||
a.viewForward;k.vec3.copy(l,d);k.vec3.scale(l,l,m.sign(k.vec3.dot(d,g)));return l}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,m,k,h){function d(a,b,d,g){var c=f;a?(d&&g&&(c.len=k.vec3.distance(b,d)),k.vec3.copy(c.dir,a)):g?(c.len=k.vec3.distance(b,d),k.vec3.subtract(c.dir,d,b),k.vec3.scale(c.dir,c.dir,1/c.len)):(k.vec3.subtract(c.dir,
d,b),k.vec3.normalize(c.dir,c.dir));return c}function g(a,b){return-k.vec3.dot(b,a)-a[3]}function l(a,b,d,f){f.clip[0]=0;f.clip[1]=d?f.len:Number.MAX_VALUE;for(d=0;d<a.length;d++){var c;var e=a[d],l=b;c=f;var p=k.vec3.dot(e,c.dir),e=g(e,l);0>e&&0<=p?c=!1:-1E-6<p&&1E-6>p?c=0<e:!(0>e||0>p)||0>e&&0>p?(e/=p,0<p?e<c.clip[1]&&(c.clip[1]=e):e>c.clip[0]&&(c.clip[0]=e),c=c.clip[0]<=c.clip[1]):c=!0;if(!c)return!1}return!0}Object.defineProperty(a,"__esModule",{value:!0});a.planeSphere=function(a,b,d){return a[0]*
b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<d};a.frustumSphere=function(a,b,d){var c=b[0],e=b[1];b=b[2];return a[0][0]*c+a[0][1]*e+a[0][2]*b+a[0][3]>d||a[1][0]*c+a[1][1]*e+a[1][2]*b+a[1][3]>d||a[2][0]*c+a[2][1]*e+a[2][2]*b+a[2][3]>d||a[3][0]*c+a[3][1]*e+a[3][2]*b+a[3][3]>d||a[4][0]*c+a[4][1]*e+a[4][2]*b+a[4][3]>d||a[5][0]*c+a[5][1]*e+a[5][2]*b+a[5][3]>d?!1:!0};a.frustumRay=function(a,b,e,f){e=d(f,b,e,!1);return l(a,b,null,e)};a.frustumPoint=function(a,b){for(var c=0;6>c;c++)if(0>g(a[c],b))return!1;return!0};a.frustumLineSegment=
function(a,b,e,f){f=d(f,b,e,!0);return l(a,b,e,f)};a.closestPointOnRay=function(a,b,d,f){d=k.vec3.dot(b,k.vec3.subtract(f,d,a));k.vec3.add(f,a,k.vec3.scale(f,b,d));return f};var f={dir:h.vec3f64.create(),len:0,clip:m.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(n,a,m,k,h,d,g){function l(b,
a,c){void 0===c&&(c=h.defaultApplyOptions);if(!b.state.isLocal)return 0;var d=b.state.constraints.distance;if(!b.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===d)return 0;f.min=0;f.max=d;var d=f,e=c.interactionType;if(0!==e){var g=d.min,p=d.max,q=c.interactionStartCamera;c=c.interactionFactor;var e=1===e||4===e,k=l(b,q),q=0===k?0:m.vec3.distance(q.eye,b.pointsOfInterest.surfaceOrigin.renderLocation);d.min=g;d.max=p;h.adjustRangeForInteraction(k,q,e,c,.05*q,d)}b=m.vec3.distance(a.eye,b.pointsOfInterest.surfaceOrigin.renderLocation);
b=f.max-b;return-1E-6<=b?0:b}Object.defineProperty(a,"__esModule",{value:!0});a.error=l;a.apply=function(a,f,k,u){void 0===k&&(k=h.defaultApplyOptions);void 0===u&&(u=f);u!==f&&u.copyFrom(f);var q=l(a,f,k);if(0===q)return!1;var r=a.pointsOfInterest.surfaceOrigin,q=m.vec3.distance(f.eye,a.pointsOfInterest.surfaceOrigin.renderLocation)+q,t=m.vec3.copy(c,f.eye);k=h.interactionDirectionTowardsConstraintMinimization(f,k.interactionDirection,g.directionFromTo(p,f.eye,a.pointsOfInterest.surfaceOrigin.renderLocation),
e);return d.sphere.intersectRay(d.sphere.wrap(q,r.renderLocation),d.ray.wrap(f.eye,k),u.eye)?(f=m.vec3.subtract(b,u.eye,t),m.vec3.add(u.center,u.center,f),u.markViewDirty(),f=a.renderCoordsHelper.getAltitude(u.center),a.renderCoordsHelper.intersectInfiniteManifold(u.ray,f,u.center),u.markViewDirty(),!0):!1};var f={min:0,max:0},c=k.vec3f64.create(),b=k.vec3f64.create(),e=k.vec3f64.create(),p=k.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../intersectionUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});a.apply=function(a,l,f,c){void 0===f&&(f=0);void 0===c&&(c=l);var b=a.state.constraints;l!==c&&c.copyFrom(l);if(!b.collision.enabled)return!1;var e=h.surfaceElevationBelowEye(a,l);l=a.renderCoordsHelper.getAltitude(l.eye);b=e+b.collision.elevationMargin;if(l>=b)return!1;e=m.vec3.length(c.eye);m.vec3.subtract(d,c.center,
c.eye);a.renderCoordsHelper.setAltitude(b,c.eye);1===f?m.vec3.add(c.center,c.eye,d):2===f&&m.vec3.scale(c.center,c.center,(e-l+b)/e);c.markViewDirty();return!0};var d=k.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Intersector".split(" "),function(n,a,m,k,h,d,g,l){function f(b,
a){return b.renderCoordsHelper.fromRenderCoords(a,r,b.basemapTerrain.spatialReference)?b.basemapTerrain.getElevation(r)||0:0}function c(b,a,c){if(!b.state.isGlobal)return!1;var d=f(b,a);b=b.stateManager.constraintsManager.nearFarHeuristic.compute(a,c,b.dataExtent,d,u).far;b*=b;return m.vec3.squaredDistance(a,c)>b}function b(b,a,d){void 0===d&&(d=k.vec3f64.create());var f=e[b.viewingMode];f||(f=new l(b.viewingMode),f.enable.backfacesTerrain=!b.state.isGlobal,f.enable.invisibleTerrain=!0,e[b.viewingMode]=
f);var p=b.state.isGlobal;return b.sceneIntersectionHelper.intersectRay(a,d,null,f)&&!c(b,a.origin,d)?!0:!b.renderCoordsHelper.intersectManifold(a,0,d)||c(b,a.origin,d)?p?(b=d,d=m.vec3.dot(a.origin,a.origin)-g.earthRadius*g.earthRadius,m.vec3.scale(b,a.direction,(0<d?Math.sqrt(d)/3:1)/m.vec3.length(a.direction)),m.vec3.add(b,b,a.origin),!0):!1:!0}Object.defineProperty(a,"__esModule",{value:!0});a.eyeWithinExtent=function(b,a,c,e){return b.renderCoordsHelper.fromRenderCoords(a.eye,p,e)&&d.containsPoint(c,
p)};a.surfaceElevationBelowEye=function(b,a){return f(b,a.eye)};a.cameraOnContentAlongViewDirection=function(a,c,d,e){var f=a.state.camera.clone();c&&(f.eye=c);d&&(f.center=d);e&&(f.up=e);b(a,f.ray,q)||m.vec3.copy(q,f.center);d=a.state.constraints;e=d.minimumPoiDistance;m.vec3.squaredDistance(f.eye,q)<e&&(c=d.collision.enabled,m.vec3.copy(w,f.viewForward),m.vec3.scale(w,w,e),c?m.vec3.subtract(f.eye,q,w):m.vec3.add(q,f.eye,w),a=a.renderCoordsHelper,e=a.getAltitude(f.eye),d=d.collision.elevationMargin,
c&&e<d&&(m.vec3.subtract(w,q,f.eye),a.setAltitude(d,f.eye),m.vec3.add(q,f.eye,w)));f.center=q;return f};var e={},p=k.vec3f64.create(),q=k.vec3f64.create(),r=new h,w=k.vec3f64.create(),u={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),
function(n,a,m,k,h,d,g,l,f){var c=h.mat4f64.create();return function(){function b(b){this.enable=new f.EnableIntersectorOptions;this.results=new f.IntersectorResults;this.transform=new f.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this._ray={origin:g.vec3f64.create(),direction:g.vec3f64.create()};this._rayEndPoint=g.vec3f64.create();this._rayStartPointTransformed=g.vec3f64.create();this._rayEndPointTransformed=g.vec3f64.create();this.viewingMode=
b||"global"}Object.defineProperty(b.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});b.prototype.intersect=function(b,a,c,f,g,h,k,m,t,x){var e=this;if(void 0===t||!0===t)this._numObjectsTested=0,l.ray.fromPoints(a,c,this._ray),
this.results.init(this._ray);this.point=f;this.camera=g;this.enable.selectionMode=k;this.filterPredicate=m;this.tolerance=null==h?1E-5:h;d.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);a=x?function(b){x(b)&&e.intersectObject(b)}:function(b){e.intersectObject(b)};if(b&&0<b.length)for(c=0;c<b.length;c++)if(f=b[c],g=f.getSpatialQueryAccelerator?f.getSpatialQueryAccelerator():void 0)g.forEachAlongRay(this._ray.origin,this._ray.direction,a),k&&g.forEachDegenerateObject(a);else for(g=
0,f=f.getObjects();g<f.length;g++)a(f[g]);this.sortResults()};b.prototype.intersectObject=function(b){var a=this;this._numObjectsTested++;var e=b.geometryRecords;if(e)for(var g=b.id,l=b.objectTransformation,h,k=function(e){var p=e.geometry,q=e.material,k=e.instanceParameters;if(k.hidden)return"continue";h=p.id;m.transform.setAndInvalidateLazyTransforms(l,e.getShaderTransformation());d.vec3.transformMat4(m._rayStartPointTransformed,m._ray.origin,m.transform.inverse);d.vec3.transformMat4(m._rayEndPointTransformed,
m._rayEndPoint,m.transform.inverse);var r=m.transform.transform;q.intersect(p,k,m.transform.transform,m,m._rayStartPointTransformed,m._rayEndPointTransformed,function(d,e,l,p,q,k){0<=d&&(null==a.filterPredicate||a.filterPredicate(a._ray.origin,a._rayEndPoint,d))&&(q?(null==a.results.hud.dist||d<a.results.hud.dist)&&a.results.hud.set(b,g,d,e,c,p,k,h,l):(q=function(a){return a.set(b,g,d,e,r,p,null,h,l)},(null==a.results.min.drapedLayerOrder||p>=a.results.min.drapedLayerOrder)&&(null==a.results.min.dist||
d<a.results.min.dist)&&q(a.results.min),(null==a.results.max.drapedLayerOrder||p<a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||d>a.results.max.dist)&&q(a.results.max),a.enable.storeAll&&(k=new f.IntersectorResult(a._ray),q(k),a.results.all.push(k))))},e.shaderTransformation)},m=this,t=0;t<e.length;t++)k(e[t])};b.prototype.sortResults=function(){this.results.all.sort(function(b,a){return b.dist!==a.dist?b.dist-a.dist:b.drapedLayerOrder!==a.drapedLayerOrder?(void 0!==b.drapedLayerOrder?
b.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE):(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==b.drapedLayerGraphicOrder?b.drapedLayerGraphicOrder:Number.MIN_VALUE)})};b.DEFAULT_TOLERANCE=1E-5;return b}()})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ./Object3D".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(b,a){return m.isNone(b)||null==b.layerUid?null:m.isSome(a.graphicsView)&&b.layerUid===a.graphicsView.mockLayerId?a.graphics:a.map.findLayerByUid(b.layerUid)}function w(b,a,c){if(m.isNone(b))return null;var d=r(b,a);return m.isNone(d)?null:d===a.graphics?m.isSome(a.graphicsView)?m.expect(a.graphicsView.getGraphicFromGraphicUid(b.graphicUid)):null:(a=a.allLayerViews.find(function(b){return b.layer===d}))?u(a,b,c):null}function u(b,a,c){return!b||b.suspended?
null:m.isSome(c)&&"getGraphicFromStageObject"in b?b.getGraphicFromStageObject(c.obj,c.triangleNr):"getGraphicFromGraphicUid"in b&&null!=a.graphicUid?b.getGraphicFromGraphicUid(a.graphicUid):null}Object.defineProperty(a,"__esModule",{value:!0});a.sliceFilterPredicate=function(b){return function(a,c,d){l.vec3.lerp(t,a,c,d);return!p.extrusionContainsPoint(b,t)}};n=function(){return function(){this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.storeAll=this.storeTerrainResults=this.backfacesTerrain=
!0}}();a.EnableIntersectorOptions=n;n=function(){function b(){this._transform=g.mat4f64.create();this._transformInverse=new v({value:this._transform},d.mat4.invert,g.mat4f64.create);this._transformInverseTranspose=new v(this._transformInverse,d.mat4.transpose,g.mat4f64.create);this._transformTranspose=new v({value:this._transform},d.mat4.transpose,g.mat4f64.create);this._transformInverseRotation=new v({value:this._transform},k.mat3.normalFromMat4Legacy,h.mat3f64.create)}b.prototype.invalidateLazyTransforms=
function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};Object.defineProperty(b.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});b.prototype.setTransformMatrix=function(b){d.mat4.copy(this._transform,b)};b.prototype.multiplyTransform=function(b){d.mat4.multiply(this._transform,this._transform,b)};b.prototype.set=function(b){d.mat4.copy(this._transform,
b);this.invalidateLazyTransforms()};b.prototype.setAndInvalidateLazyTransforms=function(b,a){this.setTransformMatrix(b);this.multiplyTransform(a);this.invalidateLazyTransforms()};return b}();a.IntersectorTransform=n;var v=function(){function b(b,a,c){this.original=b;this.update=a;this.dirty=!0;this.transform=c()}b.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(b.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},
enumerable:!0,configurable:!0});return b}();n=function(){function b(){this.min=new y;this.max=new y;this.hud=new y;this.terrain=new y}b.prototype.init=function(b){this.min.init(b);this.max.init(b);this.hud.init(b);this.terrain.init(b);this.all=[]};return b}();a.IntersectorResults=n;var y=function(){function b(b){this.normal=f.vec3f64.create();this.transformation=g.mat4f64.create();this._ray=e.ray.create();this.init(b)}Object.defineProperty(b.prototype,"ray",{get:function(){return this._ray},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return l.vec3.scale(x,this.ray.direction,this.dist),l.vec3.length(x)},enumerable:!0,configurable:!0});b.prototype.getIntersectionPoint=function(b){if(!this.hasIntersectionPoint)return!1;l.vec3.scale(x,this.ray.direction,this.dist);l.vec3.add(b,this.ray.origin,x);
return!0};b.prototype.getTransformedNormal=function(b){l.vec3.copy(z,this.normal);z[3]=0;c.vec4.transformMat4(z,z,this.transformation);l.vec3.copy(b,z);l.vec3.normalize(b,b);return b};b.prototype.set=function(b,a,c,e,g,p,h,k,r,t){b instanceof q&&(b={type:"stage",obj:b});this.dist=c;l.vec3.copy(this.normal,e);d.mat4.copy(this.transformation,g);this.target=b;this.name=a;this.drapedLayerOrder=p;this.center=h?f.vec3f64.clone(h):null;this.geometryId=k;this.triangleNr=r;this.drapedLayerGraphicOrder=t};
b.prototype.copyFrom=function(b){e.ray.copy(b._ray,this._ray);this.dist=b.dist;this.target=b.target;this.name=b.name;this.drapedLayerOrder=b.drapedLayerOrder;this.center=b.center?f.vec3f64.clone(b.center):null;this.geometryId=b.geometryId;this.triangleNr=b.triangleNr;this.intersector=b.intersector;this.drapedLayerGraphicOrder=b.drapedLayerGraphicOrder;l.vec3.copy(this.normal,b.normal);d.mat4.copy(this.transformation,b.transformation)};b.prototype.init=function(b){this.drapedLayerGraphicOrder=this.drapedLayerOrder=
this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";b?e.ray.copy(b,this._ray):this._ray=e.ray.create()};b.prototype.toOwner=function(b){if(!this.target)return null;switch(this.target.type){case "stage":var a=this.target.obj.getMetadata();return r(a,b);case "external":switch(this.intersector){case "PointRenderer":return a=this.target.metadata.layerUid,null!=a?b.map.findLayerByUid(a):null;case "LodRenderer":case "DrapedRenderer":return r(this.target.metadata,
b);case "TerrainRenderer":return b.map&&b.map.ground}}return null};b.prototype.toGraphic=function(b){if(!this.target)return null;switch(this.target.type){case "stage":var a=this.target.obj,c=this.triangleNr,d=a.getMetadata();return w(d,b,{obj:a,triangleNr:c});case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "LodRenderer":case "DrapedRenderer":return w(this.target.metadata,b,null)}}return null};return b}();a.IntersectorResult=y;a.TERRAIN_ID=
"terrain";var t=f.vec3f64.create(),x=f.vec3f64.create(),z=b.vec4f64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat3=m})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require","exports","./common"],function(n,a,m){function k(a,g,l){var d=g[0],c=g[1],b=g[2],e=g[3],p=g[4],h=g[5],k=g[6],m=g[7];g=g[8];var u=l[0],v=l[1],y=l[2],t=l[3],x=l[4],z=l[5],A=l[6],n=l[7];l=l[8];
a[0]=u*d+v*e+y*k;a[1]=u*c+v*p+y*m;a[2]=u*b+v*h+y*g;a[3]=t*d+x*e+z*k;a[4]=t*c+x*p+z*m;a[5]=t*b+x*h+z*g;a[6]=A*d+n*e+l*k;a[7]=A*c+n*p+l*m;a[8]=A*b+n*h+l*g;return a}function h(a,g,l){a[0]=g[0]-l[0];a[1]=g[1]-l[1];a[2]=g[2]-l[2];a[3]=g[3]-l[3];a[4]=g[4]-l[4];a[5]=g[5]-l[5];a[6]=g[6]-l[6];a[7]=g[7]-l[7];a[8]=g[8]-l[8];return a}Object.defineProperty(a,"__esModule",{value:!0});a.fromMat4=function(a,g){a[0]=g[0];a[1]=g[1];a[2]=g[2];a[3]=g[4];a[4]=g[5];a[5]=g[6];a[6]=g[8];a[7]=g[9];a[8]=g[10];return a};a.copy=
function(a,g){a[0]=g[0];a[1]=g[1];a[2]=g[2];a[3]=g[3];a[4]=g[4];a[5]=g[5];a[6]=g[6];a[7]=g[7];a[8]=g[8];return a};a.set=function(a,g,l,f,c,b,e,p,h,k){a[0]=g;a[1]=l;a[2]=f;a[3]=c;a[4]=b;a[5]=e;a[6]=p;a[7]=h;a[8]=k;return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,g){if(a===g){var d=g[1],f=g[2],c=g[5];a[1]=g[3];a[2]=g[6];a[3]=d;a[5]=g[7];a[6]=f;a[7]=c}else a[0]=g[0],a[1]=g[3],a[2]=g[6],a[3]=g[1],a[4]=g[4],a[5]=g[7],a[6]=
g[2],a[7]=g[5],a[8]=g[8];return a};a.invert=function(a,g){var d=g[0],f=g[1],c=g[2],b=g[3],e=g[4],p=g[5],h=g[6],k=g[7];g=g[8];var m=g*e-p*k,u=-g*b+p*h,v=k*b-e*h,y=d*m+f*u+c*v;if(!y)return null;y=1/y;a[0]=m*y;a[1]=(-g*f+c*k)*y;a[2]=(p*f-c*e)*y;a[3]=u*y;a[4]=(g*d-c*h)*y;a[5]=(-p*d+c*b)*y;a[6]=v*y;a[7]=(-k*d+f*h)*y;a[8]=(e*d-f*b)*y;return a};a.adjoint=function(a,g){var d=g[0],f=g[1],c=g[2],b=g[3],e=g[4],p=g[5],h=g[6],k=g[7];g=g[8];a[0]=e*g-p*k;a[1]=c*k-f*g;a[2]=f*p-c*e;a[3]=p*h-b*g;a[4]=d*g-c*h;a[5]=
c*b-d*p;a[6]=b*k-e*h;a[7]=f*h-d*k;a[8]=d*e-f*b;return a};a.determinant=function(a){var d=a[3],l=a[4],f=a[5],c=a[6],b=a[7],e=a[8];return a[0]*(e*l-f*b)+a[1]*(-e*d+f*c)+a[2]*(b*d-l*c)};a.multiply=k;a.translate=function(a,g,l){var d=g[0],c=g[1],b=g[2],e=g[3],p=g[4],h=g[5],k=g[6],m=g[7];g=g[8];var u=l[0];l=l[1];a[0]=d;a[1]=c;a[2]=b;a[3]=e;a[4]=p;a[5]=h;a[6]=u*d+l*e+k;a[7]=u*c+l*p+m;a[8]=u*b+l*h+g;return a};a.rotate=function(a,g,l){var d=g[0],c=g[1],b=g[2],e=g[3],p=g[4],h=g[5],k=g[6],m=g[7];g=g[8];var u=
Math.sin(l);l=Math.cos(l);a[0]=l*d+u*e;a[1]=l*c+u*p;a[2]=l*b+u*h;a[3]=l*e-u*d;a[4]=l*p-u*c;a[5]=l*h-u*b;a[6]=k;a[7]=m;a[8]=g;return a};a.scale=function(a,g,l){var d=l[0],c=l[1];l=l[2];a[0]=d*g[0];a[1]=d*g[1];a[2]=d*g[2];a[3]=c*g[3];a[4]=c*g[4];a[5]=c*g[5];a[6]=l*g[6];a[7]=l*g[7];a[8]=l*g[8];return a};a.scaleByVec2=function(a,g,l){var d=l[0];l=l[1];a[0]=d*g[0];a[1]=d*g[1];a[2]=d*g[2];a[3]=l*g[3];a[4]=l*g[4];a[5]=l*g[5];return a};a.fromTranslation=function(a,g){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=
0;a[6]=g[0];a[7]=g[1];a[8]=1;return a};a.fromRotation=function(a,g){var d=Math.sin(g);g=Math.cos(g);a[0]=g;a[1]=d;a[2]=0;a[3]=-d;a[4]=g;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromScaling=function(a,g){a[0]=g[0];a[1]=0;a[2]=0;a[3]=0;a[4]=g[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat2d=function(a,g){a[0]=g[0];a[1]=g[1];a[2]=0;a[3]=g[2];a[4]=g[3];a[5]=0;a[6]=g[4];a[7]=g[5];a[8]=1;return a};a.fromQuat=function(a,g){var d=g[0],f=g[1],c=g[2];g=g[3];var b=d+d,e=f+f,p=c+c,d=d*b,h=f*b,f=f*e,k=c*b,
m=c*e,c=c*p,b=g*b,e=g*e;g*=p;a[0]=1-f-c;a[3]=h-g;a[6]=k+e;a[1]=h+g;a[4]=1-d-c;a[7]=m-b;a[2]=k-e;a[5]=m+b;a[8]=1-d-f;return a};a.normalFromMat4Legacy=function(a,g){var d=g[0],f=g[1],c=g[2],b=g[4],e=g[5],p=g[6],h=g[8],k=g[9];g=g[10];var m=g*e-p*k,u=-g*b+p*h,v=k*b-e*h,y=d*m+f*u+c*v;if(!y)return null;y=1/y;a[0]=m*y;a[1]=(-g*f+c*k)*y;a[2]=(p*f-c*e)*y;a[3]=u*y;a[4]=(g*d-c*h)*y;a[5]=(-p*d+c*b)*y;a[6]=v*y;a[7]=(-k*d+f*h)*y;a[8]=(e*d-f*b)*y;return a};a.normalFromMat4=function(a,g){var d=g[0],f=g[1],c=g[2],
b=g[3],e=g[4],p=g[5],h=g[6],k=g[7],m=g[8],u=g[9],v=g[10],y=g[11],t=g[12],x=g[13],z=g[14];g=g[15];var A=d*p-f*e,n=d*h-c*e,B=d*k-b*e,G=f*h-c*p,F=f*k-b*p,K=c*k-b*h,H=m*x-u*t,N=m*z-v*t,m=m*g-y*t,I=u*z-v*x,u=u*g-y*x,v=v*g-y*z,y=A*v-n*u+B*I+G*m-F*N+K*H;if(!y)return null;y=1/y;a[0]=(p*v-h*u+k*I)*y;a[1]=(h*m-e*v-k*N)*y;a[2]=(e*u-p*m+k*H)*y;a[3]=(c*u-f*v-b*I)*y;a[4]=(d*v-c*m+b*N)*y;a[5]=(f*m-d*u-b*H)*y;a[6]=(x*K-z*F+g*G)*y;a[7]=(z*B-t*K-g*n)*y;a[8]=(t*F-x*B+g*A)*y;return a};a.projection=function(a,g,l){a[0]=
2/g;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/l;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};a.add=function(a,g,l){a[0]=g[0]+l[0];a[1]=g[1]+l[1];a[2]=g[2]+l[2];a[3]=g[3]+l[3];a[4]=g[4]+l[4];a[5]=g[5]+l[5];a[6]=
g[6]+l[6];a[7]=g[7]+l[7];a[8]=g[8]+l[8];return a};a.subtract=h;a.multiplyScalar=function(a,g,l){a[0]=g[0]*l;a[1]=g[1]*l;a[2]=g[2]*l;a[3]=g[3]*l;a[4]=g[4]*l;a[5]=g[5]*l;a[6]=g[6]*l;a[7]=g[7]*l;a[8]=g[8]*l;return a};a.multiplyScalarAndAdd=function(a,g,l,f){a[0]=g[0]+l[0]*f;a[1]=g[1]+l[1]*f;a[2]=g[2]+l[2]*f;a[3]=g[3]+l[3]*f;a[4]=g[4]+l[4]*f;a[5]=g[5]+l[5]*f;a[6]=g[6]+l[6]*f;a[7]=g[7]+l[7]*f;a[8]=g[8]+l[8]*f;return a};a.exactEquals=function(a,g){return a[0]===g[0]&&a[1]===g[1]&&a[2]===g[2]&&a[3]===g[3]&&
a[4]===g[4]&&a[5]===g[5]&&a[6]===g[6]&&a[7]===g[7]&&a[8]===g[8]};a.equals=function(a,g){var d=a[0],f=a[1],c=a[2],b=a[3],e=a[4],p=a[5],h=a[6],k=a[7];a=a[8];var w=g[0],u=g[1],v=g[2],y=g[3],t=g[4],x=g[5],z=g[6],A=g[7];g=g[8];return Math.abs(d-w)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(f-u)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(u))&&Math.abs(c-v)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(b-y)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(y))&&Math.abs(e-t)<=m.EPSILON*
Math.max(1,Math.abs(e),Math.abs(t))&&Math.abs(p-x)<=m.EPSILON*Math.max(1,Math.abs(p),Math.abs(x))&&Math.abs(h-z)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(k-A)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(a-g)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))};a.mul=k;a.sub=h})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){var q=p.assert,r=h.mat4f64.create();n=function(){function a(b){void 0===b&&(b={});this._objectTransformation=h.mat4f64.create();this._bvObjectSpace=new u;this._bvWorldSpace=new u;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;this.id=a._idGen.gen(b.idHint);this.castShadow=null!=b.castShadow?b.castShadow:!0;(this.metadata=b.metadata)&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=
new w);this.objectTransformation=h.mat4f64.create();this._initializeGeometryRecords(b.geometries,b.materials,b.transformations,b.origins)}Object.defineProperty(a.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometries",{get:function(){return this._geometries},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(b){k.mat4.copy(this._objectTransformation,
b);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0});a.prototype.dispose=function(){for(var b=0,a=this._geometryRecords;b<a.length;b++)c.pool.release(a[b]);this._geometries=this._geometryRecords=null};a.prototype._initializeGeometryRecords=function(b,a,d,e){if(Array.isArray(b)){q(a.length===b.length,"Object3D: materials don't match geometries");q(d.length===b.length,"Object3D: transformations don't match geometries");this._geometryRecords=Array(b.length);
this._geometries=b.slice();for(var f=0;f<b.length;f++)this._geometryRecords[f]=c.pool.acquire(b[f],a[f],h.mat4f64.clone(d[f]),{},e&&e[f]);this._hasVolatileTransformation=!1}else this._geometryRecords=[],this._geometries=[]};Object.defineProperty(a.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(b){q(null==this._parentLayer||null==b,"Object3D can only be added to a single Layer");this._parentLayer=b},enumerable:!0,configurable:!0});a.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length};
a.prototype.findGeometryRecords=function(b){for(var a=[],c=0;c<this._geometries.length;c++)this._geometries[c]===b&&a.push(this._geometryRecords[c]);return a};a.prototype.getGeometryRecord=function(b){q(0<=b&&b<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[b]};a.prototype.addGeometry=function(b,a,d,e,f,g){d=d?h.mat4f64.clone(d):r;this._geometries.push(b);b=c.pool.acquire(b,a,d,e||{},f,g);this._geometryRecords.push(b);this._hasVolatileTransformation=
this._geometryRecords.some(function(b){return!!b.shaderTransformation});this._notifyDirty("objGeometryAdded",b);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return b};a.prototype.removeGeometry=function(b){var a=this._geometryRecords.splice(b,1)[0];c.pool.release(a);this._hasVolatileTransformation=this._geometryRecords.some(function(b){return!!b.shaderTransformation});this._geometries.splice(b,1);this._notifyDirty("objGeometryRemoved",a);this._invalidateBoundingVolume();
this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return a};a.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};a.prototype.geometryVertexAttrsUpdated=function(b){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[b]);this._invalidateBoundingVolume()};a.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var b=0,a=this._geometryRecords;b<
a.length;b++){var c=a[b];if(!f.isAllHidden(c.instanceParameters.componentVisibilities,c.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};a.prototype.areAllComponentsVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1;this._allComponentsVisible=!0;for(var b=0,a=this._geometryRecords;b<a.length;b++){var c=a[b];if(!f.isAllVisible(c.instanceParameters.componentVisibilities,c.geometry.data.componentOffsets)){this._allComponentsVisible=
!1;break}}}return this._allComponentsVisible};a.prototype.hasComponents=function(){for(var b=!1,a=0;a<this._geometries.length&&!(b=f.hasComponents(this._geometries[a].data.componentOffsets));a++);return b};a.prototype.setComponentVisibility=function(b,a,c){a=f.updateVisibility(b.instanceParameters.componentVisibilities,b.geometry.data.componentOffsets,a,c);b.instanceParameters.componentVisibilities=a;this._notifyDirty("visibilityChanged",b);this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=
!0};a.prototype.setHidden=function(b,a){b.instanceParameters.hidden=!!a;this._notifyDirty("visibilityChanged",b)};a.prototype.isHidden=function(b){return!!b.instanceParameters.hidden};a.prototype.getComponentVisibility=function(b,a){return f.getVisibility(b.instanceParameters.componentVisibilities,a)};a.prototype.hideAllComponents=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var b=0,a=this._geometryRecords;b<a.length;b++){var c=a[b],d=f.hideAllComponents(c.instanceParameters.componentVisibilities);
c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged");this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;this._allComponentsVisible=!1}};a.prototype.unhideAllComponents=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var b=0,a=this._geometryRecords;b<a.length;b++){var c=a[b],d=f.unhideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged");
this._allComponentsHidden=this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsVisible=!0}};a.prototype._setComponentHighlight=function(b,a,c,d){a=f.addHighlight(b.instanceParameters.componentHighlights,a,c,d);b.instanceParameters.componentHighlights=a};a.prototype.setComponentHighlight=function(a,c,d){var e=b.generateHighlightId();this._setComponentHighlight(a,c,d,e);this._notifyDirty("componentHighlightChanged");return e};a.prototype.highlightAllComponents=function(a){for(var c=
b.generateHighlightId(),d=0,e=this._geometryRecords;d<e.length;d++)this._setComponentHighlight(e[d],null,a,c);this._notifyDirty("componentHighlightChanged");return c};a.prototype.removeHighlights=function(b){for(var a=0,c=this._geometryRecords;a<c.length;a++){var d=c[a].instanceParameters,e=f.removeHighlight(d.componentHighlights,b);d.componentHighlights=e}this._notifyDirty("componentHighlightChanged")};a.prototype.getComponentFromTriangleNr=function(b,a){q(0<=b&&b<this._geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");
return f.componentFind(this._geometryRecords[b].geometry.data.componentOffsets,3*a)};a.prototype.setGeometryTransformation=function(b,a){q(0<=b&&b<this._geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this._geometryRecords[b];c.pool.release(d);a=c.pool.acquire(d.geometry,d.material,h.mat4f64.clone(a),d.instanceParameters);this._geometryRecords[b]=a;this._notifyDirty("objGeometryReplaced",[d,a]);this._invalidateBoundingVolume()};a.prototype.getCombinedStaticTransformation=
function(b,a){a=a||h.mat4f64.create();k.mat4.multiply(a,this.objectTransformation,b.getStaticTransformation());return a};a.prototype.getCombinedShaderTransformation=function(b,a){a=a||h.mat4f64.create();k.mat4.multiply(a,this.objectTransformation,b.getShaderTransformation());return a};a.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};a.prototype.getMetadata=function(){return this.metadata};a.prototype.getBBMin=function(b){this._validateBoundingVolume();return b?
this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};a.prototype.getBBMax=function(b){this._validateBoundingVolume();return b?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};a.prototype.getCenter=function(b){this._validateBoundingVolume();return b?this._bvObjectSpace.center:this._bvWorldSpace.center};a.prototype.getBSRadius=function(b){this._validateBoundingVolume();return b?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};a.prototype._validateBoundingVolume=function(){if(this._bvDirty||
this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var b=0;b<this._geometryRecords.length;++b){var a=this._geometries[b],c=this._geometryRecords[b],a=a.boundingInfo;this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,c.getShaderTransformation());this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this.getCombinedShaderTransformation(c))}d.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);d.vec3.lerp(this._bvWorldSpace.center,
this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var c=g.vec3f64.create(),e=g.vec3f64.create(),f=l.maxScale(this.objectTransformation),b=0;b<this._geometryRecords.length;++b){var a=this._geometries[b],p=this._geometryRecords[b].getShaderTransformation(),h=l.maxScale(p),a=a.boundingInfo;d.vec3.transformMat4(c,a.getCenter(),p);p=d.vec3.distance(c,this._bvObjectSpace.center);a=a.getBSRadius()*h;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,p+a);d.vec3.transformMat4(e,c,
this.objectTransformation);h=d.vec3.distance(e,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,h+a*f)}this._bvDirty=!1}};a.prototype._calculateTransformedBoundingVolume=function(b,a,c){var e=b.getBBMin();b=b.getBBMax();var f=g.vec3f64.clone(e),l=g.vec3f64.clone(b);d.vec3.transformMat4(f,f,c);d.vec3.transformMat4(l,l,c);for(var p=0;3>p;++p)a.bbMin[p]=Math.min(a.bbMin[p],f[p],l[p]),a.bbMax[p]=Math.max(a.bbMax[p],f[p],l[p]);for(p=0;3>p;++p){d.vec3.copy(f,e);
d.vec3.copy(l,b);f[p]=b[p];l[p]=e[p];d.vec3.transformMat4(f,f,c);d.vec3.transformMat4(l,l,c);for(var h=0;3>h;++h)a.bbMin[h]=Math.min(a.bbMin[h],f[h],l[h]),a.bbMax[h]=Math.max(a.bbMax[h],f[h],l[h])}};a.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};a.prototype._notifyDirty=function(b,a,c,d){this._parentLayer&&this._parentLayer.notifyDirty(b,a,c||1,
d||this)};Object.defineProperty(a.prototype,"test",{get:function(){var b=this;return{hasGeometry:function(a){return-1<b._geometries.indexOf(a)},getGeometryIndex:function(a){return b._geometries.indexOf(a)}}},enumerable:!0,configurable:!0});a._idGen=new e.IdGen;return a}();var w=function(){function b(){this.bbMin=g.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=g.vec3f64.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}b.prototype.isEmpty=function(){return this.bbMax[0]<
this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]};return b}(),u=function(b){function a(){var a=b.call(this)||this;a.center=g.vec3f64.create();a.bsRadius=0;return a}m(a,b);a.prototype.init=function(){d.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);d.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);d.vec3.set(this.center,0,0,0);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};
return a}(w);return n})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","../../../../core/ObjectPool","./IdGen"],function(n,a,m,k){return function(){function a(d,g,l,f,c,b){this.id=a._idGen.gen(d&&d.id);this.geometry=d;this.material=g;this.transformation=l;this.instanceParameters=f;this.origin=c;this.shaderTransformation=b}a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.shaderTransformation?
this.shaderTransformation(this.transformation):this.transformation};a._idGen=new k.IdGen;a.pool=new m(a,!0);return a}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._count=0}a.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return a}();a.IdGen=n})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});var k=new m.IdGen;a.generateHighlightId=function(){return k.gen("highlight")}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){function p(b,a,c,d,e){void 0===c&&(c=f.defaultApplyOptions);void 0===d&&(d=a);void 0===e&&(e=!0);a!==d&&d.copyFrom(a);A.eyeCenterDistance=0;A.requiresTwoSteps=!1;var l=q(b,a,c,void 0,A);if(0===l)return!1;h.mat4.identity(v);h.mat4.rotate(v,v,-l,a.viewRight);switch(c.tiltMode){case 1:g.vec3.transformMat4(u,a.viewForward,v);g.vec3.scale(u,u,A.eyeCenterDistance);g.vec3.add(d.center,a.eye,u);break;case 0:g.vec3.subtract(u,a.center,a.eye);g.vec3.transformMat4(u,u,v);g.vec3.subtract(d.eye,
a.center,u);break;default:m.neverReached(c.tiltMode)}g.vec3.transformMat4(d.up,d.up,v);d.markViewDirty();return A.requiresTwoSteps&&e?p(b,d,c,d,!1):!0}function q(a,d,l,p,h){void 0===l&&(l=f.defaultApplyOptions);void 0===p&&(p=f.defaultApplyOptions);if(!a.state.constraints.tilt)return 0;var u=a.state.constraints.tilt(d.distance,x);var v=l;if(0!==v.interactionType){var A=v.interactionStartCamera,n=v.interactionFactor,E=u.min,B=u.max,G=q(a,A,f.defaultApplyOptions,v),K=0===G?0:c.viewAngle(a.renderCoordsHelper,
A.center,A.eye);u.min=E;u.max=B;2===v.interactionType?(f.hasConstraintType(v.selection,2)&&w(a,A,u),f.adjustRangeForInteraction(G,K,!0,n,t,u)):f.adjustRangeForInteraction(G,K,!1,n,t,u)}2===p.interactionType&&f.hasConstraintType(p.selection,2)&&w(a,p.interactionStartCamera,u);if(1===l.tiltMode||1===p.tiltMode){a:switch(h&&(h.requiresTwoSteps=!1),a.viewingMode){case "global":l=z;v=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;p=v+b.earthRadius;v=a.renderCoordsHelper.intersectManifold(d.ray,
v,y);l.eyeCenterDistance=d.distance;v?(l.eyeCenterDistance=g.vec3.distance(d.eye,y),l.tiltAtCenter=c.viewAngle(a.renderCoordsHelper,y,d.eye)):a.state.isLocal?l.tiltAtCenter=c.viewAngle(a.renderCoordsHelper,d.center,d.eye):(e.sphere.closestPointOnSilhouette(e.sphere.wrap(p),d.ray,y),l.eyeCenterDistance=g.vec3.distance(d.eye,y),l.tiltAtCenter=k.acosClamped(-g.vec3.dot(d.viewForward,g.vec3.normalize(y,y))));l.radius=p;l.eyeRadius=g.vec3.length(d.eye);l.constraints=a.state.constraints;l.centerIsOnSurface=
v;d=k.clamp(l.tiltAtCenter,u.min,u.max);if(1E-9<Math.abs(l.tiltAtCenter-d)){if(l.centerIsOnSurface){d=l.constraints;a=p=l.tiltAtCenter;u=d.clampTilt(l.eyeCenterDistance,p);v=r(l,u);if(d.clampTilt(v,p)!==u)for(p=0;10>p&&1E-9<Math.abs(u-a);)v=(a+u)/2,A=r(l,v),A=d.clampTilt(A,v),1E-9<Math.abs(A-v)?a=v:u=v,p++;d=u;u=d;a=k.asinClamped(l.radius/l.eyeRadius*Math.sin(l.tiltAtCenter));u=k.asinClamped(l.radius/l.eyeRadius*Math.sin(u));a=l.eyeRadius>l.radius?a-u:u-a}else d=l.constraints.clampTilt(l.eyeCenterDistance,
l.tiltAtCenter),h&&d<Math.PI/2&&(h.requiresTwoSteps=!0,d=Math.PI/2-1E-5),a=l.tiltAtCenter-Math.PI/2-(d-Math.PI/2);h&&(h.eyeCenterDistance=r(l,d));h=a}else h=0;break a;case "local":p=c.viewAngle(a.renderCoordsHelper,d.center,d.eye);l=k.clamp(p,u.min,u.max);u=p-l;1E-9<Math.abs(u)?(h&&(p=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a=a.renderCoordsHelper.getAltitude(d.eye)-p,l=Math.cos(l),h.eyeCenterDistance=1E-4<Math.abs(l)?a/l:d.distance),h=u):h=0;break a;default:m.neverReached(a.viewingMode),
h=void 0}return h}h=c.viewAngle(a.renderCoordsHelper,d.center,d.eye);d=k.clamp(h,u.min,u.max);h-=d;h=1E-9<Math.abs(h)?h:0;return h}function r(b,a){if(!b.centerIsOnSurface)return b.eyeCenterDistance;a=Math.PI-k.clamp(a,0,Math.PI);var c=k.asinClamped(b.radius/b.eyeRadius*Math.sin(a)),d=Math.sin(Math.PI-a-c)/Math.sin(a);return b.eyeRadius<b.radius&&1<d?Math.sin(Math.PI-a-(Math.PI-c))/Math.sin(a)*b.eyeRadius:d*b.eyeRadius}function w(a,c,d){if(!a.state.isLocal){var e=a.state.constraints;if(e.altitude){a=
g.vec3.squaredLength(c.center);var f=Math.sqrt(a);c=c.distance;var l=e.altitude.min+b.earthRadius,e=e.altitude.max+b.earthRadius,l=(l*l-c*c-a)/(-2*f*c);d.min=Math.max(d.min,Math.min(Math.PI-k.acosClamped((e*e-c*c-a)/(-2*f*c)),d.max));d.max=Math.min(d.max,Math.PI-k.acosClamped(l))}}}Object.defineProperty(a,"__esModule",{value:!0});a.apply=p;a.error=q;var u=l.vec3f64.create(),v=d.mat4f64.create(),y=l.vec3f64.create(),t=k.deg2rad(5),x={min:0,max:0},z={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,
eyeCenterDistance:0,tiltAtCenter:0},A={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});a.viewAngle=function(a,f,c){a.worldUpAtPosition(f,d);k.vec3.subtract(g,c,f);a=k.vec3.length(g);return 0===a?0:m.acosClamped(k.vec3.dot(g,d)/a)};var d=h.vec3f64.create(),
g=h.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require","exports"],function(n,a){function m(a){return a}function k(a){var d=2*(a-Math.sqrt((a-1)*a)),l=d/2/a;return function(f){return f<l?a*f*f:d*f-d+1}}function h(a,g){return function(d){return d<g?g*a(d/g):1-a((1-d)/(1-g))*(1-g)}}Object.defineProperty(a,"__esModule",{value:!0});a.linear=m;a.inQuad=function(a){return a*a};a.outQuad=function(d){return 1-a.inQuad(1-d)};a.inOutQuad=function(d){return.5>d?a.inQuad(2*d)/2:(a.outQuad(2*
(d-.5))+1)/2};a.inCubic=function(a){return a*a*a};a.outCubic=function(d){return 1-a.inCubic(1-d)};a.inOutCubic=function(d){return.5>d?a.inCubic(2*d)/2:(a.outCubic(2*(d-.5))+1)/2};a.inQuart=function(a){return a*a*a*a};a.outQuart=function(d){return 1-a.inQuart(1-d)};a.inOutQuart=function(d){return.5>d?a.inQuart(2*d)/2:(a.outQuart(2*(d-.5))+1)/2};a.inQuint=function(a){return a*a*a*a*a};a.outQuint=function(d){return 1-a.inQuint(1-d)};a.inOutQuint=function(d){return.5>d?a.inQuint(2*d)/2:(a.outQuint(2*
(d-.5))+1)/2};a.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};a.outSine=function(d){return 1-a.inSine(1-d)};a.inOutSine=function(d){return.5>d?a.inSine(2*d)/2:(a.outSine(2*(d-.5))+1)/2};a.inExpo=function(a){return Math.pow(2,10*(a-1))};a.outExpo=function(d){return 1-a.inExpo(1-d)};a.inOutExpo=function(d){return.5>d?a.inExpo(2*d)/2:(a.outExpo(2*(d-.5))+1)/2};a.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};a.outCirc=function(d){return 1-a.inCirc(1-d)};a.inOutCirc=function(d){return.5>d?a.inCirc(2*
d)/2:(a.outCirc(2*(d-.5))+1)/2};a.inCoastQuad=h(k(1),1);a.outCoastQuad=h(k(1),0);a.inOutCoastQuad=h(k(1),.5);a.inCoastCubic=h(k(2),1);a.outCoastCubic=h(k(2),0);a.inOutCoastCubic=h(k(2),.5);a.inCoastQuart=h(k(3),1);a.outCoastQuart=h(k(3),0);a.inOutCoastQuart=h(k(3),.5);a.inCoastQuint=h(k(4),1);a.outCoastQuint=h(k(4),0);a.inOutCoastQuint=h(k(4),.5);a.named={linear:m,"in-quad":a.inQuad,"out-quad":a.outQuad,"in-out-quad":a.inOutQuad,"in-coast-quad":a.inCoastQuad,"out-coast-quad":a.outCoastQuad,"in-out-coast-quad":a.inOutCoastQuad,
"in-cubic":a.inCubic,"out-cubic":a.outCubic,"in-out-cubic":a.inOutCubic,"in-coast-cubic":a.inCoastCubic,"out-coast-cubic":a.outCoastCubic,"in-out-coast-cubic":a.inOutCoastCubic,"in-quart":a.inQuart,"out-quart":a.outQuart,"in-out-quart":a.inOutQuart,"in-coast-quart":a.inCoastQuart,"out-coast-quart":a.outCoastQuart,"in-out-coast-quart":a.inOutCoastQuart,"in-quint":a.inQuint,"out-quint":a.outQuint,"in-out-quint":a.inOutQuint,"in-coast-quint":a.inCoastQuint,"out-coast-quint":a.outCoastQuint,"in-out-coast-quint":a.inOutCoastQuint,
"in-sine":a.inSine,"out-sine":a.outSine,"in-out-sine":a.inOutSine,"in-expo":a.inExpo,"out-expo":a.outExpo,"in-out-expo":a.inOutExpo,"in-circ":a.inCirc,"out-circ":a.outCirc,"in-out-circ":a.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(n,a,
m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(b,c,d){d=a.call(this,d)||this;d.viewState=b;d.intersectionHelper=c;d.hasTarget=!1;d.animation=new h.default(d.viewState.mode);return d}m(b,a);b.prototype.begin=function(b,a){this.hasTarget=!0;a=this.animationSettings(a);l.copyFrom(this.viewState.camera);this.intersectionHelper.intersectRay(l.ray,f)&&(l.center=f);this.animation.update(l,b,a);this.animation.finished&&this.finish()};b.prototype.finish=function(){this.animation.currentTime=
this.animation.time;a.prototype.finish.call(this)};Object.defineProperty(b.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,c){a.prototype.stepController.call(this,b,c);this.hasTarget&&this.animation.step(b,c)};b.prototype.onControllerEnd=function(b){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,b),this.animation.currentTime=this.animation.time);
a.prototype.onControllerEnd.call(this,b)};b.prototype.animationSettings=function(b){void 0===b&&(b={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:b.speedFactor,duration:b.duration,maxDuration:b.maxDuration,easing:b.easing}};return b}(d.AnimationController);a.PointToPointAnimationController=n;var l=new g.default,f=k.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});var f=h.vec3f64.create();n=function(){function a(b){this.currentTime=0;this.animation=new l.Animation(function(){return new d.default(b)});this._current=new d.default(b)}Object.defineProperty(a.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});
a.prototype.update=function(b,a,c){var d=this.animation.definition.source,e=this.animation.definition.target,g=k.vec3.subtract(f,a.center,b.center),l=k.vec3.length(g);1E-5<=l?(g[0]/=l,g[1]/=l,g[2]/=l):(g[0]=0,g[1]=1,g[0]=0);k.vec3.copy(d.lookAtDirection,g);k.vec3.copy(e.lookAtDirection,g);d.copyFromRenderCamera(b);e.copyFromRenderCamera(a);this._current.copyFrom(d);this.animation.update(d,e,c);this.currentTime=0;b.almostEquals(a,5E-4,!0)&&(this.currentTime=this.animation.time)};a.prototype.cameraAt=
function(b,a){this.animation.cameraAt(b,this._current);a=a||new g.default;this._current.copyToRenderCamera(a);return a};a.prototype.step=function(b,a){this.finished||(this.currentTime+=b,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,a)};return a}();a.Animation=n;a.default=n})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});var f=g.vec3f64.create(),c=g.vec3f64.create(),b=g.vec3f64.create(),e=g.vec3f64.create(),p=g.vec3f64.create(),q=g.vec3f64.create(),r=g.vec3f64.fromValues(0,0,1),w=g.vec3f64.fromValues(0,1,0),u=g.vec3f64.fromValues(1,0,0),v=h.mat3f64.create();n=function(){function a(b){void 0===b&&(b="global");this.viewingMode=b;this.center=g.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=g.vec3f64.clone(w)}a.prototype.pixelsPerPanAtZoom=
function(b){return this.size/2/(this._zoomToPanScale*b)};a.prototype.zoomAtPixelsPerPan=function(b){return this.size/2/(this._zoomToPanScale*b)};a.prototype.pixelsPerRotateAtZoom=function(b){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(b,a){a||(a={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var c=d.vec3.length(this.center),e=d.vec3.length(b.center),c=(c+e)/2;a.pan=l.angle(this.center,b.center)*c}else a.pan=d.vec3.distance(this.center,
b.center);c=Math.abs(b.yaw-this.yaw);c>=Math.PI&&(c=2*Math.PI-c);a.rotate=Math.max(c,Math.abs(b.pitch-this.pitch));a.sourceZoom=this.distance;a.targetZoom=b.distance;return a};a.prototype.interpolate=function(b,a,c){"global"===this.viewingMode?l.slerp(b.center,a.center,c.pan,this.center):d.vec3.lerp(this.center,b.center,a.center,c.pan);this.distance=m.lerp(b.distance,a.distance,c.zoom);this.pitch=m.lerp(b.pitch,a.pitch,c.rotate);b=b.yaw;a=a.yaw;Math.abs(a-b)>=Math.PI&&(b+=2*(b<a?1:-1)*Math.PI);this.yaw=
m.lerp(b,a,c.rotate)};a.prototype.copyFrom=function(b){d.vec3.copy(this.center,b.center);this.pitch=b.pitch;this.yaw=b.yaw;this.distance=b.distance;d.vec3.copy(this.lookAtDirection,b.lookAtDirection);this.size=b.size;this.copyFromCommon(b);this.viewingMode=b.viewingMode};a.prototype.copyFromRenderCamera=function(b){var a=this._lookAtOrientation(b.center,v);d.vec3.copy(this.center,b.center);d.vec3.subtract(e,b.center,b.eye);d.vec3.transformMat3(e,e,a);d.vec3.transformMat3(p,b.up,a);this.distance=d.vec3.length(e);
e[0]/=this.distance;e[1]/=this.distance;e[2]/=this.distance;this.pitch=this._eyeUpToPitch(e,p);this.yaw=this._eyeUpToYaw(e,p);this.size=Math.sqrt(b.width*b.width+b.height*b.height);this.copyFromCommon(b)};a.prototype.copyFromCommon=function(b){this.fov=b.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(b){var a=this._lookAtOrientation(this.center,v);k.mat3.transpose(a,a);this._axisAngleVec3(u,this.pitch-Math.PI/2,w,e);this._axisAngleVec3(r,this.yaw,e);this._axisAngleVec3(u,
this.pitch-Math.PI/2,r,p);this._axisAngleVec3(r,this.yaw,p);d.vec3.scale(e,e,this.distance);d.vec3.transformMat3(e,e,a);d.vec3.transformMat3(p,p,a);b.center=this.center;b.eye=d.vec3.subtract(e,this.center,e);b.up=p};a.prototype._axisAngleVec3=function(a,e,g,l){void 0===l&&(l=g);var p=Math.cos(e);e=Math.sin(e);d.vec3.scale(f,g,p);d.vec3.cross(c,a,g);d.vec3.scale(c,c,e);d.vec3.scale(b,a,(1-p)*d.vec3.dot(a,g));return d.vec3.add(l,d.vec3.add(l,f,c),b)};a.prototype._lookAtOrientation=function(a,e){this._upAtLookAt(a,
b);d.vec3.cross(f,this.lookAtDirection,b);d.vec3.normalize(f,f);0===f[0]&&0===f[1]&&0===f[2]&&d.vec3.copy(f,u);d.vec3.cross(c,b,f);d.vec3.normalize(c,c);e||(e=h.mat3f64.create());e[0]=f[0];e[1]=c[0];e[2]=b[0];e[3]=f[1];e[4]=c[1];e[5]=b[1];e[6]=f[2];e[7]=c[2];e[8]=b[2];return e};a.prototype._upAtLookAt=function(b,a){return"local"===this.viewingMode?d.vec3.copy(a,r):d.vec3.normalize(a,b)};a.prototype._eyeUpToPitch=function(b,a){return Math.PI-l.angle(r,b)};a.prototype._eyeUpToYaw=function(b,a){.5>Math.abs(a[2])?
(d.vec3.copy(q,a),0<b[2]&&d.vec3.scale(q,q,-1)):d.vec3.copy(q,b);d.vec3.cross(c,q,r);d.vec3.normalize(c,c);return l.angle(u,c,r)};return a}();a.default=n})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(b,a){var c=a[0]-b[0],d=a[1]-b[1],e=a[2]-b[2];b=a[3]-b[3];return c*c+d*d+e*e+b*b}function w(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]}function u(b,a){return b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]&&b[3]===a[3]}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,e,f){void 0===a&&(a=l.vec3f64.create());void 0===e&&(e=l.vec3f64.create());void 0===f&&(f=l.vec3f64.fromValues(0,0,1));this._viewUp=l.vec3f64.create();this._viewForward=
l.vec3f64.create();this._viewRight=l.vec3f64.create();this._ray=b.ray.createWrapper();this._viewport=c.vec4f64.fromValues(0,0,1,1);this._padding=c.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._near=1;this._far=1E3;this._viewDirty=!0;this._viewMatrix=d.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=d.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=d.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=d.mat4f64.create();
this._frustumDirty=!0;this._frustum=b.frustum.create();this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=l.vec3f64.clone(a);this._center=l.vec3f64.clone(e);this._up=l.vec3f64.clone(f);this._padding=c.vec4f64.create()}Object.defineProperty(a.prototype,"eye",{get:function(){return this._eye},set:function(b){this._compareAndSetView(b,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"center",{get:function(){return this._center},set:function(b){this._compareAndSetView(b,
this._center)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=l.vec3f64.create());g.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"up",{get:function(){return this._up},set:function(b){this._compareAndSetView(b,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewMatrix",
{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(b){h.mat4.copy(this._viewMatrix,b);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"near",{get:function(){return this._near},set:function(b){this._near!==b&&(this._near=b,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"far",{get:function(){return this._far},set:function(b){this._far!==
b&&(this._far=b,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewport",{get:function(){return this._viewport},set:function(b){this.x=b[0];this.y=b[1];this.width=b[2];this.height=b[3]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this._viewport[0]},set:function(b){b+=this._padding[3];this._viewport[0]!==b&&(this._viewport[0]=b,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this._viewport[1]},set:function(b){b+=this._padding[2];this._viewport[1]!==b&&(this._viewport[1]=b,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._viewport[2]},set:function(b){this._viewport[2]!==b&&(this._viewport[2]=b,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._viewport[3]},set:function(b){this._viewport[3]!==b&&(this._viewport[3]=b,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(b){this.width=b-(this._padding[1]+this._padding[3])},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(b){this.height=b-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=c.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=
this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"padding",{get:function(){return this._padding},set:function(b){if(this._padding[0]!==b[0]||this._padding[1]!==b[1]||this._padding[2]!==b[2]||this._padding[3]!==b[3])this._viewport[0]+=b[3]-this._padding[3],this._viewport[1]+=b[2]-this._padding[2],
this._viewport[2]-=b[1]+b[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=b[0]+b[2]-(this._padding[0]+this._padding[2]),f.vec4.copy(this._padding,b),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(h.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var b=this.width,a=this.height,c=this.near*Math.tan(this.fovY/2),d=c*this.aspect;h.mat4.frustum(this._projectionMatrix,-d*(1+2*this._padding[3]/b),d*(1+2*this._padding[1]/b),-c*(1+2*this._padding[2]/a),c*(1+2*this._padding[0]/a),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(b){h.mat4.copy(this._projectionMatrix,b);this._projectionDirty=
!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fov",{get:function(){return this._fov},set:function(b){this._fov=b;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fovX",{get:function(){return q.fovd2fovx(this._fov,this.width,this.height)},set:function(b){this._fov=q.fovx2fovd(b,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fovY",{get:function(){return q.fovd2fovy(this._fov,this.width,this.height)},set:function(b){this._fov=q.fovy2fovd(b,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return g.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=d.mat4f64.create()),h.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),h.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});
a.prototype.copyFrom=function(a){g.vec3.copy(this._eye,a._eye);g.vec3.copy(this._center,a._center);g.vec3.copy(this._up,a._up);f.vec4.copy(this._viewport,a._viewport);f.vec4.copy(this._padding,a._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(h.mat4.copy(this._viewMatrix,a._viewMatrix),g.vec3.copy(this._viewRight,a._viewRight),g.vec3.copy(this._viewUp,a._viewUp),g.vec3.copy(this._viewForward,a._viewForward));
a._projectionDirty?this._projectionDirty=!0:(h.mat4.copy(this._projectionMatrix,a._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(b.frustum.copy(a._frustum,this._frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?h.mat4.copy(this._viewInverseTransposeMatrix,a._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=d.mat4f64.clone(a._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?f.vec4.copy(this._fullViewport,a._fullViewport):this._fullViewport=c.vec4f64.clone(a._fullViewport):this._fullViewport=null;this.pixelRatio=a.pixelRatio;return this};a.prototype.copyViewFrom=function(b){this.eye=b.eye;this.center=b.center;this.up=b.up};a.prototype.clone=function(){var b=new a;b.copyFrom(this);return b};a.prototype.equals=function(b){return w(this._eye,b._eye)&&w(this._center,b._center)&&w(this._up,b._up)&&
u(this._viewport,b._viewport)&&u(this._padding,b._padding)&&this._near===b._near&&this._far===b._far&&this._fov===b._fov&&this.pixelRatio===b.pixelRatio&&this.relativeElevation===b.relativeElevation};a.prototype.almostEquals=function(b,a,c){void 0===c&&(c=!1);a=g.vec3.distance(this._eye,this._center)*(a||5E-4);a*=a;c?(e.directionFromTo(t,b._eye,b._center),e.directionFromTo(x,this._eye,this._center),c=1E-10):(g.vec3.copy(t,b._center),g.vec3.copy(x,this._center),c=a);return g.vec3.squaredDistance(b._eye,
this._eye)<a&&g.vec3.squaredDistance(t,x)<c&&.001>Math.abs(b._fov-this._fov)&&.5>r(b._padding,this._padding)&&.5>r(b._viewport,this._viewport)&&this.pixelRatio===b.pixelRatio};a.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};a.prototype.computeRenderPixelSizeAt=function(b){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(b))};a.prototype.computeRenderPixelSizeAtDist=function(b){return b*this.perRenderPixelRatio};a.prototype.computeScreenPixelSizeAt=
function(b){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(b))};a.prototype.viewDirectionDistance=function(b){return Math.abs(p.projectPointSignedLength(this.viewForward,g.vec3.subtract(t,b,this._eye)))};a.prototype.computeScreenPixelSizeAtDist=function(b){return b*this.perScreenPixelRatio};a.prototype.computeDistanceFromRadius=function(b,a){return b/Math.tan(Math.min(this.fovX,this.fovY)/(2*(a||1)))};a.prototype.getScreenCenter=function(b){void 0===b&&(b=k.createScreenPointArray());
b[0]=(this.padding[3]+this.width/2)/this.pixelRatio;b[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return b};a.prototype.getRenderCenter=function(b){b||(b=k.createRenderScreenPointArray3());b[0]=this.padding[3]+this.width/2;b[1]=this.padding[2]+this.height/2;2<b.length&&(b[2]=.5);return b};a.prototype.setGLViewport=function(b){var a=this.viewport,c=this.padding;b.setViewport(a[0]-c[3],a[1]-c[2],a[2]+c[1]+c[3],a[3]+c[0]+c[2])};a.prototype.applyProjection=function(b,a,c){void 0===c&&(c=!1);b!==
v&&g.vec3.copy(v,b);v[3]=1;c&&(a[2]=-v[2]);f.vec4.transformMat4(v,v,this.projectionMatrix);g.vec3.scale(v,v,1/Math.abs(v[3]));b=this.fullViewport;a[0]=m.lerp(0,b[0]+b[2],.5+.5*v[0]);a[1]=m.lerp(0,b[1]+b[3],.5+.5*v[1]);c||(a[2]=.5*(v[2]+1));return a};a.prototype.projectPoint=function(b,a){v[0]=b[0];v[1]=b[1];v[2]=b[2];v[3]=1;f.vec4.transformMat4(v,v,this.viewProjectionMatrix);if(0===v[3])return null;g.vec3.scale(v,v,1/Math.abs(v[3]));b=this.fullViewport;"x"in a?(a.x=m.lerp(0,b[0]+b[2],.5+.5*v[0]),
a.y=m.lerp(0,b[1]+b[3],.5+.5*v[1])):(a[0]=m.lerp(0,b[0]+b[2],.5+.5*v[0]),a[1]=m.lerp(0,b[1]+b[3],.5+.5*v[1]),2<a.length&&(a[2]=.5*(v[2]+1)));return a};a.prototype.unprojectPoint=function(b,a){h.mat4.multiply(y,this.projectionMatrix,this.viewMatrix);if(!h.mat4.invert(y,y))return null;var c=this.fullViewport;v[0]=2*(b[0]-c[0])/c[2]-1;v[1]=2*(b[1]-c[1])/c[3]-1;v[2]=2*b[2]-1;v[3]=1;f.vec4.transformMat4(v,v,y);if(0===v[3])return null;a[0]=v[0]/v[3];a[1]=v[1]/v[3];a[2]=v[2]/v[3];return a};a.prototype.computeUp=
function(b){"global"===b?this.computeUpGlobal():this.computeUpLocal()};a.prototype.screenToRender=function(b,a){var c=this.fullHeight-b[1]*this.pixelRatio;a[0]=b[0]*this.pixelRatio;a[1]=c;return a};a.prototype.renderToScreen=function(b,a){var c=(this.fullHeight-b[1])/this.pixelRatio;a[0]=b[0]/this.pixelRatio;a[1]=c;return a};a.prototype.computeUpGlobal=function(){g.vec3.subtract(t,this.center,this.eye);var b=g.vec3.length(this.center);1>b?(g.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(g.vec3.dot(t,
this.center))>.9999*g.vec3.length(t)*b||(g.vec3.cross(this.up,t,this.center),g.vec3.cross(this.up,this.up,t),g.vec3.normalize(this.up,this.up),this.markViewDirty())};a.prototype.computeUpLocal=function(){e.directionFromTo(t,this.eye,this.center);.9999>=Math.abs(t[2])&&(g.vec3.scale(t,t,t[2]),g.vec3.set(this.up,-t[0],-t[1],1-t[2]),g.vec3.normalize(this.up,this.up),this.markViewDirty())};a.prototype._compareAndSetView=function(b,a){w(b,a)||(g.vec3.copy(a,b),this._viewProjectionDirty=this._frustumDirty=
this._viewDirty=!0)};a.prototype._recomputeFrustum=function(){this._frustumDirty&&(b.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};a.prototype._ensureViewClean=function(){this._viewDirty&&(h.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),g.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),g.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),g.vec3.set(this._viewRight,
this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return a}();a.default=n;var v=c.vec4f64.create(),y=d.mat4f64.create(),t=l.vec3f64.create(),x=l.vec3f64.create()})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g={zoom:0,pan:0,rotate:0};n=function(){function a(a){this.createCamera=
a;this.time=0;this.definition=new k.Definition(a);this.path=new d.Path}a.prototype.update=function(a,c,b){this.definition.update(a,c,b);this.path.update(this.definition,b);this.time=this._applyTimeSettings(this.path.time,b);this.settings=b};a.prototype.cameraAt=function(a,c){c=c||this.createCamera();a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,a,1E3*this.time):1<=this.time?this.normalizedEasing(m.inOutCoastQuad,a):this.normalizedEasing(m.outExpo,a);
a=this.path.interpolateComponentsAt(a,g);c.interpolate(this.definition.source,this.definition.target,a);return c};a.prototype.normalizedEasing=function(a,c,b){b=a(0);var d=a(1);return(a(c)-b)/(d-b)};a.prototype._applyTimeSettings=function(a,c){var b=null!=c.speedFactor?c.speedFactor:1;null!=c.duration?a=c.duration:null!=c.speedFactor&&(a/=b);return a=Math.min(Math.max(null!=c.minDuration?c.minDuration:h.defaultSettings.minDuration/b,a),null!=c.maxDuration?c.maxDuration:h.defaultSettings.maxDuration/
b)};return a}();a.Animation=n;a.default=n})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:m.defaultSettings.desiredScreenFlow};this.source=a();this.target=a()}a.prototype.clone=function(){var h=new a(this.createCamera);h.copyFrom(this);return h};
a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,d,g){this.source!==a&&this.source.copyFrom(a);this.target!==d&&this.target.copyFrom(d);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=g.desiredScreenFlow?g.desiredScreenFlow:m.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=
function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return a}();
a.Definition=n;a.default=n})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=
function(a){function f(c,b){var e=a.call(this)||this;e._preallocSegments=[new d.default,new d.default,new d.default];e.update(c,b);return e}m(f,a);f.prototype.update=function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var c=null;b&&b.apex&&(c=g.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,b.apex)}};f.prototype.segmentInterpolateComponentsAt=function(a,
b,d){d=a.interpolateComponentsAt(b,d);a===this._ascensionSegment?d.zoom=k.outQuad(d.zoom):a===this._descensionSegment&&(d.zoom=k.inQuad(d.zoom));return d};f.prototype._updateWithApex=function(a,b){var c=this._preallocSegments,d=c[0],f=c[1],c=c[2],g=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-g,null!=b.ascensionFactor?b.descensionFactor:.5);var l=1-g-b;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=a;d.definition.compared.pan=
this.definition.compared.pan*g;d.definition.compared.rotate=this.definition.compared.rotate*g;d.update();this._ascensionSegment=d;this.segments.push(d);0<l&&(f.definition?f.definition.copyFrom(this.definition):f.definition=this.definition.clone(),f.definition.copyFrom(this.definition),f.definition.compared.sourceZoom=a,f.definition.compared.targetZoom=a,f.definition.compared.pan=this.definition.compared.pan*l,f.definition.compared.rotate=this.definition.compared.rotate*l,f.update(),this.segments.push(f));
c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*b;c.definition.compared.rotate=this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};f.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return f}(h.default);a.Path=n;a.default=n})},"esri/views/animation/pointToPoint/Path":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this.segments=[]}Object.defineProperty(a.prototype,"time",{get:function(){return this.segments.reduce(function(a,h){return a+h.time},0)},enumerable:!0,configurable:!0});a.prototype.interpolateComponentsAt=function(a,h){a=Math.min(Math.max(a,0),1);a*=this.time;for(var d=0,g=0,l=this.definition,f=0;f<this.segments.length;f++){var c=this.segments[f],b=c.definition;if(a<=c.time||f===this.segments.length-
1)return h=this.segmentInterpolateComponentsAt(c,a/c.time,h),h.pan=l.hasPan?(d+b.compared.pan*h.pan)/l.compared.pan:1,h.rotate=l.hasRotate?(g+b.compared.rotate*h.rotate)/l.compared.rotate:1,a=h.zoom*(b.compared.targetZoom-b.compared.sourceZoom)+b.compared.sourceZoom,d=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,h.zoom=l.hasZoom?(a-d)/(g-d):1,h;a-=c.time;d+=b.compared.pan;g+=b.compared.rotate}};a.prototype.segmentInterpolateComponentsAt=
function(a,h,d){return a.interpolateComponentsAt(h,d)};return a}();a.Path=n;a.default=n})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){a&&this.update(a)}a.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};a.prototype._updatePrecomputedVariables=function(){var a=
this.definition,h=a.compared,d=h.sourceZoom,g=h.targetZoom;this._zoomSign=d>g?1:-1;this._panPixelsAtSource=h.pan*a.source.pixelsPerPanAtZoom(d);a=(a.source.pixelsPerRotateAtZoom(d)+a.target.pixelsPerRotateAtZoom(g))/2;this._rotatePixels=h.rotate*a};a.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,h=this.definition.compared.targetZoom,d=this.definition,g=d.hasZoom,l=d.hasPan,d=d.hasRotate,f=0,c=0;g&&(l&&(f=(h/a-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*
Math.LN2*this._panPixelsAtSource)),d&&(c=Math.log(a/h)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;g&&l&&d?(h=f+c+f*c,this._zoomPixelFlow=f*c/h*a,this._panPixelFlow=c/h*a,this._rotatePixelFlow=f/h*a):g&&l?(h=1+f,this._zoomPixelFlow=f/h*a,this._panPixelFlow=1/h*a):g&&d?(h=1+c,this._zoomPixelFlow=c/h*a,this._rotatePixelFlow=1/h*a):l&&d?(f=this._panPixelsAtSource/this._rotatePixels,
h=1+f,this._panPixelFlow=f/h*a,this._rotatePixelFlow=1/h*a):l?this._panPixelFlow=a:g?this._zoomPixelFlow=a:d&&(this._rotatePixelFlow=a);this.time=d?this.rotateTime:g?this.zoomTime:l?this.panTime:0};Object.defineProperty(a.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,
configurable:!0});a.prototype._interpolateComponentsZoom=function(a){if(0===a||1===a)return a;if(this.definition.hasZoom){var h=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom;return(h*Math.pow(h/d,-a)-h)/(d-h)}return a};a.prototype._interpolateComponentsPan=function(a){if(0===a||1===a)return a;if(this.definition.hasPan&&this.definition.hasZoom){var h=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*
(Math.pow(2,h*a*this.time)-1)/(h*Math.LN2)}return a};a.prototype._interpolateComponentsRotate=function(a){return a};a.prototype.interpolateComponentsAt=function(a,h){a=Math.min(Math.max(a,0),1);var d=this._interpolateComponentsZoom(a),g=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);h?(h.zoom=d,h.pan=g,h.rotate=a):h={zoom:d,pan:g,rotate:a};return h};return a}();a.Segment=n;a.default=n})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports",
"./functions"],function(n,a,m){function k(a,d){var g=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<g?null!=d.maximumDistance?g+(d.maximumDistance-g)/2:1.5*g:d.maximumDistance?Math.min(d.maximumDistance,a):a}Object.defineProperty(a,"__esModule",{value:!0});a.optimalDistance=function(a,d){var g=k(a,d),l={ascensionFactor:null!=d.ascensionFactor?d.ascensionFactor:.5,descensionFactor:null!=d.descensionFactor?d.descensionFactor:
.5},f=0===l.ascensionFactor,c=0===l.descensionFactor,b=f?m.tAscensionZoomOnly:m.tAscensionZoomPan,e=f?m.dtAscensionZoomOnly:m.dtAscensionZoomPan,p=f?m.ddtAscensionZoomOnly:m.ddtAscensionZoomPan,h=c?m.tDescensionZoomOnly:m.tDescensionZoomPan,r=c?m.dtDescensionZoomOnly:m.dtDescensionZoomPan,w=c?m.ddtDescensionZoomOnly:m.ddtDescensionZoomPan,f=function(c){return b(a,l,c)+m.tPanion(a,l,c)+h(a,l,c)},c=function(b){return e(a,l,b)+m.dtPanion(a,l,b)+r(a,l,b)},u=function(b){return p(a,l,b)+m.ddtPanion(a,l,
b)+w(a,l,b)},v=f(g),y=m.tBaseLine(a),t=d.maximumIterations||20,x=null!=d.maximumDistance?d.maximumDistance:Infinity;for(d=0;d<t;d++){var z=(c(g)+1E-6)/u(g);if(isNaN(z)||g>=x&&0>z){if(!isFinite(x))return null;g=x;v=f(g);break}g-=z;if(g<a.compared.sourceZoom||g<a.compared.targetZoom)return null;z=f(g);if(.005>=Math.abs(z-v)/v)break;v=z}return v>.7*y||g<a.compared.sourceZoom||g<a.compared.targetZoom?null:g}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],
function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.tAscensionZoomPan=function(a,k,h){var d=a.halfWindowPanAtZoom(h-a.compared.sourceZoom);return-a.halfWindowSize*(k.ascensionFactor*Math.LN2*a.compared.pan+d)*Math.log(a.compared.sourceZoom/h)/(a.desiredPixelFlow*Math.LN2*d)};a.dtAscensionZoomPan=function(a,k,h){var d=1/h,g=Math.log(a.compared.sourceZoom*d),l=1/a.desiredPixelFlow,f=1/Math.LN2;h-=a.compared.sourceZoom;var c=1/h;k=(k.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(h))/
a.halfWindowPanAtZoom(1);return a.halfWindowSize*d*l*f*c*k-a.halfWindowSize*g*l*f*c+a.halfWindowSize*g*l*f*k/(h*h)};a.ddtAscensionZoomPan=function(a,k,h){var d=h-a.compared.sourceZoom,g=1/d,l=1/h,f=Math.log(a.compared.sourceZoom*l);k=(k.ascensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(d))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*g*(-2*g*l*k+2*g*f+2*l-2*f*k/(d*d)-k/(h*h))/(a.desiredPixelFlow*Math.LN2)};a.tAscensionZoomOnly=function(a,k,h){return-a.halfWindowSize*Math.log(a.compared.sourceZoom/
h)/(a.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomOnly=function(a,k,h){return a.halfWindowSize/(h*a.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomOnly=function(a,k,h){return-a.halfWindowSize/(h*h*a.desiredPixelFlow*Math.LN2)};a.tPanion=function(a,k,h){return-a.compared.pan*a.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(h))};a.dtPanion=function(a,k,h){return a.compared.pan*a.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(a.desiredPixelFlow*
a.halfWindowPanAtZoom(h*h))};a.ddtPanion=function(a,k,h){return-2*a.compared.pan*a.halfWindowSize*(k.ascensionFactor+k.descensionFactor-1)/(a.desiredPixelFlow*a.halfWindowPanAtZoom(h*h*h))};a.tDescensionZoomPan=function(a,k,h){return a.halfWindowSize*(-a.halfWindowPanAtZoom(h)-k.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))*Math.log(h/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*a.halfWindowPanAtZoom(-h+a.compared.targetZoom))};a.dtDescensionZoomPan=
function(a,k,h){var d=Math.log(h/a.compared.targetZoom),g=1/a.desiredPixelFlow,l=1/Math.LN2,f=-h+a.compared.targetZoom,c=1/f;k=(-a.halfWindowPanAtZoom(h)-k.descensionFactor*Math.LN2*a.compared.pan+a.halfWindowPanAtZoom(a.compared.targetZoom))/a.halfWindowPanAtZoom(1);return-a.halfWindowSize*d*g*l*c+a.halfWindowSize*d*g*l*k/(f*f)+a.halfWindowSize*g*l*c*k/h};a.ddtDescensionZoomPan=function(a,k,h){var d=h-a.compared.targetZoom,g=1/d,l=1/h,f=Math.log(h/a.compared.targetZoom);k=(a.halfWindowPanAtZoom(h)+
k.descensionFactor*Math.LN2*a.compared.pan-a.halfWindowPanAtZoom(a.compared.targetZoom))/a.halfWindowPanAtZoom(1);return a.halfWindowSize*g*(-2*g*l*k-2*g*f+2*l+2*f*k/(d*d)-k/(h*h))/(a.desiredPixelFlow*Math.LN2)};a.tDescensionZoomOnly=function(a,k,h){return a.halfWindowSize*Math.log(h/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomOnly=function(a,k,h){return a.halfWindowSize/(h*a.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(a,k,h){return-a.halfWindowSize/(h*
h*a.desiredPixelFlow*Math.LN2)};a.tBaseLine=function(a){var k=Math.LN2*a.compared.pan,h=a.halfWindowPanAtZoom(a.compared.sourceZoom-a.compared.targetZoom),d=a.halfWindowSize*Math.log(a.compared.sourceZoom/a.compared.targetZoom)/(a.desiredPixelFlow*Math.LN2*h);return a.compared.sourceZoom<=a.compared.targetZoom?d*(k-h):d*(k+h)}})},"esri/views/3d/state/controllers/AnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/promiseUtils ../../../ViewAnimation ./CameraController".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(d){void 0===d&&(d=new h);var c=a.call(this)||this;c.viewAnimation=d;return c}m(g,a);Object.defineProperty(g.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&this._asyncResult.reject(k.createAbortError());this._asyncResult=a;if(this.state===d.State.Finished||
this.state===d.State.Stopped)this._asyncResult=null,this.state===d.State.Finished?a.resolve():a.reject(k.createAbortError())},enumerable:!0,configurable:!0});g.prototype.onControllerStart=function(d){var c=this;a.prototype.onControllerStart.call(this,d);this.viewAnimation&&this.viewAnimation.when().catch(function(){}).then(function(){c.updateStateFromViewAnimation()})};g.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==d.State.Ready&&this.state!==d.State.Running||
(this.viewAnimation.state===h.State.FINISHED?this.finish():this.viewAnimation.state===h.State.STOPPED&&(this.state=d.State.Stopped))};g.prototype.onControllerEnd=function(f){this.viewAnimation&&(this.viewAnimation.done||(this.state===d.State.Finished?this.viewAnimation.finish():this.state===d.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===d.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(k.createAbortError()));a.prototype.onControllerEnd.call(this,
f)};g.prototype.finish=function(){this.finishController()};return g}(d.CameraController);a.AnimationController=n})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g;(function(a){a.Ready="ready";a.Rejected="rejected";
a.Running="running";a.Stopped="stopped";a.Finished="finished"})(g=a.State||(a.State={}));n=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c.state=g.Ready;return c}m(f,a);Object.defineProperty(f.prototype,"active",{get:function(){return this.state===g.Running},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"canStop",{get:function(){return!1},enumerable:!0,
configurable:!0});f.prototype.stopController=function(){return this.canStop?(this.state=g.Stopped,!0):!1};f.prototype.finishController=function(){this.state=g.Finished};f.prototype.onControllerStart=function(a){this.state=g.Running};f.prototype.onControllerEnd=function(a){};f.prototype.stepController=function(a,b){};Object.defineProperty(f.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});k([d.property({readOnly:!0,dependsOn:["state"]})],f.prototype,"active",null);
k([d.property()],f.prototype,"state",void 0);return f=k([d.subclass("esri.views.3d.state.controllers.CameraController")],f)}(d.declared(h));a.CameraController=n})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){function u(b,a,c){var d=q.sm4d.get();h.mat4.identity(d);h.mat4.rotate(d,d,c[3],c);f.vec3.subtract(b.eye,b.eye,a);f.vec3.transformMat4(b.eye,b.eye,d);f.vec3.add(b.eye,b.eye,a);f.vec3.subtract(b.center,b.center,a);f.vec3.transformMat4(b.center,b.center,d);f.vec3.add(b.center,b.center,a);f.vec3.transformMat4(b.up,b.up,d);b.markViewDirty()}function v(b,a){f.vec3.set(a,0,0,0);for(var c=0;c<b.length;c++)f.vec3.add(a,a,b[c]);f.vec3.scale(a,a,1/b.length)}function y(a,
c,d){return Math.sin(a/f.vec3.length(c))*(d+b.earthRadius)}function t(b,a,c,d){c=e.ray.fromScreenAtEye(a,c,pa);e.sphere.closestPointOnSilhouette(b,c,L);return e.sphere.intersectRay(b,c,d)?f.vec3.squaredDistance(L,c.origin)<f.vec3.squaredDistance(d,c.origin)?(f.vec3.copy(d,L),!1):!0:(f.vec3.subtract(R,a.eye,a.center),f.vec3.normalize(R,R),e.plane.fromNormalAndOffset(R,-f.vec3.dot(f.vec3.normalize(R,R),L),O),e.plane.intersectRay(O,c,d),!1)}function x(b,c,d,e,g,l){f.vec3.cross(va,b,c);f.vec3.subtract(la,
b,c);f.vec3.length(b)<=g||!e.aboveGround?(f.vec3.cross(d,la,e.eye),b=f.vec3.dot(b,c)/(f.vec3.length(b)*f.vec3.length(c)),l=Math.cos(m.clamp(p.cyclicalPI.normalize(m.deg2rad(l)),0,a.TiltThresholdPanningSpeed)),c=-m.acosClamped(b)-Math.max(0,f.vec3.length(c)-g)/(l*g)):(f.vec3.subtract(T,e.eye,e.center),f.vec3.cross(d,la,T),c=-f.vec3.length(la)/g);f.vec3.normalize(d,d);f.vec3.scale(d,d,f.vec3.length(va));return c}function z(b,c,d,e){e=Math.cos(m.clamp(p.cyclicalPI.normalize(m.deg2rad(e)),0,a.TiltThresholdPanningSpeed));
c=c>d?-(c-d)/(e*d):c<-d?Math.PI-(c+d)/(e*d):m.acosClamped(c/d);return((b>d?-(b-d)/(e*d):b<-d?Math.PI-(b+d)/(e*d):m.acosClamped(b/d))-c)*d}function A(b,a,c,d,e,l,p,h,q,k){q=z(b[2],a[2],p.radius,q);a=k?z(b[0],a[0],p.radius,180):a[0]-b[0];b=Math.sin(h)*a-Math.cos(h)*q;h=Math.cos(h)*a+Math.sin(h)*q;f.vec3.normalize(ha,e);e=k?b/Math.sqrt(Math.abs(Math.pow(p.radius,2)-Math.pow(f.vec3.dot(c,ha),2))):b/p.radius;c=h/Math.sqrt(Math.abs(Math.pow(p.radius,2)-Math.pow(f.vec3.dot(c,d),2)));g.vec2.set(l,e,c)}function E(b,
a,c,d,e,g,l,p,h,q){f.vec3.cross(va,b,a);r.coordinateSystemFromOneAxisAndNormalVector(g.up,g.eye,W,Q,Z);r.coordinateSystemFromOneAxisAndNormalVector([0,0,1],g.eye,U,P,V);f.vec3.copy(c,P);f.vec3.copy(d,U);f.vec3.normalize(c,c);f.vec3.scale(c,c,f.vec3.length(va));r.vectorCoordinates(b,f.vec3.normalize(Q,Q),f.vec3.normalize(Z,Z),f.vec3.normalize(W,W),X);r.vectorCoordinates(a,Q,Z,W,aa);A(X,aa,b,U,P,e,l,p,h,q)}function B(b,a,c,d,e,g,l){h.mat4.identity(ca);h.mat4.identity(ia);h.mat4.identity(ba);h.mat4.rotate(ca,
ca,e,d);h.mat4.rotate(ia,ia,l,g);h.mat4.multiply(ba,ca,ia);f.vec3.subtract(a,b,c);f.vec3.transformMat4(a,a,ba);f.vec3.add(a,a,c)}function G(b,a,c,d,e,g){h.mat4.identity(ca);h.mat4.identity(ia);h.mat4.identity(ba);h.mat4.rotate(ca,ca,d,c);h.mat4.rotate(ia,ia,g,e);h.mat4.multiply(ba,ca,ia);f.vec3.subtract(b.eye,b.eye,a);f.vec3.transformMat4(b.eye,b.eye,ba);f.vec3.add(b.eye,b.eye,a);f.vec3.subtract(b.center,b.center,a);f.vec3.transformMat4(b.center,b.center,ba);f.vec3.add(b.center,b.center,a);f.vec3.subtract(b.up,
b.up,a);f.vec3.transformMat4(b.up,b.up,ba);f.vec3.add(b.up,b.up,a);b.markViewDirty()}function F(b,c,d,e,f,g,l,p){void 0===l&&(l=a.PreservingHeadingThreshold.Pole);void 0===p&&(p=a.PreservingHeadingThreshold.Angle);b=Math.abs(b[2])<d*l||Math.abs(c)>d;return(Math.abs(e)>Math.PI-p||Math.abs(e)<p)&&b&&g.aboveGround&&f<a.PreservingHeadingThreshold.Tilt?!0:!1}function K(b,a,c,d,f,g){g?(e.axisAngle.fromPoints(c,d,ga),u(a,b.center,ga)):(c=x(c,d,ja,a,b.radius,f),u(a,b.center,e.axisAngle.wrapAxisAngle(ja,c)))}
function H(b,a,c,d,e,g,l){var p=l?20:1;f.vec3.copy(oa,d);ra.copyFrom(a);for(var h,q=0;q<p&&1E-12<f.vec3.squaredDistance(c,oa);q++)if(d=f.vec3.squaredDistance(c,oa),E(c,oa,P,U,da,ra,b,e,g,l),G(ra,b.center,U,da[1],P,da[0]),B(oa,oa,b.center,U,da[1],P,da[0]),h=f.vec3.squaredDistance(c,oa),h<d||0===q)a.copyFrom(ra);else break}Object.defineProperty(a,"__esModule",{value:!0});a.Earth=e.sphere.fromValues(b.earthRadius,c.vec3f64.create());a.normalizeCoordinate=function(b,a,c){c[0]=a[0]/(b.fullWidth/b.pixelRatio);
c[1]=a[1]/(b.fullHeight/b.pixelRatio);return c};a.rotationFromPointsAroundAxis=function(b,a,c){var d=q.sv3d.get(),e=q.sv3d.get(),g=q.sv3d.get();f.vec3.copy(e,b);f.vec3.copy(g,a);b=f.vec3.dot(e,c);a=f.vec3.dot(g,c);f.vec3.scale(d,c,b);f.vec3.subtract(e,e,d);f.vec3.normalize(e,e);f.vec3.scale(d,c,a);f.vec3.subtract(g,g,d);f.vec3.normalize(g,g);b=f.vec3.dot(e,g);f.vec3.cross(d,c,e);c=f.vec3.dot(g,d);return Math.atan2(c,b)};a.normalizeRotationDelta=function(b){for(;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=
2*Math.PI;return b};a.applyRotation=u;a.intersectPlaneFromScreenPoint=function(b,a,c,d){return e.plane.intersectRay(b,e.ray.fromScreen(a,c,pa),d)};a.applyZoomToPoint=function(b,a,c,d){var e=q.sv3d.get();c=1-c;f.vec3.subtract(e,a,b.eye);var g=f.vec3.length(e),l=g*(1-c);0<=c&&l<d&&(l=d,c=-(l-g)/g);1E-6>Math.abs(g-l)||(f.vec3.scale(e,e,c),f.vec3.add(b.eye,b.eye,e),f.vec3.lerp(b.center,b.center,a,c))};a.applyZoomOnSphere=function(b,a,c){a.getScreenCenter(N);e.sphere.intersectScreen(b,a,N,a.center);a.markViewDirty();
b=a.distance;c*=b;1E-6>Math.abs(b-c)||(c=f.vec3.scale(q.sv3d.get(),a.viewForward,c),f.vec3.subtract(a.eye,a.center,c),a.markViewDirty())};var N=k.createScreenPointArray();a.centroidOnSphere=function(b,a,c){v(a,c);f.vec3.normalize(c,c);f.vec3.scale(c,c,b)};a.centroid=v;a.onSurfaceTiltToEyeTiltGlobal=y;a.offSurfaceTiltToEyeTiltGlobal=function(b,a,c){return y(Math.PI/2,a,c)+(b-Math.PI/2)};var I;(function(b){b[b.Vertical=0]="Vertical";b[b.Horizontal=1]="Horizontal"})(I=a.PanMode||(a.PanMode={}));a.VerticalPanTresholds=
{Elevation:3E4,Angle:m.deg2rad(8)};a.PreservingHeadingThreshold={Pole:.95,Angle:m.deg2rad(18),Tilt:45};a.TiltThresholdPanningSpeed=m.deg2rad(80);a.pickPointAndInitSphere=function(b,d,g,l){var p=c.vec3f64.create(),h=e.sphere.create(),q=!0;b.intersectScreen(g,p)?h.radius=f.vec3.length(p):(h.radius=d.aboveGround?Math.max(f.vec3.length(d.center),.9*a.Earth.radius):f.vec3.length(d.eye)-d.relativeElevation,l?t(h,d,g,p):q=e.sphere.intersectScreen(h,d,g,p));return{sphere:h,scenePickPoint:q?p:null}};a.decidePanMode=
function(b,c,d){var e=f.vec3.length(b.eye);if(Math.abs(e-a.Earth.radius)>a.VerticalPanTresholds.Elevation)return I.Horizontal;if(b.aboveGround===c.radius>e)return I.Vertical;f.vec3.subtract(J,b.eye,d);f.vec3.normalize(J,J);return Math.abs(.5*Math.PI-m.acosClamped(f.vec3.dot(d,J)/f.vec3.length(d)))<a.VerticalPanTresholds.Angle?I.Vertical:I.Horizontal};var J=c.vec3f64.create();a.applyPanPlanar=function(b,a,c){f.vec3.subtract(M,c,a);f.vec3.subtract(b.eye,b.eye,M);f.vec3.subtract(b.center,b.center,M);
b.markViewDirty()};var M=c.vec3f64.create();a.sphereOrPlanePointFromScreenPoint=t;var L=c.vec3f64.create(),R=c.vec3f64.create(),O=e.plane.create();a.rotationAngleAndAxisDirectRotation=x;var T=c.vec3f64.create();a.lengthFromPoints=z;a.rotationAnglesHeadingPreserving=A;a.rotationAnglesAndAxesHeadingPreserving=E;a.rotatePointAroundTwoAxes=B;a.applyRotationWithTwoAxes=G;a.preserveHeadingThreshold=F;a.applyPanSphericalDirectRotation=K;a.applyPanSphericalPreserveHeading=H;a.panToPosition=function(b,c,d,
e,g,l,h){F(d,f.vec3.dot(c.up,d),b.radius,-p.cyclicalPI.normalize(m.deg2rad(g)),l,c,a.PreservingHeadingThreshold.Pole,a.PreservingHeadingThreshold.Angle)?H(b,c,d,e,-p.cyclicalPI.normalize(m.deg2rad(g)),l,h):K(b,c,d,e,l,h)};a.panMotionToRotationMatrix=function(b,a,c,d,e,g,l,k,u){if(F(b.center,f.vec3.dot(b.up,b.center),f.vec3.length(b.center),-p.cyclicalPI.normalize(m.deg2rad(g)),l,a))switch(b=-p.cyclicalPI.normalize(m.deg2rad(e)),r.coordinateSystemFromOneAxisAndNormalVector([0,0,1],a.eye,U,P,V),e=c.translation[0]*
d.pan,g=c.translation[1]*d.pan,a=Math.max(Math.sqrt(Math.abs(1-Math.pow(f.vec3.dot(a.center,U),2)/Math.pow(f.vec3.length(a.center),2))),.5),l=-Math.cos(b)*g+Math.sin(b)*e,h.mat4.rotate(k.pan.matrix,k.pan.matrix,(Math.sin(b)*g+Math.cos(b)*e)/a,U),k.pan.enabled=!0,u.mode){case "pan":h.mat4.rotate(k.pan.matrix,k.pan.matrix,l,P);k.pan.enabled=!0;break;case "zoom":k.zoom=-c.translation[1]*d.zoom}else switch(b=a.eye,a=a.viewRight,b=f.vec3.cross(q.sv3d.get(),a,b),e=c.translation[0]*d.pan,0!==e&&(h.mat4.rotate(k.pan.matrix,
k.pan.matrix,-e,b),k.pan.enabled=!0),u.mode){case "pan":c=c.translation[1]*d.pan;0!==c&&(h.mat4.rotate(k.pan.matrix,k.pan.matrix,c,a),k.pan.enabled=!0);break;case "zoom":k.zoom=-c.translation[1]*d.zoom}};var U=c.vec3f64.create(),P=c.vec3f64.create(),V=c.vec3f64.create(),W=c.vec3f64.create(),Q=c.vec3f64.create(),Z=c.vec3f64.create(),X=c.vec3f64.create(),aa=c.vec3f64.create(),da=l.vec2f64.create(),ga=e.axisAngle.create(),ca=d.mat4f64.create(),ia=d.mat4f64.create(),ba=d.mat4f64.create(),oa=c.vec3f64.create(),
ha=c.vec3f64.create(),la=c.vec3f64.create(),ra=new w.default,va=c.vec3f64.create(),ja=c.vec3f64.create(),pa={origin:c.vec3f64.create(),direction:c.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,m,k,h){function d(b){return{operations:b,value:b.create()}}function g(b,a,c,d){return b.operations.setAltitudeAt(b.value,
a,c,d)}Object.defineProperty(a,"__esModule",{value:!0});a.create=function(b){var a=b.operations;return{operations:a,value:a.create(b.value)}};a.setExtent=function(b,a,c){b.operations.setExtent(b.value,a,c.value);return c};a.createFromOperations=d;a.fromValues=function(b,a,c){void 0===c&&(c=d(b));c.operations=b;b.copy(a,c.value);return c};a.wrap=function(b,a){f.operations=b;f.value=a;return f};a.normalAt=function(b,a,c){return b.operations.axisAt(b.value,a,2,c)};a.axisAt=function(b,a,c,d){return b.operations.axisAt(b.value,
a,c,d)};a.intersectRay=function(b,a,c){return b.operations.intersectRay(b.value,a,c)};a.intersectsRay=function(b,a){return b.operations.intersectRay(b.value,a,null)};a.closestPoint=function(b,a,c){return b.operations.closestPoint(b.value,a,c)};a.intersectRayClosestSilhouette=function(b,a,c){return b.operations.intersectRayClosestSilhouette(b.value,a,c)};a.closestPointOnSilhouette=function(b,a,c){return b.operations.closestPointOnSilhouette(b.value,a,c)};a.distanceToSilhouette=function(b,a){return b.operations.distanceToSilhouette(b.value,
a)};a.altitudeAt=function(b,a){return b.operations.altitudeAt(b.value,a)};a.setAltitudeAt=g;a.setAltitudeOfTransformation=function(b,a,c,d){a!==d&&m.mat4.copy(d,a);k.vec3.set(l,d[12],d[13],d[14]);g(b,l,c,l);d[12]=l[0];d[13]=l[1];d[14]=l[2];return d};a.elevate=function(b,a,c){return b.operations.elevate(b.value,a,c.value)};var l=h.vec3f64.create(),f={operations:null,value:null};a.vectorCoordinates=function(b,a,c,d,f){f[0]=k.vec3.dot(b,a);f[1]=k.vec3.dot(b,c);f[2]=k.vec3.dot(b,d);return f};a.coordinateSystemFromOneAxisAndNormalVector=
function(b,a,d,f,g){k.vec3.copy(d,b);k.vec3.copy(c,a);k.vec3.normalize(c,c);k.vec3.cross(f,c,d);k.vec3.cross(g,f,d)};var c=h.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(b,c){var d=a.call(this,b.state,b.sceneIntersectionHelper,"interaction"===c?null:void 0)||this;d.view=b;d.mode=c;d.zoomLocation=h.vec3f64.create();d.tmpCamera=new l.default;d.tmpRayDir=h.vec3f64.create();d.tmpCenter=h.vec3f64.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new l.default,interactionDirection:null,tiltMode:0};return d}m(b,a);
Object.defineProperty(b.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});b.prototype.zoomStep=function(b,a){if(this.active){var c=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(c.camera):this.animation.cameraAt(1,d);this.tmpCamera.copyFrom(c.camera);0<b?(this.intersectionHelper.intersectScreenFreePointFallback(a,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,b),this.zoomLocation,a);this.begin(this.tmpCamera)}};b.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:f.outExpo}};b.prototype.updateCamera=function(b,a,c,f){k.vec3.subtract(this.tmpRayDir,c,b.eye);f=k.vec3.length(this.tmpRayDir);
var e=f*a;1>=a&&4>e&&(e=4,a=e/f);1E-6>Math.abs(f-e)||(k.vec3.scale(this.tmpRayDir,this.tmpRayDir,a),k.vec3.subtract(b.eye,c,this.tmpRayDir),k.vec3.lerp(b.center,b.center,c,1-a),d.applyAll(this.view,b,this.constraintOptions))};return b}(g.PointToPointAnimationController);a.ZoomStepController=n})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.eventMatchesPointerAction=function(a,k){switch(k){case "primary":return"touch"===
a.pointerType||0===a.button;case "secondary":return"touch"!==a.pointerType&&2===a.button;case "tertiary":return"touch"!==a.pointerType&&1===a.button}};a.eventMatchesMousePointerAction=function(a,k){if("touch"===a.pointerType)return!1;switch(k){case "primary":return 0===a.button;case "secondary":return 2===a.button;case "tertiary":return 1===a.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(c,b,d,f){var e=a.call(this,!0)||this;e.view=c;e.pointerAction=b;e.pivotPoint=d;e.registerIncoming("drag",f,function(b){return e.handleDrag(b)});return e}m(d,a);d.prototype.handleDrag=function(a){var b=a.data;if(!(1<b.pointers.size)&&g.eventMatchesMousePointerAction(a.data,this.pointerAction)){var c=k.createScreenPointArray(b.center.x,b.center.y);switch(b.action){case "start":this.cameraController&&(this.cameraController.end(),
this.cameraController=null);this.cameraController=new h.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return d}(d.InputHandler);a.DragRotate=n})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function p(b,e,f){var g=a.call(this)||this;g.view=b;g.intersectionHelper=e;g.pivot=f;g.lastPoint=l.vec2f64.create();g.tmpWorldUp=c.vec3f64.create();g.tmpViewDir=c.vec3f64.create();g.tmpRotCurPoint=l.vec2f64.create();g.tmpTransf=d.mat4f64.create();g.tmpAxis=c.vec3f64.create();g.pivotPos=c.vec3f64.create();g.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};g.rotScale="center"===f?3:1.5;return g}m(p,a);p.prototype.begin=function(b){if(this.active){switch(this.pivot){case "eye":f.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||f.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=
this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;q.normalizeCoordinate(this.beginCamera,b,this.lastPoint)}};p.prototype.update=function(a){if(this.active){var c;switch(this.pivot){case "eye":c=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,c=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,c,this.pivotPos);b.applyAll(this.view,
this.currentCamera,this.constraintOptions)}};p.prototype.end=function(){this.active&&this.finishController()};p.prototype.applyRotation=function(b,a,c,d){this.view.renderCoordsHelper.worldUpAtPosition(d,this.tmpWorldUp);q.normalizeCoordinate(b,a,this.tmpRotCurPoint);a=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;var l=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;f.vec3.subtract(this.tmpViewDir,c,d);var p=f.vec3.length(this.tmpViewDir),p=k.acosClamped(f.vec3.dot(this.tmpViewDir,
this.tmpWorldUp)/p);if("eye"===this.pivot){var r=.5*Math.PI-p,u=.495*Math.PI;a=r-Math.max(-u,Math.min(u,r+-.5*a))}a=k.clamp(a+p,e.TiltDefault.min,e.TiltDefault.max)-p;h.mat4.identity(this.tmpTransf);f.vec3.cross(this.tmpAxis,b.up,this.tmpViewDir);"center"===this.pivot&&(l=-l);h.mat4.rotate(this.tmpTransf,this.tmpTransf,l,this.tmpWorldUp);h.mat4.rotate(this.tmpTransf,this.tmpTransf,a,this.tmpAxis);f.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);f.vec3.add(c,d,this.tmpViewDir);
f.vec3.transformMat4(b.up,b.up,this.tmpTransf);g.vec2.copy(this.lastPoint,this.tmpRotCurPoint);b.markViewDirty()};return p}(p.InteractiveController);a.RotateController=n})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){var d=null!==a&&a.apply(this,arguments)||
this;d.beginCamera=new h.default;d.currentCamera=new h.default;return d}m(d,a);Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});d.prototype.stepController=function(d,f){a.prototype.stepController.call(this,d,f);f.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(f)};d.prototype.onControllerStart=function(d){a.prototype.onControllerStart.call(this,d);this.beginCamera.copyFrom(d);this.currentCamera.copyFrom(d)};d.prototype.onControllerEnd=
function(d){d.copyViewFrom(this.currentCamera);a.prototype.onControllerEnd.call(this,d)};return d}(k.CameraController);a.InteractiveController=n})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,a,m,k,h,d,g,l){Object.defineProperty(a,
"__esModule",{value:!0});n=function(a){function c(b,c,d){var e=a.call(this,!0)||this;e.view=b;e.pointerAction=c;e.registerIncoming("drag",d,function(b){return e.handleDrag(b)});return e}m(c,a);c.prototype.handleDrag=function(b){var a=b.data;if(!(1<a.pointers.size)&&l.eventMatchesMousePointerAction(b.data,this.pointerAction)){var c=k.createScreenPointArray(a.center.x,a.center.y);switch(a.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new h.ZoomController(this.view,this.view.sceneIntersectionHelper):new d.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}b.stopPropagation()}};return c}(g.InputHandler);a.DragZoom=n})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,c){var f=a.call(this)||this;f.view=b;f.intersectionHelper=c;f.pickPoint=l.vec3f64.create();f.tmpP0=d.vec2f64.create();f.panAxisAngle=e.axisAngle.create();f.tmpRayDir=l.vec3f64.create();f.targetOnSphere=l.vec3f64.create();f.dragBeginPoint=k.createScreenPointArray();f.normalizedAnchorPoint=d.vec2f64.create();f.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};f.sphere=e.sphere.create();f.hasPickPoint=!1;return f}m(c,a);c.prototype.begin=function(a){this.active&&(h.vec2.copy(this.dragBeginPoint,a),b.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=b.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};c.prototype.update=function(a){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;g.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var c=g.vec3.length(this.tmpRayDir);b.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var d=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),l=c*Math.pow(2,d),p=this.view.state.constraints.minimumPoiDistance;0>d&&l<p&&(l=p);1E-6>Math.abs(c-l)||(this.hasPickPoint&&l<c&&(d=1-(1-l/c)*(1-this.sphere.radius/
g.vec3.length(this.currentCamera.center)),g.vec3.scale(this.currentCamera.center,this.currentCamera.center,d)),g.vec3.scale(this.tmpRayDir,this.tmpRayDir,-l/c),g.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),f.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(b.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,
this.targetOnSphere),e.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),b.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),f.applySurfaceCollision(this.view,this.currentCamera))}};c.prototype.end=function(){this.active&&this.finishController()};return c}(c.InteractiveController);a.ZoomController=n})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});n=function(b){function a(a,c){var d=b.call(this)||this;d.view=a;d.intersectionHelper=c;d.tmpP=f.vec3f64.create();d.tmpN=f.vec3f64.create();d.tmpP0=g.vec2f64.create();d.tmpPoi=f.vec3f64.create();d.tmpRayDir=f.vec3f64.create();d.dragBeginPoint=h.createScreenPointArray();d.normalizedAnchorPoint=g.vec2f64.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:f.vec3f64.create(),
tiltMode:0};d.plane=p.plane.create();return d}m(a,b);a.prototype.begin=function(b){this.active&&(d.vec2.copy(this.dragBeginPoint,b),e.normalizeCoordinate(this.beginCamera,b,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(b,this.tmpP),l.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),l.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&l.vec3.negate(this.tmpN,this.tmpN),p.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};a.prototype.update=function(b){if(this.active){e.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||l.vec3.copy(this.tmpPoi,this.currentCamera.center);e.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var a=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);d.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);l.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var f=l.vec3.length(this.tmpRayDir),g=f*(1-a);l.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);l.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,k.sign(a)/f);var p=this.view.state.constraints.minimumPoiDistance;0<=a&&g<p&&(g=p,a=-(g-f)/f);1E-6>Math.abs(f-g)||(l.vec3.scale(this.tmpRayDir,this.tmpRayDir,a),l.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),l.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,a),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),c.applyAll(this.view,this.currentCamera,this.constraintOptions))}};a.prototype.end=function(){this.active&&this.finishController()};return a}(b.InteractiveController);a.ZoomController=n})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function f(c,b){var d=a.call(this,!0)||this;d.view=c;d.watchHandles=new k;d.handle=d.registerIncoming("gamepad",function(b){return d.handleEventGamepad(b)});d.handle.pause();return d}m(f,a);f.prototype.onInstall=function(c){var b=this;a.prototype.onInstall.call(this,c);this.watchHandles.add([h.init(this.view.navigation.gamepad,"enabled",function(a){a?b.handle.resume():(b.handle.pause(),b.cameraControllerGamepad&&
(b.cameraControllerGamepad.finishController(),b.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(a){b.cameraControllerGamepad&&a&&b.cameraControllerGamepad.gamepadDevice!==a&&(b.cameraControllerGamepad.finishController(),b.cameraControllerGamepad=null)})])};f.prototype.onUninstall=function(){this.watchHandles.removeAll();a.prototype.onUninstall.call(this)};f.prototype.handleEventGamepad=function(a){var b=this.view.navigation.gamepad.device;if(!b||a.data.device===
b)if((b=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||d.GamepadKeyboardController.activatesFor(this.view,a.data))b||(b=new d.GamepadKeyboardController(this.view,a.data.device),this.view.state.switchCameraController(b)&&(this.cameraControllerGamepad=b)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===a.data.device&&this.cameraControllerGamepad.handleEventGamepad(a.data)};return f}(g.InputHandler);a.GamepadNavigation=
n})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(b,c,d){var e=a.call(this)||this;e.view=b;e.gamepadDevice=c;e.disableMovements=d;e.transformation={translation:[0,0,0],heading:0,tilt:0};e.keysButtonState=[0,0,0,0,0,0,0,0,0,0];e.tmpCamera=new z.default;e.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new z.default,interactionFactor:0,interactionDirection:null,tiltMode:1};return e}m(e,a);e.prototype.handleEventGamepad=
function(b){var a=A.extractTransformation(b,this.view.navigation.gamepad,this.transformation);("end"===b.action||A.isZeroTransformation(a))&&this.finishController()};e.prototype.activateDirection=function(b){this.keysButtonState[b]=1;A.extractTransformationKeyboard(this.keysButtonState,this.transformation)};e.prototype.deactivateDirection=function(b){this.keysButtonState[b]=0;b=A.extractTransformationKeyboard(this.keysButtonState,this.transformation);A.isZeroTransformation(b)&&this.finishController()};
e.prototype.onControllerStart=function(b){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;a.prototype.onControllerStart.call(this,b)};e.prototype.updateFilteredSurfaceElevation=function(b){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*b};e.prototype.stepController=function(b,d){this.updateStartHeading();this.updateFilteredSurfaceElevation(b);this.currentCamera.copyViewFrom(d);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(b,this.currentCamera,I);this.applyDisabledMovementTypes(I);this.applyPan(I.pan);this.applyRotate(I.rotate);this.applyZoom(I.zoom);this.applyAscend(I.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;c.applyAll(this.view,this.currentCamera,this.constraintOptions);a.prototype.stepController.call(this,b,d)};e.prototype.updateStartHeading=
function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};e.prototype.applyRotate=function(b){if(b.enabled){var a=this.currentCamera,d=a.center,e=a.up,f=a.eye;l.vec3.subtract(d,d,f);l.vec3.transformMat4(d,d,b.matrix);l.vec3.add(d,d,f);l.vec3.transformMat4(e,e,b.matrix);a.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;c.applyAll(this.view,a,this.constraintOptions)}};e.prototype.applyPan=function(b,a){void 0===a&&(a=this.currentCamera);
if(b.enabled){var d=a.center,e=a.eye,f=a.up;l.vec3.transformMat4(e,e,b.matrix);l.vec3.transformMat4(d,d,b.matrix);this.view.state.isGlobal&&l.vec3.transformMat4(f,f,b.matrix);a.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;c.applyAll(this.view,a,this.constraintOptions)}};e.prototype.applyZoom=function(b){if(b){var a=this.currentCamera,d=a.eye,a=a.viewForward;l.vec3.add(d,d,l.vec3.scale(x.sv3d.get(),a,b));this.currentCamera.markViewDirty();l.vec3.copy(J,
a);l.vec3.negate(J,J);this.constraintOptions.interactionDirection=J;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;c.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};e.prototype.applyAscend=function(b){if(b){var a=this.currentCamera,d=a.center,a=a.eye,e=this.view.renderCoordsHelper.worldUpAtPosition(a,x.sv3d.get());this.constraintOptions.interactionDirection=l.vec3.copy(J,e);this.view.state.isGlobal?(e=l.vec3.length(a),
b=(e+b)/e,l.vec3.scale(a,a,b),l.vec3.scale(d,d,b)):(b=l.vec3.scale(x.sv3d.get(),e,b),l.vec3.add(a,a,b),l.vec3.add(d,d,b));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;c.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;c.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};e.prototype.calculateControlTransformation=
function(b,a,c){c.zoom=0;c.ascend=0;c.pan.enabled=!1;d.mat4.identity(c.pan.matrix);c.rotate.enabled=!1;d.mat4.identity(c.rotate.matrix);b=this.computeVelocities(b);this.view.state.isLocal?this.calculateControlTransformationLocal(b,a,c):this.calculateControlTransformationGlobal(b,a,c)};e.prototype.updateCameraCenter=function(){var b=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(b.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,b.center);
this.currentCamera.markViewDirty()};e.prototype.calculateControlTransformationLocal=function(a,c,e){var f=c.viewRight,g=c.viewForward,p=this.transformation,q=this.view.navigation.gamepad,g=l.vec3.set(x.sv3d.get(),g[0],g[1],0);l.vec3.normalize(g,g);var u=p.translation[0]*a.pan;0!==u&&(u=l.vec3.scale(x.sv3d.get(),f,u),d.mat4.translate(e.pan.matrix,e.pan.matrix,u),e.pan.enabled=!0);switch(q.mode){case "pan":q=-p.translation[1]*a.pan;0!==q&&(q=l.vec3.scale(x.sv3d.get(),g,q),d.mat4.translate(e.pan.matrix,
e.pan.matrix,q),e.pan.enabled=!0);break;case "zoom":e.zoom=-p.translation[1]*a.zoom;break;default:k.neverReached(q.mode)}e.ascend=p.translation[2]*a.ascend;q=-p.heading*a.rotate;0!==q&&(d.mat4.rotate(e.rotate.matrix,e.rotate.matrix,q,this.view.renderCoordsHelper.worldUpAtPosition(c.eye,x.sv3d.get())),e.rotate.enabled=!0);a=p.tilt*a.rotate;c=r.viewAngle(this.view.renderCoordsHelper,c.center,c.eye);if(c=h.clamp(c+a,b.TiltDefault.min,b.TiltDefault.max)-c)d.mat4.rotate(e.rotate.matrix,e.rotate.matrix,
c,f),e.rotate.enabled=!0};e.prototype.calculateControlTransformationGlobal=function(b,a,c){var e=a.eye,f=a.viewRight,g=this.transformation,h=this.view.navigation.gamepad,e=l.vec3.cross(x.sv3d.get(),f,e);l.vec3.normalize(e,e);l.vec3.negate(e,e);p.panMotionToRotationMatrix(this.beginCamera,a,g,b,this.view.camera.heading,this.headingStart,this.view.camera.tilt,c,h);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(I.pan,this.tmpCamera);h=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
c.ascend=g.translation[2]*b.ascend;e=-g.heading*b.rotate;0!==e&&(d.mat4.rotate(c.rotate.matrix,c.rotate.matrix,e,this.tmpCamera.eye),c.rotate.enabled=!0);b=this.clampTiltDeltaGlobalToValidRange(g.tilt*b.rotate,a.ray,h);0!==b&&(d.mat4.rotate(c.rotate.matrix,c.rotate.matrix,b,this.tmpCamera.viewRight),c.rotate.enabled=!0)};e.prototype.clampTiltDeltaGlobalToValidRange=function(a,c,d){var e=q.onSurfaceTiltToEyeTiltGlobal(b.TiltDefault.min,c.origin,d),f=0,g=0,f=x.sv3d.get();this.view.renderCoordsHelper.intersectManifold(c,
d,f)?(f=r.viewAngle(this.view.renderCoordsHelper,f,c.origin),f=q.onSurfaceTiltToEyeTiltGlobal(f,c.origin,d),g=q.onSurfaceTiltToEyeTiltGlobal(b.TiltDefault.max,c.origin,d)):(y.sphere.closestPointOnSilhouette(y.sphere.wrap(d+v.earthRadius),c,f),f=h.acosClamped(-l.vec3.dot(c.direction,l.vec3.normalize(f,f))),f=q.offSurfaceTiltToEyeTiltGlobal(f,c.origin,d),g=q.offSurfaceTiltToEyeTiltGlobal(b.TiltDefault.max,c.origin,d));return h.clamp(f+a,e,g)-f};e.prototype.getPointAbsoluteSurfaceElevation=function(b,
a,c){var d=this.view.renderCoordsHelper,e=d.getAltitude(b);a+=Math.abs(e-a);l.vec3.copy(c,b);d.setAltitude(a,c);return a};e.prototype.clampedDistanceToSurface=function(b,a){var c=this.view.renderCoordsHelper,d=this.view.state.camera,e=w.headingTiltToDirectionUp(this.view,a,0,B,M).direction,e=c.intersectManifoldClosestSilhouette(y.ray.wrap(a,e),b,x.sv3d.get()),e=l.vec3.distance(a,e);b=c.intersectManifoldClosestSilhouette(y.ray.wrap(a,t.directionFromTo(x.sv3d.get(),a,d.center)),b,x.sv3d.get());a=l.vec3.distance(a,
b);return Math.min(e,a)};e.prototype.computeHeadingRotateRadius=function(b){var a=this.view,c=a.renderCoordsHelper,d=a.state,a=d.isGlobal,d=c.intersectManifoldClosestSilhouette(d.camera.ray,this.filteredSurfaceElevation,x.sv3d.get());if(a)return a=l.vec3.subtract(x.sv3d.get(),b,d),c=l.vec3.length(a),l.vec3.scale(a,a,1/c),b=l.vec3.normalize(x.sv3d.get(),b),b=h.acosClamped(l.vec3.dot(b,a)),c*Math.sin(Math.min(G,b));b=l.vec3.copy(x.sv3d.get(),b);c.setAltitude(this.filteredSurfaceElevation,b);return l.vec3.distance(d,
b)};e.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:K};e.prototype.computeVelocities=function(b){var a=this.filteredSurfaceElevation,c=a+v.earthRadius,d=this.view.state,e=d.camera,f=d.isGlobal,g=x.sv3d.get(),l=this.getPointAbsoluteSurfaceElevation(e.eye,a,g),p=this.clampedDistanceToSurface(a,g),q=e.width/2,k=F*e.width,d=F*e.width,e=p*Math.tan(.5*e.fovX)/q,r=e/c,c=e/this.computeHeadingRotateRadius(g),f=(f?r:e)*k*b,a=l-a,a=Math.max(this.minimumAscendVelocity()*
b,Math.pow(2,k*b/q)*a-a),p=Math.pow(2,k*b/q)*p-p;b*=h.clamp(c*d,H,N);return{pan:f,ascend:a,zoom:p,rotate:b}};e.prototype.applyDisabledMovementTypes=function(b){void 0===this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(b.zoom=this.disableMovements.zoom?0:b.zoom,b.ascend=this.disableMovements.ascend?0:b.ascend,b.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&d.mat4.identity(b.pan.matrix),b.rotate.enabled=!this.disableMovements.rotate,
this.disableMovements.rotate&&d.mat4.identity(b.rotate.matrix))};e.activatesFor=function(b,a){b=A.extractTransformation(a,b.navigation.gamepad,E);return!("end"===a.action||A.isZeroTransformation(b))};return e}(e.InteractiveController);a.GamepadKeyboardController=n;var E={translation:[0,0,0],heading:0,tilt:0},B=80,G=h.deg2rad(B),F=.75,K=5,H=h.deg2rad(30),N=h.deg2rad(80),I={zoom:0,ascend:0,pan:{enabled:!1,matrix:g.mat4f64.create()},rotate:{enabled:!1,matrix:g.mat4f64.create()}},J=f.vec3f64.create(),
M=u.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../config ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../../support/spatialReferenceSupport".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){function A(b){return"global"===b.viewingMode?v:u}function E(a,c,e){var g=a.renderSpatialReference,l=b.vec3.copy(Q,c.viewForward),l=K(a,c.eye,l,c.up,Z);a=a.spatialReference||q.WGS84;x.vectorToVector(c.eye,g,V,a)||(a=q.WGS84,x.vectorToVector(c.eye,g,V,a));if(!e)return new d(new p(V,a),l.heading,l.tilt,f.rad2deg(c.fov));e.position.x=V[0];e.position.y=V[1];e.position.z=V[2];e.position.spatialReference=a;e.heading=l.heading;e.tilt=l.tilt;e.fov=f.rad2deg(c.fov);
return e}function B(b,a,c){var d=b.state.camera,e=d.fovX,d=d.width/2/d.pixelRatio;"global"===b.viewingMode&&null!=c&&(a*=Math.cos(f.deg2rad(c)));a/=b.renderCoordsHelper.unitInMeters;return d/(39.37*g.screenDPI/a)/Math.tan(e/2)}function G(b,a,c){var d=b.state.camera;a=39.37*g.screenDPI/(d.width/2/d.pixelRatio/(a*Math.tan(d.fovX/2)));"global"===b.viewingMode&&(a/=Math.cos(f.deg2rad(c)));return a*=b.renderCoordsHelper.unitInMeters}function F(b,a,c,d,e,f){if(U(f)){var g=T(f.signal);M(b,d.heading,d.tilt,
a,c,e,g);g.resolver.promise.then(function(a){return f.resolver.resolve(O(b,a,d.fov))},function(b){return f.resolver.reject(b)})}else return a=M(b,d.heading,d.tilt,a,c,e),O(b,a,d.fov,f)}function K(b,a,c,d,e){return A(b).directionToHeadingTilt(a,c,d,e)}function H(b,a,c){return b.basemapTerrain&&b.renderCoordsHelper.fromRenderCoords(a,X,b.spatialReference)&&b.basemapTerrain.getElevation(X)>X.z-1}function N(b,a,c,d){return h(this,void 0,void 0,function(){var c;return k(this,function(e){switch(e.label){case 0:return b.renderCoordsHelper.fromRenderCoords(a,
X,b.spatialReference)?[4,b.elevationProvider.queryElevation(X,d)]:[2,!1];case 1:return c=e.sent(),[2,c>X.z-10]}})})}function I(a,c,d){return h(this,void 0,void 0,function(){var f,g;return k(this,function(l){switch(l.label){case 0:f=e.vec3f64.create();if(c)return[3,1];b.vec3.copy(f,a.state.camera.center);return[3,5];case 1:if(!(c instanceof p))return[3,4];x.pointToVector(c,f,a.renderSpatialReference);return null!=c.z||null==a.basemapTerrain?[3,3]:[4,a.elevationProvider.queryElevation(c,d)];case 2:return g=
l.sent(),null!=g&&a.renderCoordsHelper.setAltitude(g,f),[2,f];case 3:return[3,5];case 4:b.vec3.copy(f,c),l.label=5;case 5:return[2,f]}})})}function J(a,c){var d=e.vec3f64.create();c&&c instanceof p?(x.pointToVector(c,d,a.renderSpatialReference),null==c.z&&null!=a.basemapTerrain&&(c=a.elevationProvider.getElevation(c),null!=c&&a.renderCoordsHelper.setAltitude(c,d))):c?b.vec3.copy(d,c):b.vec3.copy(d,a.state.camera.center);return d}function M(b,a,c,d,e,f,g){var l=d&&d instanceof p?d:null;if(U(g))I(b,
d,g.signal).then(function(d){L(b,a,c,l,d,e,f,g)},function(b){return g.resolver.reject(b)});else return d=J(b,d),L(b,a,c,l,d,e,f,g)}function L(b,a,c,d,f,g,l,p){d||(d=x.vectorToPoint(f,b.renderSpatialReference,b.spatialReference||q.WGS84));g=Math.max(g,b.state.constraints.minimumPoiDistance);var h=R(b,a,c,f,g,l),k=A(b).eyeForCenterWithHeadingTilt,r=k(f,g,h.heading,h.tilt);if(l===ga.ADJUST&&"global"===b.viewingMode&&0<c){var u=function(){var e=g,h=g,q=b.state.constraints.tilt(h),h=A(b).eyeTiltToLookAtTilt(f,
h,c),h=Math.min(h,.5*Math.PI),q=q.min*(1-ca)+h*ca,e=A(b).lookAtTiltToEyeTilt(f,e,q);l=1>c-e?ga.LOCKED:ga.ADJUST;return L(b,a,e,d,f,g,l,p)};if(H(b,r.eye,r.tilt))return u();if(U(p)){N(b,r.eye,r.tilt,p.signal).then(function(b){if(b)return u();p.resolver.resolve({eye:r.eye,up:r.up,center:e.vec3f64.clone(f),heading:r.heading,tilt:r.tilt})});return}}h=!p||U(p)?{center:e.vec3f64.create(),eye:e.vec3f64.create(),up:e.vec3f64.create(),tilt:0,heading:0}:p;h.eye=r.eye;h.up=r.up;h.center=e.vec3f64.clone(f);h.heading=
r.heading;h.tilt=r.tilt;U(p)&&p.resolver.resolve(h);return h}function R(b,a,c,d,e,f){var g=0;if(f=f===ga.ADJUST)if(g=b.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(e/g)/Math.LN2)f=!0;else{var l=b.renderSpatialReference,p=b.spatialReference||q.WGS84;f=x.vectorToPoint(d,l,p);l=x.vectorToPoint(b.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,l,p);g*=Math.tan(.5*b.state.camera.fov);f=5<l.distance(f)/g}f?(a=0,f=b.state.constraints.tilt(e),f.max=Math.min(f.max,.5*Math.PI),f=f.min*
(1-ca)+f.max*ca,c=A(b).eyeTiltToLookAtTilt(d,e,c),g=Math.min(c,f)):g=A(b).eyeTiltToLookAtTilt(d,e,c);c=g=b.state.constraints.clampTilt(e,g);c=A(b).lookAtTiltToEyeTilt(d,e,c);return{heading:a,tilt:c}}function O(b,a,c,e){b=x.vectorToPoint(a.eye,b.renderSpatialReference,b.spatialReference||q.WGS84);return b?e?(e.position=b,e.heading=a.heading,e.tilt=a.tilt,e.fov=c,e):new d(b,a.heading,a.tilt,c):null}function T(b){return{resolver:c.createResolver(),signal:b}}function U(b){return b&&"resolver"in b}Object.defineProperty(a,
"__esModule",{value:!0});var P=l.getLogger("esri.views.3d.support.cameraUtils"),V=e.vec3f64.create(),W=e.vec3f64.create(),Q=e.vec3f64.create(),Z={heading:0,tilt:0},X=new p,aa=new t.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),da=new t.Cyclical(-180,180),ga;(function(b){b[b.LOCKED=0]="LOCKED";b[b.ADJUST=1]="ADJUST"})(ga=a.OrientationMode||(a.OrientationMode={}));a.headingTiltToDirectionUp=function(b,a,c,d,e){return A(b).headingTiltToDirectionUp(a,c,d,e)};a.externalToInternal=function(a,c){var d=
a.renderSpatialReference,g=A(a).headingTiltToDirectionUp,l=e.vec3f64.create();if(!x.pointToVector(c.position,l,d))return null;d=g(l,c.heading,c.tilt);b.vec3.scale(d.direction,d.direction,a.state.camera.distance);b.vec3.add(d.direction,d.direction,l);a=w.cameraOnContentAlongViewDirection(a,l,d.direction,d.up);a.fov=f.deg2rad(c.fov);return a};a.internalToExternal=E;a.scaleToDistance=B;a.distanceToScale=G;a.fromCenterScale=function(b,a,c,d,e,f){c=B(b,c,a.latitude);return F(b,a,c,d,e,f)};a.fromCenterDistance=
F;a.directionToHeadingTilt=K;a.getObserverForPointAtDistance=M;a.fromExtent=function(b,a,c,d,e,f){var g,l=0;null!=a.zmax&&null!=a.zmin&&(g=(a.zmax+a.zmin)/2,l=a.zmax-a.zmin);var h,k;if("global"===b.viewingMode){if(!z.isSpatialReferenceSupported(a.spatialReference,"global"))return U(f)&&f.resolver.reject(),null;var r=new p(a.xmin,a.ymin,a.spatialReference),u=new p(a.xmax,a.ymax,a.spatialReference),m=a.spatialReference.isGeographic?da:aa;a=new p(m.center(r.x,u.x),(u.y+r.y)/2,a.spatialReference);null!=
g&&(a.z=g);k=y.getGreatCircleSpanAt(a,r,u);h=k.lon;k=k.lat;m.diff(r.x,u.x)>m.range/2&&(h+=y.halfEarthCircumference);h=Math.min(h,y.halfEarthCircumference);k=Math.min(k,y.halfEarthCircumference)}else r=b.spatialReference||q.WGS84,h=a.xmax-a.xmin,k=a.ymax-a.ymin,a=new p({x:a.xmin+.5*h,y:a.ymin+.5*k,z:g,spatialReference:r});g=b.state.camera;l=Math.max(1/Math.tan(g.fovX/2)*h*.5,1/Math.tan(g.fovY/2)*k*.5,1/Math.tan(g.fov/2)*l*.5)/1;if(U(f))h=T(f.signal),M(b,c,d,a,l,e,h),h.resolver.promise.then(function(a){return f.resolver.resolve(O(b,
a,b.camera.fov))},function(b){return f.resolver.reject(b)});else return c=M(b,c,d,a,l,e),O(b,c,b.camera.fov,f)};a.toExtent=function(b,a,c,d,e){a||(c||(c=b.state.camera),a=E(b,c,e));e=b.renderSpatialReference;var f;if(c)e=x.vectorToPoint(c.center,e,b.spatialReference||q.WGS84),f=c.distance;else{e=b.toMap(b.screenCenter);if(!e)return null;f=y.computeCartesianDistance(a.position,e)}c||(c=b.state.camera);a=2*f*Math.tan(c.fovX/2)*1;c=2*f*Math.tan(c.fovY/2)*1;return"global"===b.viewingMode?v.toExtent(b,
e,a,c,d):u.toExtent(b,e,a,c,d)};var ca=.7;a.observerToCamera=O;a.scaleToZoom=function(b,a){if(b=b.basemapTerrain&&b.basemapTerrain.tilingScheme)return b.levelAtScale(a);P.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.zoomToScale=function(b,a){if(b=b.basemapTerrain&&b.basemapTerrain.tilingScheme)return b.scaleAtLevel(a);P.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};a.scaleToResolution=function(b,a){return b.spatialReference?
r.getResolutionForScale(a,b.spatialReference):void 0};a.computeScale=function(a,c,e){var f=a.renderSpatialReference;c||(c=a.state.camera);var g;g=q.WGS84;c instanceof d?(g=c.position.latitude,x.pointToVector(c.position,V,f),x.pointToVector(e,W,f),c=b.vec3.distance(V,W)):(x.vectorToVector(c.center,f,W,g),g=W[1],c=c.distance);return G(a,c,g)};a.createAsyncContext=T;a.isAsyncContext=U})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./projectionUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c){function b(b,a,c,g){void 0===g&&(g=f.createDirectionUp());k.mat4.identity(q);b=g.direction;var l=g.up;k.mat4.rotateZ(q,q,-m.deg2rad(a));k.mat4.rotateX(q,q,m.deg2rad(c));d.vec3.transformMat4(b,p,q);d.vec3.scale(b,b,-1);d.vec3.transformMat4(l,e,q);return g}Object.defineProperty(a,"__esModule",{value:!0});var e=g.vec3f64.fromValues(0,1,0),p=g.vec3f64.fromValues(0,0,1),q=h.mat4f64.create(),r=g.vec3f64.create(),w=g.vec3f64.create();a.headingTiltToDirectionUp=b;a.directionToHeadingTilt=
function(b,a,c,d){return f.directionToHeadingTilt(a,c,d,p,e)};a.eyeForCenterWithHeadingTilt=function(a,c,e,f){var l=b(a,e,f),p=g.vec3f64.create();d.vec3.scale(p,l.direction,-c);d.vec3.add(p,p,a);return{up:l.up,eye:p,heading:e,tilt:f}};a.lookAtTiltToEyeTilt=function(b,a,c){return m.rad2deg(c)};a.eyeTiltToLookAtTilt=function(b,a,c){return m.deg2rad(c)};a.toExtent=function(b,a,d,e,f){var g=b.renderSpatialReference;b=b.map&&b.spatialReference||a.spatialReference;c.pointToVector(a,r,g);c.pointToVector(a,
w,g);r[0]-=d/2;w[0]+=d/2;r[1]-=e/2;w[1]+=e/2;c.vectorToVector(r,g,r,b);c.vectorToVector(w,g,w,b);f?(f.xmin=r[0],f.ymin=r[1],f.xmax=w[0],f.ymax=w[1],f.spatialReference=b):f=new l(r[0],r[1],w[0],w[1],b);return f}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=h.vec3f64.create(),g=h.vec3f64.create();
a.createDirectionUp=function(){return{direction:h.vec3f64.create(),up:h.vec3f64.create()}};a.directionToHeadingTilt=function(a,f,c,b,e){var l=d;k.vec3.normalize(l,a);var h=k.vec3.dot(l,b),r=0<h,h=Math.abs(h);.99<h&&(h=Math.abs(k.vec3.dot(f,b)),.99>h?(k.vec3.copy(l,f),r&&k.vec3.scale(l,l,-1)):l=null);f=0;l&&(k.vec3.scale(g,b,k.vec3.dot(b,l)),k.vec3.subtract(l,l,g),f=k.vec3.dot(l,e)/(k.vec3.length(l)*k.vec3.length(e)),k.vec3.cross(g,l,e),f=(0<k.vec3.dot(g,b)?1:-1)*m.rad2deg(m.acosClamped(f)));a=m.rad2deg(m.acosClamped(-k.vec3.dot(b,
a)/k.vec3.length(a)));if(!c)return{heading:f,tilt:a};c.heading=f;c.tilt=a;return c}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){function q(a,c,e,f){void 0===f&&(f=b.createDirectionUp());d.vec3.cross(x,a,u);0===d.vec3.dot(x,x)&&d.vec3.cross(x,a,v);k.mat4.identity(t);k.mat4.rotate(t,t,-m.deg2rad(c),a);k.mat4.rotate(t,t,-m.deg2rad(e),x);c=f.up;e=f.direction;d.vec3.cross(c,x,a);d.vec3.normalize(c,c);d.vec3.transformMat4(c,c,t);d.vec3.normalize(e,a);d.vec3.negate(e,e);d.vec3.transformMat4(e,e,t);return f}function r(b){var a=b[1];b[1]=-b[2];b[2]=a}function w(b,a){a=q(a,b.heading,b.tilt);b.up=
a.up;return b}Object.defineProperty(a,"__esModule",{value:!0});var u=g.vec3f64.fromValues(0,0,1),v=d.vec3.normalize(g.vec3f64.create(),g.vec3f64.fromValues(1,1,1)),y=new p.Cyclical(-180,180),t=h.mat4f64.create(),x=g.vec3f64.create(),z=g.vec3f64.create();a.headingTiltToDirectionUp=q;a.directionToHeadingTilt=function(a,c,e,f){var g=x;d.vec3.normalize(g,a);d.vec3.cross(z,g,u);0===d.vec3.dot(z,z)&&d.vec3.cross(z,g,v);d.vec3.cross(z,z,g);return b.directionToHeadingTilt(c,e,f,g,z)};a.eyeForCenterWithHeadingTilt=
function(b,a,c,e){var f={eye:g.vec3f64.create(),up:null,tilt:e,heading:c},l=x;l[0]=b[0];l[1]=b[2];l[2]=-b[1];c=m.deg2rad(c);var p=m.deg2rad(e);e=Math.sin(c);c=Math.cos(c);var h=Math.sin(p),q=Math.cos(p),k=d.vec3.length(l);if(1E-8>Math.abs(p))p=a+k;else var u=k/h,t=m.asinClamped(a/u),p=u*Math.sin(Math.PI-p-t);var u=h*a,q=q*a,t=c*u,v=p-q,z=v*v,y=a*a*h*h,h=c*c*y,y=e*e*y,A=l[1]*v,n=h*(h+z-l[1]*l[1]);if(0>n)return d.vec3.scale(f.eye,l,p/k),f.tilt=0,f;var E=Math.sqrt(n),n=h+z,A=0<c?-E+A:E+A;if(1E-8>Math.abs(n))return 1E-8>
k?(f.eye[0]=0,f.eye[1]=0,f.eye[2]=a):d.vec3.scale(f.eye,l,p/k),f.tilt=0,r(f.eye),w(f,b);f.eye[1]=A/n;n=f.eye[1]*f.eye[1];a=1-n;A=Math.sqrt(a);t=h*n+y-2*t*f.eye[1]*A*v+a*z;if(1E-8>Math.abs(t))return d.vec3.scale(f.eye,l,p/k),f.tilt=0,r(f.eye),w(f,b);f.eye[0]=(a*(p*l[0]-q*l[0])-u*A*(l[0]*f.eye[1]*c+l[2]*e))/t;f.eye[2]=(a*(p*l[2]-q*l[2])-u*A*(l[2]*f.eye[1]*c-l[0]*e))/t;d.vec3.scale(f.eye,f.eye,p);r(f.eye);return w(f,b)};a.lookAtTiltToEyeTilt=function(b,a,c){b=d.vec3.length(b);a=m.asinClamped(a/(Math.sqrt(a*
a+b*b-2*a*b*Math.cos(Math.PI-c))/Math.sin(c)));return m.rad2deg(c-a)};a.eyeTiltToLookAtTilt=function(b,a,c){c=m.deg2rad(c);b=d.vec3.length(b);return m.asinClamped(a/(b/Math.sin(c)))+c};a.toExtent=function(b,a,d,g,h){function q(b){var a=Math.PI/2;b=p.cyclical2PI.normalize(b,-a);b>a&&(b=Math.PI-b);return b}var k;k=a.latitude;a=a.longitude;var r=e.getLonDeltaForDistance(a,k,d)/2;d=a-r;a+=r;k=m.deg2rad(k);r=e.earthRadius;k=(1+Math.sin(k))/(1-Math.sin(k));var u=(k+1)*Math.tan(g/r/2);k=1.5*Math.PI-2*Math.atan(.5*
(u+Math.sqrt(4*k+u*u)));g=k+g/r;k=q(k);g=q(g);g<k&&(r=g,g=k,k=r);k=Math.max(m.rad2deg(k),-90);g=Math.min(m.rad2deg(g),90);a=y.monotonic(d,a);180<a-d&&(r=(a-d-180)/2,d+=r,a-=r);r=b.spatialReference&&b.spatialReference.isGeographic?b.spatialReference:f.WGS84;h?(h.xmin=d,h.ymin=k,h.xmax=a,h.ymax=g,h.spatialReference=r):h=new l(d,k,a,g,r);b.spatialReference&&b.spatialReference.isWebMercator&&c.geographicToWebMercator(h,!1,h);return h}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require",
"exports","../../core/libs/gl-matrix-2/vec3"],function(n,a,m){function k(a){var d=a*a;0>a&&(d*=-1);return d}Object.defineProperty(a,"__esModule",{value:!0});a.quadraticAccentuation=k;a.resetTransformation=function(a){a.translation[0]=0;a.translation[1]=0;a.translation[2]=0;a.heading=0;a.tilt=0;return a};a.extractTransformation=function(a,d,g){var l=a.state;a=a.device;d="forward-down"===d.tiltDirection?1:-1;"standard"===a.deviceType?(g.translation[0]=k(l.axes[0]),g.translation[1]=k(l.axes[1]),g.translation[2]=
k(l.buttons[7])-k(l.buttons[6]),g.heading=k(l.axes[2]),g.tilt=k(l.axes[3])):"spacemouse"===a.deviceType&&(g.translation[0]=1.2*k(l.axes[0]),g.translation[1]=1.2*k(l.axes[1]),g.translation[2]=2*-k(l.axes[2]),g.heading=1.2*k(l.axes[5]),g.tilt=1.2*k(l.axes[3]));g.tilt*=d;m.vec3.scale(g.translation,g.translation,1);return g};a.extractTransformationKeyboard=function(a,d){d.translation[0]=a[1]-a[0];d.translation[1]=a[3]-a[2];d.translation[2]=a[4]-a[5];d.heading=a[7]-a[6];d.tilt=a[8]-a[9];return d};a.isZeroTransformation=
function(a){return 0===a.translation[0]&&0===a.translation[1]&&0===a.translation[2]&&0===a.heading&&0===a.tilt}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,f,c){var b,e=a.call(this,!0)||this;e.view=d;e.disableMovements={pan:!0,zoom:!0,
ascend:!0,rotate:!1,mode:"local"};e.keyToNumber=(b={},b[f.left]=0,b[f.right]=1,b[f.forward]=2,b[f.backward]=3,b[f.up]=4,b[f.down]=5,b[f.headingLeft]=6,b[f.headingRight]=7,b[f.tiltUp]=8,b[f.tiltDown]=9,b);e.registerIncoming("key-down",c,function(b){return e.handleKeyDown(b)});e.registerIncoming("key-up",c,function(b){return e.handleKeyUp(b)});e.registerIncoming("blur",c,function(){return e.handleBlur()});return e}m(d,a);d.prototype.handleKeyDown=function(a){var d=this.keyToNumber[a.data.key];null!=
d&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new k.GamepadKeyboardController(this.view,void 0,this.disableMovements),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(d),a.stopPropagation()))};d.prototype.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),
this.cameraControllerKeyboard=null)};d.prototype.handleKeyUp=function(a){var d=this.keyToNumber[a.data.key];null!=d&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(d),a.stopPropagation())};return d}(h.InputHandler);a.KeyboardNavigation=n})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function f(c,b){var d=a.call(this,!0)||this;d.view=c;d.registerIncoming("mouse-wheel",b,function(b){return d.handleMouseWheel(b)});return d}m(f,a);f.prototype.handleMouseWheel=function(a){var b=a.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new h.ZoomStepController(this.view,"interaction"):new d.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));
this.cameraController.zoomStep(-1/60*b.deltaY,k.createScreenPointArray(b.x,b.y));a.stopPropagation()};return f}(g.InputHandler);a.MouseWheelZoom=n})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,
"__esModule",{value:!0});n=function(a){function d(c,b,d){var e=a.call(this,!0)||this;e.view=c;e.pointerAction=b;e.lastEndTimestamp=0;e.lastTimestamp=0;e.registerIncoming("drag",d,function(b){return e.handleDrag(b)});return e}m(d,a);d.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||g.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;
this.controller&&this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};d.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));
this.controller=null};d.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};d.prototype.createController=function(){return this.view.state.isGlobal?new k.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new h.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return d}(d.InputHandler);a.PinchAndPanNavigation=n})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function p(b,d){var f=a.call(this)||this;f.view=b;f.intersectionHelper=d;f.smoothRotation=new e.ExponentialFalloff(.05);f.rotationAxis=c.vec3f64.create();f.panningPlane=x.plane.create();f.smoothScaling=new e.ExponentialFalloff(.05);f.zoomCenterScreen=h.createScreenPointArray();f.zoomMomentumEstimator=new F.ZoomMomentumEstimator;f.rotationMomentumEstimator=new G.RotationMomentumEstimator;
f.panSphericalMomentumEstimator=new B.PanSphericalMomentumEstimator;f.panPlanarMomentumEstimator=new E.PanPlanarMomentumEstimator;f.adjustedSphere=x.sphere.create();f.tmp3d=c.vec3f64.create();f.tmpMat=g.mat4f64.create();f.tmpAxisAngle=x.axisAngle.create();f.tmpScreenPointArray=h.createScreenPointArray();f.beginScreenPoint=h.createScreenPointArray();f.beginScenePoint=c.vec3f64.create();f.screenPickPoint=h.createScreenPointArray();f.panMode=t.PanMode.Horizontal;f.tmpInteractionDirection=c.vec3f64.create();
f.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new A.default,interactionDirection:null,tiltMode:0};return f}m(p,a);p.prototype.begin=function(b){if(this.active){this.beginHeading=-z.cyclicalPI.normalize(k.deg2rad(this.view.camera.heading));this.beginRadius=b.radius;this.pointerCount=b.pointers.size;this.beginAngle=b.angle;this.smoothRotation.reset();h.screenPointObjectToArray(b.center,this.screenPickPoint);l.vec2.copy(this.beginScreenPoint,this.screenPickPoint);
var a=y.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=a.scenePickPoint;this.sphere=a.sphere;f.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=y.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===t.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(b):this.preparePlanarPanMode(b));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};p.prototype.preparePlanarPanModeOverground=
function(b){var a=f.vec3.negate(this.tmp3d,this.beginCamera.viewForward);x.plane.fromPositionAndNormal(this.scenePickPoint,a,this.panningPlane);var d=h.createScreenPointArray(this.screenPickPoint[0],0),a=c.vec3f64.create(),e=f.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=e<this.sphere.radius?e-100:this.sphere.radius;y.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,d,a);d=h.createRenderScreenPointArray3();this.beginCamera.projectPoint(a,d);this.screenPickPoint[1]=
Math.min(this.screenPickPoint[1],.9*d[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&x.plane.fromPositionAndNormal(this.scenePickPoint,this.panningPlane,this.panningPlane);b=h.screenPointObjectToArray(b.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,b,this.beginScenePoint)};p.prototype.preparePlanarPanMode=function(b){var a=f.vec3.negate(this.tmp3d,this.beginCamera.viewForward);x.plane.fromPositionAndNormal(this.scenePickPoint,
a,this.panningPlane);var c=x.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),a=x.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),c=-a[3]-(this.currentCamera.aboveGround?.25:.025)*c;if(0<c){var e=d.mat4.identity(this.tmpMat);d.mat4.rotate(e,e,-c,a);f.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center);f.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,e);f.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);
x.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);b=h.screenPointObjectToArray(b.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,b,this.beginScenePoint)}};p.prototype.update=function(b){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var a=1<b.pointers.size;this.panMode===t.PanMode.Horizontal?(a&&this.zoomSpherical(b),this.panningSpherical(b),a&&this.rotateSpherical(b)):(a&&this.zoomPlanar(b),this.panningPlanar(b),
a&&this.rotatePlanar(b));this.currentCamera.markViewDirty()}};p.prototype.end=function(b){b.pointers.size===this.pointerCount&&this.update(b);this.finishController();if(b=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===t.PanMode.Horizontal?new v.ZoomSphericalMomentumController(this.view,b,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new u.ZoomPlanarMomentumController(this.view,b,this.beginScenePoint);if(b=this.rotationMomentumEstimator.evaluateMomentum())return new w.RotationMomentumController(this.view,
b,this.sphere.center,this.rotationAxis);if(this.panMode===t.PanMode.Horizontal){if(b=this.panSphericalMomentumEstimator.evaluateMomentum())return new r.PanSphericalMomentumController(this.view,b)}else if(b=this.panPlanarMomentumEstimator.evaluateMomentum())return new q.PanPlanarMomentumController(this.view,b);return null};p.prototype.zoomSpherical=function(a){var c=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(c);y.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);h.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=b.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);b.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.panningSpherical=function(a){var c=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.sphereOrPlanePointFromScreenPoint(this.sphere,
this.currentCamera,c,this.tmp3d);y.preserveHeadingThreshold(this.beginScenePoint,f.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(y.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(c,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):
(y.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(c,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=b.pixelDistanceToInteractionFactor(this.screenPickPoint,c);b.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.rotateSpherical=
function(a){f.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||f.vec3.negate(this.rotationAxis,this.rotationAxis);var c=this.smoothRotation.value,d=y.normalizeRotationDelta(a.angle-c),c=c+d;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(c);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,
d));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=b.pixelDistanceToInteractionFactor(a.radius*c);b.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.panningPlanar=function(a){var c=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,c,this.tmp3d)&&(y.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(c,this.tmp3d,
.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=b.pixelDistanceToInteractionFactor(this.beginScreenPoint,c),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),b.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};p.prototype.zoomPlanar=function(a){var c=this.beginRadius/a.radius;this.smoothScaling.gain=
.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(c);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);y.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=b.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);b.applyAll(this.view,this.currentCamera,this.constraintOptions)};p.prototype.rotatePlanar=
function(a){f.vec3.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||f.vec3.negate(this.rotationAxis,this.rotationAxis);var c=this.smoothRotation.value,d=a.angle-c,d=y.normalizeRotationDelta(d);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(c+d);c=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,
c));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=b.pixelDistanceToInteractionFactor(a.radius*c);b.applyAll(this.view,this.currentCamera,this.constraintOptions)};return p}(p.InteractiveController);a.PinchAndPanController=n})},"esri/views/3d/input/util":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this._gain=a}a.prototype.reset=function(a){this._value=a};Object.defineProperty(a.prototype,
"gain",{set:function(a){this._gain=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});a.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return a}();a.ExponentialFalloff=n})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,c){d=a.call(this,d,4)||this;d.momentum=c;d.tmpPan=h.vec3f64.create();return d}m(d,a);d.prototype.momentumStep=function(a,c){a=this.momentum.value(a);k.vec3.scale(this.tmpPan,this.momentum.direction,a);k.vec3.subtract(c.eye,c.eye,this.tmpPan);k.vec3.subtract(c.center,c.center,this.tmpPan);c.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return d}(d.MomentumController);a.PanPlanarMomentumController=
n})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(f,c){c=a.call(this)||this;c.view=f;c.beginCamera=new d.default;c.elapsedTimeSec=0;c.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new d.default,
interactionDirection:null,tiltMode:0};return c}m(g,a);Object.defineProperty(g.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});g.prototype.onControllerStart=function(d){this.beginCamera.copyFrom(d);this.constraintOptions.interactionStartCamera=this.beginCamera;a.prototype.onControllerStart.call(this,d)};g.prototype.stepController=function(a,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=a;this.momentumStep(this.elapsedTimeSec,
c);k.applyAll(this.view,c,this.constraintOptions)};return g}(h.AnimationController);a.MomentumController=n})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=h.vec3f64.create(),
f=h.vec3f64.create();n=function(a){function b(b,c){b=a.call(this,b,4)||this;b.momentum=c;return b}m(b,a);b.prototype.momentumStep=function(b,a){var c=this.momentum.value1(b);b=this.momentum.value2(b);k.vec3.copy(f,a.eye);k.vec3.normalize(f,f);k.vec3.cross(this.momentum.axis2,f,this.momentum.axis1);g.applyRotationWithTwoAxes(a,l,this.momentum.axis1,c,this.momentum.axis2,b)};return b}(d.MomentumController);a.PanSphericalMomentumController=n})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,c,d,f){b=a.call(this,b,2)||this;b.momentum=c;b.axis=h.vec3f64.create();b.center=h.vec3f64.create();k.vec3.copy(b.axis,f);k.vec3.copy(b.center,d);return b}m(c,a);c.prototype.momentumStep=function(b,a){b=this.momentum.value(b);g.applyRotation(a,this.center,l.axisAngle.wrapAxisAngle(this.axis,b))};return c}(d.MomentumController);a.RotationMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,c,d){b=a.call(this,b,1)||this;b.momentum=c;b.zoomCenter=h.vec3f64.create();k.vec3.copy(b.zoomCenter,d);b.constraintOptions.interactionDirection=h.vec3f64.create();return b}m(c,a);c.prototype.momentumStep=function(b,a){k.vec3.copy(this.constraintOptions.interactionDirection,a.eye);b=this.momentum.valueDelta(0,b);g.applyZoomToPoint(a,this.zoomCenter,b,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionDirection=l.directionFromTo(this.constraintOptions.interactionDirection,a.eye,this.constraintOptions.interactionDirection)};return c}(d.MomentumController);a.ZoomPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(c,e,f,l,p){c=a.call(this,c,1)||this;c.momentum=e;c.screenCenter=k.createScreenPointArray();c.sceneCenter=g.vec3f64.create();c.tmpSceneCenter=g.vec3f64.create();c.tmpZoomAxisAngle=b.axisAngle.create();c.sphere=b.sphere.create();h.vec2.copy(c.screenCenter,f);d.vec3.copy(c.sceneCenter,l);c.sphere.radius=p;return c}m(e,a);e.prototype.momentumStep=function(a,d){a=this.momentum.valueDelta(0,a);c.applyZoomOnSphere(this.sphere,
d,a);this.constraintOptions.interactionType=1;l.applyAll(this.view,d,this.constraintOptions);c.sphereOrPlanePointFromScreenPoint(this.sphere,d,this.screenCenter,this.tmpSceneCenter);b.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);c.applyRotation(d,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};return e}(f.MomentumController);a.ZoomSphericalMomentumController=n})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=function(a){function c(b,c,d,f,g){b=a.call(this,b,c,d)||this;b.sceneVelocity=f;b.direction=g;return b}m(c,a);c.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return c}(g.Momentum);a.PanPlanarMomentum=l;n=function(){function a(a,b,e){void 0===a&&(a=300);void 0===b&&(b=12);void 0===e&&(e=.84);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=e;this.time=
new d.FilteredFiniteDifference(.6);this.screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this.scene=[new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6)];this.tmpDirection=h.vec3f64.create()}a.prototype.add=function(a,b,d){this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(d))};
a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,
b,d){k.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var c=k.vec3.length(this.tmpDirection);0<c&&k.vec3.scale(this.tmpDirection,this.tmpDirection,1/c);return new l(a,b,d,c/this.time.filteredDelta,this.tmpDirection)};return a}();a.PanPlanarMomentumEstimator=n})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.gain=
a}a.prototype.update=function(a){if(this.hasLastValue){var h=this.computeDelta(a);this.updateDelta(h)}this.lastValue=a};a.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(a.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});a.prototype.computeDelta=function(a){return a-
this.lastValue};a.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return a}();a.FilteredFiniteDifference=n})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g){this._initialVelocity=a;this._stopVelocity=d;this._friction=g;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,d){var g=this.value(a);return this.value(a+
d)-g};a.prototype.valueFromInitialVelocity=function(a,d){d=Math.min(d,this.duration);var g=1-this.friction;return a*(Math.pow(g,d)-1)/Math.log(g)};return a}();a.Momentum=n})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});var b=function(b){function a(a,c,d,e,f,g,l){void 0===g&&(g=0);a=b.call(this,a,c,d)||this;a.angularVelocity1=e;a.axis1=f;a.angularVelocity2=g;a.axis2=l;return a}m(a,b);a.prototype.value1=function(a){return b.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,a)};a.prototype.value2=function(a){return b.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,a)};return a}(c.Momentum);a.PanSphericalMomentum=
b;n=function(){function a(b,a,c){void 0===b&&(b=300);void 0===a&&(a=12);void 0===c&&(c=.84);this.minimumInitialVelocity=b;this.stopVelocity=a;this.friction=c;this.tmpAxis1=d.vec3f64.create();this.tmpAxis2=d.vec3f64.create();this.tmpAngles=k.vec2f64.create();this.time=new l.FilteredFiniteDifference(.3);this.screen=[new l.FilteredFiniteDifference(.4),new l.FilteredFiniteDifference(.4)];this.angle1=new f.FilteredValue(.6);this.angle2=new f.FilteredValue(.6);this.axis1=d.vec3f64.create();this.axis2=d.vec3f64.create();
this.lastScene=d.vec3f64.create()}a.prototype.addMomentumDirectRotation=function(b,a,c,d,e,f){if(this.time.hasLastValue){if(.01>this.time.computeDelta(c))return;d=g.rotationAngleAndAxisDirectRotation(this.lastScene,a,this.tmpAxis2,d,e,f);this.angle2.update(0);1E-5>h.vec3.squaredLength(this.tmpAxis2)?d=0:h.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(d);h.vec3.copy(this.lastScene,a)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);this.time.update(c)};a.prototype.addMomentumPreserveHeading=
function(b,a,c,d,e,f,l){if(this.time.hasLastValue){if(.01>this.time.computeDelta(c))return;g.rotationAnglesAndAxesHeadingPreserving(this.lastScene,a,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,d,e,f,l,!1);1E-5>h.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),h.vec3.normalize(this.axis1,this.tmpAxis1),h.vec3.normalize(this.axis2,this.tmpAxis2));h.vec3.copy(this.lastScene,a)}this.screen[0].update(b[0]);
this.screen[1].update(b[1]);this.time.update(c)};a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var b=this.screen[0].filteredDelta,a=this.screen[1].filteredDelta,b=Math.sqrt(b*b+a*a)/this.time.filteredDelta;return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};a.prototype.createMomentum=
function(a,c,d){return new b(a,c,d,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return a}();a.PanSphericalMomentumEstimator=n})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.gain=a}a.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*
a:a};a.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(a.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return a}();a.FilteredValue=n})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,l,f,c){void 0===d&&(d=3);void 0===
l&&(l=.01);void 0===f&&(f=.95);void 0===c&&(c=12);return a.call(this,d,l,f,c)||this}m(d,a);d.prototype.add=function(d,l){if(this.value.hasLastValue){var f=this.value.lastValue;for(d-=f;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=f+d}a.prototype.add.call(this,d,l)};return d}(k.MomentumEstimator);a.RotationMomentumEstimator=n})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,c,b){void 0===a&&(a=2.5);void 0===d&&(d=.01);void 0===c&&(c=.95);void 0===b&&(b=12);this.minimumInitialVelocity=a;this.stopVelocity=d;this.friction=c;this.maxVelocity=b;this.value=new h.FilteredFiniteDifference(.8);this.time=new h.FilteredFiniteDifference(.3)}a.prototype.add=function(a,d){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(a);
0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(d);this.value.update(a)};a.prototype.reset=function(){this.value.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,a=k.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,f,c){return new d.Momentum(a,
f,c)};return a}();a.MomentumEstimator=n})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(a){function d(d,c,b){return a.call(this,d,c,b)||this}m(d,a);d.prototype.value=function(d){d=a.prototype.value.call(this,d);return Math.exp(d)};d.prototype.valueDelta=function(d,c){var b=a.prototype.value.call(this,d);
d=a.prototype.value.call(this,d+c);return Math.exp(d-b)};return d}(k.Momentum);a.ZoomMomentum=d;n=function(a){function g(d,c,b,e){void 0===d&&(d=2.5);void 0===c&&(c=.01);void 0===b&&(b=.95);void 0===e&&(e=12);return a.call(this,d,c,b,e)||this}m(g,a);g.prototype.add=function(d,c){a.prototype.add.call(this,Math.log(d),c)};g.prototype.createMomentum=function(a,c,b){return new d(a,c,b)};return g}(h.MomentumEstimator);a.ZoomMomentumEstimator=n})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){Object.defineProperty(a,"__esModule",{value:!0});var t;(function(b){b[b.Vertical=0]="Vertical";b[b.Horizontal=1]="Horizontal"})(t=a.PanMode||(a.PanMode={}));var x=g.vec3f64.fromValues(0,0,1),z=16/180*Math.PI;n=function(a){function c(b,c){var d=a.call(this)||this;d.view=b;d.intersectionHelper=c;d.rotationValueSmooth=new f.ExponentialFalloff(.05);d.scalingValueSmooth=new f.ExponentialFalloff(.05);d.planeHorizontal=r.plane.create();d.planeVertical=r.plane.create();
d.rotationMomentumEstimator=new v.RotationMomentumEstimator;d.panMomentumEstimator=new u.PanPlanarMomentumEstimator(300,12,.9);d.zoomMomentumEstimator=new y.ZoomMomentumEstimator;d.beginCenter=g.vec3f64.create();d.tmpPoints=[];d.beginCenterScreen=h.createScreenPointArray();d.tmpCentroid3d=g.vec3f64.create();d.tmpCentroid2d=h.createScreenPointArray();d.tmp2d=h.createScreenPointArray();d.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new w.default,interactionDirection:null,
tiltMode:0};return d}m(c,a);c.prototype.begin=function(b){if(this.active){this.beginRadius=b.radius;this.pointerCount=b.pointers.size;this.beginAngle=b.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();h.screenPointObjectToArray(b.center,this.beginCenterScreen);r.plane.fromNormalAndOffset(x,0,this.planeHorizontal);var a=g.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,a);var c=g.vec3f64.create();d.vec3.negate(c,this.beginCamera.viewForward);
var e=g.vec3f64.create();d.vec3.copy(e,x);var f=d.vec3.dot(c,e);this.panMode=k.asinClamped(0>f?-f:f)>=z?t.Horizontal:t.Vertical;r.plane.setOffsetFromPoint(this.planeHorizontal,a,this.planeHorizontal);this.beginCamera.aboveGround||r.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===t.Vertical?(d.vec3.scale(e,e,f),d.vec3.subtract(this.planeVertical,c,e),d.vec3.normalize(this.planeVertical,this.planeVertical),r.plane.setOffsetFromPoint(this.planeVertical,a,this.planeVertical),this.computePlanePoints(b.pointers,
this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(b.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);q.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};c.prototype.update=function(b){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var a=1<b.pointers.size,c=this.panMode===t.Horizontal?this.planeHorizontal:this.planeVertical,d=this.beginCenter;if(a){var e=this.beginRadius/b.radius,
f=.001875*Math.min(Math.max(b.radius,40),120);this.scalingValueSmooth.gain=f;this.scalingValueSmooth.update(e);q.applyZoomToPoint(this.currentCamera,d,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*b.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(Math.abs(b.radius-this.beginRadius));l.applyAll(this.view,this.currentCamera,
this.constraintOptions)}this.computePlanePoints(b.pointers,c,this.currentCamera,this.tmpPoints);q.centroid(this.tmpPoints,this.tmpCentroid3d);h.screenPointObjectToArray(b.center,this.tmpCentroid2d);q.applyPanPlanar(this.currentCamera,d,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*b.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);
l.applyAll(this.view,this.currentCamera,this.constraintOptions);a&&(a=this.planeHorizontal,c=this.rotationValueSmooth.value,e=q.normalizeRotationDelta(b.angle-c),f=.00125*Math.min(Math.max(b.radius,40),120),this.rotationValueSmooth.gain=f,this.rotationValueSmooth.update(c+e),f=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(f,.001*b.timestamp),q.applyRotation(this.currentCamera,d,r.axisAngle.wrapAxisAngle(a,f)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
l.pixelDistanceToInteractionFactor(Math.abs(b.radius*f)),l.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};c.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new p.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?new e.RotationMomentumController(this.view,a,this.beginCenter,this.planeHorizontal):
(a=this.panMomentumEstimator.evaluateMomentum())?new b.PanPlanarMomentumController(this.view,a):null};c.prototype.computePlanePoints=function(b,a,c,d){d.length=b.size;var e=this.tmp2d,f=0;b.forEach(function(b){e[0]=b.x;e[1]=b.y;void 0===d[f]&&(d[f]=g.vec3f64.create());q.intersectPlaneFromScreenPoint(a,c,e,d[f]);f+=1});return d};return c}(c.InteractiveController);a.PinchAndPanController=n})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"../../../input/InputHandler"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,l){var f=a.call(this,!0)||this;f.view=d;f.registerIncoming("pointer-down",l,function(a){return f.view.state.stopActiveCameraController()});return f}m(d,a);return d}(k.InputHandler);a.PointerDownCancelAnimation=n})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(n,
a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,l,f){f=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",l,f)||this;f.view=d;f.key=l;return f}m(d,a);d.prototype.activate=function(){this.view.goTo({heading:0})};return d}(k.SingleKey);a.SingleKeyResetHeading=n})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(n,a,m,k){Object.defineProperty(a,
"__esModule",{value:!0});n=function(a){function d(d,l,f){var c=a.call(this,!0)||this;c.key=l;c.registerIncoming("key-down",f,function(b){return c._handleKeyDown(b)});return c}m(d,a);d.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return d}(k.InputHandler);a.SingleKey=n})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(n,a,m,k){Object.defineProperty(a,
"__esModule",{value:!0});n=function(a){function d(d,l,f){f=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",l,f)||this;f.view=d;f.key=l;return f}m(d,a);d.prototype.activate=function(){this.view.goTo({tilt:0})};return d}(k.SingleKey);a.SingleKeyResetTilt=n})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,c){void 0===c&&(c=!1);var b=a.call(this,!0)||this;b.view=d;b.invert=c;b.registerIncoming("vertical-two-finger-drag",function(a){return b.handleTwoFinger(a)});return b}m(d,a);d.prototype.handleTwoFinger=function(a){var c=k.createScreenPointArray(0,a.data.delta*(this.invert?-1:1));switch(a.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
new h.RotateController(this.view,this.view.sceneIntersectionHelper,"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return d}(d.InputHandler);a.TwoFingerTilt=n})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=m("trident"),f=m("edge"),c=m("chrome"),b=m("ff"),e=m("safari");n=function(){function a(b,a){var c=this;this.input=a;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._element=b;h.applyLocal(b);b.getAttribute("tabindex")||b.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,
"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=b.style.touchAction;b.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new g.GamepadSource(b,this.input);this._gamepadSource.onEvent=function(b){return c._callback("gamepad",
b)}}a.prototype.destroy=function(){var b=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(a){b._releasePointerCaptureSafe(a)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(a.prototype,"onEventReceived",{set:function(b){this._callback=b},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"activeEvents",{set:function(b){var a=this,c;for(c in this._active)b&&b.has(c)||(this._element.removeEventListener(p[c],this._active[c]),delete this._active[c]);b&&b.forEach(function(b){if(!a._active[b]&&p[b]){var c=(a._eventHandlers[b]||a._handleDefault).bind(a,b);a._element.addEventListener(p[b],c);a._active[b]=c}});this._gamepadSource.pollingEnabled=b&&b.has("gamepad")},enumerable:!0,configurable:!0});a.prototype.setPointerCapture=function(b,
a){a?(this._element.setPointerCapture(b.pointerId),this._activePointerCaptures.add(b.pointerId)):(this._releasePointerCaptureSafe(b.pointerId),this._activePointerCaptures.delete(b.pointerId))};a.prototype._releasePointerCaptureSafe=function(b){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(b)||this._element.releasePointerCapture(b)}catch(w){}};a.prototype._updateNormalizedPointerLikeEvent=function(b,c){b=k.createScreenPointFromNativeEvent(this._element,b);a.test.disableSubpixelCoordinates&&
(b.x=Math.round(b.x),b.y=Math.round(b.y));c.x=b.x;c.y=b.y;return c};a.prototype._handleKey=function(b,a){var c=d.eventKey(a);c&&"key-up"===b&&this._keyDownState.delete(c);a={native:a,key:c,repeat:c&&this._keyDownState.has(c)};c&&"key-down"===b&&this._keyDownState.add(a.key);this._callback(b,a)};a.prototype._handlePointer=function(b,a){a=this._updateNormalizedPointerLikeEvent(a,{native:a,x:0,y:0,pointerType:a.pointerType,button:a.button,buttons:a.buttons,eventId:this._eventId++});this._callback(b,
a)};a.prototype._handlePointerPreventDefault=function(b,a){var c=this._updateNormalizedPointerLikeEvent(a,{native:a,x:0,y:0,pointerType:a.pointerType,button:a.button,buttons:a.buttons,eventId:this._eventId++});a.preventDefault();this._callback(b,c)};a.prototype._handleMouseWheel=function(a,d){d.preventDefault();var g=d.deltaY;switch(d.deltaMode){case 0:if(l||f)g=g/document.documentElement.clientHeight*600;break;case 1:g*=30;break;case 2:g*=900}l||f?g*=.7:c||e?g*=.6:b&&(g*=1.375);var p=Math.abs(g);
100<p&&(g=g/p*200/(1+Math.exp(-.02*(p-100))));d=this._updateNormalizedPointerLikeEvent(d,{native:d,x:0,y:0,deltaY:g});this._callback(a,d)};a.prototype._handlePointerCaptureLost=function(b,a){this._activePointerCaptures.delete(a.pointerId);this._handleDefault(b,a)};a.prototype._handleDefault=function(b,a){var c={native:a};a.preventDefault();this._callback(b,c)};a.prototype._preventAltKeyDefault=function(b){"Alt"===b.key&&b.preventDefault()};a.test={disableSubpixelCoordinates:!1};return a}();a.BrowserEventSource=
n;var p={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function n(a,d){d=d||Object.create(null);var e=document.createEvent("Event");
e.initEvent(a,d.bubbles||!1,d.cancelable||!1);a=2;for(var f;a<c.length;a++)f=c[a],e[f]=d[f]||b[a];e.buttons=d.buttons||0;a=0;a=d.pressure&&e.buttons?d.pressure:e.buttons?.5:0;e.x=e.clientX;e.y=e.clientY;e.pointerId=d.pointerId||0;e.width=d.width||0;e.height=d.height||0;e.pressure=a;e.tiltX=d.tiltX||0;e.tiltY=d.tiltY||0;e.twist=d.twist||0;e.tangentialPressure=d.tangentialPressure||0;e.pointerType=d.pointerType||"";e.hwTimestamp=d.hwTimestamp||0;e.isPrimary=d.isPrimary||!1;return e}function a(){this.array=
[];this.size=0}function m(b,a,c,d){this.addCallback=b.bind(d);this.removeCallback=a.bind(d);this.changedCallback=c.bind(d);A&&(this.observer=new A(this.mutationWatcher.bind(this)))}function k(b){return"body /shadow-deep/ "+h(b)}function h(b){return'[touch-action\x3d"'+b+'"]'}function d(b){return"{ -ms-touch-action: "+b+"; touch-action: "+b+"; }"}function g(){if(F){B.forEach(function(b){String(b)===b?(G+=h(b)+d(b)+"\n",K&&(G+=k(b)+d(b)+"\n")):(G+=b.selectors.map(h)+d(b.rule)+"\n",K&&(G+=b.selectors.map(k)+
d(b.rule)+"\n"))});var b=document.createElement("style");b.textContent=G;document.head.appendChild(b)}}function l(b){if(!u.pointermap.has(b))throw b=Error("NotFoundError"),b.name="NotFoundError",b;}function f(b){for(var a=b.parentNode;a&&a!==b.ownerDocument;)a=a.parentNode;if(!a)throw b=Error("InvalidStateError"),b.name="InvalidStateError",b;}var c="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),b=[!1,!1,
null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],e=window.Map&&window.Map.prototype.forEach?Map:a;a.prototype={set:function(b,a){if(void 0===a)return this.delete(b);this.has(b)||this.size++;this.array[b]=a},has:function(b){return void 0!==this.array[b]},delete:function(b){this.has(b)&&(delete this.array[b],this.size--)},get:function(b){return this.array[b]},clear:function(){this.size=this.array.length=0},forEach:function(b,a){return this.array.forEach(function(c,d){b.call(a,c,d,this)},this)}};var p="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
q=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],r={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},w="undefined"!==typeof SVGElementInstance,u={pointermap:new e,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(b,a){var c=a.events;c&&(c.forEach(function(b){a[b]&&(this.eventMap[b]=a[b].bind(a))},this),this.eventSources[b]=a,this.eventSourceList.push(a))},register:function(b){for(var a=
this.eventSourceList.length,c=0,d;c<a&&(d=this.eventSourceList[c]);c++)d.register.call(d,b)},unregister:function(b){for(var a=this.eventSourceList.length,c=0,d;c<a&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,b)},contains:function(b,a){try{return b.contains(a)}catch(ca){return!1}},down:function(b){b.bubbles=!0;this.fireEvent("pointerdown",b)},move:function(b){b.bubbles=!0;this.fireEvent("pointermove",b)},up:function(b){b.bubbles=!0;this.fireEvent("pointerup",b)},enter:function(b){b.bubbles=
!1;this.fireEvent("pointerenter",b)},leave:function(b){b.bubbles=!1;this.fireEvent("pointerleave",b)},over:function(b){b.bubbles=!0;this.fireEvent("pointerover",b)},out:function(b){b.bubbles=!0;this.fireEvent("pointerout",b)},cancel:function(b){b.bubbles=!0;this.fireEvent("pointercancel",b)},leaveOut:function(b){this.out(b);this.propagate(b,this.leave,!1)},enterOver:function(b){this.over(b);this.propagate(b,this.enter,!0)},eventHandler:function(b){if(!b._handledByPE){var a=b.type;(a=this.eventMap&&
this.eventMap[a])&&a(b);b._handledByPE=!0}},listen:function(b,a){a.forEach(function(a){this.addEvent(b,a)},this)},unlisten:function(b,a){a.forEach(function(a){this.removeEvent(b,a)},this)},addEvent:function(b,a){b.addEventListener(a,this.boundHandler)},removeEvent:function(b,a){b.removeEventListener(a,this.boundHandler)},makeEvent:function(b,a){this.captureInfo[a.pointerId]&&(a.relatedTarget=null);b=new n(b,a);a.preventDefault&&(b.preventDefault=a.preventDefault);b._target=b._target||a.target;return b},
fireEvent:function(b,a){b=this.makeEvent(b,a);return this.dispatchEvent(b)},cloneEvent:function(b){for(var a=Object.create(null),c,d=0;d<p.length;d++)c=p[d],a[c]=b[c]||q[d],w&&("target"===c||"relatedTarget"===c)&&a[c]instanceof SVGElementInstance&&(a[c]=a[c].correspondingUseElement);b.preventDefault&&(a.preventDefault=function(){b.preventDefault()});return a},getTarget:function(b){var a=this.captureInfo[b.pointerId];if(!a)return b._target;if(b._target===a||!(b.type in r))return a},propagate:function(b,
a,c){for(var d=b.target,e=[];null!=d&&d!==document&&!d.contains(b.relatedTarget);)if(e.push(d),d=d.parentNode,!d)return;c&&e.reverse();e.forEach(function(c){b.target=c;a.call(this,b)},this)},setCapture:function(b,a,c){this.captureInfo[b]&&this.releaseCapture(b,c);this.captureInfo[b]=a;this.implicitRelease=this.releaseCapture.bind(this,b,c);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var d=new n("gotpointercapture");d.pointerId=
b;d._target=a;c||this.asyncDispatchEvent(d)},releaseCapture:function(b,a){var c=this.captureInfo[b];if(c){this.captureInfo[b]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var d=new n("lostpointercapture");d.pointerId=b;d._target=c;a||this.asyncDispatchEvent(d)}},dispatchEvent:function(b){var a=this.getTarget(b);if(a)return a.dispatchEvent(b)},asyncDispatchEvent:function(b){requestAnimationFrame(this.dispatchEvent.bind(this,
b))}};u.boundHandler=u.eventHandler.bind(u);var v={shadow:function(b){if(b)return b.shadowRoot||b.webkitShadowRoot},canTarget:function(b){return b&&!!b.elementFromPoint},targetingShadow:function(b){b=this.shadow(b);if(this.canTarget(b))return b},olderShadow:function(b){var a=b.olderShadowRoot;!a&&(b=b.querySelector("shadow"))&&(a=b.olderShadowRoot);return a},allShadows:function(b){var a=[];for(b=this.shadow(b);b;)a.push(b),b=this.olderShadow(b);return a},searchRoot:function(b,a,c){if(b){var d=b.elementFromPoint(a,
c),e;for(e=this.targetingShadow(d);e;){if(b=e.elementFromPoint(a,c))return d=this.targetingShadow(b),this.searchRoot(d,a,c)||b;e=this.olderShadow(e)}return d}},owner:function(b){for(;b.parentNode;)b=b.parentNode;b.nodeType!==Node.DOCUMENT_NODE&&b.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(b=document);return b},findTarget:function(b){var a=b.clientX,c=b.clientY;b=this.owner(b.target);b.elementFromPoint(a,c)||(b=document);return this.searchRoot(b,a,c)}},y=Array.prototype.forEach.call.bind(Array.prototype.forEach),
t=Array.prototype.map.call.bind(Array.prototype.map),x=Array.prototype.slice.call.bind(Array.prototype.slice),z=Array.prototype.filter.call.bind(Array.prototype.filter),A=window.MutationObserver||window.WebKitMutationObserver,E={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};m.prototype={watchSubtree:function(b){this.observer&&v.canTarget(b)&&this.observer.observe(b,E)},enableOnSubtree:function(b){this.watchSubtree(b);b===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(b)},installNewSubtree:function(b){y(this.findElements(b),this.addElement,this)},findElements:function(b){return b.querySelectorAll?b.querySelectorAll("[touch-action]"):[]},removeElement:function(b){this.removeCallback(b)},addElement:function(b){this.addCallback(b)},elementChanged:function(b,a){this.changedCallback(b,a)},concatLists:function(b,a){return b.concat(x(a))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(b){return b.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(b){var a=t(b,this.findElements,this);a.push(z(b,this.isElement));return a.reduce(this.concatLists,[])},mutationWatcher:function(b){b.forEach(this.mutationHandler,this)},mutationHandler:function(b){"childList"===b.type?(this.flattenMutationTree(b.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(b.removedNodes).forEach(this.removeElement,
this)):"attributes"===b.type&&this.elementChanged(b.target,b.oldValue)}};var B=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],G="",F=window.PointerEvent||window.MSPointerEvent,K=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,H=u.pointermap,N=[1,4,2,8,16],I=!1;try{I=1===(new MouseEvent("test",{buttons:1})).buttons}catch(da){}var J={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(b){u.listen(b,
this.events)},unregister:function(b){u.unlisten(b,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(b){var a=this.lastTouches,c=b.clientX;b=b.clientY;for(var d=0,e=a.length,f;d<e&&(f=a[d]);d++){var g=Math.abs(b-f.y);if(25>=Math.abs(c-f.x)&&25>=g)return!0}},prepareEvent:function(b){var a=u.cloneEvent(b),c=a.preventDefault;a.preventDefault=function(){b.preventDefault();c()};a.pointerId=this.POINTER_ID;a.isPrimary=!0;a.pointerType=this.POINTER_TYPE;return a},prepareButtonsForMove:function(b,
a){var c=H.get(this.POINTER_ID);b.buttons=0!==a.which&&c?c.buttons:0;a.buttons=b.buttons},mousedown:function(b){if(!this.isEventSimulatedFromTouch(b)){var a=H.get(this.POINTER_ID),c=this.prepareEvent(b);I||(c.buttons=N[c.button],a&&(c.buttons|=a.buttons),b.buttons=c.buttons);H.set(this.POINTER_ID,b);a&&0!==a.buttons?u.move(c):u.down(c)}},mousemove:function(b){if(!this.isEventSimulatedFromTouch(b)){var a=this.prepareEvent(b);I||this.prepareButtonsForMove(a,b);a.button=-1;H.set(this.POINTER_ID,b);u.move(a)}},
mouseup:function(b){if(!this.isEventSimulatedFromTouch(b)){var a=H.get(this.POINTER_ID),c=this.prepareEvent(b);if(!I){var d=N[c.button];c.buttons=a?a.buttons&~d:0;b.buttons=c.buttons}H.set(this.POINTER_ID,b);c.buttons&=~N[c.button];0===c.buttons?u.up(c):u.move(c)}},mouseover:function(b){if(!this.isEventSimulatedFromTouch(b)){var a=this.prepareEvent(b);I||this.prepareButtonsForMove(a,b);a.button=-1;H.set(this.POINTER_ID,b);u.enterOver(a)}},mouseout:function(b){if(!this.isEventSimulatedFromTouch(b)){var a=
this.prepareEvent(b);I||this.prepareButtonsForMove(a,b);a.button=-1;u.leaveOut(a)}},cancel:function(b){b=this.prepareEvent(b);u.cancel(b);this.deactivateMouse()},deactivateMouse:function(){H.delete(this.POINTER_ID)}},M=u.captureInfo,L=v.findTarget.bind(v),R=v.allShadows.bind(v),O=u.pointermap,T,U={events:["touchstart","touchmove","touchend","touchcancel"],register:function(b){T.enableOnSubtree(b)},unregister:function(){},elementAdded:function(b){var a=b.getAttribute("touch-action"),c=this.touchActionToScrollType(a);
c&&(b._scrollType=c,u.listen(b,this.events),R(b).forEach(function(b){b._scrollType=c;u.listen(b,this.events)},this))},elementRemoved:function(b){b._scrollType=void 0;u.unlisten(b,this.events);R(b).forEach(function(b){b._scrollType=void 0;u.unlisten(b,this.events)},this)},elementChanged:function(b,a){var c=b.getAttribute("touch-action"),d=this.touchActionToScrollType(c);a=this.touchActionToScrollType(a);d&&a?(b._scrollType=d,R(b).forEach(function(b){b._scrollType=d},this)):a?this.elementRemoved(b):
d&&this.elementAdded(b)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(b){var a=this.scrollTypes;if("none"===b)return"none";if(b===a.XSCROLLER)return"X";if(b===a.YSCROLLER)return"Y";if(a.SCROLLER.exec(b))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(b){return this.firstTouch===b.identifier},setPrimaryTouch:function(b){if(0===O.size||1===O.size&&O.has(1))this.firstTouch=
b.identifier,this.firstXY={X:b.clientX,Y:b.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(b){b.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var b=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(b,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(b){var a=0;if("touchstart"===b||"touchmove"===b)a=
1;return a},touchToPointer:function(b){var a=this.currentTouchEvent,c=u.cloneEvent(b),d=c.pointerId=b.identifier+2;c.target=M[d]||L(c);c.bubbles=!0;c.cancelable=!0;c.detail=this.clickCount;c.button=0;c.buttons=this.typeToButtons(a.type);c.width=2*(b.radiusX||b.webkitRadiusX||0);c.height=2*(b.radiusY||b.webkitRadiusY||0);c.pressure=b.force||b.webkitForce||.5;c.isPrimary=this.isPrimaryTouch(b);c.pointerType=this.POINTER_TYPE;c.altKey=a.altKey;c.ctrlKey=a.ctrlKey;c.metaKey=a.metaKey;c.shiftKey=a.shiftKey;
var e=this;c.preventDefault=function(){e.scrolling=!1;e.firstXY=null;a.preventDefault()};return c},processTouches:function(b,a){var c=b.changedTouches;this.currentTouchEvent=b;b=0;for(var d;b<c.length;b++)d=c[b],a.call(this,this.touchToPointer(d))},shouldScroll:function(b){if(this.firstXY){var a;a=b.currentTarget._scrollType;if("none"===a)a=!1;else if("XY"===a)a=!0;else{b=b.changedTouches[0];var c="Y"===a?"X":"Y";a=Math.abs(b["client"+a]-this.firstXY[a])>=Math.abs(b["client"+c]-this.firstXY[c])}this.firstXY=
null;return a}},findTouch:function(b,a){for(var c=0,d=b.length,e;c<d&&(e=b[c]);c++)if(e.identifier===a)return!0},vacuumTouches:function(b){var a=b.touches;if(O.size>=a.length){var c=[];O.forEach(function(b,d){1===d||this.findTouch(a,d-2)||c.push(b.out)},this);c.forEach(this.cancelOut,this)}},touchstart:function(b){this.vacuumTouches(b);this.setPrimaryTouch(b.changedTouches[0]);this.dedupSynthMouse(b);this.scrolling||(this.clickCount++,this.processTouches(b,this.overDown))},overDown:function(b){O.set(b.pointerId,
{target:b.target,out:b,outTarget:b.target});u.enterOver(b);u.down(b)},touchmove:function(b){this.scrolling||(this.shouldScroll(b)?(this.scrolling=!0,this.touchcancel(b)):(b.preventDefault(),this.processTouches(b,this.moveOverOut)))},moveOverOut:function(b){var a=O.get(b.pointerId);if(a){var c=a.out,d=a.outTarget;u.move(b);c&&d!==b.target&&(c.relatedTarget=b.target,b.relatedTarget=d,c.target=d,b.target?(u.leaveOut(c),u.enterOver(b)):(b.target=d,b.relatedTarget=null,this.cancelOut(b)));a.out=b;a.outTarget=
b.target}},touchend:function(b){this.dedupSynthMouse(b);this.processTouches(b,this.upOut)},upOut:function(b){this.scrolling||(u.up(b),u.leaveOut(b));this.cleanUpPointer(b)},touchcancel:function(b){this.processTouches(b,this.cancelOut)},cancelOut:function(b){u.cancel(b);u.leaveOut(b);this.cleanUpPointer(b)},cleanUpPointer:function(b){O.delete(b.pointerId);this.removePrimaryPointer(b)},dedupSynthMouse:function(b){var a=J.lastTouches;b=b.changedTouches[0];this.isPrimaryTouch(b)&&(b={x:b.clientX,y:b.clientY},
a.push(b),a=function(b,a){a=b.indexOf(a);-1<a&&b.splice(a,1)}.bind(null,a,b),setTimeout(a,2500))}};T=new m(U.elementAdded,U.elementRemoved,U.elementChanged,U);var P=u.pointermap,V=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,W={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(b){u.listen(b,this.events)},unregister:function(b){u.unlisten(b,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(b){var a=b;V&&(a=u.cloneEvent(b),a.pointerType=this.POINTER_TYPES[b.pointerType]);return a},cleanup:function(b){P.delete(b)},MSPointerDown:function(b){P.set(b.pointerId,b);b=this.prepareEvent(b);u.down(b)},MSPointerMove:function(b){b=this.prepareEvent(b);u.move(b)},MSPointerUp:function(b){var a=this.prepareEvent(b);u.up(a);this.cleanup(b.pointerId)},MSPointerOut:function(b){b=this.prepareEvent(b);u.leaveOut(b)},MSPointerOver:function(b){b=
this.prepareEvent(b);u.enterOver(b)},MSPointerCancel:function(b){var a=this.prepareEvent(b);u.cancel(a);this.cleanup(b.pointerId)},MSLostPointerCapture:function(b){b=u.makeEvent("lostpointercapture",b);u.dispatchEvent(b)},MSGotPointerCapture:function(b){b=u.makeEvent("gotpointercapture",b);u.dispatchEvent(b)}},Q,Z,X;window.navigator.msPointerEnabled?(Q=function(b){l(b);f(this);0!==u.pointermap.get(b).buttons&&(u.setCapture(b,this,!0),this.msSetPointerCapture(b))},Z=function(b){l(b);u.releaseCapture(b,
!0);this.msReleasePointerCapture(b)}):(Q=function(b){l(b);f(this);0!==u.pointermap.get(b).buttons&&u.setCapture(b,this)},Z=function(b){l(b);u.releaseCapture(b)});X=function(b){return!!u.captureInfo[b]};var aa=window.PointerEvent||window.MSPointerEvent;return{dispatcher:u,Installer:m,PointerEvent:n,PointerMap:e,targetFinding:v,applyGlobal:function(){g();window.PointerEvent||(window.PointerEvent=n,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),u.registerSource("ms",W)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),u.registerSource("mouse",J),void 0!==window.ontouchstart&&u.registerSource("touch",U)),u.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:Q},releasePointerCapture:{value:Z},hasPointerCapture:{value:X}})},applyLocal:function(b){aa||(window.PointerEvent||(window.navigator.msPointerEnabled?
u.registerSource("ms",W):(u.registerSource("mouse",J),void 0!==window.ontouchstart&&u.registerSource("touch",U)),u.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(b.setPointerCapture=Q.bind(b),b.releasePointerCapture=Z.bind(b),b.hasPointerCapture=X.bind(b)),b.getAttribute("touch-action")||b.setAttribute("touch-action","none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/events","../../core/has"],function(n,a,m,k){Object.defineProperty(a,
"__esModule",{value:!0});a.primaryKey="Meta";var h={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(n=48;58>n;n++)h[n]=String.fromCharCode(n);for(n=1;25>n;n++)h[111+n]="F"+n;for(n=65;91>n;n++)h[n]=[String.fromCharCode(n+32),String.fromCharCode(n)];a.eventKey=function(a){if(void 0!==a.key)return m.eventKey(a);var d=h[a.keyCode];return Array.isArray(d)?a.shiftKey?d[1]:d[0]:
d};a.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}return!1}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,f){var c=this;this.element=a;this.input=f;this.handleGamepadConnectedEvent=function(b){c.handleGamepadConnected(b.gamepad)};
this.handleGamepadDisconnectedEvent=function(b){b=b.gamepad;var a=c.inputDevices[b.index];a&&(c.emitGamepadEvent(b,d.extractState(a),!1),c.inputDevices[b.index]=void 0,c.latestUpdate[b.index]=void 0,c.input.gamepad.devices.remove(a))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(b){return c.handleGamepadConnected(b)}),window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),
window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}a.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent))};Object.defineProperty(a.prototype,"onEvent",{set:function(a){this.callback=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pollingEnabled",{set:function(a){this.supported&&
(a?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});a.prototype.handleGamepadConnected=function(a){var d=new h(a);"unknown"!==d.deviceType&&(this.inputDevices[a.index]=d,this.input.gamepad.devices.add(d))};a.prototype.startPolling=function(){var a=this;null==this.frameTask&&(this.frameTask=k.addFrameTask({update:function(){return a.readGamepadState()}}))};a.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=
[])};a.prototype.readGamepadState=function(){var a=this,f=document.hasFocus(),c=this.element.contains(document.activeElement),b="document"===this.input.gamepad.enabledFocusMode&&!f||"view"===this.input.gamepad.enabledFocusMode&&!c;this.forEachGamepad(function(c){var e=a.inputDevices[c.index];if(e){var f=a.latestUpdate[c.index],e=d.extractState(e),g=b||d.stateIdle(e);f&&(f.timestamp===c.timestamp||!f.active&&g||d.stateEqual(f.state,e))||a.emitGamepadEvent(c,e,!g)}})};a.prototype.forEachGamepad=function(a){for(var d=
window.navigator.getGamepads(),c=0;c<d.length;c++){var b=d[c];this.validate(b)&&a(b)}};a.prototype.emitGamepadEvent=function(a,d,c){var b=this.latestUpdate[a.index];if((b=b&&b.active)||c)this.latestUpdate[a.index]={timestamp:a.timestamp,state:d,active:c},this.callback&&this.callback({device:this.inputDevices[a.index],state:d,action:!b&&c?"start":b&&c?"update":"end"})};a.prototype.validate=function(a){if(!a||!a.connected)return!1;for(var d=0;d<a.axes.length;d++)if(isNaN(a.axes[d]))return!1;return!0};
return a}();a.GamepadSource=n})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../../core/mathUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.extractState=function(a){var h=a.native;return{buttons:h.buttons.map(function(a){return a.pressed?a.value?a.value:1:0}),axes:h.axes.map(function(d){var g=a.axisThreshold,l=Math.abs(d);d=l<g?0:m.sign(d)*(l-g)/(1-g);return d})}};a.stateEqual=function(a,h){if(a.axes.length!==h.axes.length||a.buttons.length!==
h.buttons.length)return!1;for(var d=0;d<a.axes.length;d++)if(a.axes[d]!==h.axes[d])return!1;for(d=0;d<a.buttons.length;d++)if(a.buttons[d]!==h.buttons[d])return!1;return!0};a.stateIdle=function(a){for(var h=0;h<a.axes.length;h++)if(0!==a.axes[h])return!1;for(h=0;h<a.buttons.length;h++)if(0!==a.buttons[h])return!1;return!0}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./handlers/LatestPointerType".split(" "),
function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});var b=d.getLogger("esri.views.input.InputManager");n=function(a){function d(b,c){b=a.call(this)||this;b._pointerCaptures=new Map;b._nameToGroup={};b._handlers=[];b._currentPropagation=null;b._sourceEvents=new Set;b._keyModifiers=new Set;b._activeKeyModifiers=new Set;b.primaryKey=f.primaryKey;b.latestPointerType="mouse";b._installRecognizers();return b}m(d,a);d.prototype.normalizeCtorArgs=function(b,a){this._browserEvents=
b;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=a;return{}};d.prototype.destroy=function(){for(var b=0,a=Object.keys(this._nameToGroup);b<a.length;b++)this.uninstallHandlers(a[b]);this._browserEvents=null};Object.defineProperty(d.prototype,"hasPendingInputs",{get:function(){return this._handlers.some(function(b){return b.handler.hasPendingInputs})},enumerable:!0,configurable:!0});d.prototype.installHandlers=function(a,c){var d=this;if(this._nameToGroup[a])b.error("There is already an InputHandler group registered under the name `"+
a+"`");else if(0===c.length)b.error("Can't register a group of zero handlers");else{var e={name:a,handlers:c.map(function(b,a){return{handler:b,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=e;a=function(b){var a=e.handlers[b];f._handlers.push(a);a.handler.onInstall({updateDependencies:function(){d.updateDependencies()},emit:function(b,c,e,f){d._emitInputEvent(a.priorityIndex,b,c,e,f)},setPointerCapture:function(b,c){d._setPointerCapture(e,
a,b,c)},setEventCallback:function(b){a.eventCallback=b},setUninstallCallback:function(b){a.uninstallCallback=b},refreshHasPendingInputs:function(){d.notifyChange("hasPendingInputs")}})};var f=this;for(c=e.handlers.length-1;0<=c;c--)a(c);this.updateDependencies()}};d.prototype.uninstallHandlers=function(a){var c=this._nameToGroup[a];c?(c.handlers.forEach(function(b){b.removed=!0;b.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=
!0:this._garbageCollectRemovedHandlers()):b.error("There is no InputHandler group registered under the name `"+a+"`")};d.prototype.hasHandlers=function(b){return void 0!==this._nameToGroup[b]};d.prototype.updateDependencies=function(){var b=new Set,a=new Set;this._handlersPriority=[];for(var c=this._handlers.length-1;0<=c;c--){var d=this._handlers[c];d.priorityIndex=c;this._handlersPriority.push(d)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(c=this._handlersPriority.length-
1;0<=c;c--){d=this._handlersPriority[c];d.priorityIndex=c;var e=d.handler.hasSideEffects;if(!e)for(var g=0,l=d.handler.outgoingEventTypes;g<l.length;g++)if(b.has(l[g])){e=!0;break}if(e)for(g=0,l=d.handler.incomingEventMatches;g<l.length;g++){var p=l[g];b.add(p.eventType);for(var h=0,p=p.keyModifiers;h<p.length;h++){var q=p[h];f.isSystemModifier(q)||a.add(q)}}d.active=e}this._sourceEvents=b;this._keyModifiers=a;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&
(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};d.prototype._setLatestPointerType=function(b){this._set("latestPointerType",b)};d.prototype._onEventReceived=function(b,a){"pointer-capture-lost"===b&&this._pointerCaptures.delete(a.native.pointerId);this._updateKeyModifiers(b,a);this._emitInputEventFromSource(b,a,a.native?a.native.timestamp:void 0)};d.prototype._updateKeyModifiers=function(b,a){var c=this;
if(a){var d=!1,e=function(){if(!d){var b=new Set;c._activeKeyModifiers.forEach(function(a){b.add(a)});c._activeKeyModifiers=b;d=!0}},f=function(b,a){a&&!c._activeKeyModifiers.has(b)?(e(),c._activeKeyModifiers.add(b)):!a&&c._activeKeyModifiers.has(b)&&(e(),c._activeKeyModifiers.delete(b))};if("key-down"===b||"key-up"===b){var g=a.key;this._keyModifiers.has(g)&&f(g,"key-down"===b)}b=a.native;f("Alt",!(!b||!b.altKey));f("Ctrl",!(!b||!b.ctrlKey));f("Shift",!(!b||!b.shiftKey));f("Meta",!(!b||!b.metaKey));
f("Primary",this._activeKeyModifiers.has(this.primaryKey))}};d.prototype._installRecognizers=function(){var b=this;this._latestPointerTypeHandler=new c.LatestPointerType(function(a){return b._setLatestPointerType(a)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};d.prototype._setPointerCapture=function(b,a,c,d){b=b.name+"-"+a.priorityIndex;a=this._pointerCaptures.get(c.pointerId)||new Set;
this._pointerCaptures.set(c.pointerId,a);d?(a.add(b),1===a.size&&this._browserEvents&&this._browserEvents.setPointerCapture(c,!0)):a.has(b)&&(a.delete(b),0===a.size&&(this._pointerCaptures.delete(c.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(c,!1)))};d.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(b){return!b.removed});this.updateDependencies()};d.prototype._emitInputEventFromSource=function(b,a,c){this._emitInputEvent(0,
b,a,c)};d.prototype._emitInputEvent=function(b,a,c,d,f){d=void 0!==d?d:this._currentPropagation?this._currentPropagation.timestamp:g();a=new e(a,c,d,f||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(a):this._doNewPropagation(b,a)};d.prototype._doNewPropagation=function(b,a){for(b=this._currentPropagation={events:[a],addedEvents:[],currentHandler:this._handlersPriority[b],needsHandlerGarbageCollect:!1,timestamp:a.timestamp};b.currentHandler;){if(b.currentHandler.removed)b.needsHandlerGarbageCollect=
!0;else{a=b.events;var c=[];b.addedEvents=[];for(var d=0;d<a.length;d++){var e=a[d];b.currentHandler.active&&b.currentHandler.eventCallback(e);e.shouldStopPropagation()||c.push(e)}b.events=c.concat(b.addedEvents)}b.currentHandler=this._handlersPriority[b.currentHandler.priorityIndex+1]}b.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};d.prototype._compareHandlerPriority=function(b,a){if(b.handler.hasSideEffects!==a.handler.hasSideEffects)return b.handler.hasSideEffects?
1:-1;for(var c=0,d=b.handler.incomingEventMatches;c<d.length;c++)for(var e=d[c],f=function(b){if(e.eventType!==b.eventType)return"continue";var a=e.keyModifiers.filter(function(a){return-1!==b.keyModifiers.indexOf(a)});if(a.length===e.keyModifiers.length!==(a.length===b.keyModifiers.length))return{value:e.keyModifiers.length>b.keyModifiers.length?-1:1}},g=0,l=a.handler.incomingEventMatches;g<l.length;g++){var p=f(l[g]);if("object"===typeof p)return p.value}return b.priorityIndex>a.priorityIndex?-1:
1};d.prototype._sortHandlersPriority=function(b){for(var a=[],c=0;c<b.length;c++){for(var d=b[c],e=0;e<a.length&&0<=this._compareHandlerPriority(d,a[e]);)e++;a.splice(e,0,d)}return a};Object.defineProperty(d.prototype,"debug",{get:function(){var b=this,a=function(a){var c=b._setPointerCapture;b._setPointerCapture=function(){};a();b._setPointerCapture=c};return{injectEvent:function(c,d){a(function(){b._onEventReceived(c,d)})},disablePointerCapture:a}},enumerable:!0,configurable:!0});k([l.property({readOnly:!0})],
d.prototype,"hasPendingInputs",null);k([l.property({readOnly:!0})],d.prototype,"latestPointerType",void 0);return d=k([l.subclass("esri.views.input.InputManager")],d)}(l.declared(h));a.InputManager=n;var e=function(){function b(b,a,c,d){this.type=b;this.data=a;this.timestamp=c;this.modifiers=d;this._stopPropagation=!1}b.prototype.stopPropagation=function(){this._stopPropagation=!0};b.prototype.shouldStopPropagation=function(){return this._stopPropagation};return b}()})},"esri/views/input/handlers/LatestPointerType":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d){var g=a.call(this,!0)||this;g._onChange=d;g._value="mouse";g.registerIncoming("pointer-down",function(a){g._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});g._moveHandler=g.registerIncoming("pointer-move",function(a){g._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});g._moveHandler.pause();return g}m(d,a);
d.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():this._moveHandler.pause(),this._value=a,this._onChange(a))};return d}(k.InputHandler);a.LatestPointerType=n})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){var d=a.call(this,!0)||this;d.registerIncoming("context-menu",
function(a){a.data.native.preventDefault()});return d}m(d,a);return d}(k.InputHandler);a.PreventContextMenu=n;a.default=n})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/screenUtils ../InputHandler ./support".split(" "),function(n,a,m,k,h,d){function g(b){var a=[];b.forEach(function(b){a.push(k.createScreenPoint(b.event.x,b.event.y))});return d.fitCircleLSQ(a)}function l(b){var a=g(b),d=0;b.forEach(function(b){for(var e=
c(b,a),e=e-b.lastAngle;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;e=b.lastAngle+e;b.lastAngle=e;d+=e-b.initialAngle});d/=b.size||1;return{angle:d,radius:a.radius,center:a.center}}function f(b){var a=new Map;b.forEach(function(b,c){return a.set(c,b.event)});return a}function c(b,a){b=b.event;return Math.atan2(b.y-a.center.y,b.x-a.center.x)}Object.defineProperty(a,"__esModule",{value:!0});n=function(b){function a(){var a=b.call(this,!1)||this;a.startStateModifiers=new Set;a.activePointerMap=
new Map;a.isDragging=!1;a.drag=a.registerOutgoing("drag");a.registerIncoming("pointer-drag",a.handlePointerDrag.bind(a));a.registerIncoming("pointer-up",a.handlePointerUpAndPointerLost.bind(a));a.registerIncoming("pointer-capture-lost",a.handlePointerUpAndPointerLost.bind(a));a.registerIncoming("pointer-cancel",a.handlePointerUpAndPointerLost.bind(a));return a}m(a,b);a.prototype.createPayload=function(b,a,c,d){return{action:b,pointerType:this.pointerType,button:this.mouseButton,buttons:a.buttons,
timestamp:d,pointers:f(this.activePointerMap),pointer:a,angle:c.angle,radius:c.radius,center:c.center}};a.prototype.addPointer=function(b){var a=b.native.pointerId,d=l(this.activePointerMap).angle;b={event:b,initialAngle:0,lastAngle:0};this.activePointerMap.set(a,b);a=c(b,g(this.activePointerMap));b.initialAngle=a;b.lastAngle=a;this.updatePointerAngles(d)};a.prototype.updatePointer=function(b){if(!b||null!=b.x||null!=b.y){var a=this.activePointerMap.get(b.native.pointerId);a?a.event=b:this.addPointer(b)}};
a.prototype.removePointer=function(b){var a=l(this.activePointerMap).angle;this.activePointerMap.delete(b);this.updatePointerAngles(a)};a.prototype.updatePointerAngles=function(b){var a=l(this.activePointerMap);this.activePointerMap.forEach(function(d){d.initialAngle=c(d,a)-b;d.lastAngle=c(d,a)-b})};a.prototype.emitEvent=function(b,a,c){var d=l(this.activePointerMap);this.drag.emit(this.createPayload(b,a,d,c),void 0,this.startStateModifiers)};a.prototype.handlePointerUpAndPointerLost=function(b){var a=
b.data.native.pointerId,c=b.timestamp;this.activePointerMap.get(a)&&(1===this.activePointerMap.size?(this.updatePointer(b.data),this.emitEvent("end",b.data,c),this.isDragging=!1,this.removePointer(a)):(this.removePointer(a),this.emitEvent("removed",b.data,b.timestamp)))};a.prototype.handlePointerDrag=function(b){var a=b.data,c=a.currentEvent,d=b.timestamp;switch(a.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),this.emitEvent("update",
c,d)):(this.addPointer(c),this.emitEvent("added",c,d)):(this.updatePointer(c),this.pointerType=b.data.startEvent.pointerType,this.mouseButton=b.data.startEvent.button,this.startStateModifiers=b.modifiers,this.isDragging=!0,this.emitEvent("start",c,d))}};return a}(h.InputHandler);a.Drag=n;(function(b){b[b.Left=0]="Left";b[b.Middle=1]="Middle";b[b.Right=2]="Right";b[b.Back=3]="Back";b[b.Forward=4]="Forward";b[b.Undefined=-1]="Undefined"})(a.Button||(a.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require",
"exports","../../../core/screenUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.manhattanDistance=function(a,h){return Math.abs(h.x-a.x)+Math.abs(h.y-a.y)};a.euclideanDistance=function(a,h){var d=h.x-a.x;a=h.y-a.y;return Math.sqrt(d*d+a*a)};a.fitCircleLSQ=function(a,h){h?(h.radius=0,h.center.x=0,h.center.y=0):h={radius:0,center:m.createScreenPoint()};if(0===a.length)return h;if(1===a.length)return h.center.x=a[0].x,h.center.y=a[0].y,h;if(2===a.length){var d=a[0];a=a[1];var g=
[a.x-d.x,a.y-d.y],l=g[0],g=g[1];h.radius=Math.sqrt(l*l+g*g)/2;h.center.x=(d.x+a.x)/2;h.center.y=(d.y+a.y)/2;return h}for(var f=0,c=0,b=0;b<a.length;b++)f+=a[b].x,c+=a[b].y;for(var f=f/a.length,c=c/a.length,e=a.map(function(b){return b.x-f}),p=a.map(function(b){return b.y-c}),q=d=h=0,k=0,w=l=0,b=g=0;b<e.length;b++){var u=e[b],v=p[b],y=u*u,t=v*v;h+=y;d+=t;q+=u*v;k+=y*u;l+=t*v;w+=u*t;g+=v*y}b=h;e=q;p=d;k=.5*(k+w);l=.5*(l+g);g=b*p-q*e;w=(k*p-l*e)/g;l=(b*l-q*k)/g;g=m.createScreenPoint(w+f,l+c);return{radius:Math.sqrt(w*
w+l*l+(h+d)/a.length),center:g}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});a.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};n=function(g){function l(d,c,b,e,l){void 0===d&&(d=a.DefaultParameters.maximumClickDelay);void 0===
c&&(c=a.DefaultParameters.movementUntilMouseDrag);void 0===b&&(b=a.DefaultParameters.movementUntilTouchDrag);void 0===e&&(e=a.DefaultParameters.holdDelay);void 0===l&&(l=k.default);var f=g.call(this,!1)||this;f.maximumClickDelay=d;f.movementUntilMouseDrag=c;f.movementUntilTouchDrag=b;f.holdDelay=e;f._clock=l;f._pointerState=new Map;f._pointerDrag=f.registerOutgoing("pointer-drag");f._immediateClick=f.registerOutgoing("immediate-click");f._pointerHold=f.registerOutgoing("hold");f.registerIncoming("pointer-down",
f._handlePointerDown.bind(f));f.registerIncoming("pointer-up",function(b){f._handlePointerLoss(b,"pointer-up")});f.registerIncoming("pointer-capture-lost",function(b){f._handlePointerLoss(b,"pointer-capture-lost")});f.registerIncoming("pointer-cancel",function(b){f._handlePointerLoss(b,"pointer-cancel")});f._moveHandle=f.registerIncoming("pointer-move",f._handlePointerMove.bind(f));f._moveHandle.pause();return f}m(l,g);l.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=
a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null)});g.prototype.onUninstall.call(this)};l.prototype._handlePointerDown=function(a){var c=this,b=a.data,d=b.native.pointerId,f=null;0===this._pointerState.size&&(f=this._clock.setTimeout(function(){var b=c._pointerState.get(d);b&&(b.isDragging||(c._pointerHold.emit(b.previousEvent,void 0,a.modifiers),b.holdEmitted=!0),b.holdTimeout=null)},this.holdDelay));f={startEvent:b,previousEvent:b,startTimestamp:a.timestamp,isDragging:!1,downButton:b.native.button,
holdTimeout:f,modifiers:new Set};this._pointerState.set(d,f);this.startCapturingPointer(b.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};l.prototype._createPointerDragData=function(a,c,b){return{action:a,startEvent:c.startEvent,previousEvent:c.previousEvent,currentEvent:b}};l.prototype._handlePointerMove=function(a){var c=a.data,b=this._pointerState.get(c.native.pointerId);b&&(b.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",b,c),void 0,
b.modifiers):d.euclideanDistance(c,b.startEvent)>("touch"===c.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(a),b.previousEvent=c)};l.prototype.startDragging=function(a){var c=this,b=a.data,d=b.native.pointerId;this._pointerState.forEach(function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||(e.modifiers=a.modifiers,e.isDragging=!0,d===e.startEvent.native.pointerId?c._pointerDrag.emit(c._createPointerDragData("start",
e,b)):c._pointerDrag.emit(c._createPointerDragData("start",e,e.previousEvent),a.timestamp))})};l.prototype._handlePointerLoss=function(a,c){var b=a.data,d=b.native.pointerId,f=this._pointerState.get(d);f&&(null!=f.holdTimeout&&(f.holdTimeout.remove(),f.holdTimeout=null),f.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",f,"pointer-up"===c?b:f.previousEvent),void 0,f.modifiers):"pointer-up"===c&&f.downButton===b.native.button&&a.timestamp-f.startTimestamp<=this.maximumClickDelay&&
!f.holdEmitted&&this._immediateClick.emit(b),this._pointerState.delete(d),this.stopCapturingPointer(b.native),0===this._pointerState.size&&this._moveHandle.pause())};return l}(h.InputHandler);a.PointerClickHoldAndDrag=n})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/iteratorUtils ../InputHandler ./support".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});
a.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};n=function(d){function f(c,b,e,f,g){void 0===c&&(c=a.DefaultParameters.maximumDoubleClickDelay);void 0===b&&(b=a.DefaultParameters.maximumDoubleClickDistance);void 0===e&&(e=a.DefaultParameters.maximumDoubleTouchDelay);void 0===f&&(f=a.DefaultParameters.maximumDoubleTouchDistance);void 0===g&&(g=k.default);var l=d.call(this,!1)||this;l.maximumDoubleClickDelay=c;
l.maximumDoubleClickDistance=b;l.maximumDoubleTouchDelay=e;l.maximumDoubleTouchDistance=f;l._clock=g;l._pointerState=new Map;l._click=l.registerOutgoing("click");l._doubleClick=l.registerOutgoing("double-click");l.registerIncoming("immediate-click",l._handleImmediateClick.bind(l));l.registerIncoming("pointer-drag",l._handlePointerDrag.bind(l));l.registerIncoming("drag",l._handleDrag.bind(l));return l}m(f,d);f.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.doubleClickTimeout&&
(a.doubleClickTimeout.remove(),a.doubleClickTimeout=null)})};Object.defineProperty(f.prototype,"hasPendingInputs",{get:function(){return!h.everyMap(this._pointerState,function(a){return null==a.doubleClickTimeout})},enumerable:!0,configurable:!0});f.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};f.prototype._handleImmediateClick=function(a){var b=a.data,c=this._pointerId(b),d=this._pointerState.get(c);if(d){var f="touch"===b.native.pointerType?
this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;g.manhattanDistance(d.event.data,b)>f?(this._clearDoubleClickTimeout(c,!0),this._startClick(a)):(this._clearDoubleClickTimeout(c,!1),this._doubleClick.emit(b,void 0,d.event.modifiers))}else this._startClick(a)};f.prototype._startClick=function(a){var b=this,c=this._pointerId(a.data);this._pointerState.set(c,{event:a,doubleClickTimeout:this._clock.setTimeout(function(){return b._doubleClickTimeoutExceeded(c)},"touch"===a.data.native.pointerType?
this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};f.prototype._handlePointerDrag=function(a){a=this._pointerId(a.data.currentEvent);this._clearDoubleClickTimeout(a,!0)};f.prototype._handleDrag=function(a){a=this._pointerId(a.data.pointer);this._clearDoubleClickTimeout(a,!0)};f.prototype._clearDoubleClickTimeout=function(a,b){var c=this._pointerState.get(a);c&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null,b&&this._doubleClickTimeoutExceeded(a),
this._pointerState.delete(a),this.refreshHasPendingInputs())};f.prototype._doubleClickTimeoutExceeded=function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,void 0,b.event.modifiers);b.doubleClickTimeout=null;this._pointerState.delete(a);this.refreshHasPendingInputs()};return f}(d.InputHandler);a.SingleAndDoubleClick=n})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],
function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,f){void 0===d&&(d=20);void 0===f&&(f=40);var c=a.call(this,!1)||this;c._threshold=d;c._maxDelta=f;c.state="ready";c.emittedArtificalEnd2=!1;c._vertical=c.registerOutgoing("vertical-two-finger-drag");c._artificalDrag=c.registerOutgoing("drag");c.dragEventSeparator=new k.DragEventSeparator({start:function(b,a){return c.observeStart(b,a)},update:function(b,a,d){return c.observeUpdate(b,a,d)},end:function(b,
a){return c.observeEnd(b,a)}});c.registerIncoming("drag",function(b){return c.dragEventSeparator.handle(b)});return c}m(d,a);Object.defineProperty(d.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});d.prototype.observeStart=function(a,d){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:d.data.button,buttons:d.data.buttons,pointerType:d.data.pointerType,timestamp:d.data.timestamp,pointers:d.data.pointers,
pointer:d.data.pointer,angle:d.data.angle,radius:d.data.radius,center:d.data.center,artifical:!0}),d.stopPropagation());this.state=2===a?"ready":"failed"};d.prototype.observeUpdate=function(a,d,c){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:d.data.center.y-this._thresholdReachedCenter.y,action:"update"}),d.stopPropagation()):this.checkMovementWithinLimits(d.data,c.data)?this.checkVerticalThresholdReached(d.data,c.data)&&(this.state="active",this.emittedArtificalEnd2=
!0,this._thresholdReachedCenter=d.data.center,this._artificalDrag.emit({action:"end",button:d.data.button,buttons:d.data.buttons,pointerType:d.data.pointerType,timestamp:d.data.timestamp,pointers:d.data.pointers,pointer:d.data.pointer,angle:d.data.angle,radius:d.data.radius,center:d.data.center,artifical:!0}),this._vertical.emit({delta:d.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),d.stopPropagation()):this.state="failed")};d.prototype.observeEnd=function(a,d){"active"===this.state&&
(this._vertical.emit({delta:d.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",d.stopPropagation())};d.prototype.checkMovementWithinLimits=function(a,d){var c=-Infinity,b=Infinity,e=-Infinity,f=Infinity;d.pointers.forEach(function(a){c=Math.max(c,a.x);b=Math.min(b,a.x);e=Math.max(e,a.y);f=Math.min(f,a.y)});var g=-Infinity,l=Infinity,h=-Infinity,k=Infinity;a.pointers.forEach(function(b){g=Math.max(g,b.x);l=Math.min(l,b.x);h=Math.max(h,b.y);k=Math.min(k,b.y)});return Math.abs(a.center.x-
d.center.x)<this._threshold&&Math.abs(g-l-(c-b))<=this._maxDelta&&Math.abs(h-k-(e-f))<=this._maxDelta};d.prototype.checkVerticalThresholdReached=function(a,d){var c=Math.abs(a.center.y-d.center.y);a.pointers.forEach(function(b,a){a=d.pointers.get(a);c=Math.min(c,Math.abs(b.y-a.y))});return c>=this._threshold};return d}(h.InputHandler);a.VerticalTwoFingerDrag=n})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});
n=function(){function a(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}a.prototype.handle=function(a){var h=a.data,d=h.pointers.size;switch(h.action){case "start":this.currentCount=d;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(a);
break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};a.prototype.emitStart=function(a){this.startEvent=a;this.callbacks.condition(this.currentCount,a)&&this.callbacks.start(this.currentCount,a,this.startEvent)};a.prototype.emitUpdate=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};a.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);
this.startEvent=null};return a}();a.DragEventSeparator=n})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil ../../../support/index".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F){function K(b){var a,c,d,e,f,g;return k(this,function(l){switch(l.label){case 0:if(!Map.prototype.entries)return[3,5];a=b.entries();c=a.next();l.label=1;case 1:return c.done?[3,4]:[4,c.value[1]];case 2:l.sent(),l.label=3;case 3:return c=a.next(),[3,1];case 4:return[3,9];case 5:d=Array(b.size),e=0,b.forEach(function(b){return d[e++]=b}),f=0,g=d,l.label=6;case 6:if(!(f<g.length))return[3,9];c=g[f];return[4,c];case 7:l.sent(),l.label=8;case 8:return f++,
[3,6];case 9:return[2]}})}Object.defineProperty(a,"__esModule",{value:!0});var H=w.vec4f64.create(),N=w.vec4f64.create(),I=w.vec4f64.create(),J=w.vec4f64.create(),M=x.sphere.create(),L=x.ray.create(),R=r.vec3f64.create(),O=u.create(),T=u.create(),U=function(){return function(){this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.pooled=this.visible=this.culled=!1}}(),P=function(){return function(b,a,c){void 0===c&&(c={});this.graphics3DGraphic=b;this.slicePlaneEnabled=a;this.info=c}}(),V=function(){return function(b,
a){void 0===a&&(a=new Map);this.graphics3DCore=b;this.graphics=a}}();n=function(a){function d(){var b,d,e=null!==a&&a.apply(this,arguments)||this;e.handles=new g;e.dirty=!1;e.state=0;e.contexts=[];e.graphics=(b={},b[0]={active:new Map,visible:new c,remove:new c},b[1]={active:new Map,visible:new c,remove:new c},b);e.iterators=(d={},d[0]={active:null,visible:null,remove:null,sort:null},d[1]={active:null,visible:null,remove:null,sort:null},d);e.accBinsNumX=15;e.accBinsNumY=20;e.accBinsSizeX=0;e.accBinsSizeY=
0;e.accBins=null;e.accNumTests=0;e._iconMarginFactor=-.1;e.slicePlaneViewSpace=null;return e}m(d,a);Object.defineProperty(d.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},set:function(b){this._iconMarginFactor=b;this.setDirty()},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(){a.updateSlicePlane();a.setDirtyUrgent()}),this.view.watch("map.ground.opacity",function(b,c){1!==b&&1!==c||
a.setDirtyUrgent()}),b.init(this.view,"slicePlane",function(){return a.updateSlicePlane()})]);this.frameWorker=this.view.resourceController.scheduler.registerTask(F.Task.DECONFLICTOR_DELAYED,function(b){return a.run(b)},function(){return a.needsUpdate()})};d.prototype.updateSlicePlane=function(){var b=this.view&&this.view.slicePlane;b?(this.slicePlaneViewSpace||(this.slicePlaneViewSpace=x.boundedPlane.create()),x.boundedPlane.transform(b,this.view.state.camera.viewMatrix,this.slicePlaneViewSpace),
this.slicePlaneChanged()):this.slicePlaneViewSpace&&(this.slicePlaneViewSpace=null,this.slicePlaneChanged())};d.prototype.slicePlaneChanged=function(){for(var b=0,a=this.contexts;b<a.length;b++)if(a[b].graphics3DCore.symbolCreationContext.slicePlaneEnabled){this.setDirty();break}};d.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.iterators=this.graphics=null};d.prototype.addGraphicsOwner=function(b){var a=
this,c=this.findDeconflictionContext(b),d;-1!==c?d=this.contexts[c]:(d=new V(b),this.contexts.push(d),this.setDirtyUrgent());return{addGraphic:function(b){return a.addGraphic(d,b)},removeGraphic:function(b){return a.removeGraphic(d,b)},labelingInfoChange:function(){return a.globalLabelingInfoChanged(d)},visibilityInfoChange:function(){},featureReductionChange:function(){return a.globalFeatureReductionChanged(d)},slicePlaneEnabledChange:function(){return a.globalSlicePlaneEnabledChanged(d)},clear:function(){return d.graphics.forEach(function(b){return a.removeGraphic(d,
b.graphics3DGraphic)})}}};d.prototype.removeGraphicsOwner=function(b){var a=this;b=this.findDeconflictionContext(b);if(-1!==b){var c=this.contexts.splice(b,1)[0];c.graphics.forEach(function(b){return a.removeGraphic(c,b.graphics3DGraphic)});this.setDirtyUrgent()}};d.prototype.setInitialIconVisibilityFlag=function(b,a){b=!(this.graphicSupportsDeconfliction(a)&&this.isFeatureReductionEnabled(b));a.setVisibilityFlag(3,b,0)};d.prototype.setDirtyUrgent=function(){!this.dirty&&0<this.contexts.length&&(this.dirty=
!0,this.notifyChange("updating"));this.frameWorker.task=F.Task.DECONFLICTOR_IMMEDIATE};d.prototype.setDirty=function(){!this.dirty&&0<this.contexts.length&&(this.dirty=!0,this.notifyChange("updating"),this.frameWorker.task=F.Task.DECONFLICTOR_DELAYED)};Object.defineProperty(d.prototype,"updating",{get:function(){return 0!==this.state||this.dirty},enumerable:!0,configurable:!0});d.prototype.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};d.prototype.run=function(b){switch(this.state){case 0:v.prepare(this.view),
this.dirty=!1,this.camera=this.view.state.camera,this.initBins(this.camera.fullWidth,this.camera.fullHeight),this.resetIterators(),b.madeProgress();case 1:if(this.state=1,!this.processActiveGraphics(0,b))break;case 3:if(this.state=3,!this.cleanVisibleGraphics(0,b))break;case 5:if(this.state=5,!this.sortVisibleGraphics(0,b))break;case 7:this.state=7;if(!this.deconflictVisibleGraphics(0,b))break;v.drawAccelerationStruct(this,this.graphics[0].visible);case 2:if(this.state=2,!this.processActiveGraphics(1,
b))break;case 4:if(this.state=4,!this.cleanVisibleGraphics(1,b))break;case 6:if(this.state=6,!this.sortVisibleGraphics(1,b))break;case 8:this.state=8;if(!this.deconflictVisibleGraphics(1,b))break;v.drawAccelerationStruct(this,this.graphics[1].visible);default:this.state=0,this.notifyChange("updating")}};d.prototype.findDeconflictionContext=function(b){for(var a=0;a<this.contexts.length;a++)if(this.contexts[a].graphics3DCore===b)return a;return-1};d.prototype.globalFeatureReductionChanged=function(b){var a=
this.isFeatureReductionEnabled(b.graphics3DCore);a||this.clearVisibilityFlags(b);this.modifyGraphics(b,a,0)};d.prototype.globalLabelingInfoChanged=function(b){this.modifyGraphics(b,b.graphics3DCore.labelsEnabled,1)};d.prototype.globalSlicePlaneEnabledChanged=function(b){var a=b.graphics3DCore.symbolCreationContext.slicePlaneEnabled;b.graphics.forEach(function(b){b.slicePlaneEnabled=a});this.setDirtyUrgent()};d.prototype.modifyGraphics=function(b,a,c){var d=this;a?b.graphics.forEach(function(b){return d.addToActiveGraphics(b,
c)}):b.graphics.forEach(function(b){return d.removeFromActiveGraphics(b,c)});this.setDirtyUrgent()};d.prototype.graphicSupportsDeconfliction=function(b){var a=b._graphics;if(!a||!a.length||b.isDraped())return!1;for(b=0;b<a.length;b++)if(this.graphics3DGraphicsLayerSupportsDeconfliction(a[b]))return!0;return!1};d.prototype.graphics3DGraphicsLayerSupportsDeconfliction=function(b){if(f.isNone(b)||"object3d"!==b.type)return!1;b=b.stageObject;return 1===(b?b.getNumGeometryRecords():0)&&b.getGeometryRecord(0).material instanceof
B?!0:!1};d.prototype.addGraphic=function(b,a){var c=a.graphic.uid;a=new P(a,b.graphics3DCore.symbolCreationContext.slicePlaneEnabled);b.graphics.set(c,a);this.isFeatureReductionEnabled(b.graphics3DCore)&&this.addToActiveGraphics(a,0);b.graphics3DCore.labelsEnabled&&this.addToActiveGraphics(a,1);this.setDirty()};d.prototype.removeGraphic=function(b,a){a=a.graphic.uid;var c=b.graphics.get(a);c&&(this.removeFromActiveGraphics(c,0),this.removeFromActiveGraphics(c,1),b.graphics.delete(a),this.setDirty())};
d.prototype.addToActiveGraphics=function(b,a){b.info[a]=new U;this.graphics[a].active.set(b.graphics3DGraphic.graphic.uid,b)};d.prototype.removeFromActiveGraphics=function(b,a){this.removeFromVisibleGraphics(b,a);this.clearGraphicVisibility(b,a);delete b.info[a];this.graphics[a].active.delete(b.graphics3DGraphic.graphic.uid)};d.prototype.addToVisibleGraphics=function(b,a){var c=b.info[a];c&&!c.pooled&&(this.graphics[a].visible.push(b),c.pooled=!0)};d.prototype.removeFromVisibleGraphics=function(b,
a){var c=b.info[a];c&&c.pooled&&(this.graphics[a].remove.push(b),c.pooled=!1)};d.prototype.processActiveGraphics=function(b,a){for(var c=this.getOrCreateActiveGraphicsIterator(b),d="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this.camera&&0<this.camera.relativeElevation;!a.done;){a.madeProgress();var e=c.next();if(e.done)return this.resetActiveGraphicsIterator(b),!0;var f=(e=e.value)&&e.info[b];f&&(this.collectGraphics3DGraphics(e,b,d),f.culled?this.removeFromVisibleGraphics(e,
b):this.addToVisibleGraphics(e,b))}return!1};d.prototype.cleanVisibleGraphics=function(b,a){for(var c=this.graphics[b],d=this.ensureRemoveGraphicsIterator(b);!a.done;){var e=d.next();a.madeProgress();if(e.done)return c.remove.clear(),this.resetRemoveGraphicsIterator(b),!0}return!1};d.prototype.sortVisibleGraphics=function(b,a){for(var c=this.ensureSortGraphicsIterator(b,function(a,c){return a.info[b]&&c.info[b]?c.info[b].posView-a.info[b].posView:Number.MAX_VALUE});!a.done;){var d=c.next();a.madeProgress();
if(d.done)return this.resetSortGraphicsIterator(b),!0}return!1};d.prototype.deconflictVisibleGraphics=function(b,a){for(var c=this.getOrCreateVisibleGraphicsIterator(b),d=1===b;!a.done;){a.madeProgress();var e=c.next();if(e.done)return this.resetVisibleGraphicsIterator(b),!0;var e=e.value,f=e.info[b];if(f&&!f.culled){var g=e.graphics3DGraphic,g=!(d&&!g.isVisible())&&!this.doesIntersectExistingPoly(e,b);(f.visible=g)&&this.addToBins(e,b);this.setGraphicVisibility(e,b,g);g&&v.drawPoly(f,g?"green":"red")}}return!1};
d.prototype.resetIterators=function(){this.iterators[0].active=null;this.iterators[0].visible=null;this.iterators[0].remove=null;this.iterators[0].sort=null;this.iterators[1].active=null;this.iterators[1].visible=null;this.iterators[1].remove=null;this.iterators[1].sort=null};d.prototype.getOrCreateActiveGraphicsIterator=function(b){var a=this.graphics[b];b=this.iterators[b];b.active||(b.active=K(a.active));return b.active};d.prototype.resetActiveGraphicsIterator=function(b){this.iterators[b].active=
null};d.prototype.getOrCreateVisibleGraphicsIterator=function(b){var a=this.graphics[b];b=this.iterators[b];b.visible||(b.visible=a.visible.iterableForEach());return b.visible};d.prototype.resetVisibleGraphicsIterator=function(b){this.iterators[b].visible=null};d.prototype.ensureRemoveGraphicsIterator=function(b){var a=this.graphics[b];b=this.iterators[b];b.remove||(b.remove=a.visible.iterableRemoveMany(a.remove.data));return b.remove};d.prototype.resetRemoveGraphicsIterator=function(b){this.iterators[b].remove=
null};d.prototype.ensureSortGraphicsIterator=function(b,a){var c=this.graphics[b];b=this.iterators[b];b.sort||(b.sort=c.visible.iterableSort(a));return b.sort};d.prototype.resetSortGraphicsIterator=function(b){this.iterators[b].sort=null};d.prototype.collectGraphics3DGraphics=function(b,a,c){var d=b.graphics3DGraphic;if(!d.destroyed){var e=b.info[a];if(d.isVisible(0,3)){d=(a=1===a)?d._labelGraphics:d._graphics;a=a?0:this.iconMarginFactor;for(var f=u.empty(O),g,p,h=0;h<d.length;h++){var k=d[h];if(this.graphics3DGraphicsLayerSupportsDeconfliction(k)){var m=
k.stageObject,w=m.getGeometryRecord(0),v=w.material,n=this.camera,B=w.geometry.data.getVertexAttr();if(c&&(M.radius=t.earthRadius,q.vec3.sub(L.direction,m.getCenter(),this.camera.eye),q.vec3.copy(L.origin,this.camera.eye),z.intersectRay(M,L,R))){var K=1-Math.abs(Math.tan(q.vec3.angle(m.getCenter(),L.direction)))/this.view.width,K=Math.pow(K,4),F=q.vec3.sqrDist(this.camera.eye,R),Z=q.vec3.sqrDist(this.camera.eye,m.getCenter());if(K*Z>F){e.culled=!0;return}}if(!p){p=m.getCenter();w=w.origin.vec3;G.transformToWorld(p,
w,H);G.transformToView(H,w,n.viewMatrix,N);v.applyVerticalOffsetTransformation(N,B[E.VertexAttrConstants.NORMAL].data,m.objectTransformation,n,W);if(b.slicePlaneEnabled&&this.slicePlaneViewSpace&&x.boundedPlane.extrusionContainsPoint(this.slicePlaneViewSpace,N)){e.culled=!0;return}m=B[E.VertexAttrConstants.AUXPOS1].data;B="screen"!==v.getParameters().centerOffsetUnits;G.transformToProjection(N,n.projectionMatrix,B?m:r.vec3f64.ZEROS,I);p=G.transformToNDC(I,J);B||(p[0]+=m[0]/n.fullWidth*2,p[1]+=m[1]/
n.fullHeight*2);if(-1>p[0]||-1>p[1]||-1>p[2]||1<=p[0]||1<=p[1])break;g=N[2];!y.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&e.visible&&(g*=.7)}k=k.getScreenSize(Q);k[0]*=n.pixelRatio;k[1]*=n.pixelRatio;A.applyPrecomputedScaleFactorVec2(k,W.factor,k);v=u.offset(v.calculateRelativeScreenBounds(k,W.factorAlignment.scale,T),l.lerp(0,n.fullWidth,.5+.5*p[0]),l.lerp(0,n.fullHeight,.5+.5*p[1]));0!==a&&(n=a*Math.min(u.width(v),u.height(v)),v[0]-=n,v[1]-=n,v[2]+=n,v[3]+=n);u.expand(f,v)}}null==g?e.culled=!0:(e.xMin=
f[0],e.yMin=f[1],e.xMax=f[2],e.yMax=f[3],e.posView=g,e.culled=!1)}else e.culled=!0}};d.prototype.doesIntersectExistingPoly=function(b,a){var c=b.graphics3DGraphic.graphic.uid;b=b.info[a];for(var d=Math.floor(b.xMin/this.accBinsSizeX);d<=Math.floor(b.xMax/this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var e=Math.floor(b.yMin/this.accBinsSizeY);e<=Math.floor(b.yMax/this.accBinsSizeY);e++)if(!(0>e||e>=this.accBinsNumY))for(var f=this.accBins[d][e],g=0;g<f.length;g++){var l=f.data[g],p=l.info[a];
if(p&&p.visible&&l.graphics3DGraphic.graphic.uid!==c&&(this.accNumTests++,!(p.xMin>b.xMax||p.xMax<b.xMin||p.yMin>b.yMax||p.yMax<b.yMin)))return!0}return!1};d.prototype.initBins=function(b,a){if(null==this.accBins){this.accBins=[];for(var d=0;d<this.accBinsNumX;d++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],f=0;f<this.accBinsNumY;f++)e.push(new c)}}for(d=0;d<this.accBinsNumX;d++)for(f=0;f<this.accBinsNumY;f++)this.accBins[d][f].clear();this.accBinsSizeX=b/this.accBinsNumX;
this.accBinsSizeY=a/this.accBinsNumY;this.accNumTests=0};d.prototype.addToBins=function(b,a){a=b.info[a];for(var c=Math.floor(a.xMin/this.accBinsSizeX);c<=Math.floor(a.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=Math.floor(a.yMin/this.accBinsSizeY);d<=Math.floor(a.yMax/this.accBinsSizeY);d++)0>d||d>=this.accBinsNumY||this.accBins[c][d].push(b)};d.prototype.isFeatureReductionEnabled=function(b){b=b.layer;return!(!b||!b.featureReduction||"selection"!==b.featureReduction.type)};
d.prototype.clearVisibilityFlags=function(b){(b=b.graphics3DCore.graphics3DGraphics)&&b.forEach(function(b){return b.clearVisibilityFlag(3)})};d.prototype.setGraphicVisibility=function(b,a,c){b=b.graphics3DGraphic;b.destroyed||(b.setVisibilityFlag(3,c,a),1===a&&this.view.labeler.setLabelGraphicVisibility(b,c))};d.prototype.clearGraphicVisibility=function(b,a){b=b.graphics3DGraphic;b.destroyed||b.clearVisibilityFlag(3,a)};h([e.property({constructOnly:!0})],d.prototype,"view",void 0);h([e.property({type:Boolean,
readOnly:!0})],d.prototype,"updating",null);return d=h([e.subclass("esri.views.3d.layers.graphics.Deconflictor")],d)}(e.declared(d));a.Deconflictor=n;var W={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},Q=p.vec2f64.create()})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(n,a,m,k){function h(a,b,d,g,
h){var c=l.height,e=f;e.beginPath();e.lineWidth=1;e.strokeStyle=h;e.moveTo(a,c-d);e.lineTo(b,c-d);e.stroke();e.lineTo(b,c-g);e.stroke();e.lineTo(b,c-d);e.stroke();e.lineTo(a,c-d);e.stroke();e.lineTo(a,c-d);e.stroke();e.closePath()}Object.defineProperty(a,"__esModule",{value:!0});var d=!1,g=!1,l,f;a.drawAccelerationStruct=function(a,b){if(g&&f){for(var c=f,d=0,l=0;l<a.accBinsNumX;l++)for(var k=0;k<a.accBinsNumY;k++){var m=a.accBins[l][a.accBinsNumY-1-k],d=d+m.length,u=l*a.accBinsSizeX,v=(l+1)*a.accBinsSizeX,
y=k*a.accBinsSizeY,t=(k+1)*a.accBinsSizeY;c.fillText(m.length.toFixed(),u+5,y+15);h(u,v,y,t,"blue")}c.fillText("total totalShownLabels: "+d,70,40);c.fillText("total visible labels: "+b.length,70,50);c.fillText("total numTests: "+a.accNumTests,70,30)}};a.prepare=function(a){d=k.DECONFLICTOR_SHOW_OUTLINES;g=k.DECONFLICTOR_SHOW_GRID;if(d||g){null==l&&(l=document.createElement("canvas"),l.setAttribute("id","canvas2d"),a.surface.parentElement.style.position="relative",a.surface.parentElement.appendChild(l));
var b=a.height*a.pixelRatio;l.setAttribute("width",a.width*a.pixelRatio+"px");l.setAttribute("height",b+"px");l.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+a.width+"px;height:"+a.height+"px");f=l.getContext("2d");f.clearRect(0,0,a.width,a.height);f.font="12px Arial"}};a.drawPoly=function(a,b){d&&h(a.xMin,a.xMax,a.yMin,a.yMax,b)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(n,a,m,k,h,d){return new (function(a){function g(){var d=null!==a&&a.apply(this,arguments)||this;d.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;d.SCENEVIEW_LOCKING_LOG=!1;d.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;d.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;d.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;d.DECONFLICTOR_SHOW_OUTLINES=!1;d.DECONFLICTOR_SHOW_GRID=!1;d.LABELS_SHOW_BORDER=!1;d.OVERLAY_DRAW_TEST_TEXTURE=!1;d.OVERLAY_SHOW_CENTER=!1;d.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;d.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;d.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;d.DRAW_MESH_GEOMETRY_NORMALS=!1;d.FEATURE_TILE_FETCH_SHOW_TILES=!1;d.FEATURE_TILE_TREE_SHOW_TILES=!1;d.TERRAIN_TILE_TREE_SHOW_TILES=!1;d.I3S_TREE_SHOW_TILES=!1;d.ENABLE_PROFILE_DEPTH_RANGE=!1;d.DISABLE_FAST_UPDATES=!1;d.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;d.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;d.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return d}m(g,a);k([d.property()],g.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);k([d.property()],
g.prototype,"SCENEVIEW_LOCKING_LOG",void 0);k([d.property()],g.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);k([d.property()],g.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);k([d.property()],g.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);k([d.property()],g.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);k([d.property()],g.prototype,"DECONFLICTOR_SHOW_GRID",void 0);k([d.property()],g.prototype,"LABELS_SHOW_BORDER",void 0);k([d.property()],g.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);
k([d.property()],g.prototype,"OVERLAY_SHOW_CENTER",void 0);k([d.property()],g.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);k([d.property()],g.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);k([d.property()],g.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);k([d.property()],g.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);k([d.property()],g.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);k([d.property()],g.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);k([d.property()],
g.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);k([d.property()],g.prototype,"I3S_TREE_SHOW_TILES",void 0);k([d.property()],g.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);k([d.property()],g.prototype,"DISABLE_FAST_UPDATES",void 0);k([d.property()],g.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);k([d.property()],g.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);k([d.property()],g.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);return g=k([d.subclass("esri.views.3d.support.DebugFlags")],
g)}(d.declared(h)))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../../../core/mathUtils","../../support/earthUtils"],function(n,a,m,k){function h(b){return Math.abs(b*b*b)}function d(b,a,c,d){void 0===d&&(d=e);var f=c.parameters;c=c.paddingPixelsOverride;d.scale=Math.min(f.divisor/(a-f.offset),1);d.factor=h(b);d.minPixelSize=f.minPixelSize;d.paddingPixels=c;return d}function g(b,a){return 0===b?a.minPixelSize:a.minPixelSize*(1+2*a.paddingPixels/
b)}function l(b,a){return Math.max(m.lerp(b*a.scale,b,a.factor),g(b,a))}function f(b,a,c){b=d(b,a,c);b.minPixelSize=0;b.paddingPixels=0;return l(1,b)}Object.defineProperty(a,"__esModule",{value:!0});a.getSettings=function(b){return new c(b,a.defaultDescription)};a.getLabelSettings=function(d){var e=a.defaultDescription.curvatureDependent;return new c(d,{curvatureDependent:{min:{curvature:e.min.curvature,tiltAngle:e.min.tiltAngle,scaleFallOffFactor:b.curvatureDependent.min.scaleFallOffFactor},max:{curvature:e.max.curvature,
tiltAngle:e.max.tiltAngle,scaleFallOffFactor:b.curvatureDependent.max.scaleFallOffFactor}},scaleStart:a.defaultDescription.scaleStart,scaleFallOffRange:a.defaultDescription.scaleFallOffRange,minPixelSize:b.minPixelSize})};a.perspectiveFactor=h;a.scaleFactor=d;a.applyScaleFactor=l;a.applyScaleFactorVec2=function(b,a,c){void 0===c&&(c=[0,0]);var d=Math.min(Math.max(a.scale,g(b[1],a)/b[1]),1);c[0]=m.lerp(b[0]*d,b[0],a.factor);c[1]=m.lerp(b[1]*d,b[1],a.factor);return c};a.precomputeScale=f;a.precomputeScaleFactor=
function(b,a,c,d){d.scale=f(b,a,c);d.factor=0;d.minPixelSize=c.parameters.minPixelSize;d.paddingPixels=c.paddingPixelsOverride;return d};a.applyPrecomputedScaleFactorVec2=function(b,a,c){void 0===c&&(c=[0,0]);a=Math.min(Math.max(a.scale,g(b[1],a)/b[1]),1);c[0]=b[0]*a;c[1]=b[1]*a;return c};a.scale=function(b,a,c,e){return l(b,d(a,c,e))};var c=function(){function b(b,a,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=b;this.description=
a;this.parameters=c;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(b.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels},enumerable:!0,configurable:!0});b.prototype.update=function(b){if(this.parameters&&this.parameters.camera.fovY===b.fovY&&this.parameters.camera.distance===b.distance)return!1;this.calculateParameters(b,this.parameters);return!0};b.prototype.overridePadding=function(a){return a!==this.paddingPixelsOverride?new b(this.viewingMode,this.description,this.parameters,a):this};b.prototype.calculateParameters=function(b,a){var c=this.description,d=c.scaleStart,e=c.scaleFallOffRange,
c=c.minPixelSize,f=b.fovY,g=b.distance,l=this.calculateCurvatureDependentParameters(b),p=this.coverageCompensation(b,l),h=l.tiltAngle,l=l.scaleFallOffFactor,g=Math.sin(h)*g,h=.5*Math.PI-h-f*(.5-d*p),d=g/Math.cos(h),e=(d-g/Math.cos(h+f*e*p)*l)/(1-l);a.camera.fovY=b.fovY;a.camera.distance=b.distance;a.offset=e;a.divisor=d-e;a.minPixelSize=c;return a};b.prototype.calculateCurvatureDependentParametersLocal=function(b,a){void 0===a&&(a=p);a.tiltAngle=this.description.curvatureDependent.min.tiltAngle;a.scaleFallOffFactor=
this.description.curvatureDependent.min.scaleFallOffFactor;return a};b.prototype.calculateCurvatureDependentParametersGlobal=function(b,a){void 0===a&&(a=p);var c=this.description.curvatureDependent;b=1+b.distance/k.earthRadius;var d=[c.min.curvature,c.max.curvature],e=d[0];b=m.clamp((Math.sqrt(b*b-1)-e)/(d[1]-e),0,1);d=[c.min,c.max];c=d[0];d=d[1];a.tiltAngle=m.lerp(c.tiltAngle,d.tiltAngle,b);a.scaleFallOffFactor=m.lerp(c.scaleFallOffFactor,d.scaleFallOffFactor,b);return a};b.prototype.surfaceCoverageCompensationLocal=
function(b,a){return(b.fovY-a.tiltAngle)/b.fovY};b.prototype.surfaceCoverageCompensationGlobal=function(b,a){var c=k.earthRadius*k.earthRadius;a=a.tiltAngle+.5*Math.PI;var d=b.fovY;b=b.distance;b=b*b+c-2*Math.cos(a)*b*k.earthRadius;var e=Math.sqrt(b);return(Math.acos(Math.sqrt(b-c)/e)-Math.asin(k.earthRadius/(e/Math.sin(a)))+.5*d)/d};return b}();a.defaultDescription={curvatureDependent:{min:{curvature:m.deg2rad(10),tiltAngle:m.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:m.deg2rad(70),tiltAngle:m.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var b={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};a.copyParameters=function(b,a){a.camera.distance=b.camera.distance;a.camera.fovY=b.camera.fovY;a.divisor=b.divisor;a.offset=b.offset;a.minPixelSize=b.minPixelSize;return a};var e={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/HUDPrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B){function G(b,a,c){b.setUniform1f("cameraGroundRelative",c.cameraAboveGround?1:-1);b.setUniform1f("polygonOffset",a.shaderPolygonOffset);b.setUniform4fv("viewport",c.viewport);b.setUniform1f("perDistancePixelRatio",Math.tan(c.fovY/2)/(c.viewport[2]/2));z.bindVerticalOffset(a.verticalOffset,c,b);b.setUniformMatrix4fv("viewNormal",c.viewInvTransp);a.screenSizePerspective&&(z.bindScreenSizePerspective(a.screenSizePerspective,b,"screenSizePerspective"),
z.bindScreenSizePerspective(a.screenSizePerspectiveAlignment||a.screenSizePerspective,b,"screenSizePerspectiveAlignment"))}function F(b,a,c,d){c.occlusionTest&&(a.setUniform1i("hudVisibilityTexture",1),b.bindTexture(d.hudVisibilityTexture,1),b.setActiveTexture(0));a.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===d.renderTransparentlyOccludedHUD?1:"notOccluded"===d.renderTransparentlyOccludedHUD?0:.75);b=d.pixelRatio||1;a.setUniform4fv("overrideColor",c.color);a.setUniform1f("pixelRatio",
b);c.textureIsSignedDistanceField&&(a.setUniform4fv("outlineColor",c.outlineColor),a.setUniform1f("outlineSize",c.outlineSize));c.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors));a.setUniform2f("screenOffset",2*c.screenOffset[0]*
b,2*c.screenOffset[1]*b);a.setUniform2fv("anchorPos",K(c))}function K(b,a){void 0===a&&(a=J);if(b.textureIsSignedDistanceField){var c=b.anchorPos;b=b.distanceFieldBoundingBox;var d=a;d[0]=c[0]*(b[2]-b[0])+b[0];d[1]=c[1]*(b[3]-b[1])+b[1]}else f.vec2.copy(a,b.anchorPos);return a}n=function(a){function c(b,c){c=a.call(this,c)||this;c.params=z.copyParameters(b,ga);return c}m(c,a);c.prototype.dispose=function(){};c.prototype.setParameterValues=function(b){for(var a in b)"textureId"===a&&t.assert(!!this.params.textureId,
"Can only change texture of material that already has a texture"),this.params[a]=b[a];this.notifyDirty("matChanged")};c.prototype.getParameters=function(){return this.params};c.prototype.intersect=function(b,a,c,d,e,f,g,l,p){p?this.intersectDrapedRenderHudGeometry(b,a,c,d,e,f,g,l):this.intersectHudGeometry(b,a,c,d,e,f,g,l)};c.prototype.intersectDrapedRenderHudGeometry=function(a,c,d,e,f,g,l,p){c=a.getAttribute(t.VertexAttrConstants.POSITION);d=a.getAttribute(t.VertexAttrConstants.SIZE);e=this.params;
f=K(e);var h=1,q=1;p&&(q=p(Q),h=q[0],q=q[5]);h*=a.pixelRatio;q*=a.pixelRatio;p=X*a.pixelRatio;for(var k=0;k<c.data.length/c.size;k++){var m=k*c.size;b.vec3.set(M,c.data[m],c.data[m+1],c.data[m+2]);m=k*d.size;aa[0]=d.data[m]*h;aa[1]=d.data[m+1]*q;var m=M[0],u=M[1],r=void 0;e.textureIsSignedDistanceField&&(r=e.outlineSize*a.pixelRatio/2);this._isInsideIconBoundaries(g,m,u,p,r,e,f)&&l()}};c.prototype.intersectHudGeometry=function(a,c,d,f,l,p,q,k){if(f.enable.selectionMode&&f.enable.hud&&!w.isAllHidden(c.componentVisibilities,
a.componentOffsets)){var m=a.data;a=this.params;l=c=1;h.mat3.fromMat4(U,d);if(k){l=k(Q);c=l[0];l=l[5];k=U;p=k[0];var u=k[1],r=k[2],x=k[3],v=k[4],z=k[5],A=k[6],n=k[7],J=k[8],E=1/Math.sqrt(p*p+u*u+r*r),B=1/Math.sqrt(x*x+v*v+z*z),H=1/Math.sqrt(A*A+n*n+J*J);k[0]=p*E;k[1]=u*E;k[2]=r*E;k[3]=x*B;k[4]=v*B;k[5]=z*B;k[6]=A*H;k[7]=n*H;k[8]=J*H}k=m.getVertexAttr()[t.VertexAttrConstants.POSITION];p=m.getVertexAttr()[t.VertexAttrConstants.SIZE];u=m.getVertexAttr()[t.VertexAttrConstants.NORMAL];m=m.getVertexAttr()[t.VertexAttrConstants.AUXPOS1];
t.assert(3<=k.size);r=f.point;x=f.camera;v=K(a);c*=x.pixelRatio;l*=x.pixelRatio;z="screen"===this.params.centerOffsetUnits;for(A=0;A<k.data.length/k.size;A++)n=A*k.size,b.vec3.set(M,k.data[n],k.data[n+1],k.data[n+2]),b.vec3.transformMat4(M,M,d),n=A*p.size,aa[0]=p.data[n]*c,aa[1]=p.data[n+1]*l,b.vec3.transformMat4(M,M,x.viewMatrix),n=A*m.size,b.vec3.set(V,m.data[n+0],m.data[n+1],m.data[n+2]),z||(M[0]+=V[0],M[1]+=V[1],0!==V[2]&&(n=V[2],b.vec3.normalize(V,M),b.vec3.subtract(M,M,b.vec3.scale(V,V,n)))),
n=A*u.size,b.vec3.set(L,u.data[n],u.data[n+1],u.data[n+2]),this.applyVerticalOffsetTransformation(M,L,U,x,I),x.applyProjection(M,R),-1<R[0]&&(n=Math.floor(R[0])+this.params.screenOffset[0],J=Math.floor(R[1])+this.params.screenOffset[1],z&&(n+=V[0],0!==V[1]&&(J+=y.applyScaleFactor(V[1],I.factorAlignment))),y.applyPrecomputedScaleFactorVec2(aa,I.factor,aa),E=Z*x.pixelRatio,B=void 0,a.textureIsSignedDistanceField&&(B=a.outlineSize*x.pixelRatio/2),this._isInsideIconBoundaries(r,n,J,E,B,a,v)&&(J=f.ray,
b.vec3.transformMat4(T,M,g.mat4.invert(P,x.viewMatrix)),R[0]=r[0],R[1]=r[1],x.unprojectPoint(R,M),n=e.vec3f64.create(),b.vec3.copy(n,J.direction),E=1/b.vec3.length(n),b.vec3.scale(n,n,E),J=b.vec3.distance(J.origin,M)*E,q(J,n,-1,1,!0,T)))}};c.prototype._isInsideIconBoundaries=function(b,a,c,d,e,f,g){a=a-d-(0<g[0]?aa[0]*g[0]:0);var l=a+aa[0]+2*d;c=c-d-(0<g[1]?aa[1]*g[1]:0);d=c+aa[1]+2*d;f.textureIsSignedDistanceField&&(f=f.distanceFieldBoundingBox,a+=aa[0]*f[0],c+=aa[1]*f[1],l-=aa[0]*(1-f[2]),d-=aa[1]*
(1-f[3]),a-=e,l+=e,c-=e,d+=e);return b[0]>a&&b[0]<l&&b[1]>c&&b[1]<d};c.prototype.createBufferWriter=function(){return new ia(this)};c.prototype.createRenderer=function(b,a){return new A(b,a,this)};c.prototype.normalAndViewAngle=function(a,c,d,e){void 0===e&&(e=W);b.vec3.transformMat3(e.normal,a,c);b.vec3.transformMat4(e.normal,e.normal,d.viewInverseTransposeMatrix);e.cosAngle=b.vec3.dot(O,da);return e};c.prototype.updateScaleInfo=function(b,a,c){a=this.params;a.screenSizePerspective?b.factor=y.precomputeScaleFactor(W.cosAngle,
c,a.screenSizePerspective,b.factor):(b.factor.scale=1,b.factor.factor=0,b.factor.minPixelSize=0,b.factor.paddingPixels=0);a.screenSizePerspectiveAlignment?b.factorAlignment=y.precomputeScaleFactor(W.cosAngle,c,a.screenSizePerspectiveAlignment,b.factorAlignment):(b.factorAlignment.factor=b.factor.factor,b.factorAlignment.scale=b.factor.scale,b.factorAlignment.minPixelSize=b.factor.minPixelSize,b.factorAlignment.paddingPixels=b.factor.paddingPixels)};c.prototype.applyVerticalOffsetTransformation=function(a,
c,d,e,f,g){var l=this.params;p.isMat4(d)&&(d=h.mat3.fromMat4(U,d));if(!l.verticalOffset||!l.verticalOffset.screenLength)return f&&(l.screenSizePerspective||l.screenSizePerspectiveAlignment)?(e=this.normalAndViewAngle(c,d,e),l=b.vec3.length(a),this.updateScaleInfo(f,e.cosAngle,l)):f&&(f.factor.scale=1,f.factorAlignment.scale=1),g?b.vec3.copy(g,a):a;c=this.normalAndViewAngle(c,d,e);d=b.vec3.length(a);e=z.verticalOffsetAtDistance(e,d,l.verticalOffset,c.cosAngle,l.screenSizePerspectiveAlignment||l.screenSizePerspective);
f&&this.updateScaleInfo(f,c.cosAngle,d);return b.vec3.add(g||a,a,b.vec3.scale(c.normal,c.normal,e))};c.prototype.getGLMaterials=function(){return{color:H,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:N}};c.prototype.calculateRelativeScreenBounds=function(b,a,c){void 0===c&&(c=q.create());var d=this.params,e=c;void 0===e&&(e=J);f.vec2.copy(e,d.anchorPos);e[0]*=-b[0];e[1]*=-b[1];e[0]+=d.screenOffset[0]*a;e[1]+=d.screenOffset[1]*a;c[2]=c[0]+b[0];c[3]=c[1]+b[1];return c};c.prototype.calculateAnchorPosForRendering=
function(b){return K(this.params,b)};c.shouldRenderVisibilityDuringRenderPass=function(b){return 0===b||4};return c}(v.Material);var H=function(b){function a(a){a=b.call(this,u.makeCtorParameters(a,a.material.getParameters()))||this;a.isOcclusionSlot=!1;a.updateParameters();return a}m(a,b);a.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?17:16};a.prototype.selectProgram=function(){var b=this.params;this.occlusionProgram=this.programRep.getProgram(E.occlusionPass,{verticalOffset:!!b.verticalOffset,
screenSizePerspective:!!b.screenSizePerspective,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled});this.renderProgram=this.programRep.getProgram(E.colorPass,{occlTest:b.occlusionTest,sdf:b.textureIsSignedDistanceField,vvSize:!!b.vvSizeEnabled,vvColor:!!b.vvColorEnabled,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,debugDrawBorder:!!b.debugDrawBorder,slice:b.slicePlaneEnabled});
this.renderPipelineState=B.makePipelineState({blending:B.simpleBlendingParams(1,771),polygonOffset:b.polygonOffset&&ba,depthTest:{func:515},depthWrite:B.defaultDepthWriteParams,colorWrite:B.defaultColorWriteParams});this.occlusionPipelineState=B.makePipelineState({depthTest:{func:515},depthWrite:B.defaultDepthWriteParams,colorWrite:B.defaultColorWriteParams})};a.prototype.beginSlot=function(b){if(this.params.occlusionTest)return this.isOcclusionSlot=11===b,11===b||b===this.mainSlot;this.isOcclusionSlot=
!1;return b===this.mainSlot};a.prototype.getProgram=function(){return this.isOcclusionSlot?this.occlusionProgram:this.renderProgram};a.prototype.getPrograms=function(){return[this.occlusionProgram,this.renderProgram]};a.prototype.updateParameters=function(){this.params=z.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};a.prototype.bind=function(b,a){if(this.isOcclusionSlot){var c=this.occlusionProgram;b.bindProgram(c);
b.setPipelineState(this.occlusionPipelineState);G(c,this.params,a);c.setUniform4f("color",1,1,1,1);c.setUniform1f("pixelRatio",a.pixelRatio||1)}else c=this.renderProgram,b.bindProgram(c),b.setPipelineState(this.renderPipelineState),this.bindTexture(b,c),this.bindTextureScale(b,c),G(c,this.params,a),F(b,c,this.params,a)};a.prototype.bindView=function(b,a){b=a.origin;var c=this.getProgram();z.bindView(b,a.view,c);z.bindCamPos(b,a.viewInvTransp,c);this.params.slicePlaneEnabled&&z.bindSlicePlane(a.origin,
a.slicePlane,c)};a.prototype.bindInstance=function(b,a){b=this.getProgram();b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.release=function(b){};a.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4};return a}(u),N=function(b){function a(a){a=b.call(this,u.makeCtorParameters(a,a.material.getParameters()))||this;a.updateParameters();return a}m(a,b);a.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?
17:16};a.prototype.beginSlot=function(b){return b===this.mainSlot};a.prototype.getProgram=function(){return this.program};a.prototype.updateParameters=function(){this.params=z.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(E.highlightPass,{occlTest:b.occlusionTest,sdf:b.textureIsSignedDistanceField,vvSize:!!b.vvSizeEnabled,
vvColor:!!b.vvColorEnabled,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,binaryHighlightOcclusion:b.binaryHighlightOcclusion,slice:b.slicePlaneEnabled});this.pipelineState=B.makePipelineState({blending:B.separateBlendingParams(1,1,771,771),polygonOffset:b.polygonOffset&&ba,depthTest:{func:513},colorWrite:B.defaultColorWriteParams})};a.prototype.bind=function(b,a){var c=this.program;b.bindProgram(c);b.setPipelineState(this.pipelineState);
this.bindTexture(b,c);this.bindTextureScale(b,c);G(c,this.params,a);F(b,c,this.params,a);z.bindHighlightRendering(b,a,this.program)};a.prototype.bindView=function(b,a){b=a.origin;var c=this.getProgram();z.bindView(b,a.view,c);z.bindCamPos(b,a.viewInvTransp,c);this.params.slicePlaneEnabled&&z.bindSlicePlane(a.origin,a.slicePlane,c)};a.prototype.bindInstance=function(b,a){b=this.getProgram();b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};
a.prototype.release=function(b){};a.prototype.getDrawMode=function(){return 4};return a}(u),I={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},J=c.vec2f64.create(),M=e.vec3f64.create(),L=e.vec3f64.create(),R=k.createRenderScreenPointArray3(),O=e.vec3f64.create(),T=e.vec3f64.create(),U=d.mat3f64.create(),P=l.mat4f64.create(),V=e.vec3f64.create(),W={normal:O,cosAngle:0},Q=l.mat4f64.create();g.mat4.identity(Q);var Z=1,X=2,aa=
[0,0],da=e.vec3f64.fromValues(0,0,1),ga={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,
screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:c.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},ca=r.newLayout().vec3f(t.VertexAttrConstants.POSITION).vec3f(t.VertexAttrConstants.NORMAL).vec2f(t.VertexAttrConstants.UV0).vec4u8(t.VertexAttrConstants.COLOR).vec2f(t.VertexAttrConstants.SIZE).vec4f(t.VertexAttrConstants.AUXPOS1).vec4f(t.VertexAttrConstants.AUXPOS2),ia=function(){function b(b){this.material=
b;this.vertexBufferLayout=ca}b.prototype.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};b.prototype.elementCount=function(b){return 6*b.indices[t.VertexAttrConstants.POSITION].length};b.prototype.write=function(b,a,c,d){x.writePosition(a.indices[t.VertexAttrConstants.POSITION],a.vertexAttr[t.VertexAttrConstants.POSITION].data,b.transformation,c.position,d,6);x.writeNormal(a.indices[t.VertexAttrConstants.NORMAL],a.vertexAttr[t.VertexAttrConstants.NORMAL].data,b.invTranspTransformation,
c.normal,d,6);b=a.vertexAttr[t.VertexAttrConstants.UV0].data;var e=void 0,f=void 0,g=void 0,l=void 0;null==b||4>b.length?(b=this.material.getParameters(),f=e=0,g=b.texCoordScale[0],l=b.texCoordScale[1]):(e=b[0],f=b[1],g=b[2],l=b[3]);var g=Math.min(1.99999,g+1),l=Math.min(1.99999,l+1),p=a.indices[t.VertexAttrConstants.POSITION].length,h=c.uv0;b=d;for(var q=0;q<p;++q)h.set(b,0,e),h.set(b,1,f),b+=1,h.set(b,0,g),h.set(b,1,f),b+=1,h.set(b,0,g),h.set(b,1,l),b+=1,h.set(b,0,g),h.set(b,1,l),b+=1,h.set(b,0,
e),h.set(b,1,l),b+=1,h.set(b,0,e),h.set(b,1,f),b+=1;x.writeColor(a.indices[t.VertexAttrConstants.COLOR],a.vertexAttr[t.VertexAttrConstants.COLOR].data,4,c.color,d,6);e=a.indices[t.VertexAttrConstants.SIZE];f=a.vertexAttr[t.VertexAttrConstants.SIZE].data;g=e.length;l=c.size;b=d;for(q=0;q<g;++q)for(var p=f[2*e[q]],h=f[2*e[q]+1],k=0;6>k;++k)l.set(b,0,p),l.set(b,1,h),b+=1;a.indices[t.VertexAttrConstants.AUXPOS1]&&a.vertexAttr[t.VertexAttrConstants.AUXPOS1]&&x.writeBufferVec4(a.indices[t.VertexAttrConstants.AUXPOS1],
a.vertexAttr[t.VertexAttrConstants.AUXPOS1].data,c.auxpos1,d,6);a.indices[t.VertexAttrConstants.AUXPOS2]&&a.vertexAttr[t.VertexAttrConstants.AUXPOS2]&&x.writeBufferVec4(a.indices[t.VertexAttrConstants.AUXPOS2],a.vertexAttr[t.VertexAttrConstants.AUXPOS2].data,c.auxpos2,d,6)};return b}(),ba={factor:0,units:-4};return n})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(n,a){function m(a){return a instanceof Float32Array&&16<=a.length}function k(a){return Array.isArray(a)&&
16<=a.length}Object.defineProperty(a,"__esModule",{value:!0});a.isMat4f32=m;a.isMat4f64=k;a.isMat4=function(a){return m(a)||k(a)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ./DefaultTextureUnits ./GLMaterial ../materials/internal/MaterialUtil".split(" "),function(n,a,m,k,h,d,g){n=function(a){function d(c){var b=a.call(this,c)||this,d=c.textureRep;b.textureRep=d;b.textureId=
c.textureId;var f=!!c.initTransparent;b.initTransparent=f;b.glTextureRef=g.acquireIfNotUndefined(b.textureId,d,b.initTransparent);c.normalTextureId&&(b.glTextureRefNormal=g.acquireIfNotUndefined(c.normalTextureId,d,f));c.emissiveTextureId&&(b.glTextureRefEmission=g.acquireIfNotUndefined(c.emissiveTextureId,d,f));c.occlusionTextureId&&(b.glTextureRefOcclusion=g.acquireIfNotUndefined(c.occlusionTextureId,d,f));c.metallicRoughnessTextureId&&(b.glTextureRefRoughnessMetallness=g.acquireIfNotUndefined(c.metallicRoughnessTextureId,
d,f));return b}k(d,a);d.prototype.dispose=function(){g.releaseIfNotUndefined(this.textureId,this.textureRep)};d.prototype.updateTexture=function(a){a!==this.textureId&&(g.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=a,this.glTextureRef=g.acquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};d.prototype.bindTexture=function(a,b){null!=this.glTextureRef&&(b.setUniform1i("tex",h.DefaultTextureUnits.DIFFUSE),a.bindTexture(this.glTextureRef.getGLTexture(),
h.DefaultTextureUnits.DIFFUSE));this.glTextureRefNormal&&(b.setUniform1i("texNormal",h.DefaultTextureUnits.NORMAL),a.bindTexture(this.glTextureRefNormal.getGLTexture(),h.DefaultTextureUnits.NORMAL));this.glTextureRefEmission&&(b.setUniform1i("texEmission",h.DefaultTextureUnits.EMISSION),a.bindTexture(this.glTextureRefEmission.getGLTexture(),h.DefaultTextureUnits.EMISSION));this.glTextureRefOcclusion&&(b.setUniform1i("texOcclusion",h.DefaultTextureUnits.OCCLUSION),a.bindTexture(this.glTextureRefOcclusion.getGLTexture(),
h.DefaultTextureUnits.OCCLUSION));this.glTextureRefRoughnessMetallness&&(b.setUniform1i("texMetallicRoughness",h.DefaultTextureUnits.METALLIC_ROUGHNESS),a.bindTexture(this.glTextureRefRoughnessMetallness.getGLTexture(),h.DefaultTextureUnits.METALLIC_ROUGHNESS))};d.prototype.bindTextureScale=function(a,b){(a=this.glTextureRef&&this.glTextureRef.getGLTexture())&&a.descriptor.textureCoordinateScaleFactor?b.setUniform2fv("textureCoordinateScaleFactor",a.descriptor.textureCoordinateScaleFactor):b.setUniform2f("textureCoordinateScaleFactor",
1,1)};return d}(d);(function(a){a.makeCtorParameters=function(a,c){return m({},a,c)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.DefaultTextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ./AutoDisposable".split(" "),
function(n,a,m,k,h,d){return function(a){function d(d){var c=a.call(this)||this;c.material=d.material;c.programRep=d.programRep;return c}m(d,a);d.prototype.isVisible=function(){return this.material.isVisible()};d.prototype.isVisibleInPass=function(a){return this.material.isVisibleInPass(a)};d.prototype.getPrograms=function(){return[this.getProgram()]};d.prototype.getDrawMode=function(){return 4};d.prototype.release=function(a,c){};return d=k([h.subclass("esri.views.3d.webgl-engine.lib.GLMaterial")],
d)}(h.declared(d.AutoDisposable))})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../../core/tsSupport/decorateHelper","../../../../core/accessorSupport/decorators"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});a.AutoDisposableMixin=function(a){return function(a){function d(){var d=null!==a&&a.apply(this,arguments)||this;d._isDisposed=!1;return d}m(d,a);d.prototype.dispose=function(){for(var a=
this.__proto__.__managedDisposables__||[],c=a.length-1;0<=c;c--){var b=a[c];this[b]&&"function"===typeof this[b].dispose&&this[b].dispose();this[b]=null}this._isDisposed=!0};Object.defineProperty(d.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0});return d=k([h.subclass("esri.views.3d.webgl-engine.lib.AutoDisposableMixin")],d)}(h.declared(a))};n=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}m(d,a);return d=k([h.subclass("esri.views.3d.webgl-engine.lib.AutoDisposable")],
d)}(h.declared(a.AutoDisposableMixin(function(){return function(){}}())));a.AutoDisposable=n;a.autoDispose=function(){return function(a,g){a.__managedDisposables__=a.__managedDisposables__||[];a.__managedDisposables__.push(g)}}})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/mathUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../geometry/support/aaBoundingBox ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(b,a,d,e,f){var g=v(a,d,B);c.setMin(A,b.getBBMin());c.setMax(A,b.getBBMax());if(y(A,a,g,e)){var g=b.getPrimitiveIndices(),l=b.getIndices(),p=b.getPosition(),h=g?g.length:l.length/3;if(h>L&&(b=b.getChildren(),void 0!==b)){for(g=0;8>g;++g)void 0!==b[g]&&r(b[g],a,d,e,f);return}w(a,d,0,h,l,p,g,f)}}function w(b,a,c,d,e,f,g,l){if(g){var p=f.data,h=f.offsetIdx;f=f.strideIdx;var q=b[0],k=b[1];b=b[2];var m=a[0]-q,t=a[1]-k;for(a=a[2]-b;c<d;++c){var r=g[c],x=3*
r,w=h+f*e[x++],v=p[w++],z=p[w++],y=p[w],w=h+f*e[x++],A=p[w++],n=p[w++],I=p[w],w=h+f*e[x],x=p[w++],J=p[w++],A=A-v,n=n-z,I=I-y,x=x-v,J=J-z,w=p[w]-y,E=t*w-J*a,B=a*x-w*m,M=m*J-x*t,H=A*E+n*B+I*M;if(!(Math.abs(H)<=G)){v=q-v;z=k-z;y=b-y;E=v*E+z*B+y*M;if(0<H){if(0>E||E>H)continue}else if(0<E||E<H)continue;B=z*I-n*y;y=y*A-I*v;z=v*n-A*z;v=m*B+t*y+a*z;if(0<H){if(0>v||E+v>H)continue}else if(0<v||E+v<H)continue;y=(x*B+J*y+w*z)/H;0<=y&&(A=u(A,n,I,x,J,w,F),l(y,A,r))}}}else for(g=f.data,p=f.offsetIdx,h=f.strideIdx,
f=b[0],q=b[1],k=b[2],b=a[0]-f,m=a[1]-q,t=a[2]-k,a=c,c*=3;a<d;++a)if(J=p+h*e[c++],H=g[J++],z=g[J++],y=g[J],J=p+h*e[c++],r=g[J++],A=g[J++],n=g[J],J=p+h*e[c++],I=g[J++],x=g[J++],r-=H,A-=z,n-=y,I-=H,x-=z,J=g[J]-y,v=m*J-x*t,E=t*I-J*b,B=b*x-I*m,w=r*v+A*E+n*B,!(Math.abs(w)<=G)){H=f-H;z=q-z;y=k-y;v=H*v+z*E+y*B;if(0<w){if(0>v||v>w)continue}else if(0<v||v<w)continue;E=z*n-A*y;y=y*r-n*H;z=H*A-r*z;H=b*E+m*y+t*z;if(0<w){if(0>H||v+H>w)continue}else if(0<H||v+H<w)continue;y=(I*E+x*y+J*z)/w;0<=y&&(r=u(r,A,n,I,x,
J,F),l(y,r,a))}}function u(b,a,c,d,e,f,l){g.vec3.set(K,b,a,c);g.vec3.set(H,d,e,f);g.vec3.cross(l,K,H);g.vec3.normalize(l,l);return l}function v(b,a,c){return g.vec3.set(c,1/(a[0]-b[0]),1/(a[1]-b[1]),1/(a[2]-b[2]))}function y(b,a,c,d){var e=(b[0]-d-a[0])*c[0],f=(b[3]+d-a[0])*c[0],g=Math.min(e,f),e=Math.max(e,f),f=(b[1]-d-a[1])*c[1],l=(b[4]+d-a[1])*c[1],g=Math.max(g,Math.min(f,l)),e=Math.min(e,Math.max(f,l));if(g>e)return!1;f=(b[2]-d-a[2])*c[2];b=(b[5]+d-a[2])*c[2];g=Math.max(g,Math.min(f,b));e=Math.min(e,
Math.max(f,b));return g<=e}function t(b,a){a=a?t(a):{};for(var c in b){var d=b[c];d&&d.forEach&&(d=x(d));null==d&&c in a||(a[c]=d)}return a}function x(b){var a=[];b.forEach(function(b){return a.push(b)});return a}Object.defineProperty(a,"__esModule",{value:!0});var z=d.mat4f64.create(),A=c.create(),E=q.VertexAttrConstants;a.IDENTITY=d.mat4f64.create();a.intersectTriangleGeometry=function(a,d,e,f,g,l){d=d&&d.componentVisibilities;e=e.tolerance;if(1<a.componentCount)a:{var p=v(f,g,B),h=a.componentCount,
k=a.componentOffsets,m=a.getIndices(E.POSITION),t=a.getAttribute(E.POSITION),u=a.boundingInfo;if(u&&(c.setMin(A,u.getBBMin()),c.setMax(A,u.getBBMax()),!y(A,f,p,e)))break a;for(u=0;u<h;u++)if(!d||b.getVisibility(d,u)){if(a.getComponentAABB){var x=a.getComponentAABB(u,A);if(!y(x,f,p,e))continue}w(f,g,k[u]/3,k[u+1]/3,m,t,void 0,l)}}else if(!d||b.getVisibility(d,0))a.boundingInfo?(q.assert("triangle"===a.data.primitiveType),r(a.boundingInfo,f,g,e,l)):(d=a.getIndices(E.POSITION),a=a.getAttribute(E.POSITION),
w(f,g,0,d.length/3,d,a,void 0,l))};var B=l.vec3f64.create(),G=Math.pow(2,-52),F=l.vec3f64.create();a.intersectTriangles=w;var K=l.vec3f64.create(),H=l.vec3f64.create();a.computeNormal=u;a.intersectAabbInvDir=y;a.transformToWorld=function(b,a,c){return f.vec4.set(c,b[0]-a[0],b[1]-a[1],b[2]-a[2],1)};a.transformToView=function(b,a,c,d){k.mat4.translate(z,c,a);c=z;return f.vec4.transformMat4(d,b,c)};a.transformToProjection=function(b,a,c,d){d[0]=b[0]+c[0];d[1]=b[1]+c[1];d[2]=b[2]+c[2];d[3]=b[3];return f.vec4.transformMat4(d,
d,a)};a.transformToNDC=function(b,a){return f.vec4.scale(a,b,1/Math.abs(b[3]))};a.applyScreenSizePerspectiveScale=function(b,a,c,d,e){return p.scale(b,d,c,e)};a.verticalOffsetAtDistance=function(b,a,c,d,e){var f=(c.screenLength||0)*b.pixelRatio;e&&(f=p.scale(f,d,a,e));return m.clamp(f*Math.tan(.5*b.fovY)/(.5*b.fullHeight)*a,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:Infinity)};a.acquireIfNotUndefined=function(b,a,c){if(void 0!==b)return a.acquire(b,c)};a.releaseIfNotUndefined=function(b,
a){void 0!==b&&a.release(b)};var N=h.mat4f32.create();a.bindView=function(b,a,c){k.mat4.translate(N,a,b);c.setUniform3fv("localOrigin",b);c.setUniformMatrix4fv("view",N)};a.bindCamPos=function(b,a,c){c.setUniform3f("camPos",a[3]-b[0],a[7]-b[1],a[11]-b[2])};var I=l.vec3f64.create(),J=l.vec3f64.create();a.bindViewOriginDouble=function(b,a){e.encodeDoubleArraySplit(b,I,J,3);a.setUniform3fv("viewOriginHi",I);a.setUniform3fv("viewOriginLo",J)};var M=l.vec3f64.create();a.bindSlicePlane=function(b,a,c){g.vec3.subtract(M,
a.origin,b);c.setUniform3fv("slicePlaneOrigin",M);c.setUniform3fv("slicePlaneBasis1",a.basis1);c.setUniform3fv("slicePlaneBasis2",a.basis2)};a.bindVerticalOffset=function(b,a,c){if(b){var d=a.fovY,e=a.viewport[3],f=void 0;void 0===f&&(f=R);f.screenLength=b.screenLength;f.perDistance=Math.tan(.5*d)/(.5*e);f.minWorldLength=b.minWorldLength;f.maxWorldLength=b.maxWorldLength;b=f;c.setUniform4f("verticalOffset",b.screenLength*(a.pixelRatio||1),b.perDistance,b.minWorldLength,b.maxWorldLength)}};a.bindHighlightRendering=
function(b,a,c){b.bindTexture(a.highlightDepthTexture,5);c.setUniform1i("depthTex",5);c.setUniform4f("highlightViewportPixelSz",0,0,1/a.viewport[2],1/a.viewport[3])};a.bindScreenSizePerspective=function(b,a,c){void 0===c&&(c="screenSizePerspectiveAlignment");if(b){var d=b.parameters;a.setUniform4f(c,d.divisor,d.offset,d.minPixelSize,b.paddingPixelsOverride)}};a.copyParameters=t;a.updateParameters=function(b,a){var c=!1,d;for(d in a){var e=a[d];void 0!==e&&(c=!0,Array.isArray(e)?b[d]=e.slice():b[d]=
e)}return c};(function(b){function a(b){return(b.shadowMappingEnabled?1:0)|(b.ssaoEnabled?2:0)}b.create=function(b,c){for(var d=[],e=0;2>e;e++)for(var f=0;2>f;f++){var g=a({shadowMappingEnabled:1===e,ssaoEnabled:1===f}),l=a({shadowMappingEnabled:1===e,ssaoEnabled:1===f&&b.receiveSSAO});d[g]=d[l]||c({receiveShadows:1===e,receiveSSAO:1===f&&b.receiveSSAO})}return{programs:d.filter(function(b){return null!=b}),byParameter:d}};b.lookup=function(b,c){return b.byParameter[a(c)]};b.programs=function(b){return b.programs}})(a.BindParametersMap||
(a.BindParametersMap={}));a.intersectDrapedRenderLineGeometry=function(b,a,c,d,e,f,g,l,p){if(d.enable.selectionMode){a=b.getAttribute(E.POSITION).data;d=b.getAttribute(E.SIZE);c=f[0];f=f[1];b=(((d&&d.data[0])+g)/2+4)*b.pixelRatio;g=Number.MAX_VALUE;for(d=0;d<a.length-5;d+=3){var h=a[d],q=a[d+1];p=c-h;e=f-q;var h=a[d+3]-h,q=a[d+4]-q,k=m.clamp((h*p+q*e)/(h*h+q*q),0,1);p=h*k-p;e=q*k-e;e=p*p+e*e;e<g&&(g=e)}g<b*b&&l()}};a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var L=1E3,R={screenLength:0,
perDistance:0,minWorldLength:0,maxWorldLength:0};a.defaultPBRMaterialParameters={usePBR:!0,roughnessFactor:.6,metallicFactor:0,reflectanceFactor:.2};a.defaultPBRTreeMaterialParameters={usePBR:!0,roughnessFactor:1,metallicFactor:0,reflectanceFactor:.2};a.returnDefaultPBRMaterialParameters=function(b,c){return c&&b?a.defaultPBRTreeMaterialParameters:b?a.defaultPBRMaterialParameters:{usePBR:!1}}})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(n,
a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat4f32=m})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new Float32Array(16);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a};a.clone=function(a){var k=new Float32Array(16);k[0]=a[0];k[1]=a[1];k[2]=a[2];k[3]=a[3];k[4]=a[4];k[5]=a[5];k[6]=a[6];k[7]=a[7];k[8]=a[8];k[9]=a[9];k[10]=a[10];k[11]=a[11];k[12]=a[12];k[13]=a[13];
k[14]=a[14];k[15]=a[15];return k};a.fromValues=function(a,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v){var m=new Float32Array(16);m[0]=a;m[1]=k;m[2]=h;m[3]=d;m[4]=g;m[5]=l;m[6]=f;m[7]=c;m[8]=b;m[9]=e;m[10]=p;m[11]=q;m[12]=r;m[13]=w;m[14]=u;m[15]=v;return m};a.createView=function(a,k){return new Float32Array(a,k,16)}})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(n,a){function m(a,g,l){for(var d=0;d<l;++d)g[2*d]=a[d],g[2*d+1]=a[d]-g[2*d]}Object.defineProperty(a,
"__esModule",{value:!0});a.encodeDouble=function(a,g){h[0]=a;h[1]=a-h[0];g[0]=h[0];g[1]=h[1]};a.encodeDoubleArray=m;a.decodeDoubleArray=function(a,g,l){for(var d=0;d<l;++d)g[d]=a[2*d]+a[2*d+1]};a.encodeDoubleArraySplit=function(a,g,l,f){for(var c=0;c<f;++c)k[0]=a[c],m(k,h,1),g[c]=h[0],l[c]=h[1]};var k=new Float64Array(1),h=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});
n=function(){function a(h){this.supportsEdges=!1;this._parentStage=null;this._visible=!0;this._renderOccluded=1;this._renderPriority=0;this.id=a._idGen.gen(h)}a.prototype.update=function(a){return!1};Object.defineProperty(a.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0});a.prototype.addParentStage=function(a){this._parentStage=a};a.prototype.removeParentStage=function(a){this._parentStage=null};Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},
set:function(a){a!==this._visible&&(this._visible=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=
a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});a.prototype.isVisibleInPass=function(a){return!0};a.prototype.isVisible=function(){return this._visible};a.prototype.notifyDirty=function(a){this.parentStage&&this.parentStage.notifyDirty(3,this,a)};a._idGen=new m.IdGen;return a}();a.Material=n})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(n,a,m,k){function h(b,
a,c,d,f){var e=c.typedBuffer;c=c.typedBufferStride;var g=b.length;d*=c;if(null==f||1===f)for(var l=0;l<g;++l){var p=2*b[l];e[d]=a[p];e[d+1]=a[p+1];d+=c}else for(l=0;l<g;++l)for(var p=2*b[l],h=0;h<f;++h)e[d]=a[p],e[d+1]=a[p+1],d+=c}function d(b,a,c,d,f){var e=c.typedBuffer;c=c.typedBufferStride;var g=b.length;d*=c;if(null==f||1===f)for(var l=0;l<g;++l){var p=3*b[l];e[d]=a[p];e[d+1]=a[p+1];e[d+2]=a[p+2];d+=c}else for(l=0;l<g;++l)for(var p=3*b[l],h=0;h<f;++h)e[d]=a[p],e[d+1]=a[p+1],e[d+2]=a[p+2],d+=
c}function g(b,a,c,d,f){var e=c.typedBuffer;c=c.typedBufferStride;var g=b.length;d*=c;if(null==f||1===f)for(var l=0;l<g;++l){var p=4*b[l];e[d]=a[p];e[d+1]=a[p+1];e[d+2]=a[p+2];e[d+3]=a[p+3];d+=c}else for(l=0;l<g;++l)for(var p=4*b[l],h=0;h<f;++h)e[d]=a[p],e[d+1]=a[p+1],e[d+2]=a[p+2],e[d+3]=a[p+3],d+=c}function l(b,a,c,f,g,l){if(c){var e=f.typedBuffer;f=f.typedBufferStride;var p=b.length;g*=f;if(null==l||1===l)for(var h=0;h<p;++h){var q=3*b[h],k=a[q],m=a[q+1],r=a[q+2];e[g]=c[0]*k+c[4]*m+c[8]*r+c[12];
e[g+1]=c[1]*k+c[5]*m+c[9]*r+c[13];e[g+2]=c[2]*k+c[6]*m+c[10]*r+c[14];g+=f}else for(h=0;h<p;++h)for(var q=3*b[h],k=a[q],m=a[q+1],r=a[q+2],q=c[0]*k+c[4]*m+c[8]*r+c[12],w=c[1]*k+c[5]*m+c[9]*r+c[13],k=c[2]*k+c[6]*m+c[10]*r+c[14],m=0;m<l;++m)e[g]=q,e[g+1]=w,e[g+2]=k,g+=f}else d(b,a,f,g,l)}function f(b,a,c,f,g,l){if(c){var e=f.typedBuffer;f=f.typedBufferStride;var h=b.length;g*=f;if(null==l||1===l)for(var p=0;p<h;++p){var k=3*b[p],q=a[k],m=a[k+1],r=a[k+2];e[g]=c[0]*q+c[4]*m+c[8]*r;e[g+1]=c[1]*q+c[5]*m+
c[9]*r;e[g+2]=c[2]*q+c[6]*m+c[10]*r;g+=f}else for(p=0;p<h;++p)for(var k=3*b[p],q=a[k],m=a[k+1],r=a[k+2],k=c[0]*q+c[4]*m+c[8]*r,w=c[1]*q+c[5]*m+c[9]*r,q=c[2]*q+c[6]*m+c[10]*r,m=0;m<l;++m)e[g]=k,e[g+1]=w,e[g+2]=q,g+=f}else d(b,a,f,g,l)}function c(b,a,c,d,f,g){var e=d.typedBuffer;d=d.typedBufferStride;var l=b.length;f*=d;if(null==g||1===g)if(4===c)for(c=0;c<l;++c){var h=4*b[c];e[f]=a[h];e[f+1]=a[h+1];e[f+2]=a[h+2];e[f+3]=a[h+3];f+=d}else{if(3===c)for(c=0;c<l;++c)h=3*b[c],e[f]=a[h],e[f+1]=a[h+1],e[f+
2]=a[h+2],e[f+3]=255,f+=d}else if(4===c)for(c=0;c<l;++c)for(var h=4*b[c],p=0;p<g;++p)e[f]=a[h],e[f+1]=a[h+1],e[f+2]=a[h+2],e[f+3]=a[h+3],f+=d;else if(3===c)for(c=0;c<l;++c)for(h=3*b[c],p=0;p<g;++p)e[f]=a[h],e[f+1]=a[h+1],e[f+2]=a[h+2],e[f+3]=255,f+=d}Object.defineProperty(a,"__esModule",{value:!0});a.writeBufferVec2=h;a.writeBufferVec3=d;a.writeBufferVec4=g;a.writeBufferMat3f=function(b,a,c,d){var e=c.typedBuffer;c=c.typedBufferStride;var f=b.length;d*=c;for(var g=0;g<f;++g){for(var l=9*b[g],h=0;9>
h;++h)e[d+h]=a[l+h];d+=c}};a.writeBufferMat4f=function(b,a,c,d){var e=c.typedBuffer;c=c.typedBufferStride;var f=b.length;d*=c;for(var g=0;g<f;++g){for(var l=16*b[g],h=0;16>h;++h)e[d+h]=a[l+h];d+=c}};a.writePosition=l;a.writeNormal=f;a.writeColor=c;a.writeMultipliedColor=function(b,a,c,d,f,g,l){var e=f.typedBuffer;f=f.typedBufferStride;var h=b.length;g*=f;if(null==l||1===l)if(4===c)for(c=0;c<h;++c){var p=4*b[c];e[g]=a[p]*d[0];e[g+1]=a[p+1]*d[1];e[g+2]=a[p+2]*d[2];e[g+3]=a[p+3]*d[3];g+=f}else{if(3===
c){var k=255*d[3];for(c=0;c<h;++c)p=3*b[c],e[g]=a[p]*d[0],e[g+1]=a[p+1]*d[1],e[g+2]=a[p+2]*d[2],e[g+3]=k,g+=f}}else if(4===c)for(c=0;c<h;++c)for(var p=4*b[c],q=0;q<l;++q)e[g]=a[p]*d[0],e[g+1]=a[p+1]*d[1],e[g+2]=a[p+2]*d[2],e[g+3]=a[p+3]*d[3],g+=f;else if(3===c)for(k=255*d[3],c=0;c<h;++c)for(p=3*b[c],q=0;q<l;++q)e[g]=a[p]*d[0],e[g+1]=a[p+1]*d[1],e[g+2]=a[p+2]*d[2],e[g+3]=k,g+=f};a.writeDefaultAttributes=function(b,a,d,q,r,w){var e=0;for(a=a.fieldNames;e<a.length;e++){var p=a[e],y=b.vertexAttr[p],t=
b.indices[p];if(y&&t)switch(p){case k.VertexAttrConstants.POSITION:k.assert(3===y.size);(p=r.getField(p,m.BufferViewVec3f))&&l(t,y.data,d,p,w);break;case k.VertexAttrConstants.NORMAL:k.assert(3===y.size);(p=r.getField(p,m.BufferViewVec3f))&&f(t,y.data,q,p,w);break;case k.VertexAttrConstants.UV0:k.assert(2===y.size);(p=r.getField(p,m.BufferViewVec2f))&&h(t,y.data,p,w);break;case k.VertexAttrConstants.REGION:k.assert(4===y.size);(p=r.getField(p,m.BufferViewVec4u16))&&g(t,y.data,p,w);break;case k.VertexAttrConstants.COLOR:k.assert(3===
y.size||4===y.size);(p=r.getField(p,m.BufferViewVec4u8))&&c(t,y.data,y.size,p,w);break;case k.VertexAttrConstants.SYMBOLCOLOR:k.assert(3===y.size||4===y.size);(p=r.getField(p,m.BufferViewVec4u8))&&c(t,y.data,y.size,p,w);break;case k.VertexAttrConstants.TANGENT:k.assert(4===y.size),(p=r.getField(p,m.BufferViewVec4f))&&g(t,y.data,p,w)}}}})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/IntervalUtilities ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){function w(b,a,c,d){for(var e=new Map,f=a.vertexBufferLayout.stride/4,g=function(c,d){var g=c.origin,l=b.get(g.id),h=e.get(g.id);null==h&&(h={optimalCount:null==l?0:l.optimalCount,sparseCount:null==l?0:l.buffer.getSize(),toAdd:[],toRemove:[],origin:g.vec3},e.set(g.id,h));g=a.elementCount(c.data)*f;d?(h.optimalCount+=g,h.sparseCount+=g,h.toAdd.push(c)):(h.optimalCount-=g,h.toRemove.push(c))},l=0;l<c.length;l++){var h=c[l];g(h,!0)}for(c=0;c<d.length;c++)h=d[c],
g(h,!1);return e}n=function(){function a(b,a,c,f){void 0===f&&(f=d.Default3D);this.type="MergedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=b;this._vertexAttributeLocations=f;this._material=c;this._materialRep=a;this._glMaterials=e.acquireMaterials(this._material,this._materialRep);this._bufferWriter=c.createBufferWriter()}a.prototype.dispose=function(){e.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0===
this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});a.prototype.hasWater=function(){var b=!1;this._glMaterials.forEach(function(a){b=b||a instanceof c.WaterGLMaterial});return b};a.prototype.renderPriority=function(){return this._material.renderPriority};a.prototype.modify=function(b){var a=this,c=z;c.clear();this.updateGeometries(b.toUpdate,c);this.addAndRemoveGeometries(b.toAdd,
b.toRemove,c);this.updateHighlightCount();c.forEach(function(b){return a.updateDisplayedIndexRanges(b)})};a.prototype.addAndRemoveGeometries=function(b,a,c){var d=this,e=this._material,g=this._bufferWriter,l=g.vertexBufferLayout,h=l.stride/4,p=this._dataByOrigin,k=w(p,g,b,a);k.forEach(function(b,a){k.delete(a);var g=b.optimalCount,q=b.sparseCount,m=p.get(a);null==m&&(f.assert(0<g),m=d.createData(l,g,b.origin),p.set(a,m));if(0===g)m.vao.dispose(!0),m.vao=null,p.delete(a);else{var t=(a=g<b.sparseCount/
2)?g:q,g=u,q=m.buffer.getSize(),r=m.buffer.getArray(),t=m.buffer.resize(t,!1);a||t?d.removeAndRebuild(m,b.toRemove,h,r,g):0<b.toRemove.length?(d.removeByErasing(m,b.toRemove,h,g),0<b.toAdd.length&&(g.end=q)):(g.begin=q,g.end=q);a=v;f.setMatrixTranslation3(a,-b.origin[0],-b.origin[1],-b.origin[2]);d.append(m,e,b.toAdd,h,a,g);b=m.vao.vertexBuffers.geometry;b.byteSize!==m.buffer.getArray().buffer.byteLength?b.setData(m.buffer.getArray()):(r=g.begin,a=g.end,r<a&&(q=m.buffer.getArray(),r*=4,b.setSubData(q,
r,r,4*a)));(g.updatedDisplayedIndexRange||m.displayedIndexRanges)&&c.add(m)}})};a.prototype.updateGeometries=function(b,a){for(var c=this._bufferWriter,d=c.vertexBufferLayout.stride/4,g=0;g<b.length;g++){var l=b[g],h=l.updateType,l=l.renderGeometry,p=this._dataByOrigin.get(l.origin.id),k=p&&p.instances.get(l.uniqueName);if(!k)break;h&1&&(k.displayedIndexRange=e.generateRenderGeometryVisibleIndexRanges(l),a.add(p));h&17&&(k.highlightedIndexRanges=e.generateRenderGeometryHighlightRanges(l),p.highlightCount=
null);h&6&&(h=p.buffer.getArray(),p=p.vao,e.calculateTransformRelToOrigin(l,y,t),c.write({transformation:y,invTranspTransformation:t},l.data,c.vertexBufferLayout.createView(h.buffer),k.from),f.assert(k.from+c.elementCount(l.data)===k.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(h,k.from*d*4,k.from*d*4,k.to*d*4))}};a.prototype.updateDisplayedIndexRanges=function(b){var a=b.instances;b.displayedIndexRanges=[];var c=!0;a.forEach(function(a){a.displayedIndexRange?(b.displayedIndexRanges.push.apply(b.displayedIndexRanges,
g.offsetIntervals(a.displayedIndexRange,a.from)),c=!1):b.displayedIndexRanges.push([a.from,a.to-1])});b.displayedIndexRanges=c?null:g.mergeIntervals(b.displayedIndexRanges)};a.prototype.updateHighlightCount=function(){var b=this;this._highlightCount=0;this._dataByOrigin.forEach(function(a){if(null==a.highlightCount){var c=0;a.instances.forEach(function(b){b.highlightedIndexRanges&&++c});a.highlightCount=c}b._highlightCount+=a.highlightCount})};a.prototype.updateLogic=function(b){return this._material.update(b)};
a.prototype.render=function(b,a,c,d){var e=this,f=this._rctx,g=this._glMaterials.get(a.pass),l=4===a.pass;2===a.pass&&null===b&&(b=20);if(!g||null!=b&&!g.beginSlot(b)||l&&0===this._highlightCount)return!1;g.bind(f,c);a=g.getProgram();a.setUniformMatrix4fv("model",x);a.hasUniform("modelNormal")&&a.setUniformMatrix4fv("modelNormal",x);var h=!1;this._dataByOrigin.forEach(function(b){l&&0===b.highlightCount||(c.origin=b.origin,g.bindView(f,c),h=l?e.renderHighlightPass(g,b,d)||h:e.renderDefaultPass(g,
b,d)||h)});g.release(f,c);return h};a.prototype.renderDefaultPass=function(b,a,c){var d=this._rctx,f=b.getProgram();b=b.getDrawMode();var g=a.displayedIndexRanges;if(g&&0===g.length)return!1;q.assertCompatibleVertexAttributeLocations(a.vao,f);d.bindVAO(a.vao);g?e.drawArraysFaceRange(d,g,0,b,c):(a=4*a.buffer.getSize()/q.getStride(a.vao.layout.geometry),e.drawArrays(d,b,0,a,c));return!0};a.prototype.renderHighlightPass=function(b,a,c){var d=this._rctx,f=b.getProgram(),g=b.getDrawMode();b=a.vao;q.assertCompatibleVertexAttributeLocations(b,
f);d.bindVAO(b);var l=!1;a.instances.forEach(function(b){var a=b.highlightedIndexRanges;if(a&&0!==a.length)for(var f=0;f<a.length;f++){var h=a[f];e.drawArrays(d,g,h.range?h.range[0]+b.from:b.from,h.range?h.range[1]-h.range[0]+1:b.to-b.from,c);l=!0}});return l};a.prototype.createData=function(b,a,c){return{instances:new Map,vao:new r(this._rctx,this._vertexAttributeLocations,{geometry:h.glLayout(b)},{geometry:p.createVertex(this._rctx,35044)}),buffer:new l.ResizableFloat32Array(a),optimalCount:0,origin:c,
highlightCount:0}};a.prototype.removeAndRebuild=function(b,a,c,d,e){for(var f=0;f<a.length;f++){var g=a[f].uniqueName,l=b.instances.get(g);b.optimalCount-=(l.to-l.from)*c;b.instances.delete(g)}var h=0,p=b.buffer.getArray();e.begin=0;e.end=0;var k=-1,q=-1,m=0;b.instances.forEach(function(b){var a=b.from*c,e=b.to*c,f=e-a;k!==q&&q!==a?(p.set(d.subarray(k,q),m),m+=q-k,k=a):-1===k&&(k=a);q=e;b.from=h/c;h+=f;b.to=h/c});k!==q&&p.set(d.subarray(k,q),m);e.end=h};a.prototype.removeByErasing=function(b,a,c,
d){d.begin=Infinity;d.end=-Infinity;for(var e=-1,f=-1,g=0;g<a.length;g++){var l=a[g].uniqueName,h=b.instances.get(l),p=h.from*c,h=h.to*c;e!==f&&f!==p?(b.buffer.erase(e,f),e=p):-1===e&&(e=p);f=h;b.instances.delete(l);b.optimalCount-=h-p;p<d.begin&&(d.begin=p);h>d.end&&(d.end=h)}e!==f&&b.buffer.erase(e,f)};a.prototype.append=function(a,c,d,g,l,h){h.updatedDisplayedIndexRange=!1;c=this._bufferWriter;for(var p=0;p<d.length;p++){var k=d[p],q=k.data;m.mat4.multiply(y,l,k.transformation);m.mat4.invert(t,
y);m.mat4.transpose(t,t);var u=h.end;c.write({transformation:y,invTranspTransformation:t},q,c.vertexBufferLayout.createView(a.buffer.getArray().buffer),h.end/g);var q=c.elementCount(q)*g,r=u+q;f.assert(null==a.instances.get(k.uniqueName));var x=e.generateRenderGeometryVisibleIndexRanges(k),w=e.generateRenderGeometryHighlightRanges(k);w&&(a.highlightCount=null);u=new b(k.name,u/g,r/g,x,w,void 0,void 0,k.idx);a.instances.set(k.uniqueName,u);x&&(h.updatedDisplayedIndexRange=!0);a.optimalCount+=q;h.end+=
q}};Object.defineProperty(a.prototype,"test",{get:function(){return{material:this._material}},enumerable:!0,configurable:!0});return a}();var u={updatedDisplayedIndexRange:!1,begin:0,end:0},v=k.mat4f64.create(),y=k.mat4f64.create(),t=k.mat4f64.create(),x=k.mat4f64.create(),z=new Set;return n})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(n,a){return function(){function a(){}a.copyIntervals=function(a){for(var h=[],d=0;d<a.length;d++){var g=a[d];
h.push([g[0],g[1]])}return h};a.convertFaceToIndexRange=function(a,h){for(var d=0;d<a.length;d++){var g=a[d];g[0]*=h;g[1]=g[1]*h+(h-1)}};a.sortIntervals=function(a){return a.sort(function(a,d){return a[0]===d[0]?a[1]>d[1]?1:a[1]<d[1]?-1:0:a[0]>d[0]?1:a[0]<d[0]?-1:0})};a.intersectIntervals=function(a,h){if(0>=a.length)return[];for(var d=[],g=0;g<a.length;g++){var l=a[g];l[1]<h[0]||l[0]>h[1]||(l=[l[0],l[1]],l[0]<h[0]&&(l[0]=h[0]),l[1]>h[1]&&(l[1]=h[1]),d.push(l))}return d};a.mergeIntervals=function(a){if(0>=
a.length)return[];var h=[];a=this.sortIntervals(a);h.push(a[0]);for(var d=1;d<a.length;d++){var g=h[h.length-1];g[1]+1<a[d][0]?h.push(a[d]):g[1]<a[d][1]&&(g[1]=a[d][1],h.pop(),h.push(g))}return h};a.invertIntervals=function(a,h){for(var d=[],g=0,l=0;l<a.length;l++){var f=a[l];f[0]>g&&d.push([g,f[0]-1]);g=f[1]+1}g<=h&&d.push([g,h]);return d};a.offsetIntervals=function(a,h){for(var d=[],g=0;g<a.length;g++){var l=a[g];d.push([l[0]+h,l[1]+h])}return d};return a}()})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["require",
"exports","../../../../core/mathUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){null==a?a=16:65536>a&&(a=m.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);this.size=0}a.prototype.resize=function(a,d){this.size=a;var g;if(this.size>this.array.length){for(a=this.array.length||1;a<this.size;)a*=2;g=new Float32Array(a);d&&g.set(this.array);this.array=g;return!0}g=2*this.size;if(g<=this.array.length){for(a=this.array.length;a>=g;)a=Math.floor(a/
2);g=new Float32Array(a);d&&g.set(this.array.subarray(0,a));this.array=g;return!0}return!1};a.prototype.append=function(a){var d=this.size;this.resize(this.size+a.length,!0);this.array.set(a,d)};a.prototype.erase=function(a,d){for(;a<d;++a)this.array[a]=0};a.prototype.getArray=function(){return this.array};a.prototype.getSize=function(){return this.size};return a}();a.ResizableFloat32Array=n})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ./internal/MaterialUtil ./internal/waterMaterialUtils ../shaders/WaterSurfacePrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b){b=a.call(this,b)||this;b.updateParameters();return b}m(c,a);c.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters());this.selectProgram()};c.prototype._selectPipelineState=function(){this.pipelineState=l.makePipelineState({blending:this.params.transparent&&l.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:this.params.writeDepth&&l.defaultDepthWriteParams,
colorWrite:l.defaultColorWriteParams})};c.prototype.getProgramTemplate=function(){return g.color};c.prototype.selectProgram=function(){this.program=this.programRep.getProgram(this.getProgramTemplate(),{slice:this.params.slicePlaneEnabled,receiveShadows:this.params.receiveShadows});this._selectPipelineState()};c.prototype.beginSlot=function(b){var a=5;this.params.transparent&&(a=this.params.writeDepth?7:10);return b===a};c.prototype.getProgram=function(){return this.program};c.prototype._initTextures=
function(b){this.texturePaths=[this.params.waveTexture,this.params.perturbationTexture];d.waterTextureRepo.initialize(b,this.texturePaths)};c.prototype._bindUniforms=function(b,a){b.bindProgram(this.program);b.setPipelineState(this.pipelineState);d.waterTextureRepo.bindRepo(b);this.program.setUniform4fv("waterColor",this.params.color);this._setWaveUniforms(this.program)};c.prototype._setWaveUniforms=function(b){b.setUniform1i("texWaveNormal",0);b.setUniform1i("texWavePerturbation",1);b.setUniform4f("waveParams",
this.params.waveStrength,this.params.waveTextureRepeat,this.params.flowStrength,this.params.flowOffset);b.setUniform2f("waveDirection",this.params.waveDirection[0]*this.params.waveVelocity,this.params.waveDirection[1]*this.params.waveVelocity);b.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)};c.prototype._updateShadowState=function(b){b.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:b.shadowMappingEnabled}),
this.updateParameters())};c.prototype.bind=function(b,a){d.waterTextureRepo.ready()?(this._updateShadowState(a),this._bindUniforms(b,a)):d.waterTextureRepo.loading()||this._initTextures(b)};c.prototype.release=function(b){};c.prototype.bindView=function(b,a){b=this.program;b.setUniform3fv("localOrigin",a.origin);h.bindView(a.origin,a.view,b);h.bindCamPos(a.origin,a.viewInvTransp,b);this.params.slicePlaneEnabled&&h.bindSlicePlane(a.origin,a.slicePlane,b);a.shadowMappingEnabled&&(a.shadowMap.bind(b),
a.shadowMap.bindView(b,a.origin))};c.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};c.prototype.getDrawMode=function(){return 4};return c}(k);a.WaterGLMaterial=n;k=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}m(c,a);c.prototype.bind=function(b,a){b.bindProgram(this.program);b.setPipelineState(this.pipelineState);this.program.setUniform4fv("waterColor",this.params.color)};c.prototype.bindView=function(b,a){this.program.setUniform3fv("localOrigin",
a.origin);h.bindView(a.origin,a.view,this.program)};c.prototype.beginSlot=function(b){return null==b};c.prototype.getProgramTemplate=function(){return g.drapedColor};return c}(n);a.WaterDrapedGLMaterial=k;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}m(c,a);c.prototype.bind=function(b,a){d.waterTextureRepo.ready()?(b.bindProgram(this.program),b.setPipelineState(this.pipelineState),d.waterTextureRepo.bindRepo(b),this._setWaveUniforms(this.program)):d.waterTextureRepo.loading()||
this._initTextures(b)};c.prototype.bindView=function(b,a){this.program.setUniform3fv("localOrigin",a.origin);h.bindView(a.origin,a.view,this.program)};c.prototype.beginSlot=function(b){return 20===b};c.prototype._selectPipelineState=function(){this.pipelineState=l.makePipelineState({depthTest:{func:513},depthWrite:this.params.writeDepth&&l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams})};c.prototype.getProgramTemplate=function(){return g.drapedNormal};return c}(n);a.WaterNormalGLMaterial=
n})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../support/imageUtils ../../../../webgl/Texture".split(" "),function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});var f=h.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.waterParameterDefaultsLocal=
{waveTexture:n.toUrl("../../../../../images/materials/water/normals.jpg"),perturbationTexture:n.toUrl("../../../../../images/materials/water/perturbation.jpg"),waveStrength:.06,waveTextureRepeat:32,waveDirection:d.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,.35686,.4,1],transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0};a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},
"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,
perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,
waveVelocity:.15}};n=function(){function a(){this.loadingCount=0;this.data=[];this.loadingState=0}a.prototype.loadTexture=function(b,a,c){return k(this,void 0,void 0,function(){var d,e;return m(this,function(h){switch(h.label){case 0:this.loadingCount++,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,g.requestImage(c)];case 2:return d=h.sent(),this.data[a]=new l(b,this.getTextureProps(d.width,d.height,!0),d),[3,4];case 3:return e=h.sent(),f.warn("Failed to load texture for water material.",e),this.data[a]=
new l(b,this.getTextureProps(1,1,!0)),[3,4];case 4:return this.loadingCount--,[2]}})})};a.prototype.getTextureProps=function(b,a,c){void 0===c&&(c=!1);return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:b,height:a}};a.prototype.ready=function(){return 2===this.loadingState?!0:1===this.loadingState&&0===this.loadingCount?(this.loadingState=2,!0):!1};a.prototype.loading=function(){return 1===this.loadingState};a.prototype.initialize=function(b,
a){for(var c=0;c<a.length;c++)this.loadTexture(b,c,a[c]);this.loadingState=1};a.prototype.bindRepo=function(b){for(var a=0;a<this.data.length;a++)b.bindTexture(this.data[a],a)};return a}();a.waterTextureRepo=new n})},"esri/views/3d/webgl-engine/shaders/WaterSurfacePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(a){return h.glslifyDefineMap({SLICE:a.slice,
RECEIVE_SHADOWS:a.receiveShadows})};a.color={name:"water-ocean",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/water/colorPass.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/water/colorPass.frag")}},attributes:m.Default3D};a.drapedColor={name:"water-drapedColor",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/water/drapedColorPass.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/water/drapedColorPass.frag")}},attributes:m.Default3D};
a.drapedNormal={name:"water-drapedNormal",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/water/normalPass.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/water/normalPass.frag")}},attributes:m.Default3D}})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(n,a,m,k){return function(){return function(a,d,g,l,f,c,b,e,p){this.name=
a;this.from=d;this.to=g;this.displayedIndexRange=l;this.highlightedIndexRanges=f;this.transformation=c;this.instanceParameters=b;this.idx=e;this.dataId=p;null!=c&&(this.transformationNormal=k.mat4f64.clone(c),m.mat4.invert(this.transformationNormal,this.transformationNormal),m.mat4.transpose(this.transformationNormal,this.transformationNormal))}}()})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/ComponentUtils ../../lib/Util ../../../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});a.generateRenderGeometryVisibleIndexRanges=function(a){return a.instanceParameters.hidden?[]:h.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)};a.generateRenderGeometryHighlightRanges=function(a){return a.instanceParameters.hidden?null:h.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};a.doesRenderGeometryHaveHighlights=
function(a){return a.instanceParameters.hidden?!1:h.hasHighlights(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};a.isRenderGeometryHidden=function(a){return a.instanceParameters.hidden?!0:h.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)};a.drawArrays=function(a,c,b,d,g){a.drawArrays(c,b,d);g&&(g.drawCalls++,4===c&&(g.triangles+=d))};a.drawElements=function(a,c,b,d,l,h){var e=g.getBytesPerElement(b);a.drawElements(c,
l,b,d*e);h&&(h.drawCalls++,4===c&&(h.triangles+=l))};a.drawArraysFaceRange=function(a,c,b,d,g){for(var e=0,f=0;f<c.length;f++){var l=c[f],h=l[0]+b,l=l[1]-l[0]+1,e=e+l;a.drawArrays(d,h,l)}g&&(g.drawCalls+=c.length,4===d&&(g.triangles=e/3))};a.drawElementsFaceRange=function(a,c,b,d,l,h){for(var e=g.getBytesPerElement(l),f=0,p=0;p<c.length;p++){var k=c[p],q=k[0]+b,k=k[1]-k[0]+1,f=f+k;a.drawElements(d,k,l,q*e)}h&&(h.drawCalls+=c.length,4===d&&(h.triangles+=f/3))};a.acquireMaterials=function(a,c){var b=
new Map;b.set(0,c.acquire(a,"color"));b.set(3,c.acquire(a,"depthShadowMap"));b.set(2,c.acquire(a,"normal"));b.set(1,c.acquire(a,"depth"));b.set(4,c.acquire(a,"highlight"));return b};a.releaseMaterials=function(a,c){c.release(a.id,"color");c.release(a.id,"depthShadowMap");c.release(a.id,"normal");c.release(a.id,"depth");c.release(a.id,"highlight")};a.calculateTransformRelToOrigin=function(a,c,b){var e=a.origin.vec3;d.setMatrixTranslation3(l,-e[0],-e[1],-e[2]);m.mat4.multiply(c,l,a.transformation);
b&&(m.mat4.invert(b,c),m.mat4.transpose(b,b))};var l=k.mat4f64.create()})},"esri/views/3d/webgl-engine/shaders/HUDPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(a){return h.glslifyDefineMap({OCCL_TEST:a.occlTest,SIGNED_DISTANCE_FIELD:a.sdf,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,
CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:a.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:a.binaryHighlightOcclusion,SLICE:a.slice})};a.colorPass={name:"hud-color",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/hud/hud.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/hud/colorPass.frag")}},attributes:m.Default3D};a.highlightPass={name:"hud-highlight",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/hud/hud.vert"),
fragmentShader:d(a)+k.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:m.Default3D};a.occlusionPass={name:"hud-occlusion",shaders:function(a){return{vertexShader:h.glslifyDefineMap({VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,SLICE:a.slice})+k.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:k.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:m.Default3D}})},"esri/views/support/index":function(){define(["require",
"exports","./Scheduler"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.noBudget=m.noBudget;a.Task=m.Task})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../../support/index".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(){var b=null!==a&&a.apply(this,arguments)||this;b.idHint="__labeler";b._dirty=!1;b.labels=new Map;b.labelsToAdd=new Map;b.labelsToRemove=new Map;b.labelingContexts=[];return b}m(g,a);g.prototype.setup=function(){var b=this;this.handles||(this.handles=new f,this.handles.add([this.view.watch("state.camera",function(){return b.setDirty()}),this.view.watch("pixelRatio",
function(){return b.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new E.default({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new x(this.view._stage),this.calloutMaterialCollection=new x(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(B.Task.LABELER,function(a){return b.update(a)},function(){return b.needsUpdate()}))};g.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&
(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};g.prototype.isActiveLabelingContext=function(b){return b.active&&this.labelsEnabled(b)};g.prototype.activateLabelingContext=function(b){var a=
this;b.labels.forEach(function(b,c){a.labels.set(c,b);b.graphics3DGraphic.setVisibilityFlag(0,!0,1)});b.active=!0};g.prototype.deactivateLabelingContext=function(b){var a=this;b.labels.forEach(function(b,c){b.graphics3DGraphic.setVisibilityFlag(0,!1,1);b.rendered&&a.labelsToRemove.set(c,b);a.labels.delete(c);a.labelsToAdd.delete(c)});b.active=!1};g.prototype.addLabelTextureToAtlas=function(b){for(var a=0;a<b.graphics3DGraphic._labelGraphics.length;a++){var c=b.graphics3DGraphic._labelGraphics[a];
if(c._labelClass){var d=b.textRenderers[c._labelIndex];d&&this.textTextureAtlas.addTextTexture(d,c.stageObject)}}b.rendered=!0};g.prototype.removeLabelTextureFromAtlas=function(b){for(var a=b.graphics3DGraphic,c=0;c<a._labelGraphics.length;c++){var d=a._labelGraphics[c];d._labelClass&&(d=b.textRenderers[d._labelIndex])&&this.textTextureAtlas.removeTextTexture(d,a._labelGraphics[c].stageObject)}b.rendered=!1};g.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};g.prototype.update=
function(b){for(var a=this,c=this._dirty=!1,d=function(d){if(!e.isActiveLabelingContext(d))return"continue";if(!e.hasValidLabelClassContext(d)){if(e.hasInvalidLabelClassContext(d))return e.deactivateLabelingContext(d),"continue";e.createLabelClassContext(d);if(e.hasPendingLabelClassContext(d))return e._dirty=!0,"continue";if(!e.hasValidLabelClassContext(d))return"continue"}d.labelsToInitialize.forEach(function(e,f){a.ensureGraphics3DResources(e)&&(a.labels.set(f,e),c=!0);(e.visible&&e.hasTextTextureResources||
!e.visible&&e.hasGraphics3DResources)&&d.labelsToInitialize.delete(f);b&&(b.madeProgress(),b.done&&(a._dirty=!0))})},e=this,f=0,g=this.labelingContexts;f<g.length;f++)d(g[f]);b&&c&&this.view.deconflictor.setDirty();this.labelsToRemove.forEach(function(b){return a.removeLabelTextureFromAtlas(b)});this.labelsToRemove.clear();this.labelsToAdd.forEach(function(b){return a.addLabelTextureToAtlas(b)});this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")};g.prototype.hasPendingLabelClassContext=
function(b){return b.labelClassPromise&&!!b.labelClassAbortController};g.prototype.hasValidLabelClassContext=function(b){return b.labelClassContexts&&b.labelClassContexts.length};g.prototype.hasInvalidLabelClassContext=function(b){return null===b.labelClassContexts};g.prototype.createLabelClassContextAsync=function(a){return d(this,void 0,void 0,function(){var c,e,f,g,p,k=this;return h(this,function(m){switch(m.label){case 0:return c=a.labelClassAbortController.signal,[4,a.layer.when()];case 1:m.sent();
b.throwIfAborted(c);a.scaleVisibility&&a.scaleVisibility.updateScaleRangeActive();e=a.graphics3DCore;f=e.layer;g=f.labelingInfo&&f.labelingInfo.filter(function(b){return!!b.symbol});if(!g||0===g.length)return[2,null];p=Array(g.length);return[4,l.forEach(g,function(f,g){return d(k,void 0,void 0,function(){var d,k,m,t;return h(this,function(h){switch(h.label){case 0:return d=f.symbol,k=u.getGraphics3DSymbol(e.getOrCreateGraphics3DSymbol(d)),[4,k.load()];case 1:h.sent();b.throwIfAborted(c);m=null;if(!r.isCalloutSupport(d)||
!d.hasVisibleCallout())return[3,3];m=w.make(d,e.symbolCreationContext);return[4,m.load()];case 2:h.sent(),b.throwIfAborted(c),h.label=3;case 3:return[4,l.result(q.createLabelFunction(f,a.layer.fields.map(function(b){return b.toJSON()}),this.view.spatialReference))];case 4:return t=h.sent(),b.throwIfAborted(c),!0===t.ok&&(p[g]={labelClass:f,labelFunction:t.value,graphics3DSymbol:k,graphics3DCalloutSymbolLayer:m,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(k.symbol)}),
[2]}})})})];case 2:return m.sent(),b.throwIfAborted(c),a.labelClassContexts=p,[2]}})})};g.prototype.createLabelClassContext=function(a){return d(this,void 0,void 0,function(){var c=this;return h(this,function(d){a.labelClassPromise||(a.labelClassPromise=this.createLabelClassContextAsync(a).catch(function(c){if(b.isAbortError(c))throw c;a.labelClassContexts=null}).then(function(){a.labelClassAbortController=null;c.notifyChange("updating")}),this.notifyChange("updating"));return[2,a.labelClassPromise]})})};
g.prototype.createTextRenderParameters=function(b){return(b=b.symbolLayers.getItemAt(0))&&"text"===b.type?A.default.fromSymbol(b,this.view.pixelRatio):null};g.prototype.destroyLabelClassContext=function(a){for(var c=0,d=a.labelClassContexts;c<d.length;c++){var e=d[c];--e.graphics3DSymbol.referenced;e.graphics3DSymbol=null}c=a.labelClassAbortController;a.labelClassAbortController=b.createAbortController();c&&c.abort();a.labelClassContexts=[];a.labelClassPromise=null;this.notifyChange("updating")};
g.prototype.createTextSymbolGraphic=function(b,a,c,d,e){b={text:b.text,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:y.LABELS_SHOW_BORDER,displayWidth:b.displayWidth,displayHeight:b.displayHeight};G.graphic=a;G.renderingInfo=null;G.layer=d;return e.createLabel(G,b,this.hudMaterialCollection,this.textTextureAtlas)};g.prototype.createLineCalloutGraphic=
function(b,a,c,d,e){a={symbol:a,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};G.graphic=b;G.renderingInfo=a;G.layer=e;return c.createGraphics3DGraphic(G)};g.prototype.ensureGraphics3DResources=function(b){var a=b.graphics3DGraphic;if(a.destroyed||b.hasGraphics3DResources)return!1;this.ensureTextTextureResources(b);var d=b.labelingContext,e=
!1,f=a.graphic,g=d.labelClassContexts,l=d.layer,h=this.labelsEnabled(d);if(!g||0===g.length||!a._graphics[0])return!1;for(var p=0;p<g.length;p++){var k=g[p],q=k.labelClass,m=b.textRenderers[p];if(m){var t=k.graphics3DSymbol,u=null;t.symbol&&"label-3d"===t.symbol.type&&(u=t.symbol);var r=t.symbolLayers[0],t=v.get({graphics3DGraphic:a,labelSymbol:u,labelClass:k.labelClass});if(r&&!c.isNone(t)){if(e=this.createTextSymbolGraphic(m,f,t,l,r)){if(e._labelClass=q,e._labelIndex=p,a.addLabelGraphic(e,d.stageLayer,
this.view._stage),a.setVisibilityFlag(0,h,1),a.clearVisibilityFlag(1,1),a.setVisibilityFlag(3,!1,1),e=!0,k.graphics3DCalloutSymbolLayer&&t.hasLabelVerticalOffset&&(f=this.createLineCalloutGraphic(f,u,k.graphics3DCalloutSymbolLayer,t,l)))k.calloutSymbolLayerIndex=a._labelGraphics.length,a.addLabelGraphic(f,d.stageLayer,this.view._stage)}else return!1;break}}}d.scaleVisibility&&e&&d.scaleVisibility.updateGraphicLabelScaleVisibility(a);return b.hasGraphics3DResources=!0};g.prototype.destroyGraphics3DResources=
function(b){for(var a=b.labelingContext.labelClassContexts,c=0,d=b.graphics3DGraphic._labelGraphics;c<d.length;c++){var e=d[c];if(null!=e._labelClass){var f=a[e._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=f)f.onRemoveGraphic(e)}}b.graphics3DGraphic.clearLabelGraphics();b.hasGraphics3DResources=!1};g.prototype.ensureTextTextureResources=function(b){if(!b.hasTextTextureResources){var a=b.labelingContext,d=a.labelClassContexts,e=b.graphics3DGraphic.graphic;if(d&&0!==d.length){for(var f=0;f<
d.length;f++){var g=d[f];b.textRenderers[f]=null;if(g.textRenderParameters){var l=g.labelFunction,h=void 0;if("arcade"===l.type){var k=p.hydrateGraphic(e,a.layer);try{h=l.evaluate(k)}catch(U){h=null}}else h=l.evaluate(e);c.isNone(h)||""===h||(b.textRenderers[f]=new z.default(h,g.textRenderParameters))}}b.hasTextTextureResources=!0}}};g.prototype.destroyTextTextureResources=function(b){b.textRenderers=[];b.hasTextTextureResources=!1};g.prototype.addGraphic=function(b,a){var c={hasGraphics3DResources:!1,
hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:b,graphics3DGraphic:a,textRenderers:[]};a=a.graphic.uid;b.labels.set(a,c);this.isActiveLabelingContext(b)&&this.hasValidLabelClassContext(b)&&this.ensureGraphics3DResources(c)?this.labels.set(a,c):b.labelsToInitialize.set(a,c);this.setDirty(b.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};g.prototype.removeGraphic=function(b,a){a=a.graphic.uid;var c=b.labels.get(a);c&&(this.destroyGraphic(c,a),b.labels.delete(a),b.labelsToInitialize.delete(a),
this.setDirty(b.graphics3DCore.asyncUpdates),this.view.deconflictor.setDirty())};g.prototype.labelsEnabled=function(b){return!0===b.layer.labelsVisible&&null!=b.layer.labelingInfo&&0<b.layer.labelingInfo.length};g.prototype.destroyGraphic=function(b,a){this.labels.has(a)&&(this.labels.delete(a),this.labelsToAdd.delete(a),this.labelsToRemove.delete(a));b.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(b),this.destroyTextTextureResources(b));b.hasGraphics3DResources&&this.destroyGraphics3DResources(b)};
g.prototype.labelingInfoChange=function(b,a){return d(this,void 0,void 0,function(){var c,d,e,f;return h(this,function(g){if(a){c=0;for(d=a;c<d.length;c++)if(e=d[c],f=b.labels.get(e))this.removeGraphic(b,f.graphics3DGraphic),this.addGraphic(b,f.graphics3DGraphic);return[2]}this.visibilityInfoChange(b);this.resetLabels(b);return[2,this.createLabelClassContext(b)]})})};g.prototype.globalPropertyChanged=function(b,a){for(var d=function(d){var e=new Map;a.labels.forEach(function(b){b=b.graphics3DGraphic;
e.set(b.graphic.uid,b)});c.expect(d.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(b,e,function(b){return b._labelGraphics[0]});d.graphics3DCalloutSymbolLayer&&d.graphics3DCalloutSymbolLayer.globalPropertyChanged(b,e,function(b){return b._labelGraphics[d.calloutSymbolLayerIndex]})},e=0,f=a.labelClassContexts;e<f.length;e++)d(f[e])};g.prototype.visibilityInfoChange=function(b){var a=b.layer.labelsVisible;a&&!b.active&&this.activateLabelingContext(b);!a&&b.active&&this.deactivateLabelingContext(b);
this.setDirty(b.graphics3DCore.asyncUpdates)};g.prototype.resetAllLabels=function(){for(var b=0,a=this.labelingContexts;b<a.length;b++)this.resetLabels(a[b])};g.prototype.resetLabels=function(b){var a=this;b.labels.forEach(function(c,d){a.destroyGraphic(c,d);c.visible=!1;c.rendered=!1;b.labelsToInitialize.set(d,c)});this.destroyLabelClassContext(b);this.setDirty(b.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};g.prototype.findLabelingContext=function(b){for(var a=0,c=this.labelingContexts;a<
c.length;a++){var d=c[a];if(d.graphics3DCore===b)return d}return null};g.prototype.addGraphicsOwner=function(a,c){var d=this;if(!this.findLabelingContext(a)){var e=a.layer,f={graphics3DCore:a,layer:e,scaleVisibility:c,active:a.layer.labelsVisible,labelClassPromise:null,labelClassAbortController:b.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new t(this.idHint+"_"+e.uid,{isPickable:!0},e.uid)};this.view._stage.add(0,f.stageLayer);this.view._stage.addToViewContent([f.stageLayer.id]);
this.labelingContexts.push(f);this.setDirty();return{addGraphic:function(b){return d.addGraphic(f,b)},removeGraphic:function(b){return d.removeGraphic(f,b)},featureReductionChange:function(){},layerLabelsEnabled:function(){return d.labelsEnabled(f)},labelingInfoChange:function(b){return d.labelingInfoChange(f,b)},elevationInfoChange:function(){return d.globalPropertyChanged("elevationInfo",f)},slicePlaneEnabledChange:function(){return d.globalPropertyChanged("slicePlaneEnabled",f)},visibilityInfoChange:function(){return d.visibilityInfoChange(f)},
reset:function(){return d.resetLabels(f)},clear:function(){},processStageDirty:function(){return d.view._stage.processDirtyLayer(f.stageLayer.id)}}}};g.prototype.removeGraphicsOwner=function(b){var a=this,c=this.findLabelingContext(b);c&&(b=this.labelingContexts.indexOf(c),this.labelingContexts.splice(b,1),c.labels.forEach(function(b){return a.removeGraphic(c,b.graphics3DGraphic)}),b=c.stageLayer.id,this.view._stage.removeFromViewContent([b]),this.view._stage.remove(0,b),c.stageLayer=null,this.setDirty())};
g.prototype.setLabelGraphicVisibility=function(b,a){b=b.graphic.uid;var c=this.labels.get(b);c&&(a&&!c.rendered?(this.labelsToAdd.set(b,c),this.labelsToRemove.delete(b),c.hasTextTextureResources||c.labelingContext.labelsToInitialize.set(b,c)):!a&&c.rendered&&(this.labelsToRemove.set(b,c),this.labelsToAdd.delete(b)),c.visible=a,this.setDirty(c.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(g.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty},
enumerable:!0,configurable:!0});g.prototype.setDirty=function(b){void 0===b&&(b=!0);var a=this._dirty;this._dirty||(this._dirty=!0);b||this.update(null);a!==this._dirty&&this.notifyChange("updating")};Object.defineProperty(g.prototype,"updating",{get:function(){var b=this;return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.labelingContexts.some(function(a){return b.hasPendingLabelClassContext(a)})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"test",
{get:function(){return{textTextureAtlas:this.textTextureAtlas}},enumerable:!0,configurable:!0});k([e.property({constructOnly:!0})],g.prototype,"view",void 0);k([e.property()],g.prototype,"textTextureAtlas",void 0);k([e.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating"]})],g.prototype,"updating",null);return g=k([e.subclass("esri.views.3d.layers.graphics.Labeler")],g)}(e.declared(g));a.Labeler=n;var G={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/Logger ../../core/promiseUtils ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ../../support/arcadeOnDemand".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(){return d(this,void 0,void 0,function(){return h(this,function(b){return[2,f.create(function(b){n(["../../core/sql/WhereClause"],b)})]})})}function w(a,d,e,f){a=p.getField(f,a);if(!a)return d;if(null==e[a.name])return"";if(d=a.domain)if("codedValue"===d.type||"coded-value"===d.type){f=e[a.name];var g=0;for(d=d.codedValues;g<d.length;g++){var l=d[g];if(l.code===f)return l.name}}else if("range"===d.type&&(f=+e[a.name],g="range"in d?d.range[1]:d.maxValue,
("range"in d?d.range[0]:d.minValue)<=f&&f<=g))return d.name;e=e[a.name];"date"===a.type||"esriFieldTypeDate"===a.type?e=c.formatDate(e,c.convertDateFormatToIntlOptions("short-date")):p.isNumericField(a)&&(e=b.formatNumber(+e));return e?e:""}Object.defineProperty(a,"__esModule",{value:!0});var u=l.getLogger("esri.layers.support.labelFormatUtils"),v={type:"simple",evaluate:function(b){return null}};a.createLabelFunction=function(b,a,c){return d(this,void 0,void 0,function(){var d,f,l,p,k,m,t,x;return h(this,
function(h){switch(h.label){case 0:if(!b||!b.symbol)return[2,v];d=b.where;f=b.getLabelExpression();return d?[4,r()]:[3,2];case 1:return p=h.sent(),[3,3];case 2:p=null,h.label=3;case 3:return l=p,"arcade"!==f.type?[3,5]:[4,q.createLabelExpression(f.expression,c,a)];case 4:return m=h.sent(),k={type:"arcade",evaluate:function(b){try{var a=m.evaluate({$feature:m.repurposeFeature(b)});if(null!=a)return a.toString()}catch(M){u.error(new g("bad-arcade-expression","Encountered an error when evaluating label expression for feature",
{feature:b,expression:f}))}return null}},[3,6];case 5:k={type:"simple",evaluate:function(b){var c=b&&b.attributes;return c?f.expression.replace(/{[^}]*}/g,function(b){return w(b.slice(1,-1),b,c,a)}):null}},h.label=6;case 6:if(d){try{t=l.WhereClause.create(d,new e(a))}catch(I){return[2,v]}x=k.evaluate;k.evaluate=function(b){return t.testFeature(b)?x(b):null}}return[2,k]}})})};a.formatField=w})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=m.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");a.make=function(a,f){if(!k.isCalloutSupport(a))return d.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+a.type+"' does not support callouts"),null;if(!a.callout)return null;var c=g[a.callout.type];return c?new c(a,f):
(d.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+a.callout.type),null)};var g={line:h.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v){Object.defineProperty(a,"__esModule",{value:!0});var y,t,x=u.VertexAttrConstants;n=function(a){function e(b,c){b=a.call(this,b,null,c,!0)||this;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return b}m(e,a);e.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return k(this,function(b){this._material=new v(this.materialParameters,this._getIdHint("_lineCallout_common"));this._context.stage.add(3,this._material);
return[2]})})};e.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};e.prototype.perInstanceMaterialParameters=function(b){var a=this.materialParameters;a.screenOffset=b.screenOffset||[0,0];a.centerOffsetUnits=b.centerOffsetUnits||"world";return a};Object.defineProperty(e.prototype,"materialParameters",{get:function(){var b=this.symbol,a=b.callout,c=g.isSome(a.color)?d.toUnitRGBA(a.color):[0,0,0,0];c[3]*=
this._getLayerOpacity();var e=l.pt2px(a.size||0),f=null;if(b.verticalOffset)var f=b.verticalOffset,h=f.minWorldLength,p=f.maxWorldLength,f={screenLength:l.pt2px(f.screenLength),minWorldLength:h||0,maxWorldLength:null!=p?p:Infinity};a=g.isSome(a.border)&&g.isSome(a.border.color)?d.toUnitRGBA(a.border.color):null;h="object"===b.symbolLayers.getItemAt(0).type;return{color:c,size:e,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:a,occlusionTest:!h,shaderPolygonOffset:h?0:void 0,depthHUDAlignStart:"label-3d"===b.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});e.prototype._defaultElevationInfoNoZ=function(){return E};e.prototype.createGraphics3DGraphic=function(b){var a=b.renderingInfo;b=b.graphic;var c=this.getGraphicElevationContext(b,a.elevationOffset||0),d=a.symbol,e="on-the-ground"===this._elevationContext.mode&&("cim"===
d.type||!d.symbolLayers.some(function(b){return"object"===b.type||"text"===b.type}));if("label-3d"!==d.type&&e)return null;d=p.computeCentroid(b.geometry);return g.isNone(d)?null:this._createAs3DShape(b,d,c,a,"graphic"+b.uid,b.uid)};e.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};e.prototype.layerElevationInfoChanged=function(a,c,d){var f=this;d=b.elevationModeChangeUpdateType(e.elevationModeChangeTypes,d,this._elevationContext.mode);
if(d!==b.SymbolUpdateType.UPDATE)return d;a.forEach(function(b){var a=c(b);g.isSome(a)&&f.updateGraphicElevationContext(b.graphic,a)});return d};e.prototype.slicePlaneEnabledChanged=function(b,a){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};e.prototype.physicalBasedRenderingChanged=function(b,a){return!0};e.prototype.pixelRatioChanged=function(b,a){return!0};e.prototype.getGraphicElevationContext=function(b,c){void 0===c&&(c=0);b=a.prototype.getGraphicElevationContext.call(this,
b);b.addOffsetRenderUnits(c);return b};e.prototype.updateGraphicElevationContext=function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);c.needsElevationUpdates=b.needsElevationUpdates2D(a.mode)};e.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:q.emptySymbolComplexity.memory}};e.prototype.createVertexData=function(b){var a,c=b.translation;b=b.centerOffset;if(!c&&!b)return z;c=c?{size:3,
data:[c[0],c[1],c[2]]}:z[x.POSITION];b=b?{size:4,data:[b[0],b[1],b[2],b[3]]}:z[x.AUXPOS1];return a={},a[x.POSITION]=c,a[x.NORMAL]=z[x.NORMAL],a[x.AUXPOS1]=b,a};e.prototype.getOrCreateMaterial=function(b,a){var c=this.perInstanceMaterialParameters(b),d=v.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(b.materialCollection){var e=b.materialCollection.getMaterial(d);e||(e=new v(c,a+"_lineCallout_shared"),b.materialCollection.addMaterial(d,
e));return{material:e,isUnique:!1}}e=new v(c,a+"_lineCallout_unique");return{material:e,isUnique:!0}};e.prototype._createAs3DShape=function(a,d,e,g,l,h){a=new w.GeometryData(this.createVertexData(g),A,w.GeometryData.DefaultOffsets,"point");a=[new r(a,l)];var p=this.getOrCreateMaterial(g,l);l=b.createStageObjectForPoint(this._context,d,a,[p.material],null,null,e,l,this._context.layer.uid,h,!0);if(null===l)return null;h=new c(this,l.object,a,p.isUnique?[p.material]:null,null,f.perObjectElevationAligner,
e);h.metadata={elevationOffset:g.elevationOffset||0};h.alignedTerrainElevation=l.terrainElevation;h.needsElevationUpdates=b.needsElevationUpdates2D(e.mode);b.extendPointGraphicElevationContext(h,d,this._context.elevationProvider);return h};e.elevationModeChangeTypes={definedChanged:b.SymbolUpdateType.UPDATE,staysOnTheGround:b.SymbolUpdateType.UPDATE,onTheGroundChanged:b.SymbolUpdateType.RECREATE};return e}(e.Graphics3DSymbolLayer);a.Graphics3DLineCalloutSymbolLayer=n;var z=(y={},y[x.POSITION]={size:3,
data:[0,0,0]},y[x.NORMAL]={size:3,data:[0,0,1]},y[x.AUXPOS1]={size:4,data:[0,0,0,1]},y);y=new Uint32Array([0]);var A=(t={},t[x.POSITION]=y,t[x.NORMAL]=y,t[x.AUXPOS1]=y,t),E={mode:"relative-to-ground",offset:0};a.default=n})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});var p=e.VertexAttrConstants,q=new g,r=d.vec3f64.create(),w=d.vec3f64.create(),u=d.vec3f64.create(),v=k.mat4f64.create(),y=d.vec3f64.create(),t={verticalDistanceToGround:0,terrainElevation:0};a.perVertexElevationAligner=function(b,d,e,f){b=b.stageObject;q.spatialReference=e.spatialReference;for(var g=b.geometryRecords,h=g.length,k="absolute-height"!==d.mode,m=0,x=0;x<h;x++){var v=g[x].geometry,z=g[x].getShaderTransformation();
w[0]=z[12];w[1]=z[13];w[2]=z[14];v.invalidateBoundingInfo();for(var z=v.data.getVertexAttr(),y=z[p.POSITION],v=y.data,z=z.mapPos.data,y=y.size,A=v.length/y,n=0,E=0,B=!1,U=0,P=0;P<A;P++){q.x=z[E++];q.y=z[E++];q.z=z[E++];u[0]=v[n];u[1]=v[n+1];u[2]=v[n+2];var V=l.computeElevation(e,q,d,f,k?t:null);k&&(U+=t.terrainElevation);r[0]=v[n]+w[0];r[1]=v[n+1]+w[1];r[2]=v[n+2]+w[2];f.setAltitude(V,r);v[n]=r[0]-w[0];v[n+1]=r[1]-w[1];v[n+2]=r[2]-w[2];if(c.TESTS_DISABLE_UPDATE_THRESHOLDS)B=!0;else if(V=a.updateThresholdInMeters/
f.unitInMeters,Math.abs(u[0]-v[n])>=V||Math.abs(u[1]-v[n+1])>=V||Math.abs(u[2]-v[n+2])>=V)B=!0;n+=y}m+=U/A;B&&b.geometryVertexAttrsUpdated(x)}return m/h};a.perObjectElevationAligner=function(d,e,g,p,k){d=d.stageObject;var q=e.centerPointInElevationSR,u=0;k=0;if(d.metadata.usesVerticalDistanceToGround)u=l.computeElevation(g,q,e,p,t),f.updateVertexAttributeAuxpos1w(d,t.verticalDistanceToGround),k=t.terrainElevation;else{var w="absolute-height"!==e.mode,u=l.computeElevation(g,q,e,p,w?t:null);w&&(k=t.terrainElevation)}e=
m.mat4.copy(x,d.objectTransformation);g=h.vec3.set(y,e[12],e[13],e[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(r[0]=q.x,r[1]=q.y,r[2]=u,b.computeLinearTransformation(q.spatialReference,r,e,p.spatialReference)&&(d.objectTransformation=e)):p.setAltitudeOfTransformation(u,e);p=a.updateThresholdInMeters/p.unitInMeters;if(Math.abs(e[12]-g[0])>=p||Math.abs(e[13]-g[1])>=p||Math.abs(e[14]-g[2])>=p)d.objectTransformation=e;return k};var x=k.mat4f64.create();a.perLodInstanceElevationAligner=function(d,
e,f,g,p){var k=e.centerPointInElevationSR,q=0;p=0;var m="absolute-height"!==e.mode,q=l.computeElevation(f,k,e,g,m?t:null);m&&(p=t.terrainElevation);e=d.graphics3DSymbolLayer.lodRenderer.instanceData;d=d.instanceIndex;e.getGlobalTransform(d,v);f=h.vec3.set(y,v[12],v[13],v[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(r[0]=k.x,r[1]=k.y,r[2]=q,b.computeLinearTransformation(k.spatialReference,r,v,g.spatialReference)&&e.setGlobalTransform(d,v)):g.setAltitudeOfTransformation(q,v);g=a.updateThresholdInMeters/
g.unitInMeters;(Math.abs(v[12]-f[0])>=g||Math.abs(v[13]-f[1])>=g||Math.abs(v[14]-f[2])>=g)&&e.setGlobalTransform(d,v);return p};a.updateThresholdInMeters=.01;a.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){function q(b,a,c,d,e){var f=a.z||0,g=c.featureExpressionInfoContext;switch(c.mode){case "on-the-ground":return c=b.getElevation(a,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=c),c;case "relative-to-ground":return b=b.getElevation(a,"ground")||0,c=c.calculateOffsetRenderUnits(d),null==g&&(c+=f),e&&(e.verticalDistanceToGround=c,e.terrainElevation=b),c+b;case "relative-to-scene":return b=b.getElevation(a,"scene")||0,c=c.calculateOffsetRenderUnits(d),
e&&(e.verticalDistanceToGround=c,e.terrainElevation=b),c+b;case "absolute-height":return c=c.calculateOffsetRenderUnits(d),null==g&&(c+=f),e&&(b=b.getElevation(a,"ground")||0,e.verticalDistanceToGround=c-b,e.terrainElevation=b),c;default:k.neverReached(c.mode)}return 0}function r(b,a,c,d,e,f,g,l){var h=l.mode,p=0,k=0,q=0;g=l.calculateOffsetRenderUnits(g);l=l.featureExpressionInfoContext;E.spatialReference=b.spatialReference;c*=3;e*=3;for(var m=0;m<f;++m){E.x=a[c+0];E.y=a[c+1];E.z=a[c+2];switch(h){case "on-the-ground":k=
p=b.getElevation(E)||0;q+=p;break;case "relative-to-ground":p=b.getElevation(E)||0;k=p+g;null==l&&(k+=E.z);q+=p;break;case "relative-to-scene":p=b.getElevation(E,"scene")||0;k=p+g;q+=p;break;case "absolute-height":k=g,null==l&&(k+=E.z)}d[e+0]=a[c+0];d[e+1]=a[c+1];d[e+2]=k;c+=3;e+=3}return{terrainElevation:q/f}}function w(b,a){b=f.pathsToTriangulationInfo(b,a);return{vertexData:b.position,polygons:b.polygons,outlines:b.outlines}}function u(b,a,c,d,e){a*=3;d*=3;for(var f=0;f<e;++f)c[d++]=b[a++],c[d++]=
b[a++],c[d++]=b[a++]}function v(b,a,c,d,f,g,l){return e.bufferToBuffer(b,c,a,d,g,f,l)}function y(b,a,c){e.pointToVector(b,a,c)}function t(b,a){return!(b[0]>a[3]||b[0]<a[0]||b[1]>a[4]||b[1]<a[1])}function x(b,a){return!(a[0]>b[3]||a[3]<b[0]||a[1]>b[4]||a[4]<b[1])}Object.defineProperty(a,"__esModule",{value:!0});var z=g.vec3f64.create(),A=d.mat4f64.create(),E=c.makeDehydratedPoint(0,0,0,null);a.createStageObjectForPoint=function(a,c,d,f,g,l,k,m,u,r,x,w){var v=d?d.length:0,n=a.clippingExtent;y(c,z,a.elevationProvider.spatialReference);
if(n&&!t(z,n))return null;y(c,z,a.renderSpatialReference);n=a.localOriginFactory.getOrigin(z);m=new p({castShadow:!1,metadata:{layerUid:u,graphicUid:r,usesVerticalDistanceToGround:!!x},idHint:m});for(u=0;u<v;u++)m.addGeometry(d[u],f[u],g?g[u]:A,l,n,w);d=a.renderSpatialReference;f=a.elevationProvider;g=a.renderCoordsHelper;a=0;var E;m.metadata.usesVerticalDistanceToGround?(a=q(f,c,k,g,F),b.updateVertexAttributeAuxpos1w(m,F.verticalDistanceToGround),E=F.terrainElevation):(l="absolute-height"!==k.mode,
a=q(f,c,k,g,l?F:null),l&&(E=F.terrainElevation));k=h.mat4.copy(B,m.objectTransformation);z[0]=c.x;z[1]=c.y;z[2]=a;e.computeLinearTransformation(c.spatialReference,z,k,d)?m.objectTransformation=k:console.warn("Could not locate symbol object properly, it might be misplaced");return{object:m,terrainElevation:E}};a.extendPointGraphicElevationContext=function(b,a,d){b=b.elevationContext;d=d.spatialReference;y(a,z,d);b.centerPointInElevationSR=c.makeDehydratedPoint(z[0],z[1],a.hasZ?z[2]:0,d)};a.placePointOnGeometry=
function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return b.computeCentroid(a);case "polyline":var d=a.paths[0];if(!d||0===d.length)break;d=l.getPointOnPath(d,l.getPathLength(d)/2);return c.makeDehydratedPoint(d[0],d[1],d[2],a.spatialReference);case "mesh":return a.extent.center}return null};a.computeElevation=q;a.applyElevation=r;var B=d.mat4f64.create();a.copyPathData=w;a.copyVertices=u;a.applyOrigin=function(b,a,c,d){var e=Math.floor(a+(c-1)/2);d[0]=b[3*e+0];d[1]=b[3*
e+1];d[2]=b[3*e+2];a*=3;for(e=0;e<c;++e)b[a++]-=d[0],b[a++]-=d[1],b[a++]-=d[2]};a.setZ=function(b,a,c,d){a*=3;for(var e=0;e<c;++e)b[a+2]=d,a+=3};a.offsetZ=function(b,a,c,d){a*=3;for(var e=0;e<c;++e)b[a+2]+=d,a+=3};a.scaleZ=function(b,a,c,d){a*=3;for(var e=0;e<c;++e)b[a+2]*=d,a+=3};a.flatArrayToArrayOfArrays=function(b,a,c){var d=[];a*=3;for(var e=0;e<c;++e)d.push([b[a++],b[a++],b[a++]]);return d};a.reproject=v;a.reprojectPoint=y;a.getGeometryVertexData3D=function(b,a,c,d,e,f,g){var l=e.spatialReference;
b=w(b,a);a=b.vertexData;var h=a.length/3,p=new Float64Array(a.length),k=!0;c.equals(l)?u(a,0,p,0,a.length):k=v(a,0,c,p,0,l,h);c=r(e,p,0,a,0,h,f,g);l.equals(d)||v(a,0,l,a,0,d,h);return{geometryData:b,vertexData:a,projectionSuccess:k,eleVertexData:p,terrainElevation:c.terrainElevation}};a.getGeometryVertexDataDraped=function(b,a,c){b=w(b,!1);var d=b.vertexData,f=d.length/3,g=!0;a.equals(c)||(g=e.bufferToBuffer(d,a,0,d,c,0,f));return{geometryData:b,vertexData:d,projectionSuccess:g}};a.computeBoundingBox=
function(b,a,c,d){d[0]=Number.MAX_VALUE;d[1]=Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;a*=3;for(var e=0;e<c;++e){var f=b[a++],g=b[a++],l=b[a++];f<d[0]&&(d[0]=f);g<d[1]&&(d[1]=g);l<d[2]&&(d[2]=l);f>d[3]&&(d[3]=f);g>d[4]&&(d[4]=g);l>d[5]&&(d[5]=l)}return d};var G;(function(b){b[b.NONE=0]="NONE";b[b.UPDATE=1]="UPDATE";b[b.RECREATE=2]="RECREATE"})(G=a.SymbolUpdateType||(a.SymbolUpdateType={}));a.elevationModeChangeUpdateType=function(b,
a,c){return null==a||null==c?b.definedChanged:"on-the-ground"===a&&"on-the-ground"===c?b.staysOnTheGround:a===c||"on-the-ground"!==a&&"on-the-ground"!==c?G.UPDATE:b.onTheGroundChanged};a.getGeometryAsPolygon=function(b){switch(b.type){case "extent":return m.Polygon.fromExtent(b);case "polygon":return b}return null};a.getGeometryAsPoly=function(b){switch(b.type){case "extent":return m.Polygon.fromExtent(b);case "polygon":case "polyline":return b}return null};a.pointInBox2D=t;a.boxesIntersect2D=x;a.boundingBoxClipped=
function(b,a){return a?!x(b,a):!1};a.needsElevationUpdates2D=function(b){return"relative-to-ground"===b||"relative-to-scene"===b};a.needsElevationUpdates3D=function(b){return"absolute-height"!==b};var F={verticalDistanceToGround:0,terrainElevation:0}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut","./coordsUtils","./meshUtils/deduplicate"],function(n,a,m,k,h){function d(a,c,b){if(1===a.length)return a[0];c=new Float64Array(c);b=
new Uint32Array(b);for(var d=0,f=0,g=0,l=0;l<a.length;l++){for(var h=a[l],k=0;k<h.position.length;k++)c[d++]=h.position[k];for(k=0;k<h.faces.length;k++)b[f++]=h.faces[k]+g;g=d/3}return{position:c,faces:b}}function g(a,c){for(var b=a.length,d=Array(b),f=Array(b),g=Array(b),h=0,m=0,u=0,v=0,y=0;y<b;++y)v+=a[y].length;for(var v=new Float64Array(3*v),t=0,x=b-1;0<=x;x--){var z=a[x],A=!k.isClockwise(z,!1,!1);if(A&&1!==b)d[h++]=z;else{for(var n=z.length,y=0;y<h;++y)n+=d[y].length;y={index:t,pathLengths:Array(h+
1),count:n,holeIndices:Array(h)};y.pathLengths[0]=z.length;0<z.length&&(g[u++]={index:t,count:z.length});t=A?l(z,z.length-1,-1,v,t,z.length,c):l(z,0,1,v,t,z.length,c);for(z=0;z<h;++z)A=d[z],y.holeIndices[z]=t,y.pathLengths[z+1]=A.length,0<A.length&&(g[u++]={index:t,count:A.length}),t=l(A,0,1,v,t,A.length,c);h=0;0<y.count&&(f[m++]=y)}}for(z=0;z<h;++z)A=d[z],0<A.length&&(g[u++]={index:t,count:A.length}),t=l(A,0,1,v,t,A.length,c);m<b&&(f.length=m);u<b&&(g.length=u);return{position:v,polygons:f,outlines:g}}
function l(a,c,b,d,g,l,h){g*=3;for(var e=0;e<l;++e){var f=a[c];d[g++]=f[0];d[g++]=f[1];d[g++]=h?f[2]:0;c+=b}return g/3}Object.defineProperty(a,"__esModule",{value:!0});a.triangulate=function(a){var c=g(a.rings,a.hasZ),b=[],e=0,f=0;a=function(a){var d=a.index,g=new Float64Array(c.position.buffer,3*d*c.position.BYTES_PER_ELEMENT,3*a.count);a=a.holeIndices.map(function(b){return b-d});a=new Uint32Array(m(g,a,3));b.push({position:g,faces:a});e+=g.length;f+=a.length};for(var l=0,k=c.polygons;l<k.length;l++)a(k[l]);
a=d(b,e,f);l=h.default(a.position.buffer,6,a.faces);a.position=new Float64Array(l.buffer);a.faces=l.indices;return a};a.pathsToTriangulationInfo=g})},"esri/core/libs/earcut/earcut":function(){define([],function(){function n(b,c,e){e=e||2;var l=c&&c.length,h=l?c[0]*e:b.length,p=a(b,0,h,e,!0),q=[];if(!p||p.next===p.prev)return q;var t,u,x,w;if(l){var v=e,l=[],z,y,n;w=0;for(z=c.length;w<z;w++)y=c[w]*v,n=w<z-1?c[w+1]*v:b.length,y=a(b,y,n,v,!1),y===y.next&&(y.steiner=!0),l.push(f(y));l.sort(d);for(w=0;w<
l.length;w++){c=l[w];v=p;if(v=g(c,v))c=r(v,c),m(c,c.next);p=m(p,p.next)}}if(b.length>80*e){t=x=b[0];u=l=b[1];for(v=e;v<h;v+=e)w=b[v],c=b[v+1],w<t&&(t=w),c<u&&(u=c),w>x&&(x=w),c>l&&(l=c);x=Math.max(x-t,l-u);x=0!==x?1/x:0}k(p,q,e,t,u,x);return q}function a(b,a,c,d,f){var g;if(f===0<y(b,a,c,d))for(f=a;f<c;f+=d)g=w(f,b[f],b[f+1],g);else for(f=c-d;f>=a;f-=d)g=w(f,b[f],b[f+1],g);g&&e(g,g.next)&&(u(g),g=g.next);return g}function m(a,c){if(!a)return a;c||(c=a);var d;do if(d=!1,a.steiner||!e(a,a.next)&&0!==
b(a.prev,a,a.next))a=a.next;else{u(a);a=c=a.prev;if(a===a.next)break;d=!0}while(d||a!==c);return c}function k(a,d,f,g,w,v,y){if(a){if(!y&&v){var t=a,x=t;do null===x.z&&(x.z=l(x.x,x.y,g,w,v)),x.prevZ=x.prev,x=x.nextZ=x.next;while(x!==t);x.prevZ.nextZ=null;x.prevZ=null;var t=x,z,A,n,E,B,L,G=1;do{x=t;n=t=null;for(E=0;x;){E++;A=x;for(z=B=0;z<G&&(B++,A=A.nextZ,A);z++);for(L=G;0<B||0<L&&A;)0!==B&&(0===L||!A||x.z<=A.z)?(z=x,x=x.nextZ,B--):(z=A,A=A.nextZ,L--),n?n.nextZ=z:t=z,z.prevZ=n,n=z;x=A}n.nextZ=null;
G*=2}while(1<E)}for(t=a;a.prev!==a.next;){x=a.prev;A=a.next;if(v)n=h(a,g,w,v);else a:if(n=a,E=n.prev,B=n,G=n.next,0<=b(E,B,G))n=!1;else{L=z=n.next.next;for(var O=0;z!==n.prev&&(0===O||z!==L);){O++;if(c(E.x,E.y,B.x,B.y,G.x,G.y,z.x,z.y)&&0<=b(z.prev,z,z.next)){n=!1;break a}z=z.next}n=!0}if(n)d.push(x.i/f),d.push(a.i/f),d.push(A.i/f),u(a),t=a=A.next;else if(a=A,a===t){if(!y)k(m(a),d,f,g,w,v,1);else if(1===y){y=d;t=f;x=a;do A=x.prev,n=x.next.next,!e(A,n)&&p(A,x,x.next,n)&&q(A,n)&&q(n,A)&&(y.push(A.i/
t),y.push(x.i/t),y.push(n.i/t),u(x),u(x.next),x=a=n),x=x.next;while(x!==a);a=x;k(a,d,f,g,w,v,2)}else if(2===y)a:{y=a;do{for(t=y.next.next;t!==y.prev;){if(x=y.i!==t.i){x=y;A=t;n=void 0;if(n=x.next.i!==A.i&&x.prev.i!==A.i){n=void 0;b:{n=x;do{if(n.i!==x.i&&n.next.i!==x.i&&n.i!==A.i&&n.next.i!==A.i&&p(n,n.next,x,A)){n=!0;break b}n=n.next}while(n!==x);n=!1}n=!n}E=void 0;if(E=n&&q(x,A)&&q(A,x)){n=x;E=!1;B=(x.x+A.x)/2;A=(x.y+A.y)/2;do n.y>A!==n.next.y>A&&n.next.y!==n.y&&B<(n.next.x-n.x)*(A-n.y)/(n.next.y-
n.y)+n.x&&(E=!E),n=n.next;while(n!==x)}x=E}if(x){a=r(y,t);y=m(y,y.next);a=m(a,a.next);k(y,d,f,g,w,v);k(a,d,f,g,w,v);break a}t=t.next}y=y.next}while(y!==a)}break}}}}function h(a,d,e,f){var g=a.prev,h=a.next;if(0<=b(g,a,h))return!1;var p=g.x>a.x?g.x>h.x?g.x:h.x:a.x>h.x?a.x:h.x,k=g.y>a.y?g.y>h.y?g.y:h.y:a.y>h.y?a.y:h.y,q=l(g.x<a.x?g.x<h.x?g.x:h.x:a.x<h.x?a.x:h.x,g.y<a.y?g.y<h.y?g.y:h.y:a.y<h.y?a.y:h.y,d,e,f);d=l(p,k,d,e,f);e=a.prevZ;for(f=a.nextZ;e&&e.z>=q&&f&&f.z<=d;){if(e!==a.prev&&e!==a.next&&c(g.x,
g.y,a.x,a.y,h.x,h.y,e.x,e.y)&&0<=b(e.prev,e,e.next))return!1;e=e.prevZ;if(f!==a.prev&&f!==a.next&&c(g.x,g.y,a.x,a.y,h.x,h.y,f.x,f.y)&&0<=b(f.prev,f,f.next))return!1;f=f.nextZ}for(;e&&e.z>=q;){if(e!==a.prev&&e!==a.next&&c(g.x,g.y,a.x,a.y,h.x,h.y,e.x,e.y)&&0<=b(e.prev,e,e.next))return!1;e=e.prevZ}for(;f&&f.z<=d;){if(f!==a.prev&&f!==a.next&&c(g.x,g.y,a.x,a.y,h.x,h.y,f.x,f.y)&&0<=b(f.prev,f,f.next))return!1;f=f.nextZ}return!0}function d(b,a){return b.x-a.x}function g(b,a){var d=a,e=b.x,f=b.y,g=-Infinity,
l;do{if(f<=d.y&&f>=d.next.y&&d.next.y!==d.y){var h=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(h<=e&&h>g){g=h;if(h===e){if(f===d.y)return d;if(f===d.next.y)return d.next}l=d.x<d.next.x?d:d.next}}d=d.next}while(d!==a);if(!l)return null;if(e===g)return l.prev;a=l;for(var h=l.x,p=l.y,k=Infinity,m,d=l.next;d!==a;)e>=d.x&&d.x>=h&&e!==d.x&&c(f<p?e:g,f,h,p,f<p?g:e,f,d.x,d.y)&&(m=Math.abs(f-d.y)/(e-d.x),(m<k||m===k&&d.x>l.x)&&q(d,b)&&(l=d,k=m)),d=d.next;return l}function l(b,a,c,d,e){b=32767*(b-c)*e;a=32767*
(a-d)*e;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;return(b|b<<1)&1431655765|((a|a<<1)&1431655765)<<1}function f(b){var a=b,c=b;do{if(a.x<c.x||a.x===c.x&&a.y<c.y)c=a;a=a.next}while(a!==b);return c}function c(b,a,c,d,e,f,g,l){return 0<=(e-g)*(a-l)-(b-g)*(f-l)&&0<=(b-g)*(d-l)-(c-g)*(a-l)&&0<=(c-g)*(f-l)-(e-g)*(d-l)}function b(b,a,c){return(a.y-b.y)*(c.x-a.x)-(a.x-b.x)*(c.y-a.y)}function e(b,a){return b.x===a.x&&b.y===a.y}
function p(a,c,d,f){return e(a,c)&&e(d,f)||e(a,f)&&e(d,c)?!0:0<b(a,c,d)!==0<b(a,c,f)&&0<b(d,f,a)!==0<b(d,f,c)}function q(a,c){return 0>b(a.prev,a,a.next)?0<=b(a,c,a.next)&&0<=b(a,a.prev,c):0>b(a,c,a.prev)||0>b(a,a.next,c)}function r(b,a){var c=new v(b.i,b.x,b.y),d=new v(a.i,a.x,a.y),e=b.next,f=a.prev;b.next=a;a.prev=b;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function w(b,a,c,d){b=new v(b,a,c);d?(b.next=d.next,b.prev=d,d.next.prev=b,d.next=b):(b.prev=b,b.next=b);return b}function u(b){b.next.prev=
b.prev;b.prev.next=b.next;b.prevZ&&(b.prevZ.nextZ=b.nextZ);b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function v(b,a,c){this.i=b;this.x=a;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function y(b,a,c,d){for(var e=0,f=c-d;a<c;a+=d)e+=(b[f]-b[a])*(b[a+1]+b[f+1]),f=a;return e}n.deviation=function(b,a,c,d){var e=a&&a.length,f=Math.abs(y(b,0,e?a[0]*c:b.length,c));if(e)for(var e=0,g=a.length;e<g;e++)f-=Math.abs(y(b,a[e]*c,e<g-1?a[e+1]*c:b.length,c));for(e=a=0;e<d.length;e+=3){var g=
d[e]*c,l=d[e+1]*c,h=d[e+2]*c;a+=Math.abs((b[g]-b[h])*(b[l+1]-b[g+1])-(b[g]-b[l])*(b[h+1]-b[g+1]))}return 0===f&&0===a?0:Math.abs((a-f)/f)};n.flatten=function(b){for(var a=b[0][0].length,c={vertices:[],holes:[],dimensions:a},d=0,e=0;e<b.length;e++){for(var f=0;f<b[e].length;f++)for(var g=0;g<a;g++)c.vertices.push(b[e][f][g]);0<e&&(d+=b[e-1].length,c.holes.push(d))}return c};return n})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(n,
a,m){function k(a,g,l,f){void 0===f&&(f=0);var c=a.byteLength/(4*g),b=new Uint32Array(a,0,c*g);a=new Uint32Array(c);var d=Math.floor(1.1*c)+1;if(null==h||h.length<2*d)h=new Uint32Array(m.nextHighestPowerOfTwo(2*d));for(var p=0;p<2*d;p++)h[p]=0;for(var k=0,r=0!==f?Math.ceil(7.84*1.96/(f*f)*f*(1-f)):c,p=0;p<c;p++){if(p===r){var w=1-k/p;if(w+1.96*Math.sqrt(w*(1-w)/p)<f)return null;r*=2}for(var w=p*g,u,v=u=0;v<g;v++)u=b[w+v]+u|0,u=u+(u<<11)+(u>>>2)|0;u>>>=0;for(var v=u%d,y=k;0!==h[2*v+1];){if(h[2*v]===
u){var t=h[2*v+1]-1,x=t*g;a:{for(var z=0;z<g;z++)if(b[w+z]!==b[x+z]){x=!1;break a}x=!0}if(x){y=a[t];break}}v++;v>=d&&(v-=d)}y===k&&(h[2*v]=u,h[2*v+1]=p+1,k++);a[p]=y}if(0!==f&&1-k/c<f)return null;f=new Uint32Array(g*k);for(p=k=0;p<c;p++)if(a[p]===k){d=b;r=p*g;w=f;u=k*g;v=g;for(y=0;y<v;y++)w[u+y]=d[r+y];k++}if(l){g=new Uint32Array(l.length);for(p=0;p<g.length;p++)g[p]=a[l[p]];a=g}return{buffer:f.buffer,indices:a,uniqueCount:k}}Object.defineProperty(a,"__esModule",{value:!0});a.deduplicate=k;var h=
null;a.default=k})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../support/projectionUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){function u(b){var a=b.paths[0];if(!a||0===a.length)return null;a=q.getPointOnPath(a,q.getPathLength(a)/2);return r.makeDehydratedPoint(a[0],a[1],a[2],b.spatialReference)}function v(b,a,c){if(!a||!b)return b;c=c?b:r.clonePoint(b);return w.pointToPoint(b,c,a)?c:null}function y(b){if(Array.isArray(b)){for(var a=0;a<b.length;a++)if(!y(b[a]))return!1;return!0}return null==b||0<=b}Object.defineProperty(a,"__esModule",{value:!0});a.computeCentroid=function(b,a){if("point"===
b.type)return v(b,a,!1);if(r.isHydratedGeometry(b))switch(b.type){case "extent":return v(b.center,a,!1);case "polygon":return v(b.centroid,a,!1);case "polyline":return v(u(b),a,!0);case "mesh":return v(b.extent.center,a,!1)}else switch(b.type){case "extent":var c=m.isFinite(b.zmin);b=r.makeDehydratedPoint(.5*(b.xmax+b.xmin),.5*(b.ymax+b.ymin),c?.5*(b.zmax+b.zmin):void 0,b.spatialReference);return v(b,a,!0);case "polygon":return(c=b.rings[0])&&0!==c.length?(c=p.ringsCentroid(b.rings,b.hasZ),b=r.makeDehydratedPoint(c[0],
c[1],c[2],b.spatialReference)):b=null,v(b,a,!0);case "polyline":return v(u(b),a,!0)}};a.enlargeExtent=function(b,a,c){if(b){a||(a=e.create());var d=.5*b.width*(c-1);c=.5*b.height*(c-1);b.width<1E-7*b.height?d+=c/20:b.height<1E-7*b.width&&(c+=d/20);f.vec4.set(a,b.xmin-d,b.ymin-c,b.xmax+d,b.ymax+c);return a}return null};a.updateVertexAttributeAuxpos1w=function(b,a){for(var c=0;c<b.geometries.length;++c){var d=b.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==a&&(d.data[3]=a,b.geometryVertexAttrsUpdated(c))}};
a.mixinColorAndOpacity=function(b,a){var d=c.vec4f64.clone(c.vec4f64.ONES);k.isSome(b)&&(d[0]=b[0],d[1]=b[1],d[2]=b[2]);k.isSome(a)?d[3]=a:k.isSome(b)&&3<b.length&&(d[3]=b[3]);return d};a.overrideColor=function(b,a,c,d,e,f){void 0===f&&(f=[0,0,0,0]);for(var g=0;3>g;++g)f[g]=b&&null!=b[g]?b[g]:c&&null!=c[g]?c[g]:e[g];f[3]=null!=a?a:null!=d?d:e[3];return f};a.computeObjectScale=function(b,a,c,d){void 0===b&&(b=l.vec3f64.ONES);void 0===d&&(d=1);var e=Array(3);if(null==a||null==c)e[0]=1,e[1]=1,e[2]=1;
else{for(var f=void 0,g=0,h=2;0<=h;h--){var p=b[h],k=void 0,q=null!=p,m=0===h&&!f&&!q,u=c[h];"symbolValue"===p||m?k=0!==u?a[h]/u:1:q&&"proportional"!==p&&isFinite(p)&&(k=0!==u?p/u:1);null!=k&&(f=e[h]=k,g=Math.max(g,Math.abs(k)))}for(h=2;0<=h;h--)null==e[h]?e[h]=f:0===e[h]&&(e[h]=.001*g)}for(h=2;0<=h;h--)e[h]/=d;return l.vec3f64.fromArray(e)};a.computeSizeWithResourceSize=function(b,a){var c=a.width,d=a.depth,e=a.height;a=a.isPrimitive?10:1;if(null==c&&null==e&&null==d)return[a*b[0],a*b[1],a*b[2]];
for(var c=l.vec3f64.fromValues(c,d,e),f,d=0;3>d;d++)if(e=c[d],null!=e){f=e/b[d];break}for(d=0;3>d;d++)null==c[d]&&(c[d]=b[d]*f);return c};a.validateSymbolLayerSize=function(b){null!=b.isPrimitive&&(b=[b.width,b.depth,b.height]);return y(b)?null:"Symbol sizes may not be negative values"};a.isValidSize=y;a.computeObjectRotation=function(b,a,c,e){void 0===e&&(e=d.mat4f64.create());b=b||0;a=a||0;c=c||0;0!==b&&h.mat4.rotateZ(e,e,-b/180*Math.PI);0!==a&&h.mat4.rotateX(e,e,a/180*Math.PI);0!==c&&h.mat4.rotateY(e,
e,c/180*Math.PI);return e};a.demResolutionForBoundingBox=function(a,c){return null!=c.minDemResolution?c.minDemResolution:b.isPoint(a)?c.minDemResolutionForPoints:.01*b.maximumDimension(a)};a.namedAnchorToHUDMaterialAnchorPos={"bottom-left":g.vec2f64.fromValues(0,0),bottom:g.vec2f64.fromValues(.5,0),"bottom-right":g.vec2f64.fromValues(1,0),left:g.vec2f64.fromValues(0,.5),center:g.vec2f64.fromValues(.5,.5),right:g.vec2f64.fromValues(1,.5),"top-left":g.vec2f64.fromValues(0,1),top:g.vec2f64.fromValues(.5,
1),"top-right":g.vec2f64.fromValues(1,1)}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){function p(b){return b.isVisible?b.getParameters().transparent?1:2:0}n=function(){function a(c,d,e,f,g,l,h,p,k){this._edgeState=p;this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=c;this.uniqueMaterials=f;this.uniqueGeometries=e;this.uniqueTextures=g;this.stageObject=d;this.elevationAligner=l;this.elevationContext=new b(h);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=
null!=k?k:a.VisibilityModes.HIDE_FACERANGE}Object.defineProperty(a.prototype,"isElevationSource",{get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)},enumerable:!0,configurable:!0});a.prototype.initialize=function(b,a){this.stageLayer=b;this.stage=a;if(this.uniqueMaterials)for(b=0;b<this.uniqueMaterials.length;b++)a.add(3,this.uniqueMaterials[b]);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.add(2,this.uniqueGeometries[b]);if(this.uniqueTextures)for(b=
0;b<this.uniqueTextures.length;b++)a.add(4,this.uniqueTextures[b]);a.add(1,this.stageObject)};a.prototype.layerOpacityChanged=function(b,a){if(!d.isNone(this._edgeState)){for(var c=p(this._edgeState.baseMaterial),e=!1,f=0,g=this._edgeState.edgeMaterials;f<g.length;f++){var l=g[f];l.objectTransparency!==c&&(l.objectTransparency=c,e=!0)}e&&this.resetEdgeObject(a);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[b])}};a.prototype.slicePlaneEnabledChanged=function(b,
a){d.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:b},!a),this._edgeState.slicePlaneEnabled=b)};a.prototype.setVisibility=function(b){if(null!=this.stage){if(this._visible!==b){(this._visible=b)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===a.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():
(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);if(d.isSome(this._edgeState)){var c=this.stage.renderView.ensureEdgeView();c.hasObject(this.stageObject)?c.updateObjectVisibility(this.stageObject,b):b&&this.addEdgeObject(c,this._edgeState,!1)}return!0}return!1}};Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});a.prototype.destroy=function(){var b=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var a=
0;a<this.uniqueMaterials.length;a++)b.remove(3,this.uniqueMaterials[a].id);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.remove(2,this.uniqueGeometries[a].id);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.remove(4,this.uniqueTextures[a].id)}b.remove(1,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);b=this.stage.renderView.ensureEdgeView();b.hasObject(this.stageObject)&&b.removeObject(this.stageObject);
this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};a.prototype.alignWithElevation=function(b,a,d,e){null!=this.elevationAligner&&(c.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),b=this.elevationAligner(this,this.elevationContext,b,a),null!=b&&(this.alignedTerrainElevation=b),this.resetEdgeObject(e))};a.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};a.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=l.vec3f64.create());
return g.vec3.copy(b,this.stageObject.getCenter(!0))};a.prototype.getBoundingBoxObjectSpace=function(b){void 0===b&&(b=f.create());var a=this.stageObject;b||(b=f.create());f.setMin(b,a.getBBMin(!0));f.setMax(b,a.getBBMax(!0));return b};a.prototype.getProjectedBoundingBox=function(b,a,c,d,l){return h(this,void 0,void 0,function(){var h,p,m,t,x,v,y,z,n,A;return k(this,function(k){switch(k.label){case 0:h=this.getBoundingBoxObjectSpace(l);p=u;m=f.isPoint(h)?1:p.length;for(t=0;t<m;t++)x=p[t],r[0]=h[x[0]],
r[1]=h[x[1]],r[2]=h[x[2]],g.vec3.transformMat4(r,r,this.stageObject.objectTransformation),q[3*t+0]=r[0],q[3*t+1]=r[1],q[3*t+2]=r[2];if(!b(q,0,m))return[2,null];f.empty(h);v=null;this.calculateRelativeScreenBounds&&(v=this.calculateRelativeScreenBounds());for(t=0;t<3*m;t+=3){for(y=0;3>y;y++)h[y]=Math.min(h[y],q[t+y]),h[y+3]=Math.max(h[y+3],q[t+y]);v&&c.push({location:q.slice(t,t+3),screenSpaceBoundingRect:v})}if(!a||!a.service||"absolute-height"===this.elevationContext.mode)return[3,5];f.center(h,
w);z="relative-to-scene"===this.elevationContext.mode?"scene":"ground";n=void 0;if(!a.useViewElevation)return[3,1];n=a.service.getElevation(w[0],w[1],z);return[3,4];case 1:return k.trys.push([1,3,,4]),A=e.demResolutionForBoundingBox(h,a),[4,a.service.queryElevation(w[0],w[1],d,A,z)];case 2:return n=k.sent(),[3,4];case 3:return k.sent(),n=null,[3,4];case 4:f.offset(h,0,0,-this.alignedTerrainElevation+n),k.label=5;case 5:return[2,h]}})})};a.prototype.addHighlight=function(b,a){a=this.stageObject.highlightAllComponents(a);
b.addObject(this.stageObject,a)};a.prototype.removeHighlight=function(b){b.removeObject(this.stageObject)};a.prototype.resetEdgeObject=function(b){if(!d.isNone(this._edgeState)){var a=this.stage.renderView.ensureEdgeView();a.removeObject(this.stageObject);this._visible&&this.addEdgeObject(a,this._edgeState,b)}};a.prototype.addEdgeObject=function(b,a,c){for(var d=p(a.baseMaterial),e=0,f=a.edgeMaterials;e<f.length;e++)f[e].objectTransparency=d;b.addObject(this.stageObject,a.edgeMaterials,{slicePlaneEnabled:a.slicePlaneEnabled},
!c,a.addObjectSettings)};return a}();(function(b){b=b.VisibilityModes||(b.VisibilityModes={});b[b.REMOVE_OBJECT=0]="REMOVE_OBJECT";b[b.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(n||(n={}));var q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=l.vec3f64.create(),w=l.vec3f64.create(),u=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return n})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../layers/graphics/dehydratedFeatures",
"../../../../support/arcadeUtils"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.createContext=function(a,d,g){var l=null;a=a&&a.expression;"string"===typeof a&&(l="0"===a?0:null,null!=l?l={cachedResult:l}:(l=k.createSyntaxTree(a),k.dependsOnView(l)?(null!=g&&g.error("Expressions containing '$view' are not supported on ElevationInfo"),l={cachedResult:0}):l={arcade:{func:k.createFunction(l),context:k.createExecContext(null,{sr:d})}}));return l};a.createFeature=function(a,d){return k.createFeature(a.attributes,
a.geometry,d)};a.setContextFeature=function(a,d){null!=a&&null==a.cachedResult&&(d._geometry&&(d._geometry=m.hydrateGeometry(d._geometry)),k.updateExecContext(a.arcade.context,d))};a.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var d=a.arcade,d=k.executeFunction(d.func,d.context);"number"!==typeof d&&(d=a.cachedResult=0);return d}return 0};a.extractExpressionInfo=function(a,d){void 0===d&&(d=!1);var g=(a=a&&a.featureExpressionInfo)&&a.expression;d||"0"===g||(a=null);
return a};a.zeroContext={cachedResult:0}})},"esri/support/arcadeUtils":function(){define("require exports ../arcade/arcade ../arcade/Dictionary ../arcade/Feature ../core/lang ../core/promiseUtils ../renderers/visualVariables/support/sizeVariableUtils".split(" "),function(n,a,m,k,h,d,g,l){function f(b){var a;try{a=b?m.parseScript(b):null}catch(r){a=null}return a}function c(b){b=f(b);return!!b&&m.scriptUsesGeometryEngine(b)}Object.defineProperty(a,"__esModule",{value:!0});a.arcade=m;a.Dictionary=k;
a.arcadeFeature=h;var b=/^\$feature\./i,e={vars:{$feature:"any",$view:"any"},spatialReference:null};a.createSyntaxTree=f;a.createFunction=function(b,a){a=a||d.clone(e);b="string"===typeof b?f(b):b;if(!b)return null;var c;try{c=b?m.compileScript(b,a):null}catch(w){c=null}return c};a.createExecContext=function(b,a){return{vars:{$feature:null==b?new h:h.createFromGraphic(b),$view:a&&a.view},spatialReference:a&&a.sr}};a.createFeature=function(b,a,c){return h.createFromGraphicLikeObject(a,b,c)};a.updateExecContext=
function(b,a){b.vars.$feature=a};a.evalSyntaxTree=function(b,a){var c;try{c=m.executeScript(b,a)}catch(w){c=null}return c};a.executeFunction=function(b,a){var c;try{c=b?b(a):null}catch(w){c=null}return c};a.executeAsyncFunction=function(b,a){try{return b?b(a):g.resolve(null)}catch(r){return g.resolve(null)}};a.extractFieldNames=function(a){if(!a)return[];a="string"===typeof a?f(a):a;if(!a)return[];var c=[];m.extractFieldLiterals(a).forEach(function(a){b.test(a)&&(a=a.replace(b,""),c.push(a))});c.sort();
return c.filter(function(b,a){return 0===a||c[a-1]!==b})};a.dependsOnView=function(b){return m.referencesMember(b,"$view")};a.hasVariable=function(b,a){return b?m.referencesMember(b,a):!1};a.getViewInfo=function(b){if(b&&(null!=b.spatialReference||null!=b.scale&&null!=b.viewingMode))return{view:b.viewingMode&&null!=b.scale?new k({viewingMode:b.viewingMode,scale:b.scale}):null,sr:b.spatialReference}};a.convertServiceUrlToWorkspace=function(b,a){var c=m.featureSetUtils();return c?c.createFeatureSetCollectionFromService(b,
a):null};a.convertFeatureLayerToFeatureSet=function(b,a){if(null===b)return null;var c=m.featureSetUtils();return c?c.constructFeatureSet(b,a):null};a.convertMapToFeatureSetCollection=function(b){if(null===b||null===b.map)return null;var a=m.featureSetUtils();return a?a.createFeatureSetCollectionFromMap(b.map,b.spatialReference):null};a.loadScriptDependencies=function(b,a,c){void 0===c&&(c=[]);return m.loadScriptDependencies(b,a,c)};a.enableGeometryOperations=function(){return m.enableGeometrySupport()};
a.enableFeatureSetOperations=function(){return m.enableFeatureSetSupport()};a.applyTextFormattingHTML=function(b){var a=/(\n)/gi;return"string"===typeof b?b.replace(a,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):b};a.hasGeometryOperations=function(b){if(!b)return!1;if("string"===typeof b)return c(b);if("simple"===b.type||"class-breaks"===b.type||"unique-value"===b.type||"dot-density"===b.type||"dictionary"===b.type){if("dot-density"===b.type){var a=b.attributes.some(function(b){return c(b.valueExpression)});
if(a)return a}a=b.visualVariables;a=!!a&&a.some(function(b){var a=c(b.valueExpression);"size"===b.type&&(l.isSizeVariable(b.minSize)&&(a=a||c(b.minSize.valueExpression)),l.isSizeVariable(b.maxSize)&&(a=a||c(b.maxSize.valueExpression)));return a});return"valueExpression"in b&&c(b.valueExpression)?!0:a}return"esri.layers.support.LabelClass"===b.declaredClass?(b=b.labelExpressionInfo&&b.labelExpressionInfo.expression,!(!b||!c(b))||!1):"esri.PopupTemplate"===b.declaredClass?!!b.expressionInfos&&b.expressionInfos.some(function(b){return c(b.expression)}):
!1}})},"esri/arcade/arcade":function(){define("require exports ./arcadeCompiler ./arcadeRuntime ./languageUtils ./parser ./treeAnalysis ../core/has ../core/promiseUtils ../intl/moment".split(" "),function(n,a,m,k,h,d,g,l,f,c){function b(b,a){if(null===G)throw Error("Async Arcade must be enabled for this script");return l("csp-restrictions")||!1===A?function(a){return G.executeScript(b,a)}:m.compileScript(b,a,!0)}function e(b,a){void 0===a&&(a=[]);return d.parseScript(b,a)}function p(b,a){if(!0===
a.useAsync||!0===b.isAsync){if(null===G)throw Error("Async Arcade must be enabled for this script");return G.executeScript(b,a)}return k.executeScript(b,a)}function q(b,a){return k.referencesMember(b,a)}function r(b,a){void 0===a&&(a=[]);void 0===b.usesGeometry&&g.findScriptDependencies(b,a);return!0===b.usesGeometry}function w(){return K?K:K=f.create(function(b,a){n(["../geometry/geometryEngine","./functions/geomsync"],function(a,c){B=!0;c.setGeometryEngine(a);b(!0)},function(b){a(b)})})}function u(){return null!==
H?H:H=m.enableAsyncSupport().then(function(){return f.create(function(b,a){n(["./arcadeAsyncRuntime"],function(c){try{G=c;c=0;for(var d=F;c<d.length;c++){var e=d[c];G.extend(e);m.extend(e,"async")}F=null;b(!0)}catch(U){a(U)}},a)})})}function v(){return G?!0:!1}function y(){return N?N:N=u().then(function(){return f.create(function(b,a){n(["./featureSetUtils","./functions/featuresetbase","./functions/featuresetgeom","./functions/featuresetstats","./functions/featuresetstring"],function(c,d,e,f,g){try{I=
c,G.extend([d,e,f,g]),m.extend([d,e,f,g],"async"),E=!0,b(!0)}catch(V){a(V)}},a)})})}function t(b,a){void 0===a&&(a=[]);void 0===b.usesFeatureSet&&g.findScriptDependencies(b,a);return!0===b.usesFeatureSet}function x(b,a){if(a)for(var c=0;c<a.length;c++)if(q(b,a[c]))return!0;return!1}function z(){return null!==J?J:J=c.loadMoment().then(function(b){h.MomentLibrary.Moment=b;return!0})}Object.defineProperty(a,"__esModule",{value:!0});var A=function(){if(l("csp-restrictions"))return!1;try{return(new Function("function* test() {}; return true"))()}catch(M){return!1}}(),
E=!1,B=!1,G=null,F=[];a.compileScript=function(a,c){return!0===c.useAsync||!0===a.isAsync?b(a,c):l("csp-restrictions")?function(b){return k.executeScript(a,b)}:m.compileScript(a,c)};a.extend=function(b){k.extend(b);m.extend(b,"sync");null===G?F.push(b):(m.extend(b,"async"),G.extend(b))};a.parseScript=e;a.validateScript=function(b,a,c){void 0===c&&(c="");return d.validateScript(b,a,c)};a.scriptCheck=function(b,a,c,e){void 0===e&&(e="");return d.scriptCheck(b,a,c,e)};a.parseAndExecuteScript=function(b,
a,c){void 0===c&&(c=[]);b=d.parseScript(b,c);return p(b,a)};a.executeScript=p;a.referencesMember=q;a.referencesFunction=function(b,a){return k.referencesFunction(b,a)};a.extractFieldLiterals=function(b,a){void 0===a&&(a=!1);return d.extractFieldLiterals(b,a)};a.scriptUsesGeometryEngine=r;var K=null;a.enableGeometrySupport=w;var H=null;a.enableAsyncSupport=u;a.isFeatureSetSupportEnabled=function(){return E};a.isAsyncEnabled=v;a.isGeometryEnabled=function(){return B};var N=null;a.enableFeatureSetSupport=
y;a.scriptUsesFeatureSet=t;a.scriptIsAsync=function(b,a){void 0===a&&(a=[]);void 0===b.isAsync&&g.findScriptDependencies(b,a);return!0===b.isAsync};a.loadScriptDependencies=function(b,a,c,d){void 0===c&&(c=[]);void 0===d&&(d=!1);return f.create(function(g,l){var h="string"===typeof b?e(b):b,p=[];p.push(z());h&&(!1===B&&(r(h)||d)&&p.push(w()),!1===v()&&(!0===h.isAsync||a)&&p.push(u()),!1===E&&(t(h)||x(h,c))&&p.push(y()));p?f.all(p).then(function(){g(!0)},l):g(!0)})};a.scriptTouchesGeometry=function(b){if(r(b))return!0;
b=g.findFunctionCalls(b,!0);return-1<b.indexOf("geometry")||-1<b.indexOf("feature")?!0:!1};var I=null;a.featureSetUtils=function(){return I};a.load=z;var J=null})},"esri/arcade/arcadeCompiler":function(){define("require exports ./ArcadePortal ./Attachment ./Dictionary ./Feature ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./functions/date ./functions/geometry ./functions/geomsync ./functions/maths ./functions/stats ./functions/string ../core/promiseUtils ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E){function B(b,a,c){try{return c(b,null,a)}catch(C){throw C;}}function G(b){return b instanceof Error?u.reject(b):u.reject(Error(b))}function F(b,a){try{switch(a.type){case "EmptyStatement":return"lc.voidOperation";case "VariableDeclarator":return J(b,a);case "VariableDeclaration":for(var d=[],e=0;e<a.declarations.length;e++)d.push(F(b,a.declarations[e]));return d.join("\n")+" \n lastStatement\x3d  lc.voidOperation; \n";case "BlockStatement":return I(b,
a);case "FunctionDeclaration":var f=a.id.name.toLowerCase(),g={isAsync:b.isAsync,spatialReference:b.spatialReference,console:b.console,lrucache:b.lrucache,services:b.services,symbols:b.symbols,mangleMap:b.mangleMap,localScope:{_SymbolsMap:{}},depthCounter:b.depthCounter+1,globalScope:b.globalScope};if(64<g.depthCounter)throw Error("Exceeded maximum function depth");for(var d="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement \x3d lc.voidOperation; \n   var lscope \x3d runtimeCtx.localStack[runtimeCtx.localStack.length-1];\n",
l=0;l<a.params.length;l++){var h=a.params[l].name.toLowerCase(),p=W(h,b);g.localScope._SymbolsMap[h]=p;g.mangleMap[h]=p;d+="lscope['"+p+"']\x3darguments["+l.toString()+"];\n"}!0===b.isAsync?(d=d+"return lang.__awaiter(this, void 0, void 0, function* () {\n"+(I(g,a.body)+"\n return lastStatement; "),d+="});  }, runtimeCtx))\n lastStatement \x3d lc.voidOperation; \n"):(d+=I(g,a.body)+"\n return lastStatement; }, runtimeCtx))",d+="\n lastStatement \x3d lc.voidOperation; \n");void 0!==b.globalScope[f]?
e="gscope['"+f+"']\x3d"+d:void 0!==b.globalScope._SymbolsMap[f]?e="gscope['"+b.globalScope._SymbolsMap[f]+"']\x3d"+d:(p=W(f,b),b.globalScope._SymbolsMap[f]=p,b.mangleMap[f]=p,e="gscope['"+p+"']\x3d"+d);return e;case "ReturnStatement":var k;k=null===a.argument?"return lc.voidOperation":"return "+F(b,a.argument)+"";return k;case "IfStatement":if("AssignmentExpression"===a.test.type||"UpdateExpression"===a.test.type)throw Error(c.nodeErrorMessage(a.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));
var q=F(b,a.test),m=Q(b),u="var "+m+" \x3d "+q+";\n if ("+m+" \x3d\x3d\x3d true) {\n"+N(b,a.consequent)+"\n }\n",u=null!==a.alternate?u+("else if ("+m+"\x3d\x3d\x3dfalse)   { \n"+N(b,a.alternate)+"}\n"):u+("else if ("+m+"\x3d\x3d\x3dfalse) { \n lastStatement \x3d lc.voidOperation;\n }\n");return u+="else { lang.error({type: '"+a.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n";case "ExpressionStatement":var r;r="AssignmentExpression"===a.expression.type?"lastStatement \x3d lc.voidOperation; "+
F(b,a.expression)+"; \n ":"lastStatement \x3d "+F(b,a.expression)+"; ";return r;case "AssignmentExpression":return H(b,a);case "UpdateExpression":return K(b,a);case "BreakStatement":return"break";case "ContinueStatement":return"continue";case "ForStatement":d="lastStatement \x3d lc.voidOperation; \n";null!==a.init&&(d+=F(b,a.init)+"; ");var w=Q(b),t=Q(b),d=d+("var "+w+" \x3d true; ")+"\n do { ";null!==a.update&&(d+=" if ("+w+"\x3d\x3d\x3dfalse) {\n "+F(b,a.update)+"  \n}\n "+w+"\x3dfalse; \n");null!==
a.test&&(d+="var "+t+" \x3d "+F(b,a.test)+"; ",d+="if ("+t+"\x3d\x3d\x3dfalse) { break; } else if ("+t+"!\x3d\x3dtrue) { lang.error({type: '"+a.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n");d+=F(b,a.body);null!==a.update&&(d+="\n "+F(b,a.update));return d+("\n"+w+" \x3d true; \n} while(true);  lastStatement \x3d lc.voidOperation; ");case "ForInStatement":var x=Q(b),v=Q(b),y=Q(b),z="var "+x+" \x3d "+F(b,a.right)+";\n";"VariableDeclaration"===a.left.type&&(z+=F(b,a.left));var n=
"VariableDeclaration"===a.left.type?a.left.declarations[0].id.name:a.left.name,n=n.toLowerCase(),d="";null!==b.localScope&&(void 0!==b.localScope[n]?d="lscope['"+n+"']":void 0!==b.localScope._SymbolsMap[n]&&(d="lscope['"+b.localScope._SymbolsMap[n]+"']"));""===d&&(void 0!==b.globalScope[n]?d="gscope['"+n+"']":void 0!==b.globalScope._SymbolsMap[n]&&(d="gscope['"+b.globalScope._SymbolsMap[n]+"']"));z=z+("if ("+x+"\x3d\x3d\x3dnull) {  lastStatement \x3d lc.voidOperation; }\n ")+("else if (lc.isArray("+
x+") || lc.isString("+x+")) {")+("var "+v+"\x3d"+x+".length; \n")+("for(var "+y+"\x3d0; "+y+"\x3c"+v+"; "+y+"++) {\n");z+=d+"\x3d"+y+";\n";z+=F(b,a.body);z+="\n}\n";z+=" lastStatement \x3d lc.voidOperation; \n";z+=" \n}\n";z+="else if (lc.isImmutableArray("+x+")) {";z=z+("var "+v+"\x3d"+x+".length(); \n")+("for(var "+y+"\x3d0; "+y+"\x3c"+v+"; "+y+"++) {\n");z+=d+"\x3d"+y+";\n";z+=F(b,a.body);z+="\n}\n";z+=" lastStatement \x3d lc.voidOperation; \n";z+=" \n}\n";z+="else if (( "+x+" instanceof lang.Dictionary) || ( "+
x+" instanceof lang.Feature)) {";z=z+("var "+v+"\x3d"+x+".keys(); \n")+("for(var "+y+"\x3d0; "+y+"\x3c"+v+".length; "+y+"++) {\n");z+=d+"\x3d"+v+"["+y+"];\n";z+=F(b,a.body);z+="\n}\n";z+=" lastStatement \x3d lc.voidOperation; \n";z+=" \n}\n";b.isAsync&&(z+="else if (lc.isFeatureSet("+x+")) {",z=z+("var "+v+"\x3d"+x+".iterator(runtimeCtx.abortSignal); \n")+("for(var "+y+"\x3dlang. graphicToFeature( yield "+v+".next(),"+x+"); "+y+"!\x3dnull; "+y+"\x3dlang. graphicToFeature( yield "+v+".next(),"+x+")) {\n")+
(d+"\x3d"+y+";\n"),z+=F(b,a.body),z+="\n}\n",z+=" lastStatement \x3d lc.voidOperation; \n",z+=" \n}\n");return z+"else { lastStatement \x3d lc.voidOperation; } \n";case "Identifier":return L(b,a);case "MemberExpression":var A;try{d=void 0,d=!0===a.computed?F(b,a.property):"'"+a.property.name+"'",A="lang.member("+F(b,a.object)+","+d+")"}catch(ma){throw ma;}return A;case "Literal":return null===a.value||void 0===a.value?"null":JSON.stringify(a.value);case "ThisExpression":throw Error(c.nodeErrorMessage(a,
"RUNTIME","NOTSUPPORTED"));case "CallExpression":try{if("Identifier"!==a.callee.type)throw Error(c.nodeErrorMessage(a,"RUNTIME","ONLYNODESSUPPORTED"));var E=a.callee.name.toLowerCase(),e="";null!==b.localScope&&(void 0!==b.localScope[E]?e="lscope['"+E+"']":void 0!==b.localScope._SymbolsMap[E]&&(e="lscope['"+b.localScope._SymbolsMap[E]+"']"));""===e&&(void 0!==b.globalScope[E]?e="gscope['"+E+"']":void 0!==b.globalScope._SymbolsMap[E]&&(e="gscope['"+b.globalScope._SymbolsMap[E]+"']"));if(""!==e){f=
"[";for(g=0;g<a.arguments.length;g++)0<g&&(f+=", "),f+=F(b,a.arguments[g]);f+="]";d=b.isAsync?"(yield lang.callfunc("+e+","+f+",runtimeCtx) )":"lang.callfunc("+e+","+f+",runtimeCtx)"}else throw Error(c.nodeErrorMessage(a,"RUNTIME","NOTFOUND"));}catch(ma){throw ma;}return d;case "UnaryExpression":var B;try{B="lang.unary("+F(b,a.argument)+",'"+a.operator+"')"}catch(ma){throw ma;}return B;case "BinaryExpression":var M;try{M="lang.binary("+F(b,a.left)+","+F(b,a.right)+",'"+a.operator+"')"}catch(ma){throw ma;
}return M;case "LogicalExpression":var G;try{if("AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type)throw Error(c.nodeErrorMessage(a.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type)throw Error(c.nodeErrorMessage(a.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("\x26\x26"===a.operator||"||"===a.operator)G="(lang.logicalCheck("+F(b,a.left)+") "+a.operator+" lang.logicalCheck("+F(b,a.right)+
"))";else throw Error(c.nodeErrorMessage(a,"RUNTIME","ONLYORORAND"));}catch(ma){throw ma;}return G;case "ConditionalExpression":throw Error(c.nodeErrorMessage(a,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{d=[];for(e=0;e<a.elements.length;e++)"Literal"===a.elements[e].type?d.push(F(b,a.elements[e])):d.push("lang.aCheck("+F(b,a.elements[e])+",'ArrayExpression')");l="["+d.join(",")+"]"}catch(ma){throw ma;}return l;case "ObjectExpression":d="lang.dictionary([";for(e=0;e<a.properties.length;e++){var R=
a.properties[e],Z="Identifier"===R.key.type?"'"+R.key.name+"'":F(b,R.key),O=F(b,R.value);0<e&&(d+=",");d+="lang.strCheck("+Z+",'ObjectExpression'),lang.aCheck("+O+", 'ObjectExpression')"}return d+"])";case "Property":throw Error("Should not get here");case "Array":throw Error(c.nodeErrorMessage(a,"RUNTIME","NOTSUPPORTED"));default:throw Error(c.nodeErrorMessage(a,"RUNTIME","UNREOGNISED"));}}catch(ma){throw ma;}}function K(b,a){var c=null,d="";if("MemberExpression"===a.argument.type)return c=F(b,a.argument.object),
d=!0===a.argument.computed?F(b,a.argument.property):"'"+a.argument.property.name+"'","lang.memberupdate("+c+","+d+",'"+a.operator+"',"+a.prefix+")";c=a.argument.name.toLowerCase();if(null!==b.localScope){if(void 0!==b.localScope[c])return"lang.update(lscope, '"+c+"','"+a.operator+"',"+a.prefix+")";if(void 0!==b.localScope._SymbolsMap[c])return"lang.update(lscope, '"+b.localScope._SymbolsMap[c]+"','"+a.operator+"',"+a.prefix+")"}if(void 0!==b.globalScope[c])return"lang.update(gscope, '"+c+"','"+a.operator+
"',"+a.prefix+")";if(void 0!==b.globalScope._SymbolsMap[c])return"lang.update(gscope, '"+b.globalScope._SymbolsMap[c]+"','"+a.operator+"',"+a.prefix+")";throw Error("Variable not recognised");}function H(b,a){var c=F(b,a.right),d=null,e="";if("MemberExpression"===a.left.type)return d=F(b,a.left.object),e=!0===a.left.computed?F(b,a.left.property):"'"+a.left.property.name+"'","lang.assignmember("+d+","+e+",'"+a.operator+"',"+c+")";d=a.left.name.toLowerCase();if(null!==b.localScope){if(void 0!==b.localScope[d])return"lscope['"+
d+"']\x3dlang.assign("+c+",'"+a.operator+"', lscope['"+d+"'])";if(void 0!==b.localScope._SymbolsMap[d])return"lscope['"+b.localScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+a.operator+"', lscope['"+b.localScope._SymbolsMap[d]+"'])"}if(void 0!==b.globalScope[d])return"gscope['"+d+"']\x3dlang.assign("+c+",'"+a.operator+"', gscope['"+d+"'])";if(void 0!==b.globalScope._SymbolsMap[d])return"gscope['"+b.globalScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+a.operator+"', gscope['"+b.globalScope._SymbolsMap[d]+
"'])";throw Error("Variable not recognised");}function N(b,a){return"BlockStatement"===a.type?F(b,a):"ReturnStatement"===a.type||"BreakStatement"===a.type||"ContinueStatement"===a.type?F(b,a)+"; ":"UpdateExpression"===a.type?"lastStatement \x3d "+F(b,a)+"; ":"ExpressionStatement"===a.type?F(b,a):"ObjectExpression"===a.type?"lastStatement \x3d "+F(b,a)+"; ":F(b,a)+"; "}function I(b,a){for(var c="",d=0;d<a.body.length;d++)c="ReturnStatement"===a.body[d].type?c+(F(b,a.body[d])+"; \n"):"BreakStatement"===
a.body[d].type?c+(F(b,a.body[d])+"; \n"):"ContinueStatement"===a.body[d].type?c+(F(b,a.body[d])+"; \n"):"UpdateExpression"===a.body[d].type?c+("lastStatement \x3d "+F(b,a.body[d])+"; \n"):"ObjectExpression"===a.body[d].type?c+("lastStatement \x3d "+F(b,a.body[d])+"; \n"):c+(F(b,a.body[d])+" \n");return c}function J(b,a){var c=null===a.init?null:F(b,a.init);c===f.voidOperation&&(c=null);a=a.id.name.toLowerCase();if(null!==b.localScope){if(void 0!==b.localScope[a])return"lscope['"+a+"']\x3d"+c+"; ";
if(void 0!==b.localScope._SymbolsMap[a])return"lscope['"+b.localScope._SymbolsMap[a]+"']\x3d"+c+"; ";var d=W(a,b);b.localScope._SymbolsMap[a]=d;b.mangleMap[a]=d;return"lscope['"+d+"']\x3d"+c+"; "}if(void 0!==b.globalScope[a])return"gscope['"+a+"']\x3d"+c+"; ";if(void 0!==b.globalScope._SymbolsMap[a])return"gscope['"+b.globalScope._SymbolsMap[a]+"']\x3d"+c+"; ";d=W(a,b);b.globalScope._SymbolsMap[a]=d;b.mangleMap[a]=d;return"gscope['"+d+"']\x3d"+c+"; "}function M(b,a,d){a=a.toLowerCase();switch(a){case "hasz":return b=
b.hasZ,void 0===b?!1:b;case "hasm":return b=b.hasM,void 0===b?!1:b;case "spatialreference":return a=b.spatialReference._arcadeCacheId,void 0===a&&(d=!0,Object.freeze&&Object.isFrozen(b.spatialReference)&&(d=!1),d&&(ga++,a=b.spatialReference._arcadeCacheId=ga)),b=new h({wkt:b.spatialReference.wkt,wkid:b.spatialReference.wkid}),void 0!==a&&(b._arcadeCacheId="SPREF"+a.toString()),b}switch(b.type){case "extent":switch(a){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return b=
b[a],void 0!==b?b:null;case "type":return"Extent"}break;case "polygon":switch(a){case "rings":return a=b.cache._arcadeCacheId,void 0===a&&(ga++,a=ga,b.cache._arcadeCacheId=a),b=new g(b.rings,b.spatialReference,!0===b.hasZ,!0===b.hasM,a);case "type":return"Polygon"}break;case "point":switch(a){case "x":case "y":case "z":case "m":return void 0!==b[a]?b[a]:null;case "type":return"Point"}break;case "polyline":switch(a){case "paths":return a=b.cache._arcadeCacheId,void 0===a&&(ga++,a=ga,b.cache._arcadeCacheId=
a),b=new g(b.paths,b.spatialReference,!0===b.hasZ,!0===b.hasM,a);case "type":return"Polyline"}break;case "multipoint":switch(a){case "points":return a=b.cache._arcadeCacheId,void 0===a&&(ga++,a=ga,b.cache._arcadeCacheId=a),b=new l(b.points,b.spatialReference,!0===b.hasZ,!0===b.hasM,a,1);case "type":return"Multipoint"}}throw Error(c.nodeErrorMessage(d,"RUNTIME","PROPERTYNOTFOUND"));}function L(b,a){try{var d=a.name.toLowerCase();if(null!==b.localScope){if(void 0!==b.localScope[d])return"lscope['"+
d+"']";if(void 0!==b.localScope._SymbolsMap[d])return"lscope['"+b.localScope._SymbolsMap[d]+"']"}if(void 0!==b.globalScope[d])return"gscope['"+d+"']";if(void 0!==b.globalScope._SymbolsMap[d])return"gscope['"+b.globalScope._SymbolsMap[d]+"']";throw Error(c.nodeErrorMessage(a,"RUNTIME","VARIABLENOTFOUND"));}catch(C){throw C;}}function R(b){return null===b?"":f.isArray(b)||f.isImmutableArray(b)?"Array":f.isDate(b)?"Date":f.isString(b)?"String":f.isBoolean(b)?"Boolean":f.isNumber(b)?"Number":b instanceof
k?"Attachment":b instanceof m?"Portal":b instanceof h?"Dictionary":b instanceof d?"Feature":b instanceof x?"Point":b instanceof z?"Polygon":b instanceof A?"Polyline":b instanceof t?"Multipoint":b instanceof v?"Extent":f.isFunctionParameter(b)?"Function":f.isFeatureSet(b)?"FeatureSet":f.isFeatureSetCollection(b)?"FeatureSetCollection":b===f.voidOperation?"":"number"===typeof b&&isNaN(b)?"Number":"Unrecognised Type"}function O(b,a,c,d){try{if(f.equalityTest(a[c],d))return a[c+1];var e=a.length-c;return 1===
e?a[c]:2===e?null:3===e?a[c+2]:O(b,a,c+2,d)}catch(wa){throw wa;}}function T(b,a,c,d){try{if(!0===d)return a[c+1];if(3===a.length-c)return a[c+2];var e=a[c+2];if(!1===f.isBoolean(e))throw Error("WHEN needs boolean test conditions");return T(b,a,c+2,e)}catch(wa){throw wa;}}function U(b,a){var c=b.length,d=Math.floor(c/2);if(0===c)return[];if(1===c)return[b[0]];var e=U(b.slice(0,d),a);b=U(b.slice(d,c),a);for(c=[];0<e.length||0<b.length;)0<e.length&&0<b.length?(d=a(e[0],b[0]),isNaN(d)&&(d=0),0>=d?(c.push(e[0]),
e=e.slice(1)):(c.push(b[0]),b=b.slice(1))):0<e.length?(c.push(e[0]),e=e.slice(1)):0<b.length&&(c.push(b[0]),b=b.slice(1));return c}function P(b,a){try{var c=b.length,d=Math.floor(c/2);if(0===c)return u.resolve([]);if(1===c)return u.resolve([b[0]]);var e=[P(b.slice(0,d),a),P(b.slice(d,c),a)];return u.all(e).then(function(b){return V(b[0],b[1],a,[])})}catch(wa){return u.reject(wa)}}function V(b,a,c,d){return u.create(function(e,f){0<b.length||0<a.length?0<b.length&&0<a.length?c(b[0],a[0]).then(function(g){try{isNaN(g)&&
(g=1),0>=g?(d.push(b[0]),b=b.slice(1)):(d.push(a[0]),a=a.slice(1)),V(b,a,c,d).then(function(b){e(b)},f)}catch(qa){f(qa)}},f):0<b.length?(d.push(b[0]),b=b.slice(1),V(b,a,c,d).then(function(b){e(b)},f)):0<a.length&&(d.push(a[0]),a=a.slice(1),V(b,a,c,d).then(function(b){e(b)},f)):e(d)})}function W(b,a){a.symbols.symbolCounter++;return"_T"+a.symbols.symbolCounter.toString()}function Q(b){b.symbols.symbolCounter++;return"_Tvar"+b.symbols.symbolCounter.toString()}function Z(b,a,c){var d={};b||(b={});c||
(c={});d._SymbolsMap={};d.textformatting=1;d.infinity=1;d.pi=1;for(var e in a)d[e]=1;for(e in c)d[e]=1;for(e in b)d[e]=1;return d}function X(b,a){for(var d={mode:a,compiled:!0,functions:{},signatures:[],failDefferred:G,standardFunction:B,standardFunctionAsync:B,evaluateIdentifier:aa},e=0;e<b.length;e++)b[e].registerFunctions(d);if("sync"===a){for(var g in d.functions)ca[g]=new f.NativeFunction(d.functions[g]),oa.prototype[g]=ca[g];for(e=0;e<d.signatures.length;e++)c.addFunctionDeclaration(d.signatures[e],
"sync")}else{for(g in d.functions)ia[g]=new f.NativeFunction(d.functions[g]),ha.prototype[g]=ia[g];for(e=0;e<d.signatures.length;e++)c.addFunctionDeclaration(d.signatures[e],"async")}}function aa(b,a){a=a.name;if("_SymbolsMap"===a)throw"Illegal";if(0<b.localStack.length){if("_t"!==a.substr(0,2).toLowerCase()&&void 0!==b.localStack[b.localStack.length-1][a])return b.localStack[b.localStack.length-1][a];var c=b.mangleMap[a];if(void 0!==c&&void 0!==b.localStack[b.localStack.length-1][c])return b.localStack[b.localStack.length-
1][c]}if("_t"!==a.substr(0,2).toLowerCase()&&void 0!==b.globalScope[a]||1===b.globalScope._SymbolsMap[a])return b.globalScope[a];a=b.mangleMap[a];if(void 0!==a)return b.globalScope[a]}function da(b){console.log(b)}Object.defineProperty(a,"__esModule",{value:!0});var ga=0,ca={};b.registerFunctions(ca,B);w.registerFunctions(ca,B);q.registerFunctions(ca,B);e.registerFunctions(ca,B);r.registerFunctions(ca,B);ca["typeof"]=function(b,a){return B(b,a,function(b,a,c){f.pcCheck(c,1,1);b=R(c[0]);if("Unrecognised Type"===
b)throw Error("Unrecognised Type");return b})};ca.iif=function(b,a){try{return B(b,a,function(b,a,c){f.pcCheck(c,3,3);if(!1===f.isBoolean(c[0]))throw Error("IF Function must have a boolean test condition");return c[0]?c[1]:c[2]})}catch(pa){throw pa;}};ca.decode=function(b,a){try{return B(b,a,function(a,c,d){if(2>d.length)throw Error("Missing Parameters");if(2===d.length)return d[1];if(0===(d.length-1)%2)throw Error("Must have a default value result.");return O(b,d,1,d[0])})}catch(pa){throw pa;}};
ca.when=function(b,a){try{return B(b,a,function(a,c,d){if(3>d.length)throw Error("Missing Parameters");if(0===d.length%2)throw Error("Must have a default value result.");a=d[0];if(!1===f.isBoolean(a))throw Error("WHEN needs boolean test conditions");return T(b,d,0,a)})}catch(pa){throw pa;}};ca.top=function(b,a){return B(b,a,function(b,a,c){f.pcCheck(c,2,2);if(f.isArray(c[0]))return f.toNumber(c[1])>=c[0].length?c[0].slice(0):c[0].slice(0,f.toNumber(c[1]));if(f.isImmutableArray(c[0]))return f.toNumber(c[1])>=
c[0].length()?c[0].slice(0):c[0].slice(0,f.toNumber(c[1]));throw Error("Top cannot accept this parameter type");})};ca.first=function(b,a){return B(b,a,function(b,a,c){f.pcCheck(c,1,1);return f.isArray(c[0])?0===c[0].length?null:c[0][0]:f.isImmutableArray(c[0])?0===c[0].length()?null:c[0].get(0):null})};ca.sort=function(b,a){return B(b,a,function(a,c,d){f.pcCheck(d,1,2);c=d[0];f.isImmutableArray(c)&&(c=c.toArray());if(!1===f.isArray(c))throw Error("Illegal Argument");if(1<d.length){if(!1===f.isFunctionParameter(d[1]))throw Error("Illegal Argument");
var e=function(b,c){return ra.callfunc(d[1],[b,c],a)};return b.isAsync?P(c,e):c=U(c,function(b,a){return e(b,a)})}if(0===c.length)return[];for(var g={},l=0;l<c.length;l++){var h=R(c[l]);""!==h&&(g[h]=!0)}if(!0===g.Array||!0===g.Dictionary||!0===g.Feature||!0===g.Point||!0===g.Polygon||!0===g.Polyline||!0===g.Multipoint||!0===g.Extent||!0===g.Function)return c.slice(0);var l=0,h="",p;for(p in g)l++,h=p;return c=1<l||"String"===h?U(c,function(b,a){if(null===b||void 0===b||b===f.voidOperation)return null===
a||void 0===a||a===f.voidOperation?0:1;if(null===a||void 0===a||a===f.voidOperation)return-1;b=f.toString(b);a=f.toString(a);return b<a?-1:b===a?0:1}):"Number"===h?U(c,function(b,a){return b-a}):"Boolean"===h?U(c,function(b,a){return b===a?0:a?-1:1}):"Date"===h?U(c,function(b,a){return a-b}):c.slice(0)})};var ia={},ba;for(ba in ca)ia[ba]=new f.NativeFunction(ca[ba]);p.registerFunctions(ca,B);for(ba in ca)ca[ba]=new f.NativeFunction(ca[ba]);var oa=function(){};oa.prototype=ca;var ha=function(){};ha.prototype=
ia;a.functionHelper={fixSpatialReference:f.fixSpatialReference,parseArguments:function(b,a){for(var c=[],d=0;d<a.arguments.length;d++)c.push(F(b,a.arguments[d]));return c},standardFunction:B};a.extend=X;a.executeScript=function(b,a){return b(a)};a.extractFieldLiterals=function(b,a){void 0===a&&(a=!1);return c.findFieldLiterals(b,a)};a.validateScript=function(b,a){return c.validateScript(b,a,"sync")};a.referencesMember=function(b,a){return c.referencesMember(b,a)};a.referencesFunction=function(b,a){return c.referencesFunction(b,
a)};var la=0,ra={error:function(b,a,d){throw Error(c.nodeErrorMessage(b,a,d));},__awaiter:function(b,a,c,d){return u.create(function(c,e){function f(b){try{l(d.next(b))}catch(Ca){e(Ca)}}function g(b){try{l(d["throw"](b))}catch(Ca){e(Ca)}}function l(b){b.done?c(b.value):b.value&&b.value.then?b.value.then(f,g):(la++,0===la%100?setTimeout(function(){la=0;f(b.value)},0):f(b.value))}l((d=d.apply(b,a||[])).next())})},functionDepthchecker:function(b,a){return function(){a.depthCounter++;a.localStack.push([]);
if(64<a.depthCounter)throw Error("Exceeded maximum function depth");var c=b.apply(this,arguments);if(u.isThenable(c))return c.then(function(b){a.depthCounter--;--a.localStack.length;return b});a.depthCounter--;--a.localStack.length;return c}},aCheck:function(b,a){if(f.isFunctionParameter(b))throw Error(c.nodeErrorMessage({type:a},"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return b===f.voidOperation?null:b},Dictionary:h,Feature:d,dictionary:function(b){for(var a={},c=0;c<b.length;c+=2){if(f.isFunctionParameter(b[c+
1]))throw Error("Illegal Argument");if(!1===f.isString(b[c]))throw Error("Illegal Argument");a[b[c].toString()]=b[c+1]===f.voidOperation?null:b[c+1]}b=new h(a);b.immutable=!1;return b},strCheck:function(b,a){if(!1===f.isString(b))throw Error("Illegal Argument");return b},unary:function(b,a){if(f.isBoolean(b)){if("!"===a)return!b;if("-"===a)return-1*f.toNumber(b);if("+"===a)return 1*f.toNumber(b);throw Error(c.nodeErrorMessage({type:"UnaryExpression",operator:a,prefix:null,argument:null},"RUNTIME",
"NOTSUPPORTEDUNARYOPERATOR"));}if("-"===a)return-1*f.toNumber(b);if("+"===a)return 1*f.toNumber(b);throw Error(c.nodeErrorMessage({type:"UnaryExpression",operator:a,prefix:null,argument:null},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));},logicalCheck:function(b){if(!1===f.isBoolean(b))throw Error(c.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"));return b},logical:function(b,a,d){if(f.isBoolean(b)&&f.isBoolean(a))switch(d){case "||":return b||a;
case "\x26\x26":return b&&a}throw Error(c.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"));},binary:function(b,a,d){switch(d){case "\x3d\x3d":return f.equalityTest(b,a);case "\x3d":return f.equalityTest(b,a);case "!\x3d":return!f.equalityTest(b,a);case "\x3c":return f.greaterThanLessThan(b,a,d);case "\x3e":return f.greaterThanLessThan(b,a,d);case "\x3c\x3d":return f.greaterThanLessThan(b,a,d);case "\x3e\x3d":return f.greaterThanLessThan(b,a,
d);case "+":return f.isString(b)||f.isString(a)?f.toString(b)+f.toString(a):f.toNumber(b)+f.toNumber(a);case "-":return f.toNumber(b)-f.toNumber(a);case "*":return f.toNumber(b)*f.toNumber(a);case "/":return f.toNumber(b)/f.toNumber(a);case "%":return f.toNumber(b)%f.toNumber(a);default:throw Error(c.nodeErrorMessage({type:"BinaryExpression",operator:d,left:b,right:a},"RUNTIME","OPERATORNOTRECOGNISED"));}},assign:function(b,a,d){switch(a){case "\x3d":return b===f.voidOperation?null:b;case "/\x3d":return f.toNumber(d)/
f.toNumber(b);case "*\x3d":return f.toNumber(d)*f.toNumber(b);case "-\x3d":return f.toNumber(d)-f.toNumber(b);case "+\x3d":return f.isString(d)||f.isString(b)?f.toString(d)+f.toString(b):f.toNumber(d)+f.toNumber(b);case "%\x3d":return f.toNumber(d)%f.toNumber(b);default:throw Error(c.nodeErrorMessage({type:"AssignmentExpression",operator:a,left:null,right:null},"RUNTIME","OPERATORNOTRECOGNISED"));}},update:function(b,a,c,d){var e=f.toNumber(b[a]);b[a]="++"===c?e+1:e-1;return!1===d?e:"++"===c?e+1:
e-1},graphicToFeature:function(b,a){return null===b?null:d.createFromGraphicLikeObject(b.geometry,b.attributes,a)},memberupdate:function(b,a,c,e){var g;if(f.isArray(b))if(f.isNumber(a)){0>a&&(a=b.length+a);if(0>a||a>=b.length)throw Error("Assignment outside of array bounds");g=f.toNumber(b[a]);b[a]="++"===c?g+1:g-1}else throw Error("Invalid Parameter");else if(b instanceof h){if(!1===f.isString(a))throw Error("Dictionary accessor must be a string");if(!0===b.hasField(a))g=f.toNumber(b.field(a)),b.setField(a,
"++"===c?g+1:g-1);else throw Error("Invalid Parameter");}else if(b instanceof d){if(!1===f.isString(a))throw Error("Feature accessor must be a string");if(!0===b.hasField(a))g=f.toNumber(b.field(a)),b.setField(a,"++"===c?g+1:g-1);else throw Error("Invalid Parameter");}else{if(f.isImmutableArray(b))throw Error("Array is Immutable");throw Error("Invalid Parameter");}return!1===e?g:"++"===c?g+1:g-1},assignmember:function(b,a,c,e){if(f.isArray(b))if(f.isNumber(a)){0>a&&(a=b.length+a);if(0>a||a>b.length)throw Error("Assignment outside of array bounds");
if(a===b.length&&"\x3d"!==c)throw Error("Invalid Parameter");b[a]=this.assign(e,c,b[a])}else throw Error("Invalid Parameter");else if(b instanceof h){if(!1===f.isString(a))throw Error("Dictionary accessor must be a string");if(!0===b.hasField(a))b.setField(a,this.assign(e,c,b.field(a)));else{if("\x3d"!==c)throw Error("Invalid Parameter");b.setField(a,this.assign(e,c,null))}}else if(b instanceof d){if(!1===f.isString(a))throw Error("Feature accessor must be a string");if(!0===b.hasField(a))b.setField(a,
this.assign(e,c,b.field(a)));else{if("\x3d"!==c)throw Error("Invalid Parameter");b.setField(a,this.assign(e,c,null))}}else{if(f.isImmutableArray(b))throw Error("Array is Immutable");throw Error("Invalid Parameter");}},member:function(b,a){if(null===b)throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","NOTFOUND"));if(b instanceof h||b instanceof d){if(f.isString(a))return b.field(a);throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,
property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(b instanceof y){if(f.isString(a))return M(b,a,"MemberExpression");throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(f.isArray(b)){if(f.isNumber(a)&&isFinite(a)&&Math.floor(a)===a){0>a&&(a=b.length+a);if(a>=b.length||0>a)throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return b[a]}throw Error(c.nodeErrorMessage({type:"MemberExpression",
object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(f.isString(b)){if(f.isNumber(a)&&isFinite(a)&&Math.floor(a)===a){0>a&&(a=b.length+a);if(a>=b.length||0>a)throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return b[a]}throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(f.isImmutableArray(b)&&f.isNumber(a)&&isFinite(a)&&Math.floor(a)===
a){0>a&&(a=b.length()+a);if(a>=b.length()||0>a)throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return b.get(a)}throw Error(c.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));},callfunc:function(b,a,c){return b instanceof f.NativeFunction?b.fn(c,a):b instanceof f.SizzleFunction?b.fn.apply(this,a):b.apply(this,a)}};a.compileScript=function(b,a,c){void 0===a&&(a=null);
void 0===c&&(c=!1);null===a&&(a={vars:{},customfunctions:{}});a={isAsync:c,globalScope:Z(a.vars,c?ia:ca,a.customfunctions),localScope:null,mangleMap:{},console:da,lrucache:a.lrucache,services:a.services,symbols:{symbolCounter:0}};b=F(a,b.body[0].body);""===b&&(b="lc.voidOperation; ");a={lc:f,lang:ra,mangles:a.mangleMap,postProcess:function(b){b instanceof f.ReturnResult&&(b=b.value);b instanceof f.ImplicitResult&&(b=b.value);b===f.voidOperation&&(b=null);if(b===f.breakResult)throw Error("Cannot return BREAK");
if(b===f.continueResult)throw Error("Cannot return CONTINUE");if(f.isFunctionParameter(b))throw Error("Cannot return FUNCTION");return b},prepare:function(b,a){var c=b.spatialReference;if(null===c||void 0===c)c=new E({wkid:102100});var e=b.vars,f=b.customfunctions,g=a?new ha:new oa;e||(e={});f||(f={});var l=new h({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});l.immutable=!1;g._SymbolsMap={textformatting:1,infinity:1,pi:1};g.textformatting=l;g.infinity=
Number.POSITIVE_INFINITY;g.pi=Math.PI;for(var p in f)g[p]=f[p],g._SymbolsMap[p]=1;for(p in e)g._SymbolsMap[p]=1,g[p]=e[p]&&"esri.Graphic"===e[p].declaredClass?d.createFromGraphic(e[p]):e[p];return{localStack:[],isAsync:a,mangleMap:this.mangles,spatialReference:c,globalScope:g,abortSignal:void 0===b.abortSignal||null===b.abortSignal?{aborted:!1}:b.abortSignal,localScope:null,services:b.services,console:b.console?b.console:da,lrucache:b.lrucache,symbols:{symbolCounter:0},depthCounter:1}}};return(new Function("context",
"spatialReference",c?"var runtimeCtx\x3dthis.prepare(context, true);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \nreturn lang.__awaiter(this, void 0, void 0, function* () {\n\n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n return lang.__awaiter(this, void 0, void 0, function* () {\n"+b+"\n return lastStatement; }); } \n return this.postProcess(yield mainBody()); }); ":"var runtimeCtx\x3dthis.prepare(context, false);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n "+
b+"\n return lastStatement; } \n return this.postProcess(mainBody()); ")).bind(a)};a.enableAsyncSupport=function(){return u.create(function(b,a){n(["./functions/geomasync"],function(a){X([a],"async");b(!0)},function(b){a(b)})})}})},"esri/arcade/ArcadePortal":function(){define(["require","exports","../core/tsSupport/extendsHelper","./Dictionary"],function(n,a,m,k){return function(a){function d(d){var g=a.call(this)||this;g.immutable=!1;g.setField("url",d);g.immutable=!0;return g}m(d,a);return d}(k)})},
"esri/arcade/Dictionary":function(){define(["require","exports","./ImmutableArray","./languageUtils","../geometry/Geometry"],function(n,a,m,k,h){function d(a){var f=null;if(null!==a)if(k.isNumber(a))f=k.toNumber(a);else if(k.isBoolean(a))f=k.toBoolean(a);else if(k.isString(a))f=k.toString(a);else if(k.isDate(a))f=k.toDate(a);else if(k.isArray(a))for(var f=[],c=0;c<a.length;c++)f.push(d(a[c]));else{if(0===Object.keys(a).length)return null;f=new g;f.immutable=!1;for(var c=0,b=Object.keys(a);c<b.length;c++){var e=
b[c];f.setField(e,d(a[e]))}f.immutable=!0}return f}var g=function(){function a(d){this.declaredClass="esri.arcade.Dictionary";this.attributes=null;this.plain=!1;this.immutable=!0;this.attributes=d instanceof a?d.attributes:void 0===d?{}:null===d?{}:d}a.prototype.field=function(a){var c=a.toLowerCase();a=this.attributes[a];if(void 0!==a)return a;for(var b in this.attributes)if(b.toLowerCase()===c)return this.attributes[b];throw Error("Field not Found");};a.prototype.setField=function(a,c){if(this.immutable)throw Error("Dictionary is Immutable");
var b=a.toLowerCase();if(void 0===this.attributes[a])for(var d in this.attributes)if(d.toLowerCase()===b){this.attributes[d]=c;return}this.attributes[a]=c};a.prototype.hasField=function(a){var c=a.toLowerCase();if(void 0!==this.attributes[a])return!0;for(var b in this.attributes)if(b.toLowerCase()===c)return!0;return!1};a.prototype.keys=function(){var a=[],c;for(c in this.attributes)a.push(c);return a=a.sort()};a.prototype.castToText=function(){var a="",c;for(c in this.attributes){""!==a&&(a+=",");
var b=this.attributes[c];null==b?a+=JSON.stringify(c)+":null":k.isBoolean(b)||k.isNumber(b)||k.isString(b)?a+=JSON.stringify(c)+":"+JSON.stringify(b):b instanceof h?a+=JSON.stringify(c)+":"+k.toStringExplicit(b):b instanceof m?a+=JSON.stringify(c)+":"+k.toStringExplicit(b):b instanceof Array?a+=JSON.stringify(c)+":"+k.toStringExplicit(b):b instanceof Date?a+=JSON.stringify(c)+":"+JSON.stringify(b):null!==b&&"object"===typeof b&&void 0!==b.castToText&&(a+=JSON.stringify(c)+":"+b.castToText())}return"{"+
a+"}"};a.convertObjectToArcadeDictionary=function(f){var c=new a;c.immutable=!1;for(var b in f)c.setField(b.toString(),d(f[b]));c.immutable=!0;return c};return a}();return g})},"esri/arcade/ImmutableArray":function(){define(["require","exports"],function(n,a){return function(){function a(a){void 0===a&&(a=[]);this._elements=a}a.prototype.length=function(){return this._elements.length};a.prototype.get=function(a){return this._elements[a]};a.prototype.toArray=function(){for(var a=[],h=0;h<this.length();h++)a.push(this.get(h));
return a};return a}()})},"esri/arcade/languageUtils":function(){define("require exports dojo/number ./FunctionWrapper ./ImmutableArray ./ImmutablePathArray ./ImmutablePointArray ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../core/promiseUtils ../geometry/support/coordsUtils ../core/maybe".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){function u(b,a,c){return""===a||null===a||void 0===a||a===c||a===c?b:b=b.split(a).join(c)}
function v(b){return b instanceof P||b instanceof k||b instanceof V}function y(b){return t(b)||z(b)||B(b)||x(b)||null===b||b===a.voidOperation||"number"===typeof b?!0:!1}function t(b){return"string"===typeof b||b instanceof String}function x(b){return"boolean"===typeof b}function z(b){return"number"===typeof b}function A(b){return b instanceof Array}function E(b){return b instanceof h}function B(b){return b instanceof Date}function G(b,a){if(!1===isNaN(b)){if(void 0===a||null===a||""===a)return b.toString();
a=u(a,"\u2030","");a=u(a,"\u00a4","");return m.format(b,{pattern:a})}return b.toString()}function F(b,c){b=a.MomentLibrary.Moment(b);return void 0===c||null===c||""===c?b.format():b.format(K(c))}function K(b){return b.replace(/(LTS)|L|l/g,function(b){return"["+b+"]"})}function H(b,a,c){switch(c){case "\x3e":return b>a;case "\x3c":return b<a;case "\x3e\x3d":return b>=a;case "\x3c\x3d":return b<=a}return!1}function N(c,e){if(c===e||null===c&&e===a.voidOperation||null===e&&c===a.voidOperation)return!0;
if(B(c)&&B(e))return c.getTime()===e.getTime();if(c instanceof d||c instanceof g)return c.equalityTest(e);if(c instanceof b&&e instanceof b){var f=void 0,l=void 0,f=c.cache._arcadeCacheId,l=e.cache._arcadeCacheId;if(void 0!==f&&null!==f)return f===l}return void 0!==c&&void 0!==e&&null!==c&&null!==e&&"object"===typeof c&&"object"===typeof e&&(c._arcadeCacheId===e._arcadeCacheId&&void 0!==c._arcadeCacheId&&null!==c._arcadeCacheId||c._underlyingGraphic===e._underlyingGraphic&&void 0!==c._underlyingGraphic&&
null!==c._underlyingGraphic)?!0:!1}function I(b,a){if(t(b))return b;if(null===b)return"";if(z(b))return G(b,a);if(x(b))return b.toString();if(B(b))return F(b,a);if(b instanceof f)return JSON.stringify(b.toJSON());if(A(b)){a=[];for(var c=0;c<b.length;c++)a[c]=M(b[c]);return"["+a.join(",")+"]"}if(b instanceof h){a=[];for(c=0;c<b.length();c++)a[c]=M(b.get(c));return"["+a.join(",")+"]"}return null!==b&&"object"===typeof b&&void 0!==b.castToText?b.castToText():v(b)?"object, Function":""}function J(b,a){if(t(b))return b;
if(null===b)return"";if(z(b))return G(b,a);if(x(b))return b.toString();if(B(b))return F(b,a);if(b instanceof f)return b instanceof l?'{"xmin":'+b.xmin.toString()+',"ymin":'+b.ymin.toString()+","+(b.hasZ?'"zmin":'+b.zmin.toString()+",":"")+(b.hasM?'"mmin":'+b.mmin.toString()+",":"")+'"xmax":'+b.xmax.toString()+',"ymax":'+b.ymax.toString()+","+(b.hasZ?'"zmax":'+b.zmax.toString()+",":"")+(b.hasM?'"mmax":'+b.mmax.toString()+",":"")+'"spatialReference":'+O(b.spatialReference)+"}":O(b.toJSON(),function(b,
a){return b.key===a.key?0:"spatialReference"===b.key?1:"spatialReference"===a.key||b.key<a.key?-1:b.key>a.key?1:0});if(A(b)){a=[];for(var c=0;c<b.length;c++)a[c]=M(b[c]);return"["+a.join(",")+"]"}if(b instanceof h){a=[];for(c=0;c<b.length();c++)a[c]=M(b.get(c));return"["+a.join(",")+"]"}return null!==b&&"object"===typeof b&&void 0!==b.castToText?b.castToText():v(b)?"object, Function":""}function M(b){return null===b?"null":x(b)||z(b)||t(b)?JSON.stringify(b):b instanceof f||b instanceof h||b instanceof
Array?J(b):b instanceof Date?JSON.stringify(F(b,"")):null!==b&&"object"===typeof b&&void 0!==b.castToText?b.castToText():"null"}function L(b,c){return z(b)?b:null===b||""===b?0:B(b)?NaN:x(b)?b?1:0:A(b)||""===b||void 0===b?NaN:void 0!==c&&t(b)?(c=u(c,"\u2030",""),c=u(c,"\u00a4",""),m.parse(b,{pattern:c})):b===a.voidOperation?0:Number(b)}function R(b,a){var c;a.fields.some(function(a){a.name===b&&(c=a.domain);return!!c});return c}function O(b,a){a||(a={});"function"===typeof a&&(a={cmp:a});var c="boolean"===
typeof a.cycles?a.cycles:!1,d=a.cmp&&function(b){return function(a){return function(c,d){return b({key:c,value:a[c]},{key:d,value:a[d]})}}}(a.cmp),e=[];return function ca(b){b&&b.toJSON&&"function"===typeof b.toJSON&&(b=b.toJSON());if(void 0!==b){if("number"===typeof b)return isFinite(b)?""+b:"null";if("object"!==typeof b)return JSON.stringify(b);var a,f;if(Array.isArray(b)){f="[";for(a=0;a<b.length;a++)a&&(f+=","),f+=ca(b[a])||"null";return f+"]"}if(null===b)return"null";if(-1!==e.indexOf(b)){if(c)return JSON.stringify("__cycle__");
throw new TypeError("Converting circular structure to JSON");}var g=e.push(b)-1,l=Object.keys(b).sort(d&&d(b));f="";for(a=0;a<l.length;a++){var h=l[a],p=ca(b[h]);p&&(f&&(f+=","),f+=JSON.stringify(h)+":"+p)}e.splice(g,1);return"{"+f+"}"}}(b)}function T(a,c){if(c instanceof b)a.push(c.hasZ?c.hasM?[c.x,c.y,c.z,c.m]:[c.x,c.y,c.z]:[c.x,c.y]);else throw Error("Invalid Argument");}Object.defineProperty(a,"__esModule",{value:!0});n=function(){return function(b){this.value=b}}();a.ReturnResultE=n;var U=function(){return function(b){this.value=
b}}();a.ImplicitResultE=U;var P=function(){return function(b){this.fn=b}}();a.NativeFunctionE=P;var V=function(){return function(b){this.fn=b}}();a.SizzleFunctionE=V;a.NativeFunction=P;a.ImplicitResult=U;a.ReturnResult=n;a.SizzleFunction=V;a.voidOperation={type:"VOID"};a.breakResult={type:"BREAK"};a.continueResult={type:"CONTINUE"};a.multiReplace=u;a.isFunctionParameter=v;a.isSimpleType=y;a.defaultUndefined=function(b,a){return void 0===b?a:b};a.isString=t;a.isBoolean=x;a.isNumber=z;a.isArray=A;a.isFeatureSet=
function(b){return!0===(b&&b.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===b.declaredRootClass)};a.isFeatureSetCollection=function(b){return!0===(b&&b.declaredRootClass&&"esri.arcade.featureSetCollection"===b.declaredRootClass)};a.isImmutableArray=E;a.isDate=B;a.pcCheck=function(b,a,c){if(b.length<a||b.length>c)throw Error("Function called with wrong number of Parameters");};a.generateUUID=function(){var b=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var c=(b+16*Math.random())%16|0;b=Math.floor(b/16);return("x"===a?c:c&3|8).toString(16)})};a.formatNumber=G;a.formatDate=F;a.standardiseDateFormat=K;a.greaterThanLessThan=function(b,c,d){if(null===b){if(null===c||c===a.voidOperation)return H(null,null,d);if(z(c))return H(0,c,d);if(t(c)||x(c))return H(0,L(c),d);if(B(c))return H(0,c.getTime(),d)}if(b===a.voidOperation){if(null===c||c===a.voidOperation)return H(null,null,d);if(z(c))return H(0,c,d);if(t(c)||x(c))return H(0,L(c),d);if(B(c))return H(0,
c.getTime(),d)}else if(z(b)){if(z(c))return H(b,c,d);if(x(c))return H(b,L(c),d);if(null===c||c===a.voidOperation)return H(b,0,d);if(t(c))return H(b,L(c),d);if(B(c))return H(b,c.getTime(),d)}else if(t(b)){if(t(c))return H(I(b),I(c),d);if(B(c))return H(L(b),c.getTime(),d);if(z(c))return H(L(b),c,d);if(null===c||c===a.voidOperation)return H(L(b),0,d);if(x(c))return H(L(b),L(c),d)}else if(B(b)){if(B(c))return H(b,c,d);if(null===c||c===a.voidOperation)return H(b.getTime(),0,d);if(z(c))return H(b.getTime(),
c,d);if(x(c)||t(c))return H(b.getTime(),L(c),d)}else if(x(b)){if(x(c))return H(b,c,d);if(z(c))return H(L(b),L(c),d);if(B(c))return H(L(b),c.getTime(),d);if(null===c||c===a.voidOperation)return H(L(b),0,d);if(t(c))return H(L(b),L(c),d)}return!N(b,c)||"\x3c\x3d"!==d&&"\x3e\x3d"!==d?!1:!0};a.equalityTest=N;a.toString=I;a.toNumberArray=function(b){var a=[];if(!1===A(b))return null;if(b instanceof h){for(var c=0;c<b.length();c++)a[c]=L(b.get(c));return a}for(c=0;c<b.length;c++)a[c]=L(b[c]);return a};a.toStringExplicit=
J;a.toNumber=L;a.toDate=function(b,c){return B(b)?b:t(b)&&(b=a.MomentLibrary.Moment(b,[void 0===c||null===c||""===c?a.MomentLibrary.Moment.ISO_8601:c]),b.isValid())?b.toDate():null};a.toDateM=function(b,c){return B(b)?a.MomentLibrary.Moment(b):t(b)&&(b=a.MomentLibrary.Moment(b,[void 0===c||null===c||""===c?a.MomentLibrary.Moment.ISO_8601:c]),b.isValid())?b:null};a.toBoolean=function(b){return x(b)?b:t(b)?(b=b.toLowerCase(),"true"===b?!0:!1):z(b)?0===b||isNaN(b)?!1:!0:!1};a.fixSpatialReference=function(b,
a){if(w.isNone(b))return null;if(null===b.spatialReference||void 0===b.spatialReference)b.spatialReference=a;return b};a.fixNullGeometry=function(a){return null===a?null:a instanceof b?"NaN"===a.x||null===a.x||isNaN(a.x)?null:a:a instanceof e?0===a.rings.length?null:a:a instanceof p?0===a.paths.length?null:a:a instanceof c?0===a.points.length?null:a:a instanceof l?"NaN"===a.xmin||null===a.xmin||isNaN(a.xmin)?null:a:null};a.getDomainValue=function(b,a){if(!b||!b.domain)return a;var c=null;a="string"===
b.field.type||"esriFieldTypeString"===b.field.type?I(a):L(a);for(var d=0;d<b.domain.codedValues.length;d++){var e=b.domain.codedValues[d];e.code===a&&(c=e)}return null===c?a:c.name};a.getDomainCode=function(b,a){if(!b||!b.domain)return a;var c=null;a=I(a);for(var d=0;d<b.domain.codedValues.length;d++){var e=b.domain.codedValues[d];e.name===a&&(c=e)}return null===c?a:c.code};a.getDomain=function(b,a,c,d){void 0===c&&(c=null);if(!a||!a.fields)return null;for(var e=null,f=0;f<a.fields.length;f++){var g=
a.fields[f];g.name.toLowerCase()===b.toString().toLowerCase()&&(e=g)}if(null===e)throw Error("Field not found");var l,h;d||(d=c&&a.typeIdField&&c._field(a.typeIdField));null!=d&&a.types.some(function(b){return b.id===d?((l=b.domains&&b.domains[e.name])&&"inherited"===l.type&&(l=R(e.name,a),h=!0),!0):!1});h||l||(l=R(b,a));return{field:e,domain:l}};a.stableStringify=O;a.autoCastFeatureToGeometry=function(b){if(null===b)return null;for(var a=[],c=0;c<b.length;c++){var d=b[c];d&&d.declaredClass&&"esri.arcade.Feature"===
d.declaredClass?a.push(d.geometry()):a.push(d)}return a};a.autoCastArrayOfPointsToPolygon=function(b,a){if(A(b)||E(b)){var c=!1,d=!1,f=[];if(A(b)){for(var l=0;l<b.length;l++){var h=b[l];T(f,h)}0<f.length&&(a=b[0].spatialReference,c=b[0].hasZ,d=b[0].hasM)}else if(b instanceof g)f=b._elements,0<f.length&&(c=b._hasZ,d=b._hasM,a=b.get(0).spatialReference);else if(E(b)){for(var l=0,p=b.toArray();l<p.length;l++)h=p[l],T(f,h);0<f.length&&(a=b.get(0).spatialReference,c=!0===b.get(0).hasZ,d=!0===b.get(0).hasM)}else throw Error("Invalid Argument");
if(0===f.length)return null;!1===r.isClockwise(f,d,c)&&(f=f.slice(0).reverse());return new e({rings:[f],spatialReference:a,hasZ:c,hasM:d})}return b};a.autoCastArrayOfPointsToPolyline=function(b,a){if(A(b)||E(b)){var c=!1,d=!1,e=[];if(A(b)){for(var f=0;f<b.length;f++){var l=b[f];T(e,l)}0<e.length&&(a=b[0].spatialReference,c=!0===b[0].hasZ,d=!0===b[0].hasM)}else if(b instanceof g)e=b._elements,0<e.length&&(c=b._hasZ,d=b._hasM,a=b.get(0).spatialReference);else if(E(b)){for(var f=0,h=b.toArray();f<h.length;f++)l=
h[f],T(e,l);0<e.length&&(a=b.get(0).spatialReference,c=!0===b.get(0).hasZ,d=!0===b.get(0).hasM)}return 0===e.length?null:new p({paths:[e],spatialReference:a,hasZ:c,hasM:d})}return b};a.autoCastArrayOfPointsToMultiPoint=function(b,a){if(A(b)||E(b)){var d=!1,e=!1,f=[];if(A(b)){for(var l=0;l<b.length;l++){var h=b[l];T(f,h)}0<f.length&&(a=b[0].spatialReference,d=!0===b[0].hasZ,e=!0===b[0].hasM)}else if(b instanceof g)f=b._elements,0<f.length&&(d=b._hasZ,e=b._hasM,a=b.get(0).spatialReference);else if(E(b)){for(var l=
0,p=b.toArray();l<p.length;l++)h=p[l],T(f,h);0<f.length&&(a=b.get(0).spatialReference,d=!0===b.get(0).hasZ,e=!0===b.get(0).hasM)}return 0===f.length?null:new c({points:f,spatialReference:a,hasZ:d,hasM:e})}return b};a.toStringArray=function(b,a){void 0===a&&(a=!1);var c=[];if(null===b)return c;if(!0===A(b)){for(var d=0;d<b.length;d++){var e=I(b[d]);""===e&&!0!==a||c.push(e)}return c}if(b instanceof h){for(d=0;d<b.length();d++)e=I(b.get(d)),""===e&&!0!==a||c.push(e);return c}return y(b)?(e=I(b),""===
e&&!0!==a||c.push(e),c):[]};var W=0;a.tick=function(b){W++;return 0===W%100?(W=0,q.create(function(a,c){setTimeout(function(){a(b)},0)})):b};a.MomentLibrary={Moment:null}})},"esri/arcade/FunctionWrapper":function(){define(["require","exports"],function(n,a){return function(){return function(a,k){this.context=this.definition=null;this.definition=a;this.context=k}}()})},"esri/arcade/ImmutablePathArray":function(){define(["require","exports","../core/tsSupport/extendsHelper","./ImmutableArray","./ImmutablePointArray"],
function(n,a,m,k,h){return function(a){function d(d,f,c,b,e){d=a.call(this,d)||this;d._lazyPath=[];d._hasZ=!1;d._hasM=!1;d._hasZ=c;d._hasM=b;d._spRef=f;d._cacheId=e;return d}m(d,a);d.prototype.get=function(a){if(void 0===this._lazyPath[a]){var d=this._elements[a];if(void 0===d)return;this._lazyPath[a]=new h(d,this._spRef,this._hasZ,this._hasM,this._cacheId,a)}return this._lazyPath[a]};d.prototype.equalityTest=function(a){return a===this?!0:null===a||!1===a instanceof d?!1:a.getUniqueHash()===this.getUniqueHash()};
d.prototype.getUniqueHash=function(){return this._cacheId.toString()};return d}(k)})},"esri/arcade/ImmutablePointArray":function(){define(["require","exports","../core/tsSupport/extendsHelper","./ImmutableArray","../geometry/Point"],function(n,a,m,k,h){return function(a){function d(d,f,c,b,e,g){d=a.call(this,d)||this;d._lazyPt=[];d._hasZ=!1;d._hasM=!1;d._spRef=f;d._hasZ=c;d._hasM=b;d._cacheId=e;d._partId=g;return d}m(d,a);d.prototype.get=function(a){if(void 0===this._lazyPt[a]){var d=this._elements[a];
if(void 0===d)return;var c=this._hasZ,b=this._hasM,e=null,e=c&&!b?new h(d[0],d[1],d[2],void 0,this._spRef):b&&c?new h(d[0],d[1],void 0,d[2],this._spRef):c&&b?new h(d[0],d[1],d[2],d[3],this._spRef):new h(d[0],d[1],this._spRef);e.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+a.toString();this._lazyPt[a]=e}return this._lazyPt[a]};d.prototype.equalityTest=function(a){return a===this?!0:null===a||!1===a instanceof d?!1:a.getUniqueHash()===this.getUniqueHash()};d.prototype.getUniqueHash=
function(){return this._cacheId.toString()+"-"+this._partId.toString()};return d}(k)})},"esri/arcade/Attachment":function(){define(["require","exports","../core/tsSupport/extendsHelper","./Dictionary"],function(n,a,m,k){return function(a){function d(d,l,f,c,b){var e=a.call(this)||this;e.attachmentUrl=b;e.immutable=!1;e.setField("id",d);e.setField("name",l);e.setField("contenttype",f);e.setField("size",c);e.immutable=!0;return e}m(d,a);return d}(k)})},"esri/arcade/Feature":function(){define("require exports ../core/tsSupport/assignHelper ./Dictionary ./ImmutableArray ./languageUtils ../geometry/Geometry ../geometry/Point ../geometry/support/jsonUtils ../layers/graphics/featureConversionUtils ../core/maybe".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){return function(){function a(){this.declaredClass="esri.arcade.Feature";this._layer=this.attributes=this._geometry=this._optimizedGeomDefinition=null;this.immutable=this._datesfixed=!0;this._datefields=null;this.immutable=!0}a.createFromGraphic=function(c){var d=new a;d._geometry=b.isSome(c.geometry)?c.geometry:null;d.attributes=void 0===c.attributes?{}:null===c.attributes?{}:c.attributes;c._sourceLayer?(d._layer=c._sourceLayer,d._datesfixed=!1):c._layer?(d._layer=
c._layer,d._datesfixed=!1):c.layer&&(d._layer=c.layer,d._datesfixed=!1);return d};a.createFromArcadeFeature=function(b){var c=new a;c._datesfixed=b._datesfixed;c.attributes=b.attributes;c._geometry=b._geometry;c._optimizedGeomDefinition=b._optimizedGeomDefinition;b._layer&&(c._layer=b._layer);return c};a.createFromOptimisedFeature=function(b,c,d){var e=new a;e._geometry=b.geometry?{geometry:b.geometry}:null;e._optimizedGeomDefinition=d;e.attributes=b.attributes||{};e._layer=c;e._datesfixed=!1;return e};
a.createFromArcadeDictionary=function(b){var c=new a;c.attributes=b.field("attributes");null!==c.attributes?c.attributes instanceof k?(c.attributes=c.attributes.attributes,null===c.attributes&&(c.attributes={})):c.attributes={}:c.attributes={};c._geometry=b.field("geometry");null!==c._geometry&&(c._geometry instanceof k?c._geometry=a.parseGeometryFromDictionary(c._geometry):c._geometry instanceof g||(c._geometry=null));return c};a.createFromGraphicLikeObject=function(c,d,e){void 0===e&&(e=null);var f=
new a;null===d&&(d={});f.attributes=d;f._geometry=b.isSome(c)?c:null;f._layer=e;f._layer&&(f._datesfixed=!1);return f};a.prototype.repurposeFromGraphicLikeObject=function(b,a,c){void 0===c&&(c=null);null===a&&(a={});this.attributes=a;this._geometry=b?b:null;this._datesfixed=(this._layer=c)?!1:!0};a.prototype.castToText=function(){var b="",a;for(a in this.attributes){""!==b&&(b+=",");var c=this.attributes[a];null==c?b+=JSON.stringify(a)+":null":d.isBoolean(c)||d.isNumber(c)||d.isString(c)?b+=JSON.stringify(a)+
":"+JSON.stringify(c):c instanceof g?b+=JSON.stringify(a)+":"+d.toStringExplicit(c):c instanceof h?b+=JSON.stringify(a)+":"+d.toStringExplicit(c):c instanceof Array?b+=JSON.stringify(a)+":"+d.toStringExplicit(c):c instanceof Date?b+=JSON.stringify(a)+":"+JSON.stringify(c):null!==c&&"object"===typeof c&&void 0!==c.castToText&&(b+=JSON.stringify(a)+":"+c.castToText())}return'{"geometry":'+(null===this.geometry()?"null":d.toStringExplicit(this.geometry()))+',"attributes":{'+b+"}}"};a.prototype._fixDates=
function(){if(null!==this._datefields)0<this._datefields.length&&this._fixDateFields(this._datefields);else{for(var b=[],a=0;a<this._layer.fields.length;a++){var c=this._layer.fields[a];"date"!==c.type&&"esriFieldTypeDate"!==c.type||b.push(c.name)}this._datefields=b;0<b.length&&this._fixDateFields(b)}this._datesfixed=!0};a.prototype._fixDateFields=function(b){this.attributes=m({},this.attributes);for(var a=0;a<b.length;a++){var c=this.attributes[b[a]];if(null!==c)if(void 0===c)for(var d in this.attributes){if(d.toLowerCase()===
b[a].toLowerCase()){c=this.attributes[d];null===c||c instanceof Date||(this.attributes[d]=new Date(c));break}}else c instanceof Date||(this.attributes[b[a]]=new Date(c))}};a.prototype.geometry=function(){if(null===this._geometry||this._geometry instanceof g)return this._geometry;this._optimizedGeomDefinition?(this._geometry=b.unwrap(f.fromJSON(c.convertToGeometry(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM))),this._geometry.spatialReference=
this._optimizedGeomDefinition.spatialReference):this._geometry=b.unwrap(f.fromJSON(this._geometry));return this._geometry};a.prototype.field=function(b){!1===this._datesfixed&&this._fixDates();var a=this.attributes[b];if(void 0!==a)return a;b=b.toLowerCase();for(var c in this.attributes)if(c.toLowerCase()===b)return this.attributes[c];if(this._hasFieldDefinition(b))return null;throw Error("Field not Found");};a.prototype._hasFieldDefinition=function(b){if(null===this._layer)return!1;for(var a=0;a<
this._layer.fields.length;a++)if(this._layer.fields[a].name.toLowerCase()===b)return!0;return!1};a.prototype._field=function(b){!1===this._datesfixed&&this._fixDates();var a=b.toLowerCase();b=this.attributes[b];if(void 0!==b)return b;for(var c in this.attributes)if(c.toLowerCase()===a)return this.attributes[c];return null};a.prototype.setField=function(b,a){if(this.immutable)throw Error("Feature is Immutable");if(!1===d.isSimpleType(a))throw Error("Illegal Value Assignment to Feature");var c=b.toLowerCase();
if(void 0===this.attributes[b])for(var e in this.attributes)if(e.toLowerCase()===c){this.attributes[e]=a;return}this.attributes[b]=a};a.prototype.hasField=function(b){var a=b.toLowerCase();if(void 0!==this.attributes[b])return!0;for(var c in this.attributes)if(c.toLowerCase()===a)return!0;return this._hasFieldDefinition(a)?!0:!1};a.prototype.keys=function(){var b=[],a={},c;for(c in this.attributes)b.push(c),a[c.toLowerCase()]=1;if(null!==this._layer)for(c=0;c<this._layer.fields.length;c++){var d=
this._layer.fields[c];1!==a[d.name.toLowerCase()]&&b.push(d.name)}return b=b.sort()};a.parseGeometryFromDictionary=function(b){b=a.convertDictionaryToJson(b,!0);void 0!==b.spatialreference&&(b.spatialReference=b.spatialreference,delete b.spatialreference);void 0!==b.rings&&(b.rings=this.fixPathArrays(b.rings,!0===b.hasZ,!0===b.hasM));void 0!==b.paths&&(b.paths=this.fixPathArrays(b.paths,!0===b.hasZ,!0===b.hasM));void 0!==b.points&&(b.points=this.fixPointArrays(b.points,!0===b.hasZ,!0===b.hasM));return f.fromJSON(b)};
a.fixPathArrays=function(b,a,c){var d=[];if(b instanceof Array)for(var e=0;e<b.length;e++)d.push(this.fixPointArrays(b[e],a,c));else if(b instanceof h)for(e=0;e<b.length();e++)d.push(this.fixPointArrays(b.get(e),a,c));return d};a.fixPointArrays=function(b,a,c){var d=[];if(b instanceof Array)for(var e=0;e<b.length;e++){var f=b[e];f instanceof l?a&&c?d.push([f.x,f.y,f.z,f.m]):a?d.push([f.x,f.y,f.z]):c?d.push([f.x,f.y,f.m]):d.push([f.x,f.y]):f instanceof h?d.push(f.toArray()):d.push(f)}else if(b instanceof
h)for(e=0;e<b.length();e++)f=b.get(e),f instanceof l?a&&c?d.push([f.x,f.y,f.z,f.m]):a?d.push([f.x,f.y,f.z]):c?d.push([f.x,f.y,f.m]):d.push([f.x,f.y]):f instanceof h?d.push(f.toArray()):d.push(f);return d};a.convertDictionaryToJson=function(b,c){void 0===c&&(c=!1);var d={},e;for(e in b.attributes){var f=b.attributes[e];f instanceof k&&(f=a.convertDictionaryToJson(f));c?d[e.toLowerCase()]=f:d[e]=f}return d};a.parseAttributesFromDictionary=function(b){var a={},c;for(c in b.attributes){var e=b.attributes[c];
if(d.isSimpleType(e))a[c]=e;else throw Error("Illegal Argument");}return a};a.fromJson=function(b){var c=null;null!==b.geometry&&void 0!==b.geometry&&(c=f.fromJSON(b.geometry));var e={};if(null!==b.attributes&&void 0!==b.attributes)for(var g in b.attributes){var l=b.attributes[g];if(null===l)e[g]=l;else if(d.isString(l)||d.isNumber(l)||d.isBoolean(l)||d.isDate(l))e[g]=l;else throw Error("Illegal Argument");}return a.createFromGraphicLikeObject(c,e,null)};a.prototype.domainValueLookup=function(b,a,
c){if(null===this._layer||!this._layer.fields)return null;c=d.getDomain(b,this._layer,this,c);if(void 0===a)try{a=this.field(b)}catch(w){return null}return d.getDomainValue(c,a)};a.prototype.domainCodeLookup=function(b,a,c){if(null===this._layer||!this._layer.fields)return null;if(void 0===a){try{a=this.field(b)}catch(w){return null}return a}b=d.getDomain(b,this._layer,this,c);return d.getDomainCode(b,a)};return a}()})},"esri/layers/graphics/featureConversionUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),
function(n,a,m,k,h,d,g,l){function f(b,a){return b?a?4:3:a?3:2}function c(b,a){return Math.round((a-b.translate[0])/b.scale[0])}function b(b,a){return Math.round((b.translate[1]-a)/b.scale[1])}function e(b,a){return a*b.scale[0]+b.translate[0]}function p(b,a){return b.translate[1]-a*b.scale[1]}function q(b){b=b.coords;return{x:b[0],y:b[1]}}function r(b,a){b.coords[0]=a.x;b.coords[1]=a.y;return b}function w(b){b=b.coords;return{x:b[0],y:b[1],z:b[2]}}function u(b,a){b.coords[0]=a.x;b.coords[1]=a.y;
b.coords[2]=a.z;return b}function v(b){b=b.coords;return{x:b[0],y:b[1],m:b[2]}}function y(b,a){b.coords[0]=a.x;b.coords[1]=a.y;b.coords[2]=a.m;return b}function t(b){b=b.coords;return{x:b[0],y:b[1],z:b[2],m:b[3]}}function x(b,a){b.coords[0]=a.x;b.coords[1]=a.y;b.coords[2]=a.z;b.coords[3]=a.m;return b}function z(b,a){return b&&a?x:b?u:a?y:r}function A(b,a,c){if(!b)return null;for(var d=f(a,c),e=[],g=0;g<b.coords.length;g+=d){for(var l=[],h=0;h<d;h++)l.push(b.coords[g+h]);e.push(l)}return a?c?{points:e,
hasZ:a,hasM:c}:{points:e,hasZ:a}:c?{points:e,hasM:c}:{points:e}}function E(b,a,c){void 0===c&&(c=f(a.hasZ,a.hasM));b.lengths[0]=a.points.length;var d=b.coords,e=0,g=0;for(a=a.points;g<a.length;g++)for(var l=a[g],h=0;h<c;h++)d[e++]=l[h];return b}function B(b,a,c){if(!b)return null;var d=f(a,c),e=b.coords,g=[],l=0,h=0;for(b=b.lengths;h<b.length;h++){for(var p=b[h],k=[],q=0;q<p;q++){for(var m=[],u=0;u<d;u++)m.push(e[l++]);k.push(m)}g.push(k)}return a?c?{paths:g,hasZ:a,hasM:c}:{paths:g,hasZ:a}:c?{paths:g,
hasM:c}:{paths:g}}function G(b,a,c){void 0===c&&(c=f(a.hasZ,a.hasM));var d=b.lengths,e=b.coords,g=0,l=0;for(a=a.paths;l<a.length;l++){for(var h=a[l],p=0,k=h;p<k.length;p++)for(var q=k[p],m=0;m<c;m++)e[g++]=q[m];d.push(h.length)}return b}function F(b,a,c){if(!b)return null;var d=f(a,c),e=b.coords,g=[],l=0,h=0;for(b=b.lengths;h<b.length;h++){for(var p=b[h],k=[],q=0;q<p;q++){for(var m=[],u=0;u<d;u++)m.push(e[l++]);k.push(m)}g.push(k)}return a?c?{rings:g,hasZ:a,hasM:c}:{rings:g,hasZ:a}:c?{rings:g,hasM:c}:
{rings:g}}function K(b,a,c,d){void 0===c&&(c=a.hasZ);void 0===d&&(d=a.hasM);H(b,a.rings,c,d);return b}function H(b,a,c,d){c=f(c,d);d=b.lengths;for(var e=b.coords,g=0,l=d.length=e.length=0;l<a.length;l++){for(var h=a[l],p=0,k=h;p<k.length;p++)for(var q=k[p],m=0;m<c;m++)e[g++]=q[m];d.push(h.length)}return b}function N(b,a,c,e,g,h){b.length=0;if(!c){for(e=0;e<a.length;e++)g=a[e],b.push(new d.default(null,g.attributes,null,g.attributes[h]));return b}switch(c){case "esriGeometryPoint":e=z(e,g);for(g=0;g<
a.length;g++){var p=a[g];c=p.geometry;var p=p.attributes,k=void 0;c&&(k=e(new l.default,c));b.push(new d.default(k,p,null,p[h]))}break;case "esriGeometryMultipoint":e=f(e,g);for(g=0;g<a.length;g++)p=a[g],c=p.geometry,p=p.attributes,k=void 0,c&&(k=E(new l.default,c,e)),b.push(new d.default(k,p,null,p[h]));break;case "esriGeometryPolyline":e=f(e,g);for(g=0;g<a.length;g++)p=a[g],c=p.geometry,p=p.attributes,k=void 0,c&&(k=G(new l.default,c,e)),b.push(new d.default(k,p,null,p[h]));break;case "esriGeometryPolygon":for(c=
0;c<a.length;c++){var q=a[c],p=q.geometry,k=q.centroid,q=q.attributes,u=void 0;p&&(u=K(new l.default,p,e,g));k?b.push(new d.default(u,q,r(new l.default,k),q[h])):b.push(new d.default(u,q,null,q[h]))}break;default:R.error("convertToFeatureSet:unknown-geometry",new m("Unable to parse unknown geometry type '"+c+"'")),b.length=0}return b}function I(b,a,c,d,e){b.length=0;switch(c){case "esriGeometryPoint":c=q;d&&e?c=t:d?c=w:e&&(c=v);for(d=0;d<a.length;d++){var f=a[d];e=f.geometry;f=f.attributes;e=e?c(e):
null;b.push({attributes:f,geometry:e})}break;case "esriGeometryMultipoint":for(c=0;c<a.length;c++){var g=a[c],f=g.geometry,g=g.attributes,l=void 0;f&&(l=A(f,d,e));b.push({attributes:g,geometry:l})}break;case "esriGeometryPolyline":for(c=0;c<a.length;c++)g=a[c],f=g.geometry,g=g.attributes,l=void 0,f&&(l=B(f,d,e)),b.push({attributes:g,geometry:l});break;case "esriGeometryPolygon":for(c=0;c<a.length;c++){var l=a[c],g=l.geometry,f=l.attributes,h=l.centroid,l=void 0;g&&(l=F(g,d,e));h?(g=q(h),b.push({attributes:f,
centroid:g,geometry:l})):b.push({attributes:f,geometry:l})}break;default:R.error("convertToFeatureSet:unknown-geometry",new m("Unable to parse unknown geometry type '"+c+"'"))}return b}function J(a,d,e,g,l,h){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!d||!d.coords.length)return null;l=O[l];var p=d.coords;d=d.lengths;var k=f(e,g);e=e?g?P:U:g?U:T;if(!d.length)return e(a.coords,p,0,0,c(h,p[0]),b(h,p[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=k,a;
for(var q,m,u,r=0,w,x=0,t=0;t<d.length;t++){var v=d[t];if(!(v<l)){var y=0;w=x;m=g=c(h,p[r]);u=q=b(h,p[r+1]);e(a.coords,p,w,r,m,u);y++;r+=k;w+=k;for(var z=1;z<v;z++,r+=k)if(m=c(h,p[r]),u=b(h,p[r+1]),m!==g||u!==q)e(a.coords,p,w,r,m-g,u-q),w+=k,y++,g=m,q=u;y>=l&&(a.lengths.push(y),x=w)}}a.coords.length=x;return a.coords.length?a:null}function M(b,a,c,d,e,f,g){for(var l=g-c,h=0,p=0,k,q=f+c;q<g-c;q+=c){k=a[q];var m=a[q+1],u=a[f],r=a[f+1],w=a[l],x=a[l+1];u===w?k=Math.abs(k-u):(w=(x-r)/(w-u),k=Math.abs(w*
k-m+(r-w*u))/Math.sqrt(w*w+1));k>h&&(p=q,h=k)}h>d?(M(b,a,c,d,e,f,p+c),M(b,a,c,d,e,p,g)):(e(b,a,b.length,f,a[f],a[f+1]),e(b,a,b.length,l,a[l],a[l+1]))}function L(b,a,c,d,g){var l=a.coords,h=a.lengths,k=c?d?P:U:d?U:T;c=f(c,d);if(!l.length)return b!==a&&(b.lengths.length=0,b.coords.length=0),b;if(!h.length)return k(b.coords,l,0,0,e(g,l[0]),p(g,l[1])),b!==a&&(b.lengths.length=0,b.coords.length=c),b;var q=g.scale;d=q[0];for(var q=q[1],m=0,u=0;u<h.length;u++){var r=h[u];b.lengths[u]=r;var w=e(g,l[m]),x=
p(g,l[m+1]);k(b.coords,l,m,m,w,x);for(var m=m+c,t=1;t<r;t++,m+=c)w+=l[m]*d,x-=l[m+1]*q,k(b.coords,l,m,m,w,x)}b!==a&&(b.lengths.length=h.length,b.coords.length=l.length);return b}Object.defineProperty(a,"__esModule",{value:!0});var R=k.getLogger("esri.tasks.support.optimizedFeatureSet"),O={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},T=function(b,a,c,d,e,f){b[c]=e;b[c+1]=f},U=function(b,a,c,d,e,f){b[c]=e;b[c+1]=f;b[c+2]=a[d+2]},P=function(b,a,c,d,e,f){b[c]=
e;b[c+1]=f;b[c+2]=a[d+2];b[c+3]=a[d+3]};a.quantizeX=c;a.quantizeY=b;a.hydrateX=e;a.hydrateY=p;a.convertToPoint=function(b,a,c){return b?a?c?t(b):w(b):c?v(b):q(b):null};a.convertFromPoint=function(b,a,c){void 0===c&&(c=z(null!=a.z,null!=a.m));return c(b,a)};a.convertToMultipoint=A;a.convertFromMultipoint=E;a.convertToPolyline=B;a.convertFromPolyline=G;a.convertToPolygon=F;a.convertFromPolygon=K;a.convertFromNestedArray=H;var V=[],W=[];a.convertFromFeature=function(b,a,c,d,e){V[0]=b;b=N(W,V,a,c,d,e)[0];
V.length=W.length=0;return b};a.convertFromFeatures=N;a.convertToFeature=function(b,a,c,d){W[0]=b;I(V,W,a,c,d);b=V[0];V.length=W.length=0;return b};a.convertFromGeometry=function(b,a,c){if(!b)return null;var d=new l.default;"hasZ"in b&&null==a&&(a=b.hasZ);"hasM"in b&&null==c&&(c=b.hasM);if(h.isPoint(b))return z(null!=a?a:null!=b.z,null!=c?c:null!=b.m)(d,b);if(h.isPolygon(b))return K(d,b,a,c);if(h.isPolyline(b))return G(d,b,f(a,c));if(h.isMultipoint(b))return E(d,b,f(a,c));R.error("convertFromGeometry:unknown-geometry",
new m("Unable to parse unknown geometry type '"+b+"'"))};a.convertToGeometry=function(b,a,c,d){b=b&&("coords"in b?b:b.geometry);if(!b)return null;switch(a){case "esriGeometryPoint":return a=q,c&&d?a=t:c?a=w:d&&(a=v),a(b);case "esriGeometryMultipoint":return A(b,c,d);case "esriGeometryPolyline":return B(b,c,d);case "esriGeometryPolygon":return F(b,c,d);default:R.error("convertToGeometry:unknown-geometry",new m("Unable to parse unknown geometry type '"+a+"'"))}};a.convertToFeatures=I;a.convertToFeatureSet=
function(b){var a=b.objectIdFieldName,c=b.spatialReference,d=b.transform,e=b.fields,f=b.hasM,g=b.hasZ,l=b.geometryType,h=b.exceededTransferLimit;b={features:I([],b.features,l,g,f),fields:e,geometryType:l,objectIdFieldName:a,spatialReference:c};d&&(b.transform=d);h&&(b.exceededTransferLimit=h);f&&(b.hasM=f);g&&(b.hasZ=g);return b};a.convertFromFeatureSet=function(b,a){var c=new g.default,d=b.hasM,e=b.hasZ,f=b.features,l=b.objectIdFieldName,h=b.spatialReference,p=b.geometryType,k=b.exceededTransferLimit,
q=b.transform;c.fields=b.fields;c.geometryType=p;c.objectIdFieldName=l||a;c.spatialReference=h;if(!c.objectIdFieldName)return R.error(new m("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),c;f&&N(c.features,f,p,e,d,c.objectIdFieldName);k&&(c.exceededTransferLimit=k);d&&(c.hasM=d);e&&(c.hasZ=e);q&&(c.transform=q);return c};a.hydrateOptimizedFeatureSet=function(b){var a=b.transform,c=b.hasM,d=b.hasZ;if(!a)return b;for(var e=0,f=b.features;e<f.length;e++){var g=f[e];g.geometry&&
L(g.geometry,g.geometry,c,d,a);g.centroid&&L(g.centroid,g.centroid,c,d,a)}b.transform=null;return b};a.quantizeOptimizedFeatureSet=function(b,a){var c=a.geometryType,e=a.features,f=a.hasM,g=a.hasZ;if(!b)return a;for(var h=0;h<e.length;h++){var p=e[h],k=new d.default(new l.default,p.attributes);J(k.geometry,p.geometry,f,g,c,b);p.centroid&&(k.centroid=new l.default,J(k.centroid,p.centroid,f,g,"esriGeometryPoint",b));e[h]=k}a.transform=b;return a};a.quantizeOptimizedGeometry=J;a.quantizeOptimizedGeometryRemoveCollinear=
function(a,d,e,g,l,h){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!d||!d.coords.length)return null;l=O[l];var p=d.coords;d=d.lengths;var k=f(e,g);e=e?g?P:U:g?U:T;if(!d.length)return e(a.coords,p,0,0,c(h,p[0]),b(h,p[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=k,a;for(var q,m,u,r=0,w,x=0,t=0;t<d.length;t++){var v=d[t];if(!(v<l)){var y=0;w=x;g=q=c(h,p[r]);u=m=b(h,p[r+1]);e(a.coords,p,w,r,g,u);y++;for(var r=r+k,z=!1,n=0,A=0,J=1;J<v;J++,r+=k)if(g=c(h,
p[r]),u=b(h,p[r+1]),g!==q||u!==m)q=g-q,m=u-m,z&&(0===n&&0===q||0===A&&0===m)?(n+=q,A+=m):(z=!0,n=q,A=m,w+=k,y++),e(a.coords,p,w,r,n,A),q=g,m=u;z&&(w+=k,e(a.coords,p,w,r,n,A));y>=l&&(a.lengths.push(y),x=w)}}a.coords.length!==x&&(a.coords.length=x);return a.coords.length?a:null};a.generalizeOptimizedGeometry=function(b,a,c,d,e,g){b.lengths.length&&(b.lengths.length=0);b.coords.length&&(b.coords.length=0);if(!a||!a.coords.length)return null;e=O[e];var l=a.coords;a=a.lengths;var h=f(c,d);c=c?d?P:U:d?
U:T;if(!a.length)return c(b.coords,l,0,0,l[0],l[1]),b.lengths.length&&(b.lengths.length=0),b.coords.length=h,b;for(var p=d=0;p<a.length;p++){var k=a[p];if(!(k<e)){var q=b.coords.length/h;M(b.coords,l,h,g,c,d,d+k*h);var m=b.coords.length/h-q;m>=e?b.lengths.push(m):b.coords.length=q*h}d+=k*h}return b.coords.length?b:null};a.getBoundsOptimizedGeometry=function(b,a,c,d){c=f(c,d);var e=d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(a&&a.coords){a=a.coords;for(var h=
0;h<a.length;h+=c){var p=a[h],k=a[h+1];d=Math.min(d,p);g=Math.max(g,p);e=Math.min(e,k);l=Math.max(l,k)}}b[0]=d;b[1]=e;b[2]=g;b[3]=l;return b};a.getQuantizedBoundsOptimizedGeometry=function(b,a,c,d){c=f(c,d);d=a.coords;var e=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,p=0,k=0;for(a=a.lengths;k<a.length;k++)for(var q=a[k],m=d[p],u=d[p+1],e=Math.min(m,e),g=Math.min(u,g),l=Math.max(m,l),h=Math.max(u,h),p=p+c,r=1;r<q;r++,p+=c){var w=d[p],x=
d[p+1],m=m+w,u=u+x;0>w&&(e=Math.min(e,m));0<w&&(l=Math.max(l,m));0>x?g=Math.min(g,u):0<x&&(h=Math.max(h,u))}b[0]=e;b[1]=g;b[2]=l;b[3]=h;return b};a.hydrateOptimizedGeometry=L})},"esri/arcade/treeAnalysis":function(){define(["require","exports"],function(n,a){function m(b,a,c,d){return"0"!==b.min&&c.length<Number(b.min)||"*"!==b.max&&c.length>Number(b.max)?-2:1}function k(b,a,c){if(null!==c.localScope&&void 0!==c.localScope[b.toLowerCase()]){var d=c.localScope[b.toLowerCase()];if("FormulaFunction"===
d.type||"any"===d.type)return void 0===d.signature&&(d.signature={min:"0",max:"*"}),m(d.signature,b,a,c)}return void 0!==c.globalScope[b.toLowerCase()]&&(d=c.globalScope[b.toLowerCase()],"FormulaFunction"===d.type||"any"===d.type)?(void 0===d.signature&&(d.signature={min:"0",max:"*"}),m(d.signature,b,a,c)):-1}function h(b,a){if(b)for(var c=0;c<b.length;c++)d(b[c],a)}function d(b,a){if(b&&!1!==a(b))switch(b.type){case "ArrayExpression":h(b.elements,a);break;case "AssignmentExpression":case "BinaryExpression":d(b.left,
a);d(b.right,a);break;case "BlockStatement":h(b.body,a);break;case "CallExpression":d(b.callee,a);h(b.arguments,a);break;case "ConditionalExpression":d(b.test,a);d(b.alternate,a);d(b.consequent,a);break;case "DoWhileStatement":d(b.test,a);d(b.body,a);break;case "ExpressionStatement":d(b.expression,a);break;case "ForInStatement":d(b.left,a);d(b.right,a);d(b.body,a);break;case "ForStatement":d(b.init,a);d(b.test,a);d(b.update,a);d(b.body,a);break;case "FunctionDeclaration":case "FunctionDeclaration":case "FunctionExpression":d(b.id,
a);h(b.params,a);d(b.body,a);break;case "IfStatement":d(b.test,a);d(b.consequent,a);d(b.alternate,a);break;case "LogicalExpression":d(b.left,a);d(b.right,a);break;case "MemberExpression":d(b.object,a);d(b.property,a);break;case "NewExpression":d(b.callee,a);h(b.arguments,a);break;case "ObjectExpression":h(b.properties,a);break;case "Program":h(b.body,a);break;case "Property":d(b.key,a);d(b.value,a);break;case "ReturnStatement":d(b.argument,a);break;case "UnaryExpression":d(b.argument,a);break;case "UpdateExpression":d(b.argument,
a);break;case "VariableDeclaration":h(b.declarations,a);break;case "VariableDeclarator":d(b.id,a),d(b.init,a)}}function g(b,a){void 0===a&&(a=!0);var c=p(b,"SYNTAX","UNREOGNISED");try{switch(b.type){case "VariableDeclarator":return null!==b.init&&"FunctionExpression"===b.init.type?p(b,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"):"Identifier"!==b.id.type?p(b,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER"):null!==b.init?g(b.init,!1):"";case "VariableDeclaration":for(var d=0;d<b.declarations.length;d++)if(c=g(b.declarations[d],
a),""!==c)return c;return"";case "ForInStatement":c=g(b.left,a);if(""!==c)break;if("VariableDeclaration"===b.left.type){if(1<b.left.declarations.length)return p(b,"SYNTAX","ONLY1VAR");if(null!==b.left.declarations[0].init)return p(b,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==b.left.type)return p(b,"SYNTAX","LEFTNOTVAR");c=g(b.right,a);if(""!==c)break;c=g(b.body,a);if(""!==c)break;return"";case "ForStatement":if(null!==b.test&&(c=g(b.test,a),""!==c))break;if(null!==b.init&&(c=g(b.init,a),
""!==c))break;if(null!==b.update&&(c=g(b.update,a),""!==c))break;if(null!==b.body&&(c=g(b.body,a),""!==c))break;return"";case "ContinueStatement":return"";case "EmptyStatement":return"";case "BreakStatement":return"";case "IfStatement":c=g(b.test,a);if(""!==c)break;if(null!==b.consequent&&(c=g(b.consequent,!1),""!==c))break;if(null!==b.alternate&&(c=g(b.alternate,!1),""!==c))break;return"";case "BlockStatement":for(var e=[],d=0;d<b.body.length;d++)"EmptyStatement"!==b.body[d].type&&e.push(b.body[d]);
b.body=e;for(d=0;d<b.body.length;d++)if(c=g(b.body[d],a),""!==c)return c;return"";case "FunctionDeclaration":return!1===a?p(b,"SYNTAX","GLOBALFUNCTIONSONLY"):"Identifier"!==b.id.type?p(b,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"):g(b.body,!1);case "ReturnStatement":return null!==b.argument?g(b.argument,a):"";case "UpdateExpression":return"Identifier"!==b.argument.type&&"MemberExpression"!==b.argument.type?p(b,"SYNTAX","ASSIGNMENTTOVARSONLY"):g(b.argument,a);case "AssignmentExpression":if("Identifier"!==
b.left.type&&"MemberExpression"!==b.left.type)return p(b,"SYNTAX","ASSIGNMENTTOVARSONLY");c=g(b.left,a);if(""!==c)break;switch(b.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;default:return p(b,"SYNTAX","OPERATORNOTRECOGNISED")}return g(b.right,!1);case "ExpressionStatement":return g(b.expression,!1);case "Identifier":c="";break;case "MemberExpression":c=g(b.object,a);if(""!==c)break;return!0===b.computed?g(b.property,a):"";case "Literal":return"";case "CallExpression":if("Identifier"!==
b.callee.type)return p(b,"SYNTAX","ONLYNODESSUPPORTED");c="";for(d=0;d<b.arguments.length;d++)if(c=g(b.arguments[d],a),""!==c)return c;return"";case "UnaryExpression":c=g(b.argument,a);break;case "BinaryExpression":c=g(b.left,a);if(""!==c)break;c=g(b.right,a);if(""!==c)break;switch(b.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:return p(b,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "LogicalExpression":c=
g(b.left,a);if(""!==c)break;c=g(b.right);if(""!==c)break;switch(b.operator){case "\x26\x26":case "||":break;default:return p(b,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case "ConditionalExpression":return p(b,"SYNTAX","NOTSUPPORTED");case "ArrayExpression":c="";for(d=0;d<b.elements.length&&(c=g(b.elements[d],a),""===c);d++);break;case "ObjectExpression":c="";for(d=0;d<b.properties.length;d++){c="";if(null!==b.properties[d].key&&("Literal"!==b.properties[d].key.type&&"Identifier"!==b.properties[d].key.type&&
(c=p(b,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===b.properties[d].key.type)){var e=b.properties[d].key,f="value"in e?e.value:null;"string"===typeof f||f instanceof String||(c=p(b,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}""===c&&(c=g(b.properties[d],a));if(""!==c)break}break;case "Property":if("Literal"!==b.key.type&&"Identifier"!==b.key.type)return p(b,"SYNTAX","ONLYLITERAL");if("Identifier"!==b.key.type&&(c=g(b.key,a),""!==c))break;c=g(b.value,a)}return c}catch(F){throw F;}}function l(a,
d){var e=p(a,"SYNTAX","UNREOGNISED"),f=null,g="";try{switch(a.type){case "VariableDeclarator":if(null!==a.init&&"FunctionExpression"===a.init.type)return p(a,"SYNTAX","FUNCTIONVARIABLEDECLARATOR");var h=null===a.init?"":l(a.init,d);if(""!==h)return h;"Identifier"===a.id.type&&(null===d.localScope?d.globalScope[a.id.name.toLowerCase()]={type:"any"}:d.localScope[a.id.name.toLowerCase()]={type:"any"});return"";case "FunctionDeclaration":f=c(a.id.name.toLowerCase(),a,d);g=b(a,d);if(""!==g)return g;if(null!==
d.localScope)return p(a,"SYNTAX","GLOBALFUNCTIONSONLY");f.isnative=!1;d.globalScope[a.id.name.toLowerCase()]={type:"FormulaFunction",signature:[f]};return"";case "VariableDeclaration":for(var e="",q=0;q<a.declarations.length&&(e=l(a.declarations[q],d),""===e);q++);break;case "IfStatement":e=l(a.test,d);if(""!==e)break;if("AssignmentExpression"===a.test.type||"UpdateExpression"===a.test.type)return p(a.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");if(null!==a.consequent&&(e=l(a.consequent,d),
""!==e))break;if(null!==a.alternate&&(e=l(a.alternate,d),""!==e))break;return"";case "EmptyStatement":return"";case "BlockStatement":for(q=0;q<a.body.length;q++)if(e=l(a.body[q],d),""!==e)return e;return"";case "ReturnStatement":return null!==a.argument?l(a.argument,d):"";case "ForInStatement":if("VariableDeclaration"===a.left.type){if(1<a.left.declarations.length)return p(a,"SYNTAX","ONLY1VAR");if(null!==a.left.declarations[0].init)return p(a,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==a.left.type)return p(a,
"SYNTAX","LEFTNOTVAR");e=l(a.left,d);if(""!==e)break;e=l(a.right,d);if(""!==e)break;e=l(a.body,d);if(""!==e)break;return"";case "ForStatement":if(null!==a.init&&(e=l(a.init,d),""!==e))break;if(null!==a.test&&(e=l(a.test,d),""!==e))break;if(null!==a.body&&(e=l(a.body,d),""!==e))break;if(null!==a.update&&(e=l(a.update,d),""!==e))break;return"";case "BreakStatement":return"";case "ContinueStatement":return"";case "UpdateExpression":if("Identifier"!==a.argument.type&&"MemberExpression"!==a.argument.type)return p(a,
"SYNTAX","ASSIGNMENTTOVARSONLY");var m=!1;if("MemberExpression"===a.argument.type)return l(a.argument,d);null!==d.localScope&&void 0!==d.localScope[a.argument.name.toLowerCase()]&&(m=!0);void 0!==d.globalScope[a.argument.name.toLowerCase()]&&(m=!0);return!1===m?"Identifier "+a.argument.name+" has not been declared.":"";case "AssignmentExpression":if("Identifier"!==a.left.type&&"MemberExpression"!==a.left.type)return p(a,"SYNTAX","ASSIGNMENTTOVARSONLY");var u=l(a.right,d);if(""!==u)return u;m=!1;if("MemberExpression"===
a.left.type)return u=l(a.left,d),""!==u?u:"";null!==d.localScope&&void 0!==d.localScope[a.left.name.toLowerCase()]&&(m=!0);void 0!==d.globalScope[a.left.name.toLowerCase()]&&(m=!0);return!1===m?"Identifier "+a.left.name+" has not been declared.":"";case "ExpressionStatement":return l(a.expression,d);case "Identifier":var r=a.name.toLowerCase();if(null!==d.localScope&&void 0!==d.localScope[r])return"";e=void 0!==d.globalScope[r]?"":p(a,"SYNTAX","VARIABLENOTFOUND");break;case "MemberExpression":e=l(a.object,
d);if(""!==e)break;return!0===a.computed?l(a.property,d):"";case "Literal":return"";case "CallExpression":if("Identifier"!==a.callee.type)return p(a,"SYNTAX","ONLYNODESSUPPORTED");e="";for(q=0;q<a.arguments.length;q++)if(e=l(a.arguments[q],d),""!==e)return e;var w=k(a.callee.name,a.arguments,d);-1===w&&(e=p(a,"SYNTAX","NOTFOUND"));-2===w&&(e=p(a,"SYNTAX","WRONGSIGNATURE"));break;case "UnaryExpression":e=l(a.argument,d);break;case "BinaryExpression":e=l(a.left,d);if(""!==e)break;e=l(a.right,d);if(""!==
e)break;return"";case "LogicalExpression":e=l(a.left,d);if(""!==e)break;if("AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type)return p(a.left,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION");e=l(a.right,d);if(""!==e)break;return"AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type?p(a.right,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):"";case "ConditionalExpression":return p(a,"SYNTAX","NOTSUPPORTED");case "ArrayExpression":e="";for(q=0;q<a.elements.length&&
(e=l(a.elements[q],d),""===e);q++);break;case "ObjectExpression":e="";for(q=0;q<a.properties.length;q++){e="";if(null!==a.properties[q].key&&("Literal"!==a.properties[q].key.type&&"Identifier"!==a.properties[q].key.type&&(e=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===a.properties[q].key.type)){var t=a.properties[q].key,v="value"in t?t.value:null;"string"===typeof v||v instanceof String||(e=p(a,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}""===e&&(e=l(a.properties[q],d));if(""!==e)break}break;
case "Property":if("Literal"!==a.key.type&&"Identifier"!==a.key.type)return p(a,"SYNTAX","ONLYLITERAL");if("Identifier"!==a.key.type&&(e=l(a.key,d),""!==e))break;e=l(a.value,d)}return e}catch(L){throw L;}}function f(b,a){var c=!1,e=a.toLowerCase();d(b,function(b){if(c)return!1;"Identifier"===b.type&&b.name&&b.name.toLowerCase()===e&&(c=!0);return!0});return c}function c(b,a,c){c=[];if(void 0!==a.params&&null!==a.params)for(var d=0;d<a.params.length;d++)c.push("any");return{name:b,return:"any",params:c}}
function b(b,a){a={globalScope:a.globalScope,localScope:{}};for(var c=0;c<b.params.length;c++)a.localScope[b.params[c].name.toLowerCase()]={type:"any"};return l(b.body,a)}function e(b,a,c,d){var e={};if(void 0===b||null===b)b={};if(void 0===c||null===c)c={};e.infinity={type:"any"};e.textformatting={type:"any"};e.pi={type:"any"};for(var f in a)"sync"===d&&void 0!==a[f].min?e[f]={type:"FormulaFunction",signature:{min:a[f].min,max:a[f].max}}:"sync"!==d&&void 0!==a[f].fmin&&(e[f]={type:"FormulaFunction",
signature:{min:a[f].fmin,max:a[f].fmax}});for(a=0;a<c.length;a++)f=c[a],e[f.name]={type:"FormulaFunction",signature:f};for(f in b)e[f]=b[f],e[f].type="any";return e}function p(b,a,c){var d="";switch(a){case "SYNTAX":d="Syntax Error: ";break;case "RUNTIME":d="Runtime Error: ";break;default:d="Syntax Error: "}try{switch(b.type){case "IfStatement":switch(c){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":d+=" Assignments not be made in logical tests";break;case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":d+=" Non Boolean used as Condition"}break;
case "UpdateExpression":case "AssignmentExpression":switch(c){case "CANNOT_USE_ASSIGNMENT_IN_CONDITION":d+=" Assignments not be made in logical tests";break;case "ASSIGNMENTTOVARSONLY":d+=" Assignments can only be made to identifiers"}break;case "ExpressionStatement":d+=" Assignments can only be made to identifiers";break;case "FunctionDeclaration":switch(c){case "GLOBALFUNCTIONSONLY":d+=" Functions cannot be declared as variables";break;case "FUNCTIONMUSTHAVEIDENTIFIER":d+=" Function Definition must have an identifier"}break;
case "VariableDeclaration":d+=" Only 1 variable can be declared at a time";break;case "VariableDeclarator":switch(c){case "FUNCTIONVARIABLEDECLARATOR":d+=" Functions cannot be declared as variables";break;case "VARIABLEMUSTHAVEIDENTIFIER":d+=" Variable Definition must have an identifier"}break;case "Identifier":d+=" Identifier Not Found. ";d+=b.name;break;case "ObjectExpression":switch(c){case "OBJECTPROPERTYMUSTBESTRING":d+=" Property name must be a string"}break;case "ForStatement":switch(c){case "CANNOT_USE_NONBOOLEAN_IN_CONDITION":d+=
" Non Boolean used as Condition"}break;case "ForInStatement":switch(c){case "ONLY1VAR":d+=" Can only declare 1 var for use with IN";break;case "CANNOTDECLAREVAL":d+=" Can only declare value for use with IN";break;case "LEFTNOVAR":d+="Must provide a variable to iterate with.";break;case "VARIABLENOTDECLARED":d+="Variable must be declared before it is used..";break;case "CANNOTITERATETHISTYPE":d+="This type cannot be used in an IN loop"}break;case "MemberExpression":switch(c){case "PROPERTYNOTFOUND":d+=
"Cannot find member property. ";d+=!1===b.computed?"Identifier"===b.property.type?b.property.name:"":"";break;case "OUTOFBOUNDS":d+="Out of Bounds. ";d+=!1===b.computed?"Identifier"===b.property.type?b.property.name:"":"";break;case "NOTFOUND":d+="Cannot call member method on null. ";d+=!1===b.computed?"Identifier"===b.property.type?b.property.name:"":"";break;case "INVALIDTYPE":d+="Cannot call member property on object of this type. ",d+=!1===b.computed?"Identifier"===b.property.type?b.property.name:
"":""}break;case "Property":switch(c){case "ONLYLITERAL":d+="Property names must be literals or identifiers"}break;case "Literal":break;case "CallExpression":switch(c){case "WRONGSIGNATURE":d+="Function signature does not match: ";d+="Identifier"===b.callee.type?b.callee.name:"";break;case "ONLYNODESUPPORTED":d+="Functions must be declared.";d+="Identifier"===b.callee.type?b.callee.name:"";break;case "NOTAFUNCTION":d+="Not a Function: ";d+="Identifier"===b.callee.type?b.callee.name:"";break;case "NOTFOUND":d+=
"Function Not Found: "+("Identifier"===b.callee.type?b.callee.name:"")}break;case "UnaryExpression":switch(c){case "NOTSUPPORTEDUNARYOPERATOR":d+="Operator "+b.operator+" not allowed in this context. Only ! can be used with boolean, and - with a number";break;case "NOTSUPPORTEDTYPE":d+="Unary operator "+b.operator+" cannot be used with this argument."}case "BinaryExpression":switch(c){case "OPERATORNOTRECOGNISED":d+="Binary Operator not recognised "+b.operator}break;case "LogicalExpression":switch(c){case "ONLYBOOLEAN":d+=
"Operator "+b.operator+" cannot be used. Only || or \x26\x26 are allowed values";break;case "ONLYORORAND":d+="Logical Expression "+b.operator+" being applied to parameters that are not boolean."}break;case "ConditionalExpression":d+="Conditional statements not supported.";break;case "ArrayExpression":switch(c){case "FUNCTIONCONTEXTILLEGAL":d+=" Cannot Put Function inside Array."}break;default:d+="Expression contains unrecognised code structures."}}catch(B){throw B;}return d}function q(b,a,c){return{line:b.loc.start.line,
character:b.loc.start.column,reason:p(b,a,c)}}function r(b,a,c,d,e){void 0===e&&(e=!0);a={globalScope:a.globalScope,localScope:{}};for(e=0;e<b.params.length;e++)a.localScope[b.params[e].name.toLowerCase()]={type:"any"};w(b.body,a,c,d,!1)}function w(b,a,d,e,f){void 0===f&&(f=!0);if(null===b)throw Error("Unnexpexted Expression Syntax");var g=null;try{switch(b.type){case "VariableDeclarator":if(null!==b.init&&"FunctionExpression"===b.init.type){e.push(q(b,"SYNTAX","FUNCTIONVARIABLEDECLARATOR"));break}"Identifier"!==
b.id.type?e.push(q(b,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER")):(b.id.name.toLowerCase(),null===a.localScope?a.globalScope[b.id.name.toLowerCase()]={type:"any"}:a.localScope[b.id.name.toLowerCase()]={type:"any"});null!==b.init&&w(b.init,a,d,e,f);break;case "FunctionDeclaration":!1===f&&e.push(q(b,"SYNTAX","GLOBALFUNCTIONSONLY"));"Identifier"!==b.id.type&&e.push(q(b,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"));g=c("",b,a);r(b,a,d,e,f);null!==a.localScope&&e.push(q(b,"SYNTAX","GLOBALFUNCTIONSONLY"));g.isnative=
!1;"Identifier"===b.id.type&&(a.globalScope[b.id.name.toLowerCase()]={type:"FormulaFunction",signature:[g]});break;case "VariableDeclaration":for(var l=0;l<b.declarations.length;l++)w(b.declarations[l],a,d,e,f);break;case "IfStatement":null!==b.test&&(w(b.test,a,d,e,f),"AssignmentExpression"!==b.test.type&&"UpdateExpression"!==b.test.type||e.push(q(b.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));null!==b.consequent&&w(b.consequent,a,d,e,f);null!==b.alternate&&w(b.alternate,a,d,e,f);break;
case "EmptyStatement":break;case "BlockStatement":if(null!==b.body)for(l=0;l<b.body.length;l++)w(b.body[l],a,d,e,f);break;case "ReturnStatement":null!==b.argument&&w(b.argument,a,d,e,f);break;case "ForInStatement":"VariableDeclaration"===b.left.type?(1<b.left.declarations.length&&e.push(q(b,"SYNTAX","ONLY1VAR")),null!==b.left.declarations[0].init&&e.push(q(b,"SYNTAX","CANNOTDECLAREVAL"))):"Identifier"!==b.left.type&&e.push(q(b,"SYNTAX","LEFTNOTVAR"));w(b.left,a,d,e,f);w(b.right,a,d,e,f);w(b.body,
a,d,e,f);break;case "ForStatement":null!==b.init&&w(b.init,a,d,e,f);null!==b.test&&w(b.test,a,d,e,f);null!==b.body&&w(b.body,a,d,e,f);null!==b.update&&w(b.update,a,d,e,f);break;case "BreakStatement":break;case "ContinueStatement":break;case "UpdateExpression":"Identifier"!==b.argument.type&&"MemberExpression"!==b.argument.type?e.push(q(b,"SYNTAX","ASSIGNMENTTOVARSONLY")):("Identifier"===b.argument.type&&(g=!1,!1===d&&(null!==a.localScope&&void 0!==a.localScope[b.argument.name.toLowerCase()]&&(g=!0),
void 0!==a.globalScope[b.argument.name.toLowerCase()]&&(g=!0),!1===g&&e.push({line:null===b?0:b.loc.start.line,character:null===b?0:b.loc.start.column,reason:"Identifier "+b.argument.name+" has not been declared."}))),"MemberExpression"===b.argument.type&&w(b.argument,a,d,e,f));break;case "AssignmentExpression":"Identifier"!==b.left.type&&"MemberExpression"!==b.left.type&&e.push(q(b,"SYNTAX","ASSIGNMENTTOVARSONLY"));switch(b.operator){case "\x3d":case "/\x3d":case "*\x3d":case "%\x3d":case "+\x3d":case "-\x3d":break;
default:e.push(q(b,"SYNTAX","OPERATORNOTRECOGNISED"))}w(b.right,a,d,e,f);g=!1;"Identifier"===b.left.type&&(null!==a.localScope&&void 0!==a.localScope[b.left.name.toLowerCase()]&&(g=!0),void 0!==a.globalScope[b.left.name.toLowerCase()]&&(g=!0),!1===d&&!1===g&&e.push({line:null===b?0:b.loc.start.line,character:null===b?0:b.loc.start.column,reason:"Identifier "+b.left.name+" has not been declared."}));"MemberExpression"===b.left.type&&w(b.left,a,d,e,f);break;case "ExpressionStatement":w(b.expression,
a,d,e,f);break;case "Identifier":var h=b.name.toLowerCase();if(null!==a.localScope&&void 0!==a.localScope[h]||void 0!==a.globalScope[h])break;!1===d&&e.push(q(b,"SYNTAX","VARIABLENOTFOUND"));break;case "MemberExpression":w(b.object,a,d,e,f);!0===b.computed&&w(b.property,a,d,e,f);break;case "Literal":break;case "CallExpression":"Identifier"!==b.callee.type&&e.push(q(b,"SYNTAX","ONLYNODESSUPPORTED"));for(l=0;l<b.arguments.length;l++)w(b.arguments[l],a,d,e,f);if("Identifier"===b.callee.type){var p=k(b.callee.name,
b.arguments,a);!1===d&&-1===p&&e.push(q(b,"SYNTAX","NOTFOUND"));-2===p&&e.push(q(b,"SYNTAX","WRONGSIGNATURE"))}break;case "UnaryExpression":w(b.argument,a,d,e,f);break;case "BinaryExpression":w(b.left,a,d,e,f);w(b.right,a,d,e,f);switch(b.operator){case "\x3d\x3d":case "!\x3d":case "\x3c":case "\x3c\x3d":case "\x3e":case "\x3e\x3d":case "+":case "-":case "*":case "/":case "%":break;default:e.push(q(b,"SYNTAX","OPERATORNOTRECOGNISED"))}break;case "LogicalExpression":switch(b.operator){case "\x26\x26":case "||":break;
default:e.push(q(b,"SYNTAX","OPERATORNOTRECOGNISED"))}w(b.left,a,d,e,f);"AssignmentExpression"!==b.left.type&&"UpdateExpression"!==b.left.type||e.push(q(b,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));w(b.right,a,d,e,f);"AssignmentExpression"!==b.right.type&&"UpdateExpression"!==b.right.type||e.push(q(b,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));break;case "ConditionalExpression":e.push(q(b,"SYNTAX","NOTSUPPORTED"));break;case "ArrayExpression":for(l=0;l<b.elements.length;l++)w(b.elements[l],
a,d,e,f);break;case "ObjectExpression":for(l=0;l<b.properties.length;l++)w(b.properties[l],a,d,e,f);break;case "Property":"Literal"!==b.key.type&&"Identifier"!==b.key.type&&e.push(q(b,"SYNTAX","ONLYLITERAL"));"Literal"===b.key.type&&w(b.key,a,d,e,f);w(b.value,a,d,e,f);break;default:e.push(q(b,"SYNTAX","UNRECOGNISED"))}}catch(N){e.push({line:null===b?0:b.loc.start.line,character:null===b?0:b.loc.start.column,reason:"Unnexpected Syntax"})}}function u(b,a){var c=[];d(b,function(b){"CallExpression"===
b.type&&"Identifier"===b.callee.type&&c.push(b.callee.name.toLowerCase());return!0});return c}Object.defineProperty(a,"__esModule",{value:!0});a.functionDecls={concatenate:{min:"0",max:"*"},split:{min:"2",max:"4"},guid:{min:"0",max:"1"},today:{min:"0",max:"0"},angle:{min:"2",max:"3"},bearing:{min:"2",max:"3"},urlencode:{min:"1",max:"1"},now:{min:"0",max:"0"},timestamp:{min:"0",max:"0"},day:{min:"1",max:"1"},month:{min:"1",max:"1"},year:{min:"1",max:"1"},hour:{min:"1",max:"1"},second:{min:"1",max:"1"},
millisecond:{min:"1",max:"1"},minute:{min:"1",max:"1"},weekday:{min:"1",max:"1"},toutc:{min:"1",max:"1"},tolocal:{min:"1",max:"1"},date:{min:"0",max:"7"},datediff:{min:"2",max:"3"},dateadd:{min:"2",max:"3"},trim:{min:"1",max:"1"},text:{min:"1",max:"2"},left:{min:"2",max:"2"},right:{min:"2",max:"2"},mid:{min:"2",max:"3"},upper:{min:"1",max:"1"},proper:{min:"1",max:"2"},lower:{min:"1",max:"1"},find:{min:"2",max:"3"},iif:{min:"3",max:"3"},decode:{min:"2",max:"*"},when:{min:"2",max:"*"},defaultvalue:{min:"2",
max:"2"},isempty:{min:"1",max:"1"},domaincode:{min:"2",max:"4"},domainname:{min:"2",max:"4"},polygon:{min:"1",max:"1"},point:{min:"1",max:"1"},polyline:{min:"1",max:"1"},extent:{min:"1",max:"1"},multipoint:{min:"1",max:"1"},ringisclockwise:{min:"1",max:"1"},geometry:{min:"1",max:"1"},count:{min:"0",max:"*"},number:{min:"1",max:"2"},acos:{min:"1",max:"1"},asin:{min:"1",max:"1"},atan:{min:"1",max:"1"},atan2:{min:"2",max:"2"},ceil:{min:"1",max:"2"},floor:{min:"1",max:"2"},round:{min:"1",max:"2"},cos:{min:"1",
max:"1"},exp:{min:"1",max:"1"},log:{min:"1",max:"1"},min:{min:"0",max:"*"},constrain:{min:"3",max:"3"},console:{min:"0",max:"*"},max:{min:"0",max:"*"},pow:{min:"2",max:"2"},random:{min:"0",max:"0"},sqrt:{min:"1",max:"1"},sin:{min:"1",max:"1"},tan:{min:"1",max:"1"},abs:{min:"1",max:"1"},isnan:{min:"1",max:"1"},stdev:{min:"0",max:"*"},average:{min:"0",max:"*"},mean:{min:"0",max:"*"},sum:{min:"0",max:"*"},variance:{min:"0",max:"*"},distinct:{min:"0",max:"*"},first:{min:"1",max:"1"},top:{min:"2",max:"2"},
boolean:{min:"1",max:"1"},dictionary:{min:"0",max:"*"},typeof:{min:"1",max:"1"},reverse:{min:"1",max:"1"},replace:{min:"3",max:"4"},sort:{min:"1",max:"2"},feature:{min:"1",max:"*"},haskey:{min:"2",max:"2"},indexof:{min:"2",max:"2"},disjoint:{min:"2",max:"2"},intersects:{min:"2",max:"2"},touches:{min:"2",max:"2"},crosses:{min:"2",max:"2"},within:{min:"2",max:"2"},contains:{min:"2",max:"2"},overlaps:{min:"2",max:"2"},equals:{min:"2",max:"2"},relate:{min:"3",max:"3"},intersection:{min:"2",max:"2"},union:{min:"1",
max:"2"},difference:{min:"2",max:"2"},symmetricdifference:{min:"2",max:"2"},clip:{min:"2",max:"2"},cut:{min:"2",max:"2"},area:{min:"1",max:"2"},areageodetic:{min:"1",max:"2"},length:{min:"1",max:"2"},lengthgeodetic:{min:"1",max:"2"},distancegeodetic:{min:"2",max:"3"},distance:{min:"2",max:"3"},densify:{min:"2",max:"3"},densifygeodetic:{min:"2",max:"3"},generalize:{min:"2",max:"4"},buffer:{min:"2",max:"3"},buffergeodetic:{min:"2",max:"3"},offset:{min:"2",max:"6"},rotate:{min:"2",max:"3"},issimple:{min:"1",
max:"1"},simplify:{min:"1",max:"1"},centroid:{min:"1",max:"1"},isselfintersecting:{min:"1",max:"1"},multiparttosinglepart:{min:"1",max:"1"},setgeometry:{min:"2",max:"2"},portal:{min:"1",max:"1"}};for(var v in a.functionDecls)a.functionDecls[v].fmin=a.functionDecls[v].min,a.functionDecls[v].fmax=a.functionDecls[v].max;var y="featureset featuresetbyid featuresetbyname featuresetbyrelationshipname featuresetbyurl attachments featuresetbyportalitem".split(" "),t="disjoint intersects touches crosses within contains overlaps equals relate intersection union difference symmetricdifference clip cut area areageodetic length lengthgeodetic distance distancegeodetic densify densifygeodetic generalize buffer buffergeodetic offset rotate issimple simplify multiparttosinglepart".split(" ");
a.addFunctionDeclaration=function(b,c){var d=a.functionDecls[b.name.toLowerCase()];void 0===d?"sync"===c?a.functionDecls[b.name.toLowerCase()]={min:b.min,max:b.max}:a.functionDecls[b.name.toLowerCase()]={fmin:b.min,fmax:b.max}:"sync"===c?(d.min=b.min,d.max=b.max):(d.fmin=b.min,d.fmax=b.max)};a.checkFunctionSignature=m;a.findFunction=k;a.walk=d;a.validateLanguageNode=g;a.testValidityOfExpression=l;a.referencesMember=f;a.referencesFunction=function(b,a){var c=!1,e=a.toLowerCase();d(b,function(b){return c?
!1:"CallExpression"===b.type&&"Identifier"===b.callee.type&&b.callee.name&&b.callee.name.toLowerCase()===e?(c=!0,!1):!0});return c};a.findFieldLiterals=function(b,a){var c=[];d(b,function(b){if("MemberExpression"!==b.type||"Identifier"!==b.object.type)return!0;!1===b.computed&&b.object&&b.object.name&&b.property&&"Identifier"===b.property.type&&b.property.name?c.push(b.object.name.toLowerCase()+"."+b.property.name.toLowerCase()):b.object&&b.object.name&&b.property&&"Literal"===b.property.type&&"string"===
typeof b.property.value&&c.push(b.object.name.toLowerCase()+"."+b.property.value.toString().toLowerCase());return!1});return c};a.extractFunctionDeclaration=c;a.validateFunction=b;a.constructGlobalScope=e;a.validateScript=function(b,c,d,f){void 0===d&&(d="async");void 0===f&&(f=a.functionDecls);c={globalScope:e(c.vars,f,c.customFunctions,d),localScope:null};return l(b.body[0].body,c)};a.validateLanguage=function(b){return"BlockStatement"!==b.body[0].body.type?"Invalid formula content.":g(b.body[0].body)};
a.nodeErrorMessage=p;a.makeError=q;a.extractAllIssuesInFunction=r;a.extractAllIssues=w;a.checkScript=function(b,c,d,f,g){void 0===f&&(f="async");void 0===g&&(g=a.functionDecls);var l=[];if("BlockStatement"!==b.body[0].body.type)return[{line:0,character:0,reason:"Invalid Body"}];if(null===c||void 0===c)c={vars:{},customFunctions:[]};c={globalScope:e(c.vars,g,c.customFunctions,f),localScope:null};try{w(b.body[0].body,c,d,l)}catch(F){}return l};a.findFunctionCalls=u;a.findScriptDependencies=function(b,
a){void 0===a&&(a=[]);var c=null;if(void 0===b.usesFeatureSet){null===c&&(c=u(b,!1));b.usesFeatureSet=!1;for(var d=0;d<c.length;d++)-1<y.indexOf(c[d])&&(b.usesFeatureSet=!0,b.isAsync=!0);if(!1===b.usesFeatureSet&&a&&0<a.length)for(d=0;d<a.length;d++)if(f(b,a[d])){b.usesFeatureSet=!0;b.isAsync=!0;break}}if(void 0===b.usesGeometry)for(b.usesGeometry=!1,null===c&&(c=u(b,!1)),d=0;d<c.length;d++)-1<t.indexOf(c[d])&&(b.usesGeometry=!0)};a.scriptUsesFeatureSet=function(b){b=u(b,!1);for(var a=0;a<b.length;a++)if(-1<
y.indexOf(b[a]))return!0;return!1}})},"esri/arcade/functions/date":function(){define(["require","exports","../languageUtils"],function(n,a,m){function k(a){return null===a?a:isNaN(a.getTime())?null:a}Object.defineProperty(a,"__esModule",{value:!0});a.registerFunctions=function(a,d){a.today=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,0,0);a=new Date;a.setHours(0,0,0,0);return a})};a.now=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,0,0);return new Date})};a.timestamp=function(a,
l){return d(a,l,function(a,c,b){m.pcCheck(b,0,0);a=new Date;return a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};a.toutc=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?null:new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())})};a.tolocal=function(a,l){return d(a,l,function(a,c,
b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?null:m.MomentLibrary.Moment.utc([a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()]).toDate()})};a.day=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?NaN:a.getDate()})};a.month=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?NaN:a.getMonth()})};a.year=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,
1,1);a=m.toDate(b[0]);return null===a?NaN:a.getFullYear()})};a.hour=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?NaN:a.getHours()})};a.second=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?NaN:a.getSeconds()})};a.millisecond=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?NaN:a.getMilliseconds()})};a.minute=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,
1,1);a=m.toDate(b[0]);return null===a?NaN:a.getMinutes()})};a.weekday=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,1,1);a=m.toDate(b[0]);return null===a?NaN:a.getDay()})};a.date=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,0,7);if(3===b.length)return k(new Date(m.toNumber(b[0]),m.toNumber(b[1]),m.toNumber(b[2]),0,0,0,0));if(4===b.length)return k(new Date(m.toNumber(b[0]),m.toNumber(b[1]),m.toNumber(b[2]),m.toNumber(b[3]),0,0,0));if(5===b.length)return k(new Date(m.toNumber(b[0]),
m.toNumber(b[1]),m.toNumber(b[2]),m.toNumber(b[3]),m.toNumber(b[4]),0,0));if(6===b.length)return k(new Date(m.toNumber(b[0]),m.toNumber(b[1]),m.toNumber(b[2]),m.toNumber(b[3]),m.toNumber(b[4]),m.toNumber(b[5]),0));if(7===b.length)return k(new Date(m.toNumber(b[0]),m.toNumber(b[1]),m.toNumber(b[2]),m.toNumber(b[3]),m.toNumber(b[4]),m.toNumber(b[5]),m.toNumber(b[6])));if(2===b.length){a=m.toString(b[1]);if(""===a)return null;a=m.standardiseDateFormat(a);b=m.MomentLibrary.Moment(m.toString(b[0]),a,!0);
return!0===b.isValid()?b.toDate():null}if(1===b.length){if(m.isString(b[0])&&""===b[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;a=m.toNumber(b[0]);return!1===isNaN(a)?k(new Date(a)):m.toDate(b[0])}if(0===b.length)return new Date})};a.datediff=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,2,3);a=m.toDateM(b[0]);c=m.toDateM(b[1]);if(null===a||null===c)return NaN;switch(m.toString(b[2]).toLowerCase()){case "days":case "day":case "d":return a.diff(c,"days",!0);case "months":case "month":return a.diff(c,
"months",!0);case "minutes":case "minute":case "m":return"M"===b[2]?a.diff(c,"months",!0):a.diff(c,"minutes",!0);case "seconds":case "second":case "s":return a.diff(c,"seconds",!0);case "milliseconds":case "millisecond":case "ms":return a.diff(c);case "hours":case "hour":case "h":return a.diff(c,"hours",!0);case "years":case "year":case "y":return a.diff(c,"years",!0);default:return a.diff(c)}})};a.dateadd=function(a,l){return d(a,l,function(a,c,b){m.pcCheck(b,2,3);a=m.toDateM(b[0]);if(null===a)return null;
c="milliseconds";switch(m.toString(b[2]).toLowerCase()){case "days":case "day":case "d":c="days";break;case "months":case "month":c="months";break;case "minutes":case "minute":case "m":c="M"===b[2]?"months":"minutes";break;case "seconds":case "second":case "s":c="seconds";break;case "milliseconds":case "millisecond":case "ms":c="milliseconds";break;case "hours":case "hour":case "h":c="hours";break;case "years":case "year":case "y":c="years"}a.add(m.toNumber(b[1]),c);return a.toDate()})}}})},"esri/arcade/functions/geometry":function(){define("require exports ../Dictionary ../Feature ../ImmutablePointArray ../languageUtils ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ./centroid ../../geometry/support/jsonUtils ../../geometry/support/coordsUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){Object.defineProperty(a,"__esModule",{value:!0});a.registerFunctions=function(a,u){a.ringisclockwise=function(b,a){return u(b,a,function(b,a,e){d.pcCheck(e,1,1);b=[];var f=a=!1;if(null===e[0])return!1;if(d.isArray(e[0])){for(var g=0,l=e[0];g<l.length;g++){var p=l[g];if(p instanceof c)b.push(p.hasZ?p.hasM?[p.x,p.y,p.z,p.m]:[p.x,p.y,p.z]:[p.x,p.y]);else throw Error("Invalid Argument");}0<b.length&&(a=e[0][0].hasZ,f=e[0][0].hasM)}else if(e[0]instanceof h)b=e[0]._elements,
0<b.length&&(a=e[0]._hasZ,f=e[0]._hasM);else if(d.isImmutableArray(e[0])){g=0;for(l=e[0].toArray();g<l.length;g++)if(p=l[g],p instanceof c)b.push(p.hasZ?p.hasM?[p.x,p.y,p.z,p.m]:[p.x,p.y,p.z]:[p.x,p.y]);else throw Error("Invalid Argument");0<b.length&&(a=e[0].get(0).hasZ,f=e[0].get(0).hasM)}else throw Error("Invalid Argument");return 3>b.length?!1:r.isClockwise(b,f,a)})};a.polygon=function(a,c){return u(a,c,function(c,e,f){d.pcCheck(f,1,1);c=null;if(f[0]instanceof m){if(c=d.fixSpatialReference(k.parseGeometryFromDictionary(f[0]),
a.spatialReference),!1===c instanceof b)throw Error("Illegal Parameter");}else c=f[0]instanceof b?q.fromJSON(f[0].toJSON()):d.fixSpatialReference(new b(JSON.parse(f[0])),a.spatialReference);if(null!==c&&!1===c.spatialReference.equals(a.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return d.fixNullGeometry(c)})};a.polyline=function(b,a){return u(b,a,function(a,c,f){d.pcCheck(f,1,1);a=null;if(f[0]instanceof m){if(a=d.fixSpatialReference(k.parseGeometryFromDictionary(f[0]),
b.spatialReference),!1===a instanceof e)throw Error("Illegal Parameter");}else a=f[0]instanceof e?q.fromJSON(f[0].toJSON()):d.fixSpatialReference(new e(JSON.parse(f[0])),b.spatialReference);if(null!==a&&!1===a.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return d.fixNullGeometry(a)})};a.point=function(b,a){return u(b,a,function(a,e,f){d.pcCheck(f,1,1);a=null;if(f[0]instanceof m){if(a=d.fixSpatialReference(k.parseGeometryFromDictionary(f[0]),
b.spatialReference),!1===a instanceof c)throw Error("Illegal Parameter");}else a=f[0]instanceof c?q.fromJSON(f[0].toJSON()):d.fixSpatialReference(new c(JSON.parse(f[0])),b.spatialReference);if(null!==a&&!1===a.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return d.fixNullGeometry(a)})};a.multipoint=function(b,a){return u(b,a,function(a,c,e){d.pcCheck(e,1,1);a=null;if(e[0]instanceof m){if(a=
d.fixSpatialReference(k.parseGeometryFromDictionary(e[0]),b.spatialReference),!1===a instanceof f)throw Error("Illegal Parameter");}else a=e[0]instanceof f?q.fromJSON(e[0].toJSON()):d.fixSpatialReference(new f(JSON.parse(e[0])),b.spatialReference);if(null!==a&&!1===a.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return d.fixNullGeometry(a)})};a.extent=function(a,l){return u(a,l,function(l,
h,p){p=d.autoCastFeatureToGeometry(p);d.pcCheck(p,1,1);l=null;p[0]instanceof m?l=d.fixSpatialReference(k.parseGeometryFromDictionary(p[0]),a.spatialReference):p[0]instanceof c?(l={xmin:p[0].x,ymin:p[0].y,xmax:p[0].x,ymax:p[0].y,spatialReference:p[0].spatialReference.toJSON()},p[0].hasZ?(l.zmin=p[0].z,l.zmax=p[0].z):p[0].hasM&&(l.mmin=p[0].m,l.mmax=p[0].m),l=q.fromJSON(l)):l=p[0]instanceof b?q.fromJSON(p[0].extent.toJSON()):p[0]instanceof e?q.fromJSON(p[0].extent.toJSON()):p[0]instanceof f?q.fromJSON(p[0].extent.toJSON()):
p[0]instanceof g?q.fromJSON(p[0].toJSON()):d.fixSpatialReference(new g(JSON.parse(p[0])),a.spatialReference);if(null!==l&&!1===l.spatialReference.equals(a.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return d.fixNullGeometry(l)})};a.geometry=function(b,a){return u(b,a,function(a,c,e){d.pcCheck(e,1,1);a=null;a=e[0]instanceof k?d.fixSpatialReference(e[0].geometry(),b.spatialReference):e[0]instanceof m?d.fixSpatialReference(k.parseGeometryFromDictionary(e[0]),
b.spatialReference):d.fixSpatialReference(q.fromJSON(JSON.parse(e[0])),b.spatialReference);if(null!==a&&!1===a.spatialReference.equals(b.spatialReference))throw Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return d.fixNullGeometry(a)})};a.setgeometry=function(b,a){return u(b,a,function(b,a,c){d.pcCheck(c,2,2);if(c[0]instanceof k){if(!0===c[0].immutable)throw Error("Feature is Immutable");if(c[1]instanceof l||null===c[1])c[0]._geometry=c[1];
else throw Error("Illegal Argument");}else throw Error("Illegal Argument");return d.voidOperation})};a.feature=function(b,a){return u(b,a,function(a,c,e){if(0===e.length)throw Error("Missing Parameters");a=null;if(1===e.length)if(d.isString(e[0]))a=k.fromJson(JSON.parse(e[0]));else if(e[0]instanceof k)a=k.createFromArcadeFeature(e[0]);else if(e[0]instanceof l)a=k.createFromGraphicLikeObject(e[0],null,null);else if(e[0]instanceof m)a=e[0].hasField("geometry")?e[0].field("geometry"):null,c=e[0].hasField("attributes")?
e[0].field("attributes"):null,null!==a&&a instanceof m&&(a=k.parseGeometryFromDictionary(a)),null!==c&&(c=k.parseAttributesFromDictionary(c)),a=k.createFromGraphicLikeObject(a,c,null);else throw Error("Illegal Argument");else{if(2===e.length){c=a=null;if(null!==e[0])if(e[0]instanceof l)a=e[0];else if(a instanceof m)a=k.parseGeometryFromDictionary(e[0]);else throw Error("Illegal Argument");if(null!==e[1])if(e[1]instanceof m)c=k.parseAttributesFromDictionary(e[1]);else throw Error("Illegal Argument");
}else{a=null;c={};if(null!==e[0])if(e[0]instanceof l)a=e[0];else if(a instanceof m)a=k.parseGeometryFromDictionary(e[0]);else throw Error("Illegal Argument");for(var f=1;f<e.length;f+=2){var g=d.toString(e[f]),h=e[f+1];if(null===h||void 0===h||d.isString(h)||isNaN(h)||d.isDate(h)||d.isNumber(h)||d.isBoolean(h)){if(d.isFunctionParameter(h)||!1===d.isSimpleType(h))throw Error("Illegal Argument");c[g]=h===d.voidOperation?null:h}else throw Error("Illegal Argument");}}a=k.createFromGraphicLikeObject(a,
c,null)}a._geometry=d.fixSpatialReference(a.geometry(),b.spatialReference);a.immutable=!1;return a})};a.dictionary=function(b,a){return u(b,a,function(b,a,c){if(0===c.length)return c=new m,c.immutable=!1,c;if(1===c.length&&d.isString(c[0]))try{var e=JSON.parse(c[0]),f=m.convertObjectToArcadeDictionary(e);f.immutable=!1;return f}catch(B){throw Error("Missing Parameters or Illegal Json");}if(0!==c.length%2)throw Error("Missing Parameters");b={};for(a=0;a<c.length;a+=2)if(e=d.toString(c[a]),f=c[a+1],
null===f||void 0===f||d.isString(f)||isNaN(f)||d.isDate(f)||d.isNumber(f)||d.isBoolean(f)||d.isArray(f)||d.isImmutableArray(f)){if(d.isFunctionParameter(f))throw Error("Illegal Argument");b[e]=f===d.voidOperation?null:f}else throw Error("Illegal Argument");c=new m(b);c.immutable=!1;return c})};a.haskey=function(b,a){return u(b,a,function(b,a,c){d.pcCheck(c,2,2);b=d.toString(c[1]);if(c[0]instanceof k||c[0]instanceof m)return c[0].hasField(b);throw Error("Illegal Argument");})};a.indexof=function(b,
a){return u(b,a,function(b,a,c){d.pcCheck(c,2,2);b=c[1];if(d.isArray(c[0])){for(a=0;a<c[0].length;a++)if(d.equalityTest(b,c[0][a]))return a;return-1}if(d.isImmutableArray(c[0])){var e=c[0].length();for(a=0;a<e;a++)if(d.equalityTest(b,c[0].get(a)))return a;return-1}throw Error("Illegal Argument");})};a.angle=function(b,a){return u(b,a,function(b,a,e){e=d.autoCastFeatureToGeometry(e);d.pcCheck(e,2,3);if(!(e[0]instanceof c))throw Error("Illegal Argument");if(!(e[1]instanceof c))throw Error("Illegal Argument");
if(2<e.length&&!(e[2]instanceof c))throw Error("Illegal Argument");return 2===e.length?p.angle2D(e[0],e[1]):p.angleBetween2D(e[0],e[1],e[2])})};a.bearing=function(b,a){return u(b,a,function(b,a,e){e=d.autoCastFeatureToGeometry(e);d.pcCheck(e,2,3);if(!(e[0]instanceof c))throw Error("Illegal Argument");if(!(e[1]instanceof c))throw Error("Illegal Argument");if(2<e.length&&!(e[2]instanceof c))throw Error("Illegal Argument");return 2===e.length?p.bearing2D(e[0],e[1]):p.bearingBetween2D(e[0],e[1],e[2])})};
a.isselfintersecting=function(a,c){return u(a,c,function(c,g,l){l=d.autoCastFeatureToGeometry(l);d.pcCheck(l,1,1);c=l[0];if(c instanceof b)return c.isSelfIntersecting;if(c instanceof e)return c=c.paths,p.pathsSelfIntersecting(c);if(c instanceof f)for(g=c.points,l=0;l<g.length;l++)for(var h=0;h<g.length;h++)if(h!==l){for(var k=!0,q=0;q<g[l].length;q++)if(g[l][q]!==g[h][q]){k=!1;break}if(!0===k)return!0}return d.isArray(c)||d.isImmutableArray(c)?(c=d.autoCastArrayOfPointsToPolyline(c,a.spatialReference),
null!==c&&(c=c.paths),p.pathsSelfIntersecting(c)):!1})}}})},"esri/arcade/functions/centroid":function(){define(["require","exports","../../geometry/Point","../../geometry/support/intersects"],function(n,a,m,k){function h(b,a,c){var e={x:0,y:0};a&&(e.z=0);c&&(e.m=0);for(var f=0,g=b[0],l=0;l<b.length;l++){var h=b[l],p;a:if(h.length!==g.length)p=!1;else{for(p=0;p<h.length;p++)if(h[p]!==g[p]){p=!1;break a}p=!0}if(!1===p){p=d(g,h,a);var k=h,m=a,n=c,A={x:(g[0]+k[0])/2,y:(g[1]+k[1])/2};m&&(A.z=(g[2]+k[2])/
2);m&&n?A.m=(g[3]+k[3])/2:n&&(A.m=(g[2]+k[2])/2);g=A;g.x*=p;g.y*=p;e.x+=g.x;e.y+=g.y;a&&(g.z*=p,e.z+=g.z);c&&(g.m*=p,e.m+=g.m);f+=p;g=h}}0<f?(e.x/=f,e.y/=f,a&&(e.z/=f),c&&(e.m/=f)):(e.x=b[0][0],e.y=b[0][1],a&&(e.z=b[0][2]),c&&a?e.m=b[0][3]:c&&(e.m=b[0][2]));return e}function d(b,a,c){var d=a[0]-b[0];b=a[1]-b[1];return c?(a=a[2]-a[2],Math.sqrt(d*d+b*b+a*a)):Math.sqrt(d*d+b*b)}function g(b,a,c){for(void 0===c&&(c=0);b<c;)b+=a;for(c+=a;b>=c;)b-=a;return b}function l(b,a){return Math.atan2(a.y-b.y,a.x-
b.x)}function f(b,a,c){var d=b.x-a.x;b=b.y-a.y;var e=c.x-a.x;a=c.y-a.y;return Math.atan2(e*b-d*a,e*d+a*b)}Object.defineProperty(a,"__esModule",{value:!0});a.centroidPolyline=function(b){for(var a={x:0,y:0,spatialReference:b.spatialReference.toJSON()},c={x:0,y:0,spatialReference:b.spatialReference.toJSON()},f=0,g=0,l=0;l<b.paths.length;l++)if(0!==b.paths[l].length){var k;k=b.paths[l];var v=!0===b.hasZ;if(1>=k.length)k=0;else{for(var y=0,t=1;t<k.length;t++)y+=d(k[t-1],k[t],v);k=y}0===k?(v=h(b.paths[l],
!0===b.hasZ,!0===b.hasM),a.x+=v.x,a.y+=v.y,!0===b.hasZ&&(a.z+=v.z),!0===b.hasM&&(a.m+=v.m),++f):(v=h(b.paths[l],!0===b.hasZ,!0===b.hasM),c.x+=v.x*k,c.y+=v.y*k,!0===b.hasZ&&(c.z+=v.z*k),!0===b.hasM&&(c.m+=v.m*k),g+=k)}return 0<g?(c.x/=g,c.y/=g,!0===b.hasZ&&(c.z/=g),!0===b.hasM&&(c.m/=g),new m(c)):0<f?(a.x/=f,a.y/=f,!0===b.hasZ&&(c.z/=f),!0===b.hasM&&(a.m/=f),new m(a)):null};a.centroidMultiPoint=function(b){if(0===b.points.length)return null;for(var a=0,c=0,d=0,f=0,g=0;g<b.points.length;g++){var l=
b.getPoint(g);!0===l.hasZ&&(d+=l.z);!0===l.hasM&&(f+=l.m);a+=l.x;c+=l.y;f+=l.m}a={x:a/b.points.length,y:c/b.points.length,spatialReference:null};a.spatialReference=b.spatialReference.toJSON();!0===b.hasZ&&(a.z=d/b.points.length);!0===b.hasM&&(a.m=f/b.points.length);return new m(a)};a.angleRad=l;a.angle2D=function(b,a){return g(l(b,a),2*Math.PI)*(180/Math.PI)};a.bearing2D=function(b,a){return g(Math.PI/2-l(b,a),2*Math.PI)*(180/Math.PI)};a.angleBetweenRad=f;a.angleBetween2D=function(b,a,c){return g(f(b,
a,c),2*Math.PI)*(180/Math.PI)};a.bearingBetween2D=function(b,a,c){return g(-1*f(b,a,c),2*Math.PI)*(180/Math.PI)};var c=[0,0];a.pathsSelfIntersecting=function(b){for(var a=0;a<b.length;a++){for(var d=b[a],f=0;f<d.length-1;f++)for(var g=d[f],l=d[f+1],h=a+1;h<b.length;h++)for(var m=0;m<b[h].length-1;m++){var y=b[h][m],t=b[h][m+1],x=k.segmentIntersects(g,l,y,t,c);if(x&&!(c[0]===g[0]&&c[1]===g[1]||c[0]===y[0]&&c[1]===y[1]||c[0]===l[0]&&c[1]===l[1]||c[0]===t[0]&&c[1]===t[1]))return!0}m=d.length;if(!(3>
m))for(f=0;f<=m-2;f++)for(g=d[f],l=d[f+1],h=f+2;h<=m-2;h++)if(y=d[h],t=d[h+1],(x=k.segmentIntersects(g,l,y,t,c))&&!(c[0]===g[0]&&c[1]===g[1]||c[0]===y[0]&&c[1]===y[1]||c[0]===l[0]&&c[1]===l[1]||c[0]===t[0]&&c[1]===t[1]))return!0}return!1}})},"esri/arcade/functions/geomsync":function(){define("require exports ../../kernel ../kernel ../languageUtils ./centroid ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ../../geometry/support/jsonUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){function q(a){return 0===m.version.indexOf("4.")?b.fromExtent(a):new b({spatialReference:a.spatialReference,rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]})}Object.defineProperty(a,"__esModule",{value:!0});var r=null;a.setGeometryEngine=function(b){r=b};a.registerFunctions=function(a,m){function u(b){h.pcCheck(b,2,2);if(!(b[0]instanceof l&&b[1]instanceof l||b[0]instanceof l&&null===b[1]||b[1]instanceof l&&null===b[0]||
null===b[0]&&null===b[1]))throw Error("Illegal Argument");}a.disjoint=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!0:r.disjoint(c[0],c[1])})};a.intersects=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:r.intersects(c[0],c[1])})};a.touches=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:r.touches(c[0],
c[1])})};a.crosses=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:r.crosses(c[0],c[1])})};a.within=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:r.within(c[0],c[1])})};a.contains=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:r.contains(c[0],c[1])})};a.overlaps=function(b,a){return m(b,a,function(b,
a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?!1:r.overlaps(c[0],c[1])})};a.equals=function(b,a){return m(b,a,function(b,a,c){h.pcCheck(c,2,2);return c[0]===c[1]?!0:c[0]instanceof l&&c[1]instanceof l?r.equals(c[0],c[1]):h.isDate(c[0])&&h.isDate(c[1])?c[0].getTime()===c[1].getTime():!1})};a.relate=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,3,3);if(c[0]instanceof l&&c[1]instanceof l)return r.relate(c[0],c[1],h.toString(c[2]));
if(c[0]instanceof l&&null===c[1]||c[1]instanceof l&&null===c[0]||null===c[0]&&null===c[1])return!1;throw Error("Illegal Argument");})};a.intersection=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]||null===c[1]?null:r.intersect(c[0],c[1])})};a.union=function(b,a){return m(b,a,function(a,c,d){d=h.autoCastFeatureToGeometry(d);a=[];if(0===d.length)throw Error("Function called with wrong number of Parameters");if(1===d.length)if(h.isArray(d[0]))for(d=
h.autoCastFeatureToGeometry(d[0]),c=0;c<d.length;c++){if(null!==d[c]){if(!(d[c]instanceof l))throw Error("Illegal Argument");a.push(d[c])}}else if(h.isImmutableArray(d[0]))for(d=h.autoCastFeatureToGeometry(d[0].toArray()),c=0;c<d.length;c++){if(null!==d[c]){if(!(d[c]instanceof l))throw Error("Illegal Argument");a.push(d[c])}}else{if(d[0]instanceof l)return h.fixSpatialReference(k.cloneGeometry(d[0]),b.spatialReference);if(null===d[0])return null;throw Error("Illegal Argument");}else for(c=0;c<d.length;c++)if(null!==
d[c]){if(!(d[c]instanceof l))throw Error("Illegal Argument");a.push(d[c])}return 0===a.length?null:r.union(a)})};a.difference=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null!==c[0]&&null===c[1]?k.cloneGeometry(c[0]):null===c[0]?null:r.difference(c[0],c[1])})};a.symmetricdifference=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);u(c);return null===c[0]&&null===c[1]?null:null===c[0]?k.cloneGeometry(c[1]):null===c[1]?k.cloneGeometry(c[0]):
r.symmetricDifference(c[0],c[1])})};a.clip=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,2);if(!(c[1]instanceof g)&&null!==c[1])throw Error("Illegal Argument");if(null===c[0])return null;if(!(c[0]instanceof l))throw Error("Illegal Argument");return null===c[1]?null:r.clip(c[0],c[1])})};a.cut=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,2);if(!(c[1]instanceof e)&&null!==c[1])throw Error("Illegal Argument");if(null===
c[0])return[];if(!(c[0]instanceof l))throw Error("Illegal Argument");return null===c[1]?[k.cloneGeometry(c[0])]:r.cut(c[0],c[1])})};a.area=function(b,a){return m(b,a,function(a,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return a=h.autoCastArrayOfPointsToPolygon(d[0],b.spatialReference),null===a?0:r.planarArea(a,k.convertSquareUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof l))throw Error("Illegal Argument");
return r.planarArea(d[0],k.convertSquareUnitsToCode(h.defaultUndefined(d[1],-1)))})};a.areageodetic=function(b,a){return m(b,a,function(a,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return a=h.autoCastArrayOfPointsToPolygon(d[0],b.spatialReference),null===a?0:r.geodesicArea(a,k.convertSquareUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof l))throw Error("Illegal Argument");return r.geodesicArea(d[0],k.convertSquareUnitsToCode(h.defaultUndefined(d[1],
-1)))})};a.length=function(b,a){return m(b,a,function(a,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return a=h.autoCastArrayOfPointsToPolyline(d[0],b.spatialReference),null===a?0:r.planarLength(a,k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof l))throw Error("Illegal Argument");return r.planarLength(d[0],k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)))})};a.lengthgeodetic=function(b,
a){return m(b,a,function(a,c,d){h.pcCheck(d,1,2);d=h.autoCastFeatureToGeometry(d);if(null===d[0])return 0;if(h.isArray(d[0])||h.isImmutableArray(d[0]))return a=h.autoCastArrayOfPointsToPolyline(d[0],b.spatialReference),null===a?0:r.geodesicLength(a,k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)));if(!(d[0]instanceof l))throw Error("Illegal Argument");return r.geodesicLength(d[0],k.convertLinearUnitsToCode(h.defaultUndefined(d[1],-1)))})};a.distance=function(b,a){return m(b,a,function(a,c,
d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);a=d[0];if(h.isArray(d[0])||h.isImmutableArray(d[0]))a=h.autoCastArrayOfPointsToMultiPoint(d[0],b.spatialReference);c=d[1];if(h.isArray(d[1])||h.isImmutableArray(d[1]))c=h.autoCastArrayOfPointsToMultiPoint(d[1],b.spatialReference);if(!(a instanceof l))throw Error("Illegal Argument");if(!(c instanceof l))throw Error("Illegal Argument");return r.distance(a,c,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1)))})};a.distancegeodetic=function(b,
a){return m(b,a,function(b,a,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);b=d[0];a=d[1];if(!(b instanceof c))throw Error("Illegal Argument");if(!(a instanceof c))throw Error("Illegal Argument");var f=new e({paths:[],spatialReference:b.spatialReference});f.addPath([b,a]);return r.geodesicLength(f,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1)))})};a.densify=function(a,c){return m(a,c,function(a,c,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);if(null===d[0])return null;if(!(d[0]instanceof
l))throw Error("Illegal Argument");a=h.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return d[0]instanceof b||d[0]instanceof e?r.densify(d[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]instanceof g?r.densify(q(d[0]),a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]})};a.densifygeodetic=function(a,c){return m(a,c,function(a,c,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,3);if(null===d[0])return null;if(!(d[0]instanceof
l))throw Error("Illegal Argument");a=h.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");if(0>=a)throw Error("Illegal Argument");return d[0]instanceof b||d[0]instanceof e?r.geodesicDensify(d[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]instanceof g?r.geodesicDensify(q(d[0]),a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1))):d[0]})};a.generalize=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,4);if(null===c[0])return null;
if(!(c[0]instanceof l))throw Error("Illegal Argument");b=h.toNumber(c[1]);if(isNaN(b))throw Error("Illegal Argument");return r.generalize(c[0],b,h.toBoolean(h.defaultUndefined(c[2],!0)),k.convertLinearUnitsToCode(h.defaultUndefined(c[3],-1)))})};a.buffer=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,3);if(null===c[0])return null;if(!(c[0]instanceof l))throw Error("Illegal Argument");b=h.toNumber(c[1]);if(isNaN(b))throw Error("Illegal Argument");return 0===
b?k.cloneGeometry(c[0]):r.buffer(c[0],b,k.convertLinearUnitsToCode(h.defaultUndefined(c[2],-1)))})};a.buffergeodetic=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,2,3);if(null===c[0])return null;if(!(c[0]instanceof l))throw Error("Illegal Argument");b=h.toNumber(c[1]);if(isNaN(b))throw Error("Illegal Argument");return 0===b?k.cloneGeometry(c[0]):r.geodesicBuffer(c[0],b,k.convertLinearUnitsToCode(h.defaultUndefined(c[2],-1)))})};a.offset=function(a,c){return m(a,
c,function(a,c,d){d=h.autoCastFeatureToGeometry(d);h.pcCheck(d,2,6);if(null===d[0])return null;if(!(d[0]instanceof b||d[0]instanceof e))throw Error("Illegal Argument");a=h.toNumber(d[1]);if(isNaN(a))throw Error("Illegal Argument");c=h.toNumber(h.defaultUndefined(d[4],10));if(isNaN(c))throw Error("Illegal Argument");var f=h.toNumber(h.defaultUndefined(d[5],0));if(isNaN(f))throw Error("Illegal Argument");return r.offset(d[0],a,k.convertLinearUnitsToCode(h.defaultUndefined(d[2],-1)),h.toString(h.defaultUndefined(d[3],
"round")).toLowerCase(),c,f)})};a.rotate=function(a,d){return m(a,d,function(a,d,e){e=h.autoCastFeatureToGeometry(e);h.pcCheck(e,2,3);a=e[0];if(null===a)return null;if(!(a instanceof l))throw Error("Illegal Argument");a instanceof g&&(a=b.fromExtent(a));d=h.toNumber(e[1]);if(isNaN(d))throw Error("Illegal Argument");e=h.defaultUndefined(e[2],null);if(null===e)return r.rotate(a,d);if(e instanceof c)return r.rotate(a,d,e);throw Error("Illegal Argument");})};a.centroid=function(a,p){return m(a,p,function(p,
q,m){m=h.autoCastFeatureToGeometry(m);h.pcCheck(m,1,1);if(null===m[0])return null;p=m[0];if(h.isArray(m[0])||h.isImmutableArray(m[0]))p=h.autoCastArrayOfPointsToMultiPoint(m[0],a.spatialReference);if(null===p)return null;if(!(p instanceof l))throw Error("Illegal Argument");return p instanceof c?h.fixSpatialReference(k.cloneGeometry(m[0]),a.spatialReference):p instanceof b?p.centroid:p instanceof e?d.centroidPolyline(p):p instanceof f?d.centroidMultiPoint(p):p instanceof g?p.center:null})};a.multiparttosinglepart=
function(a,d){return m(a,d,function(d,q,m){m=h.autoCastFeatureToGeometry(m);h.pcCheck(m,1,1);q=[];if(null===m[0])return null;if(!(m[0]instanceof l))throw Error("Illegal Argument");if(m[0]instanceof c||m[0]instanceof g)return[h.fixSpatialReference(k.cloneGeometry(m[0]),a.spatialReference)];d=r.simplify(m[0]);if(d instanceof b){q=[];var u=[];for(m=0;m<d.rings.length;m++)if(d.isClockwise(d.rings[m])){var w=p.fromJSON({rings:[d.rings[m]],hasZ:!0===d.hasZ,hasM:!0===d.hasM,spatialReference:d.spatialReference.toJSON()});
q.push(w)}else u.push({ring:d.rings[m],pt:d.getPoint(m,0)});for(d=0;d<u.length;d++)for(m=0;m<q.length;m++)if(q[m].contains(u[d].pt)){q[m].addRing(u[d].ring);break}return q}if(d instanceof e){q=[];for(m=0;m<d.paths.length;m++)u=p.fromJSON({paths:[d.paths[m]],hasZ:!0===d.hasZ,hasM:!0===d.hasM,spatialReference:d.spatialReference.toJSON()}),q.push(u);return q}if(m[0]instanceof f){d=h.fixSpatialReference(k.cloneGeometry(m[0]),a.spatialReference);for(m=0;m<d.points.length;m++)q.push(d.getPoint(m));return q}return null})};
a.issimple=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,1,1);if(null===c[0])return!0;if(!(c[0]instanceof l))throw Error("Illegal Argument");return r.isSimple(c[0])})};a.simplify=function(b,a){return m(b,a,function(b,a,c){c=h.autoCastFeatureToGeometry(c);h.pcCheck(c,1,1);if(null===c[0])return null;if(!(c[0]instanceof l))throw Error("Illegal Argument");return r.simplify(c[0])})}}})},"esri/arcade/kernel":function(){define(["require","exports","../geometry/Extent"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.convertSquareUnitsToCode=function(a){if(void 0===a)return null;if("number"===typeof a)return a;switch(a.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square-meters":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 109413;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 109414;
case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 109405}return null};a.shapeExtent=function(a){if(null===a)return null;switch(a.type){case "polygon":case "multipoint":case "polyline":return a.extent;case "point":return new m({xmin:a.x,
ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference});case "extent":return a}return null};a.convertLinearUnitsToCode=function(a){if(void 0===a)return null;if("number"===typeof a||"number"===typeof a)return a;switch(a.toLowerCase()){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":case "square-meter":case "square-meters":return 9001;case "miles":case "mile":case "squaremile":case "squaremiles":case "square-miles":case "square-mile":return 9035;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "square-kilometers":case "square-kilometer":case "km":return 9036;
case "yard":case "yd":case "yards":case "square-yards":case "square-yard":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "square-feet":case "square-foot":case "squarefeet":case "squarefoot":return 9002}return null};a.sameGeomType=function(a,h){return a===h||"point"===a&&"esriGeometryPoint"===h||"polyline"===a&&"esriGeometryPolyline"===h||"polygon"===a&&"esriGeometryPolygon"===h||"extent"===a&&"esriGeometryEnvelope"===h||"multipoint"===a&&"esriGeometryMultipoint"===
h||"point"===h&&"esriGeometryPoint"===a||"polyline"===h&&"esriGeometryPolyline"===a||"polygon"===h&&"esriGeometryPolygon"===a||"extent"===h&&"esriGeometryEnvelope"===a||"multipoint"===h&&"esriGeometryMultipoint"===a?!0:!1};a.cloneGeometry=function(a){if(null===a)return null;var h=a.clone();void 0!==a.cache._geVersion&&(h.cache._geVersion=a.cache._geVersion);return h}})},"esri/arcade/functions/maths":function(){define(["require","exports","dojo/number","../languageUtils"],function(n,a,m,k){function h(a,
g,l){if("undefined"===typeof l||0===+l)return Math[a](g);g=+g;l=+l;if(isNaN(g)||"number"!==typeof l||0!==l%1)return NaN;g=g.toString().split("e");g=Math[a](+(g[0]+"e"+(g[1]?+g[1]-l:-l)));g=g.toString().split("e");return+(g[0]+"e"+(g[1]?+g[1]+l:l))}Object.defineProperty(a,"__esModule",{value:!0});a.registerFunctions=function(a,g){function d(a,c,b){a=k.toNumber(a);return isNaN(a)?a:isNaN(c)||isNaN(b)||c>b?NaN:a<c?c:a>b?b:a}a.number=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,2);b=c[0];
return k.isNumber(b)?b:null===b?0:k.isDate(b)||k.isBoolean(b)?Number(b):k.isArray(b)?NaN:""===b||void 0===b?Number(b):k.isString(b)?void 0!==c[1]?(c=k.multiReplace(c[1],"\u2030",""),c=k.multiReplace(c,"\u00a4",""),m.parse(b,{pattern:c})):Number(b.trim()):Number(b)})};a.abs=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.abs(k.toNumber(c[0]))})};a.acos=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.acos(k.toNumber(c[0]))})};a.asin=function(a,c){return g(a,
c,function(b,a,c){k.pcCheck(c,1,1);return Math.asin(k.toNumber(c[0]))})};a.atan=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.atan(k.toNumber(c[0]))})};a.atan2=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,2,2);return Math.atan2(k.toNumber(c[0]),k.toNumber(c[1]))})};a.ceil=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,2);return 2===c.length?(b=k.toNumber(c[1]),isNaN(b)&&(b=0),h("ceil",k.toNumber(c[0]),-1*b)):Math.ceil(k.toNumber(c[0]))})};a.round=function(a,
c){return g(a,c,function(b,a,c){k.pcCheck(c,1,2);return 2===c.length?(b=k.toNumber(c[1]),isNaN(b)&&(b=0),h("round",k.toNumber(c[0]),-1*b)):Math.round(k.toNumber(c[0]))})};a.floor=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,2);return 2===c.length?(b=k.toNumber(c[1]),isNaN(b)&&(b=0),h("floor",k.toNumber(c[0]),-1*b)):Math.floor(k.toNumber(c[0]))})};a.cos=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.cos(k.toNumber(c[0]))})};a.isnan=function(a,c){return g(a,c,function(b,
a,c){k.pcCheck(c,1,1);return"number"===typeof c[0]&&isNaN(c[0])})};a.exp=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.exp(k.toNumber(c[0]))})};a.log=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.log(k.toNumber(c[0]))})};a.pow=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,2,2);return Math.pow(k.toNumber(c[0]),k.toNumber(c[1]))})};a.random=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,0,0);return Math.random()})};a.sin=function(a,
c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.sin(k.toNumber(c[0]))})};a.sqrt=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.sqrt(k.toNumber(c[0]))})};a.tan=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return Math.tan(k.toNumber(c[0]))})};a.defaultvalue=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,2,2);return null===c[0]||""===c[0]||void 0===c[0]?c[1]:c[0]})};a.isempty=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return null===
c[0]||""===c[0]||void 0===c[0]?!0:!1})};a["boolean"]=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,1,1);return k.toBoolean(c[0])})};a.constrain=function(a,c){return g(a,c,function(b,a,c){k.pcCheck(c,3,3);b=k.toNumber(c[1]);a=k.toNumber(c[2]);if(k.isArray(c[0])){var e=[],f=0;for(c=c[0];f<c.length;f++)e.push(d(c[f],b,a));return e}if(k.isImmutableArray(c[0])){e=[];for(f=0;f<c[0].length();f++)e.push(d(c[0].get(f),b,a));return e}return d(c[0],b,a)})}}})},"esri/arcade/functions/stats":function(){define(["require",
"exports","../languageUtils","./fieldStats"],function(n,a,m,k){function h(a,g,l,f){if(1===f.length){if(m.isArray(f[0]))return k.calculateStat(a,f[0],-1);if(m.isImmutableArray(f[0]))return k.calculateStat(a,f[0].toArray(),-1)}return k.calculateStat(a,f,-1)}Object.defineProperty(a,"__esModule",{value:!0});a.registerFunctions=function(a,g){a.stdev=function(a,d){return g(a,d,function(a,b,d){return h("stdev",a,b,d)})};a.variance=function(a,d){return g(a,d,function(a,b,d){return h("variance",a,b,d)})};
a.average=function(a,d){return g(a,d,function(a,b,d){return h("mean",a,b,d)})};a.mean=function(a,d){return g(a,d,function(a,b,d){return h("mean",a,b,d)})};a.sum=function(a,d){return g(a,d,function(a,b,d){return h("sum",a,b,d)})};a.min=function(a,d){return g(a,d,function(a,b,d){return h("min",a,b,d)})};a.max=function(a,d){return g(a,d,function(a,b,d){return h("max",a,b,d)})};a.distinct=function(a,d){return g(a,d,function(a,b,d){return h("distinct",a,b,d)})};a.count=function(a,d){return g(a,d,function(a,
b,d){m.pcCheck(d,1,1);if(m.isArray(d[0])||m.isString(d[0]))return d[0].length;if(m.isImmutableArray(d[0]))return d[0].length();throw Error("Invalid Parameters for Count");})}}})},"esri/arcade/functions/fieldStats":function(){define(["require","exports","../languageUtils"],function(n,a,m){function k(a){for(var d=0,l=0;l<a.length;l++)d+=a[l];return d/a.length}function h(a){for(var d=k(a),l=0,f=0;f<a.length;f++)l+=Math.pow(d-a[f],2);return l/a.length}Object.defineProperty(a,"__esModule",{value:!0});
a.decodeStatType=function(a){switch(a.toLowerCase()){case "distinct":return"distinct";case "avg":case "mean":return"avg";case "min":return"min";case "sum":return"sum";case "max":return"max";case "stdev":case "stddev":return"stddev";case "var":case "variance":return"var";case "count":return"count"}return""};a.calculateStat=function(a,g,l){void 0===l&&(l=1E3);switch(a.toLowerCase()){case "distinct":a:{a=l;l=[];for(var d={},c=[],b=0;b<g.length;b++){if(void 0!==g[b]&&null!==g[b]&&g[b]!==m.voidOperation){var e=
g[b];if(m.isNumber(e)||m.isString(e))void 0===d[e]&&(l.push(e),d[e]=1);else{for(var p=!1,q=0;q<c.length;q++)!0===m.equalityTest(c[q],e)&&(p=!0);!1===p&&(c.push(e),l.push(e))}}if(l.length>=a&&-1!==a){g=l;break a}}g=l}return g;case "avg":case "mean":return k(m.toNumberArray(g));case "min":return Math.min.apply(Math,m.toNumberArray(g));case "sum":g=m.toNumberArray(g);for(l=a=0;l<g.length;l++)a+=g[l];return a;case "max":return Math.max.apply(Math,m.toNumberArray(g));case "stdev":case "stddev":return Math.sqrt(h(m.toNumberArray(g)));
case "var":case "variance":return h(m.toNumberArray(g));case "count":return g.length}return 0}})},"esri/arcade/functions/string":function(){define("require exports ../ArcadePortal ../Dictionary ../Feature ../languageUtils".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});a.registerFunctions=function(a,l){a.portal=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,1,1);return new m(d.toString(c[0]))})};a.trim=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,
1,1);return d.toString(c[0]).trim()})};a.upper=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,1,1);return d.toString(c[0]).toUpperCase()})};a.proper=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,1,2);b=1;2===c.length&&"firstword"===d.toString(c[1]).toLowerCase()&&(b=2);a=/\s/;c=d.toString(c[0]);for(var e="",f=!0,g=0;g<c.length;g++){var l=c[g];a.test(l)?1===b&&(f=!0):l.toUpperCase()!==l.toLowerCase()&&(f?(l=l.toUpperCase(),f=!1):l=l.toLowerCase());e+=l}return e})};a.lower=function(a,
c){return l(a,c,function(b,a,c){d.pcCheck(c,1,1);return d.toString(c[0]).toLowerCase()})};a.guid=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,0,1);if(0<c.length)switch(d.toString(c[0]).toLowerCase()){case "digits":return d.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case "digits-hyphen":return d.generateUUID();case "digits-hyphen-parentheses":return"("+d.generateUUID()+")"}return"{"+d.generateUUID()+"}"})};a.console=function(a,c){return l(a,c,function(b,
c,f){0!==f.length&&(1===f.length?a.console(d.toString(f[0])):a.console(d.toString(f)));return d.voidOperation})};a.mid=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,2,3);b=d.toNumber(c[1]);if(isNaN(b))return"";0>b&&(b=0);if(2===c.length)return d.toString(c[0]).substr(b);a=d.toNumber(c[2]);if(isNaN(a))return"";0>a&&(a=0);return d.toString(c[0]).substr(b,a)})};a.find=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,2,3);b=0;if(2<c.length){b=d.toNumber(d.defaultUndefined(c[2],0));if(isNaN(b))return-1;
0>b&&(b=0)}return d.toString(c[1]).indexOf(d.toString(c[0]),b)})};a.left=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,2,2);b=d.toNumber(c[1]);if(isNaN(b))return"";0>b&&(b=0);return d.toString(c[0]).substr(0,b)})};a.right=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,2,2);b=d.toNumber(c[1]);if(isNaN(b))return"";0>b&&(b=0);return d.toString(c[0]).substr(-1*b,b)})};a.split=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,2,4);b=d.toNumber(d.defaultUndefined(c[2],-1));a=d.toBoolean(d.defaultUndefined(c[3],
!1));-1===b||null===b||!0===a?c=d.toString(c[0]).split(d.toString(c[1])):(isNaN(b)&&(b=-1),-1>b&&(b=-1),c=d.toString(c[0]).split(d.toString(c[1]),b));if(!1===a)return c;a=[];for(var e=0;e<c.length&&!(-1!==b&&a.length>=b);e++)""!==c[e]&&void 0!==c[e]&&a.push(c[e]);return a})};a.text=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,1,2);return d.toStringExplicit(c[0],c[1])})};a.concatenate=function(a,c){return l(a,c,function(b,a,c){b=[];if(1>c.length)return"";if(d.isArray(c[0])){a=d.defaultUndefined(c[2],
"");for(var e=0;e<c[0].length;e++)b[e]=d.toStringExplicit(c[0][e],a);return 1<c.length?b.join(c[1]):b.join("")}if(d.isImmutableArray(c[0])){a=d.defaultUndefined(c[2],"");for(e=0;e<c[0].length();e++)b[e]=d.toStringExplicit(c[0].get(e),a);return 1<c.length?b.join(c[1]):b.join("")}for(e=0;e<c.length;e++)b[e]=d.toStringExplicit(c[e]);return b.join("")})};a.reverse=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,1,1);if(d.isArray(c[0]))return b=c[0].slice(0),b.reverse(),b;if(d.isImmutableArray(c[0]))return b=
c[0].toArray().slice(0),b.reverse(),b;throw Error("Invalid Parameter");})};a.replace=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,3,4);b=d.toString(c[0]);a=d.toString(c[1]);var e=d.toString(c[2]);return(4===c.length?d.toBoolean(c[3]):1)?d.multiReplace(b,a,e):b.replace(a,e)})};a.domainname=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,2,4);if(c[0]instanceof h)return c[0].domainValueLookup(d.toString(c[1]),c[2],void 0===c[3]?void 0:d.toNumber(c[3]));throw Error("Invalid Parameter");
})};a.domaincode=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,2,4);if(c[0]instanceof h)return c[0].domainCodeLookup(d.toString(c[1]),c[2],void 0===c[3]?void 0:d.toNumber(c[3]));throw Error("Invalid Parameter");})};a.urlencode=function(a,c){return l(a,c,function(b,a,c){d.pcCheck(c,1,1);if(null===c[0])return"";if(c[0]instanceof k){b="";a=0;for(var e=c[0].keys();a<e.length;a++){var f=e[a],g=c[0].field(f);""!==b&&(b+="\x26");b=null===g?b+(encodeURIComponent(f)+"\x3d"):b+(encodeURIComponent(f)+
"\x3d"+encodeURIComponent(g))}return b}return encodeURIComponent(d.toString(c[0]))})}}})},"esri/arcade/arcadeRuntime":function(){define("require exports ./ArcadePortal ./Attachment ./Dictionary ./Feature ./FunctionWrapper ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./functions/date ./functions/geometry ./functions/geomsync ./functions/maths ./functions/stats ./functions/string ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../geometry/SpatialReference".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E){function B(b,a){for(var c=[],d=0;d<a.arguments.length;d++)c.push(F(b,a.arguments[d]));return c}function G(b,a,c){try{return c(b,a,B(b,a))}catch(ha){throw ha;}}function F(a,e){try{switch(e.type){case "EmptyStatement":return c.voidOperation;case "VariableDeclarator":var f=null===e.init?null:F(a,e.init);f===c.voidOperation&&(f=null);if("Identifier"!==e.id.type)throw Error("Can only assign a regular variable");var l=e.id.name.toLowerCase();null!==
a.localScope?a.localScope[l]={value:f,valueset:!0,node:e.init}:a.globalScope[l]={value:f,valueset:!0,node:e.init};return c.voidOperation;case "VariableDeclaration":for(var p=0;p<e.declarations.length;p++)F(a,e.declarations[p]);return c.voidOperation;case "BlockStatement":var k;a:{for(var q=c.voidOperation,p=0;p<e.body.length;p++)if(q=F(a,e.body[p]),q instanceof c.ReturnResult||q===c.breakResult||q===c.continueResult){k=q;break a}k=q}return k;case "FunctionDeclaration":var m=e.id.name.toLowerCase();
a.globalScope[m]={valueset:!0,node:null,value:new g(e,a)};return c.voidOperation;case "ReturnStatement":var u;if(null===e.argument)u=new c.ReturnResult(c.voidOperation);else{var r=F(a,e.argument);u=new c.ReturnResult(r)}return u;case "IfStatement":var w;if("AssignmentExpression"===e.test.type||"UpdateExpression"===e.test.type)throw Error(b.nodeErrorMessage(e.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var t=F(a,e.test);if(!0===t)w=F(a,e.consequent);else if(!1===t)w=null!==e.alternate?F(a,
e.alternate):c.voidOperation;else throw Error(b.nodeErrorMessage(e,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));return w;case "ExpressionStatement":var v;if("AssignmentExpression"===e.expression.type||"UpdateExpression"===e.expression.type)v=F(a,e.expression);else{var y=F(a,e.expression);v=y===c.voidOperation?c.voidOperation:new c.ImplicitResult(y)}return v;case "AssignmentExpression":var x;var n=F(a,e.right),p=null,z="";if("MemberExpression"===e.left.type){p=F(a,e.left.object);!0===e.left.computed?
z=F(a,e.left.property):"Identifier"===e.left.property.type&&(z=e.left.property.name);if(c.isArray(p))if(c.isNumber(z)){0>z&&(z=p.length+z);if(0>z||z>p.length)throw Error("Assignment outside of array bounds");if(z===p.length&&"\x3d"!==e.operator)throw Error("Invalid Parameter");p[z]=H(n,e.operator,p[z],e)}else throw Error("Invalid Parameter");else if(p instanceof h){if(!1===c.isString(z))throw Error("Dictionary accessor must be a string");if(!0===p.hasField(z))p.setField(z,H(n,e.operator,p.field(z),
e));else{if("\x3d"!==e.operator)throw Error("Invalid Parameter");p.setField(z,H(n,e.operator,null,e))}}else if(p instanceof d){if(!1===c.isString(z))throw Error("Feature accessor must be a string");if(!0===p.hasField(z))p.setField(z,H(n,e.operator,p.field(z),e));else{if("\x3d"!==e.operator)throw Error("Invalid Parameter");p.setField(z,H(n,e.operator,null,e))}}else{if(c.isImmutableArray(p))throw Error("Array is Immutable");throw Error("Invalid Parameter");}x=c.voidOperation}else if(p=e.left.name.toLowerCase(),
null!==a.localScope&&void 0!==a.localScope[p])a.localScope[p]={value:H(n,e.operator,a.localScope[p].value,e),valueset:!0,node:e.right},x=c.voidOperation;else if(void 0!==a.globalScope[p])a.globalScope[p]={value:H(n,e.operator,a.globalScope[p].value,e),valueset:!0,node:e.right},x=c.voidOperation;else throw Error("Variable not recognised");return x;case "UpdateExpression":var A;var B,p=null,z="";if("MemberExpression"===e.argument.type){p=F(a,e.argument.object);!0===e.argument.computed?z=F(a,e.argument.property):
"Identifier"===e.argument.property.type&&(z=e.argument.property.name);if(c.isArray(p))if(c.isNumber(z)){0>z&&(z=p.length+z);if(0>z||z>=p.length)throw Error("Assignment outside of array bounds");B=c.toNumber(p[z]);p[z]="++"===e.operator?B+1:B-1}else throw Error("Invalid Parameter");else if(p instanceof h){if(!1===c.isString(z))throw Error("Dictionary accessor must be a string");if(!0===p.hasField(z))B=c.toNumber(p.field(z)),p.setField(z,"++"===e.operator?B+1:B-1);else throw Error("Invalid Parameter");
}else if(p instanceof d){if(!1===c.isString(z))throw Error("Feature accessor must be a string");if(!0===p.hasField(z))B=c.toNumber(p.field(z)),p.setField(z,"++"===e.operator?B+1:B-1);else throw Error("Invalid Parameter");}else{if(c.isImmutableArray(p))throw Error("Array is Immutable");throw Error("Invalid Parameter");}A=!1===e.prefix?B:"++"===e.operator?B+1:B-1}else{p="Identifier"===e.argument.type?e.argument.name.toLowerCase():"";if(!p)throw Error("Invalid identifier");if(null!==a.localScope&&void 0!==
a.localScope[p])B=c.toNumber(a.localScope[p].value),a.localScope[p]={value:"++"===e.operator?B+1:B-1,valueset:!0,node:e},A=!1===e.prefix?B:"++"===e.operator?B+1:B-1;else if(void 0!==a.globalScope[p])B=c.toNumber(a.globalScope[p].value),a.globalScope[p]={value:"++"===e.operator?B+1:B-1,valueset:!0,node:e},A=!1===e.prefix?B:"++"===e.operator?B+1:B-1;else throw Error("Variable not recognised");}return A;case "BreakStatement":return c.breakResult;case "ContinueStatement":return c.continueResult;case "ForStatement":null!==
e.init&&F(a,e.init);z={testResult:!0,lastAction:c.voidOperation};do b:{x=a;n=e;A=z;if(null!==n.test){A.testResult=F(x,n.test);if(!1===A.testResult)break b;if(!0!==A.testResult)throw Error(b.nodeErrorMessage(n,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));}A.lastAction=F(x,n.body);A.lastAction===c.breakResult?A.testResult=!1:A.lastAction instanceof c.ReturnResult?A.testResult=!1:null!==n.update&&F(x,n.update)}while(!0===z.testResult);p=z.lastAction instanceof c.ReturnResult?z.lastAction:c.voidOperation;
return p;case "ForInStatement":return K(a,e);case "Identifier":return R(a,e);case "MemberExpression":return I(a,e);case "Literal":return e.value;case "CallExpression":return O(a,e);case "UnaryExpression":return J(a,e);case "BinaryExpression":return M(a,e);case "LogicalExpression":return L(a,e);case "ConditionalExpression":throw Error(b.nodeErrorMessage(e,"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{for(p=[],z=0;z<e.elements.length;z++){var E=F(a,e.elements[z]);if(c.isFunctionParameter(E))throw Error(b.nodeErrorMessage(e,
"RUNTIME","FUNCTIONCONTEXTILLEGAL"));E===c.voidOperation?p.push(null):p.push(E)}}catch(Da){throw Da;}return p;case "ObjectExpression":p={};for(z=0;z<e.properties.length;z++){var G=F(a,e.properties[z]);if(c.isFunctionParameter(G.value))throw Error("Illegal Argument");if(!1===c.isString(G.key))throw Error("Illegal Argument");p[G.key.toString()]=G.value===c.voidOperation?null:G.value}var W=new h(p);W.immutable=!1;return W;case "Property":return{key:"Identifier"===e.key.type?e.key.name:F(a,e.key),value:F(a,
e.value)};default:throw Error(b.nodeErrorMessage(e,"RUNTIME","UNREOGNISED"));}}catch(Da){throw Da;}}function K(a,e){var f=F(a,e.right);"VariableDeclaration"===e.left.type&&F(a,e.left);var g=null,l="";if("VariableDeclaration"===e.left.type){var p=e.left.declarations[0].id;"Identifier"===p.type&&(l=p.name)}else"Identifier"===e.left.type&&(l=e.left.name);if(!l)throw Error(b.nodeErrorMessage(e,"RUNTIME","INVALIDVARIABLE"));l=l.toLowerCase();null!==a.localScope&&void 0!==a.localScope[l]&&(g=a.localScope[l]);
null===g&&void 0!==a.globalScope[l]&&(g=a.globalScope[l]);if(null===g)throw Error(b.nodeErrorMessage(e,"RUNTIME","VARIABLENOTDECLARED"));if(c.isArray(f)||c.isString(f)){f=f.length;for(p=0;p<f;p++){g.value=p;l=F(a,e.body);if(l===c.breakResult)break;if(l instanceof c.ReturnResult)return l}return c.voidOperation}if(c.isImmutableArray(f)){for(p=0;p<f.length();p++){g.value=p;l=F(a,e.body);if(l===c.breakResult)break;if(l instanceof c.ReturnResult)return l}return c.voidOperation}if(f instanceof h||f instanceof
d)for(f=f.keys(),p=0;p<f.length;p++){g.value=f[p];l=F(a,e.body);if(l===c.breakResult)break;if(l instanceof c.ReturnResult)return l}else return c.voidOperation}function H(a,d,e,f){switch(d){case "\x3d":return a===c.voidOperation?null:a;case "/\x3d":return c.toNumber(e)/c.toNumber(a);case "*\x3d":return c.toNumber(e)*c.toNumber(a);case "-\x3d":return c.toNumber(e)-c.toNumber(a);case "+\x3d":return c.isString(e)||c.isString(a)?c.toString(e)+c.toString(a):c.toNumber(e)+c.toNumber(a);case "%\x3d":return c.toNumber(e)%
c.toNumber(a);default:throw Error(b.nodeErrorMessage(f,"RUNTIME","OPERATORNOTRECOGNISED"));}}function N(a,c,d,e){c=c.toLowerCase();switch(c){case "hasz":return a=a.hasZ,void 0===a?!1:a;case "hasm":return a=a.hasM,void 0===a?!1:a;case "spatialreference":return c=a.spatialReference._arcadeCacheId,void 0===c&&(d=!0,Object.freeze&&Object.isFrozen(a.spatialReference)&&(d=!1),d&&(aa++,c=a.spatialReference._arcadeCacheId=aa)),a=new h({wkt:a.spatialReference.wkt,wkid:a.spatialReference.wkid}),void 0!==c&&
(a._arcadeCacheId="SPREF"+c.toString()),a}switch(a.type){case "extent":switch(c){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return a=a[c],void 0!==a?a:null;case "type":return"Extent"}break;case "polygon":switch(c){case "rings":return c=a.cache._arcadeCacheId,void 0===c&&(aa++,c=aa,a.cache._arcadeCacheId=c),a=new l(a.rings,a.spatialReference,!0===a.hasZ,!0===a.hasM,c);case "type":return"Polygon"}break;case "point":switch(c){case "x":case "y":case "z":case "m":return void 0!==
a[c]?a[c]:null;case "type":return"Point"}break;case "polyline":switch(c){case "paths":return c=a.cache._arcadeCacheId,void 0===c&&(aa++,c=aa,a.cache._arcadeCacheId=c),a=new l(a.paths,a.spatialReference,!0===a.hasZ,!0===a.hasM,c);case "type":return"Polyline"}break;case "multipoint":switch(c){case "points":return c=a.cache._arcadeCacheId,void 0===c&&(aa++,c=aa,a.cache._arcadeCacheId=c),a=new f(a.points,a.spatialReference,!0===a.hasZ,!0===a.hasM,c,1);case "type":return"Multipoint"}}throw Error(b.nodeErrorMessage(e,
"RUNTIME","PROPERTYNOTFOUND"));}function I(a,e){try{var f=F(a,e.object);if(null===f)throw Error(b.nodeErrorMessage(e,"RUNTIME","NOTFOUND"));if(!1===e.computed){if("Identifier"===e.property.type){if(f instanceof h||f instanceof d)return f.field(e.property.name);if(f instanceof y)return N(f,e.property.name,a,e)}throw Error(b.nodeErrorMessage(e,"RUNTIME","INVALIDTYPE"));}var g=F(a,e.property);if(f instanceof h||f instanceof d){if(c.isString(g))return f.field(g);throw Error(b.nodeErrorMessage(e,"RUNTIME",
"INVALIDTYPE"));}if(f instanceof y){if(c.isString(g))return N(f,g,a,e);throw Error(b.nodeErrorMessage(e,"RUNTIME","INVALIDTYPE"));}if(c.isArray(f)){if(c.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){0>g&&(g=f.length+g);if(g>=f.length||0>g)throw Error(b.nodeErrorMessage(e,"RUNTIME","OUTOFBOUNDS"));return f[g]}throw Error(b.nodeErrorMessage(e,"RUNTIME","INVALIDTYPE"));}if(c.isString(f)){if(c.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){0>g&&(g=f.length+g);if(g>=f.length||0>g)throw Error(b.nodeErrorMessage(e,
"RUNTIME","OUTOFBOUNDS"));return f[g]}throw Error(b.nodeErrorMessage(e,"RUNTIME","INVALIDTYPE"));}if(c.isImmutableArray(f)&&c.isNumber(g)&&isFinite(g)&&Math.floor(g)===g){0>g&&(g=f.length()+g);if(g>=f.length()||0>g)throw Error(b.nodeErrorMessage(e,"RUNTIME","OUTOFBOUNDS"));return f.get(g)}throw Error(b.nodeErrorMessage(e,"RUNTIME","INVALIDTYPE"));}catch(la){throw la;}}function J(a,d){try{var e=F(a,d.argument);if(c.isBoolean(e)){if("!"===d.operator)return!e;if("-"===d.operator)return-1*c.toNumber(e);
if("+"===d.operator)return 1*c.toNumber(e);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===d.operator)return-1*c.toNumber(e);if("+"===d.operator)return 1*c.toNumber(e);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}catch(ha){throw ha;}}function M(a,d){try{var e=[F(a,d.left),F(a,d.right)],f=e[0],g=e[1];switch(d.operator){case "\x3d\x3d":return c.equalityTest(f,g);case "!\x3d":return!c.equalityTest(f,g);case "\x3c":return c.greaterThanLessThan(f,
g,d.operator);case "\x3e":return c.greaterThanLessThan(f,g,d.operator);case "\x3c\x3d":return c.greaterThanLessThan(f,g,d.operator);case "\x3e\x3d":return c.greaterThanLessThan(f,g,d.operator);case "+":return c.isString(f)||c.isString(g)?c.toString(f)+c.toString(g):c.toNumber(f)+c.toNumber(g);case "-":return c.toNumber(f)-c.toNumber(g);case "*":return c.toNumber(f)*c.toNumber(g);case "/":return c.toNumber(f)/c.toNumber(g);case "%":return c.toNumber(f)%c.toNumber(g);default:throw Error(b.nodeErrorMessage(d,
"RUNTIME","OPERATORNOTRECOGNISED"));}}catch(ra){throw ra;}}function L(a,d){try{if("AssignmentExpression"===d.left.type||"UpdateExpression"===d.left.type)throw Error(b.nodeErrorMessage(d.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===d.right.type||"UpdateExpression"===d.right.type)throw Error(b.nodeErrorMessage(d.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var e=F(a,d.left);if(c.isBoolean(e))switch(d.operator){case "||":if(!0===e)return e;var f=F(a,d.right);
if(c.isBoolean(f))return f;throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYORORAND"));case "\x26\x26":if(!1===e)return e;f=F(a,d.right);if(c.isBoolean(f))return f;throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYORORAND"));default:throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYORORAND"));}throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYBOOLEAN"));}catch(la){throw la;}}function R(a,c){var d;try{var e=c.name.toLowerCase();if(null!==a.localScope&&void 0!==a.localScope[e]){d=a.localScope[e];if(!0===d.valueset)return d.value;
d.value=F(a,d.node);d.valueset=!0;return d.value}if(void 0!==a.globalScope[e]){d=a.globalScope[e];if(!0===d.valueset)return d.value;d.value=F(a,d.node);d.valueset=!0;return d.value}throw Error(b.nodeErrorMessage(c,"RUNTIME","VARIABLENOTFOUND"));}catch(la){throw la;}}function O(a,d){try{if("Identifier"!==d.callee.type)throw Error(b.nodeErrorMessage(d,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==a.localScope&&void 0!==a.localScope[d.callee.name.toLowerCase()]){var e=a.localScope[d.callee.name.toLowerCase()];
if(e.value instanceof c.NativeFunction)return e.value.fn(a,d);if(e.value instanceof g)return Q(a,d,e.value.definition);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTAFUNCTION"));}if(void 0!==a.globalScope[d.callee.name.toLowerCase()]){e=a.globalScope[d.callee.name.toLowerCase()];if(e.value instanceof c.NativeFunction)return e.value.fn(a,d);if(e.value instanceof g)return Q(a,d,e.value.definition);throw Error(b.nodeErrorMessage(d,"RUNTIME","NOTAFUNCTION"));}throw Error(b.nodeErrorMessage(d,"RUNTIME",
"NOTFOUND"));}catch(ha){throw ha;}}function T(b){return null==b?"":c.isArray(b)||c.isImmutableArray(b)?"Array":c.isDate(b)?"Date":c.isString(b)?"String":c.isBoolean(b)?"Boolean":c.isNumber(b)?"Number":b instanceof k?"Attachment":b instanceof m?"Portal":b instanceof h?"Dictionary":b instanceof d?"Feature":b instanceof x?"Point":b instanceof z?"Polygon":b instanceof A?"Polyline":b instanceof t?"Multipoint":b instanceof v?"Extent":c.isFunctionParameter(b)?"Function":c.isFeatureSet(b)?"FeatureSet":c.isFeatureSetCollection(b)?
"FeatureSetCollection":b===c.voidOperation?"":"number"===typeof b&&isNaN(b)?"Number":"Unrecognised Type"}function U(b,a,d,e){try{var f=F(b,a.arguments[d]);if(c.equalityTest(f,e))return F(b,a.arguments[d+1]);var g=a.arguments.length-d;return 1===g?F(b,a.arguments[d]):2===g?null:3===g?F(b,a.arguments[d+2]):U(b,a,d+2,e)}catch(va){throw va;}}function P(b,a,d,e){try{if(!0===e)return F(b,a.arguments[d+1]);if(3===a.arguments.length-d)return F(b,a.arguments[d+2]);var f=F(b,a.arguments[d+2]);if(!1===c.isBoolean(f))throw Error("WHEN needs boolean test conditions");
return P(b,a,d+2,f)}catch(ra){throw ra;}}function V(b,a){var c=b.length,d=Math.floor(c/2);if(0===c)return[];if(1===c)return[b[0]];var e=V(b.slice(0,d),a);b=V(b.slice(d,c),a);for(c=[];0<e.length||0<b.length;)0<e.length&&0<b.length?(d=a(e[0],b[0]),isNaN(d)&&(d=0),0>=d?(c.push(e[0]),e=e.slice(1)):(c.push(b[0]),b=b.slice(1))):0<e.length?(c.push(e[0]),e=e.slice(1)):0<b.length&&(c.push(b[0]),b=b.slice(1));return c}function W(b,a,d){try{var e=b.body;if(d.length!==b.params.length)throw Error("Invalid Parameter calls to function.");
for(var f=0;f<d.length;f++)a.localScope[b.params[f].name.toLowerCase()]={value:d[f],valueset:!0,node:null};var g=F(a,e);if(g instanceof c.ReturnResult)return g.value;if(g===c.breakResult)throw Error("Cannot Break from a Function");if(g===c.continueResult)throw Error("Cannot Continue from a Function");return g instanceof c.ImplicitResult?g.value:g}catch(va){throw va;}}function Q(b,a,c){return G(b,a,function(a,d,e){a={spatialReference:b.spatialReference,globalScope:b.globalScope,depthCounter:b.depthCounter+
1,console:b.console,lrucache:b.lrucache,localScope:{}};if(64<a.depthCounter)throw Error("Exceeded maximum function depth");return W(c,a,e)})}function Z(b){return function(){var a={spatialReference:b.context.spatialReference,console:b.context.console,lrucache:b.context.lrucache,localScope:{},depthCounter:b.context.depthCounter+1,globalScope:b.context.globalScope};if(64<a.depthCounter)throw Error("Exceeded maximum function depth");return W(b.definition,a,arguments)}}function X(b){console.log(b)}Object.defineProperty(a,
"__esModule",{value:!0});var aa=0,da={};e.registerFunctions(da,G);u.registerFunctions(da,G);r.registerFunctions(da,G);p.registerFunctions(da,G);w.registerFunctions(da,G);q.registerFunctions(da,G);da["typeof"]=function(b,a){return G(b,a,function(b,a,d){c.pcCheck(d,1,1);b=T(d[0]);if("Unrecognised Type"===b)throw Error("Unrecognised Type");return b})};da.iif=function(b,a){try{c.pcCheck(null===a.arguments?[]:a.arguments,3,3);var d=F(b,a.arguments[0]);if(!1===c.isBoolean(d))throw Error("IF Function must have a boolean test condition");
var e=F(b,a.arguments[1]),f=F(b,a.arguments[2]);return!0===d?e:f}catch(ra){throw ra;}};da.decode=function(b,a){try{if(2>a.arguments.length)throw Error("Missing Parameters");if(2===a.arguments.length)return F(b,a.arguments[1]);if(0===(a.arguments.length-1)%2)throw Error("Must have a default value result.");var c=F(b,a.arguments[0]);return U(b,a,1,c)}catch(ha){throw ha;}};da.when=function(b,a){try{if(3>a.arguments.length)throw Error("Missing Parameters");if(0===a.arguments.length%2)throw Error("Must have a default value result.");
var d=F(b,a.arguments[0]);if(!1===c.isBoolean(d))throw Error("WHEN needs boolean test conditions");return P(b,a,0,d)}catch(ha){throw ha;}};da.top=function(b,a){return G(b,a,function(b,a,d){c.pcCheck(d,2,2);if(c.isArray(d[0]))return c.toNumber(d[1])>=d[0].length?d[0].slice(0):d[0].slice(0,c.toNumber(d[1]));if(c.isImmutableArray(d[0]))return c.toNumber(d[1])>=d[0].length()?d[0].slice(0):d[0].slice(0,c.toNumber(d[1]));throw Error("Top cannot accept this parameter type");})};da.first=function(b,a){return G(b,
a,function(b,a,d){c.pcCheck(d,1,1);return c.isArray(d[0])?0===d[0].length?null:d[0][0]:c.isImmutableArray(d[0])?0===d[0].length()?null:d[0].get(0):null})};da.sort=function(b,a){return G(b,a,function(b,a,d){c.pcCheck(d,1,2);b=d[0];c.isImmutableArray(b)&&(b=b.toArray());if(!1===c.isArray(b))throw Error("Illegal Argument");if(1<d.length){if(!1===c.isFunctionParameter(d[1]))throw Error("Illegal Argument");var e=Z(d[1]);return b=V(b,function(b,a){return e(b,a)})}if(0===b.length)return[];d={};for(a=0;a<
b.length;a++){var f=T(b[a]);""!==f&&(d[f]=!0)}if(!0===d.Array||!0===d.Dictionary||!0===d.Feature||!0===d.Point||!0===d.Polygon||!0===d.Polyline||!0===d.Multipoint||!0===d.Extent||!0===d.Function)return b.slice(0);a=0;var f="",g;for(g in d)a++,f=g;return b=1<a||"String"===f?V(b,function(b,a){if(null===b||void 0===b||b===c.voidOperation)return null===a||void 0===a||a===c.voidOperation?0:1;if(null===a||void 0===a||a===c.voidOperation)return-1;b=c.toString(b);a=c.toString(a);return b<a?-1:b===a?0:1}):
"Number"===f?V(b,function(b,a){return b-a}):"Boolean"===f?V(b,function(b,a){return b===a?0:a?-1:1}):"Date"===f?V(b,function(b,a){return a-b}):b.slice(0)})};for(var ga in da)da[ga]={value:new c.NativeFunction(da[ga]),valueset:!0,node:null};var ca=function(){};ca.prototype=da;ca.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};ca.prototype.pi={value:Math.PI,valueset:!0,node:null};a.functionHelper={fixSpatialReference:c.fixSpatialReference,parseArguments:B,standardFunction:G};
a.extend=function(a){for(var d={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:G,evaluateIdentifier:R,arcadeCustomFunctionHandler:Z},e=0;e<a.length;e++)a[e].registerFunctions(d);for(var f in d.functions)da[f]={value:new c.NativeFunction(d.functions[f]),valueset:!0,node:null},ca.prototype[f]=da[f];for(e=0;e<d.signatures.length;e++)b.addFunctionDeclaration(d.signatures[e],"async")};a.executeScript=function(b,a){var e=a.spatialReference;if(null===e||void 0===e)e=new E({wkid:102100});
var f=a.vars,l=a.customfunctions,p=new ca;f||(f={});l||(l={});var k=new h({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});k.immutable=!1;p.textformatting={value:k,valueset:!0,node:null};for(var q in l)p[q]={value:new c.NativeFunction(l[q]),native:!0,valueset:!0,node:null};for(q in f)p[q]=f[q]&&"esri.Graphic"===f[q].declaredClass?{value:d.createFromGraphic(f[q]),valueset:!0,node:null}:{value:f[q],valueset:!0,node:null};b=F({spatialReference:e,globalScope:p,
localScope:null,console:a.console?a.console:X,lrucache:a.lrucache,depthCounter:1},b.body[0].body);b instanceof c.ReturnResult&&(b=b.value);b instanceof c.ImplicitResult&&(b=b.value);b===c.voidOperation&&(b=null);if(b===c.breakResult)throw Error("Cannot return BREAK");if(b===c.continueResult)throw Error("Cannot return CONTINUE");if(b instanceof g)throw Error("Cannot return FUNCTION");if(b instanceof c.NativeFunction)throw Error("Cannot return FUNCTION");return b};a.extractFieldLiterals=function(a,
c){void 0===c&&(c=!1);return b.findFieldLiterals(a,c)};a.validateScript=function(a,c){return b.validateScript(a,c,"simple")};a.referencesMember=function(a,c){return b.referencesMember(a,c)};a.referencesFunction=function(a,c){return b.referencesFunction(a,c)};a.findFunctionCalls=function(a){return b.findFunctionCalls(a,!1)}})},"esri/arcade/parser":function(){define(["require","exports","./treeAnalysis","./lib/esprima"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.parseScript=
function(a,d){void 0===d&&(d=[]);a=k.parse("function _() { "+a+"\n}");if(null===a.body||void 0===a.body)throw Error("No formula provided.");if(0===a.body.length)throw Error("No formula provided.");if(0===a.body.length)throw Error("No formula provided.");if("BlockStatement"!==a.body[0].body.type)throw Error("Invalid formula content.");var g=m.validateLanguage(a);if(""!==g)throw Error(g);m.findScriptDependencies(a,d);return a};a.scriptCheck=function(a,d,g,l,f){var c=[];try{var b=k.parse("function _() { "+
a+"\n}",{tolerant:!0,loc:!0}),e=b.errors;if(0<e.length)for(var h=0;h<e.length;h++)c.push({line:e[h].lineNumber,character:e[h].column,reason:e[h].description});var q=m.checkScript(b,d,g,l,f);for(d=0;d<q.length;d++)c.push(q[d])}catch(r){try{"Unexpected token }"===r.description?(r.index=("function _() { "+a+"\n}").length-1,c.push({line:r.lineNumber,character:r.column,reason:"Unexpected end of script"})):c.push({line:r.lineNumber,character:r.column,reason:r.description})}catch(w){}}return c};a.extractFieldLiterals=
function(a,d){void 0===d&&(d=!1);return m.findFieldLiterals(a,d)};a.validateScript=function(a,d,g){return m.validateScript(a,d,g)};a.referencesMember=function(a,d){return m.referencesMember(a,d)};a.referencesFunction=function(a,d){return m.referencesFunction(a,d)}})},"esri/arcade/lib/esprima":function(){(function(n,a){"function"===typeof define&&define.amd?define(["exports"],a):"undefined"!==typeof exports?a(exports):a(n.esprima={})})(this,function(n){function a(b,a){if(!b)throw Error("ASSERT: "+
a);}function m(b){return 48<=b&&57>=b}function k(b){return 0<="0123456789abcdefABCDEF".indexOf(b)}function h(b){return 0<="01234567".indexOf(b)}function d(b){return 10===b||13===b||8232===b||8233===b}function g(b){return 36===b||95===b||65<=b&&90>=b||97<=b&&122>=b||92===b||128<=b&&Ga.NonAsciiIdentifierStart.test(String.fromCharCode(b))}function l(b){return 36===b||95===b||65<=b&&90>=b||97<=b&&122>=b||48<=b&&57>=b||92===b||128<=b&&Ga.NonAsciiIdentifierPart.test(String.fromCharCode(b))}function f(b){b=
b.toLowerCase();switch(b.length){case 2:return"if"===b||"in"===b;case 3:return"var"===b||"for"===b;case 4:return"else"===b;case 5:return"break"===b;case 6:return"return"===b;case 8:return"function"===b.toLowerCase()||"continue"===b;default:return!1}}function c(b,c,d,e,f){a("number"===typeof d,"Comment must have valid position");sa.lastCommentStart>=d||(sa.lastCommentStart=d,b={type:b,value:c},ea.range&&(b.range=[d,e]),ea.loc&&(b.loc=f),ea.comments.push(b),ea.attachComment&&(ea.leadingComments.push(b),
ea.trailingComments.push(b)))}function b(b){var a,e,f;a=Y-b;for(e={start:{line:xa,column:Y-ya-b}};Y<Aa;)if(f=fa.charCodeAt(Y),++Y,d(f)){ea.comments&&(b=fa.slice(a+b,Y-1),e.end={line:xa,column:Y-ya-1},c("Line",b,a,Y-1,e));13===f&&10===fa.charCodeAt(Y)&&++Y;++xa;ya=Y;return}ea.comments&&(b=fa.slice(a+b,Y),e.end={line:xa,column:Y-ya},c("Line",b,a,Y,e))}function e(){var a,e;for(e=0===Y;Y<Aa;)if(a=fa.charCodeAt(Y),32===a||9===a||11===a||12===a||160===a||5760<=a&&0<=[5760,6158,8192,8193,8194,8195,8196,
8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(a))++Y;else if(d(a))++Y,13===a&&10===fa.charCodeAt(Y)&&++Y,++xa,ya=Y,e=!0;else if(47===a)if(a=fa.charCodeAt(Y+1),47===a)++Y,++Y,b(2),e=!0;else if(42===a){++Y;++Y;a:{var f=a=void 0,g=void 0,g=void 0;ea.comments&&(a=Y-2,f={start:{line:xa,column:Y-ya-2}});for(;Y<Aa;)if(g=fa.charCodeAt(Y),d(g))13===g&&10===fa.charCodeAt(Y+1)&&++Y,++xa,++Y,ya=Y,Y>=Aa&&L();else{if(42===g&&47===fa.charCodeAt(Y+1)){++Y;++Y;ea.comments&&(g=fa.slice(a+2,Y-2),f.end=
{line:xa,column:Y-ya},c("Block",g,a,Y,f));break a}++Y}L()}}else break;else if(e&&45===a)if(45===fa.charCodeAt(Y+1)&&62===fa.charCodeAt(Y+2))Y+=3,b(3);else break;else if(60===a)if("!--"===fa.slice(Y+1,Y+4))++Y,++Y,++Y,++Y,b(4);else break;else break}function p(b){var a,c,d=0;a="u"===b?4:2;for(b=0;b<a;++b)if(Y<Aa&&k(fa[Y]))c=fa[Y++],d=16*d+"0123456789abcdef".indexOf(c.toLowerCase());else return"";return String.fromCharCode(d)}function q(){var b,a;b=fa.charCodeAt(Y++);a=String.fromCharCode(b);92===b&&
(117!==fa.charCodeAt(Y)&&L(),++Y,(b=p("u"))&&"\\"!==b&&g(b.charCodeAt(0))||L(),a=b);for(;Y<Aa;){b=fa.charCodeAt(Y);if(!l(b))break;++Y;a+=String.fromCharCode(b);92===b&&(a=a.substr(0,a.length-1),117!==fa.charCodeAt(Y)&&L(),++Y,(b=p("u"))&&"\\"!==b&&l(b.charCodeAt(0))||L(),a+=b)}return a}function r(){var b=Y,a=fa.charCodeAt(Y),c,d=fa[Y];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Y,ea.tokenize&&(40===a?ea.openParenToken=ea.tokens.length:
123===a&&(ea.openCurlyToken=ea.tokens.length)),{type:ka.Punctuator,value:String.fromCharCode(a),lineNumber:xa,lineStart:ya,start:b,end:Y};default:if(c=fa.charCodeAt(Y+1),61===c)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Y+=2,{type:ka.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(c),lineNumber:xa,lineStart:ya,start:b,end:Y};case 33:case 61:return Y+=2,61===fa.charCodeAt(Y)&&++Y,{type:ka.Punctuator,value:fa.slice(b,Y),lineNumber:xa,
lineStart:ya,start:b,end:Y}}}a=fa.substr(Y,4);if("\x3e\x3e\x3e\x3d"===a)return Y+=4,{type:ka.Punctuator,value:a,lineNumber:xa,lineStart:ya,start:b,end:Y};a=a.substr(0,3);if("\x3e\x3e\x3e"===a||"\x3c\x3c\x3d"===a||"\x3e\x3e\x3d"===a)return Y+=3,{type:ka.Punctuator,value:a,lineNumber:xa,lineStart:ya,start:b,end:Y};a=a.substr(0,2);if(d===a[1]&&0<="+-\x3c\x3e\x26|".indexOf(d)||"\x3d\x3e"===a)return Y+=2,{type:ka.Punctuator,value:a,lineNumber:xa,lineStart:ya,start:b,end:Y};if(0<="\x3c\x3e\x3d!+-*%\x26|^/".indexOf(d))return++Y,
{type:ka.Punctuator,value:d,lineNumber:xa,lineStart:ya,start:b,end:Y};L()}function w(){var b,c,d;d=fa[Y];a(m(d.charCodeAt(0))||"."===d,"Numeric literal must start with a decimal digit or a decimal point");c=Y;b="";if("."!==d){b=fa[Y++];d=fa[Y];if("0"===b){if("x"===d||"X"===d){++Y;for(b="";Y<Aa&&k(fa[Y]);)b+=fa[Y++];0===b.length&&L();g(fa.charCodeAt(Y))&&L();return{type:ka.NumericLiteral,value:parseInt("0x"+b,16),lineNumber:xa,lineStart:ya,start:c,end:Y}}if("b"===d||"B"===d){++Y;for(d="";Y<Aa;){b=
fa[Y];if("0"!==b&&"1"!==b)break;d+=fa[Y++]}0===d.length&&L();Y<Aa&&(b=fa.charCodeAt(Y),(g(b)||m(b))&&L());return{type:ka.NumericLiteral,value:parseInt(d,2),lineNumber:xa,lineStart:ya,start:c,end:Y}}if("o"===d||"O"===d){h(d)?(d=!0,b="0"+fa[Y++]):(d=!1,++Y,b="");for(;Y<Aa&&h(fa[Y]);)b+=fa[Y++];d||0!==b.length||L();(g(fa.charCodeAt(Y))||m(fa.charCodeAt(Y)))&&L();return{type:ka.NumericLiteral,value:parseInt(b,8),octal:d,lineNumber:xa,lineStart:ya,start:c,end:Y}}}for(;m(fa.charCodeAt(Y));)b+=fa[Y++];d=
fa[Y]}if("."===d){for(b+=fa[Y++];m(fa.charCodeAt(Y));)b+=fa[Y++];d=fa[Y]}if("e"===d||"E"===d){b+=fa[Y++];d=fa[Y];if("+"===d||"-"===d)b+=fa[Y++];if(m(fa.charCodeAt(Y)))for(;m(fa.charCodeAt(Y));)b+=fa[Y++];else L()}g(fa.charCodeAt(Y))&&L();return{type:ka.NumericLiteral,value:parseFloat(b),lineNumber:xa,lineStart:ya,start:c,end:Y}}function u(){ma=null;e();I("Regular Expression language structures not supported")}function v(){e();u()}function y(){var b;b=ea.tokens[ea.tokens.length-1];if(!b)return v();
if("Punctuator"===b.type){if("]"===b.value)return r();if(")"===b.value)return b=ea.tokens[ea.openParenToken-1],!b||"Keyword"!==b.type||"if"!==b.value.toLowerCase()&&"while"!==b.value.toLowerCase()&&"for"!==b.value.toLowerCase()&&"with"!==b.value.toLowerCase()?r():v();if("}"===b.value){if(ea.tokens[ea.openCurlyToken-3]&&"Keyword"===ea.tokens[ea.openCurlyToken-3].type){if(b=ea.tokens[ea.openCurlyToken-4],!b)return r()}else if(ea.tokens[ea.openCurlyToken-4]&&"Keyword"===ea.tokens[ea.openCurlyToken-4].type){if(b=
ea.tokens[ea.openCurlyToken-5],!b)return v()}else return r();if(0<=La.indexOf(b.value))return r()}return v()}return"Keyword"===b.type&&"this"!==b.value?v():r()}function t(){var b;e();if(Y>=Aa)return{type:ka.EOF,lineNumber:xa,lineStart:ya,start:Y,end:Y};b=fa.charCodeAt(Y);if(g(b)){var c;b=Y;if(92===fa.charCodeAt(Y))c=q();else a:{var u;for(c=Y++;Y<Aa;){u=fa.charCodeAt(Y);if(92===u){Y=c;c=q();break a}if(l(u))++Y;else break}c=fa.slice(c,Y)}return{type:1===c.length?ka.Identifier:f(c)?ka.Keyword:"null"===
c.toLowerCase()?ka.NullLiteral:"true"===c.toLowerCase()||"false"===c.toLowerCase()?ka.BooleanLiteral:ka.Identifier,value:c,lineNumber:xa,lineStart:ya,start:b,end:Y}}if(40===b||41===b||59===b)return r();if(39===b||34===b){var t="",v,x,n;u=!1;var z,A;z=xa;A=ya;b=fa[Y];a("'"===b||'"'===b,"String literal must starts with a quote");c=Y;for(++Y;Y<Aa;)if(v=fa[Y++],v===b){b="";break}else if("\\"===v)if((v=fa[Y++])&&d(v.charCodeAt(0)))++xa,"\r"===v&&"\n"===fa[Y]&&++Y,ya=Y;else switch(v){case "u":case "x":if("{"===
fa[Y]){++Y;x=v=void 0;v=fa[Y];x=0;for("}"===v&&L();Y<Aa;){v=fa[Y++];if(!k(v))break;x=16*x+"0123456789abcdef".indexOf(v.toLowerCase())}(1114111<x||"}"!==v)&&L();v=65535>=x?String.fromCharCode(x):String.fromCharCode((x-65536>>10)+55296,(x-65536&1023)+56320);t+=v}else n=Y,(x=p(v))?t+=x:(Y=n,t+=v);break;case "n":t+="\n";break;case "r":t+="\r";break;case "t":t+="\t";break;case "b":t+="\b";break;case "f":t+="\f";break;case "v":t+="\x0B";break;default:h(v)?(x="01234567".indexOf(v),0!==x&&(u=!0),Y<Aa&&h(fa[Y])&&
(u=!0,x=8*x+"01234567".indexOf(fa[Y++]),0<="0123".indexOf(v)&&Y<Aa&&h(fa[Y])&&(x=8*x+"01234567".indexOf(fa[Y++]))),t+=String.fromCharCode(x)):t+=v}else if(d(v.charCodeAt(0)))break;else t+=v;""!==b&&L();return{type:ka.StringLiteral,value:t,octal:u,startLineNumber:z,startLineStart:A,lineNumber:xa,lineStart:ya,start:c,end:Y}}return 46===b?m(fa.charCodeAt(Y+1))?w():r():m(b)?w():ea.tokenize&&47===b?y():r()}function x(){var b,a,c;e();b={start:{line:xa,column:Y-ya}};a=t();b.end={line:xa,column:Y-ya};a.type!==
ka.EOF&&(c=fa.slice(a.start,a.end),b={type:Da[a.type],value:c,range:[a.start,a.end],loc:b},a.regex&&(b.regex={pattern:a.regex.pattern,flags:a.regex.flags}),ea.tokens.push(b));return a}function z(){var b;b=ma;Y=b.end;xa=b.lineNumber;ya=b.lineStart;ma="undefined"!==typeof ea.tokens?x():t();Y=b.end;xa=b.lineNumber;ya=b.lineStart;return b}function A(){var b,a,c;b=Y;a=xa;c=ya;ma="undefined"!==typeof ea.tokens?x():t();Y=b;xa=a;ya=c}function E(){this.line=xa;this.column=Y-ya}function B(){this.start=new E;
this.end=null}function G(b){this.start=b.type===ka.StringLiteral?{line:b.startLineNumber,column:b.start-b.startLineStart}:{line:b.lineNumber,column:b.start-b.lineStart};this.end=null}function F(){Y=ma.start;ma.type===ka.StringLiteral?(xa=ma.startLineNumber,ya=ma.startLineStart):(xa=ma.lineNumber,ya=ma.lineStart);ea.range&&(this.range=[Y,0]);ea.loc&&(this.loc=new B)}function K(b){ea.range&&(this.range=[b.start,0]);ea.loc&&(this.loc=new G(b))}function H(){var b,a,c,d;b=Y;a=xa;c=ya;e();d=xa!==a;Y=b;
xa=a;ya=c;return d}function N(b,a,c){var d=Error("Line "+b+": "+c);d.index=a;d.lineNumber=b;d.column=a-ya+1;d.description=c;return d}function I(b){var c,d;c=Array.prototype.slice.call(arguments,1);d=b.replace(/%(\d)/g,function(b,d){a(d<c.length,"Message reference must be in range");return c[d]});throw N(xa,Y,d);}function J(b){var c,d;c=Array.prototype.slice.call(arguments,1);d=b.replace(/%(\d)/g,function(b,d){a(d<c.length,"Message reference must be in range");return c[d]});d=N(xa,Y,d);if(ea.errors)ea.errors.push(d);
else throw d;}function M(b,a){var c=za.UnexpectedToken;b&&(c=a?a:b.type===ka.EOF?za.UnexpectedEOS:b.type===ka.Identifier?za.UnexpectedIdentifier:b.type===ka.NumericLiteral?za.UnexpectedNumber:b.type===ka.StringLiteral?za.UnexpectedString:za.UnexpectedToken);c=c.replace("%0",b?b.value:"ILLEGAL");return b&&"number"===typeof b.lineNumber?N(b.lineNumber,b.start,c):N(xa,Y,c)}function L(b,a){throw M(b,a);}function R(b,a){b=M(b,a);if(ea.errors)ea.errors.push(b);else throw b;}function O(b){var a=z();a.type===
ka.Punctuator&&a.value===b||L(a)}function T(){var b;ea.errors?(b=ma,b.type===ka.Punctuator&&","===b.value?z():b.type===ka.Punctuator&&";"===b.value?(z(),R(b)):R(b,za.UnexpectedToken)):O(",")}function U(b){var a=z();a.type===ka.Keyword&&a.value.toLowerCase()===b.toLowerCase()||L(a)}function P(b){return ma.type===ka.Punctuator&&ma.value===b}function V(b){return ma.type===ka.Keyword&&ma.value.toLowerCase()===b.toLowerCase()}function W(){var b;59===fa.charCodeAt(Y)||P(";")?z():(b=xa,e(),xa===b&&(ma.type===
ka.EOF||P("}")||L(ma)))}function Q(b){return b.type===ta.Identifier||b.type===ta.MemberExpression}function Z(b,a){var c,d=new F;a=Ba;c=S();Ba=a;return d.finishFunctionExpression(null,b,[],c)}function X(){var b,a;b=Ba;Ba=!0;a=Ea();a=Z(a.params);Ba=b;return a}function aa(){var b,a=new F;b=z();return b.type===ka.StringLiteral||b.type===ka.NumericLiteral?(Ba&&b.octal&&R(b,za.StrictOctalLiteral),a.finishLiteral(b)):a.finishIdentifier(b.value)}function da(){var b,a,c,d=new F;b=ma;if(b.type===ka.Identifier)return a=
aa(),"get"!==b.value||P(":")||P("(")?"set"!==b.value||P(":")||P("(")?P(":")?(z(),b=C(),d.finishProperty("init",a,b,!1,!1)):P("(")?(b=X(),d.finishProperty("init",a,b,!0,!1)):d.finishProperty("init",a,a,!1,!0):(a=aa(),O("("),b=ma,b.type!==ka.Identifier?(O(")"),R(b),b=Z([])):(c=[wa()],O(")"),b=Z(c,b)),d.finishProperty("set",a,b,!1,!1)):(a=aa(),O("("),O(")"),b=Z([]),d.finishProperty("get",a,b,!1,!1));if(b.type===ka.EOF||b.type===ka.Punctuator)L(b);else{a=aa();if(P(":"))return z(),b=C(),d.finishProperty("init",
a,b,!1,!1);if(P("("))return b=X(),d.finishProperty("init",a,b,!0,!1);L(z())}}function ga(b){var a=[],c,d,e={},f=String,g=new F;for(!0!==b&&O("{");!P("}");)b=da(),c=b.key.type===ta.Identifier?b.key.name:f(b.key.value),d="init"===b.kind?Ja.Data:"get"===b.kind?Ja.Get:Ja.Set,c="$"+c,Object.prototype.hasOwnProperty.call(e,c)?(e[c]===Ja.Data?Ba&&d===Ja.Data?J(za.StrictDuplicateProperty):d!==Ja.Data&&J(za.AccessorDataProperty):d===Ja.Data?J(za.AccessorDataProperty):e[c]&d&&J(za.AccessorGetSet),e[c]|=d):
e[c]=d,a.push(b),P("}")||T();O("}");return g.finishObjectExpression(a)}function ca(){var b,a,c,d;if(P("("))return O("("),P(")")?(z(),a=Ia.ArrowParameterPlaceHolder):(++sa.parenthesisCount,a=ua(),O(")")),a;if(P("[")){a=[];var e=new F;for(O("[");!P("]");)P(",")?(z(),a.push(null)):(a.push(C()),P("]")||O(","));z();return e.finishArrayExpression(a)}if(P("{"))return ga();b=ma.type;d=new F;if(b===ka.Identifier)c=d.finishIdentifier(z().value);else if(b===ka.StringLiteral||b===ka.NumericLiteral)Ba&&ma.octal&&
R(ma,za.StrictOctalLiteral),c=d.finishLiteral(z());else if(b===ka.Keyword){if(V("function")){d=null;var f;c=[];var g=[],l,h=new F;U("function");P("(")||(d=wa());f=Ea(a);c=f.params;g=f.defaults;b=f.stricted;a=f.firstRestricted;f.message&&(e=f.message);l=Ba;f=S();Ba&&a&&L(a,e);Ba&&b&&R(b,e);Ba=l;return h.finishFunctionExpression(d,c,g,f)}V("this")?(z(),c=d.finishThisExpression()):L(z())}else b===ka.BooleanLiteral?(a=z(),a.value="true"===a.value.toLowerCase(),c=d.finishLiteral(a)):b===ka.NullLiteral?
(a=z(),a.value=null,c=d.finishLiteral(a)):P("/")||P("/\x3d")?(c="undefined"!==typeof ea.tokens?d.finishLiteral(v()):d.finishLiteral(u()),A()):L(z());return c}function ia(){var b=[];O("(");if(!P(")"))for(;Y<Aa;){b.push(C());if(P(")"))break;T()}O(")");return b}function ba(){O(".");var b,a=new F;b=z();b.type===ka.Identifier||b.type===ka.Keyword||b.type===ka.BooleanLiteral||b.type===ka.NullLiteral||L(b);return a.finishIdentifier(b.value)}function oa(){var b;O("[");b=ua();O("]");return b}function ha(){var b,
c,d=new F;U("new");var e;a(sa.allowIn,"callee of new expression always allow in keyword.");e=ma;for(b=V("new")?ha():ca();;)if(P("["))c=oa(),b=(new K(e)).finishMemberExpression("[",b,c);else if(P("."))c=ba(),b=(new K(e)).finishMemberExpression(".",b,c);else break;c=P("(")?ia():[];return d.finishNewExpression(b,c)}function la(){var b,a,c=ma,d,e=sa.allowIn;a=ma;sa.allowIn=!0;for(b=V("new")?ha():ca();;)if(P("."))d=ba(),b=(new K(a)).finishMemberExpression(".",b,d);else if(P("("))d=ia(),b=(new K(a)).finishCallExpression(b,
d);else if(P("["))d=oa(),b=(new K(a)).finishMemberExpression("[",b,d);else break;sa.allowIn=e;ma.type!==ka.Punctuator||!P("++")&&!P("--")||H()||(Q(b)||J(za.InvalidLHSInAssignment),a=z(),b=(new K(c)).finishPostfixExpression(a.value,b));return b}function ra(){var b,a,c;ma.type!==ka.Punctuator&&ma.type!==ka.Keyword?a=la():P("++")||P("--")?(c=ma,b=z(),a=ra(),Q(a)||J(za.InvalidLHSInAssignment),a=(new K(c)).finishUnaryExpression(b.value,a)):P("+")||P("-")||P("~")||P("!")?(c=ma,b=z(),a=ra(),a=(new K(c)).finishUnaryExpression(b.value,
a)):V("delete")||V("void")||V("typeof")?(c=ma,b=z(),a=ra(),a=(new K(c)).finishUnaryExpression(b.value,a),Ba&&"delete"===a.operator&&a.argument.type===ta.Identifier&&J(za.StrictDelete)):a=la();return a}function va(b,a){var c=0;if(b.type!==ka.Punctuator&&b.type!==ka.Keyword)return 0;switch(b.value){case "||":c=1;break;case "\x26\x26":c=2;break;case "|":c=3;break;case "^":c=4;break;case "\x26":c=5;break;case "\x3d\x3d":case "!\x3d":case "\x3d\x3d\x3d":case "!\x3d\x3d":c=6;break;case "\x3c":case "\x3e":case "\x3c\x3d":case "\x3e\x3d":case "instanceof":c=
7;break;case "in":c=a?7:0;break;case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":c=8;break;case "+":case "-":c=9;break;case "*":case "/":case "%":c=11}return c}function ja(){var b,a,c,d,e,f;b=ma;a=ra();if(a===Ia.ArrowParameterPlaceHolder)return a;c=ma;d=va(c,sa.allowIn);if(0===d)return a;c.prec=d;z();b=[b,ma];f=ra();for(e=[a,c,f];0<(d=va(ma,sa.allowIn));){for(;2<e.length&&d<=e[e.length-2].prec;)f=e.pop(),c=e.pop().value,a=e.pop(),b.pop(),a=(new K(b[b.length-1])).finishBinaryExpression(c,a,f),e.push(a);
c=z();c.prec=d;e.push(c);b.push(ma);a=ra();e.push(a)}d=e.length-1;a=e[d];for(b.pop();1<d;)a=(new K(b.pop())).finishBinaryExpression(e[d-1].value,e[d-2],a),d-=2;return a}function pa(b){var a,c,d,e,f,g,l;e=[];f=[];g=0;l={paramSet:{}};a=0;for(c=b.length;a<c;a+=1)if(d=b[a],d.type===ta.Identifier)e.push(d),f.push(null),Ca(l,d,d.name);else if(d.type===ta.AssignmentExpression)e.push(d.left),f.push(d.right),++g,Ca(l,d.left,d.left.name);else return null;l.message===za.StrictParamDupe&&(b=Ba?l.stricted:l.firstRestricted,
L(b,l.message));0===g&&(f=[]);return{params:e,defaults:f,rest:null,stricted:l.stricted,firstRestricted:l.firstRestricted,message:l.message}}function C(){var b,a,c,d,e;b=sa.parenthesisCount;a=e=ma;var f,g;g=ma;c=ja();c!==Ia.ArrowParameterPlaceHolder&&P("?")&&(z(),f=sa.allowIn,sa.allowIn=!0,a=C(),sa.allowIn=f,O(":"),f=C(),c=(new K(g)).finishConditionalExpression(c,a,f));if(c===Ia.ArrowParameterPlaceHolder||P("\x3d\x3e"))if(sa.parenthesisCount===b||sa.parenthesisCount===b+1)if(c.type===ta.Identifier?
d=pa([c]):c.type===ta.AssignmentExpression?d=pa([c]):c.type===ta.SequenceExpression?d=pa(c.expressions):c===Ia.ArrowParameterPlaceHolder&&(d=pa([])),d)return b=d,e=new K(e),O("\x3d\x3e"),d=Ba,c=P("{")?S():C(),Ba&&b.firstRestricted&&L(b.firstRestricted,b.message),Ba&&b.stricted&&R(b.stricted,b.message),Ba=d,e.finishArrowFunctionExpression(b.params,b.defaults,c,c.type!==ta.BlockStatement);ma.type!==ka.Punctuator?b=!1:(b=ma.value,b="\x3d"===b||"*\x3d"===b||"/\x3d"===b||"%\x3d"===b||"+\x3d"===b||"-\x3d"===
b||"\x3c\x3c\x3d"===b||"\x3e\x3e\x3d"===b||"\x3e\x3e\x3e\x3d"===b||"\x26\x3d"===b||"^\x3d"===b||"|\x3d"===b);b&&(Q(c)||J(za.InvalidLHSInAssignment),a=z(),b=C(),c=(new K(e)).finishAssignmentExpression(a.value,c,b));return c}function ua(){var b,a=ma;b=C();if(P(",")){for(b=[b];Y<Aa&&P(",");)z(),b.push(C());b=(new K(a)).finishSequenceExpression(b)}return b}function wa(){var b,a=new F;b=z();b.type!==ka.Identifier&&L(b);return a.finishIdentifier(b.value)}function D(b){var a=null,c,d=new F;c=wa();"const"===
b?(O("\x3d"),a=C()):P("\x3d")&&(z(),a=C());return d.finishVariableDeclarator(c,a)}function qa(b){var a=[];do{a.push(D(b));if(!P(","))break;z()}while(Y<Aa);return a}function na(b){var a=ma.type,c,d;a===ka.EOF&&L(ma);if(a===ka.Punctuator&&"{"===ma.value){if(b){O("{");var e=ma;b=Y;c=xa;d=ya;z();a=P(":");ma=e;Y=b;xa=c;ya=d;if((ma.type===ka.Identifier||ma.type===ka.StringLiteral)&&a)return ga(!0);b=new F;for(c=[];Y<Aa&&!P("}");){d=Ha();if("undefined"===typeof d)break;c.push(d)}O("}");return b.finishBlockStatement(c)}return ga()}b=
new F;if(a===ka.Punctuator)switch(ma.value){case ";":return b=new F,O(";"),b.finishEmptyStatement();case "(":return c=ua(),W(),b.finishExpressionStatement(c)}else if(a===ka.Keyword)switch(ma.value.toLowerCase()){case "break":return c=null,U("break"),59===fa.charCodeAt(Y)?(z(),sa.inIteration||sa.inSwitch||I(za.IllegalBreak),b=b.finishBreakStatement(null)):H()?(sa.inIteration||sa.inSwitch||I(za.IllegalBreak),b=b.finishBreakStatement(null)):(ma.type===ka.Identifier&&(c=wa(),d="$"+c.name,Object.prototype.hasOwnProperty.call(sa.labelSet,
d)||I(za.UnknownLabel,c.name)),W(),null!==c||sa.inIteration||sa.inSwitch||I(za.IllegalBreak),b=b.finishBreakStatement(c)),b;case "continue":return c=null,U("continue"),59===fa.charCodeAt(Y)?(z(),sa.inIteration||I(za.IllegalContinue),b=b.finishContinueStatement(null)):H()?(sa.inIteration||I(za.IllegalContinue),b=b.finishContinueStatement(null)):(ma.type===ka.Identifier&&(c=wa(),d="$"+c.name,Object.prototype.hasOwnProperty.call(sa.labelSet,d)||I(za.UnknownLabel,c.name)),W(),null!==c||sa.inIteration||
I(za.IllegalContinue),b=b.finishContinueStatement(c)),b;case "for":var f,l,h;l=sa.allowIn;f=a=e=null;U("for");O("(");if(P(";"))z();else{if(V("var")){sa.allowIn=!1;var p=new F;f=z();h=qa();f=p.finishVariableDeclaration(h,f.value);sa.allowIn=l;1===f.declarations.length&&V("in")&&(z(),c=f,d=ua(),f=null)}else sa.allowIn=!1,f=ua(),sa.allowIn=l,V("in")&&(Q(f)||J(za.InvalidLHSInForIn),z(),c=f,d=ua(),f=null);"undefined"===typeof c&&O(";")}"undefined"===typeof c&&(P(";")||(a=ua()),O(";"),P(")")||(e=ua()));
O(")");h=sa.inIteration;sa.inIteration=!0;l=na(!0);sa.inIteration=h;return"undefined"===typeof c?b.finishForStatement(f,a,e,l):b.finishForInStatement(c,d,l);case "function":return Fa(b);case "if":return U("if"),O("("),c=ua(),O(")"),d=na(!0),V("else")?(z(),a=na(!0)):a=null,b.finishIfStatement(c,d,a);case "return":return c=null,U("return"),sa.inFunctionBody||J(za.IllegalReturn),32===fa.charCodeAt(Y)&&g(fa.charCodeAt(Y+1))?(c=ua(),W(),b=b.finishReturnStatement(c)):H()?b=b.finishReturnStatement(null):
(P(";")||P("}")||ma.type===ka.EOF||(c=ua()),W(),b=b.finishReturnStatement(c)),b;case "var":return U("var"),c=qa(),W(),b.finishVariableDeclaration(c,"var")}c=ua();if(c.type===ta.Identifier&&P(":"))return z(),a="$"+c.name,Object.prototype.hasOwnProperty.call(sa.labelSet,a)&&I(za.Redeclaration,"Label",c.name),sa.labelSet[a]=!0,d=na(!1),delete sa.labelSet[a],b.finishLabeledStatement(c,d);W();return b.finishExpressionStatement(c)}function S(){var b,a=[],c,d,e,f,g,l=new F;for(O("{");Y<Aa&&ma.type===ka.StringLiteral;){c=
ma;b=Ha();a.push(b);if(b.expression.type!==ta.Literal)break;b=fa.slice(c.start+1,c.end-1);"use strict"===b?(Ba=!0,d&&R(d,za.StrictOctalLiteral)):!d&&c.octal&&(d=c)}c=sa.labelSet;d=sa.inIteration;e=sa.inSwitch;f=sa.inFunctionBody;g=sa.parenthesizedCount;sa.labelSet={};sa.inIteration=!1;sa.inSwitch=!1;sa.inFunctionBody=!0;for(sa.parenthesizedCount=0;Y<Aa&&!P("}");){b=Ha();if("undefined"===typeof b)break;a.push(b)}O("}");sa.labelSet=c;sa.inIteration=d;sa.inSwitch=e;sa.inFunctionBody=f;sa.parenthesizedCount=
g;return l.finishBlockStatement(a)}function Ca(b,a,c){c="$"+c;Ba?Object.prototype.hasOwnProperty.call(b.paramSet,c)&&(b.stricted=a,b.message=za.StrictParamDupe):!b.firstRestricted&&Object.prototype.hasOwnProperty.call(b.paramSet,c)&&(b.firstRestricted=a,b.message=za.StrictParamDupe);b.paramSet[c]=!0}function Ea(b){b={params:[],defaultCount:0,defaults:[],firstRestricted:b};O("(");if(!P(")"))for(b.paramSet={};Y<Aa;){var a=b,c=void 0,d=void 0,e=void 0,c=ma,d=wa();Ca(a,c,c.value);P("\x3d")&&(z(),e=C(),
++a.defaultCount);a.params.push(d);a.defaults.push(e);if(P(")"))break;O(",")}O(")");0===b.defaultCount&&(b.defaults=[]);return{params:b.params,defaults:b.defaults,stricted:b.stricted,firstRestricted:b.firstRestricted,message:b.message}}function Fa(){var b,a=[],c=[],d,e,f,g,l,h=new F;U("function");b=wa();d=Ea(f);a=d.params;c=d.defaults;e=d.stricted;f=d.firstRestricted;d.message&&(g=d.message);l=Ba;d=S();Ba&&f&&L(f,g);Ba&&e&&R(e,g);Ba=l;return h.finishFunctionDeclaration(b,a,c,d)}function Ha(){if(ma.type===
ka.Keyword)return"function"===ma.value.toLowerCase()?Fa():na(!1);if(ma.type!==ka.EOF)return na(!1)}function Ka(){var b,a,c,d=[];for(b=0;b<ea.tokens.length;++b)a=ea.tokens[b],c={type:a.type,value:a.value},a.regex&&(c.regex={pattern:a.regex.pattern,flags:a.regex.flags}),ea.range&&(c.range=a.range),ea.loc&&(c.loc=a.loc),d.push(c);ea.tokens=d}var ka,Da,La,ta,Ia,Ja,za,Ga,fa,Ba,Y,xa,ya,Aa,ma,sa,ea;ka={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,
RegularExpression:9};Da={};Da[ka.BooleanLiteral]="Boolean";Da[ka.EOF]="\x3cend\x3e";Da[ka.Identifier]="Identifier";Da[ka.Keyword]="Keyword";Da[ka.NullLiteral]="Null";Da[ka.NumericLiteral]="Numeric";Da[ka.Punctuator]="Punctuator";Da[ka.StringLiteral]="String";Da[ka.RegularExpression]="RegularExpression";La="( { [ in typeof instanceof new return case delete throw void \x3d +\x3d -\x3d *\x3d /\x3d %\x3d \x3c\x3c\x3d \x3e\x3e\x3d \x3e\x3e\x3e\x3d \x26\x3d |\x3d ^\x3d , + - * / % ++ -- \x3c\x3c \x3e\x3e \x3e\x3e\x3e \x26 | ^ ! ~ \x26\x26 || ? : \x3d\x3d\x3d \x3d\x3d \x3e\x3d \x3c\x3d \x3c \x3e !\x3d !\x3d\x3d".split(" ");
ta={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",
FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator"};Ia={ArrowParameterPlaceHolder:{type:"ArrowParameterPlaceHolder"}};
Ja={Data:1,Get:2,Set:4};za={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",
MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",
StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",
AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"};Ga={NonAsciiIdentifierStart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0-\u08b2\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/,
NonAsciiIdentifierPart:/[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0-\u08b2\u08e4-\u0963\u0966-\u096f\u0971-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c00-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d01-\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191e\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1ab0-\u1abd\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1cf8\u1cf9\u1d00-\u1df5\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua69d\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\ua9e0-\ua9fe\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe2d\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]/};
K.prototype=F.prototype={processComment:function(){var b,a,c,d=ea.bottomRightStack,e,f,g=d[d.length-1];if(!(this.type===ta.Program&&0<this.body.length)){if(0<ea.trailingComments.length){c=[];for(e=ea.trailingComments.length-1;0<=e;--e)f=ea.trailingComments[e],f.range[0]>=this.range[1]&&(c.unshift(f),ea.trailingComments.splice(e,1));ea.trailingComments=[]}else g&&g.trailingComments&&g.trailingComments[0].range[0]>=this.range[1]&&(c=g.trailingComments,delete g.trailingComments);if(g)for(;g&&g.range[0]>=
this.range[0];)b=g,g=d.pop();if(b)b.leadingComments&&b.leadingComments[b.leadingComments.length-1].range[1]<=this.range[0]&&(this.leadingComments=b.leadingComments,b.leadingComments=void 0);else if(0<ea.leadingComments.length)for(a=[],e=ea.leadingComments.length-1;0<=e;--e)f=ea.leadingComments[e],f.range[1]<=this.range[0]&&(a.unshift(f),ea.leadingComments.splice(e,1));a&&0<a.length&&(this.leadingComments=a);c&&0<c.length&&(this.trailingComments=c);d.push(this)}},finish:function(){ea.range&&(this.range[1]=
Y);ea.loc&&(this.loc.end=new E,ea.source&&(this.loc.source=ea.source));ea.attachComment&&this.processComment()},finishArrayExpression:function(b){this.type=ta.ArrayExpression;this.elements=b;this.finish();return this},finishAssignmentExpression:function(b,a,c){this.type=ta.AssignmentExpression;this.operator=b;this.left=a;this.right=c;this.finish();return this},finishBinaryExpression:function(b,a,c){this.type="||"===b||"\x26\x26"===b?ta.LogicalExpression:ta.BinaryExpression;this.operator=b;this.left=
a;this.right=c;this.finish();return this},finishBlockStatement:function(b){this.type=ta.BlockStatement;this.body=b;this.finish();return this},finishBreakStatement:function(b){this.type=ta.BreakStatement;this.label=b;this.finish();return this},finishCallExpression:function(b,a){this.type=ta.CallExpression;this.callee=b;this.arguments=a;this.finish();return this},finishConditionalExpression:function(b,a,c){this.type=ta.ConditionalExpression;this.test=b;this.consequent=a;this.alternate=c;this.finish();
return this},finishContinueStatement:function(b){this.type=ta.ContinueStatement;this.label=b;this.finish();return this},finishEmptyStatement:function(){this.type=ta.EmptyStatement;this.finish();return this},finishExpressionStatement:function(b){this.type=ta.ExpressionStatement;this.expression=b;this.finish();return this},finishForStatement:function(b,a,c,d){this.type=ta.ForStatement;this.init=b;this.test=a;this.update=c;this.body=d;this.finish();return this},finishForInStatement:function(b,a,c){this.type=
ta.ForInStatement;this.left=b;this.right=a;this.body=c;this.each=!1;this.finish();return this},finishFunctionDeclaration:function(b,a,c,d){this.type=ta.FunctionDeclaration;this.id=b;this.params=a;this.defaults=c;this.body=d;this.rest=null;this.expression=this.generator=!1;this.finish();return this},finishFunctionExpression:function(b,a,c,d){this.type=ta.FunctionExpression;this.id=b;this.params=a;this.defaults=c;this.body=d;this.rest=null;this.expression=this.generator=!1;this.finish();return this},
finishIdentifier:function(b){this.type=ta.Identifier;this.name=b;this.finish();return this},finishIfStatement:function(b,a,c){this.type=ta.IfStatement;this.test=b;this.consequent=a;this.alternate=c;this.finish();return this},finishLiteral:function(b){this.type=ta.Literal;this.value=b.value;this.raw=fa.slice(b.start,b.end);b.regex&&(this.regex=b.regex);this.finish();return this},finishMemberExpression:function(b,a,c){this.type=ta.MemberExpression;this.computed="["===b;this.object=a;this.property=c;
this.finish();return this},finishObjectExpression:function(b){this.type=ta.ObjectExpression;this.properties=b;this.finish();return this},finishPostfixExpression:function(b,a){this.type=ta.UpdateExpression;this.operator=b;this.argument=a;this.prefix=!1;this.finish();return this},finishProgram:function(b){this.type=ta.Program;this.body=b;this.finish();return this},finishProperty:function(b,a,c,d,e){this.type=ta.Property;this.key=a;this.value=c;this.kind=b;this.method=d;this.shorthand=e;this.finish();
return this},finishReturnStatement:function(b){this.type=ta.ReturnStatement;this.argument=b;this.finish();return this},finishUnaryExpression:function(b,a){this.type="++"===b||"--"===b?ta.UpdateExpression:ta.UnaryExpression;this.operator=b;this.argument=a;this.prefix=!0;this.finish();return this},finishVariableDeclaration:function(b,a){this.type=ta.VariableDeclaration;this.declarations=b;this.kind=a;this.finish();return this},finishVariableDeclarator:function(b,a){this.type=ta.VariableDeclarator;this.id=
b;this.init=a;this.finish();return this}};n.version="2.0.0-dev";n.tokenize=function(b,a){var c,d;c=String;"string"===typeof b||b instanceof String||(b=c(b));fa=b;Y=0;xa=0<fa.length?1:0;ya=0;Aa=fa.length;ma=null;sa={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};ea={};a=a||{};a.tokens=!0;ea.tokens=[];ea.tokenize=!0;ea.openParenToken=-1;ea.openCurlyToken=-1;ea.range="boolean"===typeof a.range&&a.range;ea.loc="boolean"===typeof a.loc&&a.loc;"boolean"===typeof a.comment&&
a.comment&&(ea.comments=[]);"boolean"===typeof a.tolerant&&a.tolerant&&(ea.errors=[]);try{A();if(ma.type===ka.EOF)return ea.tokens;for(z();ma.type!==ka.EOF;)try{z()}catch(Ma){if(ea.errors){ea.errors.push(Ma);break}else throw Ma;}Ka();d=ea.tokens;"undefined"!==typeof ea.comments&&(d.comments=ea.comments);"undefined"!==typeof ea.errors&&(d.errors=ea.errors)}catch(Ma){throw Ma;}finally{ea={}}return d};n.parse=function(b,a){var c,d;d=String;"string"===typeof b||b instanceof String||(b=d(b));fa=b;Y=0;
xa=0<fa.length?1:0;ya=0;Aa=fa.length;ma=null;sa={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1};ea={};"undefined"!==typeof a&&(ea.range="boolean"===typeof a.range&&a.range,ea.loc="boolean"===typeof a.loc&&a.loc,ea.attachComment="boolean"===typeof a.attachComment&&a.attachComment,ea.loc&&null!==a.source&&void 0!==a.source&&(ea.source=d(a.source)),"boolean"===typeof a.tokens&&a.tokens&&(ea.tokens=[]),"boolean"===typeof a.comment&&a.comment&&
(ea.comments=[]),"boolean"===typeof a.tolerant&&a.tolerant&&(ea.errors=[]),ea.attachComment&&(ea.range=!0,ea.comments=[],ea.bottomRightStack=[],ea.trailingComments=[],ea.leadingComments=[]));try{var f;e();A();f=new F;Ba=!1;var g;b=[];for(var l,h,p;Y<Aa;){l=ma;if(l.type!==ka.StringLiteral)break;g=Ha();b.push(g);if(g.expression.type!==ta.Literal)break;h=fa.slice(l.start+1,l.end-1);"use strict"===h?(Ba=!0,p&&R(p,za.StrictOctalLiteral)):!p&&l.octal&&(p=l)}for(;Y<Aa;){g=Ha();if("undefined"===typeof g)break;
b.push(g)}c=f.finishProgram(b);"undefined"!==typeof ea.comments&&(c.comments=ea.comments);"undefined"!==typeof ea.tokens&&(Ka(),c.tokens=ea.tokens);"undefined"!==typeof ea.errors&&(c.errors=ea.errors)}catch(Na){throw Na;}finally{ea={}}return c};n.Syntax=function(){var b,a={};"function"===typeof Object.create&&(a=Object.create(null));for(b in ta)ta.hasOwnProperty(b)&&(a[b]=ta[b]);"function"===typeof Object.freeze&&Object.freeze(a);return a}()})},"esri/intl/moment":function(){define("require exports ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/iteratorUtils ./locale @dojo/framework/shim/Promise".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g=h.SetFromValues("ar ar-dz ar-kw ar-ly ar-ma ar-sa ar-tn bs ca cs da de de-at de-ch el en-au en-ca en-gb en-ie en-il en-nz es es-do es-us et fi fr fr-ca fr-ch he hi hr hu id it it-ch ja ko lt lv nb nl nl-be pl pt pt-br ro ru sl sr sr-cyrl sv th tr uk vi zh-cn zh-hk zh-tw".split(" "));a.loadMoment=function(a){void 0===a&&(a=d.getLocale());return m(this,void 0,void 0,function(){var d,c,b;return k(this,function(e){switch(e.label){case 0:return[4,
new Promise(function(b,a){n(["moment/moment"],b,a)})];case 1:return d=e.sent(),c=g.has(a),c||(b=a.split("-"),1<b.length&&g.has(b[0])&&(a=b[0],c=!0)),c?[4,new Promise(function(b,c){n(["moment/locale/"+a],b,c)})]:[3,3];case 2:return e.sent(),[3,4];case 3:a="en",e.label=4;case 4:return a!==d.locale()&&d.locale(a),[2,d]}})})}})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(n,
a,m,k){return function(a){function d(d){d=a.call(this,d)||this;d.centerPointInElevationSR=null;return d}m(d,a);return d}(k)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(n,a,m,k){return function(){function a(a){a?this.set(a):this.setDefaults()}Object.defineProperty(a.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});a.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=m.getMetersPerUnit(a)};a.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.setUnit("meters")};a.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||
0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.setUnit(a.unit)};a.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};a.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};a.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};a.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&
this.setOffsetElevationInfoUnits(a.offset)};a.prototype.calculateOffsetRenderUnits=function(a){var d=this._meterUnitOffset,l=this.featureExpressionInfoContext;null!=l&&(d+=k.execute(l)*this._metersPerElevationInfoUnit);return d/a.unitInMeters+this._renderUnitOffset};return a}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ./Loadable ./symbolComplexity".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t){function x(b,a){b=null!=b?a.attributes[b]:0;return null!=b&&isFinite(b)?b:0}Object.defineProperty(a,"__esModule",{value:!0});var z=new r,A=f.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");n=function(a){function f(b,c,d,e){var f=a.call(this)||this;f.complexity=null;f.logger=A;f._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};f.symbol=b;f.symbolLayer=c;f._context=d;f._symbolLayerOrder=d.layerOrder;f._symbolLayerOrderDelta=
d.layerOrderDelta;f._elevationContext=new r;f._material=null;f.complexity=f.computeComplexity();f._geometryCreationWarningHandle=null;f._updateDrivenProperties(e);f._updateElevationContext();f._logWarning;return f}m(f,a);f.prototype.getCachedSize=function(){return null};f.prototype._logWarning=function(b){A.warn(b)};f.prototype._logGeometryCreationWarnings=function(b,a,c,d){var f=this;if(null==this._geometryCreationWarningHandle){var g=b.geometryData&&b.geometryData.polygons;d+=" geometry failed to be created";
var l=null;b.projectionSuccess?!a.length||1===a.length&&!a[0].length?l=d+" (no "+c+" were defined)":Array.isArray(a)&&Array.isArray(a[0])?a.some(function(b){return 1===b.length})?l=d+" ("+c+" should contain at least 2 vertices)":g&&0===g.length&&"rings"===c&&(l=d+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):l=d+" ("+c+" should be defined as a 2D array)":l=d+" (failed to project geometry to view spatial reference)";l&&(this._geometryCreationWarningHandle=e.schedule(function(){return f._onNextTick()}),
A.warn(l))}};f.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};f.prototype._validateGeometryType=function(b,a,c){if(g.includes(a,b.type))return!0;this.logger.warn("unsupported geometry type for "+c+(" symbol: "+b.type));return!1};f.prototype._validateGeometry=function(b){return"point"!==b.type||c.isFinite(b.x)&&c.isFinite(b.y)?!0:(A.warn("point coordinate is not a valid number, graphic skipped"),!1)};f.prototype._defaultElevationInfoNoZ=function(){return E};f.prototype._defaultElevationInfoZ=
function(){return B};f.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var b=this._context.layer.elevationInfo;b&&this._elevationContext.mixinApi(b);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};f.prototype.getDefaultElevationInfo=function(b){return b.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};f.prototype.getGeometryElevationMode=function(b,a){void 0===a&&(a=this.getDefaultElevationInfo(b));
return this._elevationContext.mode||a.mode};f.prototype.getGraphicElevationContext=function(a){var c=b.expect(a.geometry),d=this.getDefaultElevationInfo(c);z.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:d.unit);z.mode=this.getGeometryElevationMode(c,d);z.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:d.offset);z.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;this._elevationOptions.supportsOnTheGround||
"on-the-ground"!==z.mode||(z.mode="relative-to-ground",z.setOffsetMeters(0),z.featureExpressionInfoContext=w.zeroContext);a=w.createFeature(a,this._context.layer);w.setContextFeature(z.featureExpressionInfoContext,a);return z};f.prototype.prepareSymbolLayerPatch=function(b){};f.prototype.updateGeometry=function(b,a){return!1};f.prototype.onRemoveGraphic=function(b){};f.prototype._getDrapedZ=function(){return-2};f.prototype._updateDrivenProperties=function(b){var a={color:!1,opacity:!1,size:!1};b||
(b=this._context.renderer)&&"visualVariables"in b&&b.visualVariables&&b.visualVariables.forEach(function(b){switch(b.type){case "color":a.color=!0;if(b.stops)for(var c=0;c<b.stops.length;c++){var d=b.stops[c].color;d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(a.opacity=!0)}break;case "opacity":a.opacity=!0;break;case "size":a.size=!0}});this._drivenProperties=a};f.prototype._isPropertyDriven=function(b){return this._drivenProperties[b]};f.prototype._getLayerOpacity=function(){if(this._context.layerView&&
"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var b=this._context.layer.opacity;return null==b?1:b};f.prototype._getCombinedOpacity=function(a,c){void 0===c&&(c=G);var d;d=1*this._getLayerOpacity();if(this._isPropertyDriven("opacity"))return d;b.isSome(a)?d*=a.a:c.hasIntrinsicColor||(d=0);return d};f.prototype._getCombinedOpacityAndColor=function(a,c){void 0===c&&(c=G);c=this._getCombinedOpacity(a,c);if(this._isPropertyDriven("color"))return v.mixinColorAndOpacity(null,
c);a=b.isSome(a)?d.toUnitRGB(a):p.vec3f64.ONES;return v.mixinColorAndOpacity(a,c)};f.prototype._getVertexOpacityAndColor=function(b,a,c){var d=this._isPropertyDriven("color")?b.color:null;b=this._isPropertyDriven("opacity")?b.opacity:null;d=v.mixinColorAndOpacity(d,b);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return a?new a(d):d};f.prototype._getIdHint=function(b){void 0===b&&(b="");return this._context.layer.id+"_symbol"+b};f.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};
f.prototype.updateSymbolLayerOrder=function(b,a){this._symbolLayerOrder=b;this._symbolLayerOrderDelta=a};f.prototype.computeComplexity=function(){return t.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};f.prototype.setDrawOrder=function(b,a,c){this.updateSymbolLayerOrder(b,a);this._material&&(this._material.renderPriority=b,c.add(this._material.id))};f.prototype.destroy=function(){this.abortLoad();this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=
null)};f.prototype.globalPropertyChanged=function(b,a,c){switch(b){case "opacity":return this.layerOpacityChanged(a,c);case "elevationInfo":return b=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(a,c,b)===u.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(a,c);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged(a,c);case "pixelRatio":return this.pixelRatioChanged(a,c);default:return l.neverReachedSilent(b),
!1}};f.prototype.updateGraphics3DGraphicElevationInfo=function(a,c,d){var e=this,f=u.SymbolUpdateType.UPDATE;a.forEach(function(a){var g=c(a);b.isSome(g)?(a=e.getGraphicElevationContext(a.graphic),g.needsElevationUpdates=d(a.mode),g.elevationContext.set(a)):f=u.SymbolUpdateType.RECREATE});return f};f.prototype.applyRendererDiff=function(b,a){return!1};f.prototype.getFastUpdateAttrValues=function(b){if(!this._fastUpdates.enabled)return null;var a=this._fastUpdates.visualVariables,c=a.size?x(a.size.field,
b):0,d=a.color?x(a.color.field,b):0;b=a.opacity?x(a.opacity.field,b):0;return q.vec4f64.fromValues(c,d,b,0)};return f}(y.Loadable);a.Graphics3DSymbolLayer=n;a.getAttributeValue=x;var E={mode:"on-the-ground",offset:0,unit:"meters"},B={mode:"absolute-height",offset:0,unit:"meters"},G={hasIntrinsicColor:!1};a.default=n})},"esri/views/3d/layers/graphics/Loadable":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../../../core/promiseUtils"],
function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._abortController=null;this._loadStatus=0;this.logger=this._loader=null}Object.defineProperty(a.prototype,"loadStatus",{get:function(){return this._loadStatus},enumerable:!0,configurable:!0});a.prototype.load=function(){return k(this,void 0,void 0,function(){var a=this;return m(this,function(d){this._loader||(this._abortController=h.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(function(){a._abortController=
null;a._loadStatus=1},function(d){a._abortController=null;a._loadStatus=2;!h.isAbortError(d)&&a.logger&&d.message&&a.logger.warn(d.message);throw d;}));return[2,this._loader]})})};a.prototype.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};return a}();a.Loadable=n})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(n,a,m,k,h,d,g,l,f){function c(b){for(var a=0,c=0,d=!1,e={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},f=0;f<b.length;f++){var g=b[f];g&&(a+=g.primitivesPerFeature,c+=g.primitivesPerCoordinate,e.bytesPerFeature+=g.memory.bytesPerFeature,e.bytesPerFeatureLabel+=g.memory.bytesPerFeatureLabel,e.bytesPerCoordinate+=g.memory.bytesPerCoordinate,e.draped.bytesPerFeature+=g.memory.bytesPerFeature,e.draped.bytesPerFeatureLabel+=
g.memory.bytesPerFeatureLabel,e.draped.bytesPerCoordinate+=g.memory.bytesPerCoordinate,d=d||g.estimated)}return{primitivesPerFeature:a,primitivesPerCoordinate:c,estimated:d,memory:e}}function b(b,a){var c=e(b,a);switch(a.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,estimated:!1,memory:c};case "fill":return"mesh-3d"===b.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!1,memory:c}:h.isSome(a.outline)&&0<a.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,
estimated:!1,memory:c}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:c};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:c};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,estimated:!1,memory:c};case "object":return a.resource&&a.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,estimated:!0,memory:c}:m({},p(a.resource&&a.resource.primitive||d.defaultPrimitive),{memory:c});case "path":var f=b=0;switch(a.profile){case "circle":b=
10;break;case "quad":b=4;break;default:k.neverReached(a.profile);return}switch(a.join){case "round":f=3;break;case "miter":case "bevel":f=1;break;default:k.neverReached(a.join);return}var g=2*b,f=b*f*2,l=-2*f-g;switch(a.cap){case "none":break;case "butt":case "square":l+=2*(b-1);break;case "round":l+=2*(4*b+b);break;default:k.neverReached(a.cap);return}return{primitivesPerFeature:l,primitivesPerCoordinate:f+g,estimated:!1,memory:c};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,
estimated:!1,memory:c};default:k.neverReached(a)}}function e(b,c){b="point-3d"===b.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?a.memoryEstimators.EXTRUDE_EDGES:a.memoryEstimators.EXTRUDE;case "fill":return h.isSome(c.outline)&&0<c.outline.size?a.memoryEstimators.FILL_OUTLINE:a.memoryEstimators.FILL;case "water":return a.memoryEstimators.FILL;case "line":return"round"===c.join?a.memoryEstimators.LINE_ROUND:a.memoryEstimators.LINE_MITER;case "path":switch(c.join){case "round":switch(c.profile){case "circle":return a.memoryEstimators.PATH_ROUND_CIRCLE;
case "quad":return a.memoryEstimators.PATH_ROUND_QUAD;default:k.neverReached(c.profile);return}case "miter":case "bevel":switch(c.profile){case "circle":return a.memoryEstimators.PATH_MITER_CIRCLE;case "quad":return a.memoryEstimators.PATH_MITER_QUAD;default:k.neverReached(c.profile);return}default:k.neverReached(c.join);return}case "object":return b?a.memoryEstimators.OBJECT_POINT:a.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return b?a.memoryEstimators.ICON_POINT:a.memoryEstimators.ICON_POLYGON;
default:k.neverReached(c)}}function p(b){var a=q[b];if(a)return a;a=g.primitiveLodResources(b,null,null);a={primitivesPerFeature:f.geometriesFromLodLevelResources(a.levels[0]).reduce(function(b,a){return b+a.data.getIndices(l.VertexAttrConstants.POSITION).length/3},0),primitivesPerCoordinate:0,estimated:!1};return q[b]=a}Object.defineProperty(a,"__esModule",{value:!0});a.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,
bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};a.defaultSymbolComplexity=function(d){if("web-style"===d.type)return a.emptySymbolComplexity;var e=d.symbolLayers.toArray().map(function(a){return b(d,a)});return c(e)};a.totalSymbolComplexities=c;var q={};a.defaultSymbolLayerComplexity=b;a.defaultSymbolLayerMemoryComplexity=e;a.memoryEstimators={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,
bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,
bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},
LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,
bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,
bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g=k.fromValues(-.5,-.5,-.5,.5,.5,.5),l=k.fromValues(-.5,-.5,0,.5,.5,1),f=k.fromValues(-.5,-.5,0,.5,.5,.5);a.isValidPrimitive=function(b){switch(b){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
a.primitiveBoundingBox=function(b){switch(b){case "sphere":case "cube":case "diamond":return g;case "cylinder":case "cone":case "inverted-cone":return l;case "tetrahedron":return f;default:m.neverReached(b)}};a.primitiveGeometryData=function(b){switch(b){case "sphere":return d.createPolySphereGeometry(.5,2,!0);case "cube":return d.createBoxGeometry(1);case "cylinder":return d.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return d.cgToGIS(d.createConeGeometry(1,.5,15,!1));case "inverted-cone":return d.cgToGIS(d.createConeGeometry(1,
.5,15,!0));case "tetrahedron":return d.cgToGIS(d.createTetrahedronGeometry(1));case "diamond":return d.cgToGIS(d.createDiamondGeometry(1));default:m.neverReached(b)}};a.primitiveLodResources=function(b,a,f){var e=function(b,c,e){void 0===e&&(e=!1);return{levels:b.map(function(b,g){var l=c(b.tesselation);e&&d.cgToGIS(l);return{components:[{geometry:new h(l,f+("_lod"+g)),material:a}],faceCount:l.indexCount/3,minScreenSpaceRadius:b.minScreenSpaceRadius}})}};switch(b){case "sphere":return e([{tesselation:0,
minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(b){return d.createPolySphereGeometry(.5,b,!0)});case "cube":return e([{tesselation:0,minScreenSpaceRadius:0}],function(b){return d.createBoxGeometry(1)});case "cone":return e(c,function(b){return d.createConeGeometry(1,.5,b,!1)},!0);case "inverted-cone":return e(c,function(b){return d.createConeGeometry(1,
.5,b,!0)},!0);case "cylinder":return e(c,function(b){return d.createCylinderGeometry(1,.5,b,[0,0,1],[0,0,.5])});case "tetrahedron":return e([{tesselation:0,minScreenSpaceRadius:0}],function(b){return d.createTetrahedronGeometry(1)},!0);case "diamond":return e([{tesselation:0,minScreenSpaceRadius:0}],function(b){return d.createDiamondGeometry(1)},!0);default:m.neverReached(b)}};var c=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},
"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(n,a,m,k,h,d,g,l){return function(){function a(c,b,d){this.singleUse=!1;this._componentAABBs=this._boundingInfo=null;this._id=a.__idGen.gen(b);this._data=c;this._boundingInfo=d}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"data",{get:function(){return this._data},
enumerable:!0,configurable:!0});a.prototype.getIndices=function(a){return this.data.getIndices(a)};Object.defineProperty(a.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});a.prototype.getAttribute=function(a){return this.data.getAttribute(a)};Object.defineProperty(a.prototype,"componentCount",{get:function(){return k.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});a.prototype.invalidateBoundingInfo=
function(){this._componentAABBs=this._boundingInfo=null};a.prototype.getComponentAABB=function(a,b){null==this._componentAABBs&&(this._componentAABBs=this._computeComponentAABBs());for(var c=0;6>c;c++)b[c]=this._componentAABBs[6*a+c];return b};a.prototype._computeComponentAABBs=function(){for(var a=this.componentCount,b=new Float32Array(6*a),d=0;d<a;d++)this._calculateAABB(d,b,6*d);return b};a.prototype._calculateAABB=function(a,b,d){var c=this.data.getIndices(l.VertexAttrConstants.POSITION),e=this.data.getAttribute(l.VertexAttrConstants.POSITION),
f=this.data.componentOffsets,g=f.length?f[a+1]:c.length,h=Infinity,k=Infinity,m=Infinity,t=-Infinity,x=-Infinity,n=-Infinity,A=e.offsetIdx,E=e.strideIdx;for(a=f.length?f[a]:0;a<g;a++)var B=A+E*c[a],f=e.data[B],G=e.data[B+1],B=e.data[B+2],h=Math.min(h,f),k=Math.min(k,G),m=Math.min(m,B),t=Math.max(t,f),x=Math.max(x,G),n=Math.max(n,B);b[d]=h;b[d+1]=k;b[d+2]=m;b[d+3]=t;b[d+4]=x;b[d+5]=n};a.prototype._calculateBoundingInfo=function(){var a=this.data.getIndices(l.VertexAttrConstants.POSITION),b=this.data.getAttribute(l.VertexAttrConstants.POSITION),
d="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(d),f=0;f<d;++f)a[f]=f;f=a.length;g.assert(0===f%d,"Indexing error: "+f.toFixed(0)+" not divisible by "+d.toFixed(0));f=h.generateDefaultIndexArray(f/d);return new m(f,d,a,b)};a.__idGen=new d.IdGen;return a}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),
function(n,a,m,k,h,d){n=function(){function a(g,f,c,b){this.primitiveIndices=g;this._numIndexPerPrimitive=f;this.indices=c;this._position=b;this.center=h.vec3f64.create();d.assert(1<=g.length);d.assert(0===c.length%this._numIndexPerPrimitive);d.assert(c.length>=g.length*this._numIndexPerPrimitive);d.assert(3===this._position.size||4===this._position.size);b=this._position;f=b.data;var e=b.offsetIdx,l=b.strideIdx;b=0;var q=g.length,m=e+l*c[this._numIndexPerPrimitive*g[b]];a.tmpIndices.clear();a.tmpIndices.push(m);
this.bbMin=h.vec3f64.fromValues(f[m],f[m+1],f[m+2]);for(this.bbMax=h.vec3f64.clone(this.bbMin);b<q;++b)for(var w=this._numIndexPerPrimitive*g[b],u=0;u<this._numIndexPerPrimitive;++u){m=e+l*c[w+u];a.tmpIndices.push(m);var v=f[m];this.bbMin[0]=Math.min(v,this.bbMin[0]);this.bbMax[0]=Math.max(v,this.bbMax[0]);v=f[m+1];this.bbMin[1]=Math.min(v,this.bbMin[1]);this.bbMax[1]=Math.max(v,this.bbMax[1]);v=f[m+2];this.bbMin[2]=Math.min(v,this.bbMin[2]);this.bbMax[2]=Math.max(v,this.bbMax[2])}k.vec3.lerp(this.center,
this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);g=this.bsRadius*this.bsRadius;for(b=0;b<a.tmpIndices.length;++b)m=a.tmpIndices.data[b],c=f[m]-this.center[0],e=f[m+1]-this.center[1],m=f[m+2]-this.center[2],l=c*c+e*e+m*m,l<=g||(l=Math.sqrt(l),q=.5*(l-this.bsRadius),this.bsRadius+=q,g=this.bsRadius*this.bsRadius,l=q/l,this.center[0]+=c*l,this.center[1]+=e*l,this.center[2]+=m*l);a.tmpIndices.clear()}a.prototype.getCenter=
function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};a.prototype.getBBMin=function(){return this.bbMin};a.prototype.getBBMax=function(){return this.bbMax};a.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};a.prototype.getIndices=function(){return this.indices};a.prototype.getPosition=function(){return this._position};a.prototype.getChildren=function(){if(this._children)return this._children;if(1<k.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var d=
k.vec3.lerp(h.vec3f64.create(),this.bbMin,this.bbMax,.5),f=this.primitiveIndices.length,c=new Uint8Array(f),b=Array(8),e=0;8>e;++e)b[e]=0;for(var e=this._position,g=e.data,q=e.offsetIdx,m=e.strideIdx,e=0;e<f;++e){for(var w=0,u=this._numIndexPerPrimitive*this.primitiveIndices[e],v=q+m*this.indices[u],y=g[v],t=g[v+1],x=g[v+2],n=1;n<this._numIndexPerPrimitive;++n){var v=q+m*this.indices[u+n],A=g[v],E=g[v+1],v=g[v+2];A<y&&(y=A);E<t&&(t=E);v<x&&(x=v)}y<d[0]&&(w|=1);t<d[1]&&(w|=2);x<d[2]&&(w|=4);c[e]=w;
++b[w]}for(e=d=0;8>e;++e)0<b[e]&&++d;if(2>d)return;d=Array(8);for(e=0;8>e;++e)d[e]=0<b[e]?new Uint32Array(b[e]):void 0;for(e=0;8>e;++e)b[e]=0;for(e=0;e<f;++e)w=c[e],d[w][b[w]++]=this.primitiveIndices[e];this._children=Array(8);for(e=0;8>e;++e)void 0!==d[e]&&(this._children[e]=new a(d[e],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return a}();(n||(n={})).tmpIndices=new m({deallocator:null});return n})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils"],function(n,a,m){function k(a){var d=[];a.components.forEach(function(a){d.push(a.geometry)});return m.unique(d)}Object.defineProperty(a,"__esModule",{value:!0});a.materialsFromLodResources=function(a){var d=[];a.levels.forEach(function(a){a.components.forEach(function(a){d.push(a.material)})});return m.unique(d)};a.texturesFromLodResources=function(a){var d=[];a.levels.forEach(function(a){a.components.forEach(function(a){a.textures&&d.push.apply(d,a.textures)})});
return m.unique(d)};a.geometriesFromLodLevelResources=k;a.geometriesFromLodResources=function(a){var d=[];a.levels.forEach(function(a){a.components.forEach(function(a){d.push(a.geometry)})});return m.unique(d)};a.computeFaceCount=function(a){var d=0;k(a).forEach(function(a){d+=a.data.indexCount/3});return d}})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutPrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){function q(b,a,c){3===c.length?b.setUniform4f(a,c[0],c[1],c[2],1):b.setUniform4fv(a,c)}n=function(a){function d(b,e){e=a.call(this,e)||this;e.params=c.copyParameters(b,w);e._uniqueMaterialIdentifier=d.uniqueMaterialIdentifier(e.params);return e}m(d,a);Object.defineProperty(d.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});d.prototype.dispose=function(){};d.prototype.getGLMaterials=function(){return{color:r,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};d.prototype.intersect=function(b,a,c,d,e,f,g,l){};d.prototype.createBufferWriter=function(){return new y};d.prototype.createRenderer=function(a,c){return new b(a,c,this)};d.prototype.setParameterValues=function(b){c.updateParameters(this.params,b)&&(this._uniqueMaterialIdentifier=d.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};d.prototype.getParameters=function(){return this.params};d.uniqueMaterialIdentifier=
function(b){return JSON.stringify({screenOffset:b.screenOffset||[0,0],centerOffsetUnits:b.centerOffsetUnits||"world"})};return d}(g.Material);var r=function(b){function a(a){a=b.call(this,a)||this;a.isRenderSlot=!0;a.updateParameters();return a}m(a,b);a.prototype.updateParameters=function(){this.params=c.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype.selectProgram=function(){var b=this.params;this.renderProgram=this.programRep.getProgram(e.program,{occlTest:!!b.occlusionTest,
verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!b.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(e.program,{occlTest:!!b.occlusionTest,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!b.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled});
this.renderPipelineState=p.makePipelineState({blending:p.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:p.defaultColorWriteParams});this.depthPipelineState=p.makePipelineState({depthTest:{func:513},depthWrite:p.defaultDepthWriteParams})};a.prototype.beginSlot=function(b){switch(b){case 18:return this.isRenderSlot=!0;case 19:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(a.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},
enumerable:!0,configurable:!0});a.prototype.getProgram=function(){return this.program};a.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};a.prototype.getDrawMode=function(){return 4};a.prototype.bind=function(b,a){var d=a.cameraAboveGround?1:-1,e=this.program,f=this.params;b.bindProgram(e);e.setUniform1f("cameraGroundRelative",d);e.setUniform1f("polygonOffset",f.shaderPolygonOffset);e.setUniform4fv("viewport",a.viewport);e.setUniform1f("perDistancePixelRatio",Math.tan(a.fovY/
2)/(a.viewport[2]/2));e.setUniformMatrix4fv("viewNormal",a.viewInvTransp);e.setUniform1i("hudVisibilityTexture",0);b.bindTexture(a.hudVisibilityTexture,0);q(e,"color",f.color);d=a.pixelRatio||1;e.setUniform1f("pixelRatio",d);e.setUniform2f("screenOffset",f.screenOffset[0]*d,f.screenOffset[1]*d);this.bindBorder(b,a);c.bindVerticalOffset(f.verticalOffset,a,e);this.bindSizing(b,a);c.bindScreenSizePerspective(f.screenSizePerspective,e);this.isRenderSlot?b.setPipelineState(this.renderPipelineState):b.setPipelineState(this.depthPipelineState)};
a.prototype.bindView=function(b,a){b=this.program;var d=this.params;c.bindView(a.origin,a.view,b);c.bindCamPos(a.origin,a.viewInvTransp,b);d.slicePlaneEnabled&&c.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.release=function(b,a){};a.prototype.bindSizing=function(b,a){b=this.program;var c=this.params;b.setUniform2f("pixelToNDC",2/
a.viewport[2],2/a.viewport[3]);b.setUniform1f("lineSize",Math.ceil(c.size)*(a.pixelRatio||1))};a.prototype.bindBorder=function(b,a){b=this.program;var c=this.params;a=a.pixelRatio||1;null!==c.borderColor?(q(b,"borderColor",c.borderColor),b.setUniform1f("borderSize",a)):(b.setUniform4f("borderColor",0,0,0,0),b.setUniform1f("borderSize",0))};return a}(d),w={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,
depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},u=h.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec3f(l.VertexAttrConstants.NORMAL).vec2f(l.VertexAttrConstants.UV0).vec4f(l.VertexAttrConstants.AUXPOS1),v=[k.vec2f32.fromValues(0,0),k.vec2f32.fromValues(1,0),k.vec2f32.fromValues(0,1),k.vec2f32.fromValues(1,0),k.vec2f32.fromValues(1,1),k.vec2f32.fromValues(0,1)],y=function(){function b(){this.vertexBufferLayout=u}b.prototype.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};
b.prototype.elementCount=function(b){return 6*b.indices[l.VertexAttrConstants.POSITION].length};b.prototype.write=function(b,a,c,d){f.writePosition(a.indices[l.VertexAttrConstants.POSITION],a.vertexAttr[l.VertexAttrConstants.POSITION].data,b.transformation,c.position,d,6);f.writeNormal(a.indices[l.VertexAttrConstants.NORMAL],a.vertexAttr[l.VertexAttrConstants.NORMAL].data,b.invTranspTransformation,c.normal,d,6);f.writeBufferVec4(a.indices[l.VertexAttrConstants.AUXPOS1],a.vertexAttr[l.VertexAttrConstants.AUXPOS1].data,
c.auxpos1,d,6);for(b=0;b<v.length;++b)c.uv0.setVec(d+b,v[b])};return b}();return n})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.vec2f32=m})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require","exports"],function(n,a){function m(){return new Float32Array(2)}function k(a,d){var c=new Float32Array(2);c[0]=a;c[1]=d;return c}function h(){return k(1,1)}function d(){return k(1,
0)}function g(){return k(0,1)}Object.defineProperty(a,"__esModule",{value:!0});a.create=m;a.clone=function(a){var d=new Float32Array(2);d[0]=a[0];d[1]=a[1];return d};a.fromValues=k;a.createView=function(a,d){return new Float32Array(a,d,2)};a.zeros=function(){return m()};a.ones=h;a.unitX=d;a.unitY=g;a.ZEROS=m();a.ONES=h();a.UNIT_X=d();a.UNIT_Y=g()})},"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver",
"../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(a){return h.glslifyDefineMap({OCCL_TEST:a.occlTest,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,DEPTH_HUD:a.depthHud,DEPTH_HUD_ALIGN_START:a.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,SLICE:a.slice})};a.program={name:"line-callout",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/lineCallout/lineCallout.vert"),
fragmentShader:d(a)+k.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:m.Default3D}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.getGraphics3DSymbol=function(a){return a instanceof k?a.graphics3DSymbol:a instanceof m?a:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){return function(a){function e(b,c,d){var e=a.call(this)||this;e._symbol=b;e._context=c;e._backgroundLayers=d;e._destroyed=!1;e.symbolLayers=[];e.referenced=0;return e}m(e,a);Object.defineProperty(e.prototype,"symbol",{get:function(){return this._symbol},set:function(b){this._symbol=b;if(this.symbolLayers)for(var a=0;a<b.symbolLayers.length;a++){var c=this.symbolLayers[a];g.isNone(c)||(c.symbol=b,c.symbolLayer=b.symbolLayers.items[a])}},enumerable:!0,configurable:!0});
e.prototype.doLoad=function(a){return h(this,void 0,void 0,function(){var c,e,f,p,q,m,r=this;return k(this,function(u){switch(u.label){case 0:c=this._symbol.symbolLayers;this._backgroundLayers&&(c=this._backgroundLayers.concat(c));for(e=c.length;this.symbolLayers.length<c.length;)this.symbolLayers.push(null);this.symbolLayers.length=c.length;f=this._context.layerOrder;p=function(d){var g=c.getItemAt(d);if(!1===g.enabled)return"continue";q._context.layerOrder=f+(1-(1+d)/e);q._context.layerOrderDelta=
1/e;var h=b.make(q.symbol,g,q._context,g._ignoreDrivers);l.onAbortOrThrow(a,function(){return h.destroy()});q.symbolLayers[d]=h};q=this;for(m=0;m<e;m++)p(m);this._context.layerOrder=f;return[4,d.forEach(this.symbolLayers,function(b,a){return h(r,void 0,void 0,function(){return k(this,function(c){switch(c.label){case 0:if(!g.isSome(b))return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,b.load()];case 2:return c.sent(),[3,4];case 3:return c.sent(),this.symbolLayers[a]=null,[3,4];case 4:return[2]}})})})];
case 1:u.sent();if(this.symbolLayers.length&&!this.symbolLayers.some(function(b){return!!b}))throw Error();return[2]}})})};e.prototype.whenSymbolLayerSize=function(b){return h(this,void 0,void 0,function(){var a;return k(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.load()];case 1:return c.sent(),[3,3];case 2:return c.sent(),[3,3];case 3:return a=this.symbolLayers[b],[2,g.isSome(a)?a.getCachedSize():null]}})})};e.prototype.createGraphics3DGraphic=function(b,a){for(var c=
b.graphic,d=Array(this.symbolLayers.length),e=0;e<this.symbolLayers.length;e++){var l=this.symbolLayers[e];d[e]=g.isSome(l)?l.createGraphics3DGraphic(b):null}return new f(c,a||this,d,b.layer)};Object.defineProperty(e.prototype,"complexity",{get:function(){return p.totalSymbolComplexities(this.symbolLayers.map(function(b){return g.isSome(b)&&b.complexity}))},enumerable:!0,configurable:!0});e.prototype.globalPropertyChanged=function(b,a){for(var d=this.symbolLayers.length,e=function(d){var e=f.symbolLayers[d],
l=function(b){b=b._graphics[d];return b instanceof c?b:null};if(g.isSome(e)&&!e.globalPropertyChanged(b,a,l))return{value:!1}},f=this,l=0;l<d;l++){var h=e(l);if("object"===typeof h)return h.value}return!0};e.prototype.applyRendererDiff=function(b,a){return 1!==this.loadStatus?!1:this.symbolLayers.reduce(function(c,d,e){return c&&(g.isNone(d)||d.applyRendererDiff(b,a))},!0)};e.prototype.prepareSymbolPatch=function(b){if(2!==this.loadStatus&&"partial"===b.diff.type){var a=b.diff.diff;if(a.symbolLayers&&
"partial"===a.symbolLayers.type){var c=a.symbolLayers.diff;this.symbolLayers.forEach(function(a,d){var e;if(!g.isNone(a)){var f=c[d];if(f){var l={diff:f,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};a.prepareSymbolLayerPatch(l);(e=b.symbolStatePatches).push.apply(e,l.symbolLayerStatePatches);l.graphics3DGraphicPatches.length&&b.graphics3DGraphicPatches.push(function(b,a){var c=b._graphics[d];g.isSome(c)&&l.graphics3DGraphicPatches.forEach(function(b){return b(c,a)})})}}})}}};e.prototype.updateGeometry=
function(b,a){for(var c=0;c<this.symbolLayers.length;c++){var d=this.symbolLayers[c];if(!g.isNone(d)){var e=b._graphics[c];if(g.isSome(e)&&!d.updateGeometry(e,a))return!1}}return!0};e.prototype.onRemoveGraphic=function(b){for(var a=0;a<this.symbolLayers.length;a++){var c=this.symbolLayers[a];if(!g.isNone(c)){var d=b._graphics[a];if(g.isSome(d))c.onRemoveGraphic(d)}}};e.prototype.getFastUpdateStatus=function(){var b=0,a=0,c=0;this.symbolLayers.forEach(function(d){g.isNone(d)||(0===d.loadStatus?b++:
d.isFastUpdatesEnabled()?c++:a++)});return{loading:b,slow:a,fast:c}};e.prototype.setDrawOrder=function(b,a){for(var c=this.symbolLayers.length,d=1/c,e=0;e<c;e++){var f=this.symbolLayers[e];g.isSome(f)&&f.setDrawOrder(b+(1-(1+e)/c),d,a)}};e.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(var b=0,a=this.symbolLayers;b<a.length;b++){var c=a[b];g.isSome(c)&&c.destroy()}this.symbolLayers.length=0;this._destroyed=
!0}};Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0});return e}(e.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){var w=new g(Array,function(b){return c.set(b,c.ZERO)},null,10,5),u=b.create();return function(){function a(b,a,c,e){this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),g=0;g<f.length;g++)f[g]=Array(4);this._visibilityFlags=f;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this.extent=null;this.isElevationSource=!1;++a.referenced;this.graphics3DSymbol=a;this.graphic=b;this._graphics=c;this._featureExpressionFeature=
q.createFeature(b,e);b=0;for(a=this._graphics;b<a.length;b++)c=a[b],d.isSome(c)&&(this.isElevationSource=this.isElevationSource||c.isElevationSource)}a.prototype.initialize=function(b,a){var c=this;this._layer=b;this._stage=a;this.forEachSymbolLayerGraphic(function(d){d.initialize(b,a);d.setVisibility(c.isVisible())})};a.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(b){return b.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=
null};Object.defineProperty(a.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});a.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(b){return b.destroy()});this._labelGraphics.length=0};a.prototype.addLabelGraphic=function(b,a,c){this._labelGraphics.push(b);b.initialize(a,c);b.setVisibility(this.isVisible(1))};a.prototype.addAuxiliaryGraphic=function(b){this._auxiliaryGraphics.push(b);this._layer&&(b.initialize(this._layer,this._stage),
b.setVisibility(this.isVisible()))};a.prototype.isDraped=function(){var b=!1;this.forEachSymbolLayerGraphic(function(a){"draped"===a.type&&(b=!0)});return b};a.prototype.isVisible=function(b,a){void 0===b&&(b=0);for(var c=0;c<=b;c++)for(var d=this._visibilityFlags[c],e=0;e<d.length;++e)if(!1===d[e]&&e!==a)return!1;return!0};a.prototype.hasVisibilityFlag=function(b,a){return null!=this._visibilityFlags[a][b]};a.prototype.setVisibilityFlag=function(b,a,c){var d=this.isVisible(c);this._visibilityFlags[c][b]=
a;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(b){return b.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(b){return b.setVisibility(e)});var f=this.isVisible(1);this.forEachLabelGraphic(function(b){return b.setVisibility(f)})}return!0};a.prototype.clearVisibilityFlag=function(b,a){void 0===a&&(a=0);return this.setVisibilityFlag(b,void 0,a)};a.prototype.getBSRadius=function(){var b=0;this.forEachSymbolLayerGraphic(function(a){b=Math.max(b,a.getBSRadius())});
return b};a.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=l.vec3f64.create());var a=this._graphics[0];return d.isSome(a)?a.getCenterObjectSpace(b):b};a.prototype.computeExtent=function(a){if(!this.extent){this.extent=b.create();var c=this.graphic.geometry;if(d.isNone(c))return this.extent=null,!1;var f=c.spatialReference;e.computeAABR(c,this.extent);if(!f.equals(a)&&!r.boundingRectToBoundingRect(this.extent,f,this.extent,a))return this.extent=null,!1}return!0};a.prototype.getAsOptimizedGeometry=
function(b,a){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===b&&this._optimizedGeometry.hasM===a)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,b,a);this._optimizedGeometry.hasZ=b;this._optimizedGeometry.hasM=a;return this._optimizedGeometry.geometry};a.prototype._convertGraphicToOptimizedGeometry=function(b,a,c){b=b.geometry;if("mesh"===b.type||"extent"===b.type)b=f.fromExtent("mesh"===b.type?b.extent:
b);return p.convertFromGeometry(b,a,c)};Object.defineProperty(a.prototype,"usedMemory",{get:function(){var b=this,a=e.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(function(c){var d=c.graphics3DSymbolLayer.complexity;c="draped"===c.type?d.memory.draped:d.memory;a+=c.bytesPerFeature;c.bytesPerCoordinate&&(a+=e.numVertices(b.graphic.geometry)*c.bytesPerCoordinate)});return a},enumerable:!0,configurable:!0});a.prototype.getProjectedBoundingBox=function(a,e,f,g,
l){return k(this,void 0,void 0,function(){var p=this;return m(this,function(q){switch(q.label){case 0:return l||(l={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),l.boundingBox?c.empty(l.boundingBox):l.boundingBox=c.empty(),l.requiresDrapedElevation=!1,[4,h.forEach(this._graphics,function(b){return k(p,void 0,void 0,function(){var h,p,k;return m(this,function(q){switch(q.label){case 0:if(d.isNone(b))return[2];h="draped"===b.type?e:a;p=w.acquire();return[4,b.getProjectedBoundingBox(h,
f,l.screenSpaceObjects,g,p)];case 1:return k=q.sent(),isFinite(k[2])&&isFinite(k[5])||(l.requiresDrapedElevation=!0),k&&c.expand(l.boundingBox,p),w.release(p),[2]}})})})];case 1:return q.sent(),c.allFinite(l.boundingBox)||b.allFinite(c.toRect(l.boundingBox,u))?[2,l]:[2,null]}})})};a.prototype.needsElevationUpdates=function(){for(var b=0,a=this._graphics;b<a.length;b++){var c=a[b];if(d.isSome(c)&&("object3d"===c.type||"lod-instance"===c.type)&&c.needsElevationUpdates)return!0}b=0;for(a=this._labelGraphics;b<
a.length;b++)if((c=a[b])&&c.needsElevationUpdates)return!0;return!1};a.prototype.alignWithElevation=function(b,a,c){var d=this;this.forEachRenderedGraphic(function(e){"object3d"!==e.type&&"lod-instance"!==e.type||e.alignWithElevation(b,a,d._featureExpressionFeature,c)})};a.prototype.addHighlight=function(b,a){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(b,a)})};a.prototype.removeHighlight=function(b){this.forEachSymbolLayerGraphic(function(a){return a.removeHighlight(b)})};a.prototype.forEachGraphicList=
function(b,a){b.forEach(function(b,c){return b&&a(b,c)})};a.prototype.forEachSymbolLayerGraphic=function(b){this.forEachGraphicList(this._graphics,b);this.forEachGraphicList(this._auxiliaryGraphics,b)};a.prototype.forEachLabelGraphic=function(b){this.forEachGraphicList(this._labelGraphics,b)};a.prototype.forEachRenderedGraphic=function(b){this.forEachSymbolLayerGraphic(b);this.forEachLabelGraphic(b)};return a}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});var p=m.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");a.make=function(b,a,c,d){var e=r[b.type]&&r[b.type][a.type]||q[a.type];return e?new e(b,a,c,d):(p.error("GraphicsLayerFactory#make","unknown symbol type "+a.type),null)};var q={icon:h.default,object:l.default,line:d.default,path:f.default,fill:c.default,extrude:k.default,text:b.default,water:e.default};a.setSymbolClass=function(b,a){q[b]=
a};var r={"mesh-3d":{fill:g.default}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/renderingInfoUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I){function J(b,a,c,d,e,f,g,l,h,p,k,m,u,r){var w=c.length/3,t=0;k+=2*d.count;var v=d.index,y=d.count,n=h,x=k;q.vec3.copy(T,u);var z=0<m?1:-1,v=3*v,A=n;u=3*A;for(var J=n+y,n=3*J,I=0;I<y;++I)r&&(T[0]=b[v+0],T[1]=b[v+1],T[2]=b[v+2],q.vec3.normalize(T,T)),e[u+0]=b[v+0],e[u+1]=b[v+1],e[u+2]=b[v+2],f[u+0]=a[v+0],f[u+1]=a[v+1],f[u+2]=a[v+2],g[u+0]=-z*T[0],g[u+1]=-z*T[1],g[u+2]=-z*T[2],l[A]=0,e[n+0]=b[v+0]+m*T[0],e[n+1]=b[v+1]+m*T[1],e[n+
2]=b[v+2]+m*T[2],f[n+0]=a[v+0],f[n+1]=a[v+1],f[n+2]=a[v+2],g[n+0]=z*T[0],g[n+1]=z*T[1],g[n+2]=z*T[2],l[J]=m,u+=3,n+=3,v+=3,A+=1,J+=1;v=0;u=3*x;n=3*(x+w);u=3*(x+w);n=3*x;b=U;a=P;0>m&&(b=P,a=U);for(I=0;I<w;++I)p[u+0]=c[v+b[0]],p[u+1]=c[v+b[1]],p[u+2]=c[v+b[2]],p[n+0]=c[v+a[0]]+y,p[n+1]=c[v+a[1]]+y,p[n+2]=c[v+a[2]]+y,u+=3,n+=3,v+=3;h+=2*d.count;k=k+2*w-(2*d.count+2*w);L(e,f,l,g,t,d.pathLengths[0],d.count,h,p,k,m);h+=4*d.pathLengths[0];k+=2*d.pathLengths[0];t+=d.pathLengths[0];for(c=1;c<d.pathLengths.length;++c)L(e,
f,l,g,t,d.pathLengths[c],d.count,h,p,k,m),h+=4*d.pathLengths[c],k+=2*d.pathLengths[c],t+=d.pathLengths[c]}function M(b,a,c,d,e,f,g){d[f]=d[g];g*=3;f*=3;b[f+0]=b[g+0];b[f+1]=b[g+1];b[f+2]=b[g+2];a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];c[f+0]=e[0];c[f+1]=e[1];c[f+2]=e[2]}function L(b,a,c,d,e,f,g,l,h,p,k){var m=e,u=e+1,r=e+g,w=e+g+1,v=l,t=l+1,y=l+2*f;l=l+2*f+1;0>k&&(m=e+g+1,w=e);p*=3;for(var n=0;n<f;++n){n===f-1&&(0<k?(u=e,w=e+g):(u=e,m=e+g));var x=b,z=m,A=u,J=r,I=Q,z=3*z,A=3*A,J=3*J;q.vec3.set(Z,
x[z++],x[z++],x[z++]);q.vec3.set(X,x[A++],x[A++],x[A++]);q.vec3.set(aa,x[J++],x[J++],x[J++]);q.vec3.subtract(da,X,Z);q.vec3.subtract(ga,aa,Z);q.vec3.cross(I,ga,da);q.vec3.normalize(I,I);M(b,a,d,c,Q,v,m);M(b,a,d,c,Q,t,u);M(b,a,d,c,Q,y,r);M(b,a,d,c,Q,l,w);h[p++]=v;h[p++]=y;h[p++]=l;h[p++]=v;h[p++]=l;h[p++]=t;m++;u++;r++;w++;v+=2;t+=2;y+=2;l+=2}}function R(b,a,c,d){b=b.stageObject;V.spatialReference=c.spatialReference;for(var f=b.geometryRecords,g=f.length,l="absolute-height"!==a.mode,h=0,k=b.objectTransformation,
m=e.mat4.invert(p.mat4f64.create(),k),u=0;u<g;u++){var r=f[u].geometry;r.invalidateBoundingInfo();for(var w=r.data.getVertexAttr(),r=w[H.VertexAttrConstants.POSITION].data,v=w[H.VertexAttrConstants.SIZE].data,w=w.mapPos.data,t=r.length/3,n=0,x=0,z=!1,A=0,J=0;J<t;J++){V.x=w[x];V.y=w[x+1];V.z=w[x+2];ca[0]=r[n];ca[1]=r[n+1];ca[2]=r[n+2];var I=y.computeElevation(c,V,a,d,l?W:null);l&&(A+=W.terrainElevation);q.vec3.set(O,r[n+0],r[n+1],r[n+2]);q.vec3.transformMat4(O,O,k);d.setAltitude(I+v[n/3],O);q.vec3.transformMat4(O,
O,m);r[n]=O[0];r[n+1]=O[1];r[n+2]=O[2];I=.01/d.unitInMeters;if(Math.abs(ca[0]-r[n])>I||Math.abs(ca[1]-r[n+1])>I||Math.abs(ca[2]-r[n+2])>I)z=!0;x+=3;n+=3}z&&b.geometryVertexAttrsUpdated(u);h+=A/t}return h/g}Object.defineProperty(a,"__esModule",{value:!0});var O=r.vec3f64.create(),T=r.vec3f64.create(),U=[0,2,1],P=[0,1,2],V=w.makeDehydratedPoint(0,0,0,null),W={verticalDistanceToGround:0,terrainElevation:0};n=function(a){function q(b,c,d,e){return a.call(this,b,c,d,e)||this}m(q,a);q.prototype.doLoad=
function(){return h(this,void 0,void 0,function(){var b,a,c,e,f,h;return k(this,function(p){if(!this._isPropertyDriven("size")&&(b=x.validateSymbolLayerSize(this._getSymbolSize())))throw new g("graphics3dextrudesymbollayer:invalid-size",b);a=l.get(this.symbolLayer,"material","color");c=this._getCombinedOpacityAndColor(a);e=r.vec3f64.fromArray(c);f=c[3];h={diffuse:e,ambient:e,opacity:f,transparent:1>f||this._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows};this._material=new N(d({},h,I.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled),{offsetTransparentBackfaces:!0}),this._getIdHint("_3dlinemat"));this._context.stage.add(3,this._material);return[2]})})};q.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&this._context.stage.remove(3,this._material.id)};q.prototype.createGraphics3DGraphic=function(b){var a=b.graphic;if(!this._validateGeometryType(a.geometry,
q.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(a.geometry))return null;var c="graphic"+a.uid,d=this._getVertexOpacityAndColor(b.renderingInfo,Float32Array,255),e=this.getGraphicElevationContext(a);return this._createAs3DShape(a,b.renderingInfo,d,e,c,a.uid)};q.prototype.layerOpacityChanged=function(b,a){var c=this,d=l.get(this.symbolLayer,"material","color"),d=this._getCombinedOpacity(d),e=1>d||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:d,transparent:e});
var f=this._getLayerOpacity();b.forEach(function(b){b=a(b);l.isSome(b)&&b.layerOpacityChanged(f,c._context.isAsync)});return!0};q.prototype.layerElevationInfoChanged=function(b,a){return this.updateGraphics3DGraphicElevationInfo(b,a,y.needsElevationUpdates3D)};q.prototype.slicePlaneEnabledChanged=function(b,a){var c=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});b.forEach(function(b){b=a(b);l.isSome(b)&&b.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,
c._context.isAsync)});return!0};q.prototype.physicalBasedRenderingChanged=function(b,a){this._material.setParameterValues(I.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));return!0};q.prototype.pixelRatioChanged=function(b,a){return!0};q.prototype._getExtrusionSize=function(b){b=b.size&&this._isPropertyDriven("size")?u.getDriverAxisSizeValue(b.size,2):this._getSymbolSize();return b/=this._context.renderCoordsHelper.unitInMeters};q.prototype._getSymbolSize=function(){return this.symbolLayer.size||
1};q.prototype._createAs3DShape=function(a,d,g,h,k,q){var m=y.getGeometryAsPolygon(a.geometry);a=m.rings;var u=[],w=[],t=[],n=Array(6),z=this._context.renderSpatialReference===A.SphericalECEFSpatialReference,I=this._getExtrusionSize(d),M=r.vec3f64.create();z||this._context.renderCoordsHelper.worldUpAtPosition(null,M);d=y.getGeometryVertexData3D(a,m.hasZ,m.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,h);this._logGeometryCreationWarnings(d,
a,"rings","ExtrudeSymbol3DLayer");if(0===a.length||!a.some(function(b){return 0<b.length}))return null;var L=x.computeCentroid(m);if(l.isNone(L))return null;a=p.mat4f64.create();A.computeLinearTransformation(m.spatialReference,[L.x,L.y,0],a,this._context.renderSpatialReference);var H=p.mat4f64.create();e.mat4.invert(H,a);var W=b.mat3f64.create();c.mat3.normalFromMat4(W,H);for(var F=d.geometryData.polygons,O=d.eleVertexData,N=d.vertexData,m=N.length/3,Q=new Float64Array(18*m),V=new Float64Array(18*
m),P=new Float64Array(18*m),T=new Float64Array(6*m),U=0,m=function(b){var a=F[b],c=a.count,d=a.index;if(Z._context.clippingExtent&&(y.computeBoundingBox(O,d,c,n),y.boundingBoxClipped(n,Z._context.clippingExtent)))return"continue";var e=new Float64Array(O.buffer,3*d*Q.BYTES_PER_ELEMENT,3*c),l=a.holeIndices.map(function(b){return b-d}),e=f(e,l,3);if(0===e.length)return"continue";var l=new Uint32Array(6*c+2*e.length),h=6*c,q=3*Q.BYTES_PER_ELEMENT,q=new E.BufferViewVec3f64(Q.buffer,U*q,q,(U+h)*q),m=3*
V.BYTES_PER_ELEMENT,m=new E.BufferViewVec3f64(V.buffer,U*m,m,(U+h)*m),r=new Float64Array(P.buffer,3*U*P.BYTES_PER_ELEMENT,3*h),h=new Float64Array(T.buffer,1*U*T.BYTES_PER_ELEMENT,1*h);J(N,O,e,a,q.typedBuffer,r,m.typedBuffer,h,0,l,0,I,M,z);B.transformMat4(q,q,H);B.transformMat3(m,m,W);U+=6*c;a=Z._createExtrudeGeometry(l,{positions:q.typedBuffer,elevation:r,normals:m.typedBuffer,heights:h},g);b=new G(a,k+"path"+b);b.singleUse=!0;u.push(b);w.push(Z._material);t.push(p.mat4f64.create())},Z=this,L=0;L<
F.length;++L)m(L);if(0===u.length)return null;q=new K({geometries:u,materials:w,transformations:t,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:q,isElevationSource:!0},idHint:k});q.objectTransformation=a;a=this._createEdgeMaterial();a=l.isSome(a)?{baseMaterial:this._material,edgeMaterials:[a],slicePlaneEnabled:this._context.slicePlaneEnabled}:null;q=new v(this,q,u,null,null,R,h,a);q.alignedTerrainElevation=d.terrainElevation;q.needsElevationUpdates=y.needsElevationUpdates3D(h.mode);
return q};q.prototype._createExtrudeGeometry=function(b,a,c){for(var d=b.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[H.VertexAttrConstants.POSITION]=b;d[H.VertexAttrConstants.NORMAL]=b;d[H.VertexAttrConstants.COLOR]=e;f[H.VertexAttrConstants.POSITION]={size:3,data:a.positions};f[H.VertexAttrConstants.NORMAL]={size:3,data:a.normals};f[H.VertexAttrConstants.COLOR]={size:4,data:c};f[H.VertexAttrConstants.SIZE]={size:1,data:a.heights};a.elevation&&(f.mapPos={size:3,data:a.elevation},d.mapPos=
b);return new F.GeometryData(f,d)};q.prototype._createEdgeMaterial=function(){var b={opacity:this._getLayerOpacity()};return z.createMaterial(this.symbolLayer,b)};q.validGeometryTypes=["polygon","extent"];return q}(t.default);a.Graphics3DExtrudeSymbolLayer=n;var Q=r.vec3f64.create(),Z=r.vec3f64.create(),X=r.vec3f64.create(),aa=r.vec3f64.create(),da=r.vec3f64.create(),ga=r.vec3f64.create(),ca=r.vec3f64.create();a.default=n})},"esri/renderers/support/renderingInfoUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Color ../../core/maybe ../visualVariables/support/visualVariableUtils ../../support/arcadeUtils".split(" "),
function(n,a,m,k,h,d,g,l,f){function c(b,a){if(!b||b.symbol)return null;a=a.renderer;return b&&a&&a.getObservationRenderer?a.getObservationRenderer(b):a}function b(b,a){if(g.isSome(b.symbol))return b.symbol;var d=c(b,a);return d&&d.getSymbol(b,m({},a,{arcadeUtils:f}))}function e(b,a){return h(this,void 0,void 0,function(){var d;return k(this,function(e){if(g.isSome(b.symbol))return[2,b.symbol];d=c(b,a);return[2,d&&d.getSymbolAsync(b,m({},a,{abortOptions:{signal:a.signal}}))]})})}Object.defineProperty(a,
"__esModule",{value:!0});a.getRenderer=c;a.getSymbol=b;a.getRenderingInfo=function(a,d){var e=c(a,d),f=b(a,d);if(!f)return null;f={renderer:e,symbol:f};if(!(e&&"visualVariables"in e&&e.visualVariables))return f;var g=["proportional","proportional","proportional"],h=0;for(a=l.getVisualVariableValues(e,a,d);h<a.length;h++){e=a[h];d=e.variable;var p=e.value;"color"===d.type?f.color=p.toRgba():"size"===d.type?"outline"===d.target?f.outlineSize=p:(e=d.axis,d=d.useSymbolValue?"symbolValue":p,"width"===
e?g[0]=d:"depth"===e?g[1]=d:"height"===e?g[2]=d:g[0]="width-and-depth"===e?g[1]=d:g[1]=g[2]=d):"opacity"===d.type?f.opacity=p:"rotation"===d.type&&"tilt"===d.axis?f.tilt=p:"rotation"===d.type&&"roll"===d.axis?f.roll=p:"rotation"===d.type&&(f.heading=p)}if(isFinite(g[0])||isFinite(g[1])||isFinite(g[2]))f.size=g;return f};a.getSymbolAsync=e;a.getRenderingInfoAsync=function(b,a){return h(this,void 0,void 0,function(){var f,g,h,p,q,m,n,z,A,E,B,G;return k(this,function(k){switch(k.label){case 0:return f=
c(b,a),[4,e(b,a)];case 1:g=k.sent();if(!g)return[2,null];h={renderer:f,symbol:g};if(!(f&&"visualVariables"in f&&f.visualVariables))return[2,h];p=l.getVisualVariableValues(f,b,a);q=["proportional","proportional","proportional"];m=0;for(n=p;m<n.length;m++)z=n[m],A=z.variable,E=z.value,"color"===A.type?h.color=d.toUnitRGBA(E):"size"===A.type?"outline"===A.target?h.outlineSize=E:(B=A.axis,G=A.useSymbolValue?"symbolValue":E,"width"===B?q[0]=G:"depth"===B?q[1]=G:"height"===B?q[2]=G:q[0]="width-and-depth"===
B?q[1]=G:q[1]=q[2]=G):"opacity"===A.type?h.opacity=E:"rotation"===A.type&&"tilt"===A.axis?h.tilt=E:"rotation"===A.type&&"roll"===A.axis?h.roll=E:"rotation"===A.type&&(h.heading=E);if(isFinite(q[0])||isFinite(q[1])||isFinite(q[2]))h.size=q;return[2,h]}})})};a.getDriverAxisSizeValue=function(b,a){void 0===a&&(a=0);b=b[a];return"number"===typeof b&&isFinite(b)?b:null}})},"esri/renderers/visualVariables/support/visualVariableUtils":function(){define("require exports ../../../Color ../../../Graphic ../../../core/Logger ../../support/utils ./sizeVariableUtils ../../../support/arcadeUtils".split(" "),
function(n,a,m,k,h,d,g,l){function f(b,a,c){if(b="visualVariables"in b&&b.visualVariables?b.visualVariables.filter(function(b){return"color"===b.type})[0]:b)if("esri.renderers.visualVariables.ColorVariable"!==b.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");else{var d="number"===typeof a,e=d?null:a,f=e&&e.attributes,g=d?a:null,h=b.field,p=b.cache;a=p.ipData;var k=p.hasExpression,p=b.cache.compiledFunc;if(!h&&!k)return(c=b.stops)&&c[0]&&
c[0].color;"number"!==typeof g&&(k?(g=l.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference}),e=l.createExecContext(e,g),p||(g=l.createSyntaxTree(b.valueExpression),p=l.createFunction(g),b.cache.compiledFunc=p),g=l.executeFunction(p,e)):f&&(g=f[h]));e=b.normalizationField;f=f?parseFloat(f[e]):void 0;if(null!=g&&(!e||d||!isNaN(f)&&0!==f)&&(isNaN(f)||d||(g/=f),d=u(g,a)))return f=d[0],a=d[1],c=f===a?b.stops[f].color:m.blendColors(b.stops[f].color,b.stops[a].color,
d[2],c&&c.color),new m(c)}}function c(b,a,c){if(b="visualVariables"in b&&b.visualVariables?b.visualVariables.filter(function(b){return"opacity"===b.type})[0]:b)if("esri.renderers.visualVariables.OpacityVariable"!==b.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");else{var d="number"===typeof a,e=d?null:a,f=e&&e.attributes,g=d?a:null,h=b.field,p=b.cache;a=p.ipData;var k=p.hasExpression,p=b.cache.compiledFunc;if(!h&&!k)return(b=b.stops)&&
b[0]&&b[0].opacity;"number"!==typeof g&&(k?(c=l.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference}),c=l.createExecContext(e,c),p||(e=l.createSyntaxTree(b.valueExpression),p=l.createFunction(e),b.cache.compiledFunc=p),g=l.executeFunction(p,c)):f&&(g=f[h]));c=b.normalizationField;f=f?parseFloat(f[c]):void 0;if(null!=g&&(!c||d||!isNaN(f)&&0!==f)&&(isNaN(f)||d||(g/=f),d=u(g,a))){a=d[0];f=d[1];if(a===f)return b.stops[a].opacity;a=b.stops[a].opacity;return a+(b.stops[f].opacity-
a)*d[2]}}}function b(b,a,c){if(b="visualVariables"in b&&b.visualVariables?b.visualVariables.filter(function(b){return"rotation"===b.type})[0]:b)if("esri.renderers.visualVariables.RotationVariable"!==b.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");else{var d=b.axis||"heading",e="heading"===d&&"arithmetic"===b.rotationType?90:0,d="heading"===d&&"arithmetic"===b.rotationType?-1:1,f="number"===typeof a?null:a,g=f&&f.attributes,h=b.field,
p=b.cache.hasExpression;a=b.cache.compiledFunc;var k=0;if(!h&&!p)return k;p?(c=l.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference}),c=l.createExecContext(f,c),a||(a=l.createSyntaxTree(b.valueExpression),a=l.createFunction(a),b.cache.compiledFunc=a),k=l.executeFunction(a,c)):g&&(k=g[h]||0);return k="number"!==typeof k||isNaN(k)?null:e+d*k}}function e(b,a,c){var d="number"===typeof a,e=d?null:a,f=e&&e.attributes,h=d?a:null;a=b.cache.compiledFunc;if(b.cache.isScaleDriven)e=
c&&c.scale,c=c&&c.view,null==e||c&&"3d"===c.type?(e=c=null,(e=b.stops)?(c=e[0].value,e=e[e.length-1].value):(c=b.minDataValue||0,e=b.maxDataValue||0),c=(c+e)/2):c=e,h=c;else if(!d)switch(b.inputValueType){case "expression":c=l.getViewInfo(c&&{viewingMode:c.viewingMode,scale:c.scale,spatialReference:c.spatialReference});c=l.createExecContext(e,c);a||(e=l.createSyntaxTree(b.valueExpression),a=l.createFunction(e),b.cache.compiledFunc=a);h=l.executeFunction(a,c);break;case "field":f&&(h=f[b.field]);break;
case "unknown":h=null}if(!g.isValidNumber(h))return null;if(d||!b.normalizationField)return h;b=f?parseFloat(f[b.normalizationField]):null;return g.isValidNumber(b)&&0!==b?h/b:null}function p(b,a,c){if(b="visualVariables"in b&&b.visualVariables?b.visualVariables.filter(function(b){return"size"===b.type})[0]:b)if("esri.renderers.visualVariables.SizeVariable"!==b.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");else{var d=e(b,a,c);a=w(d,
b,a,c,b.cache.ipData);return null===a||void 0===a||isNaN(a)?0:a}}function q(b,a,c){return null==b?null:g.isSizeVariable(b)?p(b,a,c):g.isValidNumber(b)?b:null}function r(b,a,c){return g.isValidNumber(c)&&b>c?c:g.isValidNumber(a)&&b<a?a:b}function w(b,a,c,e,f){switch(a.transformationType){case "additive":return e=q(a.minSize,c,e),b+(e||a.minDataValue);case "constant":return b=(b=a.stops)&&b.length&&b[0].size,null==b&&(b=a.minSize),q(b,c,e);case "clamped-linear":f=(b-a.minDataValue)/(a.maxDataValue-
a.minDataValue);var g=q(a.minSize,c,e);c=q(a.maxSize,c,e);e=e&&e.shape;b<=a.minDataValue?a=g:b>=a.maxDataValue?a=c:"area"===a.scaleBy&&e?(e=(a="circle"===e)?t*Math.pow(g/2,2):g*g,e+=f*((a?t*Math.pow(c/2,2):c*c)-e),a=a?2*Math.sqrt(e/t):Math.sqrt(e)):a=g+f*(c-g);return a;case "proportional":return f=e&&e.shape,b/=a.minDataValue,g=q(a.minSize,c,e),a=q(a.maxSize,c,e),e=null,e="circle"===f?2*Math.sqrt(b*Math.pow(g/2,2)):"square"===f||"diamond"===f||"image"===f?Math.sqrt(b*Math.pow(g,2)):b*g,r(e,g,a);case "stops":return f=
u(b,f),g=f[0],b=f[1],f=f[2],g===b?a=q(a.stops[g].size,c,e):(g=q(a.stops[g].size,c,e),a=q(a.stops[b].size,c,e),a=g+(a-g)*f),a;case "real-world-size":return f=(e&&e.resolution?e.resolution:1)*d.meterIn[a.valueUnit],g=q(a.minSize,c,e),e=q(a.maxSize,c,e),a=a.valueRepresentation,c=null,c="area"===a?2*Math.sqrt(b/t)/f:"radius"===a||"distance"===a?2*b/f:b/f,r(c,g,e);case "identity":return b;case "unknown":return null}}function u(b,a){if(a){var c=0,d=a.length-1;a.some(function(a,e){if(b<a)return d=e,!0;c=
e;return!1});return[c,d,(b-a[c])/(a[d]-a[c])]}}Object.defineProperty(a,"__esModule",{value:!0});var v=h.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=new k,t=Math.PI;a.getColor=f;a.getOpacity=c;a.getRotationAngle=b;a.getSize=p;a.getSizeFromNumberOrVariable=q;a.getSizeForValue=w;a.getSizeRangeAtScale=function(b,a,c){var d=c&&"3d"===c.type;if(!(b.cache.isScaleDriven&&d||a))return null;c={scale:a,view:c};a=q(b.minSize,y,c);b=q(b.maxSize,y,c);if(null!=a||null!=b)return a>b&&
(c=b,b=a,a=c),{minSize:a,maxSize:b}};a.getVisualVariableValues=function(a,d,e){if(a.visualVariables){var g=[],l=[],h=[],k=[],q=[],m=0;for(a=a.visualVariables;m<a.length;m++){var u=a[m];switch(u.type){case "color":l.push(u);break;case "opacity":h.push(u);break;case "rotation":q.push(u);break;case "size":k.push(u)}}l.forEach(function(b){var a=f(b,d,e);g.push({variable:b,value:a})});h.forEach(function(b){var a=c(b,d,e);g.push({variable:b,value:a})});q.forEach(function(a){var c=b(a,d,e);g.push({variable:a,
value:c})});k.forEach(function(b){var a=p(b,d,e);g.push({variable:b,value:a})});return g.filter(function(b){return null!=b.value})}}})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(n,a,m,k,h,d,g,l){function f(b,a){if(d.isNone(b))return null;var f=d.isSome(b.color)?l.vec4f64.fromArray(k.toUnitRGBA(b.color)):
l.vec4f64.fromValues(0,0,0,0),p=g.pt2px(b.size),q=g.pt2px(b.extensionLength);switch(b.type){case "solid":return c(m({color:f,size:p,extensionLength:q},a));case "sketch":return m({},e,m({color:f,size:p,extensionLength:q},a),{type:"sketch"});default:h.neverReached(b)}}function c(a){return m({},b,a,{type:"solid"})}Object.defineProperty(a,"__esModule",{value:!0});a.createMaterial=function(b,a){return f(b&&b.enabled&&b.edges||null,a)};a.createMaterialFromEdges=f;a.createSolidEdgeMaterial=c;var b={color:l.vec4f64.fromValues(0,
0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},e={color:l.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.transformMat4=function(a,h,d){if(a.count!==h.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var g=a.count,l=d[0],f=d[1],c=d[2],
b=d[4],e=d[5],p=d[6],k=d[8],r=d[9],w=d[10],u=d[12],v=d[13];d=d[14];var y=a.typedBuffer;a=a.typedBufferStride;var t=h.typedBuffer;h=h.typedBufferStride;for(var n=0;n<g;n++){var z=n*a,A=n*h,E=t[A],B=t[A+1],A=t[A+2];y[z]=l*E+b*B+k*A+u;y[z+1]=f*E+e*B+r*A+v;y[z+2]=c*E+p*B+w*A+d}}};a.transformMat3=function(a,h,d){if(a.count!==h.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var g=a.count,l=d[0],f=d[1],c=d[2],b=d[3],e=d[4],p=d[5],k=d[6],r=d[7];d=d[8];
var w=a.typedBuffer;a=a.typedBufferStride;var u=h.typedBuffer;h=h.typedBufferStride;for(var v=0;v<g;v++){var y=v*a,t=v*h,n=u[t],z=u[t+1],t=u[t+2];w[y]=l*n+b*z+k*t;w[y+1]=f*n+e*z+r*t;w[y+2]=c*n+p*z+d*t}}};a.scale=function(a,h,d){var g=Math.min(a.count,h.count),l=a.typedBuffer;a=a.typedBufferStride;var f=h.typedBuffer;h=h.typedBufferStride;for(var c=0;c<g;c++){var b=c*a,e=c*h;l[b]=d*f[e];l[b+1]=d*f[e+1];l[b+2]=d*f[e+2]}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require","exports",
"../../../../../core/Logger"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.logger=m.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/InstancedRenderer ./renderers/MergedRenderer ../shaders/DefaultPrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){function t(b,a){var c=a.vvSizeEnabled;a.vvSizeEnabled?(b.setUniform3fv("vvSizeMinSize",a.vvSizeMinSize),b.setUniform3fv("vvSizeMaxSize",a.vvSizeMaxSize),b.setUniform3fv("vvSizeOffset",a.vvSizeOffset),b.setUniform3fv("vvSizeFactor",a.vvSizeFactor)):c&&b.setUniform3fv("vvSizeValue",a.vvSizeValue);c&&(b.setUniform3fv("vvSymbolAnchor",a.vvSymbolAnchor),b.setUniformMatrix3fv("vvSymbolRotationMatrix",a.vvSymbolRotationMatrix));a.vvColorEnabled&&(b.setUniform1fv("vvColorValues",
a.vvColorValues),b.setUniform4fv("vvColorColors",a.vvColorColors))}var x=e.assert;n=function(b){function a(c,d){d=b.call(this,d)||this;d.supportsEdges=!0;d.params=r.copyParameters(c,F);d.vertexBufferLayout=a.getVertexBufferLayout(d.params);d.instanceBufferLayout=c.instanced?a.getInstanceBufferLayout(d.params):null;return d}m(a,b);a.prototype.isVisibleInPass=function(b){return 3===b?this.params.castShadows:!0};a.prototype.isVisible=function(){var a=this.params;if(!b.prototype.isVisible.call(this)||
0===a.layerOpacity)return!1;var c=a.instanced,d=a.vertexColors,e=a.symbolColors,c=!!c&&-1<c.indexOf("color"),f=a.vvColorEnabled,g="replace"===a.colorMixMode,l=0<a.opacity,a=a.externalColor&&0<a.externalColor[3];return d&&(c||f||e)?g?!0:l:d?g?a:l:c||f||e?g?!0:l:g?a:l};a.prototype.setParameterValues=function(b){var a=this.params,c;for(c in b)"instanced"===c&&x(b.instanced===a.instanced,"Can not change instanced attributes"),"textureId"===c&&x(a.textureId,"Can only change texture of material that already has a texture"),
"vertexColors"===c&&!0===b[c]&&b[c]!==a[c]&&x(a.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),a[c]=b[c];this.notifyDirty("matChanged")};a.prototype.getParameters=function(){return this.params};a.prototype.intersect=function(b,a,c,d,e,f,l,h){if(null!==this.params.verticalOffset){h=d.camera;g.vec3.set(R,c[12],c[13],c[14]);var p=g.vec3.subtract(O,R,h.eye);c=g.vec3.length(p);var k=g.vec3.scale(p,p,1/c),q=null,p=null;switch(d.viewingMode){case "global":p=g.vec3.normalize(M,
R);break;case "local":p=g.vec3.copy(M,J)}this.params.screenSizePerspective&&(q=g.vec3.dot(p,k));h=r.verticalOffsetAtDistance(h,c,this.params.verticalOffset,q,this.params.screenSizePerspective);g.vec3.scale(p,p,h);g.vec3.transformMat3(L,p,d.transform.inverseRotation);e=g.vec3.subtract(N,e,L);f=g.vec3.subtract(I,f,L)}r.intersectTriangleGeometry(b,a,d,e,f,l)};a.prototype.getGLMaterials=function(){return{color:z,depthShadowMap:E,normal:B,depth:A,highlight:G}};a.prototype.createRenderer=function(b,a){return this.params.softwareInstanced?
new w(b,a,this):new u(b,a,this)};a.prototype.createBufferWriter=function(){return new K(this.vertexBufferLayout,this.instanceBufferLayout)};a.getVertexBufferLayout=function(b){var a=b.textureId||b.normalTextureId||b.metallicRoughnessTextureId||b.emissiveTextureId||b.occlusionTextureId,c=f.newLayout().vec3f("position").vec3f("normal");b.vertexTangents&&c.vec4f("aTangent");a&&c.vec2f("uv0");b.vertexColors&&c.vec4u8("color");b.symbolColors&&c.vec4u8("symbolColor");return c};a.getInstanceBufferLayout=
function(b){var a=f.newLayout(),a=b.instancedDoublePrecision?a.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):a.mat4f("model").mat4f("modelNormal");b.instanced&&-1<b.instanced.indexOf("color")&&(a=a.vec4f("instanceColor"));b.instanced&&-1<b.instanced.indexOf("featureAttribute")&&(a=a.vec4f("instanceFeatureAttribute"));return a};return a}(b.Material);var z=function(b){function a(a){var d=this,e=a.material.getParameters(),d=b.call(this,c.makeCtorParameters(a,e))||
this;d.params=r.copyParameters(e);a=d.params;d.slot=a.transparent?a.writeDepth?7:10:5;a=a.instanced;d.instanced=!!a;d.instancedColor=!!a&&-1<a.indexOf("color");d._createPrograms();d.selectPipeline();return d}m(a,b);a.prototype._createPrograms=function(){var b=this;this.programs=q.BindParametersMap.create(this.params,function(a){return b._createProgram(a)})};a.prototype._createProgram=function(b){var a=this.params;return this.programRep.getProgram(v.colorPass,{treeRendering:!!a.treeRendering,normalTexture:!!a.normalTextureId,
colorTexture:!!a.textureId,tangents:a.vertexTangents?"vertex":"none",vertexColors:a.vertexColors,symbolColors:a.symbolColors,flipV:a.flipV,doubleSided:a.doubleSided&&"normal"===a.doubleSidedType,windowOrderDoubleSided:a.doubleSided&&"winding-order"===a.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:a.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:b.receiveShadows,receiveSSAO:b.receiveSSAO,vvSize:a.vvSizeEnabled,vvColor:a.vvColorEnabled,verticalOffset:null!==
a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,sliceHighlightDisabled:a.sliceHighlightDisabled,normals:a.normals,textureAlphaMode:a.textureAlphaMode,textureAlphaPremultiplied:!!a.textureAlphaPremultiplied,requiresFloatOperationsFix:!!h("ios"),roughnessMetallnessTexture:!!a.metallicRoughnessTextureId,emissionTexture:!!a.emissiveTextureId,occlusionTexture:!!a.occlusionTextureId,usePBR:a.usePBR,offsetBackfaces:!(!a.transparent||!a.offsetTransparentBackfaces)})};
a.prototype.selectPipeline=function(){var b=this.params;this.pipelineState=y.makePipelineState({blending:b.transparent&&y.separateBlendingParams(770,1,771,771),culling:H(b),depthTest:{func:513},depthWrite:b.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};a.prototype.getPrograms=function(){return q.BindParametersMap.programs(this.programs)};
a.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.slot=this.params.transparent?this.params.writeDepth?7:10:5;this.updateTexture(this.params.textureId);this._createPrograms();this.selectPipeline()};a.prototype.bind=function(b,a){var c=this.params,d=this.program=q.BindParametersMap.lookup(this.programs,a);b.bindProgram(d);b.setPipelineState(this.pipelineState);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",
c.specular);d.setUniform4fv("externalColor",c.externalColor);d.setUniform1i("colorMixMode",r.colorMixModes[c.colorMixMode]);c.usePBR&&(d.setUniform1f("metalnessFactor",c.metallicFactor),d.setUniform1f("roughnessFactor",c.roughnessFactor),d.setUniform3fv("emissionFactor",c.emissiveFactor),d.setUniform1f("reflectanceFactor",c.reflectanceFactor));d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);r.bindVerticalOffset(c.verticalOffset,a,d);r.bindScreenSizePerspective(c.screenSizePerspective,
d);t(d,c);this.bindTexture(b,d);"mask"!==c.textureAlphaMode&&"maskBlend"!==c.textureAlphaMode||d.setUniform1f("textureAlphaCutoff",c.textureAlphaCutoff)};a.prototype.release=function(b,a){};a.prototype.bindView=function(b,a){b=this.program=q.BindParametersMap.lookup(this.programs,a);var c=this.params,d=c.instancedDoublePrecision?l.vec3f64.fromValues(a.viewInvTransp[3],a.viewInvTransp[7],a.viewInvTransp[11]):a.origin;r.bindView(d,a.view,b);r.bindCamPos(d,a.viewInvTransp,b);c.instancedDoublePrecision&&
r.bindViewOriginDouble(d,b);c.slicePlaneEnabled&&r.bindSlicePlane(d,a.slicePlane,b);a.shadowMappingEnabled&&a.shadowMap.bindView(b,d)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.getDrawMode=function(){return 4};return a}(c),A=function(b){function a(a){var d=this,d=b.call(this,c.makeCtorParameters(a,a.material.getParameters()))||this;d.biased=!!a.biased;d.updateParameters();
return d}m(a,b);a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=function(){return this.program};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(v.depthPass,{normalTexture:!!b.normalTextureId,colorTexture:!!b.textureId,tangents:b.vertexTangents?"vertex":"none",flipV:b.flipV,instanced:!!b.instanced,instancedDoublePrecision:b.instancedDoublePrecision,shadowMap:this.biased,vvSize:b.vvSizeEnabled,verticalOffset:null!==b.verticalOffset,
screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,textureAlphaMode:b.textureAlphaMode,normals:b.normals,requiresFloatOperationsFix:!!h("ios")});this.pipelineState=y.makePipelineState({culling:H(b),depthTest:{func:513},depthWrite:b.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};a.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?7:10:5};a.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());
this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);c.setUniform2fv("nearFar",a.nearFar);r.bindVerticalOffset(d.verticalOffset,a,c);r.bindScreenSizePerspective(d.screenSizePerspective,c);t(c,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff);this.bindTexture(b,c)};a.prototype.release=
function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params,d=c.instancedDoublePrecision?l.vec3f64.fromValues(a.viewInvTransp[3],a.viewInvTransp[7],a.viewInvTransp[11]):a.origin;r.bindView(d,a.view,b);c.slicePlaneEnabled&&r.bindSlicePlane(d,a.slicePlane,b);c.screenSizePerspective&&r.bindCamPos(d,a.viewInvTransp,b);c.instancedDoublePrecision&&r.bindViewOriginDouble(d,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=
function(){return 4};return a}(c),E=function(b){function a(a){return b.call(this,k({},a,{biased:!0}))||this}m(a,b);return a}(A),B=function(b){function a(a){var d=this,e=a.material.getParameters(),d=b.call(this,c.makeCtorParameters(a,e))||this;d.params=r.copyParameters(e);d.selectProgram();d.selectSlot();return d}m(a,b);a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=function(){return this.program};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(v.normalPass,
{normalTexture:!!b.normalTextureId,colorTexture:!!b.textureId,tangents:b.vertexTangents?"vertex":"none",flipV:b.flipV,instanced:!!b.instanced,instancedDoublePrecision:b.instancedDoublePrecision,vvSize:b.vvSizeEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,textureAlphaMode:b.textureAlphaMode,normals:b.normals,requiresFloatOperationsFix:!!h("ios")});this.pipelineState=y.makePipelineState({culling:H(b),depthTest:{func:513},
depthWrite:b.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};a.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?7:10:5};a.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);this.bindTexture(b,
c);r.bindVerticalOffset(d.verticalOffset,a,c);r.bindScreenSizePerspective(d.screenSizePerspective,c);t(c,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params,d=c.instancedDoublePrecision?l.vec3f64.fromValues(a.viewInvTransp[3],a.viewInvTransp[7],a.viewInvTransp[11]):a.origin;r.bindView(d,a.view,b);b.setUniformMatrix4fv("viewNormal",
a.viewInvTransp);c.slicePlaneEnabled&&r.bindSlicePlane(d,a.slicePlane,b);c.screenSizePerspective&&r.bindCamPos(d,a.viewInvTransp,b);c.instancedDoublePrecision&&r.bindViewOriginDouble(d,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.getDrawMode=function(){return 4};return a}(c),G=function(b){function a(a){var d=this,d=b.call(this,c.makeCtorParameters(a,a.material.getParameters()))||
this;d.updateParameters();return d}m(a,b);a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=function(){return this.program};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(v.highlightPass,{normalTexture:!!b.normalTextureId,colorTexture:!!b.textureId,tangents:b.vertexTangents?"vertex":"none",flipV:b.flipV,instanced:!!b.instanced,instancedDoublePrecision:b.instancedDoublePrecision,vvSize:b.vvSizeEnabled,verticalOffset:null!==
b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,textureAlphaMode:b.textureAlphaMode,normals:b.normals,requiresFloatOperationsFix:!!h("ios")});this.pipelineState=y.makePipelineState({culling:H(b),depthTest:{func:513},depthWrite:b.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};a.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?7:10:5};a.prototype.updateParameters=function(){this.params=
r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);r.bindHighlightRendering(b,a,c);this.bindTexture(b,c);r.bindVerticalOffset(d.verticalOffset,a,c);r.bindScreenSizePerspective(d.screenSizePerspective,c);t(c,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||c.setUniform1f("textureAlphaCutoff",
d.textureAlphaCutoff)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params,d=c.instancedDoublePrecision?l.vec3f64.fromValues(a.viewInvTransp[3],a.viewInvTransp[7],a.viewInvTransp[11]):a.origin;r.bindView(d,a.view,b);c.slicePlaneEnabled&&r.bindSlicePlane(d,a.slicePlane,b);c.screenSizePerspective&&r.bindCamPos(d,a.viewInvTransp,b);c.instancedDoublePrecision&&r.bindViewOriginDouble(d,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",
a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.getDrawMode=function(){return 4};return a}(c);(n||(n={})).COLOR_GAMMA=2.1;var F={textureId:void 0,textureInitTransparent:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],metallicFactor:0,roughnessFactor:1,reflectanceFactor:.5,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,
1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,softwareInstanced:!1,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,
1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:d.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:.1,textureAlphaPremultiplied:!1},K=function(){function b(b,a){this.vertexBufferLayout=b;this.instanceBufferLayout=a}b.prototype.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};b.prototype.elementCount=function(b){return b.indices.position.length};
b.prototype.write=function(b,a,c,d){p.writeDefaultAttributes(a,this.vertexBufferLayout,b.transformation,b.invTranspTransformation,c,d)};return b}(),H=function(b){var a;a=b.cullFace?"none"!==b.cullFace:b.slicePlaneEnabled?!1:!b.transparent&&!b.doubleSided;return a&&{face:"front"===b.cullFace?1028:1029,mode:2305}},N=l.vec3f64.create(),I=l.vec3f64.create(),J=l.vec3f64.fromValues(0,0,1),M=l.vec3f64.create(),L=l.vec3f64.create(),R=l.vec3f64.create(),O=l.vec3f64.create();return n})},"esri/views/3d/webgl-engine/materials/renderers/InstancedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c){function b(b,a){var c=new Map,d=function(b,a){var d=b.origin.id,e=b.data.id,f=c.get(d);f||(f={origin:b.origin.vec3,deltaByGeometry:new Map},c.set(d,f));d=f.deltaByGeometry.get(e);d||(d={renderData:b.data,toAdd:[],toRemove:[]},f.deltaByGeometry.set(e,d));(a?d.toAdd:d.toRemove).push(b)};b.forEach(function(b){d(b,!0)});a.forEach(function(b){d(b,!1)});return c}function e(b,a,c){var d=a.elementCount(b),d=a.allocate(d);a.write({},b,d,0);c.setData(d.buffer)}return function(){function a(b,
a,c,d){void 0===d&&(d=h.Default3D);this.type="InstancedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=b;this._vertexAttributeLocations=d;this._material=c;this._materialRep=a;this._glMaterials=g.acquireMaterials(this._material,this._materialRep);this._bufferWriter=c.createBufferWriter()}a.prototype.dispose=function(){g.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});a.prototype.hasWater=function(){return!1};a.prototype.renderPriority=function(){return this._material.renderPriority};a.prototype.modify=function(b){this.updateGeometries(b.toUpdate);this.addAndRemoveGeometries(b.toAdd,b.toRemove);this.updateHighlightCount()};a.prototype.addAndRemoveGeometries=function(a,h){var p=this,q=this._rctx,r=this._bufferWriter,
y=this._dataByOrigin;a=b(a,h);var t=r.vertexBufferLayout;a.forEach(function(b,a){var h=y.get(a);h||(h={origin:b.origin,highlightCount:0,dataByGeometry:new Map},y.set(a,h));b.deltaByGeometry.forEach(function(b,a){var u=h.dataByGeometry.get(a);!u&&0<b.toAdd.length&&(u={vao:new c(q,p._vertexAttributeLocations,{geometry:k.glLayout(t)},{geometry:l.createVertex(q,35044)}),vertexCount:0,instances:new Map,highlightCount:0},e(b.renderData,r,u.vao.vertexBuffers.geometry),u.vertexCount=f.vertexCount(u.vao,"geometry"),
h.dataByGeometry.set(a,u));var w=u.instances;b.toAdd.forEach(function(b){var a=m.mat4f64.create();g.calculateTransformRelToOrigin(b,a);var c=g.generateRenderGeometryVisibleIndexRanges(b),e=g.generateRenderGeometryHighlightRanges(b),a=new d(b.name,0,u.vertexCount,c,e,a,b.instanceParameters,b.idx,b.data.id);w.set(b.uniqueName,a);h.highlightCount=null;u.highlightCount=null});b.toRemove.forEach(function(b){w.delete(b.uniqueName)});0===w.size&&(u.vao.dispose(),h.dataByGeometry.delete(a))});0===h.dataByGeometry.size&&
y.delete(a)})};a.prototype.updateGeometries=function(b){var a=this._dataByOrigin,c=this._bufferWriter;b.forEach(function(b){var d=b.updateType;b=b.renderGeometry;var f=a.get(b.origin.id),l=f&&f.dataByGeometry.get(b.data.id),h=l&&l.instances.get(b.uniqueName);h&&(d&1&&(h.displayedIndexRange=g.generateRenderGeometryVisibleIndexRanges(b)),d&17&&(h.highlightedIndexRanges=g.generateRenderGeometryHighlightRanges(b),f.highlightCount=null,l.highlightCount=null),d&2&&e(b.data,c,l.vao.vertexBuffers.geometry),
d&4&&g.calculateTransformRelToOrigin(b,h.transformation,h.transformationNormal))})};a.prototype.updateHighlightCount=function(){var b=this;this._highlightCount=0;this._dataByOrigin.forEach(function(a){if(null==a.highlightCount){var c=0;a.dataByGeometry.forEach(function(b){if(null==b.highlightCount){var a=0;b.instances.forEach(function(b){b.highlightedIndexRanges&&++a});b.highlightCount=a}c+=b.highlightCount});a.highlightCount=c}b._highlightCount+=a.highlightCount})};a.prototype.render=function(b,
a,c,d){var e=this,f=this._rctx,g=this._glMaterials.get(a.pass),l=4===a.pass;if(!g||null!=b&&!g.beginSlot(b)||l&&0===this._highlightCount)return!1;g.bind(f,c);var h=!1;this._dataByOrigin.forEach(function(b){l&&0===b.highlightCount||(c.origin=b.origin,g.bindView(f,c),b.dataByGeometry.forEach(function(b){h=l?e.renderHighlightPass(g,b,d)||h:e.renderDefaultPass(g,b,d)||h}))});f.bindVAO(null);g.release(f,c);return h};a.prototype.renderDefaultPass=function(b,a,c){var d=this._rctx,e=b.getProgram(),l=b.getDrawMode(),
h=a.vao,p=a.vertexCount;f.assertCompatibleVertexAttributeLocations(h,e);d.bindVAO(h);var k=!1;a.instances.forEach(function(a){var e=a.displayedIndexRange;e&&0===e.length||(b.bindInstance(d,a),e?g.drawArraysFaceRange(d,e,0,l,c):g.drawArrays(d,l,0,p,c),k=!0)});return k};a.prototype.renderHighlightPass=function(b,a,c){var d=this._rctx,e=b.getProgram(),l=b.getDrawMode(),h=a.vao,p=a.vertexCount;if(0!==a.highlightCount){f.assertCompatibleVertexAttributeLocations(h,e);d.bindVAO(h);var k=!1;a.instances.forEach(function(a){var e=
a.highlightedIndexRanges;if(e&&0!==e.length)for(b.bindInstance(d,a),a=0;a<e.length;a++){var f=e[a];g.drawArrays(d,l,f.range?f.range[0]:0,f.range?f.range[1]-f.range[0]+1:p,c);k=!0}});return k}};return a}()})},"esri/views/3d/webgl-engine/shaders/DefaultPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(a){var d=!!a.roughnessMetallnessTexture||
!!a.emissionTexture||!!a.occlusionTexture||!!a.normalTexture||!!a.colorTexture;return h.glslifyDefineMap({VERTEXCOLORS:a.vertexColors,SYMBOLVERTEXCOLORS:a.symbolColors,FLIPV:a.flipV,DOUBLESIDED:a.doubleSided,WINDINGORDERDOUBLESIDED:a.windowOrderDoubleSided,INSTANCED:a.instanced,INSTANCED_DOUBLE_PRECISION:a.instancedDoublePrecision,INSTANCEDCOLOR:a.instancedColor,RECEIVE_SHADOWS:a.receiveShadows,RECEIVE_SSAO:a.receiveSSAO,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,
SLICE:a.slice,SLICE_HIGHLIGHT_DISABLED:a.sliceHighlightDisabled,GROUND_NORMAL_SHADING:a.groundNormalShading,NORMALS:{value:a.normals,options:{default:"NORMALS_DEFAULT",compressed:"NORMALS_COMPRESSED",screenDerivative:"NORMALS_SCREEN_DERIVATIVE"}},COMPONENTCOLORS:a.componentColor,TEXTURE_ALPHA_MODE_MASK:"mask"===a.textureAlphaMode,TEXTURE_ALPHA_MODE_MASK_BLEND:"maskBlend"===a.textureAlphaMode,TEXTURE_ALPHA_MODE_OPAQUE:"opaque"===a.textureAlphaMode,BIAS_SHADOWMAP:a.shadowMap,VERTEX_TANGENTS:"vertex"===
a.tangents,TEXTURE_COLOR:a.colorTexture,TEXTURE_NORMALS:!!a.normalTexture,TEXTURE_COORDINATES:d,TEXTURE_ATLAS:d&&a.textureAtlas,TREE_RENDERING:a.treeRendering,REQUIRES_FLOAT_OPERATIONS_FIX:a.requiresFloatOperationsFix,TEXTURE_ALPHA_PREMULTIPLIED:!!a.textureAlphaPremultiplied,PBR_TEX_METALLNESS_ROUGHNESS:!!a.roughnessMetallnessTexture,PBR_TEX_EMISSION:!!a.emissionTexture,PBR_TEX_OCCLUSION:!!a.occlusionTexture,USE_PBR:a.usePBR,VERTEX_TRANSPARENCY_DISCARD_ENABLED:!!a.vertexTransparencyDiscardEnabled,
OFFSET_BACKFACES:!!a.offsetBackfaces})};a.colorPass={name:"default-color",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:m.Default3D};a.depthPass={name:"default-depth",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},
attributes:m.Default3D};a.normalPass={name:"default-normal",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:m.Default3D};a.highlightPass={name:"default-highlight",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},
attributes:m.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../symbols/cim/CIMSymbolRasterizer ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ./constants ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L,R,O,T,U,P){function V(b){return q.isSome(b)?"cross"===b||"x"===b:!1}Object.defineProperty(a,"__esModule",{value:!0});var W=v.mat4f64.create(),Q=t.vec3f64.fromValues(0,0,1),Z=[.25,.25,.75,.75],X=[64,64];n=function(a){function v(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._cimLayers=null;b._cimSymbolMaterials=new Map;b._cimSymbolDrapedMaterials=new Map;b._cimSymbolTextures=new Map;b._cimMaterialParametersInfo=null;b._cimRequiredFields=
null;b._size=null;b._symbolTextureRatio=1;b._outlineSize=0;b._texture=null;b._drapedMaterial=null;b._releaseTexture=null;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return b}k(v,a);v.prototype.getCachedSize=function(){return{size:this._getIconSize()}};v.prototype.doLoad=function(b){return d(this,void 0,void 0,function(){var a,c,d,e;return h(this,function(f){switch(f.label){case 0:this._validateOrThrow();a=this._prepareMaterialParameters();c=this._getPrimitive();if(!q.isSome(c))return[3,
1];this._prepareResourcesPrimitive(a,c);return[3,5];case 1:return d=E.getIconHref(this.symbol,this.symbolLayer),(e=u.dataComponents(d))&&"application/json"===e.mediaType?[4,this._prepareResourcesCIM(a,JSON.parse(e.data),b)]:[3,3];case 2:return f.sent(),[3,5];case 3:return[4,this._prepareResourcesHref(a,d,b)];case 4:f.sent(),f.label=5;case 5:return[2]}})})};v.prototype._validateOrThrow=function(){if(!this._isPropertyDriven("size")){var a=I.validateSymbolLayerSize(this._getIconSize());if(a)throw new b("graphics3diconsymbollayer:invalid-size",
a);}};v.prototype._getIconSize=function(){var b=this.symbolLayer,b=Math.round(null!=b.size?w.pt2px(b.size):16);return this._isPropertyDriven("size")?Math.max(b,64):b};v.prototype._generateTextureCIM=function(b){var a=this._getGraphicHash(b),c=""===a?null:this._cimSymbolTextures.get(a);c||(b=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,b),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",b.anchorPosition),c=new U(b.imageData,"symbol",{width:b.imageData.width,
height:b.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(a,c),this._context.stage.add(4,c));return c};v.prototype._computeSize=function(b,a){b=b.width/b.height;return 1<b?[a,Math.round(a/b)]:[Math.round(a*b),a]};v.prototype._prepareMaterialParameters=function(){var b={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},a=this.symbol;if(this._hasVisibleVerticalOffset(a)){var a=a.verticalOffset,c=a.minWorldLength,d=a.maxWorldLength;b.verticalOffset=
{screenLength:w.pt2px(a.screenLength),minWorldLength:c||0,maxWorldLength:null!=d?d:Infinity}}this._context.screenSizePerspectiveEnabled&&(b.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);return b};v.prototype._prepareResourcesPrimitive=function(b,a){var d=this,e=this._getOutlineSize();if(V(a)&&0===e)throw Error("Nothing to render");this._outlineSize=e;b.color=this._getFillColor();b.outlineColor=this._getOutlineColor();b.outlineSize=this._outlineSize;var f=this._context.sharedResources.textures.fromData(a,
function(){var b;switch(a){case "circle":b=J.createCircle(128,64);break;case "square":b=J.createSquare(128,64);break;case "kite":b=J.createKite(128,64);break;case "cross":b=J.createCross(128,64);break;case "x":b=J.createX(128,64);break;case "triangle":b=J.createTriangle(128,64);break;default:c.neverReached(a)}return new U(b,"sdf_"+a,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=f.texture;this._releaseTexture=function(){return d._context.sharedResources.textures.release(f.uid)};
b.textureIsSignedDistanceField=!0;b.distanceFieldBoundingBox=Z;b.textureId=this._texture.id;e=this._getIconSize();this._size=[e,e];this._symbolTextureRatio=2;this._createMaterialsAndAddToStage(b,this._context.stage)};v.prototype._prepareResourcesHref=function(a,c,g){return d(this,void 0,void 0,function(){var d,l,p,k,q,m,w,v,t=this;return h(this,function(h){switch(h.label){case 0:if(!e("esri-canvas-svg-support")&&u.isSVG(c))throw d="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",
new b("graphics3diconsymbollayer:unsupported-image-format",d);this._outlineSize=this._getOutlineSize();a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;a.textureIsSignedDistanceField=!1;l=this._getIconSize();p=l*this._context.layerView.view.pixelRatio;return[4,f.result(this._context.sharedResources.textures.fromUrl(c,p,{signal:g}))];case 1:k=h.sent();if(!1===k.ok)throw r.throwIfAbortError(k.error),d="Failed to load (Request for icon resource failed: "+
c+")",new b("graphics3diconsymbollayer:request-failed",d);q=k.value;m=q.uid;w=q.texture;this._releaseTexture=function(){return t._context.sharedResources.textures.release(m)};v=w.params;this._size=this._computeSize(v,l);a.textureId=w.id;this._createMaterialsAndAddToStage(a,this._context.stage);return[2]}})})};v.prototype._prepareResourcesCIM=function(b,a,c){return d(this,void 0,void 0,function(){var d,e,f,g,p;return h(this,function(h){switch(h.label){case 0:return d=new l.CIMSymbol({data:a}),this._context.sharedResources.cimSymbolRasterizer||
(this._context.sharedResources.cimSymbolRasterizer=new z(this._context.renderSpatialReference,!0)),e=this,[4,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(d,this._context.layer.fields?this._context.layer.fields.map(function(b){return b.toJSON()}):null,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:c})];case 1:e._cimLayers=h.sent();if(this._context.renderer)return[3,2];g=[];return[3,4];case 2:return[4,
this._context.renderer.getRequiredFields(this._context.layer.fields)];case 3:g=h.sent(),h.label=4;case 4:return f=g,r.throwIfAborted(c),p=this._context.layer.fieldsIndex,this._cimRequiredFields=f.map(function(b){return p.get(b).name}),this._cimMaterialParametersInfo=b,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1,[2]}})})};
v.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||A.defaultPrimitive};v.prototype._getOutlineSize=function(){var b=0,b=this.symbolLayer;if(q.isSome(b.outline)&&null!=b.outline.size)return Math.max(w.pt2px(b.outline.size),0);b=this._getPrimitive();b=V(b)?1.5:0;return Math.max(b,0)};v.prototype._getOutlineColor=function(){var b=this._getLayerOpacity(),a=q.get(this.symbolLayer,"outline",
"color");if(q.isSome(a)){var c=g.toUnitRGB(a);return[c[0],c[1],c[2],a.a*b]}return[0,0,0,0]};v.prototype._getFillColor=function(){if(V(this._getPrimitive()))return B.TRANSPARENT;var b=q.isNone(this._getPrimitive()),a=q.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(a,{hasIntrinsicColor:b})};v.prototype._getAnchorPos=function(b,a){return"relative"===b?y.vec2f64.fromValues((a.x||0)+.5,-(a.y||0)+.5):b in I.namedAnchorToHUDMaterialAnchorPos?I.namedAnchorToHUDMaterialAnchorPos[b]:
I.namedAnchorToHUDMaterialAnchorPos.center};v.prototype._createMaterialsAndAddToStage=function(b,a){this._fastUpdates=this._cimLayers?{enabled:!1}:M.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&p.mixin(b,this._fastUpdates.materialParameters);var c=m({},b);c.verticalOffset=null;c.screenSizePerspective=null;c.occlusionTest=!1;c.slicePlaneEnabled=!1;c.shaderPolygonOffset=0;b.occlusionTest=!0;b.slicePlaneEnabled=this._context.slicePlaneEnabled;
if(this._cimLayers){var d=this._cimSymbolMaterials.get(b.textureId),e=this._cimSymbolDrapedMaterials.get(b.textureId);e||(e=new P(c,this._getIdHint("_iconDraped")),this._cimSymbolDrapedMaterials.set(b.textureId,e),a.add(3,e));d||(d=new P(b,this._getIdHint("_icon")),this._cimSymbolMaterials.set(b.textureId,d),a.add(3,d));return[d,e]}this._drapedMaterial=new P(c,this._getIdHint("_iconDraped"));a.add(3,this._drapedMaterial);this._material=new P(b,this._getIdHint("_icon"));a.add(3,this._material);return[this._material,
this._drapedMaterial]};v.prototype.destroy=function(){var b=this;a.prototype.destroy.call(this);this._forEachMaterial(0,function(a){b._context.stage.remove(3,a.id)});this._material&&(this._material=null);this._cimSymbolMaterials.clear();this._drapedMaterial&&(this._drapedMaterial=null);this._cimSymbolDrapedMaterials.clear();this._cimSymbolTextures.forEach(function(a){b._context.stage.remove(4,a.id)});this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=
null)};v.prototype._getScaleFactor=function(b,a){if(this._isPropertyDriven("size")&&b.size){for(var c=0;3>c;c++){var d=b.size[c];d&&"symbolValue"!==d&&"proportional"!==d&&(b.size[c]=w.pt2px(d))}if("symbolValue"===b.size[0])return 1;if(isFinite(+b.size[0]))return+b.size[0]/a;if(isFinite(+b.size[2]))return+b.size[2]/a}return 1};v.prototype.createGraphics3DGraphic=function(b){var a,c=b.renderingInfo,d=b.graphic,e,f;if(this._cimLayers){var g=this._generateTextureCIM(d);f=m({textureId:g.id},this._cimMaterialParametersInfo);
a=this._createMaterialsAndAddToStage(f,this._context.stage);f=a[0];a=a[1];e=[g.params.width,g.params.height]}else e=this._size,f=this._material,a=this._drapedMaterial;if(!this._validateGeometry(d.geometry))return null;g=H.placePointOnGeometry(d.geometry);if(q.isNone(g))return this.logger.warn("unsupported geometry type for icon symbol: "+d.geometry.type),null;var l="graphic"+d.uid,h=this._getVertexOpacityAndColor(c),p=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(p=this._getScaleFactor(c,
e[0]>e[1]?e[0]:e[1]));p*=this._symbolTextureRatio;c=[e[0]*p,e[1]*p];e=this.getGraphicElevationContext(d);return"on-the-ground"===e.mode?this._createAsOverlay(d,g,a,h,c,e,l,d.uid,b.layer.uid):this._createAs3DShape(d,g,f,h,c,e,l,d.uid)};v.prototype.layerOpacityChanged=function(){var b=this._getFillColor(),a=this._getOutlineColor();this._forEachMaterial(0,function(c){c.setParameterValues({color:b});c.setParameterValues({outlineColor:a})});return!0};v.prototype.layerElevationInfoChanged=function(b,a,
c){var d=this._elevationContext.mode;c=H.elevationModeChangeUpdateType(v.elevationModeChangeTypes,c,d);if(c!==H.SymbolUpdateType.UPDATE)return c;var e=H.needsElevationUpdates2D(d)||"absolute-height"===d;return this.updateGraphics3DGraphicElevationInfo(b,a,function(){return e})};v.prototype.slicePlaneEnabledChanged=function(b,a){var c=this;this._forEachMaterial(1,function(b){b.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};v.prototype.physicalBasedRenderingChanged=
function(b,a){return!0};v.prototype.pixelRatioChanged=function(b,a){return this._getPrimitive()?!0:!1};v.prototype.applyRendererDiff=function(b,a){for(var c in b.diff)switch(c){case "visualVariables":if(M.updateFastSymbolUpdatesState(this._fastUpdates,a,this._fastVisualVariableConvertOptions()))this._material&&this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial&&this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;
default:return!1}return!0};v.prototype.setDrawOrder=function(b,a,c){this.updateSymbolLayerOrder(b,a);this._forEachMaterial(2,function(a){a.renderPriority=b;c.add(a.id)})};v.prototype._defaultElevationInfoNoZ=function(){return aa};v.prototype._createAs3DShape=function(b,a,c,d,e,f,g,l){var h=this,p=this.getFastUpdateAttrValues(b);b=p?function(b){return M.evaluateModelTransform(h._fastUpdates.materialParameters,p,b)}:null;d=O.createPointGeometry(Q,null,d,e,da,null,p);d=[new R(d,g)];g=H.createStageObjectForPoint(this._context,
a,d,[c],null,null,f,g,this._context.layer.uid,l,!0,b);if(null===g)return null;var k=new K(this,g.object,d,null,null,G.perObjectElevationAligner,f);k.alignedTerrainElevation=g.terrainElevation;k.needsElevationUpdates=H.needsElevationUpdates2D(f.mode)||"absolute-height"===f.mode;k.getScreenSize=this._createScreenSizeGetter(e,b);k.calculateRelativeScreenBounds=function(b){return c.calculateRelativeScreenBounds(k.getScreenSize(),1,b)};H.extendPointGraphicElevationContext(k,a,this._context.elevationProvider);
return k};v.prototype._createAsOverlay=function(b,a,c,d,e,f,g,l,h){var p=this;c.renderPriority=this._symbolLayerOrder;f=t.vec3f64.create();L.pointToVector(a,f,this._context.overlaySR);f[2]=this._getDrapedZ();if((a=this._context.clippingExtent)&&!H.pointInBox2D(f,a))return null;var k=this.getFastUpdateAttrValues(b);a=k?function(b){return M.evaluateModelTransform(p._fastUpdates.materialParameters,k,b)}:null;d=O.createPointGeometry(Q,f,d,e,null,null,k);l=new T(d);l.material=c;l.center=f;l.bsRadius=0;
l.transformation=W;l.name=g;l.uniqueName=g+"#"+d.id;l.data.layerUid=h;l.data.graphicUid=b.uid;l.calculateShaderTransformation=a;var q=new F(this,[l],null);q.getScreenSize=this._createScreenSizeGetter(e,a);q.calculateRelativeScreenBounds=function(b){return c.calculateRelativeScreenBounds(q.getScreenSize(),1,b)};return q};v.prototype._createScreenSizeGetter=function(b,a){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=b[0]/this._symbolTextureRatio,e=b[1]/this._symbolTextureRatio;return function(b){void 0===
b&&(b=y.vec2f64.create());var f=a(W);b[0]=f[0]*d+c;b[1]=f[5]*e+c;return b}}var f=b[0]/this._symbolTextureRatio+c,g=b[1]/this._symbolTextureRatio+c;return function(b){void 0===b&&(b=y.vec2f64.create());b[0]=f;b[1]=g;return b}};v.prototype._fastVisualVariableConvertOptions=function(){var b=this._size[0]>this._size[1]?this._size[0]:this._size[1],a=t.vec3f64.fromValues(b,b,b),c=w.px2pt(1),b=b*c,b=t.vec3f64.fromValues(b,b,b);return{modelSize:a,symbolSize:b,unitInMeters:c,transformation:{anchor:t.vec3f64.ZEROS,
scale:t.vec3f64.ONES,rotation:t.vec3f64.ZEROS}}};v.prototype._hasVisibleVerticalOffset=function(b){return this.symbol&&"point-3d"===this.symbol.type&&this.symbol.hasVisibleVerticalOffset()};v.prototype._getGraphicHash=function(b){for(var a="",c=0,d=this._cimRequiredFields;c<d.length;c++)var e=d[c],a=a+(e+b.attributes[e]);return a};v.prototype._forEachMaterial=function(b,a){switch(b){case 0:this._forEachMaterial(1,a);this._forEachMaterial(2,a);break;case 1:this._material&&a(this._material);this._cimSymbolMaterials.forEach(a);
break;case 2:this._drapedMaterial&&a(this._drapedMaterial);this._cimSymbolDrapedMaterials.forEach(a);break;default:c.neverReached(b)}};v.PRIMITIVE_SIZE=X;v.elevationModeChangeTypes={definedChanged:H.SymbolUpdateType.UPDATE,staysOnTheGround:H.SymbolUpdateType.NONE,onTheGroundChanged:H.SymbolUpdateType.RECREATE};return v}(N.default);a.Graphics3DIconSymbolLayer=n;var aa={mode:"relative-to-ground",offset:0},da=x.vec4f64.fromValues(0,0,0,1);a.default=n})},"esri/symbols/cim/CIMSymbolRasterizer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/promiseUtils ../../core/screenUtils ../../geometry/support/jsonUtils ./cimAnalyzer ./Rasterizer ./TextRasterizer ./utils ../support/cimSymbolUtils ../support/Symbol3DAnchorPosition2D".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(b,a,c){var d=(b?Object.keys(b):[]).map(function(a){return{name:a,alias:a,type:"string"===typeof b[a]?"esriFieldTypeString":"esriFieldTypeDouble"}});return{geometryType:a,spatialReference:c,fields:d}}return function(){function a(a,d){this._spatialReference=a;this._avoidSDF=d;this._resourceCache=new Map;this._rasterizer=new c.default;this._textRasterizer=new b.default;this._pictureMarkerCache=new Map}a.prototype.rasterizeCIMSymbolAsync=function(b,a,c,
e,g){return k(this,void 0,void 0,function(){var h,k,q,u,w,v,t,y,n,x;return m(this,function(m){switch(m.label){case 0:return[4,p.expandSymbol(b)];case 1:return h=m.sent(),k=[],q=null!==a.centroid?"esriGeometryPolygon":l.getJsonType(a.geometry),u=r(a.attributes,q,this._spatialReference),w=[],w.push(f.analyzeCIMSymbol(h.data,c,u,k,this._avoidSDF)),[4,d.all(w)];case 2:m.sent();v=[];t=0;for(y=k;t<y.length;t++)n=y[t],x=this._getRasterizedResource(n,a,e,g),null!=x&&v.push({cimLayer:n,rasterizedResource:x});
return[2,v]}})})};a.prototype.analyzeCIMSymbol=function(b,a,c,e,g){return k(this,void 0,void 0,function(){var l,k,q,u,w,v,t,y,n;return m(this,function(m){switch(m.label){case 0:return[4,p.expandSymbol(b,g)];case 1:return l=m.sent(),k=[],q=r(a,e,this._spatialReference),u=[],u.push(f.analyzeCIMSymbol(l.data,c,q,k,this._avoidSDF)),[4,d.all(u)];case 2:m.sent(),d.throwIfAborted(g),w=0,m.label=3;case 3:if(!(w<k.length))return[3,6];v=k[w];if("CIMPictureMarker"!==v.cim.type)return[3,5];t=v.materialHash;return this._pictureMarkerCache.get(t)?
[3,5]:[4,h(v.cim.url,{responseType:"image",signal:g.signal})];case 4:y=m.sent(),n=y.data,this._pictureMarkerCache.set(t,n),m.label=5;case 5:return w++,[3,3];case 6:return[2,k]}})})};a.prototype.rasterizeCIMSymbol=function(b,a,c,d){for(var e=[],f=0;f<b.length;f++){var g=b[f],l=this._getRasterizedResource(g,a,c,d);null!=l&&e.push({cimLayer:g,rasterizedResource:l})}return this.getSymbolImage(e,a,c,d)};a.prototype.getSymbolImage=function(b,a,c,d){for(var f=document.createElement("canvas"),l=f.getContext("2d"),
h=0,p=0,k=0,m=0,u=null,r=[],w=0;w<b.length;w++){var v=b[w],t=v.rasterizedResource;if(t){var y=v.cimLayer;if("line"!==y.type&&"fill"!==y.type){var n=t.size,v=e.evaluateValueOrFunction(y.offsetX,a,c,d),L=e.evaluateValueOrFunction(y.offsetY,a,c,d),v=v?v:0,L=L?L:0,R=y.anchorPoint?{x:y.anchorPoint.x,y:y.anchorPoint.y}:{x:0,y:0},O=y.isAbsoluteAnchorPoint||!1,T=!1,U=y.type,P=void 0,V=void 0;"marker"===y.type&&(P=e.evaluateValueOrFunction(y.rotation,a,c,d),T=y.rotateClockwise?y.rotateClockwise:!1);if("text"===
y.type){P=e.evaluateValueOrFunction(y.angle,a,c,d);if(void 0!==y.horizontalAlignment)switch(y.horizontalAlignment){case "left":R.x=.5;break;case "right":R.x=-.5}if(void 0!==y.verticalAlignment)switch(y.verticalAlignment){case "top":R.y=.5;case "bottom":R.y=-.5}}var y=g.pt2px(v)+n[0]*(R.x-.5),W=-g.pt2px(L)+n[1]*(R.y-.5),Q=y+n[0],Z=W+n[1];if(P){T&&(P=360-P);var X=Math.sin(P*Math.PI/180),aa=Math.cos(P*Math.PI/180),V=y*aa+W*X,n=-y*X+W*aa,da=y*aa+Z*X,ga=-y*X+Z*aa,ca=Q*aa+Z*X,Z=-Q*X+Z*aa,ia=Q*aa+W*X,X=
-Q*X+W*aa,y=Math.min(V,da,ca,ia),W=Math.min(n,ga,Z,X),Q=Math.max(V,da,ca,ia),Z=Math.max(n,ga,Z,X),V={minX:y,minY:W,maxX:Q,maxY:Z}}h=y<h?y:h;p=W<p?W:p;k=Q>k?Q:k;m=Z>m?Z:m;y=l.createImageData(t.size[0],t.size[1]);y.data.set(new Uint8ClampedArray(t.image.buffer));t={offsetX:v,offsetY:L,anchorPoint:R,anchorPointAbsolute:O,rotateClockwise:T,type:U,angle:P,rotatedBBox:V,rasterizedImage:y};r.push(t)}}}f.width=k-h;f.height=m-p;for(w=0;w<r.length;w++)a=b=0,t=r[w],c=this._imageDataToCanvas(t.rasterizedImage),
d=t.rasterizedImage.width,v=t.rasterizedImage.height,t.anchorPointAbsolute?(b=g.pt2px(t.offsetX)-h+t.anchorPoint.x,a=-g.pt2px(t.offsetY)-p+t.anchorPoint.y):(b=g.pt2px(t.offsetX)-h+d*(t.anchorPoint.x-.5),a=-g.pt2px(t.offsetY)-p+v*(t.anchorPoint.y-.5)),t.angle?(L=(360-t.angle)*Math.PI/180,l.translate(-d*(t.anchorPoint.x-.5)+b,-v*(t.anchorPoint.y-.5)+a),l.rotate(L),l.drawImage(c,d*(t.anchorPoint.x-.5),v*(t.anchorPoint.y-.5)),l.rotate(-L),l.translate(-(-d*(t.anchorPoint.x-.5)+b),-(-v*(t.anchorPoint.y-
.5)+a))):l.drawImage(c,b,a),u||"text"===t.type||(u=new q.default({x:(-d*(t.anchorPoint.x-.5)+b)/(k-h)-.5,y:(-v*(t.anchorPoint.y-.5)+a)/(m-p)-.5}));return{imageData:l.getImageData(0,0,f.width,f.height),anchorPosition:u}};a.prototype._imageDataToCanvas=function(b){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var a=this._imageDataCanvas,c=a.getContext("2d");a.width=b.width;a.height=b.height;c.putImageData(b,0,0);return a};a.prototype._imageTo32Array=function(b,a,c){this._imageDataCanvas||
(this._imageDataCanvas=document.createElement("canvas"));var d=this._imageDataCanvas,e=d.getContext("2d");d.width=a;d.height=c;e.drawImage(b,0,0,a,c);return new Uint32Array(e.getImageData(0,0,a,c).data.buffer)};a.prototype._getRasterizedResource=function(b,a,c,d){var l;if("text"===b.type)l=b.cim,b=this._rasterizeTextResource(b,l,a,c,d);else{var h=this._resourceCache,p=void 0;"function"===typeof b.materialHash?(p=b.materialHash,p=p(a,c,d),l=f.analyzeCIMResource(a,b.cim,b.materialOverrides)):(p=b.materialHash,
l=b.cim);if(h.has(p))return h.get(p);if("CIMPictureMarker"===b.cim.type){c=e.evaluateValueOrFunction(b.cim.size,a,c,d);b=this._pictureMarkerCache.get(p);if(!b)return null;d=b.height/b.width;a=1<d?g.pt2px(c):g.pt2px(c)/d;c=1<d?g.pt2px(c)*d:g.pt2px(c);b={image:this._imageTo32Array(b,a,c),size:[a,c],sdf:!1,simplePattern:!1}}else b=this._rasterizer.rasterizeJSONResource(l,this._avoidSDF);h.set(p,b)}return b};a.prototype._rasterizeTextResource=function(b,a,c,d,f){a=e.evaluateValueOrFunction(b.text,c,d,
f);if(!a||0===a.length)return null;var g=e.evaluateValueOrFunction(b.fontName,c,d,f),l=e.evaluateValueOrFunction(b.style,c,d,f),h=e.evaluateValueOrFunction(b.weight,c,d,f),p=e.evaluateValueOrFunction(b.decoration,c,d,f),k=e.evaluateValueOrFunction(b.size,c,d,f),q=e.evaluateValueOrFunction(b.horizontalAlignment,c,d,f),m=e.evaluateValueOrFunction(b.verticalAlignment,c,d,f),u=e.colorToArray(e.evaluateValueOrFunction(b.color,c,d,f)),r=e.colorToArray(e.evaluateValueOrFunction(b.outlineColor,c,d,f));b=
e.evaluateValueOrFunction(b.outlineSize,c,d,f);return this._textRasterizer.rasterizeText(a,{color:u,size:k,horizontalAlignment:q,verticalAlignment:m,font:{family:g,style:l,weight:h,decoration:p},halo:{size:b||0,color:r,style:l},pixelRatio:1,premultiplyColors:!this._avoidSDF})};return a}()})},"esri/symbols/cim/cimAnalyzer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../Color ../../core/Logger ../../core/promiseUtils ../../support/arcadeOnDemand ./CIMSymbolHelper ./enums ./SDFHelper ./utils ../../views/2d/arcade/utils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(b){return b?{r:b[0],g:b[1],b:b[2],a:b[3]/255}:{r:0,g:0,b:0,a:0}}function w(a){switch(a){case "Butt":return b.CapType.BUTT;case "Square":return b.CapType.SQUARE;default:return b.CapType.ROUND}}function u(a){switch(a){case "Bevel":return b.JoinType.BEVEL;case "Miter":return b.JoinType.MITER;default:return b.JoinType.ROUND}}function v(b){switch(b){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"justify"}}
function y(b){switch(b){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}}function t(b){var a="normal",c="normal";b&&(b=b.toLowerCase(),-1!==b.indexOf("italic")?a="italic":-1!==b.indexOf("oblique")&&(a="oblique"),-1!==b.indexOf("bold")?c="bold":-1!==b.indexOf("light")&&(c="lighter"));return{style:a,weight:c}}function x(a,d,e,f,g,l){return k(this,void 0,void 0,function(){var h,p,k,q,u,r,w;return m(this,function(m){switch(m.label){case 0:if(!a)return[2];
h=a.symbolLayers;if(!h)return[2];k=c.CIMSymbolHelper.getSize(a);"CIMPointSymbol"===a.type&&"Map"===a.angleAlignment&&(p=b.Alignment.MAP);q=h.length;m.label=1;case 1:if(!q--)return[3,23];u=h[q];if(!u||!1===u.enable)return[3,1];r=[];c.OverrideHelper.findApplicableOverrides(u,d,r);w=u.type;switch(w){case "CIMSolidFill":return[3,2];case "CIMPictureFill":return[3,4];case "CIMHatchFill":return[3,6];case "CIMGradientFill":return[3,8];case "CIMSolidStroke":return[3,10];case "CIMPictureStroke":return[3,12];
case "CIMGradientStroke":return[3,14];case "CIMCharacterMarker":return[3,16];case "CIMPictureMarker":return[3,17];case "CIMVectorMarker":return[3,19]}return[3,21];case 2:return[4,z(u,r,f,g)];case 3:return m.sent(),[3,22];case 4:return[4,A(u,r,f,g)];case 5:return m.sent(),[3,22];case 6:return[4,E(u,r,f,g)];case 7:return m.sent(),[3,22];case 8:return[4,B(u,r,f,g)];case 9:return m.sent(),[3,22];case 10:return[4,G(u,r,f,g,"CIMPolygonSymbol"===a.type,k)];case 11:return m.sent(),[3,22];case 12:return[4,
F(u,r,f,g,"CIMPolygonSymbol"===a.type,k)];case 13:return m.sent(),[3,22];case 14:return[4,K(u,r,f,g,"CIMPolygonSymbol"===a.type,k)];case 15:return m.sent(),[3,22];case 16:return[3,22];case 17:return[4,H(u,r,f,g,p,k)];case 18:return m.sent(),[3,22];case 19:return[4,N(u,r,e,f,g,p,k,l)];case 20:return m.sent(),[3,22];case 21:V.error("Cannot analyze CIM layer",u.type),m.label=22;case 22:return[3,1];case 23:return[2]}})})}function z(b,a,c,d){return k(this,void 0,void 0,function(){var e,f,g,l,h,k;return m(this,
function(q){switch(q.label){case 0:return e=b.primitiveName,f=r(b.color),g=p.hashString(JSON.stringify(b)).toString(),h=(l=d).push,k={type:"fill",templateHash:g,materialHash:0===a.length?g:function(b,a,c){return g},cim:b,materialOverrides:null,colorLocked:b.colorLocked},[4,O(e,"Color",a,c,f,R)];case 1:return h.apply(l,[(k.color=q.sent(),k.height=0,k.angle=0,k.offsetX=0,k.offsetY=0,k.scaleX=1,k)]),[2]}})})}function A(b,a,c,d){return k(this,void 0,void 0,function(){var e,f,g,l,h,k,q;return m(this,function(m){switch(m.label){case 0:return e=
b.primitiveName,f=r(b.tintColor),g=p.hashString(JSON.stringify(b)).toString(),l=p.hashString(""+b.url+JSON.stringify(b.colorSubstitutions)).toString(),k=(h=d).push,q={type:"fill",templateHash:g,materialHash:0===a.length?l:function(b,a,c){return l},cim:b,materialOverrides:null,colorLocked:b.colorLocked},[4,O(e,"TintColor",a,c,f,R)];case 1:return q.color=m.sent(),[4,O(e,"Height",a,c,b.height)];case 2:return q.height=m.sent(),[4,O(e,"ScaleX",a,c,b.scaleX)];case 3:return q.scaleX=m.sent(),[4,O(e,"Rotation",
a,c,b.rotation)];case 4:return q.angle=m.sent(),[4,O(e,"OffsetX",a,c,b.offsetX)];case 5:return q.offsetX=m.sent(),[4,O(e,"OffsetY",a,c,b.offsetY)];case 6:return k.apply(h,[(q.offsetY=m.sent(),q)]),[2]}})})}function E(b,a,c,d){return k(this,void 0,void 0,function(){var e,f,g,l,h,k,q,u;return m(this,function(m){switch(m.label){case 0:e=["Rotation","OffsetX","OffsetY"];f=a.filter(function(a){return a.primitiveName!==b.primitiveName&&-1===e.indexOf(a.propertyName)});g=b.primitiveName;l=p.hashString(JSON.stringify(b)).toString();
k=(h=d).push;q={type:"fill",templateHash:l};if(0!==a.length)return[3,1];u=l;return[3,3];case 1:return[4,P(l,f,c)];case 2:u=m.sent(),m.label=3;case 3:return q.materialHash=u,q.cim=b,q.materialOverrides=f,q.colorLocked=b.colorLocked,q.color={r:128,g:128,b:128,a:1},q.height=0,q.scaleX=1,[4,O(g,"Rotation",a,c,b.rotation)];case 4:return q.angle=m.sent(),[4,O(g,"OffsetX",a,c,b.offsetX)];case 5:return q.offsetX=m.sent(),[4,O(g,"OffsetY",a,c,b.offsetY)];case 6:return k.apply(h,[(q.offsetY=m.sent(),q)]),[2]}})})}
function B(b,a,c,d){return k(this,void 0,void 0,function(){var e,f,g,l,h;return m(this,function(k){switch(k.label){case 0:e=p.hashString(JSON.stringify(b)).toString();g=(f=d).push;l={type:"fill",templateHash:e};if(0!==a.length)return[3,1];h=e;return[3,3];case 1:return[4,P(e,a,c)];case 2:h=k.sent(),k.label=3;case 3:return g.apply(f,[(l.materialHash=h,l.cim=b,l.materialOverrides=null,l.colorLocked=b.colorLocked,l.color={r:128,g:128,b:128,a:1},l.height=0,l.angle=0,l.offsetX=0,l.offsetY=0,l.scaleX=1,
l)]),[2]}})})}function G(b,a,c,d,e,f){return k(this,void 0,void 0,function(){var g,l,h,k,q,v,t,n,y,x;return m(this,function(m){switch(m.label){case 0:return g=p.hashString(JSON.stringify(b)).toString(),l=b.primitiveName,h=r(b.color),k=void 0!==b.width?b.width:4,q=w(b.capStyle),v=u(b.joinStyle),t=b.miterLimit,y=(n=d).push,x={type:"line",templateHash:g,materialHash:0===a.length?g:function(b,a,c){return g},cim:b,materialOverrides:null,isOutline:e,colorLocked:b.colorLocked},[4,O(l,"Color",a,c,h,R)];case 1:return x.color=
m.sent(),[4,O(l,"Width",a,c,k)];case 2:return x.width=m.sent(),[4,O(l,"CapStyle",a,c,q)];case 3:return x.cap=m.sent(),[4,O(l,"JoinStyle",a,c,v)];case 4:return x.join=m.sent(),[4,O(l,"MiterLimit",a,c,t)];case 5:return y.apply(n,[(x.miterLimit=m.sent(),x.referenceWidth=f,x.zOrder=L(b.name),x.isDashed=!1,x)]),[2]}})})}function F(b,a,c,d,e,f){return k(this,void 0,void 0,function(){var g,l,h,k,q,v,t,n,y,x,z;return m(this,function(m){switch(m.label){case 0:return g=p.hashString(""+b.url+JSON.stringify(b.colorSubstitutions)).toString(),
l=b.primitiveName,h=r(b.tintColor),k=void 0!==b.width?b.width:4,q=w(b.capStyle),v=u(b.joinStyle),t=b.miterLimit,n=p.hashString(JSON.stringify(b)).toString(),x=(y=d).push,z={type:"line",templateHash:n,materialHash:0===a.length?g:function(b,a,c){return g},cim:b,materialOverrides:null,isOutline:e,colorLocked:b.colorLocked},[4,O(l,"TintColor",a,c,h,R)];case 1:return z.color=m.sent(),[4,O(l,"Width",a,c,k)];case 2:return z.width=m.sent(),[4,O(l,"CapStyle",a,c,q)];case 3:return z.cap=m.sent(),[4,O(l,"JoinStyle",
a,c,v)];case 4:return z.join=m.sent(),[4,O(l,"MiterLimit",a,c,t)];case 5:return x.apply(y,[(z.miterLimit=m.sent(),z.referenceWidth=f,z.zOrder=L(b.name),z.isDashed=!1,z)]),[2]}})})}function K(b,a,c,d,e,f){return k(this,void 0,void 0,function(){var g,l,h,k,q,r,v,t,n,y;return m(this,function(m){switch(m.label){case 0:g=b.primitiveName;l=void 0!==b.width?b.width:4;h=w(b.capStyle);k=u(b.joinStyle);q=b.miterLimit;r=p.hashString(JSON.stringify(b)).toString();t=(v=d).push;n={type:"line",templateHash:r};if(0!==
a.length)return[3,1];y=r;return[3,3];case 1:return[4,P(r,a,c)];case 2:y=m.sent(),m.label=3;case 3:return n.materialHash=y,n.cim=b,n.materialOverrides=null,n.isOutline=e,n.colorLocked=b.colorLocked,n.color={r:128,g:128,b:128,a:1},[4,O(g,"Width",a,c,l)];case 4:return n.width=m.sent(),[4,O(g,"CapStyle",a,c,h)];case 5:return n.cap=m.sent(),[4,O(g,"JoinStyle",a,c,k)];case 6:return n.join=m.sent(),[4,O(g,"MiterLimit",a,c,q)];case 7:return t.apply(v,[(n.miterLimit=m.sent(),n.referenceWidth=f,n.zOrder=L(b.name),
n.isDashed=!1,n)]),[2]}})})}function H(b,a,c,d,e,f){return k(this,void 0,void 0,function(){var g,l,h,k,q,u,w,v,t,n,y,x,z,A,J,I;return m(this,function(m){switch(m.label){case 0:g=b.primitiveName;l=b.size;h=b.scaleX;k=b.rotation;q=b.offsetX;u=b.offsetY;w=r(b.tintColor);v=p.hashString(""+b.url+JSON.stringify(b.colorSubstitutions)).toString();t=!1;n="";y=0;for(x=a;y<x.length;y++)z=x[y],z.primitiveName===g&&(void 0!==z.value?n+="|"+z.primitiveName+"|"+z.propertyName+"|"+JSON.stringify(z.value):z.valueExpressionInfo&&
(t=!0));J=(A=d).push;I={type:"marker",templateHash:p.hashString(JSON.stringify(b)+n).toString(),materialHash:t?function(b,a,c){return v}:v,cim:b,materialOverrides:null,colorLocked:b.colorLocked,scaleSymbolsProportionally:!1,alignment:e,anchorPoint:b.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==b.anchorPointUnits};return[4,O(g,"Size",a,c,l)];case 1:return I.size=m.sent(),[4,O(g,"ScaleX",a,c,h)];case 2:return I.scaleX=m.sent(),[4,O(g,"Rotation",a,c,k)];case 3:return I.rotation=m.sent(),[4,O(g,"OffsetX",
a,c,q)];case 4:return I.offsetX=m.sent(),[4,O(g,"OffsetY",a,c,u)];case 5:return I.offsetY=m.sent(),[4,O(g,"TintColor",a,c,w,R)];case 6:return J.apply(A,[(I.color=m.sent(),I.outlineColor={r:0,g:0,b:0,a:0},I.outlineWidth=0,I.frameHeight=0,I.rotateClockwise=b.rotateClockwise,I.referenceSize=f,I.sizeRatio=1,I)]),[2]}})})}function N(b,a,c,d,e,f,g,h){return k(this,void 0,void 0,function(){var p,k,q,u,r,w,v,t;return m(this,function(m){switch(m.label){case 0:p=b.markerGraphics;if(!p)return[2];k=0;b.scaleSymbolsProportionally&&
(q=b.frame)&&(k=q.ymax-q.ymin);u=[];r=0;for(w=p;r<w.length;r++)if(v=w[r])if(t=v.symbol)switch(t.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":u.push(J(b,v,a,d,e,f,g,k,h));break;case "CIMTextSymbol":u.push(I(b,v,a,c,d,e,f,g,k))}return[4,l.all(u)];case 1:return m.sent(),[2]}})})}function I(b,a,d,e,f,g,l,q,u){return k(this,void 0,void 0,function(){var k,w,n,x,z,A,J,I,M,B,L,E,R,G,H,F,K,N,W,Q,V,P,T,Z;return m(this,function(m){switch(m.label){case 0:k=[];c.OverrideHelper.findApplicableOverrides(a,
d,k);w=a.geometry;if(!("x"in w&&"y"in w))return[2];n=a.symbol;x=n.underline?"underline":n.strikethrough?"line-through":"none";z=t(n.fontStyleName);n.font=h({family:n.fontFamilyName,decoration:x},z);A=b.frame;J=w.x-.5*(A.xmin+A.xmax);I=w.y-.5*(A.ymin+A.ymax);M=b.size/u;B=b.primitiveName;L=(n.height||0)*M;E=n.angle||0;R=((n.offsetX||0)+J)*M;G=((n.offsetY||0)+I)*M;H=r(c.CIMSymbolHelper.getFillColor(n));F=r(c.CIMSymbolHelper.getStrokeColor(n));K=c.CIMSymbolHelper.getStrokeWidth(n);K||(F=r(c.CIMSymbolHelper.getFillColor(n.haloSymbol)),
K=n.haloSize*M);N="";W=0;for(Q=d;W<Q.length;W++)V=Q[W],V.primitiveName===B&&void 0!==V.value&&(N+="|"+V.primitiveName+"|"+V.propertyName+"|"+JSON.stringify(V.value));T=(P=g).push;Z={type:"text",templateHash:p.hashString(JSON.stringify(a)+N).toString(),materialHash:function(b,a,c){return p.hashString(JSON.stringify(n.font)).toString()},cim:n,materialOverrides:null,colorLocked:b.colorLocked,alignment:l,anchorPoint:{x:b.anchorPoint?b.anchorPoint.x:0,y:b.anchorPoint?b.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==
b.anchorPointUnits,fontName:n.fontFamilyName,decoration:"none",weight:"normal",style:"normal"};return[4,O(B,"Height",d,f,L)];case 1:return Z.size=m.sent(),[4,O(B,"Rotation",d,f,E)];case 2:return Z.angle=m.sent(),[4,O(B,"OffsetX",d,f,R)];case 3:return Z.offsetX=m.sent(),[4,O(B,"OffsetY",d,f,G)];case 4:return T.apply(P,[(Z.offsetY=m.sent(),Z.horizontalAlignment=v(n.horizontalAlignment),Z.verticalAlignment=y(n.verticalAlignment),Z.text=U(e,f,a.textString,n.textCase),Z.color=H,Z.outlineColor=F,Z.outlineSize=
K,Z.referenceSize=q,Z.sizeRatio=1,Z)]),[2]}})})}function J(b,a,d,f,g,l,h,q,u){return k(this,void 0,void 0,function(){var k,w,v,t,n,y;return m(this,function(x){switch(x.label){case 0:k=a.symbol;w=a.geometry;if(!w)return[2];v=e.getExtent(w);if("CIMTextSymbol"===k.type)return[2];t=k.symbolLayers;if(!t)return[2];n=t.length;y=function(){var k,y,x,z,A,J,I,B,L,E,G,H,F,K,N,W,Q,V,P,T,U,Z,da,X,ga,aa,ia,ra,ba;return m(this,function(m){switch(m.label){case 0:return(k=t[n])&&!1!==k.enable?u?[4,M(b,a,d,f,g,l,h,
q)]:[3,2]:[2,"continue"];case 1:return m.sent(),[2,"continue"];case 2:y=k.type;switch(y){case "CIMSolidFill":return[3,3];case "CIMSolidStroke":return[3,3]}return[3,15];case 3:x=e.getSDFMetrics(v,b.frame,b.size,b.anchorPoint,"Relative"!==b.anchorPointUnits);z=x[0];A=x[1];J=x[2];I="CIMSolidFill"===k.type;B={type:"sdf",geom:w,asFill:I};L=b.primitiveName;E=b.size;G=b.rotation;H=b.offsetX;F=b.offsetY;K=k.primitiveName;N=I?r(c.CIMSymbolHelper.getFillColor(k)):r(c.CIMSymbolHelper.getStrokeColor(k));W=I?
{r:0,g:0,b:0,a:0}:r(c.CIMSymbolHelper.getStrokeColor(k));Q=c.CIMSymbolHelper.getStrokeWidth(k);if(!I&&!Q)return[3,16];V=!1;P="";T=0;for(U=d;T<U.length;T++)if(Z=U[T],Z.primitiveName===K||Z.primitiveName===L)void 0!==Z.value?P+="|"+Z.primitiveName+"|"+Z.propertyName+"|"+JSON.stringify(Z.value):Z.valueExpressionInfo&&(V=!0);da=p.hashString(JSON.stringify(B)).toString();X=p.hashString(JSON.stringify(k)+JSON.stringify(a)+P).toString();aa=(ga=g).push;ia={type:"marker",templateHash:X,materialHash:V?function(b,
a,c){return da}:da,cim:B,materialOverrides:null,colorLocked:b.colorLocked,scaleSymbolsProportionally:b.scaleSymbolsProportionally,alignment:l,anchorPoint:{x:A,y:J},isAbsoluteAnchorPoint:!1};return[4,O(L,"Size",d,f,E)];case 4:return ia.size=m.sent(),ia.scaleX=1,[4,O(L,"Rotation",d,f,G)];case 5:return ia.rotation=m.sent(),[4,O(L,"OffsetX",d,f,H)];case 6:return ia.offsetX=m.sent(),[4,O(L,"OffsetY",d,f,F)];case 7:return ia.offsetY=m.sent(),[4,O(K,"Color",d,f,N,R)];case 8:ia.color=m.sent();if(!I)return[3,
9];ra={r:0,g:0,b:0,a:0};return[3,11];case 9:return[4,O(K,"Color",d,f,W,R)];case 10:ra=m.sent(),m.label=11;case 11:ia.outlineColor=ra;if(!I)return[3,12];ba=0;return[3,14];case 12:return[4,O(K,"Width",d,f,Q)];case 13:ba=m.sent(),m.label=14;case 14:return aa.apply(ga,[(ia.outlineWidth=ba,ia.frameHeight=q,ia.rotateClockwise=b.rotateClockwise,ia.referenceSize=h,ia.sizeRatio=z,ia)]),[3,16];case 15:return M(b,a,d,f,g,l,h,q),[3,16];case 16:return[2]}})};x.label=1;case 1:return n--?[5,y()]:[3,3];case 2:return x.sent(),
[3,1];case 3:return[2]}})})}function M(b,a,d,e,f,g,l,h){return k(this,void 0,void 0,function(){var k,q,u,r,w,v,t,n,y,x,z,A,J,I,M,B;return m(this,function(m){switch(m.label){case 0:k={type:b.type,enable:!0,name:b.name,colorLocked:b.colorLocked,primitiveName:b.primitiveName,anchorPoint:b.anchorPoint,anchorPointUnits:b.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:b.rotateClockwise,rotation:0,size:b.size,billboardMode3D:b.billboardMode3D,depth3D:b.depth3D,frame:b.frame,markerGraphics:[a],scaleSymbolsProportionally:b.scaleSymbolsProportionally,
respectFrame:b.respectFrame,clippingPath:b.clippingPath};q=[];u=["Rotation","OffsetX","OffsetY"];q=d.filter(function(a){return a.primitiveName===b.primitiveName&&-1===u.indexOf(a.propertyName)});r=c.CIMSymbolHelper.getTextureAnchor(k);w=r[0];v=r[1];t=JSON.stringify(k);n=b.primitiveName;y=b.rotation;x=b.offsetX;z=b.offsetY;A=p.hashString(JSON.stringify(k)).toString();I=(J=f).push;M={type:"marker",templateHash:A};if(0!==q.length)return[3,1];B=A;return[3,3];case 1:return[4,P(t,q,e)];case 2:B=m.sent(),
m.label=3;case 3:return M.materialHash=B,M.cim=k,M.materialOverrides=q,M.colorLocked=b.colorLocked,M.scaleSymbolsProportionally=b.scaleSymbolsProportionally,M.alignment=g,M.anchorPoint={x:w,y:v},M.isAbsoluteAnchorPoint=!1,M.size=b.size,M.scaleX=1,[4,O(n,"Rotation",d,e,y)];case 4:return M.rotation=m.sent(),[4,O(n,"OffsetX",d,e,x)];case 5:return M.offsetX=m.sent(),[4,O(n,"OffsetY",d,e,z)];case 6:return I.apply(J,[(M.offsetY=m.sent(),M.color={r:0,g:0,b:0,a:0},M.outlineColor={r:0,g:0,b:0,a:0},M.outlineWidth=
0,M.frameHeight=h,M.rotateClockwise=b.rotateClockwise,M.referenceSize=l,M.sizeRatio=1,M)]),[2]}})})}function L(b){return b&&0===b.indexOf("Level_")?parseInt(b.substr(6),10):0}function R(b){if(!b||0===b.length)return null;b=(new d(b)).toRgba();return{r:b[0],g:b[1],b:b[2],a:b[3]}}function O(b,a,c,d,e,g){return k(this,void 0,void 0,function(){var l,h,p,k,u;return m(this,function(r){switch(r.label){case 0:if(!b)return[3,4];l=function(c){var l,h,p;return m(this,function(k){switch(k.label){case 0:if(c.primitiveName!==
b||c.propertyName!==a)return[3,2];if(void 0!==c.value)return[2,{value:g?g(c.value):c.value}];l=c.valueExpressionInfo;if(!l)return[3,2];h=l.expression;return[4,f.createRendererExpression(h,d.spatialReference,d.fields)];case 1:return p=k.sent(),[2,{value:function(b,a,c){b=q.callWithFeature(p,b,{$view:c},d.geometryType,a);null!==b&&g&&(b=g(b));return null!==b?b:e}}];case 2:return[2]}})};h=0;p=c;r.label=1;case 1:if(!(h<p.length))return[3,4];k=p[h];return[5,l(k)];case 2:u=r.sent();if("object"===typeof u)return[2,
u.value];r.label=3;case 3:return h++,[3,1];case 4:return[2,e]}})})}function T(b,a){switch(a){case "LowerCase":return b.toLowerCase();case "Allcaps":return b.toUpperCase();default:return b}}function U(b,a,c,d){if(!b||-1===c.indexOf("["))return T(c,d);a=function(b){for(var a=b.length;a--;)if(-1===" /-,\n".indexOf(b.charAt(a)))return!1;return!0};var e=[],f=0,g=-1;do g=c.indexOf("[",f),g>=f&&(g>f&&(f=c.substr(f,g-f),e.push([f,null,a(f)])),f=g+1,g=c.indexOf("]",f),g>=f&&(g>f&&(f=c.substr(f,g-f),(f=b[f])&&
e.push([null,f,!1])),f=g+1));while(-1!==g);f<c.length-1&&(f=c.substr(f),e.push([f,null,a(f)]));return function(b,a,c){a="";c=null;for(var f=0;f<e.length;f++){var g=e[f],l=g[0],h=g[1],g=g[2];if(l)g?c=l:(c&&(a+=c,c=null),a+=l);else if(l=b.attributes[h])c&&(a+=c,c=null),a+=l}return T(a,d)}}function P(b,a,d){return k(this,void 0,void 0,function(){var e,g,l,h;return m(this,function(k){switch(k.label){case 0:e=function(b){var a,c,e;return m(this,function(g){switch(g.label){case 0:a=b.valueExpressionInfo;
if(!a)return[3,2];c=a.expression;return[4,f.createRendererExpression(c,d.spatialReference,d.fields)];case 1:e=g.sent(),b.fn=function(b,a,c){return q.callWithFeature(e,b,{$view:c},d.geometryType,a)},g.label=2;case 2:return[2]}})},g=0,l=a,k.label=1;case 1:if(!(g<l.length))return[3,4];h=l[g];return[5,e(h)];case 2:k.sent(),k.label=3;case 3:return g++,[3,1];case 4:return[2,function(d,e,f){for(var g=0;g<a.length;g++){var l=a[g];l.fn&&(l.value=l.fn(d,e,f))}return p.hashString(b+c.OverrideHelper.buildOverrideKey(a)).toString()}]}})})}
Object.defineProperty(a,"__esModule",{value:!0});var V=g.getLogger("esri.symbols.cim.cimAnalyzer");a.analyzeCIMSymbol=function(b,a,c,d,e){return k(this,void 0,void 0,function(){var f,g,l,h;return m(this,function(p){switch(p.label){case 0:f=d?d:[];if(!b)return[2,f];"CIMSymbolReference"===b.type?(g=b.symbol,l=b.primitiveOverrides):(g=b,l=null);h=g.type;switch(h){case "CIMPointSymbol":return[3,1];case "CIMLineSymbol":return[3,1];case "CIMPolygonSymbol":return[3,1];case "CIMTextSymbol":return[3,3]}return[3,
4];case 1:return[4,x(g,l,a,c,f,e)];case 2:return p.sent(),[3,4];case 3:return[3,4];case 4:return[2,f]}})})};a.analyzeCIMResource=function(b,a,d){if(!d||0===d.length)return a;b=JSON.parse(JSON.stringify(a));c.OverrideHelper.applyOverrides(b,d);return b};a.applyCIMLayerProperties=function(b,a){}})},"esri/symbols/cim/CIMSymbolHelper":function(){define("require exports ../../Color ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMCursor ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./CIMSymbolDrawHelper ./packingUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){function e(b,a){switch(a.type){case "CIMSymbolReference":var c={type:"point",x:0,y:0};b.drawSymbol(a.symbol,c);break;case "CIMPointSymbol":c={type:"point",x:0,y:0};b.drawSymbol(a,c);break;case "CIMVectorMarker":c=new f.Placement,b.drawMarker(a,c)}return b.envelope()}Object.defineProperty(a,"__esModule",{value:!0});var p=Math.PI,q=p/2,r=k.getLogger("esri.symbols.cim.CIMSymbolHelper");n=function(){function b(){}b.getEnvelope=function(b){var a=new c.EnvDrawHelper;if(Array.isArray(b)){for(var d=
void 0,f=0;f<b.length;f++){var g=b[f];d?d.union(e(a,g)):d=e(a,g)}return d}return e(a,b)};b.getTextureAnchor=function(b){b=this.getEnvelope(b);if(!b||0>=b.width||0>=b.height)return[0,0];var a=96/72;return[(b.x+.5*b.width)*a/(b.width*a+2),-(b.y+.5*b.height)*a/(b.height*a+2)]};b.rasterize=function(b,a,d){void 0===d&&(d=!0);var e=this.getEnvelope(a);if(!e||0>=e.width||0>=e.height)return[null,0,0];var g=96/72,l=(e.x+.5*e.width)*g,h=-(e.y+.5*e.height)*g;b.width=e.width*g+2;b.height=e.height*g+2;e=b.getContext("2d");
g=c.Transformation.createScale(g,-g);g.translate(.5*b.width-l,.5*b.height-h);l=new c.CanvasDrawHelper(e,g);switch(a.type){case "CIMPointSymbol":l.drawSymbol(a,{type:"point",x:0,y:0});break;case "CIMVectorMarker":h=new f.Placement,l.drawMarker(a,h)}a=e.getImageData(0,0,b.width,b.height);a=new Uint8Array(a.data);if(d)for(d=void 0,e=0;e<a.length;e+=4)d=a[e+3]/255,a[e]*=d,a[e+1]*=d,a[e+2]*=d;return[a,b.width,b.height]};b.fromSimpleMarker=function(b){var a,c,d=b.style;if("circle"===d||"esriSMSCircle"===
d){a=Math.acos(.995);c=Math.ceil(p/a/4);0===c&&(c=1);a=q/c;c*=4;d=[];d.push([50,0]);for(var e=1;e<c;e++)d.push([50*Math.cos(e*a),-50*Math.sin(e*a)]);d.push([50,0]);a={rings:[d]};c={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===d||"esriSMSCross"===d)a=0,a={rings:[[[a,50],[a,a],[50,a],[50,-a],[a,-a],[a,-50],[-a,-50],[-a,-a],[-50,-a],[-50,a],[-a,a],[-a,50],[a,50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===d||"esriSMSDiamond"===d)a={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,
0]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===d||"esriSMSSquare"===d)a={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===d||"esriSMSX"===d)a=0,a={rings:[[[0,a],[50-a,50],[50,50-a],[a,0],[50,a-50],[50-a,-50],[0,-a],[a-50,-50],[-50,a-50],[-a,0],[-50,50-a],[a-50,50],[0,a]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===d||"esriSMSTriangle"===d)c=2/3*100,d=c-100,a={rings:[[[-57.735026918962575,d],[0,c],[57.735026918962575,
d],[-57.735026918962575,d]]]},c={xmin:-57.735026918962575,ymin:d,xmax:57.735026918962575,ymax:c};var f;a&&c&&(f=[{type:"CIMSolidFill",enable:!0,color:b.color}],b.outline&&f.push({type:"CIMSolidStroke",enable:!0,width:b.outline.width,color:b.outline.color}),f={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:b.angle,size:b.size,offsetX:b.xoffset,offsetY:b.yoffset,frame:c,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:{type:"CIMPolygonSymbol",symbolLayers:f}}]}]});
return f};b.getFillColor=function(a){if(!a)return null;switch(a.type){case "CIMPolygonSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getFillColor(a[c]);if(null!=d)return d}}break;case "CIMTextSymbol":return b.getFillColor(a.symbol);case "CIMSolidFill":return a.color}};b.getStrokeColor=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getStrokeColor(a[c]);if(void 0!==
d)return d}}break;case "CIMTextSymbol":return b.getStrokeColor(a.symbol);case "CIMSolidStroke":return a.color}};b.getStrokeWidth=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getStrokeWidth(a[c]);if(void 0!==d)return d}}break;case "CIMTextSymbol":return b.getStrokeWidth(a.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return a.width}};b.getSize=function(a){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var c=
0;if(a.symbolLayers){var d=0;for(a=a.symbolLayers;d<a.length;d++){var e=b.getSize(a[d]);e>c&&(c=e)}}return c;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":return a.width;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":return a.size}};b.getMarkerScaleRatio=function(b){if(b)switch(b.type){case "CIMVectorMarker":if(!1!==b.scaleSymbolsProportionally&&b.frame)return b.size/(b.frame.ymax-b.frame.ymin)}return 1};b.executeEffects=function(b,a,c){void 0===
c&&(c=!1);var d=96/72,e=b?b.length:0;e&&c&&--e;for(c=0;c<e;++c){var f=b[c];if(f){var g=l.getEffectOperator(f);g&&(a=g.execute(a,f,d))}}return a};b.processEffects=function(a,c,e){var f;a.effects&&0<a.effects.length&&(f=d.deltaEncodeGeometry(e),f=new g.SimpleGeometryCursor(f),f=b.executeEffects(a.effects,f));a=a.symbolLayers[c];a.effects&&0<a.effects.length&&(c=!1,"CIMGeometricEffectDashes"===a.effects[a.effects.length-1].type&&(c=!0),f||(f=d.deltaEncodeGeometry(e),f=new g.SimpleGeometryCursor(f)),
f=b.executeEffects(a.effects,f,c));if(!f)return e;e=[];for(a=f.next();a;)e.push(a),a=f.next();f=e.length;switch(f){case 0:return null;case 1:return d.deltaEncodeGeometry(e[0]);default:a=e[0];for(c=1;c<f;++c){var l=e[c];h.isPolygon(a)&&h.isPolygon(l)&&Array.prototype.push.apply(a.rings,l.rings);h.isPolyline(a)&&h.isPolyline(l)&&Array.prototype.push.apply(a.paths,l.paths)}return d.deltaEncodeGeometry(a)}};return b}();a.CIMSymbolHelper=n;n=function(){function a(){}a.rasterizeSimpleFill=function(b,a){"solid"!==
a&&"none"!==a&&"esriSFSSolid"!==a&&"esriSFSNull"!==a||console.error("Unexpected: style does not require rasterization");b.width=8;b.height=8;var c=b.getContext("2d");c.strokeStyle="#FFFFFF";c.lineWidth=1;c.beginPath();if("vertical"===a||"cross"===a||"esriSFSCross"===a||"esriSFSVertical"===a)c.moveTo(0,0),c.lineTo(0,8);if("horizontal"===a||"cross"===a||"esriSFSCross"===a||"esriSFSHorizontal"===a)c.moveTo(0,0),c.lineTo(8,0);if("forward-diagonal"===a||"diagonal-cross"===a||"esriSFSDiagonalCross"===a||
"esriSFSForwardDiagonal"===a)c.moveTo(0,0),c.lineTo(8,8);if("backward-diagonal"===a||"diagonal-cross"===a||"esriSFSBackwardDiagonal"===a||"esriSFSDiagonalCross"===a)c.moveTo(8,0),c.lineTo(0,8);c.stroke();a=c.getImageData(0,0,b.width,b.height);a=new Uint8Array(a.data);for(var d=0;d<a.length;d+=4)c=a[d+3]/255,a[d]*=c,a[d+1]*=c,a[d+2]*=c;return[a,b.width,b.height]};a.rasterizeSimpleLine=function(b,a,c){switch(c){case "butt":c="Butt";break;case "square":c="Square";break;default:c="Round"}var d="Butt"===
c;switch(a){case "dash":case "esriSLSDash":a=d?[4,3]:[3,4];break;case "dash-dot":case "esriSLSDashDot":a=d?[4,3,1,3]:[3,4,0,4];break;case "dot":case "esriSLSDot":a=d?[1,3]:[0,4];break;case "long-dash":case "esriSLSLongDash":a=d?[8,3]:[7,4];break;case "long-dash-dot":case "esriSLSLongDashDot":a=d?[8,3,1,3]:[7,4,0,4];break;case "long-dash-dot-dot":case "esriSLSDashDotDot":a=d?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case "short-dash":case "esriSLSShortDash":a=d?[4,1]:[3,2];break;case "short-dash-dot":case "esriSLSShortDashDot":a=
d?[4,1,1,1]:[3,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":a=d?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":a=d?[1,1]:[0,2];break;case "solid":case "esriSLSSolid":case "none":r.error("Unexpected: style does not require rasterization");a=[0,0];break;default:r.error("Tried to rasterize SLS, but found an unexpected style: "+a+"!"),a=[0,0]}return this.rasterizeDash(b,a,c)};a.rasterizeDash=function(a,c,d){a="Butt"===d;var e="Square"===d;d=!a&&!e;for(var f=
0,g=0;g<c.length;g++)var l=c[g],f=f+l;for(var f=15*f,h=31*f,g=new Float32Array(h),p=d?225:15,l=0;l<h;++l)g[l]=p;for(var p=h=0,k=!0,q=0;q<c.length;q++){for(var l=c[q],h=p,p=p+15*l,m=h;m<p;){for(var u=0;31>u;){var l=u*f+m,r=d?(u-15)*(u-15):Math.abs(u-15);g[l]=k?a?Math.max(Math.max(h+7.5-m,r),Math.max(m-p+7.5,r)):r:d?Math.min((m-h)*(m-h)+r,(m-p)*(m-p)+r):e?Math.min(Math.max(m-h,r),Math.max(p-m,r)):Math.min(Math.max(m-h+7.5,r),Math.max(p+7.5-m,r));u++}m++}k=!k}c=g.length;a=new Uint8Array(4*c);for(l=0;l<
c;++l)b.packFloatRGBA((d?Math.sqrt(g[l]):g[l])/15,a,4*l);return[a,f,31]};return a}();a.SymbolHelper=n;n=function(){function b(){}b.findApplicableOverrides=function(a,c,d){if(c){if(a.primitiveName){for(var e=!1,f=0;f<d.length;f++){var g=d[f];if(g.primitiveName===a.primitiveName){e=!0;break}}if(!e)for(e=0;e<c.length;e++)g=c[e],g.primitiveName===a.primitiveName&&d.push(g)}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(e=0,f=a.effects;e<f.length;e++)g=
f[e],b.findApplicableOverrides(g,c,d);if(a.symbolLayers)for(g=0,a=a.symbolLayers;g<a.length;g++)b.findApplicableOverrides(a[g],c,d);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(a.effects)for(e=0,f=a.effects;e<f.length;e++)g=f[e],b.findApplicableOverrides(g,c,d);a.markerPlacement&&b.findApplicableOverrides(a.markerPlacement,
c,d);if("CIMVectorMarker"===a.type){if(a.markerGraphics)for(g=0,a=a.markerGraphics;g<a.length;g++)e=a[g],b.findApplicableOverrides(e,c,d),b.findApplicableOverrides(e.symbol,c,d)}else"CIMCharacterMarker"===a.type?b.findApplicableOverrides(a.symbol,c,d):"CIMHatchFill"===a.type&&b.findApplicableOverrides(a.lineSymbol,c,d)}}};b.applyOverrides=function(a,c,d,e){if(c){if(a.primitiveName)for(var f=0;f<c.length;f++){var g=c[f];if(g.primitiveName===a.primitiveName){var l;l=(l=g.propertyName)?l.charAt(0).toLowerCase()+
l.substr(1):l;e&&e.push({cim:a,nocapPropertyName:l,value:a[l]});g.expression&&(g.value=b.toValue(g.propertyName,g.expression));if(d){for(var h=!1,p=0,k=d;p<k.length;p++)k[p].primitiveName===a.primitiveName&&(h=!0);h||d.push(g)}a[l]=g.value}}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(g=0,l=a.effects;g<l.length;g++)f=l[g],b.applyOverrides(f,c,d,e);if(a.symbolLayers)for(f=0,a=a.symbolLayers;f<a.length;f++)b.applyOverrides(a[f],c,d,e);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(a.effects)for(g=
0,l=a.effects;g<l.length;g++)f=l[g],b.applyOverrides(f,c,d,e);if("CIMVectorMarker"===a.type&&a.markerGraphics)for(f=0,a=a.markerGraphics;f<a.length;f++)g=a[f],b.applyOverrides(g,c,d,e),b.applyOverrides(g.symbol,c,d,e)}}};b.restoreOverrides=function(b){for(var a=0;a<b.length;a++){var c=b[a];c.cim[c.nocapPropertyName]=c.value}};b.buildOverrideKey=function(b){for(var a="",c=0;c<b.length;c++){var d=b[c];void 0!==d.value&&(a+=""+d.primitiveName+d.propertyName+JSON.stringify(d.value))}return a};b.toValue=
function(b,a){return"DashTemplate"===b?a.split(" ").map(function(b){return Number(b)}):"Color"===b?(b=(new m(a)).toRgba(),b[3]*=255,b):a};return b}();a.OverrideHelper=n})},"esri/symbols/cim/CIMCursor":function(){define(["require","exports","../../geometry/support/jsonUtils","./CIMPlacements"],function(n,a,m,k){function h(b){if(b)for(var a=b.length-1;0<a;--a)b[a][0]-=b[a-1][0],b[a][1]-=b[a-1][1]}function d(b){if(b)for(var a=0;a<b.length;a++)h(b[a])}function g(b){if(b)for(var a=b.length,c=1;c<a;++c)b[c][0]+=
b[c-1][0],b[c][1]+=b[c-1][1]}function l(b){if(b)for(var a=0;a<b.length;a++)g(b[a])}function f(b){b&&b.reverse()}function c(b){return{rings:[[[b.xmin,b.ymin],[b.xmin,b.ymax],[b.xmax,b.ymax],[b.xmax,b.ymin],[b.xmin,b.ymin]]]}}Object.defineProperty(a,"__esModule",{value:!0});a.deltaEncodePath=h;a.deltaEncodeMultipath=d;a.deltaDecodeGeometry=function(b){m.isPolygon(b)?l(b.rings):m.isPolyline(b)?l(b.paths):m.isMultipoint(b)&&g(b.points);return b};a.deltaEncodeGeometry=function(b){m.isPolygon(b)?d(b.rings):
m.isPolyline(b)?d(b.paths):m.isMultipoint(b)&&h(b.points);return b};a.reverseMultipath=function(b){if(b)for(var a=0;a<b.length;a++)f(b[a])};a.reversePath=f;a.getCoord2D=function(b,a,c){return[b[0]+(a[0]-b[0])*c,b[1]+(a[1]-b[1])*c]};a.isClosedPath=function(b){return b&&0!==b.length?b[0][0]===b[b.length-1][0]&&b[0][1]===b[b.length-1][1]:!1};a.getId=function(b){return b[4]};a.setId=function(b,a){b[4]=a};n=function(){function b(b,a,d,f){this.acceptPolygon=a;this.acceptPolyline=d;this.geomUnitsPerPoint=
f;this.pathIndex=this.pathCount=-1;this.iteratePath=!1;b&&(m.isPolygon(b)?a&&(this.multiPath=b.rings,this.isClosed=!0):m.isPolyline(b)?d&&(this.multiPath=b.paths,this.isClosed=!1):m.isExtent(b)&&a&&(this.multiPath=c(b).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length));this.internalPlacement=new k.Placement}b.prototype.next=function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var b=this.processPath(this.multiPath[this.pathIndex]);
if(b)return b}this.pathIndex=this.pathCount=-1;return this.multiPath=null};b.prototype.processPath=function(b){return null};return b}();a.PathTransformationCursor=n;n=function(){function b(b,a,c,d){this.inputGeometries=b;this.acceptPolygon=a;this.acceptPolyline=c;this.geomUnitsPerPoint=d;this.pathIndex=this.pathCount=-1;this.iteratePath=!1}b.prototype.next=function(){for(;;){if(!this.multiPath){for(var b=this.inputGeometries.next();b;)if(m.isPolygon(b)?this.acceptPolygon&&(this.multiPath=b.rings,
this.isClosed=!0):m.isPolyline(b)?this.acceptPolyline&&(this.multiPath=b.paths,this.isClosed=!1):m.isExtent(b)&&this.acceptPolygon&&(this.multiPath=c(b).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length;this.pathIndex=-1;break}else b=this.inputGeometries.next();if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;)if(this.iteratePath||this.pathIndex++,b=this.processPath(this.multiPath[this.pathIndex]))return b;this.pathIndex=this.pathCount=
-1;this.multiPath=null}};b.prototype.processPath=function(b){return null};return b}();a.PathGeometryCursor=n})},"esri/symbols/cim/CIMPlacements":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this.setIdentity()}a.prototype.setIdentity=function(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rz_c=1;this.rz_s=0};a.prototype.setTranslate=function(a,h){this.tx=a;this.ty=h};a.prototype.setTranslateZ=function(a){this.tz=
a};a.prototype.setRotateCS=function(a,h){this.rz=void 0;this.rz_c=a;this.rz_s=h};a.prototype.setRotate=function(a){this.rz=a;this.rz_s=this.rz_c=void 0};a.prototype.setRotateY=function(a){this.ry=a};a.prototype.setScale=function(a){this.s=a};a.prototype.setMeasure=function(a){this.m=a};return a}();a.Placement=n;n=function(){function a(a){}a.prototype.next=function(){return null};return a}();a.EmptyPlacementCursor=n})},"esri/symbols/cim/CIMEffects":function(){define(["require","exports","../../core/lang"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this._geometry=a}a.prototype.next=function(){var a=this._geometry;this._geometry=null;return a};return a}();a.SimpleGeometryCursor=n;a.clone=function(a){return m.clone(a)}})},"esri/symbols/cim/CIMOperators":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.getEffectOperator=function(a){return null};a.getPlacementOperator=function(a){return null}})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./Rect".split(" "),
function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});a.C_DEG_TO_RAD=Math.PI/180;var b=h.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),e=function(){function b(b){this._t=b}b.createIdentity=function(){return new b([1,0,0,0,1,0])};b.prototype.clone=function(){return new b(this._t.slice())};b.prototype.transform=function(b){var a=this._t;return[a[0]*b[0]+a[1]*b[1]+a[2],a[3]*b[0]+a[4]*b[1]+a[5]]};b.createScale=function(a,c){return new b([a,0,0,0,c,0])};b.prototype.scale=function(b,
a){var c=this._t;c[0]*=b;c[1]*=b;c[2]*=b;c[3]*=a;c[4]*=a;c[5]*=a;return this};b.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};b.createTranslate=function(a,c){return new b([0,0,a,0,0,c])};b.prototype.translate=function(b,a){var c=this._t;c[2]+=b;c[5]+=a;return this};b.createRotate=function(a){var c=Math.cos(a);a=Math.sin(a);return new b([c,-a,0,a,c,0])};b.prototype.rotate=function(a){return this.multiply(b.createRotate(a))};b.prototype.multiply=function(b){var a=
this._t;b=b._t;var c=a[1]*b[0]+a[4]*b[1],d=a[2]*b[0]+a[5]*b[1]+b[2],e=a[0]*b[3]+a[3]*b[4],f=a[1]*b[3]+a[4]*b[4],g=a[2]*b[3]+a[5]*b[4]+b[5];a[0]=a[0]*b[0]+a[3]*b[1];a[1]=c;a[2]=d;a[3]=e;a[4]=f;a[5]=g;return this};return b}();a.Transformation=e;n=function(){function c(b){this._transfos=[];this._sizeTransfos=[];this._transfos.push(b||e.createIdentity());this._sizeTransfos.push(b?b.scaleRatio():1)}c.prototype.transformPt=function(b){return this._transfos[this._transfos.length-1].transform(b)};c.prototype.transformSize=
function(b){return b*this._sizeTransfos[this._sizeTransfos.length-1]};c.prototype.back=function(){return this._transfos[this._transfos.length-1]};c.prototype.push=function(b){var a=b.scaleRatio();b.multiply(this.back());this._transfos.push(b);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*a)};c.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};c.prototype.drawSymbol=function(b,a){if(b)switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(b,
a)}};c.prototype.drawMultiLayerSymbol=function(b,a){if(b){var c=b.symbolLayers;if(c)if(b=b.effects){if(a=this.executeEffects(b,a))for(b=a.next();b;)this.drawSymbolLayers(c,b),b=a.next()}else this.drawSymbolLayers(c,a)}};c.prototype.executeEffects=function(b,a){var c=96/72;a=new g.SimpleGeometryCursor(a);for(var d=b?b.length:0,e=0;e<d;++e){var f=b[e];if(f){var h=l.getEffectOperator(f);h&&(a=h.execute(a,f,c))}}return a};c.prototype.drawSymbolLayers=function(b,a){for(var c=b.length;c--;){var d=b[c];
if(d&&!1!==d.enable){var e=d.effects;if(e){if(e=this.executeEffects(e,a))for(var f=e.next();f;)this.drawSymbolLayer(d,f),f=e.next()}else this.drawSymbolLayer(d,a)}}};c.prototype.drawSymbolLayer=function(b,a){switch(b.type){case "CIMSolidFill":this.drawSolidFill(a,b.color);break;case "CIMSolidStroke":this.drawSolidStroke(a,b.color,b.width);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(b,a)}};c.prototype.drawMarkerLayer=function(b,a){var c=b.markerPlacement;
if(c){var d=96/72,e=l.getPlacementOperator(c);if(e&&(a=e.execute(a,c,d)))for(c=a.next();c;)this.drawMarker(b,c),c=a.next()}else c=new f.Placement,c.tx=a.x,c.ty=a.y,this.drawMarker(b,c)};c.prototype.drawMarker=function(b,a){switch(b.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(b,a);break;case "CIMVectorMarker":this.drawVectorMarker(b,a)}};c.prototype.drawPictureMarker=function(b,a){};c.prototype.drawVectorMarker=function(c,d){if(c){var f=c.markerGraphics;if(f){var g=
c.size,l=c.frame,h=l?l.ymax-l.ymin:0,g=g&&h?g/h:1,h=e.createIdentity();l&&h.translate(.5*-(l.xmax+l.xmin),.5*-(l.ymax+l.ymin));var p=c.anchorPoint;if(p){var k=p.x,p=p.y;"Absolute"!==c.anchorPointUnits&&l&&(k*=l.xmax-l.xmin,p*=l.ymax-l.ymin);h.translate(-k,-p)}1!==g&&h.scale(g,g);c.rotation&&h.rotate(c.rotation*a.C_DEG_TO_RAD);h.translate(c.offsetX||0,c.offsetY||0);h.translate(d.tx,d.ty);this.push(h);for(c=0;c<f.length;c++)(d=f[c])&&d.symbol&&d.geometry||b.error("Invalid marker graphic",d),this.drawSymbol(d.symbol,
d.geometry);this.pop()}}};c.prototype.drawSolidFill=function(b,a){};c.prototype.drawSolidStroke=function(b,a,c){};return c}();a.CIMSymbolDrawHelper=n;k=function(b){function a(){var a=b.call(this)||this;a.reset();return a}m(a,b);a.prototype.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity};a.prototype.envelope=function(){return new c.default(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};a.prototype._merge=function(b,a){b[0]-a<this._xmin&&(this._xmin=
b[0]-a);b[0]+a>this._xmax&&(this._xmax=b[0]+a);b[1]-a<this._ymin&&(this._ymin=b[1]-a);b[1]+a>this._ymax&&(this._ymax=b[1]+a)};a.prototype.drawSolidFill=function(b,a){if(b&&b.rings)for(a=0,b=b.rings;a<b.length;a++){var c=b[a],d=c?c.length:0;if(2<d){this._merge(this.transformPt(c[0]),0);for(var e=1;e<d;++e)this._merge(this.transformPt(c[e]),0)}}};a.prototype.drawSolidStroke=function(b,a,c){a=.5*this.transformSize(c);if(b=d.isPolygon(b)?b.rings:b.paths)for(c=0;c<b.length;c++){var e=b[c],f=e?e.length:
0;if(1<f){this._merge(this.transformPt(e[0]),a);for(var g=1;g<f;++g)this._merge(this.transformPt(e[g]),a)}}};return a}(n);a.EnvDrawHelper=k;n=function(b){function a(a,c){c=b.call(this,c)||this;c._ctx=a;return c}m(a,b);a.prototype.drawSolidFill=function(b,a){if(b&&b.rings){var c=this._ctx;c.fillStyle="string"===typeof a?a:"rgba("+Math.round(a[0])+","+Math.round(a[1])+","+Math.round(a[2])+","+a[3]/255+")";c.beginPath();a=0;for(b=b.rings;a<b.length;a++){var d=b[a],e=d?d.length:0;if(2<e){var f=this.transformPt(d[0]);
c.moveTo(f[0],f[1]);for(var g=1;g<e;++g)f=this.transformPt(d[g]),c.lineTo(f[0],f[1]);c.closePath()}}c.fill("evenodd")}};a.prototype.drawSolidStroke=function(b,a,c){var e=this._ctx;e.strokeStyle="string"===typeof a?a:"rgba("+Math.round(a[0])+","+Math.round(a[1])+","+Math.round(a[2])+","+a[3]/255+")";e.lineWidth=this.transformSize(c)+.5;e.beginPath();a=!1;d.isPolygon(b)?(c=b.rings,a=!0):c=b.paths;for(b=0;b<c.length;b++){var f=c[b],g=f?f.length:0;if(1<g){var l=this.transformPt(f[0]);e.moveTo(l[0],l[1]);
for(var h=1;h<g;++h)l=this.transformPt(f[h]),e.lineTo(l[0],l[1]);a&&e.closePath()}}e.stroke()};return a}(n);a.CanvasDrawHelper=n})},"esri/symbols/cim/Rect":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,h,d,g){void 0===a&&(a=0);void 0===h&&(h=0);void 0===d&&(d=0);void 0===g&&(g=0);this.x=a;this.y=h;this.width=d;this.height=g}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},
enumerable:!0,configurable:!0});a.prototype.union=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=Math.max(this.width,a.width);this.height=Math.max(this.height,a.height)};return a}();a.default=n})},"esri/symbols/cim/packingUtils":function(){define(["require","exports"],function(n,a){function m(a){return a-Math.floor(a)}Object.defineProperty(a,"__esModule",{value:!0});var k=[1,256,65536,16777216],h=[1/256,1/65536,1/16777216,1/4294967296],d=function(a,d){void 0===d&&(d=
0);for(var f=0,c=0;4>c;c++)f+=a[d+c]*h[c];return f}(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(a,l,f){void 0===f&&(f=0);a=0>a?0:a>d?d:a;for(var c=0;4>c;c++)l[f+c]=Math.floor(256*m(a*k[c]))}})},"esri/symbols/cim/enums":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});(function(a){a[a.BUTT=0]="BUTT";a[a.ROUND=1]="ROUND";a[a.SQUARE=2]="SQUARE";a[a.UNKNOWN=4]="UNKNOWN"})(a.CapType||(a.CapType={}));(function(a){a[a.BEVEL=0]=
"BEVEL";a[a.ROUND=1]="ROUND";a[a.MITER=2]="MITER";a[a.UNKNOWN=4]="UNKNOWN"})(a.JoinType||(a.JoinType={}));(function(a){a[a.SCREEN=0]="SCREEN";a[a.MAP=1]="MAP"})(a.Alignment||(a.Alignment={}))})},"esri/symbols/cim/SDFHelper":function(){define(["require","exports","../../geometry/support/jsonUtils","./packingUtils","./Rect"],function(n,a,m,k,h){function d(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":a=a.symbolLayers;if(!a||1!==a.length)break;return d(a[0]);case "CIMVectorMarker":a=a.markerGraphics;
if(!a||1!==a.length)break;var f=a[0];if(!f)break;a=f.geometry;if(!a)break;f=f.symbol;if(!f||"CIMPolygonSymbol"!==f.type&&"CIMLineSymbol"!==f.type)break;return{geom:a,asFill:"CIMPolygonSymbol"===f.type};case "sdf":return{geom:a.geom,asFill:a.asFill}}return null}function g(a){for(var d=Infinity,c=-Infinity,b=Infinity,e=-Infinity,g=0;g<a.length;g++)for(var l=0,h=a[g];l<h.length;l++){var k=h[l];k[0]<d&&(d=k[0]);k[0]>c&&(c=k[0]);k[1]<b&&(b=k[1]);k[1]>e&&(e=k[1])}return[d,b,c,e]}Object.defineProperty(a,
"__esModule",{value:!0});a.getSDFInfo=d;a.getSDFSymbol=function(a){a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:a};a.getExtent=function(a){return a?a.rings?g(a.rings):a.paths?g(a.paths):m.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null};a.getSDFMetrics=function(a,d,c,b,e){var f=a[0],g=a[1],l=a[2];a=a[3];if(l<f||a<g)return[0,0,0];var h=l-f,k=a-g,l=Math.floor(31.5);a=(128-2*(l+1))/Math.max(h,
k);var h=Math.round(h*a),k=Math.round(k*a)+2*l,m=1;d&&(m=k/a/(d.ymax-d.ymin));var n=0,t=0;b&&(e?d&&c&&0<d.ymax-d.ymin&&(n=b.x/((d.xmax-d.xmin)/(d.ymax-d.ymin)*c),t=b.y/c):(n=b.x,t=b.y));n=.5*(d.xmax+d.xmin)+n*(d.xmax-d.xmin);t=.5*(d.ymax+d.ymin)+t*(d.ymax-d.ymin);n=(n-f)*a+l;t=(t-g)*a+l;return[m,n/(h+2*l)-.5,-(t/k-.5)]};a.buildSDF=function(a){var d,c=a.geom;d=c?c.rings?c.rings:c.paths?c.paths:void 0!==c.xmin&&void 0!==c.ymin&&void 0!==c.xmax&&void 0!==c.ymax?[[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,
c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]:null:null;var b,c=Infinity,e=-Infinity,g=Infinity,l=-Infinity;for(b=0;b<d.length;b++)for(var m=0,w=d[b];m<w.length;m++){var u=w[m];u[0]<c&&(c=u[0]);u[0]>e&&(e=u[0]);u[1]<g&&(g=u[1]);u[1]>l&&(l=u[1])}b=new h.default(c,g,e-c,l-g);g=Math.floor(31.5);m=(128-2*(g+1))/Math.max(b.width,b.height);c=Math.round(b.width*m)+2*g;e=Math.round(b.height*m)+2*g;l=[];for(w=0;w<d.length;w++){var v=d[w];if(v&&1<v.length){for(var u=[],n=0;n<v.length;n++){var t=v[n],x=t[0],t=t[1],
x=x-b.x,t=t-b.y,x=x*m,t=t*m,x=x+(g-.5),t=t+(g-.5);u.push([x,t])}a.asFill&&(n=u.length-1,u[0][0]===u[n][0]&&u[0][1]===u[n][1]||u.push(u[0]));l.push(u)}}b=c*e;d=Array(b);w=g*g+1;for(m=0;m<b;++m)d[m]=w;for(w=0;w<l.length;w++)for(u=l[w],n=u.length,m=1;m<n;++m){var v=u[m-1],x=u[m],z=void 0,t=void 0;v[0]<x[0]?(z=v[0],t=x[0]):(z=x[0],t=v[0]);var A=void 0,E=void 0;v[1]<x[1]?(A=v[1],E=x[1]):(A=x[1],E=v[1]);var B=Math.floor(z)-g,t=Math.floor(t)+g,A=Math.floor(A)-g,E=Math.floor(E)+g;0>B&&(B=0);t>c&&(t=c);0>
A&&(A=0);E>e&&(E=e);for(var z=x[0]-v[0],G=x[1]-v[1],F=z*z+G*G;B<t;B++)for(var K=A;K<E;K++){var H=(B-v[0])*z+(K-v[1])*G,N=void 0,I=void 0;0>H?(N=v[0],I=v[1]):H>F?(N=x[0],I=x[1]):(H/=F,N=v[0]+H*z,I=v[1]+H*G);H=(B-N)*(B-N)+(K-I)*(K-I);N=(e-K-1)*c+B;H<d[N]&&(d[N]=H)}}for(m=0;m<b;++m)d[m]=Math.sqrt(d[m]);if(a.asFill)for(a=0;a<l.length;a++)for(b=l[a],m=b.length,w=1;w<m;++w)for(u=b[w-1],n=b[w],x=v=void 0,u[0]<n[0]?(v=u[0],x=n[0]):(v=n[0],x=u[0]),t=A=void 0,u[1]<n[1]?(A=u[1],t=n[1]):(A=n[1],t=u[1]),v=Math.floor(v),
x=Math.floor(x)+1,A=Math.floor(A),t=Math.floor(t)+1,v<g&&(v=g),x>c-g&&(x=c-g),A<g&&(A=g),t>e-g&&(t=e-g);A<t;++A)if(u[1]>A!==n[1]>A){E=(e-A-1)*c;for(z=v;z<x;++z)z<(n[0]-u[0])*(A-u[1])/(n[1]-u[1])+u[0]&&(d[E+z]=-d[E+z]);for(z=g;z<v;++z)d[E+z]=-d[E+z]}g*=2;l=d.length;a=new Uint8Array(4*l);for(b=0;b<l;++b)k.packFloatRGBA(.5-d[b]/g,a,4*b);return[a,c,e]}})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.evaluateValueOrFunction=
function(a,k,h,d){return"function"===typeof a?a(k,h,d):a};a.hashString=function(a){for(var k=0,h=0;h<a.length;h++)k=(k<<5)-k+a.charCodeAt(h),k|=0;return k};a.colorToArray=function(a){return[a.r,a.g,a.b,a.a]};a.resampleHermite=function(a,k,h,d,g,l,f){void 0===f&&(f=!0);var c=k/g;h/=l;for(var b=Math.ceil(c/2),e=Math.ceil(h/2),p=0;p<l;p++)for(var q=0;q<g;q++){for(var m=4*(q+(f?l-p-1:p)*g),w=0,u=0,v=0,n=0,t=0,x=0,z=0,A=(p+.5)*h,E=Math.floor(p*h);E<(p+1)*h;E++)for(var B=Math.abs(A-(E+.5))/e,G=(q+.5)*c,
B=B*B,F=Math.floor(q*c);F<(q+1)*c;F++){var K=Math.abs(G-(F+.5))/b,w=Math.sqrt(B+K*K);-1<=w&&1>=w&&(w=2*w*w*w-3*w*w+1,0<w&&(K=4*(F+E*k),z+=w*a[K+3],v+=w,255>a[K+3]&&(w=w*a[K+3]/250),n+=w*a[K],t+=w*a[K+1],x+=w*a[K+2],u+=w))}d[m]=n/u;d[m+1]=t/u;d[m+2]=x/u;d[m+3]=z/v}}})},"esri/views/2d/arcade/utils":function(){define("require exports ../../../core/tsSupport/assignHelper @dojo/framework/shim/WeakMap ../../../core/Error ../../../core/Logger ../../../geometry/support/quantizationUtils ../../../layers/graphics/featureConversionUtils".split(" "),
function(n,a,m,k,h,d,g,l){function f(b,a,d,f){var g=f.transform,l=f.hasZ;f=f.hasM;e.has(b)||e.set(b,c(d));b=e.get(b)(a.geometry,g,l,f);return m({},a,{geometry:b})}function c(a){var c={};switch(a){case "esriGeometryPoint":return function(b,a,d,e){return g.hydratePoint(a,c,b,d,e)};case "esriGeometryPolygon":return function(b,a,d,e){return g.hydratePolygon(a,c,b,d,e)};case "esriGeometryPolyline":return function(b,a,d,e){return g.hydratePolyline(a,c,b,d,e)};case "esriGeometryMultipoint":return function(b,
a,d,e){return g.hydrateMultipoint(a,c,b,d,e)};default:return b.error(new h("mapview-arcade","Unable to handle geometryType: "+a)),function(b,a,c,d){return b}}}Object.defineProperty(a,"__esModule",{value:!0});var b=d.getLogger("esri.views.2d.support.arcadeOnDemand");a.callWithOptimizedFeature=function(a,c,d,e,g){var h=e.geometryType,k=e.hasZ;e=e.hasM;c=a.referencesGeometry()?g?f(a,l.convertToFeature(c,h,k,e),h,g):l.convertToFeature(c,h,k,e):c;c=a.repurposeFeature(c);try{return a.evaluate(m({},d,{$feature:c}))}catch(t){return b.warn("Feature arcade evaluation failed:",
t),null}};a.callWithFeature=function(a,c,d,e,g){c=a.referencesGeometry()&&g?f(a,c,e,g):c;c=a.repurposeFeature(c);try{return a.evaluate(m({},d,{$feature:c}))}catch(v){return b.warn("Feature arcade evaluation failed:",v),null}};var e=new k.default;a.createHydrateFactory=c})},"esri/symbols/cim/Rasterizer":function(){define(["require","exports","./CIMSymbolHelper","./SDFHelper","./utils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){}a.prototype.dispose=
function(){this._rasterizationCanvas=null};a.prototype.rasterizeJSONResource=function(a,d){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type)return d=m.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style),{size:[d[1],d[2]],image:new Uint32Array(d[0].buffer),sdf:!1,simplePattern:!0};if("simple-line"===a.type||"esriSLS"===a.type)return d=m.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,a.style,
a.cap),{size:[d[1],d[2]],image:new Uint32Array(d[0].buffer),sdf:!0,simplePattern:!0};var f;a="simple-marker"===a.type||"esriSMS"===a.type?m.CIMSymbolHelper.fromSimpleMarker(a):a;if((f=k.getSDFInfo(a))&&!d)return d=k.buildSDF(f),(a=d[0])?{size:[d[1],d[2]],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0}:null;d=m.CIMSymbolHelper.rasterize(this._rasterizationCanvas,a,!d);return(a=d[0])?{size:[d[1],d[2]],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1}:null};a.prototype.rasterizeImageResource=
function(a,d){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var f=this._rasterizationCanvas.getContext("2d");f.drawImage(a,0,0,a.width,a.height);f=f.getImageData(0,0,a.width,a.height);f=new Uint8Array(f.data);if(d)for(var c=0;c<d.length;c++){var b=d[c];if(b&&b.oldColor&&4===b.oldColor.length&&b.newColor&&4===b.newColor.length){var e=b.oldColor,g=e[0],l=e[1],k=e[2],e=e[3],m=b.newColor,
b=m[0],u=m[1],v=m[2],n=m[3];if(g!==b||l!==u||k!==v||e!==n)for(m=0;m<f.length;m+=4)g===f[m]&&l===f[m+1]&&k===f[m+2]&&e===f[m+3]&&(f[m]=b,f[m+1]=u,f[m+2]=v,f[m+3]=n)}}for(m=0;m<f.length;m+=4)d=f[m+3]/255,f[m]*=d,f[m+1]*=d,f[m+2]*=d;d=a.width;c=a.height;g=f;if(512<=d||512<=c)g=a.width/a.height,1<g?(d=512,c=Math.round(512/g)):(c=512,d=Math.round(512*g)),g=new Uint8Array(4*d*c),h.resampleHermite(f,a.width,a.height,new Uint8ClampedArray(g.buffer),d,c,!1);return{size:[d,c],image:new Uint32Array(g.buffer),
sdf:!1,simplePattern:!1}};return a}();a.default=n})},"esri/symbols/cim/TextRasterizer":function(){define(["require","exports","../../core/screenUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){}a.prototype.rasterizeText=function(a,d){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));var f=this._textRasterizationCanvas,c=f.getContext("2d");this.setFontProperties(c,d);this.parameters=d;this.textLines=a.split(/\r?\n/);
this.lineHeight=this.computeLineHeight();a=this.computeTextWidth(c,d);var b=this.lineHeight*this.textLines.length;f.width=a;f.height=b;this.renderedLineHeight=Math.round(this.lineHeight*d.pixelRatio);this.renderedHaloSize=d.halo.size*d.pixelRatio;this.renderedWidth=a*d.pixelRatio;this.renderedHeight=b*d.pixelRatio;f=d.color;this.fillStyle="rgba("+f.slice(0,3).toString()+","+f[3]+")";this.haloStyle="rgb("+d.halo.color.slice(0,3).toString()+")";var f=this.renderedLineHeight,e=this.renderedHaloSize;
this.setFontProperties(c,d);a=c.textAlign;var b=this.renderedWidth,g=("center"===a?.5*b:"right"===a?b:0)+e,b=a=0;0<e&&this.renderHalo(c,g,e,a,b,d);b+=e;a+=g;e=0;for(g=this.textLines;e<g.length;e++){var l=g[e];c.globalCompositeOperation="destination-out";c.fillStyle="rgb(0, 0, 0)";c.fillText(l,a,b);c.globalCompositeOperation="source-over";c.fillStyle=this.fillStyle;c.fillText(l,a,b);b+=f}c=c.getImageData(0,0,this.renderedWidth,this.renderedHeight);c=new Uint8Array(c.data);if(d.premultiplyColors)for(d=
void 0,f=0;f<c.length;f+=4)d=c[f+3]/255,c[f]*=d,c[f+1]*=d,c[f+2]*=d;return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1}};a.prototype.renderHalo=function(a,d,f,c,b,e){var g=this.renderedWidth,l=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=g;this._haloRasterizationCanvas.height=l;var h=this._haloRasterizationCanvas,k=h.getContext("2d");
k.clearRect(0,0,g,l);this.setFontProperties(k,e);k.fillStyle=this.haloStyle;k.strokeStyle=this.haloStyle;e=3>this.renderedHaloSize;k.lineJoin=e?"miter":"round";e?this.renderHaloEmulated(k,d,f):this.renderHaloNative(k,d,f);a.globalAlpha=this.parameters.halo.color[3];a.drawImage(h,0,0,g,l,c,b,g,l);a.globalAlpha=1};a.prototype.renderHaloEmulated=function(a,d,f){for(var c=this.renderedLineHeight,b=this.renderedHaloSize,e=0,g=this.textLines;e<g.length;e++){for(var l=g[e],h=0,m=k;h<m.length;h++){var u=
m[h];a.fillText(l,d+b*u[0],f+b*u[1])}f+=c}};a.prototype.renderHaloNative=function(a,d,f){for(var c=this.renderedLineHeight,b=this.renderedHaloSize,e=0,g=this.textLines;e<g.length;e++){for(var l=g[e],h=2*b,k=0;5>k;k++)a.lineWidth=(.6+.1*k)*h,a.strokeText(l,d,f);f+=c}};a.prototype.setFontProperties=function(a,d){var f=d.font;d=f.style+" "+f.weight+" "+m.pt2px(d.size*d.pixelRatio)+"px "+f.family+", sans-serif";a.font=d;a.textAlign="left";a.textBaseline="top"};a.prototype.computeTextWidth=function(a,
d){for(var f=0,c=0,b=this.textLines;c<b.length;c++)f=Math.max(f,a.measureText(b[c]).width);d=d.font;if("italic"===d.style||"oblique"===d.style||"string"===typeof d.weight&&("bold"===d.weight||"bolder"===d.weight)||"number"===typeof d.weight&&600<d.weight)f+=.3*a.measureText("A").width;f+=2*this.parameters.halo.size;return Math.round(f)};a.prototype.computeLineHeight=function(){return Math.round(1.275*this.parameters.size+2*this.parameters.halo.size)};return a}();a.TextRasterizer=n;for(var k=[],h=
0;360>h;h+=22.5)k.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);a.default=n})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/compilerUtils ../../core/has ../../core/Logger ../../core/maybe ../../core/screenUtils ./gfxUtils ./Symbol3DMaterial".split(" "),function(n,a,m,k,h,d,g,l,f,c,b){function e(b,a){if(null==a)return b;b=b.toRgba();b[3]*=a;return new m(b)}function p(a,c,d){if(a=a.symbolLayers){var f=function(b){b=l.isSome(b)?b:null;
c=c||b||null!=d&&u;return e(c,d)};a.forEach(function(a){if("water"===a.type)a.color=f(a.color);else{var c=l.isSome(a.material)?a.material.color:null,c=f(c);l.isNone(a.material)?a.material=new b.default({color:c}):a.material.color=c;null!=d&&"outline"in a&&l.isSome(a.outline)&&l.isSome(a.outline.color)&&(a.outline.color=e(a.outline.color,d))}})}}function q(b,a,c){(b=b.symbolLayers)&&b.forEach(function(b){if(b)switch(b.type){case "icon":case "line":case "path":case "extrude":case "text":b.size=a;break;
case "object":switch(c){case "width":b.width=a;break;case "depth":b.depth=a;break;case "height":b.height=a;break;case "width-and-depth":b.width=a;b.depth=a;break;default:b.width=a,b.depth=a,b.height=a}break;default:r.warn("symbolUtils: applySizeToSymbol","symbolLayer not supported")}})}Object.defineProperty(a,"__esModule",{value:!0});var r=g.getLogger("esri.symbols.support.utils"),w=/\/resource\/(.*?)\.svg$/,u=new m("white");a.getSymbolOutlineSize=function(b){if(!b)return 0;if(k.isSymbol3D(b)){var a=
b.symbolLayers&&b.symbolLayers.length;a?(b=b.symbolLayers.getItemAt(a-1),b="outline"in b?l.get(b,"outline","size"):void 0):b=void 0;return l.isSome(b)?b:0}return(b=c.getStroke(b))&&f.px2pt(b.width)||0};a.isVolumetricSymbol=function(b){if(!b||!b.symbolLayers)return!1;switch(b.type){case "point-3d":return b.symbolLayers.some(function(b){return"object"===b.type});case "line-3d":return b.symbolLayers.some(function(b){return"path"===b.type});case "polygon-3d":return b.symbolLayers.some(function(b){return"object"===
b.type||"extrude"===b.type});default:return!1}};a.getIconHref=function(b,a){a=a.resource.href;return!d("esri-canvas-svg-support")&&b.styleOrigin&&w.test(a)?a.replace(w,"/resource/png/$1.png"):a};a.applyOpacityToColor=e;a.applyColorToSymbol=function(b,a,c){if(b&&(a||null!=c))if(a&&(a=new m(a)),k.isSymbol3D(b))p(b,a,c);else if(k.isSymbol2D(b)){if(a=a||b.color)b.color=e(a,c);null!=c&&"outline"in b&&b.outline&&b.outline.color&&(b.outline.color=e(b.outline.color,c))}};a.applySizeToSymbol=function(b,a,
c){if(b&&null!=a)if(k.isSymbol3D(b))q(b,a,c);else if(k.isSymbol2D(b))switch(b.type){case "simple-marker":b.size=a;break;case "picture-marker":c=b.width/b.height;1<c?(b.width=a,b.height=a*c):(b.width=a*c,b.height=a);break;case "simple-line":b.width=a;break;case "text":b.font.size=a;break;case "simple-fill":case "picture-fill":break;case "cim":break;default:h.neverReached(b)}};a.applyRotationToSymbol=function(b,a,c){b&&null!=a&&(k.isSymbol3D(b)?(b=b.symbolLayers)&&b.forEach(function(b){if(b&&"object"===
b.type)switch(c){case "tilt":b.tilt=a;break;case "roll":b.roll=a;break;default:b.heading=a}}):!k.isSymbol2D(b)||"simple-marker"!==b.type&&"picture-marker"!==b.type&&"text"!==b.type||(b.angle=a))}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils".split(" "),function(n,a,m,k,h,d,g,l){function f(b){if(!b)return null;var a;switch(b.type){case "simple-fill":case "picture-fill":case "simple-marker":a=
f(b.outline);break;case "simple-line":var c=l.pt2px(b.width);"none"!==b.style&&0!==c&&(a={color:b.color,style:q(b.style),width:c,cap:b.cap,join:"miter"===b.join?l.pt2px(b.miterLimit):b.join});break;default:a=null}return a}Object.defineProperty(a,"__esModule",{value:!0});var c=n.toUrl("../../symbols/patterns/"),b={left:"start",center:"middle",right:"end",justify:"start"},e={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},p=new d(1E3);a.getSVGAlign=function(a){return a=
(a=a.horizontalAlignment)&&b[a.toLowerCase()]||"middle"};a.getSVGBaseline=function(b){return(b=b.verticalAlignment)&&e[b.toLowerCase()]||"alphabetic"};a.getSVGBaselineShift=function(b){return"bottom"===b.verticalAlignment?"super":null};a.getFill=function(b){var a=b.style,d=null;if(b)switch(b.type){case "simple-marker":"cross"!==a&&"x"!==a&&(d=b.color);break;case "simple-fill":"solid"===a?d=b.color:"none"!==a&&(d={type:"pattern",x:0,y:0,src:c+a+".png",width:8,height:8});break;case "picture-fill":d=
{type:"pattern",src:b.url,width:l.pt2px(b.width)*b.xscale,height:l.pt2px(b.height)*b.yscale,x:l.pt2px(b.xoffset),y:l.pt2px(b.yoffset)};break;case "text":d=b.color}return d};a.getPatternUrlWithColor=function(b,a){var c=b+"-"+a;return void 0!==p.get(c)?g.resolve(p.get(c)):h(b,{responseType:"image"}).then(function(b){b=b.data;var d=b.naturalWidth,e=b.naturalHeight,f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.fillStyle=a;g.fillRect(0,0,d,e);g.globalCompositeOperation=
"destination-in";g.drawImage(b,0,0);b=f.toDataURL();p.put(c,b);return b})};a.getStroke=f;var q=function(){var b={};return function(a){if(b[a])return b[a];var c=a.replace(/-/g,"");return b[a]=c}}();a.defaultThematicColor=new k([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(n,a,m){return function(){function a(a,d){this._storage=new m.MemCacheStorage;this._storage.maxSize=a;d&&this._storage.registerRemoveFunc("",d)}a.prototype.put=function(a,d){this._storage.put(a,
d,1,1)};a.prototype.pop=function(a){return this._storage.pop(a)};a.prototype.get=function(a){return this._storage.get(a)};a.prototype.clear=function(){this._storage.clearAll()};a.prototype.destroy=function(){this._storage.clearAll()};return a}()})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec4f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.defaultIconElevationOffset=1;a.SUSPEND_RESUME_EXTENT_OPTIMISM=
1.2;a.WHITE=new Float32Array([1,1,1,1]);a.TRANSPARENT=m.vec4f64.ZEROS})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/ComponentUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){n=function(){function a(b,a,c){this.type="draped";this.isElevationSource=this._addedToStage=!1;this.graphics3DSymbolLayer=b;this.renderGeometries=a;this.boundingBox=c;this.stage=null;this._visible=!1}a.prototype.initialize=function(b,a){this.stage=a};a.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible!==a){this._visible=a;var c=this.stage.renderView.getDrapedRenderer();if(a&&!this._addedToStage)return this._addedToStage=!0,c.addRenderGeometries(this.renderGeometries),
!0;if(!a&&!this._addedToStage)return!1;for(var d=0,e=this.renderGeometries;d<e.length;d++){var f=e[d],g=f.instanceParameters.componentVisibilities,g=a?b.unhideAllComponents(g):b.hideAllComponents(g);f.instanceParameters.componentVisibilities=g}c.updateRenderGeometries(this.renderGeometries,1);return!0}return!1}};a.prototype.destroy=function(){this.stage&&this._addedToStage&&this.stage.renderView.getDrapedRenderer().removeRenderGeometries(this.renderGeometries);this._visible=this._addedToStage=!1;
this.stage=null};a.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(b,a){return Math.max(b,a.bsRadius)},0)};a.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=g.vec3f64.create());return d.vec3.set(b,0,0,0)};a.prototype.getBoundingBoxObjectSpace=function(b){void 0===b&&(b=l.create());return l.empty(b)};a.prototype.addHighlight=function(b,a){var c=this;this.renderGeometries.forEach(function(d){var e=d.addHighlight(a);b.addRenderGeometry(d,e,c)});this._addedToStage&&
this.stage.renderView.getDrapedRenderer().updateHighlights(this.renderGeometries)};a.prototype.removeHighlight=function(b){this.renderGeometries.forEach(function(a){b.removeRenderGeometry(a)})};a.prototype.removeRenderGeometryHighlight=function(b,a){b.removeHighlight(a);this._addedToStage&&this.stage.renderView.getDrapedRenderer().updateHighlights(this.renderGeometries)};a.prototype.getProjectedBoundingBox=function(b,a,d,f,g){return h(this,void 0,void 0,function(){var h,p,m,u;return k(this,function(k){switch(k.label){case 0:l.empty(g);
for(h=0;h<this.renderGeometries.length;h++)p=this.renderGeometries[h],this._getRenderGeometryProjectedBoundingRect(p,b,e,d),l.expand(g,e);if(!a)return[3,5];l.center(g,q);m=void 0;u=c.demResolutionForBoundingBox(g,a);k.label=1;case 1:return k.trys.push([1,3,,4]),[4,a.service.queryElevation(q[0],q[1],f,u)];case 2:return m=k.sent(),[3,4];case 3:return k.sent(),m=null,[3,4];case 4:null!=m&&(g[2]=Math.min(g[2],m),g[5]=Math.max(g[5],m)),k.label=5;case 5:return[2,g]}})})};a.prototype._getRenderGeometryProjectedBoundingRect=
function(b,a,c,d){if(this.boundingBox)l.set(p,this.boundingBox);else{var e=b.center;b=b.bsRadius;p[0]=e[0]-b;p[1]=e[1]-b;p[2]=e[2]-b;p[3]=e[0]+b;p[4]=e[1]+b;p[5]=e[2]+b}a(p,0,2);this.calculateRelativeScreenBounds&&d.push({location:l.center(p),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return l.toRect(p,c)};return a}();var e=f.create(),p=l.create(),q=[0,0,0];return n})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require","exports","../../webgl-engine/lib/Util"],
function(n,a,m){function k(a,g,l){l&&(g/=Math.SQRT2);for(var d=new Uint8Array(4*a*a),c=0;c<a;c++)for(var b=0;b<a;b++){var e=b-.5*a+.25,h=-c+.5*a-.75,k=c*a+b;if(l)var r=(e+h)/Math.SQRT2,h=(h-e)/Math.SQRT2,e=r;e=Math.max(Math.abs(e),Math.abs(h))-.5*g;e=e/a+.5;m.packFloatRGBA(e,d,4*k)}return d}function h(a,g,l){l&&(g*=Math.SQRT2);g*=.5;for(var d=new Uint8Array(4*a*a),c=0;c<a;c++)for(var b=0;b<a;b++){var e=b-.5*a,h=-c+.5*a-1,k=c*a+b;if(l)var r=(e+h)/Math.SQRT2,h=(h-e)/Math.SQRT2,e=r;r=void 0;e=Math.abs(e);
h=Math.abs(h);r=e>h?e>g?Math.sqrt((e-g)*(e-g)+h*h):h:h>g?Math.sqrt(e*e+(h-g)*(h-g)):e;r=r/a+.5;m.packFloatRGBA(r,d,4*k)}return d}Object.defineProperty(a,"__esModule",{value:!0});a.createCircle=function(a,g){var d=new Uint8Array(4*a*a),f=a/2-.5;g/=2;for(var c=0;c<a;c++)for(var b=0;b<a;b++){var e=b+a*c,h=b-f,k=c-f,h=Math.sqrt(h*h+k*k)-g,h=h/a+.5;m.packFloatRGBA(h,d,4*e)}return d};a.createSquare=function(a,g){return k(a,g,!1)};a.createKite=function(a,g){return k(a,g,!0)};a.createCross=function(a,g){return h(a,
g,!1)};a.createX=function(a,g){return h(a,g,!0)};a.createTriangle=function(a,g){for(var d=new Uint8Array(4*a*a),f=Math.sqrt(1.25),c=(a-g)/2,b=0;b<a;b++)for(var e=0;e<a;e++){var h=(e-c)/g,k=(b-c+.75)/g;m.packFloatRGBA(Math.max(-(1*h+-.5*k)/f,(1*(h-1)+-.5*-k)/f,-k)*g/a+.5,d,4*(b*a+e))}return d}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){function p(b){return null!==b&&void 0!==b}function q(b){return"number"===typeof b}function r(b){return"string"===typeof b}function w(b,a){b&&b.push(a)}function u(a,c,d,e,f){var g=a.minSize,l=a.maxSize;if(a.expression)return w(f,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=e.symbolSize[d],c.minSize[d]=a,c.maxSize[d]=a,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(p(a.field)){if(p(a.stops)){if(2===a.stops.length&&
q(a.stops[0].size)&&q(a.stops[1].size))return v(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,c,d),c.type[d]=1,!0;w(f,"Could not convert size info: stops only supported with 2 elements");return!1}if(q(g)&&q(l)&&p(a.minDataValue)&&p(a.maxDataValue))return v(g,l,a.minDataValue,a.maxDataValue,c,d),c.type[d]=1,!0;if(null!=b.meterIn[a.valueUnit])return c.minSize[d]=-Infinity,c.maxSize[d]=Infinity,c.offset[d]=0,c.factor[d]=1/b.meterIn[a.valueUnit],c.type[d]=1,!0;if("unknown"===a.valueUnit)return w(f,
"Could not convert size info: proportional size not supported"),!1;w(f,"Could not convert size info: scale-dependent size not supported");return!1}if(!p(a.field)){if(a.stops&&a.stops[0]&&q(a.stops[0].size))return c.minSize[d]=a.stops[0].size,c.maxSize[d]=a.stops[0].size,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(q(g))return c.minSize[d]=g,c.maxSize[d]=g,c.offset[d]=g,c.factor[d]=0,c.type[d]=1,!0}w(f,"Could not convert size info: unsupported variant of sizeInfo");return!1}function v(b,
a,c,d,e,f){d=0<Math.abs(d-c)?(a-b)/(d-c):0;e.minSize[f]=0<d?b:a;e.maxSize[f]=0<d?a:b;e.offset[f]=b-c*d;e.factor[f]=d}function y(b,a,c,d){if(b.normalizationField||b.valueRepresentation)return w(d,"Could not convert size info: unsupported property"),null;var e=b.field;if(null!=e&&!r(e))return w(d,"Could not convert size info: field is not a string"),null;if(!a.size)a.size={field:b.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(b.field)if(!a.size.field)a.size.field=
b.field;else if(b.field!==a.size.field)return w(d,"Could not convert size info: multiple fields in use"),null;switch(b.axis){case "width":return(e=u(b,a.size,0,c,d))?a:null;case "height":return(e=u(b,a.size,2,c,d))?a:null;case "depth":return(e=u(b,a.size,1,c,d))?a:null;case "width-and-depth":return(e=u(b,a.size,0,c,d))&&u(b,a.size,1,c,d),e?a:null;case null:case void 0:case "all":return(e=(e=(e=u(b,a.size,0,c,d))&&u(b,a.size,1,c,d))&&u(b,a.size,2,c,d))?a:null;default:return w(d,'Could not convert size info: unknown axis "'+
b.axis+'""'),null}}function t(b,a,c){for(var d=0;3>d;++d){var e=a.unitInMeters;1===b.type[d]&&(e*=a.modelSize[d],b.type[d]=2);b.minSize[d]/=e;b.maxSize[d]/=e;b.offset[d]/=e;b.factor[d]/=e}if(0!==b.type[0])a=0;else if(0!==b.type[1])a=1;else if(0!==b.type[2])a=2;else return w(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===b.type[d]&&(b.minSize[d]=b.minSize[a],b.maxSize[d]=b.maxSize[a],b.offset[d]=b.offset[a],b.factor[d]=b.factor[a],b.type[d]=b.type[a]);return!0}function x(b,
a,c){b[4*a+0]=c.r/255;b[4*a+1]=c.g/255;b[4*a+2]=c.b/255;b[4*a+3]=c.a}function z(b,a,c){if(b.normalizationField)return w(c,"Could not convert color info: unsupported property"),null;if(r(b.field))if(b.stops){if(8<b.stops.length)return w(c,"Could not convert color info: too many color stops"),null;a.color={field:b.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=b.stops;for(b=0;8>b;++b){var d=c[Math.min(b,c.length-1)];a.color.values[b]=d.value;
x(a.color.colors,b,d.color)}}else return w(c,"Could not convert color info: missing stops or colors"),null;else if(b.stops&&0<=b.stops.length)for(c=b.stops&&0<=b.stops.length&&b.stops[0].color,a.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},b=0;8>b;b++)a.color.values[b]=Infinity,x(a.color.colors,b,c);else return w(c,"Could not convert color info: no field and no colors/stops"),null;return a}function A(b,a,c){if(b.normalizationField)return w(c,
"Could not convert opacity info: unsupported property"),null;if(r(b.field))if(b.stops){if(8<b.stops.length)return w(c,"Could not convert opacity info: too many opacity stops"),null;a.opacity={field:b.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=b.stops;for(b=0;8>b;++b){var d=c[Math.min(b,c.length-1)];a.opacity.values[b]=d.value;a.opacity.opacityValues[b]=d.opacity}}else return w(c,"Could not convert opacity info: missing stops or opacities"),null;else if(b.stops&&0<=b.stops.length)for(c=
b.stops&&0<=b.stops.length&&b.stops[0].opacity,a.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},b=0;8>b;b++)a.opacity.values[b]=Infinity,a.opacity.opacityValues[b]=c;else return w(c,"Could not convert opacity info: no field and no opacities/stops"),null;return a}function E(b,a,c,d){b=2===c&&"arithmetic"===b.rotationType;a.offset[c]=b?90:0;a.factor[c]=b?-1:1;a.type[c]=1}function B(b,a,c){if(!r(b.field))return w(c,"Could not convert rotation info: field is not a string"),
null;if(!a.rotation)a.rotation={field:b.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(b.field)if(!a.rotation.field)a.rotation.field=b.field;else if(b.field!==a.rotation.field)return w(c,"Could not convert rotation info: multiple fields in use"),null;switch(b.axis){case "tilt":return E(b,a.rotation,0,c),a;case "roll":return E(b,a.rotation,1,c),a;case null:case void 0:case "heading":return E(b,a.rotation,2,c),a;default:return w(c,'Could not convert rotation info: unknown axis "'+b.axis+
'""'),null}}function G(b,a,c){if(!b)return null;var d=!a.supportedTypes||!!a.supportedTypes.size,e=!a.supportedTypes||!!a.supportedTypes.color,f=!a.supportedTypes||!!a.supportedTypes.rotation,g=!!a.supportedTypes&&!!a.supportedTypes.opacity,l=b.reduce(function(b,l){if(!b)return b;if(l.valueExpression)return w(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case "size":return d?y(l,b,a,c):b;case "color":return e?z(l,b,c):b;case "opacity":return g?A(l,b,
c):null;case "rotation":return f?B(l,b,c):b;default:return m.neverReached(l),null}},{size:null,color:null,opacity:null,rotation:null});return 0<b.length&&l&&!l.size&&!l.color&&!l.opacity&&!l.rotation||l&&l.size&&!t(l.size,a,c)?null:l}function F(b,a,c){if(!!b!==!!a||b&&b.field!==a.field)return!1;if(b&&"rotation"===c)for(c=0;3>c;c++)if(b.type[c]!==a.type[c]||b.offset[c]!==a.offset[c]||b.factor[c]!==a.factor[c])return!1;return!0}function K(b,a){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},e=b&&null!=b.size;b&&b.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=b.size.minSize,c.vvSizeMaxSize=b.size.maxSize,c.vvSizeOffset=b.size.offset,c.vvSizeFactor=b.size.factor):b&&e&&(c.vvSizeValue=a.transformation.scale);if(b&&e){c.vvSymbolAnchor=a.transformation.anchor;c.vvSymbolRotationMatrix=
d.mat3f64.create();g.mat4.identity(N);var f=a.transformation.rotation[2],e=a.transformation.rotation[0],k=a.transformation.rotation[1];a=N;void 0===a&&(a=l.mat4f64.create());f=f||0;e=e||0;k=k||0;0!==f&&g.mat4.rotateZ(a,a,-f/180*Math.PI);0!==e&&g.mat4.rotateX(a,a,e/180*Math.PI);0!==k&&g.mat4.rotateY(a,a,k/180*Math.PI);h.mat3.fromMat4(c.vvSymbolRotationMatrix,N)}b&&b.color&&(c.vvColorEnabled=!0,c.vvColorValues=b.color.values,c.vvColorColors=b.color.colors);b&&b.opacity&&(c.vvOpacityEnabled=!0,c.vvOpacityValues=
b.opacity.values,c.vvOpacityOpacities=b.opacity.opacityValues);return c}Object.defineProperty(a,"__esModule",{value:!0});a.convertVisualVariables=G;a.initFastSymbolUpdatesState=function(b,a){return!b||e.DISABLE_FAST_UPDATES?{enabled:!1}:(b=G(b.visualVariables,a))?{enabled:!0,visualVariables:b,materialParameters:K(b,a),requiresShaderTransformation:b&&null!=b.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(b,a,c){if(!a||!b.enabled)return!1;var d=b.visualVariables;a=G(a.visualVariables,c);
if(!(a&&F(d.size,a.size,"size")&&F(d.color,a.color,"color")&&F(d.rotation,a.rotation,"rotation")&&F(d.opacity,a.opacity,"opacity")))return!1;b.visualVariables=a;b.materialParameters=K(a,c);b.requiresShaderTransformation=a&&null!=a.size;return!0};a.getMaterialParams=K;var H;(function(b){var a=l.mat4f64.create(),d=c.vec3f64.create();b.evaluateModelTransform=function(b,c,e){if(!b.vvSizeEnabled)return e;g.mat4.copy(a,e);e=b.vvSymbolRotationMatrix;g.mat4.set(N,e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],
e[8],0,0,0,0,1);g.mat4.multiply(a,a,N);for(e=0;3>e;++e)d[e]=k.clamp(b.vvSizeOffset[e]+c[0]*b.vvSizeFactor[e],b.vvSizeMinSize[e],b.vvSizeMaxSize[e]);g.mat4.scale(a,a,d);g.mat4.translate(a,a,b.vvSymbolAnchor);return a};b.evaluateModelTransformScale=function(b,a,c){if(!a.vvSizeEnabled)return f.vec3.set(b,1,1,1);for(var d=0;3>d;++d)b[d]=k.clamp(a.vvSizeOffset[d]+c[0]*a.vvSizeFactor[d],a.vvSizeMinSize[d],a.vvSizeMaxSize[d]);return b}})(H||(H={}));var N=l.mat4f64.create();a.evaluateModelTransform=H.evaluateModelTransform;
a.evaluateModelTransformScale=H.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./HighlightUtils".split(" "),function(n,a,m,k,h,d,g,l,f){return function(){function a(b,a,c,f,g,l,h,k,m,t,n){this.shaderTransformationDirty=!0;this.data=
b.toRenderData();this.componentOffsets=b.componentOffsets;this.boundingInfo=a;this.material=c;this.origin=null;this.center=d.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=g;f&&this.updateTransformation(f,l);this.castShadow=h;this.singleUse=k;this.name=m;this.uniqueName=t;this.idx=n;this.instanceParameters={}}a.prototype.updateTransformation=function(b,a){this.transformation=b;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(b,a,
this.center)};a.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};a.prototype.getBoundingSphere=function(b,a,c){a=a||g.maxScale(b);h.vec3.transformMat4(c,this.boundingInfo.getCenter(),b);return this.boundingInfo.getBSRadius()*a};Object.defineProperty(a.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"componentCount",{get:function(){return l.componentCount(this.componentOffsets)},
enumerable:!0,configurable:!0});a.prototype.getShaderTransformation=function(){if(!this.calculateShaderTransformation)return this.transformation;this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=k.mat4f64.create()),m.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1);return this.shaderTransformation};a.prototype.getIndices=function(b){return"indices"in this.data?this.data.indices[b]:null};
a.prototype.getAttribute=function(b){return"vertexAttr"in this.data?this.data.vertexAttr[b]:null};a.prototype.addHighlight=function(b){var a=f.generateHighlightId(),c=this.instanceParameters;c.componentHighlights=l.addHighlight(c.componentHighlights,null,b,a);return a};a.prototype.removeHighlight=function(b){var a=this.instanceParameters;a.componentHighlights=l.removeHighlight(a.componentHighlights,b)};return a}()})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/mathUtils ../../../../core/typedArrayUtil ../../support/imageUtils ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){var t=k.getLogger("esri.views.3d.webgl-engine.lib.Texture");n=function(){function a(b,c,d){this.data=b;this.id=a.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=
a.estimateTexMemRequired(this.data,this.params)}a.estimateTexMemRequired=function(b,a){return null==b?0:g.isArrayBuffer(b)||g.isUint8Array(b)?b.byteLength:b instanceof Image||b instanceof ImageData||b instanceof HTMLCanvasElement?(a.mipmap?4/3:1)*b.width*b.height*(a.components||4):(a.mipmap?4/3:1)*a.width*a.height*(a.components||4)||0};a.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired};a.prototype.dispose=function(){this.data=void 0};a.prototype.deferredLoading=
function(){return"string"===typeof this.data};a.prototype.getWidth=function(){return this.params.width};a.prototype.getHeight=function(){return this.params.height};a.prototype.initializeThroughUpload=function(b,c,d,e,l){var h=this.data;c.flipped=!this.params.noUnpackFlip;c.samplingMode=this.params.mipmap?9987:9729;c.hasMipmap=this.params.mipmap;c.wrapMode=this.params.wrap;c.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof h)this.loadTextureFromUri(b,h,c,d,e,l);else if(h instanceof
Image||h instanceof ImageData||h instanceof HTMLCanvasElement)this.loadTextureFromImageData(b,h,c,d,e,l);else{if(g.isArrayBuffer(h)&&this.params.encoding===a.DDS_ENCODING)c=f.createDDSTexture(b,c,h,this.params.mipmap);else if(g.isUint8Array(h)&&this.params.encoding===a.DDS_ENCODING)c=f.createDDSTexture(b,c,h.buffer,this.params.mipmap);else if(g.isUint8Array(h))p.assert(0<this.params.width&&0<this.params.height),c.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,c.width=
this.params.width,c.height=this.params.height,c=new u(b,c,h);else{if(null!==h)throw console.warn("Unsupported image data"),Error("Unsupported image data");c=new u(b,c,null)}b.bindTexture(c);l(c)}this.data=void 0};a.prototype.loadTextureFromImageData=function(b,a,c,e,f,g){this.params.width=a.width;this.params.height=a.height;c.pixelFormat=3===this.params.components?6407:6408;var l=33071===this.params.wrap.s&&33071===this.params.wrap.t;y.default(b.gl)||!this.params.mipmap&&l||d.isPowerOfTwo(a.width)&&
d.isPowerOfTwo(a.height)?(c.width=a.width,c.height=a.height,a=new u(b,c,a)):a=this.makePowerOfTwoTexture(b,a,c,e,f);b.bindTexture(a);g(a)};a.prototype.loadTextureFromUri=function(b,a,c,e,f,g){var h=this,k=!1!==this.params.mipmap;l.requestImage(a).then(function(a){p.assert(1<=a.width&&1<=a.height);c.samplingMode=k?9987:9729;c.hasMipmap=k;!k&&33071===c.wrapMode||d.isPowerOfTwo(a.width)&&d.isPowerOfTwo(a.height)?(c.width=a.width,c.height=a.height,a=new u(b,c,a)):a=h.makePowerOfTwoTexture(b,a,c,e,f);
b.bindTexture(a);g(a)}).catch(function(b){var c=200<a.length?a.slice(0,100)+"..."+a.slice(a.length-100):a;t.error("Failed to load image from uri",c,b);g(null)})};a.prototype.makePowerOfTwoTexture=function(b,a,c,d,e){var f=a.width,g=a.height,l=h.nextHighestPowerOfTwo(f),k=h.nextHighestPowerOfTwo(g);c.width=l;c.height=k;var p;switch(this.params.powerOfTwoResizeMode){case 2:c.textureCoordinateScaleFactor=[f/l,g/k];p=new u(b,c);p.updateData(0,0,0,f,g,a);break;case 1:case null:case void 0:p=this.stretchToPowerOfTwo(b,
a,c,d,e);break;default:m.neverReached(this.params.powerOfTwoResizeMode)}c.hasMipmap&&p.generateMipmap();return p};a.prototype.stretchToPowerOfTwo=function(a,d,e,f,g){var l=new u(a,e),h=r.createWithAttachments(a,l,{colorTarget:0,depthStencilTarget:0});d=new u(a,{target:3553,pixelFormat:e.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!e.flipped,maxAnisotropy:8,preMultiplyAlpha:e.preMultiplyAlpha},d);a.bindFramebuffer(h);void 0===g&&(g=a.getViewport(),g=[g.x,g.y,g.width,g.height]);
a.setViewport(0,0,e.width,e.height);e=f.getProgram(q.texOnly);a.bindProgram(e);e.setUniform4f("color",1,1,1,1);e.setUniform1i("tex",0);e=b.createQuadVAO(a,c.Pos3Tex);a.bindTexture(d,0);a.bindVAO(e);a.setPipelineState(x);a.drawArrays(5,0,v.vertexCount(e,"geometry"));a.bindFramebuffer(null);a.setViewport(g[0],g[1],g[2],g[3]);e.dispose(!0);d.dispose();a.bindFramebuffer(null);h.detachColorTexture();h.dispose();return l};a.prototype.setUnloadFunc=function(b){this.unloadFunc=b};a.prototype.unload=function(){void 0!==
this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};a.createEmpty=function(b){void 0===b&&(b="emptyTexture");return new a(new Uint8Array([0,0,0,0]),b,{width:1,height:1,wrap:{s:33071,t:33071}})};a.idGen=new e.IdGen;a.DDS_ENCODING="image/vnd-ms.dds";return a}();var x=w.makePipelineState({colorWrite:w.defaultColorWriteParams});return n})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],
function(n,a,m,k,h){function d(b){return b.charCodeAt(0)+(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24)}Object.defineProperty(a,"__esModule",{value:!0});var g=m.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),l=d("DXT1"),f=d("DXT3"),c=d("DXT5");a.createDDSTexture=function(b,a,d,m){var e=new Int32Array(d,0,31);if(542327876!==e[0])return g.error("Invalid magic number in DDS header"),null;if(!(e[20]&4))return g.error("Unsupported format, must contain a FourCC code"),null;var p=
e[21],q;switch(p){case l:p=8;q=33776;break;case f:p=16;q=33778;break;case c:p=16;q=33779;break;default:return g.error("Unsupported FourCC code:",String.fromCharCode(p&255,p>>8&255,p>>16&255,p>>24&255)),null}var n=1,y=e[4],t=e[3];if(0!==(y&3)||0!==(t&3))g.warn("Rounding up compressed texture size to nearest multiple of 4."),y=y+3&-4,t=t+3&-4;a.width=y;a.height=t;e[2]&131072&&!1!==m&&(n=Math.max(1,e[7]));1===n||k.isPowerOfTwo(y)&&k.isPowerOfTwo(t)||(g.warn("Ignoring mipmaps of non power of two sized compressed texture."),
n=1);for(var x=e[1]+4,z=[],A=0;A<n;++A)e=(y+3>>2)*(t+3>>2)*p,m=new Uint8Array(d,x,e),z.push(m),x+=e,y=Math.max(1,y>>1),t=Math.max(1,t>>1);a.samplingMode=1<n?9987:9729;a.hasMipmap=1<n;a.internalFormat=q;a=new h(b,a,{type:"compressed",levels:z});b.bindTexture(a);return a}})},"esri/views/3d/webgl-engine/shaders/MiscPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.blendLayers=
{name:"blend-layers",shaders:{vertexShader:k.resolveIncludes("misc/blendLayers.vert"),fragmentShader:k.resolveIncludes("misc/blendLayers.frag")},attributes:m.Default3D};a.texOnly={name:"tex-only",shaders:{vertexShader:k.resolveIncludes("misc/texOnly.vert"),fragmentShader:k.resolveIncludes("misc/texOnly.frag")},attributes:m.Default3D}})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],function(n,a,m,k,h){return function(){function a(d,
l,f,c){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=d;this._desc={colorTarget:l.colorTarget,depthStencilTarget:l.depthStencilTarget,width:l.width,height:l.height,multisampled:l.multisampled};this._id=a._nextId++;m("esri-webgl-debug")&&d.instanceCounter.incrementCount(4);f&&(d=void 0,f instanceof h?(this._colorAttachment=f,d=f.descriptor):(d=f,this._colorAttachment=new h(this._context,d)),0!==this._desc.colorTarget&&
console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(d,this._desc));c instanceof k?(2===l.depthStencilTarget?this._stencilAttachment=c:1===l.depthStencilTarget||3===l.depthStencilTarget?this._depthAttachment=c:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),a._validateBufferDimensions(c.descriptor,
this._desc)):c&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),l=void 0,c instanceof h?(this._depthStencilTexture=c,l=this._depthStencilTexture.descriptor):(l=c,this._depthStencilTexture=new h(this._context,l)),a._validateTextureDimensions(l,this._desc))}a.create=function(d,l){return new a(d,l)};a.createWithAttachments=function(d,l,f,c){return new a(d,f,l,c)};Object.defineProperty(a.prototype,
"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof h?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorAttachment",
{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){if(this._context){var a=this._context,d=a.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(a.gl.deleteFramebuffer(this._glName),this._glName=null);m("esri-webgl-debug")&&a.instanceCounter.decrementCount(4);a.bindFramebuffer(d);this._context=null}};a.prototype.attachColorTexture=
function(d){if(d){a._validateTextureDimensions(d.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var g=this._context.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,d.glName,0)}this._colorAttachment=d}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof h){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;this._context.gl.framebufferTexture2D(d.FRAMEBUFFER,
d.COLOR_ATTACHMENT0,d.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(d){if(d){var g=d.descriptor;34041!==g.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==g.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
a._validateTextureDimensions(g,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),g=this._context.gl,g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.TEXTURE_2D,d.glName,0));this._depthStencilTexture=d}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;
this._context.gl.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.attachDepthStencilBuffer=function(d){if(d){var g=d.descriptor;34041!==g.internalFormat&&33189!==g.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");a._validateBufferDimensions(g,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===g.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),
g=this._context.gl,g.framebufferRenderbuffer(g.FRAMEBUFFER,1===this._desc.depthStencilTarget?g.DEPTH_ATTACHMENT:g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,d.glName));this._depthAttachment=d}};a.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,d=this._depthAttachment;d&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=
null;return d};a.prototype.copyToTexture=function(a,d,f,c,b,e,h){(0>a||0>d||0>b||0>e)&&console.error("Offsets cannot be negative!");(0>=f||0>=c)&&console.error("Copy width and height must be greater than zero!");var g=this._desc,l=h.descriptor;3553!==h.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+f>g.width||d+c>g.height||b+f>l.width||e+c>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");g=this._context;g.bindTexture(h);
g.bindFramebuffer(this);g.gl.copyTexSubImage2D(3553,0,b,e,a,d,f,c)};a.prototype.readPixels=function(a,d,f,c,b,e,h){(0>=f||0>=c)&&console.error("Copy width and height must be greater than zero!");h||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,d,f,c,b,e,h)};a.prototype.resize=function(d,l){var f=this._desc;if(f.width!==d||f.height!==l)if(this._initialized)f.width=d,f.height=l,this._colorAttachment instanceof h?(c=this._colorAttachment,
f=c.descriptor,f.width=d,f.height=l,this._colorAttachment.dispose(),this._colorAttachment=new h(this._context,f),a._validateTextureDimensions(c.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(f=this._depthStencilTexture.descriptor,f.width=d,f.height=l,this._depthStencilTexture.dispose(),this._depthStencilTexture=new h(this._context,f)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null),this._initialized=!1;else{f.width=d;f.height=l;if(this._colorAttachment instanceof h){var c=this._colorAttachment;c.resize(d,l)}this._depthStencilTexture&&this._depthStencilTexture.resize(d,l)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var d=a.createFramebuffer(),f=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,d);if(!this._colorAttachment)if(0===f.colorTarget)this._colorAttachment=
new h(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:f.width,height:f.height});else{var c=new k(this._context,{internalFormat:32854,width:f.width,height:f.height});a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,c.glName);this._colorAttachment=c}this._colorAttachment instanceof h&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(f.depthStencilTarget){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new k(this._context,{internalFormat:1===f.depthStencilTarget?33189:34041,width:f.width,height:f.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,1===f.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new k(this._context,{internalFormat:36168,width:f.width,height:f.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);
break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new h(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:f.width,height:f.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==
a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=d;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof h){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,d=this._context.gl,this._initialized&&
(this._context.bindFramebuffer(this),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=
function(a,d){console.assert(0<=a.width&&0<=a.height);void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===a.width&&d.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(d.width=a.width,d.height=a.height)};a._validateTextureDimensions=function(a,d){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===a.width&&d.height===
a.height||console.error("Color attachment texture must match the framebuffer's!"):(d.width=a.width,d.height=a.height)};a._nextId=0;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(n,a,m){return function(){function a(h,d){this._context=h;this._desc=d;this._glName=null;this._id=-1;h=this._context.gl;m("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5);this._id=++a._nextId;this._glName=h.createRenderbuffer();this._context.bindRenderbuffer(this);
h.renderbufferStorage(h.RENDERBUFFER,d.internalFormat,d.width,d.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,d){var g=this._context.gl,l=this._desc;if(l.width!==a||l.height!==d)l.width=
a,l.height=d,this._context.bindRenderbuffer(this),g.renderbufferStorage(g.RENDERBUFFER,l.internalFormat,l.width,l.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(5);this._context=null};a._nextId=0;return a}()})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});
a.default=function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/shaders/RibbonLinePrograms".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function n(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._lineWidthLOD=1;return b}m(n,a);n.prototype.doLoad=function(){return h(this,void 0,void 0,function(){var b,a,e,l;return k(this,function(h){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,
rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?E.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};b=this._getCombinedOpacityAndColor(f.get(this.symbolLayer,"material","color"));a=b[3];e={width:1,color:b,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>a||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};
if(this._isPropertyDriven("size"))this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(e.width=c.pt2px(1));else{l=null!=this.symbolLayer.size?this.symbolLayer.size:c.px2pt(1);if(0>l)throw new d("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");e.width=c.pt2px(l);"round"===e.join&&(this._lineWidthLOD=1.863798+-2.0062872/Math.pow(1+l/18.2313,.8856294))}this._fastUpdates&&this._fastUpdates.visualVariables&&g.mixin(e,this._fastUpdates.materialParameters,
{});this._material=new K(e,this._getIdHint("_ribbonlinemat"));this._context.stage.add(3,this._material);return[2]})})};n.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};n.prototype.getDrivenSize=function(b){var a=new Float32Array(1);this._isPropertyDriven("size")&&b.size?a[0]=c.pt2px(u.getDriverAxisSizeValue(b.size)):a[0]=1;return a};n.prototype.getSizeFeatureAttribute=function(b){var a=new Float32Array(1);
a[0]=z.getAttributeValue(this._fastUpdates.visualVariables.size.field,b);return a};n.prototype.getDrivenColor=function(b,a){a=r.vec4f32.fromValues(1,1,1,1);this._isPropertyDriven("color")&&b.color&&(a[0]=b.color[0],a[1]=b.color[1],a[2]=b.color[2],0<b.color.length&&(a[3]=b.color[3]));this._isPropertyDriven("opacity")&&b.opacity&&(a[3]=b.opacity);return a};n.prototype.getColorFeatureAttribute=function(b){var a=new Float32Array(1);a[0]=z.getAttributeValue(this._fastUpdates.visualVariables.color.field,
b);return a};n.prototype.getOpacityFeatureAttribute=function(b){var a=new Float32Array(1);a[0]=z.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,b);return a};n.prototype.createGraphics3DGraphic=function(b){var a=b.graphic,c=a.geometry;if(!this._validateGeometryType(a.geometry,n.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c))return null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,e=this.getGraphicElevationContext(a);return"on-the-ground"===
e.mode?this._createAsOverlay(b,c,e,d,this._context.layer.uid):this._createAs3DShape(b,c,e,d,a.uid)};n.prototype.applyRendererDiff=function(b,a){for(var c in b.diff)switch(c){case "visualVariables":if(E.updateFastSymbolUpdatesState(this._fastUpdates,a,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};n.prototype.layerOpacityChanged=function(){var b=this._material.getParameters().color,a=f.get(this.symbolLayer,
"material","color"),a=this._getCombinedOpacity(a),c=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({color:[b[0],b[1],b[2],a],transparent:c});return!0};n.prototype.layerElevationInfoChanged=function(b,a,c){var d=this._elevationContext.mode;c=x.elevationModeChangeUpdateType(n.elevationModeChangeTypes,c,d);if(c!==x.SymbolUpdateType.UPDATE)return c;var e=x.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(b,a,function(){return e})};n.prototype.slicePlaneEnabledChanged=
function(b,a){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};n.prototype.physicalBasedRenderingChanged=function(b,a){return!0};n.prototype.pixelRatioChanged=function(b,a){return!0};n.prototype._createAs3DShape=function(a,c,d,f,g){var l=x.getGeometryAsPoly(a.graphic.geometry),h=l[c],k=[],p=[],m=[],u=q.vec3f64.create(),r=Array(6),l=x.getGeometryVertexData3D(h,l.hasZ,l.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,d);this._logGeometryCreationWarnings(l,h,c,"LineSymbol3DLayer");if(0<h.length){for(var h=l.geometryData.outlines,w=l.eleVertexData,n=l.vertexData,y=0;y<h.length;++y){var z=h[y];if(!(1>=z.count)){var A=z.index,J=z.count;if(this._context.clippingExtent&&(x.computeBoundingBox(w,A,J,r),x.boundingBoxClipped(r,this._context.clippingExtent)))continue;x.applyOrigin(n,A,J,u);z=new Float64Array(w.buffer,3*A*w.BYTES_PER_ELEMENT,3*J);A=new Float64Array(n.buffer,3*A*n.BYTES_PER_ELEMENT,
3*J);A=this._createGeometryData(a,A,z,"rings"===c);A=new B(A,f+"path"+y);A.singleUse=!0;k.push(A);p.push(this._material);A=e.mat4f64.create();b.mat4.translate(A,A,u);m.push(A)}}if(0<k.length)return a=new G({geometries:k,materials:p,transformations:m,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:g},idHint:f}),k=new t(this,a,k,null,null,v.perVertexElevationAligner,d),k.alignedTerrainElevation=l.terrainElevation,k.needsElevationUpdates=x.needsElevationUpdates2D(d.mode),k}return null};
n.prototype._createGeometryData=function(b,a,c,d){a=A.createPolylineGeometryData(a,c,d);if("round"===this._material.getParameters().join){c=a.vertexAttributes[H.VertexAttrConstants.POSITION].data;d=c.length/3;var e=new Float32Array(d),f=N,g=I;p.vec3.set(f,0,0,0);for(var h=0;h<d-1;++h){var k=h+1;p.vec3.set(g,c[3*k+0]-c[3*h+0],c[3*k+1]-c[3*h+1],c[3*k+2]-c[3*h+2]);p.vec3.normalize(g,g);k=1*(Math.PI-l.acosClamped(p.vec3.dot(f,g)))*J*this._lineWidthLOD;e[h]=Math.max(Math.floor(k),0);p.vec3.scale(f,g,-1)}a.vertexAttributes[H.VertexAttrConstants.SUBDIVISIONS]=
{size:1,data:e,offsetIdx:0,strideIdx:1};a.indices[H.VertexAttrConstants.SUBDIVISIONS]=a.indices[H.VertexAttrConstants.POSITION]}c=new Uint32Array(a.vertexAttributes[H.VertexAttrConstants.POSITION].data.length);a.indices[H.VertexAttrConstants.SIZE]=c;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(a.vertexAttributes[H.VertexAttrConstants.SIZEFEATUREATTRIBUTE]={size:1,data:this.getSizeFeatureAttribute(b.graphic),offsetIdx:0,strideIdx:1},a.indices[H.VertexAttrConstants.SIZEFEATUREATTRIBUTE]=
c):(a.vertexAttributes[H.VertexAttrConstants.SIZE]={size:1,data:this.getDrivenSize(b.renderingInfo),offsetIdx:0,strideIdx:1},a.indices[H.VertexAttrConstants.SIZE]=c);this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?(a.vertexAttributes[H.VertexAttrConstants.COLORFEATUREATTRIBUTE]={size:1,data:this.getColorFeatureAttribute(b.graphic),offsetIdx:0,strideIdx:1},a.indices[H.VertexAttrConstants.COLORFEATUREATTRIBUTE]=c):(a.vertexAttributes[H.VertexAttrConstants.COLOR]={size:4,data:this.getDrivenColor(b.renderingInfo,
b.graphic),offsetIdx:0,strideIdx:4},a.indices[H.VertexAttrConstants.COLOR]=c);this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity&&(a.vertexAttributes[H.VertexAttrConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:this.getOpacityFeatureAttribute(b.graphic),offsetIdx:0,strideIdx:1},a.indices[H.VertexAttrConstants.OPACITYFEATUREATTRIBUTE]=c);return a};n.prototype._createAsOverlay=function(a,c,d,f,g){d=a.graphic;var l=x.getGeometryAsPoly(d.geometry),h=l[c];this._material.renderPriority=
this._symbolLayerOrder;var k=[],p=Array(6),m=w.empty(),u=q.vec3f64.create(),l=x.getGeometryVertexDataDraped(h,l.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(l,h,c,"LineSymbol3DLayer");if(0<h.length){for(var h=l.vertexData,l=l.geometryData.outlines,r=0;r<l.length;++r){var t=l[r],n=t.index,t=t.count;x.computeBoundingBox(h,n,t,p);if(!x.boundingBoxClipped(p,this._context.clippingExtent)){w.expand(m,p);x.applyOrigin(h,n,t,u);x.setZ(h,n,t,this._getDrapedZ());t=new Float64Array(h.buffer,
3*n*h.BYTES_PER_ELEMENT,3*t);n=e.mat4f64.create();b.mat4.translate(n,n,u);var t=this._createGeometryData(a,t,null,"rings"===c),v=new F(t);v.data.layerUid=g;v.data.graphicUid=d.uid;v.material=this._material;v.center=[.5*(p[0]+p[3]),.5*(p[1]+p[4]),0];v.bsRadius=.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]));v.transformation=n;v.name=f;v.uniqueName=f+"#"+t.id;k.push(v)}}return new y(this,k,m)}return null};n.validGeometryTypes=["polyline","polygon","extent"];n.elevationModeChangeTypes=
{definedChanged:x.SymbolUpdateType.RECREATE,staysOnTheGround:x.SymbolUpdateType.NONE,onTheGroundChanged:x.SymbolUpdateType.RECREATE};return n}(z.Graphics3DSymbolLayer);a.Graphics3DLineSymbolLayer=n;var N=q.vec3f64.create(),I=q.vec3f64.create(),J=4/Math.PI;a.default=n})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.vec4f32=m})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require",
"exports"],function(n,a){function m(){return new Float32Array(4)}function k(a,b,d,f){var c=new Float32Array(4);c[0]=a;c[1]=b;c[2]=d;c[3]=f;return c}function h(){return k(1,1,1,1)}function d(){return k(1,0,0,0)}function g(){return k(0,1,0,0)}function l(){return k(0,0,1,0)}function f(){return k(0,0,0,1)}Object.defineProperty(a,"__esModule",{value:!0});a.create=m;a.clone=function(a){var b=new Float32Array(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.fromValues=k;a.createView=function(a,b){return new Float32Array(a,
b,4)};a.zeros=function(){return m()};a.ones=h;a.unitX=d;a.unitY=g;a.unitZ=l;a.unitW=f;a.ZEROS=m();a.ONES=h();a.UNIT_X=d();a.UNIT_Y=g();a.UNIT_Z=l();a.UNIT_W=f()})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["require","exports","../../webgl-engine/lib/GeometryData","../../webgl-engine/lib/Util"],function(n,a,m,k){function h(a){var d=a.length;return a[0]===a[d-3]&&a[1]===a[d-2]&&a[2]===a[d-1]}function d(a,d,c){var b,e;if(c=c&&!h(a)){c=new Float32Array(a.length+3);for(e=0;e<a.length;e++)c[e]=
a[e];e=c.length;c[e-3]=a[0];c[e-2]=a[1];c[e-1]=a[2];b=a.length/3+1;e=new Uint32Array(2*(b-1))}else b=a.length/3,e=new Uint32Array(2*(b-1)),c=a;for(var f=a=0;f<b-1;f++)e[a++]=f,e[a++]=f+1;a={};b={};a[g.POSITION]=e;b[g.POSITION]={size:3,data:c,offsetIdx:0,strideIdx:3};d&&(a.mapPos=e,b.mapPos={size:3,data:d,offsetIdx:0,strideIdx:3});return new m.GeometryData(b,a,m.GeometryData.DefaultOffsets,"line")}Object.defineProperty(a,"__esModule",{value:!0});var g=k.VertexAttrConstants;a.isClosed=h;a.createPolylineGeometryData=
d;a.createPolylineGeometry=function(a,f,c,b,e){a=d(a,f,c);a.vertexAttributes[g.COLOR]={size:4,data:b,offsetIdx:0,strideIdx:4};b=new Float32Array(1);b[0]=e;a.vertexAttributes[g.SIZE]={size:1,data:b,offsetIdx:0,strideIdx:1};e=new Uint32Array(a.vertexAttributes[g.POSITION].data.length);a.indices[g.COLOR]=e;a.indices[g.SIZE]=e;return a}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/MaterialUtil ./renderers/InstancedRenderer ./renderers/MergedRenderer ../shaders/RibbonLinePrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){function A(b,a){a.vvSizeEnabled&&(b.setUniform3fv("vvSizeMinSize",a.vvSizeMinSize),b.setUniform3fv("vvSizeMaxSize",a.vvSizeMaxSize),b.setUniform3fv("vvSizeOffset",a.vvSizeOffset),b.setUniform3fv("vvSizeFactor",a.vvSizeFactor));a.vvColorEnabled&&(b.setUniform1fv("vvColorValues",a.vvColorValues),b.setUniform4fv("vvColorColors",a.vvColorColors));a.vvOpacityEnabled&&(b.setUniform1fv("vvOpacityValues",a.vvOpacityValues),b.setUniform1fv("vvOpacityOpacities",
a.vvOpacityOpacities))}var E=h.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");n=function(a){function c(b,c){c=a.call(this,c)||this;c.params=v.copyParameters(b,F);"miter"!==c.params.join&&(c.params.miterLimit=0);c.params.transparent=1>c.params.color[3]||c.params.transparent;c.canBeMerged=null==c.params.stippleLength;c.layout=c.createLayout();return c}m(c,a);c.prototype.dispose=function(){};c.prototype.setParameterValues=function(b){for(var a in b)w.assert("cap"!==a,"RibbonLineMaterial: cap cannot be changed after creation"),
w.assert("stippleLength"!==a||null!=b[a]===(null!=this.params[a]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[a]=b[a];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};c.prototype.getParameters=function(){return this.params};c.prototype.intersect=function(b,a,c,d,e,f,g,l,h){h?v.intersectDrapedRenderLineGeometry(b,a,c,d,e,f,this.params.width,g):this.intersectLineGeometry(b,a,c,d,e,f,this.params.width,g)};c.prototype.intersectLineGeometry=
function(a,c,e,g,h,k,m,q,u){if(g.enable.selectionMode&&!p.isAllHidden(c.componentVisibilities,a.componentOffsets))if(w.isTranslationMatrix(e)){c=a.data.getVertexAttr();a=c[x.VertexAttrConstants.POSITION].data;this.params.vvSizeEnabled?m*=d.clamp(this.params.vvSizeOffset[0]+c[x.VertexAttrConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):c[x.VertexAttrConstants.SIZE]&&(m*=c[x.VertexAttrConstants.SIZE].data[0]);h=g.camera;k=
O;l.vec2.copy(k,g.point);m=m*h.pixelRatio/2+4*h.pixelRatio;f.vec3.set(da[0],k[0]-m,k[1]+m,0);f.vec3.set(da[1],k[0]+m,k[1]+m,0);f.vec3.set(da[2],k[0]+m,k[1]-m,0);f.vec3.set(da[3],k[0]-m,k[1]-m,0);for(u=0;4>u;u++)h.unprojectPoint(da[u],ga[u]);b.plane.fromPoints(h.eye,ga[0],ga[1],ca);b.plane.fromPoints(h.eye,ga[1],ga[2],ia);b.plane.fromPoints(h.eye,ga[2],ga[3],ba);b.plane.fromPoints(h.eye,ga[3],ga[0],oa);c=Number.MAX_VALUE;for(u=0;u<a.length-5;u+=3)if(J[0]=a[u]+e[12],J[1]=a[u+1]+e[13],J[2]=a[u+2]+e[14],
M[0]=a[u+3]+e[12],M[1]=a[u+4]+e[13],M[2]=a[u+5]+e[14],!(0>b.plane.signedDistance(ca,J)&&0>b.plane.signedDistance(ca,M)||0>b.plane.signedDistance(ia,J)&&0>b.plane.signedDistance(ia,M)||0>b.plane.signedDistance(ba,J)&&0>b.plane.signedDistance(ba,M)||0>b.plane.signedDistance(oa,J)&&0>b.plane.signedDistance(oa,M))){h.projectPoint(J,T);h.projectPoint(M,U);if(0>T[2]&&0<U[2]){f.vec3.subtract(L,J,M);var r=h.frustum,t=-b.plane.signedDistance(r.planes[4],J),r=t/f.vec3.dot(L,r.planes[4]);f.vec3.scale(L,L,r);
f.vec3.add(J,J,L);h.projectPoint(J,T)}else if(0<T[2]&&0>U[2])f.vec3.subtract(L,M,J),r=h.frustum,t=-b.plane.signedDistance(r.planes[4],M),r=t/f.vec3.dot(L,r.planes[4]),f.vec3.scale(L,L,r),f.vec3.add(M,M,L),h.projectPoint(M,U);else if(0>T[2]&&0>U[2])continue;T[2]=0;U[2]=0;r=b.lineSegment.distance2(b.lineSegment.fromPoints(T,U,W),k);r<c&&(c=r,f.vec3.copy(P,J),f.vec3.copy(V,M))}e=g.rayBeginPoint;g=g.rayEndPoint;c<m*m&&(a=Number.MAX_VALUE,b.lineSegment.closestLineSegmentPoint(b.lineSegment.fromPoints(P,
V,W),b.lineSegment.fromPoints(e,g,Q),R)&&(f.vec3.subtract(R,R,e),a=f.vec3.length(R),f.vec3.scale(R,R,1/a),a/=f.vec3.distance(e,g)),q(a,R))}else E.error("intersection assumes a translation-only matrix")};c.prototype.createLayout=function(){var b=e.newLayout().vec3f(x.VertexAttrConstants.POSITION).f32(x.VertexAttrConstants.SUBDIVISIONFACTOR).vec2f(x.VertexAttrConstants.UV0).vec3f(x.VertexAttrConstants.AUXPOS1).vec3f(x.VertexAttrConstants.AUXPOS2);this.params.vvSizeEnabled?b.f32(x.VertexAttrConstants.SIZEFEATUREATTRIBUTE):
b.f32(x.VertexAttrConstants.SIZE);this.params.vvColorEnabled?b.f32(x.VertexAttrConstants.COLORFEATUREATTRIBUTE):b.vec4f(x.VertexAttrConstants.COLOR);this.params.vvOpacityEnabled&&b.f32(x.VertexAttrConstants.OPACITYFEATUREATTRIBUTE);return b};c.prototype.createBufferWriter=function(){return new K(this.layout,this.params)};c.prototype.createRenderer=function(b,a){return this.canBeMerged?new t(b,a,this,x.vertexAttributeLocations):new y(b,a,this,x.vertexAttributeLocations)};c.prototype.getGLMaterials=
function(){return{color:B,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:G}};return c}(r.Material);var B=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}m(a,b);a.prototype.updateParameters=function(){this.params=v.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype.beginSlot=function(b){return b===(this.params.writeDepth?7:10)};a.prototype.getProgram=function(){return this.program};a.prototype.selectProgram=function(){var b=this.params;
this.program=this.programRep.getProgram(x.colorPass,{stipple:null!=b.stippleLength,slice:b.slicePlaneEnabled,join:b.join,cap:b.cap,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,vvOpacity:b.vvOpacityEnabled});this.pipelineState=z.makePipelineState({blending:z.separateBlendingParams(770,1,771,771),polygonOffset:b.polygonOffset&&H,depthTest:{func:513},depthWrite:!b.transparent&&b.writeDepth&&z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams})};a.prototype.bind=function(b,a){var c=this.program,
d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);c.setUniform1f("symbolLineWidth",d.width);c.setUniform4fv("symbolColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",a.nearFar[0]);c.setUniform1f("pixelRatio",a.pixelRatio);c.setUniform2fv("screenSize",[a.viewport[2],a.viewport[3]]);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);A(c,d)};a.prototype.release=function(b){};a.prototype.bindView=
function(b,a){b=this.program;var c=this.params;v.bindView(a.origin,a.view,b);c.slicePlaneEnabled&&v.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=function(){return 5};return a}(q),G=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}m(a,b);a.prototype.updateParameters=function(){this.params=v.copyParameters(this.material.getParameters());this.selectProgram()};
a.prototype.beginSlot=function(b){return 5===b};a.prototype.getProgram=function(){return this.program};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(x.highlightPass,{stipple:null!=b.stippleLength,slice:b.slicePlaneEnabled,join:b.join,cap:b.cap,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,vvOpacity:b.vvOpacityEnabled});this.pipelineState=z.makePipelineState({polygonOffset:b.polygonOffset&&H,depthTest:{func:513},depthWrite:!b.transparent&&b.writeDepth&&
z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams})};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);v.bindHighlightRendering(b,a,c);c.setUniform1f("symbolLineWidth",d.width);c.setUniform4fv("symbolColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",a.nearFar[0]);c.setUniform1f("pixelRatio",a.pixelRatio);c.setUniform2fv("screenSize",[a.viewport[2],a.viewport[3]]);null!=d.stippleLength&&
c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);A(c,d)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params;v.bindView(a.origin,a.view,b);c.slicePlaneEnabled&&v.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=function(){return 5};return a}(q),F=k({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,
writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1},u.Default),K=function(){function b(b,a){this.parms=a;this.numJoinSubdivisions=this.numCapSubdivisions=0;this.canBeMerged=!1;this.vertexBufferLayout=b;this.canBeMerged=null==this.parms.stippleLength;switch(this.parms.cap){case "butt":this.numCapSubdivisions=0;break;case "square":this.numCapSubdivisions=1;break;case "round":this.numCapSubdivisions=N}switch(this.parms.join){case "miter":case "bevel":this.numJoinSubdivisions=
0;break;case "round":this.numJoinSubdivisions=I}}b.prototype.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};b.prototype.elementCount=function(b){var a=b.indices[x.VertexAttrConstants.POSITION].length/2+1,c=2*(2*this.numCapSubdivisions+2);if(b.vertexAttr[x.VertexAttrConstants.SUBDIVISIONS]){b=b.vertexAttr[x.VertexAttrConstants.SUBDIVISIONS].data;for(var d=1;d<a-1;++d)c+=4+2*b[d]}else c+=(a-2)*(2*this.numJoinSubdivisions+4);this.canBeMerged&&(c+=2);return c};b.prototype.write=
function(b,a,c,d){var e=this,g=Z,l=X,h=aa,k=a.vertexAttr[x.VertexAttrConstants.POSITION].data,p=a.indices&&a.indices[x.VertexAttrConstants.POSITION];p&&p.length!==2*(k.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");p=null;a.vertexAttr[x.VertexAttrConstants.SUBDIVISIONS]&&(p=a.vertexAttr[x.VertexAttrConstants.SUBDIVISIONS].data);var m=1,q=0;this.parms.vvSizeEnabled?q=a.vertexAttr[x.VertexAttrConstants.SIZEFEATUREATTRIBUTE].data[0]:a.vertexAttr[x.VertexAttrConstants.SIZE]&&
(m=a.vertexAttr[x.VertexAttrConstants.SIZE].data[0]);var u=[1,1,1,1],r=0;this.parms.vvColorEnabled?r=a.vertexAttr[x.VertexAttrConstants.COLORFEATUREATTRIBUTE].data[0]:a.vertexAttr[x.VertexAttrConstants.COLOR]&&(u=a.vertexAttr[x.VertexAttrConstants.COLOR].data);var w=0;this.parms.vvOpacityEnabled&&(w=a.vertexAttr[x.VertexAttrConstants.OPACITYFEATUREATTRIBUTE].data[0]);a=k.length/3;b=b.transformation;var t=new Float32Array(c.buffer),n=0;c=this.vertexBufferLayout.stride/4;var v=d*c,y=v,z=function(b,
a,c,d,f,g){t[v++]=a[0];t[v++]=a[1];t[v++]=a[2];t[v++]=d;t[v++]=f;t[v++]=g;t[v++]=b[0];t[v++]=b[1];t[v++]=b[2];t[v++]=c[0];t[v++]=c[1];t[v++]=c[2];e.parms.vvSizeEnabled?t[v++]=q:t[v++]=m;e.parms.vvColorEnabled?t[v++]=r:(t[v++]=u[0],t[v++]=u[1],t[v++]=u[2],t[v++]=u[3]);e.parms.vvOpacityEnabled&&(t[v++]=w)};this.canBeMerged&&(v+=c);f.vec3.set(g,k[0],k[1],k[2]);b&&f.vec3.transformMat4(g,g,b);f.vec3.set(h,k[3],k[4],k[5]);b&&f.vec3.transformMat4(h,h,b);f.vec3.copy(l,g);for(d=0;d<this.numCapSubdivisions;++d){var A=
1-d/this.numCapSubdivisions;z(g,l,h,A,n,-4);z(g,l,h,A,n,4)}z(g,l,h,0,n,-4);z(g,l,h,0,n,4);f.vec3.copy(g,l);f.vec3.copy(l,h);for(d=1;d<a-1;d++){A=3*d;f.vec3.set(h,k[A+3],k[A+4],k[A+5]);b&&f.vec3.transformMat4(h,h,b);n+=f.vec3.distance(g,l);z(g,l,h,0,n,-1);z(g,l,h,0,n,1);for(var J=p?p[d]:this.numJoinSubdivisions,M=0;M<J;++M)A=(M+1)/(J+1),z(g,l,h,A,n,-2),z(g,l,h,A,n,2);z(g,l,h,1,n,-2);z(g,l,h,1,n,2);f.vec3.copy(g,l);f.vec3.copy(l,h)}n+=f.vec3.distance(g,l);z(g,l,h,0,n,-5);z(g,l,h,0,n,5);for(d=0;d<this.numCapSubdivisions;++d)A=
(d+1)/this.numCapSubdivisions,z(g,l,h,A,n,-5),z(g,l,h,A,n,5);if(this.canBeMerged){for(d=y;d<y+c;d++)t[d]=t[d+c];g=v-c;for(d=0;d<c;d++)t[v++]=t[g++]}};return b}(),H={factor:0,units:-4},N=3,I=1,J=c.vec3f64.create(),M=c.vec3f64.create(),L=c.vec3f64.create(),R=c.vec3f64.create(),O=c.vec3f64.create(),T=g.createRenderScreenPointArray3(),U=g.createRenderScreenPointArray3(),P=c.vec3f64.create(),V=c.vec3f64.create(),W=b.lineSegment.create(),Q=b.lineSegment.create(),Z=c.vec3f64.create(),X=c.vec3f64.create(),
aa=c.vec3f64.create(),da=[g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3(),g.createRenderScreenPointArray3()],ga=[c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create()],ca=b.plane.create(),ia=b.plane.create(),ba=b.plane.create(),oa=b.plane.create();return n})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat3f64","../../../../core/libs/gl-matrix-2/vec3f32"],
function(n,a,m,k){var h;(h||(h={})).Default={vvSizeEnabled:!1,vvSizeMinSize:k.vec3f32.fromValues(1,1,1),vvSizeMaxSize:k.vec3f32.fromValues(100,100,100),vvSizeOffset:k.vec3f32.fromValues(0,0,0),vvSizeFactor:k.vec3f32.fromValues(1,1,1),vvSizeValue:k.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,
0,0],vvSymbolRotationMatrix:m.mat3f64.create()};return h})},"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.VertexAttrConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",
SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"};a.vertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15};var h=function(a){return k.glslifyDefineMap({STIPPLE:a.stipple,SLICE:a.slice,JOIN_ROUND:"round"===a.join,CAP_ROUND:"round"===a.cap,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VV_OPACITY:a.vvOpacity})};
a.colorPass={name:"ribbon-line-color",shaders:function(a){return{vertexShader:h(a)+m.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:h(a)+m.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:a.vertexAttributeLocations};a.highlightPass={name:"ribbon-line-highlight",shaders:function(a){return{vertexShader:h(a)+m.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:h(a)+m.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:a.vertexAttributeLocations}})},
"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L,R,O){Object.defineProperty(a,"__esModule",{value:!0});var T=M.VertexAttrConstants;n=function(b){function a(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._materials=new Map;a._textures=new Map;return a}m(a,b);a.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return k(this,function(b){F.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new R({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=
new R({color:[0,1,1,1]},"debugFAceNormal"));return[2]})})};a.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._materials.forEach(function(b){a._context.stage.remove(3,b.material.id)});this._textures.forEach(function(b){a._context.stage.remove(4,b.id)});this._materials.clear();this._textures.clear()};a.prototype.createGraphics3DGraphic=function(b){var c=b.graphic;if(!this._validateGeometryType(c.geometry,a.validGeometryTypes,"fill on mesh-3d")||!this._validateGeometry(c.geometry))return null;
var d="graphic"+c.uid,e=this.getGraphicElevationContext(c);return this._createAs3DShape(c,b.renderingInfo,e,d,c.uid)};a.prototype.layerOpacityChanged=function(b,a){var c=this,d=this._getLayerOpacity();this._materials.forEach(function(b){b.material.setParameterValues({layerOpacity:d});var a=b.material.getParameters();c._setMaterialTransparentParameter(a,b);b.material.setParameterValues({transparent:a.transparent})});b.forEach(function(b){b=a(b);f.isSome(b)&&b.layerOpacityChanged(d,c._context.isAsync)});
return!0};a.prototype.layerElevationInfoChanged=function(b,a){return this.updateGraphics3DGraphicElevationInfo(b,a,A.needsElevationUpdates3D)};a.prototype.slicePlaneEnabledChanged=function(b,a){var c=this;this._materials.forEach(function(b){b.material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});b.forEach(function(b){b=a(b);f.isSome(b)&&b.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,c._context.isAsync)});return!0};a.prototype.physicalBasedRenderingChanged=function(b,
a){var c=this;this._materials.forEach(function(b){b.material.setParameterValues(O.returnDefaultPBRMaterialParameters(c._context.physicalBasedRenderingEnabled))});return!0};a.prototype.pixelRatioChanged=function(b,a){return!0};a.prototype._requiresSymbolVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};a.prototype._colorOrTextureUid=function(b){return b?b instanceof g?b.toHex():b.contentHash:"-"};a.prototype._materialProperties=function(b,a,c){var d=
this._requiresSymbolVertexColors(),e,f,g,l,h,k,p,m,q;a.material&&(f=a.material.color,e=this._colorOrTextureUid(a.material.color),g=a.material.colorTexture,l=this._colorOrTextureUid(a.material.colorTexture),h=a.material.normalTexture,k=this._colorOrTextureUid(a.material.normalTexture),p=a.material.doubleSided,m=a.material.alphaCutoff,q=a.material.alphaMode);a=!!b.vertexAttributes.color;b=!!b.vertexAttributes.tangent;return{hasSymbolVertexColors:d,hasVertexColors:a,hasVertexTangents:b,color:f,colorTexture:g,
normalTexture:h,uid:"vc:"+a+",vt:"+b+",vct"+c+",svc:"+d+",cmuid:"+e+",ctmuid:"+l+",ntmuid:"+k+",ds:"+p+",ac:"+m+",am:"+q}};a.prototype._setInternalColorValueParameters=function(b,a){a.diffuse=g.toUnitRGB(b);a.opacity=b.a};a.prototype._getLoadableTextureResource=function(b){return b.data?b.data instanceof HTMLImageElement?b.data.complete?b.data:b.data.src:b.data:b.url};a.prototype._getInternalTextureId=function(b,a){var c=this._getLoadableTextureResource(b);if(c){var d=b.contentHash,e=this._textures.get(d);
e||(e=new J(c,a+"_"+d+"_tex",{mipmap:!0,wrap:this._castTextureWrap(b.wrap),noUnpackFlip:!0}),this._textures.set(d,e),this._context.stage.add(4,e));return e.id}};a.prototype._castTextureWrap=function(b){void 0===b&&(b="repeat");return"string"===typeof b?(b=this._castTextureWrapIndividual(b),{s:b,t:b}):{s:this._castTextureWrapIndividual(b.horizontal),t:this._castTextureWrapIndividual(b.vertical)}};a.prototype._castTextureWrapIndividual=function(b){switch(b){case "clamp":return 33071;case "mirror":return 33648;
default:return 10497}};a.prototype._setInternalMaterialParameters=function(b,a,c){b.color&&this._setInternalColorValueParameters(b.color,c);b.colorTexture&&(c.textureId=this._getInternalTextureId(b.colorTexture,a));b.normalTexture&&(c.normalTextureId=this._getInternalTextureId(b.normalTexture,a))};a.prototype._setExternalMaterialParameters=function(b){var a=this._isPropertyDriven("color"),c=f.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;a?b.externalColor=w.vec4f64.ONES:
(a=f.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,f.isSome(a)?b.externalColor=g.toUnitRGBA(a):(c=null,b.externalColor=w.vec4f64.ONES));c&&(b.colorMixMode=c)};a.prototype._hasTransparentVertexColors=function(b){b=b.vertexAttributes.color;if(!b)return!1;for(var a=3;a<b.length;a+=4)if(255!==b[a])return!0;return!1};a.prototype._getOrCreateMaterial=function(b,a){var c=a.material&&a.material.color,e=a.material&&a.material.colorTexture,f=a.material&&"blend"===a.material.alphaMode,
c=!(a.material&&"opaque"===a.material.alphaMode)&&(this._hasTransparentVertexColors(b)||c&&1>c.a||e&&e.transparent||f);b=this._materialProperties(b,a,c);if(e=this._materials.get(b.uid))return e.material;c={material:null,isComponentTransparent:c,alphaMode:a.material?a.material.alphaMode:"opaque"};e=this._getIdHint();f={specular:r.vec3f64.ZEROS,vertexColors:b.hasVertexColors,symbolColors:b.hasSymbolVertexColors,vertexTangents:b.hasVertexTangents,ambient:r.vec3f64.ZEROS,diffuse:r.vec3f64.ONES,opacity:1,
doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};f=d({},f,O.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));a.material&&(f.doubleSided=a.material.doubleSided,f.cullFace=a.material.doubleSided?"none":"back",f.textureAlphaCutoff=a.material.alphaCutoff);this._setInternalMaterialParameters(b,e,f);this._setExternalMaterialParameters(f);this._setMaterialTransparentParameter(f,
c);a=new L(f,e+"_"+b.uid+"_mat");c.material=a;this._materials.set(b.uid,c);this._context.stage.add(3,a);return a};a.prototype._setMaterialTransparentParameter=function(b,a){var c=this._isPropertyDriven("opacity");b.transparent=c||a.isComponentTransparent||1>b.layerOpacity||1>b.opacity||b.externalColor&&1>b.externalColor[3];b.textureAlphaMode="auto"===a.alphaMode?b.transparent?"maskBlend":"opaque":a.alphaMode};a.prototype._addDebugNormals=function(b,a,c,d){var e,f,g,l,h=a.length,k=b.spatialReference.isGeographic?
20015077/180:1,m=.1*Math.max(b.extent.width*k,b.extent.height*k,b.extent.zmax-b.extent.zmin),u=[],r=[];b=[];for(var k=[],w=0;w<h;w++)for(var t=a[w],n=t.data.getAttribute(T.POSITION),v=t.data.getAttribute(T.NORMAL),y=t.data.getIndices(T.POSITION),t=t.data.getIndices(T.NORMAL),n=n.data,v=v.data,x=0;x<y.length;x++){for(var z=3*y[x],A=3*t[x],J=0;3>J;J++)u.push(n[z+J]);for(J=0;3>J;J++)u.push(n[z+J]+v[A+J]*m);r.push(r.length);r.push(r.length);if(0===x%3){this._calculateFaceNormal(n,y,x,Q);this._getFaceVertices(n,
y,x,P,V,W);q.vec3.add(P,P,V);q.vec3.add(P,P,W);q.vec3.scale(P,P,1/3);for(J=0;3>J;J++)b.push(P[J]);for(J=0;3>J;J++)b.push(P[J]+Q[J]*m);k.push(k.length);k.push(k.length)}}h=(e={},e[T.POSITION]={data:new Float64Array(u),size:3},e);e=(f={},f[T.POSITION]=new Uint32Array(r),f);f=new N.GeometryData(h,e,void 0,"line");f=new H(f,"debugVertexNormal");f.singleUse=!0;a.push(f);c.push(this._debugVertexNormalMaterial);d.push(p.mat4f64.clone(d[0]));h=(g={},g[T.POSITION]={data:new Float64Array(b),size:3},g);e=(l=
{},l[T.POSITION]=new Uint32Array(k),l);f=new N.GeometryData(h,e,void 0,"line");f=new H(f,"debugFaceNormal");f.singleUse=!0;a.push(f);c.push(this._debugFaceNormalMaterial);d.push(p.mat4f64.clone(d[0]))};a.prototype._createAs3DShape=function(b,a,c,d,e){b=b.geometry;if("mesh"!==b.type)return null;var g=this._createGeometryInfo(b,a,d);if(!g)return null;a=g.geometries;var l=g.materials,h=g.transformations,g=g.objectTransformation;F.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(b,a,l,h);e=new I({geometries:a,
materials:l,transformations:h,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});e.objectTransformation=g;d=x.perObjectElevationAligner;h=this._createEdgeMaterial();l=f.isSome(h)?{baseMaterial:l[0],edgeMaterials:[h],addObjectSettings:{mergeGeometries:!0},slicePlaneEnabled:this._context.slicePlaneEnabled}:null;a=new z(this,e,a,null,null,d,c,l);a.needsElevationUpdates=A.needsElevationUpdates3D(c.mode);c=b.extent.center.clone();c.z=0;a.elevationContext.centerPointInElevationSR=
c;a.alignedTerrainElevation=d(a,a.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return a};a.prototype._createComponentNormals=function(b,a,c,d){var e=c.shading||"flat";switch(e){case "source":return this._createComponentNormalsSource(b,a,c,d);case "flat":return this._createComponentNormalsFlat(b,c,d);case "smooth":return this._createComponentNormalsSmooth(b,c,d);default:l.neverReached(e)}};a.prototype._createComponentNormalsSource=
function(b,a,c,d){if(!a)return this._createComponentNormalsFlat(b,c,d);var e=!1;if(!c.trustSourceNormals)for(c=0;c<d.length;c+=3){this._calculateFaceNormal(b,d,c,Q);for(var f=0;3>f;f++){var g=3*d[c+f];P[0]=a[g+0];P[1]=a[g+1];P[2]=a[g+2];0>q.vec3.dot(Q,P)&&(a[g+0]=-a[g+0],a[g+1]=-a[g+1],a[g+2]=-a[g+2],e=!0)}}return{normals:a,indices:d,didFlipNormals:e}};a.prototype._createComponentNormalsFlat=function(b,a,c){a=new Float32Array(c.length);for(var d=new Uint32Array(3*c.length),e=0;e<c.length;e+=3)for(var f=
this._calculateFaceNormal(b,c,e,Q),g=0;3>g;g++)a[e+g]=f[g],d[e+g]=e/3;return{normals:a,indices:d,didFlipNormals:!1}};a.prototype._createComponentNormalsSmooth=function(b,a,c){a={};for(var d=0;d<c.length;d+=3)for(var e=this._calculateFaceNormal(b,c,d,Q),f=0;3>f;f++){var g=c[d+f],l=a[g];l||(l={normal:r.vec3f64.create(),count:0},a[g]=l);q.vec3.add(l.normal,l.normal,e);l.count++}b=new Float32Array(3*c.length);e=new Uint32Array(3*c.length);for(d=0;d<c.length;d++){g=c[d];l=a[g];1!==l.count&&(q.vec3.normalize(l.normal,
l.normal),l.count=1);for(f=0;3>f;f++)b[3*d+f]=l.normal[f];e[d]=d}return{normals:b,indices:e,didFlipNormals:!1}};a.prototype._getFaceVertices=function(b,a,c,d,e,f){var g=3*a[c+0],l=3*a[c+1];a=3*a[c+2];d[0]=b[g+0];d[1]=b[g+1];d[2]=b[g+2];e[0]=b[l+0];e[1]=b[l+1];e[2]=b[l+2];f[0]=b[a+0];f[1]=b[a+1];f[2]=b[a+2]};a.prototype._calculateFaceNormal=function(b,a,c,d){this._getFaceVertices(b,a,c,P,V,W);q.vec3.subtract(V,V,P);q.vec3.subtract(W,W,P);q.vec3.cross(P,V,W);q.vec3.normalize(d,P);return d};a.prototype._getOrCreateComponents=
function(b){return b.components?b.components:da};a.prototype._createPositionBuffer=function(b){var a=b.vertexAttributes.position,c=new Float64Array(a.length);A.reproject(b.vertexAttributes.position,0,b.spatialReference,c,0,this._context.renderSpatialReference,a.length/3);return c};a.prototype._createNormalBuffer=function(b,a){var c=b.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=b.vertexAttributes.position,e=new Float32Array(c.length);
return t.projectNormalToECEF(c,d,a,b.spatialReference,e)};a.prototype._createTangentBuffer=function(b,a){var c=b.vertexAttributes.tangent;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=b.vertexAttributes.position,e=new Float32Array(c.length);return t.projectTangentToECEF(c,d,a,b.spatialReference,e)};a.prototype._createColorBuffer=function(b){return b.vertexAttributes.color};a.prototype._createSymbolColorBuffer=function(b){if(this._requiresSymbolVertexColors()){b=
this._getVertexOpacityAndColor(b);var a=f.get(this.symbolLayer,"material","colorMixMode"),c=new Uint8Array(4);G.encodeSymbolColor(b,a,c);return c}return null};a.prototype._createColorIndices=function(b,a){b=new Uint32Array(a.length);for(a=0;a<b.length;a++)b[a]=0;return b};a.prototype._createBuffers=function(b,a){var c=b.vertexAttributes&&b.vertexAttributes.position;if(!c)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var d=b.vertexAttributes.normal,e=b.vertexAttributes.uv,
f=b.vertexAttributes.tangent;if(d&&d.length!==c.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(f&&f.length/4!==c.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==c.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(b);
d=this._createColorBuffer(b);a=this._createSymbolColorBuffer(a);var f=this._createNormalBuffer(b,c),g=this._createTangentBuffer(b,c);b=this._transformCenterLocal(b,c,f);return{positionBuffer:c,normalBuffer:f,tangentBuffer:g,uvBuffer:e,colorBuffer:d,symbolColorBuffer:a,objectTransformation:b}};a.prototype._transformCenterLocal=function(b,a,d){var f=b.extent.center,g=this._context.renderSpatialReference;U[0]=f.x;U[1]=f.y;U[2]=0;f=p.mat4f64.create();K.computeLinearTransformation(b.spatialReference,U,
f,g);e.mat4.invert(Z,f);for(b=0;b<a.length;b+=3)P[0]=a[b+0],P[1]=a[b+1],P[2]=a[b+2],q.vec3.transformMat4(P,P,Z),a[b+0]=P[0],a[b+1]=P[1],a[b+2]=P[2];if(d)for(c.mat3.fromMat4(X,f),c.mat3.transpose(X,X),b=0;b<d.length;b+=3)P[0]=d[b+0],P[1]=d[b+1],P[2]=d[b+2],q.vec3.transformMat3(P,P,X),d[b+0]=P[0],d[b+1]=P[1],d[b+2]=P[2];return f};a.prototype._validateFaces=function(b,a){b=b.vertexAttributes.position.length/3;if(a=a.faces){for(var c=-1,d=0;d<a.length;d++){var e=a[d];e>c&&(c=e)}if(b<=c)return this.logger.warn("Vertex index "+
c+" is out of bounds of the mesh position buffer"),!1}else if(0!==b%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};a.prototype._getOrCreateFaces=function(b,a){if(a.faces)return a.faces;b=new Uint32Array(b.vertexAttributes.position.length/3);for(a=0;a<b.length;a++)b[a]=a;return b};a.prototype._isOutsideClippingArea=function(b){if(!this._context.clippingExtent)return!1;var a=
b.vertexAttributes&&b.vertexAttributes.position;if(!a)return!1;var c=this._context.elevationProvider.spatialReference,d=a.length/3;b.spatialReference.equals(c)||(a=new Float64Array(a.length),A.reproject(b.vertexAttributes.position,0,b.spatialReference,a,0,c,d));A.computeBoundingBox(a,0,d,aa);return A.boundingBoxClipped(aa,this._context.clippingExtent)};a.prototype._createGeometryInfo=function(b,a,c){var d,e;if(!y.canProject(b,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(b))return null;var f=this._createBuffers(b,a);if(!f)return null;a=f.positionBuffer;for(var g=f.uvBuffer,l=f.colorBuffer,h=f.symbolColorBuffer,k=f.normalBuffer,m=f.tangentBuffer,f=f.objectTransformation,q=[],u=[],r=[],w=!1,t=0,n=this._getOrCreateComponents(b);t<n.length;t++){var v=n[t];if(!this._validateFaces(b,v))return null;var x=this._getOrCreateFaces(b,v);if(0!==x.length){var z=this._createComponentNormals(a,k,v,x);z.didFlipNormals&&(w=!0);var A=(d={},d[T.POSITION]=
{size:3,data:a},d[T.NORMAL]={size:3,data:z.normals},d),z=(e={},e[T.POSITION]=x,e[T.NORMAL]=z.indices,e);l&&(A[T.COLOR]={size:4,data:l},z[T.COLOR]=x);h&&(A[T.SYMBOLCOLOR]={size:4,data:h},z[T.SYMBOLCOLOR]=this._createColorIndices(v,x));b.vertexAttributes.uv&&(A[T.UV0]={size:2,data:g},z[T.UV0]=x);b.vertexAttributes.tangent&&(A[T.TANGENT]={size:4,data:m},z[T.TANGENT]=x);x=new N.GeometryData(A,z);x=new H(x,c+"_mesh");x.singleUse=!0;q.push(x);u.push(p.mat4f64.create());r.push(this._getOrCreateMaterial(b,
v))}}w&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:q,transformations:u,materials:r,objectTransformation:f}};a.prototype._createEdgeMaterial=function(){var b={opacity:this._getLayerOpacity()};return B.createMaterial(this.symbolLayer,b)};a.validGeometryTypes=["mesh"];return a}(E.default);a.Graphics3DMeshFillSymbolLayer=n;var U=r.vec3f64.create(),
P=r.vec3f64.create(),V=r.vec3f64.create(),W=r.vec3f64.create(),Q=r.vec3f64.create(),Z=p.mat4f64.create(),X=b.mat3f64.create(),aa=u.create(),da=[new v];a.default=n})},"esri/geometry/support/MeshComponent":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshMaterial ./MeshVertexAttributes".split(" "),function(n,a,m,k,h,d,g,l,f,c){var b=g.getLogger("esri.geometry.support.MeshComponent");
return function(a){function e(b){b=a.call(this)||this;b.faces=null;b.material=null;b.shading="source";b.trustSourceNormals=!1;return b}m(e,a);g=e;e.prototype.castFaces=function(a){return c.castArray(a,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},b)};e.prototype.clone=function(){return new g({faces:d.clone(this.faces),shading:this.shading,material:d.clone(this.material),trustSourceNormals:this.trustSourceNormals})};e.prototype.cloneWithDeduplication=function(b,a){return new g({faces:d.clone(this.faces),
shading:this.shading,material:this.material?this.material.cloneWithDeduplication(b,a):null,trustSourceNormals:this.trustSourceNormals})};var g;k([l.property({json:{write:!0}})],e.prototype,"faces",void 0);k([l.cast("faces")],e.prototype,"castFaces",null);k([l.property({type:f,json:{write:!0}})],e.prototype,"material",void 0);k([l.property({type:String,json:{write:!0}})],e.prototype,"shading",void 0);k([l.property({type:Boolean})],e.prototype,"trustSourceNormals",void 0);return e=g=k([l.subclass("esri.geometry.support.MeshComponent")],
e)}(l.declared(h))})},"esri/geometry/support/MeshMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./ImageMeshColor ./MeshTexture ./ValueMeshColor".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p){function q(){r.warn('Assigning ImageMeshColor to "MeshMaterial.color" is deprecated. Assigning to "MeshMaterial.colorTexture" instead.')}
var r=l.getLogger("esri.geometry.support.MeshMaterial"),w=/^\s*(#|rgba?\()/;return function(a){function d(b){b=a.call(this)||this;b.color=null;b.colorTexture=null;b.normalTexture=null;b.alphaMode="auto";b.alphaCutoff=.5;b.doubleSided=!0;return b}m(d,a);l=d;d.prototype.castColor=function(a){if(!a)return a;if(Array.isArray(a))return new h(a);if(a instanceof h||a instanceof e)return a;if("string"===typeof a){if(w.test(a)||h.named[a])return new h(a);q();this.colorTexture=new e({url:a});return null}return a instanceof
HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?(q(),this.colorTexture=new e({data:a}),null):a instanceof b?(q(),this.colorTexture=new e({url:a.url,data:a.data}),null):"image"===a.type?(q(),this.colorTexture=new e(a),null):a instanceof p?(r.warn('Assigning ValueMeshColor to "MeshMaterial.color" is deprecated. Automatically converting it to esri.Color.'),new h(a.value)):c.ensureType(h,a)};d.prototype.castColorTexture=function(b){return b?"string"===typeof b?new e({url:b}):
b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof ImageData?new e({data:b}):c.ensureType(e,b):b};d.prototype.readColorTexture=function(b,a,c){if(b)return new e(b)};d.prototype.castNormalTexture=function(b){return b?"string"===typeof b?new e({url:b}):b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof ImageData?new e({data:b}):c.ensureType(e,b):b};d.prototype.readNormalTexture=function(b,a,c){if(b)return new e(b)};d.prototype.clone=function(){return new l({color:g.clone(this.color),
colorTexture:g.clone(this.colorTexture),normalTexture:g.clone(this.normalTexture),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided})};d.prototype.cloneWithDeduplication=function(b,a){var c=b.get(this);if(c)return c;a=new l({color:g.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(a):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(a):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,
doubleSided:this.doubleSided});b.set(this,a);return a};var l;k([f.property({type:h,json:{write:!0}})],d.prototype,"color",void 0);k([f.cast("color")],d.prototype,"castColor",null);k([f.property({json:{write:!0}})],d.prototype,"colorTexture",void 0);k([f.cast("colorTexture")],d.prototype,"castColorTexture",null);k([f.reader("colorTexture")],d.prototype,"readColorTexture",null);k([f.property({json:{write:!0}})],d.prototype,"normalTexture",void 0);k([f.cast("normalTexture")],d.prototype,"castNormalTexture",
null);k([f.reader("normalTexture")],d.prototype,"readNormalTexture",null);k([f.property({json:{write:!0}})],d.prototype,"alphaMode",void 0);k([f.property({json:{write:!0}})],d.prototype,"alphaCutoff",void 0);k([f.property({json:{write:!0}})],d.prototype,"doubleSided",void 0);return d=l=k([f.subclass("esri.geometry.support.MeshMaterial")],d)}(f.declared(d.JSONSupport))})},"esri/geometry/support/ImageMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Identifiable ../../core/Logger ../../core/urlUtils ../../core/accessorSupport/decorators ./MeshColor ../../views/support/screenshotUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){var e=g.getLogger("esri.geometry.support.ImageMeshColor");return function(a){function c(b){b=a.call(this)||this;b.type="image";e.warn("esri/geometry/support/ImageMeshColor is deprecated since version 4.11. Use esri/geometry/support/MeshTexture instead.");return b}m(c,a);d=c;Object.defineProperty(c.prototype,"url",{get:function(){return this._get("url")||null},set:function(b){this._set("url",b);b&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"data",{get:function(){return this._get("data")||null},set:function(b){this._set("data",b);b&&this._set("url",null)},enumerable:!0,configurable:!0});c.prototype.writeData=function(b,a,c,d){b instanceof HTMLImageElement?b={type:"image-element",src:l.toJSON(b.src,d)}:b instanceof HTMLCanvasElement?(b=b.getContext("2d").getImageData(0,0,b.width,b.height),b={type:"canvas-element",imageData:this.encodeImageData(b)}):b={type:"image-data",imageData:this.encodeImageData(b)};a[c]=b};c.prototype.readData=function(b,
a){switch(b.type){case "image-element":return a=new Image,a.src=b.src,a;case "canvas-element":return b=this.decodeImageData(b.imageData),a=document.createElement("canvas"),a.width=b.width,a.height=b.height,a.getContext("2d").putImageData(b,0,0),a;case "image-data":return this.decodeImageData(b.imageData);default:h.neverReached(b)}};Object.defineProperty(c.prototype,"transparent",{get:function(){var b=this.data,a=this.url;return b instanceof HTMLCanvasElement?this.imageDataContainsTransparent(b.getContext("2d").getImageData(0,
0,b.width,b.height)):b instanceof ImageData?this.imageDataContainsTransparent(b):a&&(b=a.substr(a.length-4,4).toLowerCase(),a=a.substr(0,15).toLocaleLowerCase(),".png"===b||"data:image/png;"===a)?!0:!1},set:function(b){null!=b?this._override("transparent",b):this._clearOverride("transparent")},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new d({url:this.url,data:this.data})};c.prototype.encodeImageData=function(b){for(var a="",c=0;c<b.data.length;c++)a+=String.fromCharCode(b.data[c]);
return{data:btoa(a),width:b.width,height:b.height}};c.prototype.decodeImageData=function(a){for(var c=atob(a.data),d=new Uint8ClampedArray(c.length),e=0;e<c.length;e++)d[e]=c.charCodeAt(e);return b.wrapImageData(d,a.width,a.height)};c.prototype.imageDataContainsTransparent=function(b){for(var a=3;a<b.data.length;a+=4)if(255!==b.data[a])return!0;return!1};var d;k([f.property()],c.prototype,"type",void 0);k([f.property({type:String,json:{write:l.write}})],c.prototype,"url",null);k([f.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),
f.property()],c.prototype,"data",null);k([f.writer("data")],c.prototype,"writeData",null);k([f.reader("data")],c.prototype,"readData",null);k([f.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);return c=d=k([f.subclass("esri.geometry.support.ImageMeshColor")],c)}(f.declared(d.IdentifiableMixin(c.default)))})},"esri/geometry/support/MeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function g(d){return a.call(this)||this}m(g,a);g.prototype.clone=function(){throw Error("not implemented");};k([d.property({readOnly:!0,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0,enabled:!0}}})],g.prototype,"type",void 0);return g=k([d.subclass("esri.geometry.support.MeshColor")],g)}(d.declared(h.JSONSupport));a.MeshColor=n;a.default=n})},"esri/views/support/screenshotUtils":function(){define(["require","exports",
"../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/mathUtils"],function(n,a,m,k,h){function d(b,a){var d=b||{},e=d.format,g=d.quality,l=d.rotation,d=d.disableSlice,p=b&&!b.ignorePadding&&a.padding||w,m;m=a.width-p.left-p.right;a=a.height-p.top-p.bottom;var u=p=0,n=m,v=a;if(b&&b.area){var p=Math.floor(b.area.x)||0,u=Math.floor(b.area.y)||0,K=null!=b.area.width?Math.floor(b.area.width):null,H=null!=b.area.height?Math.floor(b.area.height):null,n=n-p,v=v-u;null!=K&&null!=H?(n=
Math.min(n,K),v=Math.min(v,H)):null==K&&null!=H?(K=Math.min(n,K),v*=K/n,n=K):null!=K&&null==H&&(K=Math.min(v,H),n*=K/v,v=K)}p=c({x:p,y:u,width:n,height:v},b);u=Math.floor(Math.max(p.x,0));n=Math.floor(Math.max(p.y,0));m={x:u,y:n,width:Math.floor(Math.min(p.width,m-u)),height:Math.floor(Math.min(p.height,a-n))};a=m.width/m.height;p=p.width/p.height;p!==a&&(p>a?(a=Math.floor(m.width/p),m={x:m.x,y:Math.floor(m.y+(m.height-a)/2),width:m.width,height:a}):(a=Math.floor(m.height*p),m={x:Math.floor(m.x+(m.width-
a)/2),y:m.y,width:a,height:m.height}));p=f(b,m);a=p.width;p=p.height;a:switch(e){case "png":case "jpg":case "jpeg":break a;case null:case void 0:e=q;break a;default:k.neverReached(e),e=q}u=r[e];g=h.clamp(null!=g?g:u,0,100);return{format:e,quality:g,area:m,width:a,height:p,rotation:l,disableSlice:d||!1,ignoreBackground:b&&b.ignoreBackground}}function g(b,a){return b.toDataURL(p[a.format],a.quality/100)}function l(a,c,d){d||(b||(b=document.createElement("canvas"),b.width=1,b.height=1),d=b);return d.getContext("2d").createImageData(a,
c)}function f(b,a){if(!b)return a;var c=b.width;b=b.height;if(null!=c&&null!=b)return{width:Math.floor(c),height:Math.floor(b)};if(null==c&&null==b)return a;a=a.width/a.height;return null==b?{width:Math.floor(c),height:Math.floor(c/a)}:{width:Math.floor(b*a),height:Math.floor(b)}}function c(b,a){if(!a||null==a.width||null==a.height)return b;a=a.width/a.height;var c=b.width/b.height;if(c===a)return b;if(c<a)return b.width=Math.floor(b.height*a),b.height=b.height,b;b.width=b.width;b.height=Math.floor(b.width/
a);return b}Object.defineProperty(a,"__esModule",{value:!0});a.completeUserSettings=d;a.toRenderSettings=function(b,a){var c=d(b,a),e=c.area,f=c.width/e.width,g=b&&!b.ignorePadding&&a.padding||w,l=g.left+g.right,h=g.top+g.bottom;return{framebufferWidth:Math.floor((a.width-l)*f+l),framebufferHeight:Math.floor((a.height-h)*f+h),region:{x:Math.floor(e.x*f)+g.left,y:Math.floor(e.y*f)+g.top,width:c.width,height:c.height},format:c.format,quality:c.quality,rotation:c.rotation,pixelRatio:f,layers:b&&b.layers?
b.layers:[],disableSlice:c.disableSlice,ignoreBackground:c.ignoreBackground}};a.encodeResult=function(b,a,c,d){if(d.premultipliedAlpha)for(var e=b.data,f=e.length,l=0;l<f;l+=4){var h=e[l+3];0<h&&(h/=255,e[l+0]/=h,e[l+1]/=h,e[l+2]/=h)}c.width=b.width;c.height=b.height;e=c.getContext("2d");e.putImageData(b,0,0);d.flipY&&(e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore());b=e.getImageData(0,0,b.width,b.height);a=g(c,a);c.width=
0;c.height=0;return{dataUrl:a,data:b}};a.toDataUrl=g;a.createEmptyImageData=function(b,a,c){if(!b||!a)throw Error("Cannot construct image data without dimensions");if(e)try{return new ImageData(b,a)}catch(t){e=!1}return l(b,a,c)};a.wrapImageData=function(b,a,c,d){if(!a||!c)throw Error("Cannot construct image data without dimensions");if(e)try{return new ImageData(b,a,c)}catch(x){e=!1}a=l(a,c,d);a.data.set(b,0);return a};a.resampleHermite=function(b,a,c,d,e,f,g,l){void 0===d&&(d=0);void 0===e&&(e=
0);void 0===f&&(f=b.width-d);void 0===g&&(g=b.height-e);void 0===l&&(l=!1);var h=b.data,k=a.width,p=a.height,m=a.data;f/=k;g/=p;var q=Math.ceil(f/2),u=Math.ceil(g/2);b=b.width;for(var r=0;r<p;r++)for(var n=0;n<k;n++){for(var w=4*(n+(l?p-r-1:r)*k),t=0,v=0,y=0,x=0,z=0,A=0,E=(r+.5)*g,W=Math.floor(r*g);W<(r+1)*g;W++)for(var Q=Math.abs(E-(W+.5))/u,Z=(n+.5)*f,Q=Q*Q,X=Math.floor(n*f);X<(n+1)*f;X++){var aa=Math.abs(Z-(X+.5))/q,aa=Math.sqrt(Q+aa*aa);if(!(1<=aa)){var aa=2*aa*aa*aa-3*aa*aa+1,da=4*(d+X+(e+W)*
b),A=A+aa*h[da+3],v=v+aa;!c&&255>h[da+3]&&(aa=aa*h[da+3]/255);y+=aa*h[da];x+=aa*h[da+1];z+=aa*h[da+2];t+=aa}}m[w]=y/t;m[w+1]=x/t;m[w+2]=z/t;m[w+3]=A/v}return a};a.screenshotSuperSampleSettings=function(b,a){if(!a)return b;a=b.framebufferWidth;var c=b.framebufferHeight,d=b.region,e=Math.min(8,2048/Math.max(a,c));return 1.5>e?b:m({},b,{framebufferWidth:Math.round(a*e),framebufferHeight:Math.round(c*e),pixelRatio:b.pixelRatio*e,resample:{region:{x:Math.round(d.x*e),y:Math.round(d.y*e),width:Math.round(d.width*
e),height:Math.round(d.height*e)},width:a,height:c}})};var b=null,e=!0,p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},q="jpg",r={png:100,jpg:98,jpeg:98},w={top:0,right:0,bottom:0,left:0}})},"esri/geometry/support/MeshTexture":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper @dojo/framework/shim/WeakMap ../../core/compilerUtils ../../core/JSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators ../../views/support/screenshotUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c){var b=new h.default,e=0;return function(a){function g(b){b=a.call(this)||this;b.wrap="repeat";return b}m(g,a);h=g;Object.defineProperty(g.prototype,"url",{get:function(){return this._get("url")||null},set:function(b){this._set("url",b);b&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"data",{get:function(){return this._get("data")||null},set:function(b){this._set("data",b);b&&this._set("url",null)},enumerable:!0,configurable:!0});
g.prototype.writeData=function(b,a,c,d){b instanceof HTMLImageElement?b={type:"image-element",src:l.toJSON(b.src,d)}:b instanceof HTMLCanvasElement?(b=b.getContext("2d").getImageData(0,0,b.width,b.height),b={type:"canvas-element",imageData:this.encodeImageData(b)}):b={type:"image-data",imageData:this.encodeImageData(b)};a[c]=b};g.prototype.readData=function(b,a){switch(b.type){case "image-element":return a=new Image,a.src=b.src,a;case "canvas-element":return b=this.decodeImageData(b.imageData),a=
document.createElement("canvas"),a.width=b.width,a.height=b.height,a.getContext("2d").putImageData(b,0,0),a;case "image-data":return this.decodeImageData(b.imageData);default:d.neverReached(b)}};Object.defineProperty(g.prototype,"transparent",{get:function(){var b=this.data,a=this.url;return b instanceof HTMLCanvasElement?this.imageDataContainsTransparent(b.getContext("2d").getImageData(0,0,b.width,b.height)):b instanceof ImageData?this.imageDataContainsTransparent(b):a&&(b=a.substr(a.length-4,4).toLowerCase(),
a=a.substr(0,15).toLocaleLowerCase(),".png"===b||"data:image/png;"===a)?!0:!1},set:function(b){null!=b?this._override("transparent",b):this._clearOverride("transparent")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"contentHash",{get:function(){var a=this,c="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",d=function(b){void 0===b&&(b="");return"d:"+b+",t:"+a.transparent+",w:"+c};if(null!=this.url)return d(this.url);
if(null!=this.data){if(this.data instanceof HTMLImageElement)return d(this.data.src);b.has(this.data)||b.set(this.data,++e);return d(b.get(this.data))}return d()},enumerable:!0,configurable:!0});g.prototype.clone=function(){return new h({url:this.url,data:this.data,wrap:this.cloneWrap()})};g.prototype.cloneWithDeduplication=function(b){var a=b.get(this);if(a)return a;a=new h({url:this.url,data:this.data,wrap:this.cloneWrap()});b.set(this,a);return a};g.prototype.cloneWrap=function(){return"string"===
typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};g.prototype.encodeImageData=function(b){for(var a="",c=0;c<b.data.length;c++)a+=String.fromCharCode(b.data[c]);return{data:btoa(a),width:b.width,height:b.height}};g.prototype.decodeImageData=function(b){for(var a=atob(b.data),d=new Uint8ClampedArray(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return c.wrapImageData(d,b.width,b.height)};g.prototype.imageDataContainsTransparent=function(b){for(var a=3;a<
b.data.length;a+=4)if(255!==b.data[a])return!0;return!1};var h;k([f.property({type:String,json:{write:l.write}})],g.prototype,"url",null);k([f.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),f.property()],g.prototype,"data",null);k([f.writer("data")],g.prototype,"writeData",null);k([f.reader("data")],g.prototype,"readData",null);k([f.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],
g.prototype,"transparent",null);k([f.property({json:{write:!0}})],g.prototype,"wrap",void 0);k([f.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],g.prototype,"contentHash",null);return g=h=k([f.subclass("esri.geometry.support.MeshTexture")],g)}(f.declared(g.JSONSupport))})},"esri/geometry/support/ValueMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshColor".split(" "),
function(n,a,m,k,h,d,g,l,f){var c=g.getLogger("esri.geometry.support.ValueMeshColor");return function(b){function a(a){a=b.call(this)||this;a.type="value";a.value=null;c.warn("esri/geometry/support/ValueMeshColor is deprecated since version 4.11. Use esri/Color instead.");return a}m(a,b);f=a;a.prototype.clone=function(){return new f({value:d.clone(this.value)})};var f;k([l.property()],a.prototype,"type",void 0);k([l.property({type:h})],a.prototype,"value",void 0);return a=f=k([l.subclass("esri.geometry.support.ValueMeshColor")],
a)}(l.declared(f.default))})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d,g,l){function f(b,a,c,d){var e=a.loggerTag;a=a.stride;return 0!==b.length%a?(d.error(e,"Invalid array length, expected a multiple of "+a),new c([])):b}function c(b,a,c,d,e){if(!b)return b;
if(b instanceof a)return f(b,d,a,e);for(var g=0;g<c.length;g++)if(b instanceof c[g])return f(new a(b),d,a,e);if(Array.isArray(b))return f(new a(b),d,a,e);c=c.map(function(b){return"'"+b.name+"'"});e.error("Failed to set property, expected one of "+c+", but got "+b.constructor.name);return new a([])}function b(b,a,c){for(var d=Array(b.length),e=0;e<b.length;e++)d[e]=b[e];a[c]=d}Object.defineProperty(a,"__esModule",{value:!0});var e=g.getLogger("esri.geometry.support.MeshVertexAttributes");n=function(a){function f(b){b=
a.call(this)||this;b.color=null;b.position=new Float64Array(0);b.uv=null;b.normal=null;b.tangent=null;return b}m(f,a);g=f;f.prototype.castColor=function(b){return c(b,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},e)};f.prototype.castPosition=function(b){b&&b instanceof Float32Array&&e.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return c(b,Float64Array,[Float32Array],
{loggerTag:".position\x3d",stride:3},e)};f.prototype.castUv=function(b){return c(b,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},e)};f.prototype.castNormal=function(b){return c(b,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},e)};f.prototype.castTangent=function(b){return c(b,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},e)};f.prototype.clone=function(){var b={position:d.clone(this.position),uv:d.clone(this.uv),normal:d.clone(this.normal),tangent:d.clone(this.tangent),
color:d.clone(this.color)};return new g(b)};var g;k([l.property({json:{write:b}})],f.prototype,"color",void 0);k([l.cast("color")],f.prototype,"castColor",null);k([l.property({nonNullable:!0,json:{write:b}})],f.prototype,"position",void 0);k([l.cast("position")],f.prototype,"castPosition",null);k([l.property({json:{write:b}})],f.prototype,"uv",void 0);k([l.cast("uv")],f.prototype,"castUv",null);k([l.property({json:{write:b}})],f.prototype,"normal",void 0);k([l.cast("normal")],f.prototype,"castNormal",
null);k([l.property({json:{write:b}})],f.prototype,"tangent",void 0);k([l.cast("tangent")],f.prototype,"castTangent",null);return f=g=k([l.subclass("esri.geometry.support.MeshVertexAttributes")],f)}(l.declared(h.JSONSupport));a.MeshVertexAttributes=n;a.castArray=c;a.default=n})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),
function(n,a,m,k,h,d,g,l,f,c){function b(b,a,c,d,e,l){if(a){var h=c.count;if(e.isWGS84)for(e=0;e<h;e++)d.getVec(e,p),a.getVec(e,q),f.computeLinearTransformation(f.SphericalECEFSpatialReference,p,r,f.SphericalECEFSpatialReference),k.mat3.fromMat4(w,r),1===b&&k.mat3.transpose(w,w),g.vec3.transformMat3(q,q,w),l.setVec(e,q);else for(e=0;e<h;e++){d.getVec(e,p);a.getVec(e,q);f.computeLinearTransformation(f.SphericalECEFSpatialReference,p,r,f.SphericalECEFSpatialReference);k.mat3.fromMat4(w,r);var m=f.webMercator.y2lat(c.get(e,
1)),m=Math.cos(m);0===b&&(m=1/m);w[0]*=m;w[1]*=m;w[2]*=m;w[3]*=m;w[4]*=m;w[5]*=m;1===b&&k.mat3.transpose(w,w);g.vec3.transformMat3(q,q,w);g.vec3.normalize(q,q);l.setVec(e,q)}return l}}Object.defineProperty(a,"__esModule",{value:!0});var e=m.getLogger("esri.geometry.support.meshUtils.normalProjection");a.projectNormalToECEF=function(a,d,f,g,l){if(!g.isWebMercator&&!g.isWGS84)return e.error("Cannot convert PCS spatial reference buffer to ECEF"),l;b(0,c.BufferViewVec3f.fromTypedArray(a),c.BufferViewVec3f64.fromTypedArray(d),
c.BufferViewVec3f64.fromTypedArray(f),g,c.BufferViewVec3f.fromTypedArray(l));return l};a.projectNormalFromECEF=function(a,d,f,g,l){if(!g.isWebMercator&&!g.isWGS84)return e.error("Cannot convert to PCS spatial reference buffer from ECEF"),l;b(1,c.BufferViewVec3f.fromTypedArray(a),c.BufferViewVec3f64.fromTypedArray(d),c.BufferViewVec3f64.fromTypedArray(f),g,c.BufferViewVec3f.fromTypedArray(l));return l};a.projectToECEF=function(b,a,c){f.bufferToBuffer(b,a,0,c,f.SphericalECEFSpatialReference,0,b.length/
3);return c};a.projectFromECEF=function(b,a,c){f.bufferToBuffer(b,f.SphericalECEFSpatialReference,0,a,c,0,b.length/3);return a};a.transformBufferInPlace=function(b,a,c){void 0===c&&(c=!1);if(b)for(var d=0;d<b.length;d+=3){for(var e=0;3>e;e++)p[e]=b[d+e];g.vec3.transformMat4(p,p,a);c&&g.vec3.normalize(p,p);for(e=0;3>e;e++)b[d+e]=p[e]}};a.projectTangentToECEF=function(a,d,f,g,l){if(!g.isWebMercator&&!g.isWGS84)return e.error("Cannot convert PCS spatial reference buffer to ECEF"),l;b(0,c.BufferViewVec3f.fromTypedArray(a,
4*Float32Array.BYTES_PER_ELEMENT),c.BufferViewVec3f64.fromTypedArray(d),c.BufferViewVec3f64.fromTypedArray(f),g,c.BufferViewVec3f.fromTypedArray(l,4*Float32Array.BYTES_PER_ELEMENT));for(d=3;d<a.length;d+=4)l[d]=a[d];return l};a.projectTangentFromECEF=function(a,d,f,g,l){if(!g.isWebMercator&&!g.isWGS84)return e.error("Cannot convert to PCS spatial reference buffer from ECEF"),l;b(1,c.BufferViewVec3f.fromTypedArray(a,16),c.BufferViewVec3f64.fromTypedArray(d),c.BufferViewVec3f64.fromTypedArray(f),g,
c.BufferViewVec3f.fromTypedArray(l,16));for(d=3;d<a.length;d+=4)l[d]=a[d];return l};var p=l.vec3f64.create(),q=l.vec3f64.create(),r=d.mat4f64.create(),w=h.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(n,a){function m(a,f){void 0===f&&(f=0);a=a[f+3];return a>d?0:a>h?2:0<a?3:0}Object.defineProperty(a,"__esModule",{value:!0});a.encodeSymbolColor=function(a,f,c,b){void 0===b&&(b=0);null==a||"ignore"===f?(c[b+0]=255,c[b+1]=255,c[b+
2]=255,c[b+3]=255):(c[b+0]=Math.floor(255*a[0]),c[b+1]=Math.floor(255*a[1]),c[b+2]=Math.floor(255*a[2]),a=Math.floor(a[3]*k),c[b+3]=0===a?0:"tint"===f?a:"replace"===f?a+h:a+d)};a.decodeSymbolColor=function(a,f){void 0===f&&(f=0);var c=0,b=a[f+3],e;switch(m(a,f)){case 0:c=(b-d)/k;e="multiply";break;case 2:c=(b-h)/k;e="replace";break;case 3:c=b/k,e="tint"}return{color:[a[f+0]/255,a[f+1]/255,a[f+2]/255,c],colorMixMode:e}};a.decodeSymbolColorMixMode=m;a.isOpaqueSymbolColor=function(a,f){void 0===f&&(f=
0);a=a[f+3];return a===h||a===d||a===g};var k=85,h=k,d=2*k,g=3*k})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/NativeLinePrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){var t=k.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");n=function(a){function c(b,c){c=a.call(this,c)||this;c.params=w.copyParameters(b,A);return c}m(c,a);c.prototype.setParameterValues=function(b){var a=this.params,c;for(c in b)a[c]=b[c];this.notifyDirty("matChanged")};c.prototype.getParameters=function(){return this.params};c.prototype.intersect=function(b,a,c,d,e,f,g,l,h){h?this.intersectLineGeometry(b,a,c,d,e,f,g):w.intersectDrapedRenderLineGeometry(b,
a,c,d,e,f,1,g)};c.prototype.intersectLineGeometry=function(a,c,e,l,h,k,p,m){if(l.enable.selectionMode&&!b.isAllHidden(c.componentVisibilities,a.componentOffsets))if(q.isTranslationMatrix(e)){c=a.data.getVertexAttr().position.data;h=l.camera;k=O;d.vec2.copy(k,l.point);g.vec3.set(T[0],k[0]-2,k[1]+2,0);g.vec3.set(T[1],k[0]+2,k[1]+2,0);g.vec3.set(T[2],k[0]+2,k[1]-2,0);g.vec3.set(T[3],k[0]-2,k[1]-2,0);for(m=0;4>m;m++)h.unprojectPoint(T[m],U[m]);f.plane.fromPoints(h.eye,U[0],U[1],P);f.plane.fromPoints(h.eye,
U[1],U[2],V);f.plane.fromPoints(h.eye,U[2],U[3],W);f.plane.fromPoints(h.eye,U[3],U[0],Q);a=Number.MAX_VALUE;for(m=0;m<c.length-5;m+=3)if(G[0]=c[m]+e[12],G[1]=c[m+1]+e[13],G[2]=c[m+2]+e[14],F[0]=c[m+3]+e[12],F[1]=c[m+4]+e[13],F[2]=c[m+5]+e[14],!(0>f.plane.signedDistance(P,G)&&0>f.plane.signedDistance(P,F)||0>f.plane.signedDistance(V,G)&&0>f.plane.signedDistance(V,F)||0>f.plane.signedDistance(W,G)&&0>f.plane.signedDistance(W,F)||0>f.plane.signedDistance(Q,G)&&0>f.plane.signedDistance(Q,F))){h.projectPoint(G,
N);h.projectPoint(F,I);if(0>N[2]&&0<I[2]){g.vec3.subtract(K,G,F);var r=h.frustum,u=-f.plane.signedDistance(r.planes[4],G),r=u/g.vec3.dot(K,r.planes[4]);g.vec3.scale(K,K,r);g.vec3.add(G,G,K);h.projectPoint(G,N)}else if(0<N[2]&&0>I[2])g.vec3.subtract(K,F,G),r=h.frustum,u=-f.plane.signedDistance(r.planes[4],F),r=u/g.vec3.dot(K,r.planes[4]),g.vec3.scale(K,K,r),g.vec3.add(F,F,K),h.projectPoint(F,I);else if(0>N[2]&&0>I[2])continue;N[2]=0;I[2]=0;r=f.lineSegment.distance2(f.lineSegment.fromPoints(N,I,L),
k);r<a&&(a=r,g.vec3.copy(J,G),g.vec3.copy(M,F))}e=l.rayBeginPoint;l=l.rayEndPoint;4>a&&(a=Number.MAX_VALUE,f.lineSegment.closestLineSegmentPoint(f.lineSegment.fromPoints(J,M,L),f.lineSegment.fromPoints(e,l,R),H)&&(g.vec3.subtract(H,H,e),a=g.vec3.length(H),g.vec3.scale(H,H,1/a),a/=g.vec3.distance(e,l)),p(a,H))}else t.error("intersection assumes a translation-only matrix")};c.prototype.createBufferWriter=function(){return new B(this.params)};c.prototype.createRenderer=function(b,a){return new u(b,a,
this)};c.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:z}};return c}(p.Material);var x=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}m(a,b);a.prototype.updateParameters=function(){this.params=w.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(v.colorPass,{slice:b.slicePlaneEnabled,vertexColors:this.params.vertexColors});
this.pipelineState=y.makePipelineState({blending:1>b.color[3]&&y.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})};a.prototype.beginSlot=function(b){return 5===b};a.prototype.getProgram=function(){return this.program};a.prototype.bind=function(b,a){a=this.program;var c=this.params;b.bindProgram(a);b.setPipelineState(this.pipelineState);a.setUniform4fv("constantColor",c.color)};a.prototype.release=function(b){};a.prototype.bindView=
function(b,a){b=this.program;var c=this.params;w.bindView(a.origin,a.view,b);c.slicePlaneEnabled&&w.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=function(){return 1};return a}(e),z=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}m(a,b);a.prototype.updateParameters=function(){this.params=w.copyParameters(this.material.getParameters());this.selectProgram()};
a.prototype.beginSlot=function(b){return 5===b};a.prototype.getProgram=function(){return this.program};a.prototype.selectProgram=function(){this.program=this.programRep.getProgram(v.highlightPass,{slice:this.params.slicePlaneEnabled,vertexColors:this.params.vertexColors});this.pipelineState=y.makePipelineState({depthTest:{func:513},colorWrite:y.defaultColorWriteParams})};a.prototype.bind=function(b,a){b.bindProgram(this.program);b.setPipelineState(this.pipelineState);w.bindHighlightRendering(b,a,
this.program)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params;w.bindView(a.origin,a.view,b);c.slicePlaneEnabled&&w.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=function(){return 1};return a}(e),A={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1},E=c.newLayout().vec3f(q.VertexAttrConstants.POSITION),B=function(){function b(b){this.vertexBufferLayout=
c.newLayout().vec3f(q.VertexAttrConstants.POSITION);b.vertexColors&&(this.vertexBufferLayout=E.vec4u8(q.VertexAttrConstants.COLOR))}b.prototype.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};b.prototype.elementCount=function(b){return b.indices[q.VertexAttrConstants.POSITION].length};b.prototype.write=function(b,a,c,d){r.writeDefaultAttributes(a,this.vertexBufferLayout,b.transformation,b.invTranspTransformation,c,d)};return b}(),G=l.vec3f64.create(),F=l.vec3f64.create(),K=l.vec3f64.create(),
H=l.vec3f64.create(),N=h.createRenderScreenPointArray3(),I=h.createRenderScreenPointArray3(),J=l.vec3f64.create(),M=l.vec3f64.create(),L=f.lineSegment.create(),R=f.lineSegment.create(),O=l.vec3f64.create(),T=[h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3()],U=[l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create(),l.vec3f64.create()],P=f.plane.create(),V=f.plane.create(),W=f.plane.create(),Q=f.plane.create();
return n})},"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(a){return h.glslifyDefineMap({SLICE:a.slice,VERTEXCOLORS:a.vertexColors})};a.colorPass={name:"native-line-color",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:d(a)+
k.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:m.Default3D};a.highlightPass={name:"native-line-highlight",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:m.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/lang ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._optionalFields=[];b._instanceIndexToGraphicUid=new Map;return b}m(e,a);e.prototype.getCachedSize=function(){var b=this._symbolSize;return{width:b[0],depth:b[1],height:b[2]}};e.prototype.doLoad=function(b){return h(this,void 0,void 0,function(){var a,c,d,e;return k(this,function(f){switch(f.label){case 0:a=this._getIdHint("_objectmat");
if(!this._isPropertyDriven("size")&&(c=z.validateSymbolLayerSize(this.symbolLayer)))throw Error();d=this.symbolLayer;return this.isByResource?[4,this._prepareModelResources(d.resource.href,b)]:[3,2];case 1:return f.sent(),[3,4];case 2:return e=d.resource?d.resource.primitive:u.defaultPrimitive,[4,this._preparePrimitiveResources(e,a)];case 3:f.sent(),f.label=4;case 4:return[2]}})})};Object.defineProperty(e.prototype,"isByResource",{get:function(){return!(!this.symbolLayer.resource||!this.symbolLayer.resource.href)},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});e.prototype._preparePrimitiveResources=function(b,a){return h(this,void 0,void 0,function(){var e,h,p,m,u,n,t,v,y,x,A,L;return k(this,function(k){if(!B.isValidPrimitive(b))throw Error("Unknown object symbol primitive: "+b);e=this.symbolLayer;this._resourceBoundingBox=w.create(B.primitiveBoundingBox(b));this._resourceSize=q.vec3f64.fromArray(w.size(this._resourceBoundingBox));
this._symbolSize=q.vec3f64.fromArray(z.computeSizeWithResourceSize(this._resourceSize,e));this._isWosr=this._isEsriSymbolResource=!1;h=f.get(this.symbolLayer,"material","color");p=this._getCombinedOpacity(h);m={specular:[0,0,0],opacity:p,transparent:1>p||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:q.vec3f64.ONES,diffuse:q.vec3f64.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows};u=this.symbol;"point-3d"===
u.type&&u.verticalOffset&&(n=u.verticalOffset,t=n.screenLength,v=n.minWorldLength,y=n.maxWorldLength,m.verticalOffset={screenLength:c.pt2px(t),minWorldLength:v||0,maxWorldLength:null!=y?y:Infinity},m.castShadows=!1);this._context.screenSizePerspectiveEnabled&&(m.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?m.externalColor=r.vec4f64.ONES:(x=f.isSome(e.material)&&e.material.color,A=f.isSome(x)?g.toUnitRGBA(x):r.vec4f64.ONES,m.externalColor=
A);this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(l.mixin(m,this._fastUpdates.materialParameters),m.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(m.instanced.push("color"),this._optionalFields.push("color"));L=new J(d({},m,M.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled),{offsetTransparentBackfaces:this.symbolLayer.isPrimitive}),
a);this._lodResources=B.primitiveLodResources(b,L,a);this._originalOpacities=I.materialsFromLodResources(this._lodResources).map(function(){return 1});if(!this._lodResources)throw Error("Unknown object symbol primitive: "+b);this._finalizeSymbolResources();this._initializeLodRenderer();this.complexity=this.computeComplexity();return[2]})})};e.prototype._prepareModelResources=function(b,a){return h(this,void 0,void 0,function(){var d,e,g,h,p,m,r,u,n,t,v,y,x,J,M,B,L,H=this;return k(this,function(k){switch(k.label){case 0:return d=
["transformation"],e={instanced:d,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},g={materialParamsMixin:e,streamDataRequester:this._context.streamDataRequester},this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(l.mixin(g.materialParamsMixin,this._fastUpdates.materialParameters),d.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&
(d.push("color"),this._optionalFields.push("color")),h=this.symbol,"point-3d"===h.type&&h.verticalOffset&&(p=h.verticalOffset,m=p.screenLength,r=p.minWorldLength,u=p.maxWorldLength,g.materialParamsMixin.verticalOffset={screenLength:c.pt2px(m),minWorldLength:r||0,maxWorldLength:null!=u?u:Infinity},g.materialParamsMixin.castShadows=!1),g.signal=a,g.usePBR=this._context.physicalBasedRenderingEnabled,[4,E.fetch(b,g)];case 1:return n=k.sent(),this._isEsriSymbolResource=n.isEsriSymbolResource,this._isWosr=
n.isWosr,t=A.makeLodResources(n.lods),A.fillEstimatedMinScreenSpaceRadius(t),t.levels.sort(function(b,a){return b.minScreenSpaceRadius-a.minScreenSpaceRadius}),t.levels[0].minScreenSpaceRadius=Math.min(2,t.levels[0].minScreenSpaceRadius),this._lodResources=t,v=this._context,y=this.symbolLayer.material,x=this._getExternalColorParameters(y),J=f.get(this.symbolLayer,"material","color"),M=this._getCombinedOpacity(J,{hasIntrinsicColor:!0}),B=this._isPropertyDriven("opacity"),L=I.materialsFromLodResources(this._lodResources),
this._originalOpacities=L.map(function(b){return b.getParameters().opacity||1}),L.forEach(function(b){var a=b.getParameters();b.setParameterValues(x);var c=a.opacity*M;b.setParameterValues({opacity:c,transparent:1>c||B||a.transparent});v.screenSizePerspectiveEnabled&&b.setParameterValues({screenSizePerspective:v.sharedResources.screenSizePerspectiveSettings})}),this._resourceBoundingBox=n.referenceBoundingBox,this._resourceSize=q.vec3f64.fromArray(w.size(this._resourceBoundingBox)),this._pivotOffset=
q.vec3f64.fromArray(this._lodResources.levels[0].pivotOffset),this._symbolSize=q.vec3f64.fromArray(z.computeSizeWithResourceSize(this._resourceSize,this.symbolLayer)),F.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions())&&L.forEach(function(b){return b.setParameterValues(H._fastUpdates.materialParameters)}),this._finalizeSymbolResources(),this._initializeLodRenderer(),this.complexity=this.computeComplexity(),[2]}})})};e.prototype._finalizeSymbolResources=
function(){var b=this._context.stage;this._materials=I.materialsFromLodResources(this._lodResources);this._materials.forEach(function(a){b.add(3,a)});this._textures=I.texturesFromLodResources(this._lodResources);this._textures.forEach(function(a){b.add(4,a)});this._geometries=I.geometriesFromLodResources(this._lodResources);this._geometries.forEach(function(a){b.add(2,a)})};e.prototype._initializeLodRenderer=function(){var a=this,c=this._context.stage;this._lodRenderer=new N.LodRenderer(this._lodResources,
this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(b){return a._instanceIndexToGraphicUid.get(b)}},this._fastUpdates.enabled?{applyTransform:function(c,d,e){c.getFeatureAttribute(d,T);b.mat4.copy(e,F.evaluateModelTransform(a._fastUpdates.materialParameters,T,e))},scaleFactor:function(b,c,d){c.getFeatureAttribute(d,T);return F.evaluateModelTransformScale(b,a._fastUpdates.materialParameters,T)}}:null);this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;c.addRenderPlugin(this._lodRenderer.slots,
this._lodRenderer)};e.prototype._getExternalColorParameters=function(b){var a={};this._isPropertyDriven("color")?a.externalColor=r.vec4f64.ONES:f.isSome(b)&&f.isSome(b.color)?a.externalColor=g.toUnitRGBA(b.color):(a.externalColor=r.vec4f64.ONES,a.colorMixMode="ignore");return a};e.prototype.destroy=function(){a.prototype.destroy.call(this);var b=this._context.stage;this._lodRenderer&&(b.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(a){return b.remove(3,
a.id)});this._textures&&this._textures.forEach(function(a){return b.remove(4,a.id)});this._geometries&&this._geometries.forEach(function(a){return b.remove(2,a.id)})};e.prototype.createGraphics3DGraphic=function(b){var a=b.graphic;if(!this._validateGeometry(a.geometry))return null;var c=t.placePointOnGeometry(a.geometry);if(f.isNone(c))return this.logger.warn("unsupported geometry type for icon symbol: "+a.geometry.type),null;var d=this.getGraphicElevationContext(a);return this._createAs3DShape(a,
c,b.renderingInfo,d,a.uid)};e.prototype.notifyDestroyGraphicLayer=function(b){this._instanceIndexToGraphicUid.delete(b.instanceIndex)};e.prototype.graphicLayerToGraphicId=function(b){return 0};e.prototype.layerOpacityChanged=function(){var b=this,a=this._isPropertyDriven("opacity"),c=this.isByResource;this._materials.forEach(function(d,e){var g=f.get(b.symbolLayer,"material","color");e=b._getCombinedOpacity(g,{hasIntrinsicColor:c})*b._originalOpacities[e];d.setParameterValues({opacity:e,transparent:1>
e||a})});return!0};e.prototype.layerElevationInfoChanged=function(b,a){return this.updateGraphics3DGraphicElevationInfo(b,a,t.needsElevationUpdates3D)};e.prototype.slicePlaneEnabledChanged=function(b,a){var c=this;this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;this._materials.forEach(function(b){b.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};e.prototype.physicalBasedRenderingChanged=function(b,a){var c=this;this._materials.forEach(function(b){c.isByResource?
c._isEsriSymbolResource&&!c._isWosr&&b.setParameterValues(M.returnDefaultPBRMaterialParameters(c._context.physicalBasedRenderingEnabled,b.getParameters().treeRendering)):b.setParameterValues(M.returnDefaultPBRMaterialParameters(c._context.physicalBasedRenderingEnabled))});return!0};e.prototype.pixelRatioChanged=function(b,a){return!0};e.prototype.applyRendererDiff=function(b,a){var c=this,d;for(d in b.diff)switch(d){case "visualVariables":if(F.updateFastSymbolUpdatesState(this._fastUpdates,a,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(b){return b.setParameterValues(c._fastUpdates.materialParameters)}),
this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};e.prototype.computeComplexity=function(){if(!this._lodResources)return a.prototype.computeComplexity.call(this);var b=I.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(b,a){return b+a.data.getIndices(H.VertexAttrConstants.POSITION).length},0)/3,c=G.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:b,primitivesPerCoordinate:0,
estimated:!1,memory:c}};e.prototype._createAs3DShape=function(b,a,c,d,e){b=this.getFastUpdateAttrValues(b);var f=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?z.mixinColorAndOpacity(c.color,c.opacity):null,g=this._context.clippingExtent;K.pointToVector(a,L,this._context.elevationProvider.spatialReference);if(g&&!t.pointInBox2D(L,g))return null;var g=this._requiresTerrainElevation(d),l=this._computeGlobalTransform(a,d,O,g?U:null);c=this._computeLocalTransform(this.symbolLayer,c,R);var h=
this._lodRenderer.instanceData,k=h.addInstance();this._instanceIndexToGraphicUid.set(k,e);h.setLocalTransform(k,c,!1);h.setGlobalTransform(k,l);b&&h.setFeatureAttribute(k,b);f&&h.setColor(k,f);e=new y(this,k,v.perLodInstanceElevationAligner,d);g&&(e.alignedTerrainElevation=U.terrainElevation);e.needsElevationUpdates=t.needsElevationUpdates3D(d.mode);t.extendPointGraphicElevationContext(e,a,this._context.elevationProvider);return e};e.prototype._computeGlobalTransform=function(b,a,c,d){a=t.computeElevation(this._context.elevationProvider,
b,a,this._context.renderCoordsHelper,d);L[0]=b.x;L[1]=b.y;L[2]=a;K.computeLinearTransformation(b.spatialReference,L,c,this._context.renderSpatialReference);return c};e.prototype._computeLocalTransform=function(a,c,d){b.mat4.identity(d);this._applyObjectRotation(c,!1,d);this._applyObjectRotation(a,!0,d);this._applyObjectScale(c,d);this._applyAnchor(a,d);return d};e.prototype._applyObjectScale=function(a,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._isPropertyDriven("size")&&
a.size?a.size:this._symbolSize,a=z.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||b.mat4.scale(c,c,a))};e.prototype.prepareSymbolLayerPatch=function(b){if("partial"===b.diff.type){var a=b.diff.diff;this._preparePatchTransform(b,a);this._preparePatchColor(b,a)}};e.prototype.updateGeometry=function(b,a){var c=a&&t.placePointOnGeometry(a);if(f.isNone(c))return!1;a=this.getGeometryElevationMode(a);if(b.elevationContext.mode!==
a)return!1;a=this._requiresTerrainElevation(b.elevationContext);this._computeGlobalTransform(c,b.elevationContext,O,a?U:null);a&&(b.alignedTerrainElevation=U.terrainElevation);this._lodRenderer.instanceData.setGlobalTransform(b.instanceIndex,O,!0);t.extendPointGraphicElevationContext(b,c,this._context.elevationProvider);return!0};e.prototype._preparePatchTransform=function(b,a){var c=this;if(a.heading||a.tilt||a.roll||a.width||a.height||a.depth||a.anchor||a.anchorPosition){var d=function(b,a,c){return(null!=
b&&"complete"===b.type?b.newValue:a)||c},e=d(a.heading,this.symbolLayer.heading,0),f=d(a.tilt,this.symbolLayer.tilt,0),g=d(a.roll,this.symbolLayer.roll,0),l=d(a.width,this.symbolLayer.width,void 0),h=d(a.height,this.symbolLayer.height,void 0),k=d(a.depth,this.symbolLayer.depth,void 0),p=d(a.anchor,this.symbolLayer.anchor,void 0),d=d(a.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete a.heading;delete a.tilt;delete a.roll;delete a.width;delete a.height;delete a.depth;delete a.anchor;delete a.anchorPosition;
var m={heading:e,tilt:f,roll:g,anchor:p,anchorPosition:d};1===this.loadStatus&&b.symbolLayerStatePatches.push(function(){c._symbolSize=q.vec3f64.fromArray(z.computeSizeWithResourceSize(c._resourceSize,{width:l,height:h,depth:k,isPrimitive:c.symbolLayer.isPrimitive}))});b.graphics3DGraphicPatches.push(function(b,a){a=c._computeLocalTransform(m,a,R);c._lodRenderer.instanceData.setLocalTransform(b.instanceIndex,a,!0)})}};e.prototype._preparePatchColor=function(b,a){var c=this;if(a.material&&"partial"===
a.material.type&&(a=a.material.diff,a.color&&"complete"===a.color.type)){var d=a.color.newValue,e=f.isSome(d)?g.toUnitRGBA(d):r.vec4f64.ONES;delete a.color;b.graphics3DGraphicPatches.push(function(b,a){if(c._hasPerInstanceColor())c._lodRenderer.instanceData.setColor(b.instanceIndex,e);else for(b=0,a=c._materials;b<a.length;b++)a[b].setParameterValues({externalColor:e})})}};e.prototype._requiresTerrainElevation=function(b){return"absolute-height"!==b.mode};e.prototype._applyObjectRotation=function(b,
a,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&a))return z.computeObjectRotation(b.heading,b.tilt,b.roll,c)};e.prototype._computeAnchor=function(b){var a=q.vec3f64.create();switch(b.anchor){case "center":p.vec3.copy(a,w.center(this._resourceBoundingBox));p.vec3.negate(a,a);break;case "top":var c=w.center(this._resourceBoundingBox);p.vec3.set(a,-c[0],-c[1],-this._resourceBoundingBox[5]);break;case "bottom":c=w.center(this._resourceBoundingBox);p.vec3.set(a,-c[0],
-c[1],-this._resourceBoundingBox[2]);break;case "relative":var c=w.center(this._resourceBoundingBox),d=w.size(this._resourceBoundingBox);b=(b=b.anchorPosition)?q.vec3f64.fromValues(b.x,b.y,b.z):q.vec3f64.ZEROS;p.vec3.multiply(a,d,b);p.vec3.add(a,a,c);p.vec3.negate(a,a);break;default:this._pivotOffset?p.vec3.negate(a,this._pivotOffset):p.vec3.copy(a,q.vec3f64.ZEROS)}return a};e.prototype._applyAnchor=function(a,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._computeAnchor(a))&&
b.mat4.translate(c,c,a)};e.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};e.prototype._fastVisualVariableConvertOptions=function(){var b=this._resourceBoundingBox?q.vec3f64.fromArray(w.size(this._resourceBoundingBox)):q.vec3f64.ONES,a=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):q.vec3f64.ZEROS,c=this._context.renderCoordsHelper.unitInMeters,d=z.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,
c),e=q.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:b,symbolSize:this._symbolSize||q.vec3f64.ONES,unitInMeters:c,transformation:{anchor:a,scale:d,rotation:e}}};return e}(x.default);a.Graphics3DObjectSymbolLayer=n;var L=q.vec3f64.create(),R=e.mat4f64.create(),O=e.mat4f64.create(),T=r.vec4f64.create(),U={verticalDistanceToGround:0,terrainElevation:0};a.default=n})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/HighlightUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){n=function(){function a(a,c,d,e){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=this.isElevationSource=!1;this.graphics3DSymbolLayer=a;this.instanceIndex=c;this.elevationAligner=d;this.elevationContext=new b(e)}a.prototype.initialize=function(b,a){};a.prototype.setVisibility=function(b){var a=this.lodRenderer.instanceData;return b!==a.getVisible(this.instanceIndex)?(a.setVisible(this.instanceIndex,b),!0):!1};a.prototype.destroy=
function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};a.prototype.alignWithElevation=function(b,a,d){this.elevationAligner&&(c.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),b=this.elevationAligner(this,this.elevationContext,b,a),null!=b&&(this.alignedTerrainElevation=b))};a.prototype.getBSRadius=function(){var b=this.lodRenderer;return b.baseBoundingSphere.radius*
b.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};a.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=l.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,v);return g.vec3.transformMat4(b,this.lodRenderer.baseBoundingSphere.center,v)};a.prototype.getBoundingBoxObjectSpace=function(b){void 0===b&&(b=f.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,v);var a=this.lodRenderer.baseBoundingBox;f.empty(b);
for(var c=0;8>c;++c)g.vec3.set(r,0===(c&1)?a[0]:a[3],0===(c&2)?a[1]:a[4],0===(c&4)?a[2]:a[5]),g.vec3.transformMat4(r,r,v),f.expandPointInPlace(b,r);return b};a.prototype.getProjectedBoundingBox=function(b,a,c,d,l){return h(this,void 0,void 0,function(){var h,p,m,n,t,y,x,z,A;return k(this,function(k){switch(k.label){case 0:h=this.getBoundingBoxObjectSpace(l);p=u;m=f.isPoint(h)?1:p.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,v);for(n=0;n<m;n++)t=p[n],r[0]=h[t[0]],r[1]=
h[t[1]],r[2]=h[t[2]],g.vec3.transformMat4(r,r,v),q[3*n+0]=r[0],q[3*n+1]=r[1],q[3*n+2]=r[2];if(!b(q,0,m))return[2,null];f.empty(h);y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(n=0;n<3*m;n+=3){for(x=0;3>x;x++)h[x]=Math.min(h[x],q[n+x]),h[x+3]=Math.max(h[x+3],q[n+x]);y&&c.push({location:q.slice(n,n+3),screenSpaceBoundingRect:y})}if(!a)return[3,5];f.center(h,w);if("absolute-height"===this.elevationContext.mode)return[3,5];z=void 0;A=e.demResolutionForBoundingBox(h,
a);k.label=1;case 1:return k.trys.push([1,3,,4]),[4,a.service.queryElevation(w[0],w[1],d,A)];case 2:return z=k.sent(),[3,4];case 3:return k.sent(),z=null,[3,4];case 4:null!=z&&f.offset(h,0,0,-this.alignedTerrainElevation+z),k.label=5;case 5:return[2,h]}})})};a.prototype.addHighlight=function(b,a){var c=this;a=p.generateHighlightId();this.addHighlightId(a);b.addExternal(function(b){c.removeHighlightId(b)},a)};a.prototype.removeHighlight=function(b){this.highlights&&this.highlights.forEach(function(a){return b.remove(a)})};
a.prototype.addHighlightId=function(b){this.highlights=this.highlights||new Set;this.highlights.add(b);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};a.prototype.removeHighlightId=function(b){this.highlights&&(this.highlights.delete(b),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(a.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},
enumerable:!0,configurable:!0});return a}();var q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=l.vec3f64.create(),w=l.vec3f64.create(),u=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],v=d.mat4f64.create();return n})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../webgl-engine/lib/lodRendering/LodResources"],function(n,a,m,k,h){function d(a){var c=
[];a.stageResources.geometries.forEach(function(b,d){c.push({material:a.stageResources.materials[d],geometry:b,textures:a.stageResources.textures})});return{components:c,minScreenSpaceRadius:a.lodThreshold,pivotOffset:a.pivotOffset}}function g(a,c){void 0===c&&(c=l);a=h.computeFaceCount(a);return Math.sqrt(a/(c*Math.PI))}Object.defineProperty(a,"__esModule",{value:!0});a.makeLodLevelResources=d;a.makeLodResources=function(a){return{levels:a.map(function(a){return d(a)})}};a.estimateMinScreenSpaceRadius=
g;a.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius||(a.minScreenSpaceRadius=g(a))})};var l=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/mathUtils ../../../../core/maybe ../../../../core/string ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/esriProvidedModelParameters ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F){function K(b){var a=b.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return a?{fileType:"gltf",url:a[1],specifiedLodIndex:null!=a[4]?Number(a[4]):null}:b.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:b,specifiedLodIndex:null}:{fileType:"unknown",url:b,specifiedLodIndex:null}}function H(a,e,f){var g=a.model,h=b.mat4f64.create(),k=[],p=new Map,m=new Map;g.lods.forEach(function(b,a){if(void 0===f||a===f){var r=0,u={name:b.name,stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:l.isSome(b.lodThreshold)?b.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:q.empty()};k.push(u);b.parts.forEach(function(a){var f=a.material+(a.attributes.normal?"_normal":"")+(a.attributes.color?"_color":"")+(a.attributes.texCoord0?"_texCoord0":"")+(a.attributes.tangent?"_tangent":""),k=g.materials.get(a.material),n=l.isSome(a.attributes.texCoord0),w=l.isSome(a.attributes.normal);if(!p.has(f)){if(n){if(l.isSome(k.textureColor)&&!m.has(k.textureColor)){var y=
g.textures.get(k.textureColor),J=d({},y.parameters,{preMultiplyAlpha:!0});m.set(k.textureColor,new B(y.data,k.textureColor,J))}l.isSome(k.textureNormal)&&!m.has(k.textureNormal)&&(y=g.textures.get(k.textureNormal),J=d({},y.parameters,{preMultiplyAlpha:!0}),m.set(k.textureNormal,new B(y.data,k.textureNormal,J)));l.isSome(k.textureOcclusion)&&!m.has(k.textureOcclusion)&&(y=g.textures.get(k.textureOcclusion),J=d({},y.parameters,{preMultiplyAlpha:!0}),m.set(k.textureOcclusion,new B(y.data,k.textureOcclusion,
J)));l.isSome(k.textureEmissive)&&!m.has(k.textureEmissive)&&(y=g.textures.get(k.textureEmissive),J=d({},y.parameters,{preMultiplyAlpha:!0}),m.set(k.textureEmissive,new B(y.data,k.textureEmissive,J)));l.isSome(k.textureMetallicRoughness)&&!m.has(k.textureMetallicRoughness)&&(y=g.textures.get(k.textureMetallicRoughness),J=d({},y.parameters,{preMultiplyAlpha:!0}),m.set(k.textureMetallicRoughness,new B(y.data,k.textureMetallicRoughness,J)))}var M=G.COLOR_GAMMA,y=Math.pow(k.color[0],1/M),J=Math.pow(k.color[1],
1/M),I=Math.pow(k.color[2],1/M),L=Math.pow(k.emissiveFactor[0],1/M),H=Math.pow(k.emissiveFactor[1],1/M),M=Math.pow(k.emissiveFactor[2],1/M);p.set(f,new G(d({transparent:"BLEND"===k.alphaMode,textureAlphaMode:N(k.alphaMode),textureAlphaCutoff:k.alphaCutoff,diffuse:[y,J,I],ambient:[y,J,I],opacity:k.opacity,doubleSided:k.doubleSided,doubleSidedType:"winding-order",cullFace:k.doubleSided?"none":"back",vertexColors:!!a.attributes.color,vertexTangents:!!a.attributes.tangent,normals:w?"default":"screenDerivative",
castShadows:!0,receiveSSAO:!0,textureId:l.isSome(k.textureColor)&&n?m.get(k.textureColor).id:void 0,colorMixMode:k.colorMixMode,normalTextureId:l.isSome(k.textureNormal)&&n?m.get(k.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:l.isSome(k.textureOcclusion)&&n?m.get(k.textureOcclusion).id:void 0,emissiveTextureId:l.isSome(k.textureEmissive)&&n?m.get(k.textureEmissive).id:void 0,metallicRoughnessTextureId:l.isSome(k.textureMetallicRoughness)&&n?m.get(k.textureMetallicRoughness).id:
void 0,emissiveFactor:[L,H,M],metallicFactor:k.metallicFactor,roughnessFactor:k.roughnessFactor,usePBR:!0},e),f))}a:{w=a.indices||a.attributes.position.count;switch(a.primitiveType){case 4:y=v.trianglesToTriangles(w);break a;case 5:y=v.triangleStripToTriangles(w);break a;case 6:y=v.triangleFanToTriangles(w);break a}y=void 0}J={};I={};w=a.attributes.position.count;L=z.createBuffer(t.BufferViewVec3f,w);x.vec3.transformMat4(L,a.attributes.position,a.transform);I.position={data:L.typedBuffer,size:L.elementCount};
J.position=y;l.isSome(a.attributes.normal)&&(L=z.createBuffer(t.BufferViewVec3f,w),c.mat4.invert(h,a.transform),c.mat4.transpose(h,h),x.vec3.transformMat4(L,a.attributes.normal,h),I.normal={data:L.typedBuffer,size:L.elementCount},J.normal=y);l.isSome(a.attributes.tangent)&&(L=z.createBuffer(t.BufferViewVec4f,w),c.mat4.invert(h,a.transform),c.mat4.transpose(h,h),x.vec4.transformMat4(L,a.attributes.tangent,h),I.aTangent={data:L.typedBuffer,size:L.elementCount},J.aTangent=y);l.isSome(a.attributes.texCoord0)&&
(L=z.createBuffer(t.BufferViewVec2f,w),z.vec2.normalizeIntegerBuffer(L,a.attributes.texCoord0),I.uv0={data:L.typedBuffer,size:L.elementCount},J.uv0=y);l.isSome(a.attributes.color)&&(L=z.createBuffer(t.BufferViewVec4u8,w),4===a.attributes.color.elementCount?a.attributes.color instanceof t.BufferViewVec4f?x.vec4.scale(L,a.attributes.color,255):a.attributes.color instanceof t.BufferViewVec4u8?z.vec4.copy(L,a.attributes.color):a.attributes.color instanceof t.BufferViewVec4u16&&x.vec4.scale(L,a.attributes.color,
1/256):(z.vec4.fill(L,255,255,255,255),H=new t.BufferViewVec3u8(L.buffer,0,4),a.attributes.color instanceof t.BufferViewVec3f?x.vec3.scale(H,a.attributes.color,255):a.attributes.color instanceof t.BufferViewVec3u8?z.vec3.copy(H,a.attributes.color):a.attributes.color instanceof t.BufferViewVec3u16&&x.vec3.scale(H,a.attributes.color,1/256)),I.color={data:L.typedBuffer,size:L.elementCount},J.color=y);a=new A(new E.GeometryData(I,J),"gltf_"+b.name+"_"+r++);u.stageResources.geometries.push(a);u.stageResources.materials.push(p.get(f));
n&&(l.isSome(k.textureColor)&&u.stageResources.textures.push(m.get(k.textureColor)),l.isSome(k.textureNormal)&&u.stageResources.textures.push(m.get(k.textureNormal)),l.isSome(k.textureOcclusion)&&u.stageResources.textures.push(m.get(k.textureOcclusion)),l.isSome(k.textureEmissive)&&u.stageResources.textures.push(m.get(k.textureEmissive)),l.isSome(k.textureMetallicRoughness)&&u.stageResources.textures.push(m.get(k.textureMetallicRoughness)));u.numberOfVertices+=w;f=a.boundingInfo;q.expand(u.boundingBox,
f.getBBMin());q.expand(u.boundingBox,f.getBBMax())})}});return k}function N(b){switch(b){case "BLEND":return"blend";case "MASK":return"mask";case "OPAQUE":return"opaque";default:return"blend"}}function I(b){var a=b.model.lods.length;b.meta.isEsriSymbolResource&&b.model.lods.forEach(function(b){if(!l.isSome(b.lodThreshold)){var c=(b.name||"").replace("Imposter","Realistic_LOD0").split("_LOD")[0],d=b.parts.reduce(function(b,a){return b+a.attributes.position.count},0);b.lodThreshold=J(c,d,a)}})}function J(b,
a,c){void 0===b&&(b="");if(1===c)return null;if(b in w.lodThresholdLUT){c=w.lodThresholdLUT[b].vertexCounts;b=w.lodThresholdLUT[b].thresholds;var d=c.length;if(1>=d)return null;if(a<=c[0]){var e=(c[1]-c[0])/(b[1]-b[0]);a-=c[0];return Math.max(0,b[0]+a*e)}if(a>=c[d-1])return e=(c[d-1]-c[d-2])/(b[d-1]-b[d-2]),a-=c[d-1],b[d-1]+a*e;for(var f=1;f<c.length;++f){var g=c[f-1],l=c[f],d=b[f-1],e=b[f];if(a<l)return a=(a-g)/(l-g),d*(1-a)+e*a}}return null}Object.defineProperty(a,"__esModule",{value:!0});a.fetch=
function(a,m){void 0===m&&(m={});return h(this,void 0,void 0,function(){var h,q,n,v,x,A,J,M,B,L;return k(this,function(k){switch(k.label){case 0:return h=K(a),"wosr"!==h.fileType?[3,2]:[4,y.load(h.url,m)];case 1:return q=k.sent(),[2,{lods:[q],referenceBoundingBox:q.boundingBox,isEsriSymbolResource:!1,isWosr:!0}];case 2:return n=new r.DefaultLoadingContext(m.streamDataRequester),[4,u.load(n,h.url,m)];case 3:v=k.sent();a:if(k=v,k.meta.isEsriSymbolResource)for(var E=0,G=k.model.lods;E<G.length;E++){var R=
G[E],N;b:{var O=R.name,W=k.meta.uri;void 0===O&&(O="");void 0===W&&(W="");N=f.endsWith(O,"Imposter");O=O.split("__")[0];if(-1!==W.indexOf("/RealisticTrees/")&&(W=w.treeParamsTable[O])){N={crownCenter:W.center,crownDimensions:W.radius,imposter:N};break b}N=void 0}if(!N)break a;k.customMeta.esriTreeRendering=!0;W=0;for(R=R.parts;W<R.length;W++){var O=R[W],P=O.attributes.normal;if(l.isNone(P))break a;for(var V=O.attributes.position,Q=V.count,T=p.vec3f64.create(),U=p.vec3f64.create(),Z=p.vec3f64.create(),
C=z.createBuffer(t.BufferViewVec4u8,Q),X=z.createBuffer(t.BufferViewVec3f,Q),aa=c.mat4.invert(b.mat4f64.create(),O.transform),D=e.vec3.transformMat4(p.vec3f64.create(),N.crownCenter,aa),aa=e.vec3.transformMat4(p.vec3f64.create(),N.crownDimensions,aa),qa=0;qa<Q;qa++){V.getVec(qa,U);P.getVec(qa,T);e.vec3.subtract(Z,U,D);e.vec3.divide(Z,Z,aa);var na=g.clamp(e.vec3.length(Z),0,1),na=.6+.4*na*na;e.vec3.lerp(Z,Z,T,.2);X.setVec(qa,Z);C.set(qa,0,255*na);C.set(qa,1,255*na);C.set(qa,2,255*na);C.set(qa,3,255)}O.attributes.normal=
X;O.attributes.color=C}}I(v);x=d({},m.materialParamsMixin,{treeRendering:v.customMeta.esriTreeRendering},v.meta.isEsriSymbolResource?m.usePBR?!0===v.customMeta.esriTreeRendering?F.defaultPBRTreeMaterialParameters:F.defaultPBRMaterialParameters:{usePBR:!1}:{usePBR:!0});if(null!=h.specifiedLodIndex)return A=H(v,x,h.specifiedLodIndex),J=A[0].boundingBox,0!==h.specifiedLodIndex&&(M=H(v,x,h.specifiedLodIndex),J=M[0].boundingBox),[2,{lods:A,referenceBoundingBox:J,isEsriSymbolResource:v.meta.isEsriSymbolResource,
isWosr:!1}];B=H(v,x);L=B[0].boundingBox;return[2,{lods:B,referenceBoundingBox:L,isEsriSymbolResource:v.meta.isEsriSymbolResource,isWosr:!1}]}})})};a.parseUrl=K;a.gltfToEngineResources=H})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(b){this.streamDataRequester=b}a.prototype.loadJSON=function(b,a){return m(this,void 0,void 0,function(){return k(this,function(c){return[2,this.load("json",b,a)]})})};a.prototype.loadBinary=function(a,d){return m(this,void 0,void 0,function(){return k(this,function(e){return b.isDataProtocol(a)?(c.throwIfAborted(d),[2,b.dataToArrayBuffer(a)]):[2,this.load("binary",a,d)]})})};a.prototype.loadImage=
function(b,a){return m(this,void 0,void 0,function(){return k(this,function(c){return[2,this.load("image",b,a)]})})};a.prototype.load=function(b,a,h){return m(this,void 0,void 0,function(){var p;return k(this,function(k){switch(k.label){case 0:return f.isNone(this.streamDataRequester)?[4,d(a,e[b])]:[3,2];case 1:return[2,k.sent().data];case 2:return[4,g.result(this.streamDataRequester.request(a,b,h))];case 3:p=k.sent();if(!0===p.ok)return[2,p.value];c.throwIfAbortError(p.error);throw new l("","Request for resource failed: "+
p.error);}})})};return a}();a.DefaultLoadingContext=n;var e={image:{responseType:"image"},binary:{responseType:"array-buffer"},json:void 0}})},"esri/views/3d/glTF/esriProvidedModelParameters":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,0,5],
radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,0,
6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},Ficus:{center:[0,
0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,0,1.5],radius:[1.2,
1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},Rhododendron_Azaleas:{center:[0,
0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,0,8],radius:[4,
4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}};a.lodThresholdLUT={Alder_Buckthorn__Realistic:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant__Realistic:{thresholds:[2,
22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut__Realistic:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore__Realistic:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot__Realistic:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine__Realistic:{thresholds:[2,131.057],vertexCounts:[18,8094]},Baldcypress__Realistic:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir__Realistic:{thresholds:[2,
64.674],vertexCounts:[18,10266]},Bamboo__Realistic:{thresholds:[2,22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree__Realistic:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood__Realistic:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel__Realistic:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust__Realistic:{thresholds:[2,28.546,88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus__Realistic:{thresholds:[2,
56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood__Realistic:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,390,1824,9876]},Cabbage_Palm_Fern__Realistic:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay__Realistic:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar__Realistic:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm__Realistic:{thresholds:[2,30.538,210.616],vertexCounts:[18,612,5760]},California_Redwood__Realistic:{thresholds:[2,
110.805],vertexCounts:[18,10260]},California_Walnut__Realistic:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm__Realistic:{thresholds:[2,21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn__Realistic:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam__Realistic:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree__Realistic:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm__Realistic:{thresholds:[2,
31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow__Realistic:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir__Realistic:{thresholds:[2,69.576],vertexCounts:[18,8544]},European_Beech__Realistic:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch__Realistic:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus__Realistic:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm__Realistic:{thresholds:[2,
34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush__Realistic:{thresholds:[2,27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood__Realistic:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree__Realistic:{thresholds:[2,67.891],vertexCounts:[18,2172]},Generic_Stump__Realistic:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown__Realistic:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia__Realistic:{thresholds:[2,
30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave__Realistic:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,384,1980,11094]},Japanese_Angelica_Tree__Realistic:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron__Realistic:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,1752,10227]},Leyland_Cypress__Realistic:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley__Realistic:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,
378,1464,4152]},Scots_Pine__Realistic:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn__Realistic:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},Mexican_Palmetto__Realistic:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany__Realistic:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak__Realistic:{thresholds:[2,15.204,33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple__Realistic:{thresholds:[2,28.322,
59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce__Realistic:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid__Realistic:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other__Realistic:{thresholds:[2,30.504,194.487],vertexCounts:[18,1572,9006]},Oval_Leaved_Privet__Realistic:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily__Realistic:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde__Realistic:{thresholds:[2,65.31,198.124],vertexCounts:[18,
2010,7668]},Paper_Birch__Realistic:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm__Realistic:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus__Realistic:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder__Realistic:{thresholds:[2,30.518,192.513],vertexCounts:[18,1770,8274]},Red_Hickory__Realistic:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas__Realistic:{thresholds:[2,47.068,192.681],
vertexCounts:[18,1044,8160]},Rose__Realistic:{thresholds:[2,66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm__Realistic:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus__Realistic:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras__Realistic:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca__Realistic:{thresholds:[2,61.287,219.899],vertexCounts:[18,1770,10176]},Shadbush__Realistic:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,
336,1932,9030]},Snake_Plant__Realistic:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia__Realistic:{thresholds:[2,63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom__Realistic:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree__Realistic:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower__Realistic:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,390,2076,7902]},Sweetgum__Realistic:{thresholds:[2,
31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia__Realistic:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper__Realistic:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash__Realistic:{thresholds:[2,33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar__Realistic:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow__Realistic:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel__Realistic:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,
330,2070,10386]},ATM_:{thresholds:[2,46.933],vertexCounts:[150,1038]},Bus_Stop_1_:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2_:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster_:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine_:{thresholds:[2,57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off_:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On_:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off_:{thresholds:[2,
46.524],vertexCounts:[147,1020]},Overhanging_Street_And_Sidewalk_Light_On_:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off_:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On_:{thresholds:[2,34.225],vertexCounts:[144,552]},Park_Bench_1_:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2_:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3_:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4_:{thresholds:[2,69.923],vertexCounts:[144,
2304]},Payphone_:{thresholds:[2,58.524],vertexCounts:[156,1614]},Picnic_Table_:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular_:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square_:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered_:{thresholds:[2,89.669],vertexCounts:[141,3789]},Rock_1_:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2_:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3_:{thresholds:[2,37.931,70.286],vertexCounts:[144,
678,2328]},Rock_4_:{thresholds:[2,41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off_:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On_:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2_:{thresholds:[2,42.819],vertexCounts:[132,864]},Trash_Bin_1_:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2_:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3_:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},
Trash_Can_1_:{thresholds:[2,58.524,98.628],vertexCounts:[150,1614,4584]},Trash_Can_2_:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox_:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance_:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6_:{thresholds:[2,63.823,484.156],vertexCounts:[300,4311,14280]},Backhoe_:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series_:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat_:{thresholds:[2,
61.105,269.127],vertexCounts:[438,4476,14952]},Bus_:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane_:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck_:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365_:{thresholds:[2,227.817],vertexCounts:[432,14733]},Eurocopter_AS365_Flying_:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125_:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying_:{thresholds:[2,
94.002,366.378],vertexCounts:[294,4164,13569]},Firetruck_:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge_:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition_:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150_:{thresholds:[2,60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta_:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback_:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},
Ford_Fusion_:{thresholds:[2,64.485,370.289],vertexCounts:[294,4500,14955]},Ford_Mustang_:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus_:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van_:{thresholds:[2,88.6,384.491],vertexCounts:[276,4443,14721]},Ford_Transit_Connect_:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass_:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat_:{thresholds:[2,
67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle_:{thresholds:[2,35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car_:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter_:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera_:{thresholds:[2,66.588,392.685],vertexCounts:[306,4473,14571]},Sailboat_:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up_:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},
Taxi_:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van_:{thresholds:[2,64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7_:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane_:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius_:{thresholds:[2,66.448,357.251],vertexCounts:[288,4266,14370]},Tram_:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon_:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},
Traffic_Light_1_:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3_:{thresholds:[2,49.12],vertexCounts:[132,1137]},Traffic_Light_4_:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]},Cell_Phone_Antenna_:{thresholds:[2,53.05602049838099,225.75567007367763],vertexCounts:[150,894,4242]},Electricity_Box_:{thresholds:[2,56.48433069112405,207.14360140104995],vertexCounts:[108,744,1026]},Electricity_Meter_:{thresholds:[2,53.4669717168887,215.04066673528195],vertexCounts:[120,384,960]},
Powerline_Pole_:{thresholds:[2,28.11004122822377,58.29783783397482],vertexCounts:[120,840,3678]},Radio_Antenna_:{thresholds:[2,32.2179270951266,462.06696540941175],vertexCounts:[297,1815,9009]},Wind_Turbine_:{thresholds:[2,56.15679308163878,247.66420622007408],vertexCounts:[291,1806,7974]},Bike_Rack_:{thresholds:[2,33.4134686118416,742.2476610265626],vertexCounts:[138,900,3948]},Fire_Hydrant_:{thresholds:[2,30.215510249190537,390.42722821984944],vertexCounts:[156,894,2676]},Fountain_1_:{thresholds:[2,
52.36907652663328,221.4335455931077],vertexCounts:[300,1782,8052]},Fountain_2_:{thresholds:[2,58.20077988776262,254.01846725224388],vertexCounts:[288,1794,8526]},Fountain_3_:{thresholds:[2,30.089436161855176,215.0465007031079],vertexCounts:[306,1800,8880]},Fountain_4_:{thresholds:[2,90.06038366113779,351.6045839690371],vertexCounts:[252,1656,2136]},Mailbox_:{thresholds:[2,52.806020498381045,378.6213345953622],vertexCounts:[150,894,4494]},Sewer_Grate_:{thresholds:[2,32.31186201200472,388.7801192944885],
vertexCounts:[60,492,1788]},Storm_Drain_:{thresholds:[2,93.440164912895,355.73135487536024],vertexCounts:[150,840,3300]},Traffic_Pylon_:{thresholds:[2,59.30348706874729,388.12062237971986],vertexCounts:[138,756,1740]},Airplane_Large_Passenger_:{thresholds:[2,32.63681118513339,229.25055778384916],vertexCounts:[303,1614,7086]},Airplane_Large_Passenger_With_Wheels_:{thresholds:[2,57.56132180109627,219.23679864871204],vertexCounts:[450,2550,9186]},Airplane_Private_:{thresholds:[2,55.15153188839752,218.4051249478359],
vertexCounts:[300,1209,6894]},Airplane_Private_With_Wheels_:{thresholds:[2,54.962671511046956,225.3801611565773],vertexCounts:[366,1737,8454]},Airplane_Propeller_:{thresholds:[2,55.03627391751588,214.63956781455144],vertexCounts:[291,1560,8502]},Airplane_Propeller_With_Wheels_:{thresholds:[2,57.1404638556843,221.48743600008154],vertexCounts:[303,1776,9006]},Airplane_Small_Passenger_:{thresholds:[2,56.98035485213009,217.0648860940108],vertexCounts:[300,1530,8946]},Airplane_Small_Passenger_With_Wheels_:{thresholds:[2,
56.402226419354996,227.53633450087503],vertexCounts:[456,1698,11400]},Cargo_Box_:{thresholds:[2,180.55115902122088,360.2534460453696],vertexCounts:[132,672,3738]},Cargo_Ship_Empty_:{thresholds:[2,58.00721049029622,327.1185961587389],vertexCounts:[444,2616,10896]},Cargo_Ship_Full_:{thresholds:[2,55.386139460867525,346.87126261041203],vertexCounts:[450,2670,10950]},City_Bike_:{thresholds:[2,56.670817449986885,242.3113495346381],vertexCounts:[300,1785,8736]},Delivery_Truck_:{thresholds:[2,34.92797405514993,
120.33485126686935],vertexCounts:[408,2130,13248]},High_Speed_Train_:{thresholds:[2,58.255981072570464,405.19492233117126],vertexCounts:[276,1908,11928]},Mountain_Bike_:{thresholds:[2,30.151936161855172,115.15158622172994],vertexCounts:[294,1800,8994]},Pickup_Truck_Ford_F250_:{thresholds:[2,31.705838007504713,69.25663661786093],vertexCounts:[300,1770,8976]},Pickup_Truck_Toyota_Hilux_:{thresholds:[2,56.84455317543219,128.81569681781366],vertexCounts:[306,1716,9048]},Road_Bike_:{thresholds:[2,44.97251491181105,
127.30122549350301],vertexCounts:[297,1788,8916]},Semi_Trailer_Truck_:{thresholds:[2,35.382538898732484,127.42462492550419],vertexCounts:[282,1740,8997]},Tractor_:{thresholds:[2,33.01181118513338,128.39790644030703],vertexCounts:[306,1614,8961]},Tractor_And_Trailer_:{thresholds:[2,33.18284541984615,130.95719106637375],vertexCounts:[450,2502,12894]},Trailer_:{thresholds:[2,30.327031957706836,119.19765978853422],vertexCounts:[270,1440,9E3]},Train_Europe_:{thresholds:[2,31.15174353437363,105.3408295387661],
vertexCounts:[138,756,3846]},Train_Europe_With_Carriages_:{thresholds:[2,57.97062023935375,355.8054399222865],vertexCounts:[408,2682,10596]},Train_US_:{thresholds:[2,27.776264387000953,61.24231873858716],vertexCounts:[156,618,3648]},Tricycle_:{thresholds:[2,31.87237750582925,132.64683491853526],vertexCounts:[297,1746,8136]},Truck_With_Trailer_:{thresholds:[2,57.64037298915464,361.21271516459444],vertexCounts:[438,2478,13476]},Orange_Tree__Realistic:{thresholds:[2,25.470734736913386,62.118518915365755,
128.10642692525323],vertexCounts:[18,354,1524,10302]},American_Football_Goal_:{thresholds:[2,34.76135530828228,712.2046360848831],vertexCounts:[147,588,2688]},Basketball_Hoop_:{thresholds:[2,52.74512035232253,208.15783725757558],vertexCounts:[123,768,4260]},Jungle_Gym_:{thresholds:[2,47.5885918871016,256.602450987006],vertexCounts:[294,1773,8916]},Slide_:{thresholds:[2,29.23625745590553,729.2078902902748],vertexCounts:[252,1788,7440]},Soccer_Goal_:{thresholds:[2,33.671199284957794,364.5834082156921],
vertexCounts:[138,870,4266]},Swing_:{thresholds:[2,32.70510997459713,449.6062391021012],vertexCounts:[300,1734,7176]},Teeter_Totter_:{thresholds:[2,53.23896332520353,456.4221097287286],vertexCounts:[294,1710,7794]},Balsam_Fir__Schematic:{thresholds:[2,107.63596252927391,859.3878782201409],vertexCounts:[66,126,222]},Umbrella_Acacia__Schematic:{thresholds:[2,28.236981042654023,770.1463507109006],vertexCounts:[138,630,2238]},Sugar_Maple__Schematic:{thresholds:[2,14.35031627906977,881.1466235565822],
vertexCounts:[108,852,3396]},Conker_Tree__Schematic:{thresholds:[2,15.284392361111118,832.0115049504952],vertexCounts:[108,852,3396]},Hedgehog_Agave__Schematic:{thresholds:[2,14.987731203007513,823.8048558262012],vertexCounts:[72,792,3312]},Ruffle_Palm__Schematic:{thresholds:[2,12.135573455233287,817.5737099621688],vertexCounts:[108,852,3396]},Red_Alder__Schematic:{thresholds:[2,14.01284931506851,780.2679999999996],vertexCounts:[108,852,3396]},Shadbush__Schematic:{thresholds:[2,29.80464285714286,
842.6101098901099],vertexCounts:[72,792,3312]},Japanese_Angelica_Tree__Schematic:{thresholds:[2,15.115126024590165,799.501264413519],vertexCounts:[108,852,3396]},Strawberry_Tree__Schematic:{thresholds:[2,15.083150000000003,818.0121967213113],vertexCounts:[108,852,3396]},Paper_Birch__Schematic:{thresholds:[2,10.303635227272727,878.0123272727276],vertexCounts:[108,780,2100]},Orchid__Schematic:{thresholds:[2,26.07269215291752,923.3067065420558],vertexCounts:[108,780,2100]},Boxwood__Schematic:{thresholds:[2,
15.198452928870296,830.9156959761549],vertexCounts:[108,852,3396]},California_Incense_Cedar__Schematic:{thresholds:[2,12.739357933579337,864.1071448275861],vertexCounts:[138,630,2238]},Saguaro_Cactus__Schematic:{thresholds:[2,27.560375000000015,919.7996596551259],vertexCounts:[108,780,2100]},Red_Hickory__Schematic:{thresholds:[2,16.855436823104693,800.57046628131],vertexCounts:[108,852,3396]},American_Chestnut__Schematic:{thresholds:[2,17.239219730941716,846.5782343859651],vertexCounts:[108,852,3396]},
Australian_Pine__Schematic:{thresholds:[2,16.529950965824664,803.2413670133733],vertexCounts:[138,630,2238]},Mountain_Mahogany__Schematic:{thresholds:[2,13.008124060150381,917.9049999999999],vertexCounts:[108,852,3396]},Parlour_Palm__Schematic:{thresholds:[2,14.524522935779814,819.898849909584],vertexCounts:[108,780,2100]},Desert_Willow__Schematic:{thresholds:[2,14.02700704225353,920.7354144884243],vertexCounts:[108,852,3396]},Orange_Tree__Schematic:{thresholds:[2,14.192646264057018,861.1305417111394],
vertexCounts:[108,852,3396]},Coconut_Palm__Schematic:{thresholds:[2,16.367034412955462,902.0106492659056],vertexCounts:[108,852,3396]},Lily_Of_The_Valley__Schematic:{thresholds:[2,51.11744751381218,792.1491071428572],vertexCounts:[138,630,2238]},Palm_Lily__Schematic:{thresholds:[2,15.243925287356316,799.762794117647],vertexCounts:[108,780,2100]},Flowering_Dogwood__Schematic:{thresholds:[2,15.508128172588837,810.379933284989],vertexCounts:[108,852,3396]},Common_Hawthorn__Schematic:{thresholds:[2,15.159807441253282,
889.5056919060053],vertexCounts:[72,792,3312]},Leyland_Cypress__Schematic:{thresholds:[2,14.94957231404959,805.2679669421484],vertexCounts:[108,852,3396]},Amazon_Sword_Plant__Schematic:{thresholds:[2,17.358711448598132,824],vertexCounts:[108,852,3396]},Blue_Gum_Eucalyptus__Schematic:{thresholds:[2,26.441309523809522,820.3575976676384],vertexCounts:[138,630,2238]},European_Beech__Schematic:{thresholds:[2,25.26955788590608,871.8532751677853],vertexCounts:[138,630,2238]},Ficus__Schematic:{thresholds:[2,
15.364387681159425,800.1358897637797],vertexCounts:[108,852,3396]},Alder_Buckthorn__Schematic:{thresholds:[2,16.64437797619048,1028.757943743938],vertexCounts:[108,852,3396]},White_Ash__Schematic:{thresholds:[2,14.981912280701744,776.9208385269121],vertexCounts:[108,852,3396]},Flannelbush__Schematic:{thresholds:[2,15.24620504087194,805.9792635498547],vertexCounts:[72,792,3312]},Generic_Dead_Tree__Schematic:{thresholds:[2,15.068557103064066,858],vertexCounts:[108,852,3396]},Witch_Hazel__Schematic:{thresholds:[2,
15.320549999999995,801.9632958152956],vertexCounts:[108,852,3396]},Sunflower__Schematic:{thresholds:[2,30.66128647686832,796.1051534500516],vertexCounts:[108,852,3396]},California_Walnut__Schematic:{thresholds:[2,16.488717712177117,895.3309873754151],vertexCounts:[108,852,3396]},Western_Juniper__Schematic:{thresholds:[2,26.945806855636135,767.2468292682922],vertexCounts:[138,630,2238]},European_Larch__Schematic:{thresholds:[2,13.155643356643353,830.1452680652685],vertexCounts:[138,630,2238]},Bay_Laurel__Schematic:{thresholds:[2,
14.695218421052633,808.1161693811073],vertexCounts:[138,630,2238]},Oval_Leaved_Privet__Schematic:{thresholds:[2,14.822584645669306,828.4657637795276],vertexCounts:[72,792,3312]},Sweetgum__Schematic:{thresholds:[2,14.500420491803279,792.8281936148301],vertexCounts:[138,630,2238]},Southern_Magnolia__Schematic:{thresholds:[2,15.046679712460072,778.8604087591239],vertexCounts:[108,852,3396]},Banana_Tree__Schematic:{thresholds:[2,14.268900557620823,855.4758067831449],vertexCounts:[108,780,2100]},Prickly_Pear_Cactus__Schematic:{thresholds:[2,
14.461720869565228,817.0421426086955],vertexCounts:[72,720,2016]},Generic_Unknown__Schematic:{thresholds:[2,14.366287644787645,899.208477804681],vertexCounts:[108,852,3396]},Palo_Verde__Schematic:{thresholds:[2,28.513162650602432,932.5919321314955],vertexCounts:[138,630,2238]},Lacy_Tree_Philodendron__Schematic:{thresholds:[2,15.89430837004405,797.5864920353984],vertexCounts:[102,570,2154]},Cabbage_Palm_Fern__Schematic:{thresholds:[2,29.3428324742268,1016],vertexCounts:[102,570,2154]},Date_Palm__Schematic:{thresholds:[2,
13.186208480565373,956.3961600000001],vertexCounts:[108,852,3396]},Bamboo__Schematic:{thresholds:[2,114.71951515151522,843.8529763779525],vertexCounts:[60,132,276]},Norway_Spruce__Schematic:{thresholds:[2,129.71889887640438,911.9744719101127],vertexCounts:[66,126,222]},Scots_Pine__Schematic:{thresholds:[2,31.596748201438846,802.180143884892],vertexCounts:[138,630,2238]},American_Sycamore__Schematic:{thresholds:[2,17.793048780487815,818.0204116094988],vertexCounts:[108,852,3396]},White_Poplar__Schematic:{thresholds:[2,
15.577301587301578,793.0779038047372],vertexCounts:[108,780,2100]},Apricot__Schematic:{thresholds:[2,17.03619453924915,796.0093830508479],vertexCounts:[108,852,3396]},Douglas_Fir__Schematic:{thresholds:[2,6.898190007037297,871.0619788881072],vertexCounts:[126,636,1956]},White_Oak__Schematic:{thresholds:[2,13.248768433179723,895.745945945946],vertexCounts:[108,852,3396]},Mediterranean_Buckthorn__Schematic:{thresholds:[2,15.481177685950412,814.9279016681298],vertexCounts:[108,852,3396]},Rhododendron_Azaleas__Schematic:{thresholds:[2,
14.877305555555564,813.5712917369306],vertexCounts:[108,852,3396]},Black_Locust__Schematic:{thresholds:[2,16.01144497607656,791.7159498154983],vertexCounts:[108,852,3396]},Rose__Schematic:{thresholds:[2,14.787227941176468,800.0478006734006],vertexCounts:[108,852,3396]},Mexican_Palmetto__Schematic:{thresholds:[2,13.546397993311047,909.3318618618619],vertexCounts:[108,852,3396]},White_Willow__Schematic:{thresholds:[2,15.464474625144176,821.6042260668969],vertexCounts:[108,852,3396]},Snake_Plant__Schematic:{thresholds:[2,
116.3567710843375,792.3341835147744],vertexCounts:[60,132,276]},Sassafras__Schematic:{thresholds:[2,28.228858319604583,870.7394179022517],vertexCounts:[138,630,2238]},California_Redwood__Schematic:{thresholds:[2,12.938791007615702,889.7742940831868],vertexCounts:[108,780,2100]},Giant_Sequoia__Schematic:{thresholds:[2,13.939714285714274,828.8460395256916],vertexCounts:[138,630,2238]},Common_Whitebeam__Schematic:{thresholds:[2,15.902902542372882,872.9050708661416],vertexCounts:[108,852,3396]},Spanish_Broom__Schematic:{thresholds:[2,
14.866623996789723,815.3769117174961],vertexCounts:[72,792,3312]},Generic_Stump__Schematic:{thresholds:[2,121.01622222222227,923.740137931034],vertexCounts:[60,132,276]},Baldcypress__Schematic:{thresholds:[2,16.348127777777776,817.8199690358902],vertexCounts:[138,630,2238]},Basswood__Schematic:{thresholds:[2,15.118691605839418,835.9789696969701],vertexCounts:[108,852,3396]},Field_Elm__Schematic:{thresholds:[2,15.185642361111121,804.1571316818777],vertexCounts:[108,852,3396]},California_Bay__Schematic:{thresholds:[2,
14.085977419354833,841.5876923076921],vertexCounts:[108,852,3396]},California_Palm__Schematic:{thresholds:[2,13.896321678321671,843.3262657342657],vertexCounts:[138,630,2238]},Sea_Islands_Yucca__Schematic:{thresholds:[2,28.116965753424623,870.5225410421126],vertexCounts:[102,570,2154]}}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){function e(b,a){return m(this,void 0,void 0,function(){function c(e,f){return m(this,void 0,void 0,function(){var g,l,h,p,m,q,r,u,n;return k(this,function(k){switch(k.label){case 0:g=d.nodes[e];l=b.getNodeTransform(e);w.warnUnsupportedIf(null!=g.weights,"Morph targets are not supported.");if(null==g.mesh)return[3,4];h=d.meshes[g.mesh];p=0;m=h.primitives;k.label=1;case 1:if(!(p<m.length))return[3,4];q=m[p];return[4,a(q,l,f,h.name)];case 2:k.sent(),k.label=3;case 3:return p++,
[3,1];case 4:r=0,u=g.children||[],k.label=5;case 5:if(!(r<u.length))return[3,8];n=u[r];return[4,c(n,f)];case 6:k.sent(),k.label=7;case 7:return r++,[3,5];case 8:return[2]}})})}var d,e,f,l,h,p,q,r,u,n;return k(this,function(a){switch(a.label){case 0:d=b.json,e=d.scenes[d.scene||0],f=e.nodes,l=1<f.length,h=0,p=f,a.label=1;case 1:if(!(h<p.length))return[3,4];q=p[h];r=d.nodes[q];u=[c(q,0)];r.extensions&&r.extensions.MSFT_lod&&Array.isArray(r.extensions.MSFT_lod.ids)&&!l&&(n=r.extensions.MSFT_lod.ids,
u.push.apply(u,n.map(function(b,a){return c(b,a+1)})));return[4,g.all(u)];case 2:a.sent(),a.label=3;case 3:return h++,[3,1];case 4:return[2]}})})}function p(b,a,d){var e=function(a){var e=d+"_tex_"+(a&&a.id)+(a&&a.name?"_"+a.name:"");if(a&&!b.textures.has(e)){var f=c.makeTextureSource(a.data,{wrap:{s:q(a.wrapS),t:q(a.wrapT)},mipmap:u.some(function(b){return b===a.minFilter}),noUnpackFlip:!0});b.textures.set(e,f)}return e},f=d+"_mat_"+a.id+"_"+a.name;b.materials.has(f)||(a=c.makeMaterialParameters({color:[a.color[0],
a.color[1],a.color[2]],opacity:a.color[3],alphaMode:a.alphaMode,alphaCutoff:a.alphaCutoff,doubleSided:a.doubleSided,colorMixMode:a.ESRI_externalColorMixMode,textureColor:a.colorTexture?e(a.colorTexture):void 0,textureNormal:a.normalTexture?e(a.normalTexture):void 0,textureOcclusion:a.occlusionTexture?e(a.occlusionTexture):void 0,textureEmissive:a.emissiveTexture?e(a.emissiveTexture):void 0,textureMetallicRoughness:a.metallicRoughnessTexture?e(a.metallicRoughnessTexture):void 0,emissiveFactor:[a.emissiveFactor[0],
a.emissiveFactor[1],a.emissiveFactor[2]],metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor}),b.materials.set(f,a));return f}function q(b){if(33071===b||33648===b||10497===b)return b;w.error("Unexpected TextureSampler WrapMode: "+b)}Object.defineProperty(a,"__esModule",{value:!0});var r=0;a.load=function(a,c,f){void 0===f&&(f={});return m(this,void 0,void 0,function(){var g,h,q,u,n=this;return k(this,function(t){switch(t.label){case 0:return[4,b.Resource.load(a,w,c,f)];case 1:return g=
t.sent(),h="gltf_"+r++,q={lods:[],materials:new Map,textures:new Map},u=!(!g.json.asset.extras||"symbolResource"!==g.json.asset.extras.ESRI_type),[4,e(g,function(b,a,c,e){return m(n,void 0,void 0,function(){var m,r,u,n,t,y,x,z,A,B;return k(this,function(k){switch(k.label){case 0:m=void 0!==b.mode?b.mode:4;a:switch(m){case 4:case 5:case 6:r=m;break a;default:r=null}return d.isNone(r)?(w.warnUnsupported("Unsupported primitive mode ("+v[m]+"). Skipping primitive."),[2]):g.hasPositions(b)?[4,g.getMaterial(b,
f)]:(w.warn("Skipping primitive without POSITION vertex attribute."),[2]);case 1:return u=k.sent(),t={transform:l.mat4f64.clone(a)},y={},[4,g.getPositionData(b,f)];case 2:return t.attributes=(y.position=k.sent(),y.normal=null,y.texCoord0=null,y.color=null,y.tangent=null,y),[4,g.getIndexData(b,f)];case 3:n=(t.indices=k.sent(),t.primitiveType=r,t.material=p(q,u,h),t);if(!g.hasNormals(b))return[3,5];x=n.attributes;return[4,g.getNormalData(b,f)];case 4:x.normal=k.sent(),k.label=5;case 5:if(!g.hasTangents(b))return[3,
7];z=n.attributes;return[4,g.getTangentData(b,f)];case 6:z.tangent=k.sent(),k.label=7;case 7:if(!g.hasTextureCoordinates(b))return[3,9];A=n.attributes;return[4,g.getTextureCoordinates(b,f)];case 8:A.texCoord0=k.sent(),k.label=9;case 9:if(!g.hasVertexColors(b))return[3,11];B=n.attributes;return[4,g.getVertexColors(b,f)];case 10:B.color=k.sent(),k.label=11;case 11:return q.lods[c]=q.lods[c]||{parts:[],name:e,lodThreshold:null},q.lods[c].parts.push(n),[2]}})})})];case 2:return t.sent(),[2,{model:q,meta:{isEsriSymbolResource:u,
uri:g.uri},customMeta:{}}]}})})};var w=new f.DefaultErrorContext,u=[9987,9985],v="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Error","../../../core/Logger"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=k.getLogger("esri.views.3d.glTF");n=function(){function a(){}a.prototype.error=function(a){throw new m("gltf-loader-error",a);};a.prototype.errorUnsupported=
function(a){throw new m("gltf-loader-unsupported-feature",a);};a.prototype.errorUnsupportedIf=function(a,d){a&&this.errorUnsupported(d)};a.prototype.assert=function(a,d){a||this.error(d)};a.prototype.warn=function(a){h.warn(a)};a.prototype.warnUnsupported=function(a){this.warn("[Unsupported Feature] "+a)};a.prototype.warnUnsupportedIf=function(a,d){a&&this.warnUnsupported(d)};return a}();a.DefaultErrorContext=n})},"esri/views/3d/glTF/LoaderResult":function(){define(["require","exports","../../../core/tsSupport/assignHelper"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.makeMaterialParameters=function(a){void 0===a&&(a={});return m({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},a)};a.makeTextureSource=function(a,h){void 0===
h&&(h={});return{data:a,parameters:m({wrap:m({s:10497,t:10497},h.wrap),noUnpackFlip:!0,mipmap:!1},h)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/promiseUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){function t(b){switch(b.componentType){case 5120:return new v.BufferViewVec2i8(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5121:return new v.BufferViewVec2u8(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5122:return new v.BufferViewVec2i16(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5123:return new v.BufferViewVec2u16(b.raw,b.byteOffset,b.byteStride,b.byteOffset+
b.byteStride*b.entryCount);case 5125:return new v.BufferViewVec2u32(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5126:return new v.BufferViewVec2f(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);default:d.neverReached(b.componentType)}}function x(b){return m(this,void 0,void 0,function(){return k(this,function(a){return[2,g.create(function(a,c){var d=new Blob([b]),e=new FileReader;e.onload=function(){a(JSON.parse(e.result))};e.onerror=function(b){c(b)};
e.readAsText(d)})]})})}function z(b,a){return m(this,void 0,void 0,function(){return k(this,function(c){return[2,g.create(function(c,d){var e=new Blob([b],{type:a}),f=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(f);c(g)});g.addEventListener("error",function(b){URL.revokeObjectURL(f);d(b)});g.src=f})]})})}Object.defineProperty(a,"__esModule",{value:!0});var A;n=function(){function a(b,a,c,d,e){this.context=b;this.errorContext=a;this.uri=c;this.json=d;
this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=u.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();a.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");a.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");a.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");this.computeNodeParents()}a.load=function(b,c,d,e){return m(this,
void 0,void 0,function(){var f,g,h,p,m,q;return k(this,function(k){switch(k.label){case 0:return l.endsWith(d,".gltf")?[4,b.loadJSON(d,e)]:[3,2];case 1:return f=k.sent(),[2,new a(b,c,d,f)];case 2:return l.endsWith(d,".glb")?[4,b.loadBinary(d,e)]:[3,5];case 3:return g=k.sent(),[4,a.parseGLB(c,g)];case 4:return h=k.sent(),[2,new a(b,c,d,h.json,h.binaryData)];case 5:return[4,b.loadBinary(d,e)];case 6:return p=k.sent(),m=new r.BinaryStreamReader(p),4<=m.remainingBytes()&&1179937895===m.readUint32()?[4,
a.parseGLB(c,p)]:[3,8];case 7:return h=k.sent(),[2,new a(b,c,d,h.json,h.binaryData)];case 8:return[4,b.loadJSON(d,e)];case 9:return q=k.sent(),[2,new a(b,c,d,q)]}})})};a.parseGLB=function(b,a){return m(this,void 0,void 0,function(){var c,d,e,f,g,l,h,p,m;return k(this,function(k){switch(k.label){case 0:c=new r.BinaryStreamReader(a),b.assert(12<=c.remainingBytes(),"GLB binary data is insufficiently large."),d=c.readUint32(),e=c.readUint32(),f=c.readUint32(),b.assert(1179937895===d,"Magic first 4 bytes do not fit to expected GLB value."),
b.assert(a.byteLength>=f,"GLB binary data is smaller than header specifies."),b.errorUnsupportedIf(2!==e,"An unsupported GLB container version was detected. Only version 2 is supported."),g=0,k.label=1;case 1:if(!(8<=c.remainingBytes()))return[3,5];p=c.readUint32();m=c.readUint32();if(0!==g)return[3,3];b.assert(1313821514===m,"First GLB chunk must be JSON.");b.assert(0<=p,"No JSON data found.");return[4,x(c.readUint8Array(p))];case 2:return l=k.sent(),[3,4];case 3:1===g?(b.errorUnsupportedIf(5130562!==
m,"Second GLB chunk expected to be BIN."),h=c.readUint8Array(p)):b.warnUnsupported("More than 2 GLB chunks detected. Skipping."),k.label=4;case 4:return g+=1,[3,1];case 5:return l||b.error("No GLB JSON chunk detected."),[2,{json:l,binaryData:h}]}})})};a.prototype.getBuffer=function(b,a){return m(this,void 0,void 0,function(){var c,d,e,f;return k(this,function(g){switch(g.label){case 0:return c=this.json.buffers[b],d=this.errorContext,null==c.uri?(d.assert(null!=this.glbBuffer,"GLB buffer not present"),
[2,this.glbBuffer]):(e=this.bufferCache.get(b))?[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri),a)];case 1:f=g.sent(),e=new Uint8Array(f),this.bufferCache.set(b,e),d.assert(e.byteLength===c.byteLength,"Buffer byte lengths should match."),g.label=2;case 2:return[2,e]}})})};a.prototype.getAccessor=function(b,a){return m(this,void 0,void 0,function(){var c,d,e,f,g,l,h,p;return k(this,function(k){switch(k.label){case 0:return c=this.json.accessors[b],d=this.errorContext,d.errorUnsupportedIf(null==
c.bufferView,"Some accessor does not specify a bufferView."),d.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),e=this.json.bufferViews[c.bufferView],[4,this.getBuffer(e.buffer,a)];case 1:return f=k.sent(),g=F[c.type],l=K[c.componentType],h=g*l,p=e.byteStride||h,[2,{raw:f.buffer,byteStride:p,byteOffset:f.byteOffset+(e.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:p===h,componentCount:g,componentByteSize:l,componentType:c.componentType,
min:c.min,max:c.max,normalized:!!c.normalized}]}})})};a.prototype.getIndexData=function(b,a){return m(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return null==b.indices?[2,null]:[4,this.getAccessor(b.indices,a)];case 1:c=d.sent();if(c.isDenselyPacked)switch(c.componentType){case 5121:return[2,new Uint8Array(c.raw,c.byteOffset,c.entryCount)];case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,new Uint32Array(c.raw,c.byteOffset,
c.entryCount)]}else switch(c.componentType){case 5121:return[2,y.scalar.makeDense(this.wrapAccessor(v.BufferViewUint8,c))];case 5123:return[2,y.scalar.makeDense(this.wrapAccessor(v.BufferViewUint16,c))];case 5125:return[2,y.scalar.makeDense(this.wrapAccessor(v.BufferViewUint32,c))]}return[2,void 0]}})})};a.prototype.getPositionData=function(b,a){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==b.attributes.POSITION,
"No POSITION vertex data found."),[4,this.getAccessor(b.attributes.POSITION,a)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+H[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"POSITION vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(v.BufferViewVec3f,d)]}})})};a.prototype.getNormalData=function(b,a){return m(this,void 0,void 0,function(){var c,d;
return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=b.attributes.NORMAL,"No NORMAL vertex data found."),[4,this.getAccessor(b.attributes.NORMAL,a)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+H[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"NORMAL vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(v.BufferViewVec3f,
d)]}})})};a.prototype.getTangentData=function(b,a){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=b.attributes.TANGENT,"No TANGENT vertex data found."),[4,this.getAccessor(b.attributes.TANGENT,a)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+H[d.componentType]),c.errorUnsupportedIf(4!==d.componentCount,"TANGENT vertex attribute must have 4 components, but found "+
d.componentCount.toFixed()),[2,new v.BufferViewVec4f(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)]}})})};a.prototype.getTextureCoordinates=function(b,a){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=b.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),[4,this.getAccessor(b.attributes.TEXCOORD_0,a)];case 1:d=e.sent();c.errorUnsupportedIf(2!==d.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+
d.componentCount.toFixed());if(5126===d.componentType)return[2,this.wrapAccessor(v.BufferViewVec2f,d)];c.errorUnsupportedIf(!d.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return[2,t(d)]}})})};a.prototype.getVertexColors=function(b,a){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=b.attributes.COLOR_0,"No COLOR_0 vertex data found."),[4,this.getAccessor(b.attributes.COLOR_0,
a)];case 1:d=e.sent();c.errorUnsupportedIf(4!==d.componentCount&&3!==d.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+d.componentCount.toFixed());if(4===d.componentCount){if(5126===d.componentType)return[2,this.wrapAccessor(v.BufferViewVec4f,d)];if(5121===d.componentType)return[2,this.wrapAccessor(v.BufferViewVec4u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(v.BufferViewVec4u16,d)]}else if(3===d.componentCount){if(5126===d.componentType)return[2,this.wrapAccessor(v.BufferViewVec3f,
d)];if(5121===d.componentType)return[2,this.wrapAccessor(v.BufferViewVec3u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(v.BufferViewVec3u16,d)]}c.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+H[d.componentType]);return[2,void 0]}})})};a.prototype.hasPositions=function(b){return void 0!==b.attributes.POSITION};a.prototype.hasNormals=function(b){return void 0!==b.attributes.NORMAL};a.prototype.hasVertexColors=function(b){return void 0!==b.attributes.COLOR_0};a.prototype.hasTextureCoordinates=
function(b){return void 0!==b.attributes.TEXCOORD_0};a.prototype.hasTangents=function(b){return void 0!==b.attributes.TANGENT};a.prototype.getMaterial=function(b,a){return m(this,void 0,void 0,function(){var c,d,e,f,g,l,h,p,m,q,r;return k(this,function(k){switch(k.label){case 0:c=this.errorContext;if(d=this.materialCache.get(b.material))return[3,15];e=null!=b.material?w.material(this.json.materials[b.material]):w.material();f=e.pbrMetallicRoughness;g=this.hasVertexColors(b);l=void 0;if(!f.baseColorTexture)return[3,
2];c.errorUnsupportedIf(0!==(f.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported.");return[4,this.getTexture(f.baseColorTexture.index,a)];case 1:l=k.sent(),k.label=2;case 2:h=void 0;if(!e.normalTexture)return[3,5];if(0===(e.normalTexture.texCoord||0))return[3,3];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture.");return[3,5];case 3:return[4,this.getTexture(e.normalTexture.index,a)];case 4:h=k.sent(),k.label=5;case 5:p=void 0;if(!e.occlusionTexture)return[3,
8];if(0===(e.occlusionTexture.texCoord||0))return[3,6];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture.");return[3,8];case 6:return[4,this.getTexture(e.occlusionTexture.index,a)];case 7:p=k.sent(),k.label=8;case 8:m=void 0;if(!e.emissiveTexture)return[3,11];if(0===(e.emissiveTexture.texCoord||0))return[3,9];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture.");return[3,11];case 9:return[4,this.getTexture(e.emissiveTexture.index,
a)];case 10:m=k.sent(),k.label=11;case 11:q=void 0;if(!f.metallicRoughnessTexture)return[3,14];if(0===(f.metallicRoughnessTexture.texCoord||0))return[3,12];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture.");return[3,14];case 12:return[4,this.getTexture(f.metallicRoughnessTexture.index,a)];case 13:q=k.sent(),k.label=14;case 14:r=null!=b.material?b.material:-1,d={alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,color:f.baseColorFactor,doubleSided:!!e.doubleSided,
colorTexture:l,normalTexture:h,name:e.name,id:r,occlusionTexture:p,emissiveTexture:m,emissiveFactor:e.emissiveFactor,metallicFactor:f.metallicFactor,roughnessFactor:f.roughnessFactor,metallicRoughnessTexture:q,vertexColors:g,ESRI_externalColorMixMode:e.extras.ESRI_externalColorMixMode},k.label=15;case 15:return[2,d]}})})};a.prototype.getTexture=function(b,a){return m(this,void 0,void 0,function(){var c,d,e,f,g,l,h,p;return k(this,function(k){switch(k.label){case 0:c=this.errorContext;d=this.json.textures[b];
e=w.textureSampler(null!=d.sampler?this.json.samplers[d.sampler]:{});c.errorUnsupportedIf(null==d.source,"Source is expected to be defined for a texture.");f=this.json.images[d.source];if(g=this.textureCache.get(b))return[3,6];l=void 0;return f.uri?[4,this.context.loadImage(this.resolveUri(f.uri),a)]:[3,2];case 1:return l=k.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==f.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==f.mimeType,"Image mimeType must be defined."),
h=this.json.bufferViews[f.bufferView],[4,this.getBuffer(h.buffer,a)];case 3:return p=k.sent(),c.errorUnsupportedIf(null!=h.byteStride,"byteStride not supported for image buffer"),[4,z(new Uint8Array(p.buffer,p.byteOffset+(h.byteOffset||0),h.byteLength),f.mimeType)];case 4:l=k.sent(),k.label=5;case 5:g={data:l,wrapS:e.wrapS,wrapT:e.wrapT,minFilter:e.minFilter,name:f.name,id:b},this.textureCache.set(b,g),k.label=6;case 6:return[2,g]}})})};a.prototype.getNodeTransform=function(a){if(void 0===a)return B;
var c=this.nodeTransformCache.get(a);if(!c){var c=this.getNodeTransform(this.getNodeParent(a)),d=this.json.nodes[a];if(d.matrix)c=b.mat4.multiply(e.mat4f64.create(),c,d.matrix);else if(d.translation||d.rotation||d.scale)c=e.mat4f64.clone(c),d.translation&&b.mat4.translate(c,c,d.translation),d.rotation&&(G[3]=p.quat.getAxisAngle(G,d.rotation),b.mat4.rotate(c,c,G[3],G)),d.scale&&b.mat4.scale(c,c,d.scale);this.nodeTransformCache.set(a,c)}return c};a.prototype.wrapAccessor=function(b,a){return new b(a.raw,
a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*(a.entryCount-1)+a.componentByteSize*a.componentCount)};a.prototype.resolveUri=function(b){return f.makeAbsolute(b,this.baseUri)};a.prototype.getNodeParent=function(b){return this.nodeParentMap.get(b)};a.prototype.checkVersionSupported=function(){var b=c.Version.parse(this.json.asset.version,"glTF");E.validate(b)};a.prototype.checkRequiredExtensionsSupported=function(){var b=this.json,a=this.errorContext;b.extensionsRequired&&0!==b.extensionsRequired.length&&
a.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+b.extensionsRequired.join(", "))};a.prototype.computeNodeParents=function(){var b=this;this.json.nodes.forEach(function(a,c){a.children&&a.children.forEach(function(a){b.nodeParentMap.set(a,c)})})};return a}();a.Resource=n;var E=new c.Version(2,0,"glTF"),B=b.mat4.fromXRotation(e.mat4f64.create(),Math.PI/2),G=q.quatf64.create(),F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},K=(A={},A[5120]=1,A[5121]=1,A[5122]=2,A[5123]=
2,A[5126]=4,A[5125]=4,A),H={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require","exports","./math/quat"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.quat=m})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),function(n,a,m,k,h,d,g,l){function f(b,
a,c){c*=.5;var d=Math.sin(c);b[0]=d*a[0];b[1]=d*a[1];b[2]=d*a[2];b[3]=Math.cos(c);return b}function c(b,a,c){var d=a[0],e=a[1],f=a[2];a=a[3];var g=c[0],l=c[1],h=c[2];c=c[3];b[0]=d*c+a*g+e*h-f*l;b[1]=e*c+a*l+f*g-d*h;b[2]=f*c+a*h+d*l-e*g;b[3]=a*c-d*g-e*l-f*h;return b}function b(b,a,c,e){var f=a[0],g=a[1],l=a[2];a=a[3];var h=c[0],k=c[1],p=c[2];c=c[3];var m,q,r;q=f*h+g*k+l*p+a*c;0>q&&(q=-q,h=-h,k=-k,p=-p,c=-c);1-q>d.EPSILON?(m=Math.acos(q),r=Math.sin(m),q=Math.sin((1-e)*m)/r,e=Math.sin(e*m)/r):q=1-e;
b[0]=q*f+e*h;b[1]=q*g+e*k;b[2]=q*l+e*p;b[3]=q*a+e*c;return b}function e(b,a){var c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{var d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);var e=(d+1)%3,f=(d+2)%3,c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*f+f]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+f]-a[3*f+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[f]=(a[3*f+d]+a[3*d+f])*c}return b}Object.defineProperty(a,"__esModule",{value:!0});a.identity=function(b){b[0]=0;b[1]=
0;b[2]=0;b[3]=1;return b};a.setAxisAngle=f;a.getAxisAngle=function(b,a){var c=2*Math.acos(a[3]),e=Math.sin(c/2);e>d.EPSILON?(b[0]=a[0]/e,b[1]=a[1]/e,b[2]=a[2]/e):(b[0]=1,b[1]=0,b[2]=0);return c};a.multiply=c;a.rotateX=function(b,a,c){c*=.5;var d=a[0],e=a[1],f=a[2];a=a[3];var g=Math.sin(c);c=Math.cos(c);b[0]=d*c+a*g;b[1]=e*c+f*g;b[2]=f*c-e*g;b[3]=a*c-d*g;return b};a.rotateY=function(b,a,c){c*=.5;var d=a[0],e=a[1],f=a[2];a=a[3];var g=Math.sin(c);c=Math.cos(c);b[0]=d*c-f*g;b[1]=e*c+a*g;b[2]=f*c+d*g;
b[3]=a*c-e*g;return b};a.rotateZ=function(b,a,c){c*=.5;var d=a[0],e=a[1],f=a[2];a=a[3];var g=Math.sin(c);c=Math.cos(c);b[0]=d*c+e*g;b[1]=e*c-d*g;b[2]=f*c+a*g;b[3]=a*c-f*g;return b};a.calculateW=function(b,a){var c=a[0],d=a[1];a=a[2];b[0]=c;b[1]=d;b[2]=a;b[3]=Math.sqrt(Math.abs(1-c*c-d*d-a*a));return b};a.slerp=b;a.random=function(b){var a=d.RANDOM(),c=d.RANDOM(),e=d.RANDOM(),f=Math.sqrt(1-a),a=Math.sqrt(a);b[0]=f*Math.sin(2*Math.PI*c);b[1]=f*Math.cos(2*Math.PI*c);b[2]=a*Math.sin(2*Math.PI*e);b[3]=
a*Math.cos(2*Math.PI*e);return b};a.invert=function(b,a){var c=a[0],d=a[1],e=a[2];a=a[3];var f=c*c+d*d+e*e+a*a,f=f?1/f:0;b[0]=-c*f;b[1]=-d*f;b[2]=-e*f;b[3]=a*f;return b};a.conjugate=function(b,a){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.fromMat3=e;a.fromEuler=function(b,a,c,d){var e=.5*Math.PI/180;a*=e;c*=e;d*=e;e=Math.sin(a);a=Math.cos(a);var f=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);b[0]=e*c*d-a*f*g;b[1]=a*f*d+e*c*g;b[2]=a*c*g-e*f*d;b[3]=a*c*d+e*f*g;return b};a.str=
function(b){return"quat("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};a.copy=l.copy;a.set=l.set;a.add=l.add;a.mul=c;a.scale=l.scale;a.dot=l.dot;a.lerp=l.lerp;a.length=l.length;a.len=a.length;a.squaredLength=l.squaredLength;a.sqrLen=a.squaredLength;a.normalize=l.normalize;a.exactEquals=l.exactEquals;a.equals=l.equals;a.rotationTo=function(b,c,d){var e=g.dot(c,d);if(-.999999>e)return g.cross(p,q,c),1E-6>g.len(p)&&g.cross(p,r,c),g.normalize(p,p),f(b,p,Math.PI),b;if(.999999<e)return b[0]=0,b[1]=0,b[2]=0,
b[3]=1,b;g.cross(p,c,d);b[0]=p[0];b[1]=p[1];b[2]=p[2];b[3]=1+e;return a.normalize(b,b)};var p=h.create(),q=h.fromValues(1,0,0),r=h.fromValues(0,1,0);a.sqlerp=function(a,c,d,e,f,g){b(w,c,f,g);b(u,d,e,g);b(a,w,u,2*g*(1-g));return a};var w=k.create(),u=k.create();a.setAxes=function(b,c,d,f){var g=v;g[0]=d[0];g[3]=d[1];g[6]=d[2];g[1]=f[0];g[4]=f[1];g[7]=f[2];g[2]=-c[0];g[5]=-c[1];g[8]=-c[2];return a.normalize(b,e(b,g))};var v=m.create()})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.data=a;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}a.prototype.readUint32=function(){var a=this.offset4;this.offset4+=1;return this.dataUint32[a]};a.prototype.readUint8Array=function(a){var h=4*this.offset4;this.offset4+=a/4;return new Uint8Array(this.data,h,a)};a.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};
return a}();a.BinaryStreamReader=n})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});var k={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},h={pbrMetallicRoughness:k,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},d={ESRI_externalColorMixMode:"tint"};a.material=function(a){void 0===a&&(a={});var f=m({},k,a.pbrMetallicRoughness),
c=m({},d,a.extras);switch(c.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":break;default:c.ESRI_externalColorMixMode="tint"}return m({},h,a,{pbrMetallicRoughness:f,extras:c})};var g={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};a.textureSampler=function(a){return m({},g,a)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.splitURI=function(a){var k,h;a.replace(/^(.*\/)?([^/]*)$/,
function(a,g,l){k=g||"";h=l||"";return""});return{dirPart:k,filePart:h}}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});a.mat3=k;a.mat4=h;a.scalar=d;a.vec2=g;a.vec3=l;a.vec4=f;a.createBuffer=function(a,b){return new a(new ArrayBuffer(b*a.ElementCount*m.elementTypeSize(a.ElementType)))}})},"esri/views/3d/support/buffer/utils/mat3":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,k,h){var d=a.typedBuffer;a=a.typedBufferStride;var g=k.typedBuffer,l=k.typedBufferStride;k=h?h.count:k.count;var f=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*l;for(var c=0;c<k;++c){for(var b=0;9>b;++b)d[f+b]=g[h+b];f+=a;h+=l}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,
k,h){var d=a.typedBuffer;a=a.typedBufferStride;var g=k.typedBuffer,l=k.typedBufferStride;k=h?h.count:k.count;var f=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*l;for(var c=0;c<k;++c){for(var b=0;16>b;++b)d[f+b]=g[h+b];f+=a;h+=l}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,k,h){var d=a.typedBuffer;a=a.typedBufferStride;var g=k.typedBuffer,l=k.typedBufferStride;
k=h?h.count:k.count;var f=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*l;for(var c=0;c<k;++c)d[f]=g[h],f+=a,h+=l};a.makeDense=function(a,k){var h=a.count;k||(k=new a.TypedArrayConstructor(h));for(var d=0;d<h;d++)k[d]=a.get(d);return k}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports","../types"],function(n,a,m){function k(a,d,g){var l=a.typedBuffer;a=a.typedBufferStride;var f=d.typedBuffer,c=d.typedBufferStride;d=g?g.count:d.count;var b=(g&&g.dstIndex?
g.dstIndex:0)*a;g=(g&&g.srcIndex?g.srcIndex:0)*c;for(var e=0;e<d;++e)l[b]=f[g],l[b+1]=f[g+1],b+=a,g+=c}Object.defineProperty(a,"__esModule",{value:!0});a.copy=k;a.normalizeIntegerBuffer=function(a,d,g){var l=a.typedBuffer,f=a.typedBufferStride,c=d.typedBuffer,b=d.typedBufferStride,e=g?g.count:d.count,h=(g&&g.dstIndex?g.dstIndex:0)*f,q=(g&&g.srcIndex?g.srcIndex:0)*b;if(m.isInteger(d.elementType))if(g=m.maximumValue(d.elementType),m.isSigned(d.elementType))for(d=0;d<e;++d)l[h]=Math.max(c[q]/g,-1),l[h+
1]=Math.max(c[q+1]/g,-1),h+=f,q+=b;else for(d=0;d<e;++d)l[h]=c[q]/g,l[h+1]=c[q+1]/g,h+=f,q+=b;else k(a,d,g);return a}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,k,h){var d=a.typedBuffer;a=a.typedBufferStride;var g=k.typedBuffer,l=k.typedBufferStride;k=h?h.count:k.count;var f=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*l;for(var c=0;c<k;++c)d[f]=g[h],d[f+1]=g[h+
1],d[f+2]=g[h+2],f+=a,h+=l}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,k,h){var d=a.typedBuffer;a=a.typedBufferStride;var g=k.typedBuffer,l=k.typedBufferStride;k=h?h.count:k.count;var f=(h&&h.dstIndex?h.dstIndex:0)*a;h=(h&&h.srcIndex?h.srcIndex:0)*l;for(var c=0;c<k;++c)d[f]=g[h],d[f+1]=g[h+1],d[f+2]=g[h+2],d[f+3]=g[h+3],f+=a,h+=l};a.fill=function(a,k,h,d,g,l){var f=a.typedBuffer,
c=a.typedBufferStride;a=l?l.count:a.count;l=(l&&l.dstIndex?l.dstIndex:0)*c;for(var b=0;b<a;++b)f[l]=k,f[l+1]=h,f[l+2]=d,f[l+3]=g,l+=c}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(n,a,m,k){function h(a){return k.generateDefaultIndexArray(a)}Object.defineProperty(a,"__esModule",{value:!0});a.linearIndexArray=h;a.trianglesToTriangles=function(a){return"number"===typeof a?h(a):
m.isUint16Array(a)||m.isUint8Array(a)?new Uint32Array(a):a};a.triangleStripToTriangles=function(a){var d="number"===typeof a?a:a.length;if(3>d)return new Uint32Array(0);var d=d-2,l=new Uint32Array(3*d);if("number"===typeof a)for(var f=0,c=0;c<d;c+=1)0===c%2?(l[f++]=c,l[f++]=c+1):(l[f++]=c+1,l[f++]=c),l[f++]=c+2;else for(c=f=0;c<d;c+=1){if(0===c%2)var b=a[c],e=a[c+1],h=a[c+2];else b=a[c+1],e=a[c],h=a[c+2];l[f++]=b;l[f++]=e;l[f++]=h}return l};a.triangleFanToTriangles=function(a){var d="number"===typeof a?
a:a.length;if(3>d)return new Uint32Array(0);var d=d-2,l=new Uint32Array(3*d);if("number"===typeof a){for(var f=0,c=0;c<d;++c)l[f++]=0,l[f++]=c+1,l[f++]=c+2;return l}for(var b=a[0],e=a[1],c=f=0;c<d;++c){var h=a[c+2];l[f++]=b;l[f++]=e;e=l[f++]=h}return l}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t){function x(a,c){return h(this,void 0,void 0,function(){var f,l;return k(this,function(h){switch(h.label){case 0:return(f=b.isSome(c)&&c.streamDataRequester)?[2,z(a,f,c)]:[4,g.result(d(a,b.unwrap(c)))];case 1:l=h.sent();if(!0===l.ok)return[2,l.value.data];e.throwIfAbortError(l.error);A(l.error);return[2,void 0]}})})}function z(b,a,c){return h(this,void 0,void 0,function(){var d;return k(this,function(f){switch(f.label){case 0:return[4,g.result(a.request(b,
"json",c))];case 1:d=f.sent();if(!0===d.ok)return[2,d.value];e.throwIfAbortError(d.error);A(d.error.details.url);return[2,void 0]}})})}function A(b){throw new l("","Request for object resource failed: "+b);}function E(a,c){return h(this,void 0,void 0,function(){var d,e,g,l,h,m,r,n,w,y,x,z,A,I,E,N,ca,ia,ba,oa,ha,la,ra,va,ja,pa,C,ua,wa,D,qa,na,S,Ca,Ea;return k(this,function(k){switch(k.label){case 0:return g=[],l=[],h=[],m=[],r=p.Version.parse(a.version||"1.0","wosr"),H.validate(r),n="meshsymbol_"+
a.model.name,w=a.textureDefinitions,[4,G(n,w,c)];case 1:y=k.sent();for(x in y)m.push(y[x].engineTexObj);z=a.model.geometries;A=a.materialDefinitions;for(E=I=0;E<z.length;E++){var J=N=z[E],M=J.params,L=M.topology;k=!0;M.vertexAttributes||(K.warn("Geometry must specify vertex attributes"),k=!1);switch(M.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:L=M.faces;if(!L)K.warn("Indexed geometries must specify faces"),k=!1;else if(M.vertexAttributes){var R=void 0;for(R in M.vertexAttributes)(M=
L[R])&&M.values?(null!=M.valueType&&"UInt32"!==M.valueType&&(K.warn("Unsupported indexed geometry indices type '"+M.valueType+"', only UInt32 is currently supported"),k=!1),null!=M.valuesPerElement&&1!==M.valuesPerElement&&(K.warn("Unsupported indexed geometry values per element '"+M.valuesPerElement+"', only 1 is currently supported"),k=!1)):(K.warn("Indexed geometry does not specify face indices for '"+R+"' attribute"),k=!1)}break;default:K.warn("Unsupported topology '"+L+"'"),k=!1}J.params.material||
(K.warn("Geometry requires material"),k=!1);J=J.params.vertexAttributes;M=void 0;for(M in J)J[M].values||(K.warn("Geometries with externally defined attributes are not yet supported"),k=!1);if(k){k=N.params;d=k.material;e=k.texture;ca=N.params.vertexAttributes;ia={};for(ba in ca)oa=ca[ba],ha=oa.values,ia[ba]={data:ha,size:oa.valuesPerElement};la={};if("PerAttributeArray"===N.params.topology){k=ra=ia.position.data.length/ia.position.size;J=new Uint32Array(k);for(M=0;M<k;M++)J[M]=M;va=J;for(ja in ia)la[ja]=
va}else for(C in pa=N.params.faces,pa)la[C]=new Uint32Array(pa[C].values);ua=e?y[e]:null;wa=h[d]?h[d][e]:null;wa||(D=d.substring(d.lastIndexOf("/")+1),qa=A[D].params,1===qa.transparency&&(qa.transparency=0),na=ua&&ua.alphaChannelUsage,S=0<qa.transparency||"transparency"===na||"maskAndTransparency"===na,Ca={ambient:q.vec3f64.fromArray(qa.diffuse),diffuse:q.vec3f64.fromArray(qa.diffuse),specular:[0,0,0],opacity:1-(qa.transparency||0),transparent:S,textureAlphaMode:ua?F(ua.alphaChannelUsage):void 0,
textureAlphaCutoff:.33,textureId:ua?ua.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:qa.externalColorMixMode||"tint",textureAlphaPremultiplied:!0},b.isSome(c)&&c.materialParamsMixin&&f.mixin(Ca,c.materialParamsMixin),wa=new t(Ca,n),h[d]||(h[d]={}),h[d][e]=wa);l.push(wa);Ea=new u(new v.GeometryData(ia,la),n);I+=la.position?la.position.length:0;g.push(Ea)}}return[2,{name:n,stageResources:{textures:m,materials:l,geometries:g},pivotOffset:a.model.pivotOffset,
boundingBox:B(g),numberOfVertices:I,lodThreshold:null}]}})})}function B(b){var a=r.empty();b.forEach(function(b){b=b.boundingInfo;r.expand(a,b.getBBMin());r.expand(a,b.getBBMax())});return a}function G(a,c,d){return h(this,void 0,void 0,function(){var f,g,l,h,p,m,q,r;return k(this,function(k){switch(k.label){case 0:f=[];g=function(g){var l=c[g],h=l.images[0].data;if(!h)return K.warn("Externally referenced texture data is not yet supported"),"continue";var h=l.encoding+";base64,"+h,k="/textureDefinitions/"+
g,p={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};g=b.isSome(d)&&d.disableTextures?e.resolve(null):w.requestImage(h,d);f.push(g.then(function(b){return{refId:k,engineTexObj:new y(b,a,p),alphaChannelUsage:"rgba"===l.channels?l.alphaChannelUsage||"transparency":"none"}}))};for(l in c)g(l);return[4,e.all(f)];case 1:h=k.sent();p={};m=0;for(q=h;m<q.length;m++)r=q[m],p[r.refId]=r;return[2,p]}})})}function F(b){switch(b){case "mask":return"mask";case "maskAndTransparency":return"maskBlend";
case "none":return"opaque";case "transparency":return"blend";default:return"blend"}}Object.defineProperty(a,"__esModule",{value:!0});var K=c.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");a.load=function(b,a){return h(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,x(b,a)];case 1:return c=d.sent(),[2,E(c,a)]}})})};a.createStageResources=E;var H=new p.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require",
"exports","./math/vec3","./math/vec4"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.vec3=m;a.vec4=k})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.transformMat4=function(a,h,d){if(a.count!==h.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var g=a.count,l=d[0],f=d[1],c=d[2],b=d[3],e=d[4],k=d[5],q=d[6],r=d[7],
n=d[8],u=d[9],v=d[10],y=d[11],t=d[12],x=d[13],z=d[14];d=d[15];var A=a.typedBuffer;a=a.typedBufferStride;var E=h.typedBuffer;h=h.typedBufferStride;for(var B=0;B<g;B++){var G=B*a,F=B*h,K=E[F],H=E[F+1],N=E[F+2],F=E[F+3];A[G]=l*K+e*H+n*N+t*F;A[G+1]=f*K+k*H+u*N+x*F;A[G+2]=c*K+q*H+v*N+z*F;A[G+3]=b*K+r*H+y*N+d*F}}};a.transformMat3=function(a,h,d){if(a.count!==h.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var g=a.count,l=d[0],f=d[1],c=d[2],b=d[3],e=
d[4],k=d[5],q=d[6],r=d[7];d=d[8];var n=a.typedBuffer;a=a.typedBufferStride;var u=h.typedBuffer;h=h.typedBufferStride;for(var v=0;v<g;v++){var y=v*a,t=v*h,x=u[t],z=u[t+1],A=u[t+2],t=u[t+3];n[y]=l*x+b*z+q*A;n[y+1]=f*x+e*z+r*A;n[y+2]=c*x+k*z+d*A;n[y+3]=t}}};a.scale=function(a,h,d){var g=Math.min(a.count,h.count),l=a.typedBuffer;a=a.typedBufferStride;var f=h.typedBuffer;h=h.typedBufferStride;for(var c=0;c<g;c++){var b=c*a,e=c*h;l[b]=d*f[e];l[b+1]=d*f[e+1];l[b+2]=d*f[e+2];l[b+3]=d*f[e+3]}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E){function B(b,a,c,d){y.encodeDoubleVec3(b.modelOrigin,a,c.modelOriginHi,c.modelOriginLo,d);c.model.copyFrom(d,b.model,a);c.modelNormal.copyFrom(d,b.modelNormal,a);b.color&&c.color&&c.color.copyFrom(d,b.color,a);b.featureAttribute&&c.featureAttribute&&c.featureAttribute.copyFrom(d,b.featureAttribute,a)}Object.defineProperty(a,"__esModule",{value:!0});var G=function(b){var a=b.baseBoundingSphere.radius;b=b.levels.map(function(b){return b.minScreenSpaceRadius});
return new u.LevelSelector(a,b)};a.setLevelSelectorFactory=function(b){G=b};var F=function(){function b(b,a){this.glMaterials={};var d=b.rctx,f=a.geometry;a=a.material;var g=f.data.toRenderData();this.materialRep=b.materialRep;a.setParameterValues({instancedDoublePrecision:!0});b=a.createBufferWriter();var l=b.vertexBufferLayout,h=b.elementCount(g),k=b.allocate(h);b.write({},g,k,0);this.geometry=f;this.material=a;this.glMaterials=y.acquireGLMaterials(a,this.materialRep);this.vertexBufferLayout=l;
this.vbo=z.createVertex(d,35044,k.buffer);this.vao=new E(d,e.Default3D,{geometry:c.glLayout(l)},{geometry:this.vbo});this.vertexCount=h}b.prototype.destroy=function(){y.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(b.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});
b.prototype.intersect=function(b,a,c,d,e,f){var g=this.geometry.id,l=e.toString();this.material.intersect(this.geometry,null,b.transform.transform,b,c,d,function(c,d,h,k,m,q){if(0<=c&&(null==a||a(b.rayBeginPoint,b.rayEndPoint,c))){m={type:"external",metadata:{layerUid:f.layerUid,graphicUid:f.graphicUid(e)}};if(null==b.results.min.drapedLayerOrder||k>=b.results.min.drapedLayerOrder)if(null==b.results.min.dist||c<b.results.min.dist)b.results.min.set(m,l,c,d,b.transform.transform,k,null,g,h),b.results.min.intersector=
"LodRenderer";if(null==b.results.max.drapedLayerOrder||k>=b.results.max.drapedLayerOrder)if(null==b.results.max.dist||c>b.results.max.dist)b.results.max.set(m,l,c,d,b.transform.transform,k,null,g,h),b.results.min.intersector="LodRenderer";b.enable.storeAll&&(q=new p.IntersectorResult(b.results.min.ray),q.set(m,l,c,d,b.transform.transform,k,null,g,h),q.intersector="LodRenderer",b.results.all.push(q))}},null)};return b}();a.LodComponentData=F;var K=function(){function b(b,a){var c=this;this.components=
[];this.minScreenSpaceRadius=a.minScreenSpaceRadius;a.components.forEach(function(a){c.components.push(new F(b,a))})}b.prototype.destroy=function(){this.components.forEach(function(b){b.destroy()})};b.prototype.intersect=function(b,a,c,d,e,f){this.components.forEach(function(g){g.intersect(b,a,c,d,e,f)})};Object.defineProperty(b.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var b=l.empty();this.components.forEach(function(a){l.expand(b,a.boundingInfo.bbMin);l.expand(b,a.boundingInfo.bbMax)});
this._boundingBox=b}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var b=this.boundingBox,a=d.vec3f64.create();l.center(b,a);this._boundingSphere={center:a,radius:.5*l.diameter(b)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"triangleCount",{get:function(){return this.components.reduce(function(b,a){return b+a.triangleCount},0)},enumerable:!0,configurable:!0});
return b}();a.LodLevelData=K;n=function(){function g(d,e,f,g){var l=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlaneEnabled=!1;this._enableLevelSelection=!0;this._lastCamera=new b.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=d;this._optionalFields=e;this._metadata=f;this._instanceBufferLayout=t.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:e});this._glInstanceBufferLayout=
c.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new r.InstanceData(this._optionalFields,g);this._instanceData.on("instance-added",function(b){l.requestUpdateCycle()});this._instanceData.on("instance-removed",function(b){l.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",function(b){l.requestUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(b){l.requestUpdateCycle(!0)});this._instanceData.on("instance-highlight-changed",function(b){l.requestUpdateCycle(!0)});
this._enableLevelSelection=1<this._symbol.levels.length;a.lodRenderers.push(this)}g.prototype.destroy=function(){a.lodRenderers.splice(a.lodRenderers.indexOf(this),1)};Object.defineProperty(g.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-
1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(b){this._slicePlaneEnabled=b},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"memoryUsage",{get:function(){var b={cpu:0,gpu:0};this._renderInstanceData.forEach(function(a){a=a.memoryUsage;b.cpu+=a.cpu;b.gpu+=a.gpu});this._highlightRenderInstanceData.forEach(function(a){a=a.memoryUsage;b.cpu+=a.cpu;b.gpu+=a.gpu});return b},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderStats",
{get:function(){var b=this,a=this._instanceData.size,c=[];this._levels.forEach(function(a,d){d=b._renderInstanceData[d].size+b._highlightRenderInstanceData[d].size;a=a.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*a,trianglesPerInstance:a})});return{totalInstances:a,renderedInstances:c.reduce(function(b,a){return b+a.renderedInstances},0),renderedTriangles:c.reduce(function(b,a){return b+a.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});g.prototype.initializeRenderContext=
function(b){var a=this;this._initContext=b;var c=b.rctx;this._symbol.levels.forEach(function(d){a._levels.push(new K(b,d));a._renderInstanceData.push(new v.RenderInstanceData(c,a._instanceBufferLayout));a._highlightRenderInstanceData.push(new v.RenderInstanceData(c,a._instanceBufferLayout))});this._levelSelector=G(this)};g.prototype.uninitializeRenderContext=function(b){this.invalidateOctree();this._levels.forEach(function(b){b.destroy()});this._renderInstanceData.forEach(function(b){b.destroy()});
this._highlightRenderInstanceData.forEach(function(b){b.destroy()})};Object.defineProperty(g.prototype,"slots",{get:function(){return[6,8]},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(b,a){return b+a.size},0)},enumerable:!0,configurable:!0});g.prototype.prepareRender=function(b){this.runUpdates(b)};g.prototype.render=function(b){var a=b.rctx,c=6===b.slot?5:8===b.slot?7:null;if(c){if(!this.baseMaterial.isVisible()||
!this.baseMaterial.isVisibleInPass(b.pass))return!1;var d=b.camera,d={view:d.viewMatrix,proj:d.projectionMatrix,origin:[0,0,0],viewInvTransp:d.viewInverseTransposeMatrix,viewport:d.viewport,fovY:d.fovY,nearFar:[d.near,d.far],shadowMap:b.shadowMap,shadowMappingEnabled:!!b.shadowMap&&b.shadowMap.enabled,ssaoEnabled:!!b.ssaoHelper&&b.ssaoHelper.enabled,pixelRatio:d.pixelRatio,slicePlane:b.sliceHelper&&b.sliceHelper.plane,cameraAboveGround:d.aboveGround,hudVisibilityTexture:b.offscreenRenderingHelper?
b.offscreenRenderingHelper.hudVisibilityTexture:null};a.bindVAO();for(a=0;a<this._levels.length;++a)this.renderLevel(b,c,d,b.isHighlightPass?this._highlightRenderInstanceData[a]:this._renderInstanceData[a],a);return!0}};g.prototype.intersect=function(b,a,c,e,f){var g=this;if(this.baseMaterial.isVisible()){f=d.vec3f64.create();h.vec3.subtract(f,e,c);var l=function(d){g._instanceData.getCombinedModelTransform(d,I);b.transform.set(I);h.vec3.transformMat4(J,c,b.transform.inverse);h.vec3.transformMat4(M,
e,b.transform.inverse);var f=g._instanceData.getState(d),l=g._instanceData.getLodLevel(d);q.assert(f&r.StateFlags.ACTIVE,"invalid instance state");q.assert(0<=l&&l<g._levels.length,"invaid lod level");g._levels[l].intersect(b,a,J,M,d,g._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(l):this.octree.forEachAlongRay(c,f,l)}};g.prototype.queryDepthRange=function(b){return this.queryDepthRangeOctree(b)};g.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};
g.prototype.requestUpdateCycle=function(b){void 0===b&&(b=!1);this._updateCyclesWithStaticCamera=-1;b&&(this._needFullCycle=!0);this.needsUpdates&&this._initContext.requestRender()};Object.defineProperty(g.prototype,"needsUpdates",{get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera},enumerable:!0,configurable:!0});g.prototype.runUpdates=function(b){if(!f.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var a=b.equals(this._lastCamera);this._lastCamera.copyFrom(b);
a||this.requestUpdateCycle()}a=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(b,a);this.needsUpdates&&this._initContext.requestRender()}};Object.defineProperty(g.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,configurable:!0});g.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};g.prototype.buildOctree=function(){for(var b=new w.InstanceOctree(this._instanceData,
this.baseBoundingSphere),a=this._instanceData,a=a.view?a.view.state:null,c=0;c<this._instanceData.capacity;++c)a.get(c)&r.StateFlags.ACTIVE&&b.addInstance(c);return b};g.prototype.queryDepthRangeOctree=function(b){var a=b.eye,c=b.viewForward,d=this.octree.findClosest(c,"front-to-back",b.frustum),e=this.octree.findClosest(c,"back-to-front",b.frustum);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,N),h.vec3.subtract(N,N,a),d=h.vec3.dot(N,c)-N[3],this._instanceData.view.boundingSphere.getVec(e,
N),h.vec3.subtract(N,N,a),a=h.vec3.dot(N,c)+N[3],{near:Math.max(b.near,d),far:Math.min(b.far,a)}):{near:Infinity,far:-Infinity}};g.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(b){b.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(b){b.startUpdateCylce()});this.needsUpdates&&this._initContext.requestRender()};g.prototype.updateInstances=function(b,a){var c=this._enableLevelSelection,d=this._levelSelector;
d.updateCamera(b);this._renderInstanceData.forEach(function(b){b.beginUpdate()});this._highlightRenderInstanceData.forEach(function(b){b.beginUpdate()});b=this._instanceData;var e=this._instanceData.view,f=b.capacity,g=this._instanceIndex;a=Math.min(b.size,a);for(var l=0;l<a;++l){0===g&&this.startUpdateCycle();var h=e.state.get(g),k=0;if(h&r.StateFlags.ALLOCATED){var p=e.lodLevel.get(g);h&r.StateFlags.ACTIVE&&this._renderInstanceData[p].freeTail();h&r.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[p].freeTail();
if(h&r.StateFlags.REMOVE)b.freeInstance(g);else if(h&r.StateFlags.VISIBLE){p=0;c&&(e.modelOrigin.getVec(g,H),p=d.selectLevel(H,b.getCombinedMedianScaleFactor(g)));k=h&~(r.StateFlags.ACTIVE|r.StateFlags.HIGHLIGHT_ACTIVE|r.StateFlags.TRANSFORM_CHANGED);if(0<=p){var m=this._renderInstanceData[p],q=m.allocateHead();B(e,g,m.view,q);k|=r.StateFlags.ACTIVE;h&r.StateFlags.HIGHLIGHT&&(m=this._highlightRenderInstanceData[p],q=m.allocateHead(),B(e,g,m.view,q),k|=r.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(g,
k);e.lodLevel.set(g,p)}else k=h&~(r.StateFlags.ACTIVE|r.StateFlags.HIGHLIGHT_ACTIVE|r.StateFlags.TRANSFORM_CHANGED),e.state.set(g,k);this._octree&&(p=!!(h&r.StateFlags.ACTIVE),k=!!(k&r.StateFlags.ACTIVE),!p&&k?this._octree.addInstance(g):p&&!k?this._octree.removeInstance(g):p&&k&&h&r.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g)));g=(g+1)%f}else g=(g+1)%f,a++}this._instanceIndex=g;this._renderInstanceData.forEach(function(b){b.endUpdate()});this._highlightRenderInstanceData.forEach(function(b){b.endUpdate()})};
g.prototype.renderLevel=function(b,a,c,d,e){var f=this;this._levels[e].components.forEach(function(g){f.renderComponent(b,a,c,d,g,e)})};g.prototype.renderComponent=function(b,a,c,d,g,l){var h=g.glMaterials[b.pass];if(h&&h.beginSlot(a)&&h.isVisible()&&h.isVisibleInPass(b.pass)&&0!==d.size){var k=b.rctx,p=k.capabilities.instancing,m=h.getDrawMode();c.origin=[0,0,0];h.bind(k,c);k.bindVAO(g.vao);a=h.getProgram();A.assertCompatibleVertexAttributeLocations(g.vao,a);b.isHighlightPass&&(k.bindTexture(b.offscreenRenderingHelper?
b.offscreenRenderingHelper.depthTexture:null,5),a.setUniform1i("depthTex",5),a.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],1/c.viewport[3]));h.bindView(k,c);f.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===b.pass&&(a.setUniform4fv("externalColor",L[Math.min(l,L.length-1)]),a.setUniform1i("colorMixMode",x.colorMixModes.replace));b=d.capacity;l=d.headIndex;a=d.tailIndex;var r=d.firstIndex,u=this._glInstanceBufferLayout,n=function(b,a){A.bindVertexBufferLayout(k,e.Default3D,d.buffer,u,
b);p.drawArraysInstanced(m,0,g.vertexCount,a-b);A.unbindVertexBufferLayout(k,e.Default3D,d.buffer,u)};g.material.getParameters().transparent&&null!=r?l>a?(q.assert(r>=a&&r<=l,"invalid firstIndex"),n(r,l),n(a,r)):l<a&&(r<=l?(q.assert(0<=r&&r<=l,"invalid firstIndex"),n(r,l),n(a,b),n(0,r)):(q.assert(r>=a&&r<=b,"invalid firstIndex"),n(r,b),n(0,l),n(a,r))):l>a?n(a,l):l<a&&(n(0,l),n(a,b));k.bindVAO(null);h.release(k,c)}};return g}();a.LodRenderer=n;a.lodRenderers=[];var H=d.vec3f64.create(),N=g.vec4f64.create(),
I=k.mat4f64.create(),J=d.vec3f64.create(),M=d.vec3f64.create(),L=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/Evented ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){Object.defineProperty(a,"__esModule",{value:!0});var r;(function(b){b[b.ALLOCATED=1]="ALLOCATED";b[b.ACTIVE=2]="ACTIVE";b[b.VISIBLE=4]="VISIBLE";b[b.HIGHLIGHT=8]="HIGHLIGHT";b[b.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";b[b.REMOVE=32]="REMOVE";b[b.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(r=a.StateFlags||(a.StateFlags={}));var w=function(){return function(b){this.localTransform=b.getField("localTransform",e.BufferViewMat4f64);this.globalTransform=b.getField("globalTransform",
e.BufferViewMat4f64);this.modelOrigin=b.getField("modelOrigin",e.BufferViewVec3f64);this.model=b.getField("model",e.BufferViewMat3f);this.modelNormal=b.getField("modelNormal",e.BufferViewMat3f);this.modelScaleFactors=b.getField("modelScaleFactors",e.BufferViewVec2f);this.boundingSphere=b.getField("boundingSphere",e.BufferViewVec4f64);this.color=b.getField("color",e.BufferViewVec4f);this.featureAttribute=b.getField("featureAttribute",e.BufferViewVec4f);this.state=b.getField("state",e.BufferViewUint8);
this.lodLevel=b.getField("lodLevel",e.BufferViewUint8)}}();a.View=w;n=function(a){function c(b,c){var d=a.call(this)||this;d._capacity=0;d._size=0;d._next=0;var e=p.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=b.indexOf("color")&&(e=e.vec4f("color"));0<=b.indexOf("featureAttribute")&&(e=e.vec4f("featureAttribute"));e=e.u8("state").u8("lodLevel").alignTo(8);d._layout=
e;d._shaderTransformation=c;return d}m(c,a);Object.defineProperty(c.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});c.prototype.addInstance=
function(){this._size+1>this._capacity&&this.grow();var b=this.findSlot();this._view.state.set(b,r.ALLOCATED);this._size++;this.emit("instance-added",{index:b});return b};c.prototype.removeInstance=function(b){var a=this._view.state;q.assert(0<=b&&b<this._capacity&&a.get(b)&r.ALLOCATED,"invalid instance handle");this.getStateFlag(b,r.ACTIVE)?this.setStateFlags(b,r.REMOVE):this.freeInstance(b);this.emit("instance-removed",{index:b})};c.prototype.freeInstance=function(b){var a=this._view.state;q.assert(0<=
b&&b<this._capacity&&a.get(b)&r.ALLOCATED,"invalid instance handle");a.set(b,0);this._size--};c.prototype.setLocalTransform=function(b,a,c){void 0===c&&(c=!0);this._view.localTransform.setMat(b,a);c&&this.updateModelTransform(b)};c.prototype.getLocalTransform=function(b,a){this._view.localTransform.getMat(b,a)};c.prototype.setGlobalTransform=function(b,a,c){void 0===c&&(c=!0);this._view.globalTransform.setMat(b,a);c&&this.updateModelTransform(b)};c.prototype.getGlobalTransform=function(b,a){this._view.globalTransform.getMat(b,
a)};c.prototype.updateModelTransform=function(a){var c=this._view,d=y,e=t;c.localTransform.getMat(a,x);c.globalTransform.getMat(a,z);var l=g.mat4.multiply(z,z,x);f.vec3.set(d,l[12],l[13],l[14]);c.modelOrigin.setVec(a,d);h.mat3.fromMat4(e,l);c.model.setMat(a,e);d=b.scaleFromMatrix(y,l);d.sort();c.modelScaleFactors.set(a,0,d[1]);c.modelScaleFactors.set(a,1,d[2]);h.mat3.invert(e,e);h.mat3.transpose(e,e);c.modelNormal.setMat(a,e);this.setStateFlags(a,r.TRANSFORM_CHANGED);this.emit("instance-transform-changed",
{index:a})};c.prototype.getModelTransform=function(b,a){var c=this._view;c.model.getMat(b,t);c.modelOrigin.getVec(b,y);a[0]=t[0];a[1]=t[1];a[2]=t[2];a[3]=0;a[4]=t[3];a[5]=t[4];a[6]=t[5];a[7]=0;a[8]=t[6];a[9]=t[7];a[10]=t[8];a[11]=0;a[12]=y[0];a[13]=y[1];a[14]=y[2];a[15]=1};c.prototype.applyShaderTransformation=function(b,a){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,b,a)};c.prototype.getCombinedModelTransform=function(b,a){this.getModelTransform(b,a);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,b,a);return a};c.prototype.getCombinedLocalTransform=function(b,a){this._view.localTransform.getMat(b,a);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,b,a);return a};c.prototype.getCombinedMaxScaleFactor=function(b){var a=this._view.modelScaleFactors.get(b,1);this._shaderTransformation&&(b=this._shaderTransformation.scaleFactor(y,this,b),a*=Math.max(b[0],b[1],b[2]));return a};c.prototype.getCombinedMedianScaleFactor=function(b){var a=
this._view.modelScaleFactors.get(b,0);this._shaderTransformation&&(b=this._shaderTransformation.scaleFactor(y,this,b),b.sort(),a*=b[1]);return a};c.prototype.getModel=function(b,a){this._view.model.getMat(b,a)};c.prototype.setFeatureAttribute=function(b,a){this._view.featureAttribute.setVec(b,a)};c.prototype.getFeatureAttribute=function(b,a){this._view.featureAttribute.getVec(b,a)};c.prototype.setColor=function(b,a){this._view.color.setVec(b,a)};c.prototype.getColor=function(b,a){this._view.color.getVec(b,
a)};c.prototype.setVisible=function(b,a){a!==this.getVisible(b)&&(this.setStateFlag(b,r.VISIBLE,a),this.emit("instance-visibility-changed",{index:b}))};c.prototype.getVisible=function(b){return this.getStateFlag(b,r.VISIBLE)};c.prototype.setHighlight=function(b,a){a!==this.getHighlight(b)&&(this.setStateFlag(b,r.HIGHLIGHT,a),this.emit("instance-highlight-changed",{index:b}))};c.prototype.getHighlight=function(b){return this.getStateFlag(b,r.HIGHLIGHT)};c.prototype.getState=function(b){return this._view.state.get(b)};
c.prototype.getLodLevel=function(b){return this._view.lodLevel.get(b)};c.prototype.countFlags=function(b){for(var a=0,c=0;c<this._capacity;++c)this.getState(c)&b&&++a;return a};c.prototype.setStateFlags=function(b,a){var c=this._view.state;a|=c.get(b);c.set(b,a)};c.prototype.clearStateFlags=function(b,a){var c=this._view.state;a=c.get(b)&~a;c.set(b,a)};c.prototype.setStateFlag=function(b,a,c){c?this.setStateFlags(b,a):this.clearStateFlags(b,a)};c.prototype.getStateFlag=function(b,a){return!!(this._view.state.get(b)&
a)};c.prototype.grow=function(){var b=Math.max(u,Math.floor(this._capacity*v)),a=this._layout.createBuffer(b);if(this._buffer){var c=new Uint8Array(this._buffer.buffer);(new Uint8Array(a.buffer)).set(c)}this._capacity=b;this._buffer=a;this._view=new w(this._buffer)};c.prototype.findSlot=function(){for(var b=this._view.state,a=this._next;b.get(a)&r.ALLOCATED;)a=(a+1)%this._capacity;this._next=(a+1)%this._capacity;return a};return c}(k);a.InstanceData=n;var u=1024,v=2,y=c.vec3f64.create(),t=d.mat3f64.create(),
x=l.mat4f64.create(),z=l.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,c){var e=a.call(this,[0,0,0],1,{getCenter:function(b){var a=
e._instanceData.view.boundingSphere,c=e._tmpCenter;c[0]=a.get(b,0);c[1]=a.get(b,1);c[2]=a.get(b,2);return c},getRadius:function(b){return e._instanceData.view.boundingSphere.get(b,3)}},{maximumDepth:25})||this;e._tmpCenter=d.vec3f64.create();e._tmpMat4=k.mat4f64.create();e._instanceData=b;e._boundingSphere=c;return e}m(c,a);c.prototype.addInstance=function(b){var a=this._instanceData.view.boundingSphere,c=this._instanceData.getCombinedModelTransform(b,this._tmpMat4),d=h.vec3.transformMat4(this._tmpCenter,
this._boundingSphere.center,c),c=this._boundingSphere.radius*g.maxScale(c);a.set(b,0,d[0]);a.set(b,1,d[1]);a.set(b,2,d[2]);a.set(b,3,c);this.add(b)};c.prototype.removeInstance=function(b){this.remove(b)};return c}(l);a.InstanceOctree=n})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),function(n,
a,m,k,h,d,g,l){function f(b,a,c){c=c||b;c[0]=b[0]+a;c[1]=b[1]+a;c[2]=b[2]+a;return c}function c(b,a,c){return!g.frustum.intersectsSphere(c.planes,g.sphere.wrap(a,b))}function b(b,a,c){if(!H.length)for(var d=0;8>d;++d)H.push({index:0,distance:0});for(d=0;8>d;++d){var e=r[d];H.data[d].index=d;H.data[d].distance=p(b,a,e)}H.sort(function(b,a){return b.distance-a.distance});c.clear();for(d=0;8>d;++d)c.push(H.data[d].index)}function e(b,a){for(var c=Infinity,d=null,e=0;8>e;++e){var f=p(b,a,w[e]);f<c&&(c=
f,d=w[e])}return d}function p(b,a,c){return a*(b[0]*c[0]+b[1]*c[1]+b[2]*c[2])}n=function(){function a(b,a,c,e){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=c;e&&(void 0!==e.maximumObjectsPerNode&&(this._maximumObjectsPerNode=e.maximumObjectsPerNode),void 0!==e.maximumDepth&&(this._maximumDepth=e.maximumDepth));isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(a)?this._root=new q(null,d.vec3f64.fromValues(0,0,0),.5):
this._root=new q(null,b,a/2)}Object.defineProperty(a.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});a.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;q.clearPool();v=[null];A.prune();H.prune();N.prune()};a.prototype.add=function(b,a){b=this._objectOrObjectsArray(b);a=null==a?b.length:a;this._objectCount+=a;
this._grow(b,a);for(var c=q.acquire(),d=0;d<a;d++){var e=b[d];c.init(this._root);this._isDegenerate(e)?this._degenerateObjects.add(e):this._add(e,c)}q.release(c)};a.prototype.remove=function(b,a){b=this._objectOrObjectsArray(b);this._objectCount-=b.length;for(var c=q.acquire(),d=0;d<b.length;d++){var e=b[d],f=a||this._boundingSphereFromObject(e,E);this._isValidRadius(f.radius)?(c.init(this._root),this._remove(e,f,c)):this._degenerateObjects.delete(e)}q.release(c);this._shrink()};a.prototype.update=
function(b,a){if(this._isValidRadius(a.radius)||!this._isDegenerate(b))this.remove(b,a),this.add(b)};a.prototype.forEachAlongRay=function(b,a,c){var d=this;this._forEachNode(this._root,function(e){if(!d._intersectsNode(b,a,e))return!1;e=e.node;e.terminals.forEach(function(e){d._intersectsObject(b,a,e)&&c(e)});null!==e.residents&&e.residents.forEach(function(e){d._intersectsObject(b,a,e)&&c(e)});return!0})};a.prototype.forEach=function(b){this._forEachNode(this._root,function(a){a=a.node;a.terminals.forEach(b);
null!==a.residents&&a.residents.forEach(b);return!0});this._degenerateObjects.forEach(b)};a.prototype.forEachDegenerateObject=function(b){this._degenerateObjects.forEach(b)};a.prototype.findClosest=function(b,a,c,d,e){return this._findClosest(b,"front-to-back"===a?1:-1,c,d,e)};a.prototype.forEachInDepthRange=function(b,a,c,d,e,f,g,l){this._forEachInDepthRange(b,a,"front-to-back"===c?1:-1,d,e,f,g,l)};a.prototype.forEachNode=function(b){this._forEachNode(this._root,function(a){return b(a.node,a.center,
2*a.halfSize)})};a.prototype._intersectsNode=function(b,a,c){f(c.center,2*-c.halfSize,x);f(c.center,2*c.halfSize,z);return l.rayBoxTest(b,a,x,z)};a.prototype._intersectsObject=function(b,a,c){var d=this._objectToBoundingSphere.getRadius(c);return 0<d?g.sphere.intersectsRay(g.sphere.wrap(d,this._objectToBoundingSphere.getCenter(c)),g.ray.wrap(b,a)):!0};a.prototype._forEachNode=function(b,a){b=q.acquire().init(b);for(var c=[b];0!==c.length;){b=c.pop();if(a(b)&&!b.isLeaf())for(var d=0;d<b.node.children.length;d++)b.node.children[d]&&
c.push(q.acquire().init(b).advance(d));q.release(b)}};a.prototype._forEachNodeDepthOrdered=function(a,c,d,e){void 0===e&&(e=1);a=q.acquire().init(a);var f=[a];for(b(d,e,N);0!==f.length;){a=f.pop();if(c(a)&&!a.isLeaf())for(d=7;0<=d;--d)e=N.data[d],e>=a.node.children.length||a.node.children[e]&&f.push(q.acquire().init(a).advance(e));q.release(a)}};a.prototype._findClosest=function(b,a,d,f,g){var l=this,k=Infinity,m=Infinity,q=null,r=e(b,a),n=0,w=function(e){++n;if(!f||f(e)){var g=l._objectToBoundingSphere.getCenter(e),
h=l._objectToBoundingSphere.getRadius(e);if(!d||!c(g,h,d)){var g=p(b,a,g),r=g-h;r<k&&(k=r,m=g+h,q=e)}}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=g&&n>=g||d&&c(e.center,e.halfSize*u,d))return!1;h.vec3.scale(t,r,e.halfSize);h.vec3.add(t,t,e.center);if(p(b,a,t)>m)return!1;e=e.node;e.terminals.forEach(function(b){w(b)});null!==e.residents&&e.residents.forEach(function(b){w(b)});return!0},b,a);return q};a.prototype._forEachInDepthRange=function(b,a,d,f,g,l,k,m){var q=this,r=-Infinity,
n=Infinity,w={setRange:function(b){1===d?(r=Math.max(r,b.near),n=Math.min(n,b.far)):(r=Math.max(r,-b.far),n=Math.min(n,-b.near))}};w.setRange(f);var v=p(a,d,b),y=e(a,d),x=e(a,-1*d),z=0,A=function(b){++z;if(!k||k(b)){var e=q._objectToBoundingSphere.getCenter(b),f=q._objectToBoundingSphere.getRadius(b),h=p(a,d,e)-v;h-f>n||h+f<r||l&&c(e,f,l)||g(b,w)}};this._forEachNodeDepthOrdered(this._root,function(b){if(null!=m&&z>=m||l&&c(b.center,b.halfSize*u,l))return!1;h.vec3.scale(t,y,b.halfSize);h.vec3.add(t,
t,b.center);if(p(a,d,t)-v>n)return!1;h.vec3.scale(t,x,b.halfSize);h.vec3.add(t,t,b.center);if(p(a,d,t)-v<r)return!1;b=b.node;b.terminals.forEach(function(b){A(b)});null!==b.residents&&b.residents.forEach(function(b){A(b)});return!0},a,d)};a.prototype._objectOrObjectsArray=function(b){if(Array.isArray(b))return b;v[0]=b;return v};a.prototype._remove=function(b,a,c){A.clear();a=c.advanceTo(a,function(b,a){A.push(b.node);A.push(a)})?c.node.terminals:c.node.residents;a.removeUnordered(b);if(0===a.length)for(b=
A.length-2;0<=b&&this._purge(A.data[b],A.data[b+1]);b-=2);};a.prototype._nodeIsEmpty=function(b){if(0!==b.terminals.length)return!1;if(null!==b.residents)return 0===b.residents.length;for(var a=0;a<b.children.length;a++)if(b.children[a])return!1;return!0};a.prototype._purge=function(b,a){0<=a&&(b.children[a]=null);return this._nodeIsEmpty(b)?(null===b.residents&&(b.residents=new k({shrink:!0})),!0):!1};a.prototype._add=function(b,a){a.advanceTo(this._boundingSphereFromObject(b,E))?a.node.terminals.push(b):
(a.node.residents.push(b),a.node.residents.length>this._maximumObjectsPerNode&&a.depth<this._maximumDepth&&this._split(a))};a.prototype._split=function(b){var a=b.node.residents;b.node.residents=null;for(var c=0;c<a.length;c++){var d=q.acquire().init(b);this._add(a.data[c],d);q.release(d)}};a.prototype._grow=function(b,a){var c=this;0!==a&&(b=this._boundingSphereFromObjects(b,a,function(b,a){return c._boundingSphereFromObject(b,a)},B),this._isValidRadius(b.radius)&&!this._fitsInsideTree(b)&&(this._nodeIsEmpty(this._root.node)?
(h.vec3.copy(this._root.center,b.center),this._root.halfSize=1.25*b.radius):(a=q.acquire(),this._rootBoundsForRootAsSubNode(b,a),this._placingRootViolatesMaxDepth(a)?this._rebuildTree(b,a):this._growRootAsSubNode(a),q.release(a))))};a.prototype._rebuildTree=function(b,a){var c=this;h.vec3.copy(G.center,a.center);G.radius=a.halfSize;b=this._boundingSphereFromObjects([b,G],2,function(b){return b},F);a=q.acquire().init(this._root);this._root.initFrom(null,b.center,1.25*b.radius);this._forEachNode(a,
function(b){c.add(b.node.terminals.data,b.node.terminals.length);null!==b.node.residents&&c.add(b.node.residents.data,b.node.residents.length);return!0});q.release(a)};a.prototype._placingRootViolatesMaxDepth=function(b){var a=0;this._forEachNode(this._root,function(b){a=Math.max(a,b.depth);return!0});return a+Math.log(b.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};a.prototype._rootBoundsForRootAsSubNode=function(b,a){var c=b.radius,d=b.center;b=-Infinity;for(var e=this._root.center,
f=this._root.halfSize,g=0;3>g;g++){var l=Math.max(0,Math.ceil((e[g]-f-(d[g]-c))/(2*f))),h=Math.max(0,Math.ceil((d[g]+c-(e[g]+f))/(2*f)))+1;b=Math.max(b,Math.pow(2,Math.ceil(Math.log(l+h)*Math.LOG2E)));K[g].min=l;K[g].max=h}for(g=0;3>g;g++)l=K[g].min,h=K[g].max,c=(b-(l+h))/2,l+=Math.ceil(c),h+=Math.floor(c),y[g]=e[g]-f-l*f*2+(h+l)*f;return a.initFrom(null,y,b*f,0)};a.prototype._growRootAsSubNode=function(b){var a=this._root.node;h.vec3.copy(B.center,this._root.center);B.radius=this._root.halfSize;
this._root.init(b);b.advanceTo(B,null,!0);b.node.children=a.children;b.node.residents=a.residents;b.node.terminals=a.terminals};a.prototype._shrink=function(){for(;;){var b=this._findShrinkIndex();if(-1===b)break;this._root.advance(b);this._root.depth=0}};a.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var b=null,a=this._root.node.children,c=0,d=0;d<a.length&&null==b;)c=d++,b=a[c];for(;d<a.length;)if(a[d++])return-1;return c};a.prototype._isDegenerate=
function(b){b=this._objectToBoundingSphere.getRadius(b);return!this._isValidRadius(b)};a.prototype._isValidRadius=function(b){return!isNaN(b)&&-Infinity!==b&&Infinity!==b&&0<b};a.prototype._fitsInsideTree=function(b){var a=this._root.center,c=this._root.halfSize,d=b.center;return b.radius<=c&&d[0]>=a[0]-c&&d[0]<=a[0]+c&&d[1]>=a[1]-c&&d[1]<=a[1]+c&&d[2]>=a[2]-c&&d[2]<=a[2]+c};a.prototype._boundingSphereFromObject=function(b,a){h.vec3.copy(a.center,this._objectToBoundingSphere.getCenter(b));a.radius=
this._objectToBoundingSphere.getRadius(b);return a};a.prototype._boundingSphereFromObjects=function(b,a,c,d){if(1===a){var e=c(b[0],B);h.vec3.copy(d.center,e.center);d.radius=e.radius}else{x[0]=Infinity;x[1]=Infinity;x[2]=Infinity;z[0]=-Infinity;z[1]=-Infinity;z[2]=-Infinity;for(var f=0;f<a;f++)if(e=c(b[f],B),this._isValidRadius(e.radius)){var g=x,l=e.center,k=e.radius;g[0]=Math.min(g[0],l[0]-k);g[1]=Math.min(g[1],l[1]-k);g[2]=Math.min(g[2],l[2]-k);g=z;l=e.center;e=e.radius;g[0]=Math.max(g[0],l[0]+
e);g[1]=Math.max(g[1],l[1]+e);g[2]=Math.max(g[2],l[2]+e)}h.vec3.lerp(d.center,x,z,.5);d.radius=Math.max(z[0]-x[0],z[1]-x[1],z[2]-x[2])/2}return d};return a}();var q=function(){function b(b,a,c,e){void 0===c&&(c=0);void 0===e&&(e=0);this.center=d.vec3f64.create();this.initFrom(b,a,c,0)}b.prototype.init=function(b){return this.initFrom(b.node,b.center,b.halfSize,b.depth)};b.prototype.initFrom=function(a,c,d,e){void 0===a&&(a=null);void 0===d&&(d=this.halfSize);void 0===e&&(e=this.depth);this.node=a||
b.createEmptyNode();c&&h.vec3.copy(this.center,c);this.halfSize=d;this.depth=e;return this};b.prototype.advance=function(a){var c=this.node.children[a];c||(c=b.createEmptyNode(),this.node.children[a]=c);this.node=c;this.halfSize/=2;this.depth++;a=r[a];this.center[0]+=a[0]*this.halfSize;this.center[1]+=a[1]*this.halfSize;this.center[2]+=a[2]*this.halfSize;return this};b.prototype.advanceTo=function(b,a,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(b))return a&&a(this,-1),!0;if(this.isLeaf()&&
!c)return a&&a(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(b);a&&a(this,d);this.advance(d)}};b.prototype.isLeaf=function(){return null!=this.node.residents};b.prototype.isTerminalFor=function(b){return b.radius>this.halfSize/2};b.prototype._childIndex=function(b){b=b.center;for(var a=this.center,c=0,d=0;3>d;d++)a[d]<b[d]&&(c|=1<<d);return c};b.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new k({shrink:!0}),residents:new k({shrink:!0})}};
b.acquire=function(){return b._pool.acquire()};b.release=function(a){b._pool.release(a)};b.clearPool=function(){b._pool.prune()};b._pool=new m(b);return b}(),r=[d.vec3f64.fromValues(-1,-1,-1),d.vec3f64.fromValues(1,-1,-1),d.vec3f64.fromValues(-1,1,-1),d.vec3f64.fromValues(1,1,-1),d.vec3f64.fromValues(-1,-1,1),d.vec3f64.fromValues(1,-1,1),d.vec3f64.fromValues(-1,1,1),d.vec3f64.fromValues(1,1,1)],w=[d.vec3f64.fromValues(-1,-1,-1),d.vec3f64.fromValues(-1,-1,1),d.vec3f64.fromValues(-1,1,-1),d.vec3f64.fromValues(-1,
1,1),d.vec3f64.fromValues(1,-1,-1),d.vec3f64.fromValues(1,-1,1),d.vec3f64.fromValues(1,1,-1),d.vec3f64.fromValues(1,1,1)],u=Math.sqrt(3),v=[null],y=d.vec3f64.create(),t=d.vec3f64.create(),x=d.vec3f64.create(),z=d.vec3f64.create(),A=new k,E={center:d.vec3f64.create(),radius:0},B={center:d.vec3f64.create(),radius:0},G={center:d.vec3f64.create(),radius:0},F={center:d.vec3f64.create(),radius:0},K=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],H=new k,N=new k;return n})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require",
"exports","../Camera"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d){this.thresholdScale=1;this._camera=new m.default;this._worldSpaceRadius=a;this._thresholds=d.map(function(a){return a})}a.prototype.updateCamera=function(a){this._camera.copyFrom(a)};a.prototype.selectLevel=function(a,d){a=this._camera.computeScreenPixelSizeAt(a);d=this._worldSpaceRadius*d/a;a=this._thresholds;for(var g=-1,l=0;l<a.length;++l)d>=a[l]*this.thresholdScale&&(g=l);return g};
return a}();a.LevelSelector=n})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports","../../../support/buffer/BufferView","../Util","./BackedBufferObject"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(){return function(b){this.modelOriginHi=b.getField("modelOriginHi",m.BufferViewVec3f);this.modelOriginLo=b.getField("modelOriginLo",m.BufferViewVec3f);this.model=b.getField("model",m.BufferViewMat3f);this.modelNormal=
b.getField("modelNormal",m.BufferViewMat3f);this.color=b.getField("instanceColor",m.BufferViewVec4f);this.featureAttribute=b.getField("instanceFeatureAttribute",m.BufferViewVec4f)}}();a.View=d;n=function(){function a(b,a){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=b;this._instanceBufferLayout=a;this._elementSize=a.stride;this._capacity=1}a.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(a.prototype,
"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var b=this._headIndex,a=this._tailIndex;return b>=a?b-a:b+this._capacity-a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};a.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};a.prototype.beginUpdate=function(){k.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=
this._headIndex};a.prototype.endUpdate=function(){k.assert(this._updating,"not updating");this.size<f*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};a.prototype.allocateHead=function(){k.assert(this._updating,"not updating");this.isFull&&this.grow();var b=this.headIndex;this._captureFirstIndex&&(this._firstIndex=b,this._captureFirstIndex=!1);this.incrementHead();k.assert(this._headIndex!==
this._tailIndex,"invalid pointers");return b};a.prototype.freeTail=function(){k.assert(this._updating,"not updating");k.assert(0<this.size,"invalid size");var b=this._tailIndex===this._firstIndex;this.incrementTail();b&&(this._firstIndex=this._tailIndex)};a.prototype.grow=function(){this.resize(Math.max(g,Math.floor(this._capacity*l)))};a.prototype.shrink=function(){b&&this.resize(Math.max(g,Math.floor(this._capacity*c)))};a.prototype.resize=function(b){k.assert(this._updating,"not updating");if(b!==
this._capacity){var a=new h(this._rctx,34962,35044,this._elementSize,b);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var c=this.size,e=this.compactInstances(a);k.assert(e===c,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=e;this._prevHeadIndex=0}this._resized=!0;this._capacity=b;this._buffer=a;this._view=new d(this._instanceBufferLayout.createView(this._buffer.array))}};a.prototype.compactInstances=
function(b){var a=this._headIndex,c=this._tailIndex;return c<a?(this._buffer.copyRange(c,a,b),a-c):c>a?(this._buffer.copyRange(c,this._capacity,b),0<a&&this._buffer.copyRange(0,a,b,this._capacity-c),a+(this._capacity-c)):0};a.prototype.incrementHead=function(b){void 0===b&&(b=1);this._headIndex=(this._headIndex+b)%this._capacity};a.prototype.incrementTail=function(b){void 0===b&&(b=1);this._tailIndex=(this._tailIndex+b)%this._capacity};a.prototype.transferRange=function(b,a){b<a?this._buffer.transferRange(b,
a):b>a&&(0<a&&this._buffer.transferRange(0,a),this._buffer.transferRange(b,this._capacity))};return a}();a.RenderInstanceData=n;var g=1024,l=2,f=.3,c=.5,b=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(n,a,m){return function(){function a(a,d,g,l,f){this._elementSize=l;this._buffer=new m(a,d,g);this.resize(f)}a.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(a.prototype,
"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*
this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});a.prototype.copyRange=function(a,d,g,l){void 0===l&&(l=0);a=new Uint8Array(this.array,a*this.elementSize,(d-a)*this.elementSize);(new Uint8Array(g.array,l*this.elementSize)).set(a)};a.prototype.transferAll=function(){this._buffer.setData(this._array)};a.prototype.transferRange=function(a,d){a*=this._elementSize;this._buffer.setSubData(this._array,a,a,d*this._elementSize)};a.prototype.resize=function(a){var d=
a*this._elementSize,g=new ArrayBuffer(d);this._array&&(a>=this._capacity?(new Uint8Array(g)).set(new Uint8Array(this._array)):(new Uint8Array(g)).set((new Uint8Array(this._array)).subarray(0,a*this._elementSize)));this._array=g;this._buffer.setData(d);this._capacity=a};return a}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require","exports","../doublePrecisionUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.acquireGLMaterials=function(a,g){var d=
{};d[0]=g.acquire(a,"color");d[3]=g.acquire(a,"depthShadowMap");d[2]=g.acquire(a,"normal");d[1]=g.acquire(a,"depth");d[4]=g.acquire(a,"highlight");return d};a.releaseGLMaterials=function(a,g){g.release(a.id,"color");g.release(a.id,"depthShadowMap");g.release(a.id,"normal");g.release(a.id,"depth");g.release(a.id,"highlight")};a.encodeDoubleVec3=function(a,g,l,f,c){k[0]=a.get(g,0);k[1]=a.get(g,1);k[2]=a.get(g,2);m.encodeDoubleArray(k,h,3);l.set(c,0,h[0]);f.set(c,0,h[1]);l.set(c,1,h[2]);f.set(c,1,h[3]);
l.set(c,2,h[4]);f.set(c,2,h[5])};var k=new Float64Array(3),h=new Float32Array(6)})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K){function H(a,c,d){switch(c){case "world":for(var e=0,g=a.vertices;e<g.length;e++)c=g[e],q.vec3.add(O,c.pos,a.offset),d.worldUpAtPosition(O,R),c.setFrameFromUpVector(R),c.computeRotationAxisAndAngleFromUpVector();break;case "path":for(q.vec3.add(O,a.vertices[0].pos,a.offset),d.worldUpAtPosition(O,R),B.computeMinimumRotationTangentFrame(a,R),d=0,a=a.vertices;d<a.length;d++){c=a[d];e=f.sign(q.vec3.dot(c.frame.right,c.vRight));q.vec3.cross(c.rotationFrame.up,
c.vRight,c.vLeft);q.vec3.scale(c.rotationFrame.up,c.rotationFrame.up,e);q.vec3.normalize(c.rotationFrame.up,c.rotationFrame.up);var g=q.vec3.dot(c.rotationFrame.up,c.frame.up),l=q.vec3.dot(c.rotationFrame.up,c.frame.right);q.vec3.scale(O,c.frame.up,-l);q.vec3.scale(T,c.frame.right,g);q.vec3.add(O,O,T);q.vec3.normalize(c.rotationFrame.right,O);B.vertexSpaceToProfileSpace(c.rotationRight,c.frame,c.rotationFrame.right);q.vec3.negate(O,c.vLeft);c.rotationAngle=-e*(Math.PI-f.acosClamped(q.vec3.dot(O,c.vRight)));
0<Math.abs(c.rotationAngle)&&(e=1/Math.cos(.5*c.rotationAngle),b.mat2.set(c.miterStretch,1+(e-1)*c.rotationRight[0]*c.rotationRight[0],(e-1)*c.rotationRight[0]*c.rotationRight[1],(e-1)*c.rotationRight[0]*c.rotationRight[1],1+(e-1)*c.rotationRight[1]*c.rotationRight[1]));c.maxStretchDistance=Math.abs(Math.min(c.vLeftLength,c.vRightLength)/Math.cos(.5*(Math.PI-c.rotationAngle)))}}}function N(b,a,c){switch(b){case "symbolValue":return c;case "proportional":return a;default:return b}}function I(b,a,c,
d){b=b.stageObject;var e=b.geometryRecords,f=e.length,g=0;M.spatialReference=c.spatialReference;J.spatialReference=d.spatialReference;for(var l=0;l<f;l++){var h=e[l].geometry,k=h.metadata,p=k.pathGeometry,m=p.builder.path;L.spatialReference=k.geometrySR;for(var r=m,u=a,n=c,w=d,v=0,t=0,x=r.vertices;t<x.length;t++){var z=x[t];M.x=z.posES[0];M.y=z.posES[1];M.z=z.posES[2];var A=y.computeElevation(n,M,u,w,U),v=v+U.terrainElevation;q.vec3.add(R,z.pos,r.offset);w.setAltitude(A,R);q.vec3.subtract(z.pos,R,
r.offset)}r.updatePathVertexInformation();g+=v/r.vertices.length;"world"!==m.upVector&&H(m,k.upVectorAlignment,d);p.onPathChanged();h.invalidateBoundingInfo();b.geometryVertexAttrsUpdated(l)}return g/f}Object.defineProperty(a,"__esModule",{value:!0});n=function(b){function f(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._intrinsicSize=p.vec2f64.fromValues(1,1);a.upVectorAlignment="path";a.stencilWidth=.1;return a}m(f,b);f.prototype.doLoad=function(){return d(this,void 0,void 0,function(){var b,d,f,k,p,
m,q,r,u,n,v,t,y,A;return h(this,function(h){b=c.isSome(this.symbolLayer.width)?this.symbolLayer.width:c.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size;d=c.isSome(this.symbolLayer.height)?this.symbolLayer.height:b;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[b,1,d],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?z.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};f=this.symbolLayer.anchor||"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");k=this.symbolLayer.profile||"circle";switch(k){default:this._profile=B.Profile.circle(a.NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case "quad":this._profile=B.Profile.rect()}p=
[0,0];"center"!==f&&(p={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[f],this._profile.translate(p[0],p[1]));m=this.symbolLayer.join||"simple";switch(m){case "round":this._extruder=new B.MiterExtruder(0,a.NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=new B.MiterExtruder(0,1);break;case "miter":this._extruder=new B.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new B.SimpleExtruder}q=this.symbolLayer.cap||"butt";switch(q){case "none":this._startCap=new B.NoCapBuilder;
this._endCap=new B.NoCapBuilder;break;default:this._startCap=new B.TriangulationCapBuilder(this._profile,0);this._endCap=new B.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new B.TriangulationCapBuilder(this._profile,-.5);this._endCap=new B.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":r="quad"===k?!0:!1,this._startCap=new B.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:r,subdivisions:a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=
new B.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:r,subdivisions:a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}u=this._getIdHint();n=c.get(this.symbolLayer,"material","color");v=this._getCombinedOpacityAndColor(n);t=w.vec3f64.fromArray(v);y=v[3];A={diffuse:t,ambient:t,opacity:y,transparent:1>y||this._isPropertyDriven("opacity"),vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:"none"===q?"none":void 0,offsetTransparentBackfaces:!0};
if(!this._isPropertyDriven("size")&&(e.vec2.set(this._intrinsicSize,b,d),!x.isValidSize(this._intrinsicSize[0])||!x.isValidSize(this._intrinsicSize[1])))throw new g("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||e.vec2.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(l.mixin(A,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],
this._intrinsicSize[1],0]}),this._material=new F(A,u+"_pathmat")):(A.vertexColors=this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),this._material=new G(A,u+"_pathmat"));this._material.setParameterValues(K.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));this._context.stage.add(3,this._material);return[2]})})};f.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=
null)};f.prototype.createGraphics3DGraphic=function(b){var a=b.graphic;if(!this._validateGeometryType(a.geometry,f.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(a.geometry))return null;var c="graphic"+a.uid,d=this.getGraphicElevationContext(a);return this._createAs3DShape(a,b.renderingInfo,d,c,a.uid)};f.prototype.layerOpacityChanged=function(){var b=c.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(b),a=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:b,
transparent:a});return!0};f.prototype.layerElevationInfoChanged=function(b,a,d){var e=this;b.forEach(function(b){var d=a(b);c.isSome(d)&&(b=e.getGraphicElevationContext(b.graphic),d.needsElevationUpdates=y.needsElevationUpdates3D(b.mode),d.elevationContext.set(b))});return y.SymbolUpdateType.UPDATE};f.prototype.slicePlaneEnabledChanged=function(b,a){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};f.prototype.physicalBasedRenderingChanged=function(b,
a){this._material.setParameterValues(K.returnDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));return!0};f.prototype.pixelRatioChanged=function(b,a){return!0};f.prototype.applyRendererDiff=function(b,a){for(var c in b.diff)switch(c){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,a,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};f.prototype.getVertexData=
function(b){for(var a=0,c=b.paths,d=[],e=b.spatialReference,f=this._context.elevationProvider.spatialReference,g=this._context.renderSpatialReference,l=0;l<c.length;l++)var h=c[l],a=a+h.length;for(var l=new Float64Array(3*a),k=new Float64Array(3*a),p=new Float64Array(3*a),m=0,q=0;q<c.length;q++){h=c[q];d.push({index:m,numVertices:h.length});for(var r=0;r<h.length;r++){var u=h[r];l[m++]=u[0];l[m++]=u[1];l[m++]=b.hasZ?u[2]:0}}b=!0;e.equals(f)?y.copyVertices(l,0,k,0,a):b=y.reproject(l,0,e,k,0,f,a);f.equals(g)?
y.copyVertices(k,0,p,0,a):y.reproject(k,0,f,p,0,g,a);return{pathVertexDataInfos:d,vertexDataGS:l,vertexDataES:k,vertexDataRS:p,projectionSuccess:b,terrainElevation:0}};f.prototype._createAs3DShape=function(b,a,c,d,e){var f=b.geometry,g=[],l=[],h=[],k=f.spatialReference,p=this._context.elevationProvider.spatialReference,m=Array(6),r=this._context.renderCoordsHelper;L.spatialReference=k;M.spatialReference=p;f=this.getVertexData(f);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0<f.pathVertexDataInfos.length){for(p=0;p<f.pathVertexDataInfos.length;++p){var u=f.pathVertexDataInfos[p],n=u.index,u=u.numVertices;if(2>u)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");else{if(this._context.clippingExtent&&(y.computeBoundingBox(f.vertexDataES,n,u,m),y.boundingBoxClipped(m,this._context.clippingExtent)))continue;for(var w=[],z=n;z<n+3*u;){var x=z++,J=z++,G=z++,F=new B.PathVertex;q.vec3.set(F.posGS,f.vertexDataGS[x],
f.vertexDataGS[J],f.vertexDataGS[G]);q.vec3.set(F.posES,f.vertexDataES[x],f.vertexDataES[J],f.vertexDataES[G]);M.x=F.posES[0];M.y=F.posES[1];M.z=F.posES[2];var K=y.computeElevation(this._context.elevationProvider,M,c,r,null);q.vec3.set(R,f.vertexDataRS[x],f.vertexDataRS[J],f.vertexDataRS[G]);r.setAltitude(K,R);q.vec3.set(F.pos,R[0],R[1],R[2]);w.push(F)}n=new B.Path(w);H(n,this.upVectorAlignment,this._context.renderCoordsHelper);n=new B.Builder(n,this._profile,this._extruder,this._startCap,this._endCap);
u=null;this._fastUpdates.enabled?(z=this._fastUpdates.visualVariables,u=z.size?t.getAttributeValue(z.size.field,b):0,w=z.color?t.getAttributeValue(z.color.field,b):0,z=z.opacity?t.getAttributeValue(z.opacity.field,b):0,u=new B.FastUpdatePathGeometry(n,u,w,z)):(u=[this._intrinsicSize[0],this._intrinsicSize[1]],this._isPropertyDriven("size")&&(u[0]*=N(a.size[0],a.size[2],this.symbolLayer.width),u[1]*=N(a.size[2],a.size[0],this.symbolLayer.height)),w=null,this._isPropertyDriven("color")&&(w=a.color),
this._isPropertyDriven("opacity")&&null!=a.opacity&&(w=w?[w[0],w[1],w[2],a.opacity]:[1,1,1,a.opacity]),n=new B.StaticPathGeometry(n),n.bake(u),w&&n.bakeVertexColors(w),u=n);n=u.createGeometryData();n=new A(n,d+"path"+p);w={pathGeometry:u,geometrySR:k,upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};n.singleUse=!0;n.metadata=w;g.push(n);l.push(this._material);h.push(u.xform)}}b={layerUid:this._context.layer.uid,graphicUid:e};if(0<g.length)return d=new E({geometries:g,materials:l,
transformations:h,castShadow:!0,metadata:b,idHint:d}),g=new v(this,d,g,null,null,I,c),g.alignedTerrainElevation=f.terrainElevation,g.needsElevationUpdates=y.needsElevationUpdates3D(c.mode),g}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};f.validGeometryTypes=["polyline"];return f}(t.Graphics3DSymbolLayer);a.Graphics3DPathSymbolLayer=n;var J=u.makeDehydratedPoint(0,0,0,null),M=u.makeDehydratedPoint(0,0,0,null),L=u.makeDehydratedPoint(0,
0,0,null),R=w.vec3f64.create(),O=r.vec3f32.create(),T=r.vec3f32.create();a.NUM_ROUND_JOIN_SUBDIVISIONS=3;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;var U={verticalDistanceToGround:0,terrainElevation:0};a.default=n})},"esri/core/libs/gl-matrix-2/mat2":function(){define(["require","exports","./math/mat2"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat2=m})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["require","exports","./common"],
function(n,a,m){function k(a,g,l){var d=g[0],c=g[1],b=g[2];g=g[3];var e=l[0],h=l[1],k=l[2];l=l[3];a[0]=d*e+b*h;a[1]=c*e+g*h;a[2]=d*k+b*l;a[3]=c*k+g*l;return a}function h(a,g,l){a[0]=g[0]-l[0];a[1]=g[1]-l[1];a[2]=g[2]-l[2];a[3]=g[3]-l[3];return a}Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,g){a[0]=g[0];a[1]=g[1];a[2]=g[2];a[3]=g[3];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};a.set=function(a,g,l,f,c){a[0]=g;a[1]=l;a[2]=f;a[3]=c;return a};a.transpose=
function(a,g){if(a===g){var d=g[1];a[1]=g[2];a[2]=d}else a[0]=g[0],a[1]=g[2],a[2]=g[1],a[3]=g[3];return a};a.invert=function(a,g){var d=g[0],f=g[1],c=g[2];g=g[3];var b=d*g-c*f;if(!b)return null;b=1/b;a[0]=g*b;a[1]=-f*b;a[2]=-c*b;a[3]=d*b;return a};a.adjoint=function(a,g){var d=g[0];a[0]=g[3];a[1]=-g[1];a[2]=-g[2];a[3]=d;return a};a.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};a.multiply=k;a.rotate=function(a,g,l){var d=g[0],c=g[1],b=g[2];g=g[3];var e=Math.sin(l);l=Math.cos(l);a[0]=d*l+b*e;
a[1]=c*l+g*e;a[2]=d*-e+b*l;a[3]=c*-e+g*l;return a};a.scale=function(a,g,l){var d=g[1],c=g[2],b=g[3],e=l[0];l=l[1];a[0]=g[0]*e;a[1]=d*e;a[2]=c*l;a[3]=b*l;return a};a.fromRotation=function(a,g){var d=Math.sin(g);g=Math.cos(g);a[0]=g;a[1]=d;a[2]=-d;a[3]=g;return a};a.fromScaling=function(a,g){a[0]=g[0];a[1]=0;a[2]=0;a[3]=g[1];return a};a.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],
2))};a.LDU=function(a,g,l,f){a[2]=f[2]/f[0];l[0]=f[0];l[1]=f[1];l[3]=f[3]-a[2]*l[1];return[a,g,l]};a.add=function(a,g,l){a[0]=g[0]+l[0];a[1]=g[1]+l[1];a[2]=g[2]+l[2];a[3]=g[3]+l[3];return a};a.subtract=h;a.exactEquals=function(a,g){return a[0]===g[0]&&a[1]===g[1]&&a[2]===g[2]&&a[3]===g[3]};a.equals=function(a,g){var d=a[0],f=a[1],c=a[2];a=a[3];var b=g[0],e=g[1],h=g[2];g=g[3];return Math.abs(d-b)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))&&Math.abs(f-e)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(e))&&
Math.abs(c-h)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(a-g)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))};a.multiplyScalar=function(a,g,l){a[0]=g[0]*l;a[1]=g[1]*l;a[2]=g[2]*l;a[3]=g[3]*l;return a};a.multiplyScalarAndAdd=function(a,g,l,f){a[0]=g[0]+l[0]*f;a[1]=g[1]+l[1]*f;a[2]=g[2]+l[2]*f;a[3]=g[3]+l[3]*f;return a};a.mul=k;a.sub=h})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/mat2f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./GeometryData ./GeometryUtil ./Util ../materials/internal/MaterialUtil ../shaders/PathPrograms".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){var t;(function(a){function m(){return{up:p.vec3f64.create(),right:p.vec3f64.create()}}a.makeFrame=m;a.profileSpaceToVertexSpace=function(b,a,c){b[0]=c[0]*a.right[0]+c[1]*a.up[0];b[1]=c[0]*a.right[1]+c[1]*a.up[1];b[2]=c[0]*a.right[2]+c[1]*a.up[2]};a.vertexSpaceToProfileSpace=function(b,a,d){c.vec2.set(b,e.vec3.dot(d,a.right),e.vec3.dot(d,a.up))};var n=function(){function a(){this.pos=p.vec3f64.create();this.posES=p.vec3f64.create();this.posGS=p.vec3f64.create();
this.vRight=p.vec3f64.create();this.vLeft=p.vec3f64.create();this.frame=m();this.rotationFrame=m();this.rotationRight=b.vec2f64.create();this.rotationAngle=0;this.miterStretch=g.mat2f64.create()}a.prototype.setFrameFromUpVector=function(b){e.vec3.copy(this.frame.up,b);e.vec3.add(G,this.vLeft,this.vRight);e.vec3.normalize(G,G);e.vec3.scale(B,this.frame.up,e.vec3.dot(G,this.frame.up));e.vec3.subtract(H,G,B);e.vec3.normalize(H,H);e.vec3.cross(this.frame.right,H,this.frame.up)};a.prototype.computeRotationAxisAndAngleFromUpVector=
function(){e.vec3.copy(this.rotationFrame.up,this.frame.up);e.vec3.copy(this.rotationFrame.right,this.frame.right);c.vec2.set(this.rotationRight,1,0);e.vec3.scale(B,this.frame.up,e.vec3.dot(this.frame.up,this.vLeft));e.vec3.subtract(B,this.vLeft,B);e.vec3.negate(B,B);e.vec3.normalize(B,B);e.vec3.scale(G,this.frame.up,e.vec3.dot(this.frame.up,this.vRight));e.vec3.subtract(G,this.vRight,G);e.vec3.normalize(G,G);e.vec3.cross(F,this.rotationFrame.up,this.vLeft);this.rotationAngle=h.sign(e.vec3.dot(F,
this.vRight))*(Math.PI-h.acosClamped(e.vec3.dot(B,G)));0<Math.abs(this.rotationAngle)&&d.mat2.set(this.miterStretch,1+(1/Math.cos(.5*this.rotationAngle)-1),0,0,1);this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return a}();a.PathVertex=n;n=function(){function a(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}a.prototype.addVertex=function(a,c){this.vertices.push(b.vec2f64.clone(a));
this.vertexNormals.push(b.vec2f64.clone(c));return this.vertices.length-1};a.prototype.addUV=function(b){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(b);return this.uvs.length-1};a.prototype.addPole=function(a,c){void 0===c&&(c=null);this.poles.push({position:b.vec2f64.clone(a),normal:c?b.vec2f64.clone(c):null});return this.poles.length-1};a.prototype.addSegment=function(b,a,c){void 0===a&&(a=null);void 0===c&&(c=null);this.vertexIndices.push(b.v0);this.vertexIndices.push(b.v1);a&&(this.uvIndices.push(a.v0),
this.uvIndices.push(a.v1));c&&(this.poleIndices.push(c.v0),this.poleIndices.push(c.v1))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});a.prototype.hasUV=function(){return null!=this.uvs};a.prototype.translate=function(b,a){for(var c=0,d=this.vertices;c<d.length;c++){var e=d[c];e[0]+=b;e[1]+=a}c=0;for(d=this.poles;c<d.length;c++)e=d[c],e.position[0]+=b,e.position[1]+=a};a.circle=function(c){void 0===c&&(c=20);var d=
new a,e={v0:0,v1:0};d.addPole(b.vec2f64.fromValues(0,0));for(var f=0;f<c;++f){var g=2*f*Math.PI/c,l=Math.cos(g),h=Math.sin(g),g=b.vec2f64.fromValues(.5*l,.5*h),l=b.vec2f64.fromValues(l,h);d.addVertex(g,l);d.addUV(f/c)}d.addUV(1);for(f=0;f<c-1;++f)l={v0:f,v1:f+1},d.addSegment(l,l,e);d.addSegment({v0:c-1,v1:0},{v0:c-1,v1:c},e);return d};a.rect=function(){var c=new a,d=b.vec2f64.fromValues(-.5,-.5),e=b.vec2f64.fromValues(.5,-.5),f=b.vec2f64.fromValues(.5,.5),g=b.vec2f64.fromValues(-.5,.5),l=b.vec2f64.fromValues(0,
-1),h=b.vec2f64.fromValues(1,0),k=b.vec2f64.fromValues(0,1),p=b.vec2f64.fromValues(-1,0);c.addUV(0);c.addUV(1);c.addPole(b.vec2f64.fromValues(0,.5),k);c.addPole(b.vec2f64.fromValues(0,.5));c.addPole(b.vec2f64.fromValues(0,-.5));c.addPole(b.vec2f64.fromValues(0,-.5),l);var m={v0:0,v1:1};c.addVertex(d,l);c.addVertex(e,l);c.addSegment({v0:0,v1:1},m,{v0:3,v1:3});c.addVertex(e,h);c.addVertex(f,h);c.addSegment({v0:2,v1:3},m,{v0:2,v1:1});c.addVertex(f,k);c.addVertex(g,k);c.addSegment({v0:4,v1:5},m,{v0:0,
v1:0});c.addVertex(g,p);c.addVertex(d,p);c.addSegment({v0:6,v1:7},m,{v0:1,v1:2});return c};return a}();a.Profile=n;n=function(){function b(b){this.vertices=[];this.offset=p.vec3f64.create();this.xform=f.mat4f64.create();this.vertices=b;e.vec3.copy(this.offset,this.vertices[Math.floor((b.length-1)/2)].pos);b=0;for(var a=this.vertices;b<a.length;b++){var c=a[b];e.vec3.subtract(c.pos,c.pos,this.offset)}l.mat4.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}b.prototype.updatePathVertexInformation=
function(){var b=this.vertices.length,a=this.vertices[0];a.index=0;e.vec3.set(a.vLeft,0,0,0);a.vLeftLength=0;e.vec3.subtract(a.vRight,this.vertices[1].pos,a.pos);a.vRightLength=e.vec3.length(a.vRight);e.vec3.normalize(a.vRight,a.vRight);for(var c=a,d=1;d<b;++d)a=this.vertices[d],a.index=d,e.vec3.copy(a.vLeft,c.vRight),a.vLeftLength=c.vRightLength,d<b-1?(e.vec3.subtract(a.vRight,this.vertices[d+1].pos,a.pos),a.vRightLength=e.vec3.length(a.vRight),e.vec3.normalize(a.vRight,a.vRight)):(e.vec3.copy(a.vRight,
a.vLeft),a.vRightLength=a.vLeftLength),c=a};return b}();a.Path=n;a.computeMinimumRotationTangentFrame=function(b,a){var c=null,d=b.vertices.length,f=p.vec3f64.create(),g=p.vec3f64.create(),l=p.vec3f64.create(),h=p.vec3f64.create(),k=p.vec3f64.create(),m=p.vec3f64.create(),r=q.plane.create(),u=b.vertices[0];e.vec3.copy(g,a);e.vec3.set(f,0,1,0);w.makeOrthoBasisDirUpFallback(u.vRight,g,f,f,l,g,.99619469809);e.vec3.copy(u.frame.up,g);e.vec3.copy(u.frame.right,l);c=u;for(a=1;a<d;++a){u=b.vertices[a];e.vec3.add(k,
u.vLeft,u.vRight);var n=e.vec3.length(k);0<n?(n=1/Math.sqrt(n),k[0]*=n,k[1]*=n,k[2]*=n):(k[0]=u.vRight[0],k[1]=u.vRight[1],k[2]=u.vRight[2]);e.vec3.add(m,c.pos,c.frame.up);q.plane.fromPositionAndNormal(u.pos,k,r);q.plane.intersectRay(r,q.ray.wrap(m,u.vLeft),h)?(e.vec3.subtract(h,h,u.pos),e.vec3.normalize(g,h),e.vec3.cross(l,k,g),e.vec3.normalize(l,l)):w.makeOrthoBasisDirUpFallback(k,c.frame.up,c.frame.right,f,l,g,.99619469809);e.vec3.copy(u.frame.up,g);e.vec3.copy(u.frame.right,l);c=u}};n=function(){return function(){}}();
a.Extruder=n;n=function(){function b(){}b.prototype.numProfilesPerJoin=function(){return 1};b.prototype.extrude=function(b,a,c){for(var d=0;d<a.vertices.length;++d)c(b.index,b.frame,a.vertices[d],a.vertexNormals[d],!1)};return b}();a.SimpleExtruder=n;n=function(){function b(b,a){void 0===b&&(b=.8*Math.PI);void 0===a&&(a=1);this.cutoffAngle=b;this.numBendSubdivisions=a}b.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};b.prototype.extrude=function(b,a,d){var f=N;if(Math.abs(b.rotationAngle)>=
this.cutoffAngle)for(var g=0;g<this.numBendSubdivisions+1;++g){l.mat4.identity(I);l.mat4.rotate(I,I,.5*-b.rotationAngle+g*b.rotationAngle/this.numBendSubdivisions,b.rotationFrame.up);var h=f,k=b.frame,p=I;e.vec3.transformMat4(h.up,k.up,p);e.vec3.transformMat4(h.right,k.right,p);for(h=0;h<a.vertices.length;++h)k=c.vec2.dot(a.vertices[h],b.rotationRight),(k=0<=k*b.rotationAngle)?d(b.index,f,a.vertices[h],a.vertexNormals[h],!1):(c.vec2.transformMat2(z,a.vertices[h],b.miterStretch),d(b.index,b.frame,
z,a.vertexNormals[h],!0))}else for(g=0;g<this.numBendSubdivisions+1;++g)for(h=0;h<a.vertices.length;++h)k=c.vec2.dot(a.vertices[h],b.rotationRight),k=0<=k*b.rotationAngle,c.vec2.transformMat2(z,a.vertices[h],b.miterStretch),d(b.index,b.frame,z,a.vertexNormals[h],k?!1:!0)};return b}();a.MiterExtruder=n;var t={generateUV:!1},n=function(){function b(){}b.prototype.rebuildConnectingProfileGeometry=function(b,a,c){for(var d=0;d<a.vertices.length;++d)c(b.index,b.frame,a.vertices[d],a.vertexNormals[d],0,
0)};return b}();a.CapBuilder=n;var J=function(b){function a(){return b.call(this)||this}k(a,b);a.prototype.getNumVertices=function(){return 0};a.prototype.getNumIndices=function(){return 0};a.prototype.rebuildCapGeometry=function(b,a){};a.prototype.buildTopology=function(b,a){};return a}(n);a.NoCapBuilder=J;J=function(b){function a(a,c,d){void 0===c&&(c=0);void 0===d&&(d=!1);var e=b.call(this)||this;e.profile=a;e.profilePlaneOffset=c;e.flip=d;return e}k(a,b);a.prototype.getNumVertices=function(){return this.profile.vertices.length};
a.prototype.getNumIndices=function(){return 3*this.profile.numSegments};a.prototype.rebuildConnectingProfileGeometry=function(b,a,c){for(var d=0;d<a.vertices.length;++d)c(b.index,b.frame,a.vertices[d],a.vertexNormals[d],this.profilePlaneOffset,0)};a.prototype.rebuildCapGeometry=function(b,a){var d=A;c.vec2.set(d,0,0);for(var e=this.flip?1:-1,f=0;f<this.profile.vertices.length;++f)a(b.index,b.frame,this.profile.vertices[f],d,this.profilePlaneOffset,e)};a.prototype.buildTopology=function(b,a){b=this.vertexBufferStart+
this.profile.vertexIndices[0];for(var c=1;c<this.profile.numSegments;++c){var d=this.vertexBufferStart+this.profile.vertexIndices[2*c+0],e=this.vertexBufferStart+this.profile.vertexIndices[2*c+1];this.flip?a(e,d,b):a(b,d,e)}};return a}(n);a.TriangulationCapBuilder=J;n=function(b){function a(a){var c=b.call(this)||this;c.flip=!1;c.sign=0;c.breakNormals=!1;c.numSegments=3;c.profile=a.profile;c.flip=a.flip;c.sign=c.flip?1:-1;c.breakNormals=a.breakNormals;c.numSegments=a.subdivisions;return c}k(a,b);
a.prototype.getNumVertices=function(){var b=0,b=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(b+=this.profile.vertices.length);return b+=this.profile.poles.length};a.prototype.getNumIndices=function(){var b;b=0+2*this.profile.numSegments*(this.numSegments-1);for(var a=0;a<this.profile.numSegments;++a)b=this.profile.poleIndices[this.profile.vertexIndices[2*a+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*a+1]]?b+1:b+2;return 3*b};a.prototype.rebuildCapGeometry=
function(b,a){var d=b.frame,e=.5*this.sign,f=z,g=A;c.vec2.set(g,0,0);for(var l=0;l<this.profile.poles.length;++l){var h=this.profile.poles[l];h.normal?a(b.index,d,h.position,h.normal,e,0):a(b.index,d,h.position,g,e,this.sign)}if(this.breakNormals)for(l=0;l<this.profile.vertices.length;++l)a(b.index,d,this.profile.vertices[l],this.profile.vertexNormals[l],0,0);for(l=0;l<this.numSegments-1;++l)for(var h=(1-(l+1)/this.numSegments)*Math.PI*.5,k=Math.sin(h),p=Math.cos(h),m=0;m<this.profile.vertices.length;++m)h=
this.profile.poles[this.profile.poleIndices[m]],c.vec2.subtract(f,this.profile.vertices[m],h.position),c.vec2.scale(f,f,k),h.normal?(c.vec2.add(f,f,h.position),a(b.index,d,f,h.normal,e*p,0)):(c.vec2.normalize(g,f),c.vec2.scale(g,g,k),c.vec2.add(f,f,h.position),a(b.index,d,f,g,e*p,this.sign*p))};a.prototype.buildTopology=function(b,a){b=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;for(var c=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+
this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,d=0;d<this.profile.numSegments;++d){for(var e=this.profile.vertexIndices[2*d+0],f=this.profile.vertexIndices[2*d+1],g=this.vertexBufferStart+this.profile.poleIndices[e],l=this.vertexBufferStart+this.profile.poleIndices[f],h=b+e,k=b+f,p=0;p<this.numSegments-1;++p){var m=c+p*this.profile.vertices.length+e,q=c+p*this.profile.vertices.length+f;this.flip?(a(m,k,h),a(k,m,q)):(a(h,k,m),a(q,m,k));h=m;k=q}this.flip?(a(g,k,h),g!==
l&&a(g,l,k)):(a(h,k,g),g!==l&&a(k,l,g))}};return a}(n);a.RoundCapBuilder=n;n=function(){function b(b,a,c,d,e,f){void 0===f&&(f=t);this.options=f;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=a;this.path=b;this.extruder=c;this.startCap=d;this.endCap=e;b=this.path.vertices.length-2;this.numExtrusionProfiles=c.numProfilesPerJoin()*b+2;this.numNormalsTotal=this.numVerticesTotal=a.vertices.length*this.numExtrusionProfiles;
this.startCap.vertexBufferStart=this.numVerticesTotal;a=this.startCap.getNumVertices();this.numVerticesTotal+=a;this.numNormalsTotal+=a;this.endCap.vertexBufferStart=this.numVerticesTotal;a=this.endCap.getNumVertices();this.numVerticesTotal+=a;this.numNormalsTotal+=a;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*
this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}b.prototype.emitVertex=function(b,a,c,d,e){this.profileRightAxisData[4*this._extrusionVertexCount+0]=a.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=a.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+
2]=a.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=a.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=a.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=a.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=
b;e?(b=this.path.vertices[b],this.profileRightAxisData[4*this._extrusionVertexCount+3]=b.rotationRight[0]*b.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=b.rotationRight[1]*b.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};b.prototype.emitCapVertex=function(b,a,c,d,e,f){this.profileRightAxisData[4*this._extrusionVertexCount+0]=a.right[0];this.profileRightAxisData[4*
this._extrusionVertexCount+1]=a.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=a.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=a.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=a.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=a.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=
d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=b;this.profileRightAxisData[4*this._extrusionVertexCount+3]=e;this.profileUpAxisData[4*this._extrusionVertexCount+3]=f;++this._extrusionVertexCount};b.prototype.emitTriangle=function(b,a,c){this.vertexIndices[3*this._triangleCount+0]=b;this.vertexIndices[3*this._triangleCount+1]=a;this.vertexIndices[3*this._triangleCount+2]=c;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[b];
this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[a];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[c];this.normalIndices[3*this._triangleCount+0]=b;this.normalIndices[3*this._triangleCount+1]=a;this.normalIndices[3*this._triangleCount+2]=c;++this._triangleCount};b.prototype.rebuildGeometry=function(){for(var b=this.emitVertex.bind(this),a=this.emitCapVertex.bind(this),c=this._extrusionVertexCount=0,d=this.path.vertices;c<d.length;c++){var e=d[c];this.originData[3*
e.index+0]=e.pos[0];this.originData[3*e.index+1]=e.pos[1];this.originData[3*e.index+2]=e.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,a);for(c=1;c<this.path.vertices.length-1;++c)this.extruder.extrude(this.path.vertices[c],this.profile,b);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,a);this.startCap.rebuildCapGeometry(this.path.vertices[0],a);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-
1],a);if(this.profile.hasUV()&&this.options.generateUV)for(c=0;c<this.profile.uvs.length;++c)this.uvData[2*c+0]=this.profile.uvs[c],this.uvData[2*c+1]=0};b.prototype.buildTopology=function(){var b=this.emitTriangle.bind(this);this._triangleCount=0;var a=this.profile.vertices.length,c=this.profile.numSegments,d=this.numExtrusionProfiles-1,e=c*d*6;this.startCap.indexBufferStart=e;this.startCap.firstProfileVertexIndex=0;e+=this.startCap.getNumIndices();this.endCap.indexBufferStart=e;this.endCap.firstProfileVertexIndex=
a*(this.numExtrusionProfiles-1);e+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(e);this.normalIndices=new Uint32Array(e);this.pathVertexIndices=new Uint32Array(e);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(e));for(e=0;e<c;++e)for(var f=this.profile.vertexIndices[2*e],g=this.profile.vertexIndices[2*e+1],l=0;l<d;++l){var h=l*a+f,k=(l+1)*a+g,p=l*a+g;b(h,(l+1)*a+f,k);b(h,k,p)}this.startCap.buildTopology(this.path.vertices[0],b);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-
1],b)};b.prototype.onPathChanged=function(){this.rebuildGeometry()};return b}();a.Builder=n;n=function(){function b(b){this.builder=b}Object.defineProperty(b.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0});b.prototype.onPathChanged=function(){this.builder.onPathChanged()};return b}();a.PathGeometry=n;var T=function(b){function a(a){a=b.call(this,a)||this;a.vertexAttributePosition=null;a.vertexAttributeNormal=null;a.vertexAttributeColor=null;a.vertexAttributePosition=
new Float32Array(3*a.builder.numVerticesTotal);a.vertexAttributeNormal=new Float32Array(3*a.builder.numNormalsTotal);a.vertexAttributeColor=new Uint8Array(4);a.vertexAttributeColor[0]=255;a.vertexAttributeColor[1]=255;a.vertexAttributeColor[2]=255;a.vertexAttributeColor[3]=255;return a}k(a,b);a.prototype.bakeVertexColors=function(b){this.vertexAttributeColor[0]=255*b[0];this.vertexAttributeColor[1]=255*b[1];this.vertexAttributeColor[2]=255*b[2];this.vertexAttributeColor[3]=255*(3<b.length?b[3]:1)};
a.prototype.bake=function(b){this.size=b;for(var a=0;a<this.builder.numVerticesTotal;++a){var d=this.builder.pathVertexData[a],f=0===d||d===this.builder.path.vertices.length-1,g=x;e.vec3.set(g,this.builder.originData[3*d+0],this.builder.originData[3*d+1],this.builder.originData[3*d+2]);var l=B,k=z,d=G,p=F,m=K,q=0,r=0;e.vec3.set(p,this.builder.profileRightAxisData[4*a+0],this.builder.profileRightAxisData[4*a+1],this.builder.profileRightAxisData[4*a+2]);e.vec3.set(m,this.builder.profileUpAxisData[4*
a+0],this.builder.profileUpAxisData[4*a+1],this.builder.profileUpAxisData[4*a+2]);c.vec2.set(k,this.builder.profileVertexAndNormalData[4*a+0]*b[0],this.builder.profileVertexAndNormalData[4*a+1]*b[1]);if(f)e.vec3.cross(d,m,p),q=this.builder.profileRightAxisData[4*a+3]*b[0],r=this.builder.profileUpAxisData[4*a+3];else{var f=A,u=E;c.vec2.set(f,this.builder.profileRightAxisData[4*a+3],this.builder.profileUpAxisData[4*a+3]);var n=c.vec2.length(f);c.vec2.normalize(f,f);var w=c.vec2.dot(k,f);if(Math.abs(w)>
n){c.vec2.set(u,-f[1],f[0]);var v=c.vec2.dot(k,u);c.vec2.scale(f,f,n*h.sign(w));c.vec2.scale(u,u,v);c.vec2.add(k,f,u)}e.vec3.set(d,0,0,0)}e.vec3.set(l,p[0]*k[0]+m[0]*k[1],p[1]*k[0]+m[1]*k[1],p[2]*k[0]+m[2]*k[1]);this.vertexAttributePosition[3*a+0]=g[0]+l[0]+d[0]*q;this.vertexAttributePosition[3*a+1]=g[1]+l[1]+d[1]*q;this.vertexAttributePosition[3*a+2]=g[2]+l[2]+d[2]*q;g=z;c.vec2.set(g,this.builder.profileVertexAndNormalData[4*a+2],this.builder.profileVertexAndNormalData[4*a+3]);this.vertexAttributeNormal[3*
a+0]=p[0]*g[0]+m[0]*g[1]+d[0]*r;this.vertexAttributeNormal[3*a+1]=p[1]*g[0]+m[1]*g[1]+d[1]*r;this.vertexAttributeNormal[3*a+2]=p[2]*g[0]+m[2]*g[1]+d[2]*r}};a.prototype.createGeometryData=function(){var b={};b[u.VertexAttrConstants.POSITION]=this.builder.vertexIndices;b[u.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(b[u.VertexAttrConstants.COLOR]=new Uint32Array(b[u.VertexAttrConstants.POSITION].length));var a={};a[u.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};
a[u.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(a[u.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new r.GeometryData(a,b,r.GeometryData.DefaultOffsets,"triangle")};a.prototype.onPathChanged=function(){b.prototype.onPathChanged.call(this);this.bake(this.size)};a.prototype.intersect=function(b,a,c){var d=this.builder.vertexIndices;v.intersectTriangles(b,a,0,d.length/3,d,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},
void 0,c)};return a}(n);a.StaticPathGeometry=T;n=function(b){function a(a,c,d,e){var f=b.call(this,a)||this;f.sizeAttributeValue=c;f.colorAttributeValue=d;f.opacityAttributeValue=e;f.vvData=null;f.baked=new T(a);f.vvData=new Float32Array(4*f.builder.path.vertices.length);for(a=0;a<f.builder.path.vertices.length;++a)f.vvData[4*a+0]=c,f.vvData[4*a+1]=d,f.vvData[4*a+2]=e,f.vvData[4*a+3]=0===a||a===f.builder.path.vertices.length-1?1:0;return f}k(a,b);a.prototype.createGeometryData=function(){var b={};
b[y.VertexAttrConstants.POSITION]=this.builder.pathVertexIndices;b[y.VertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;b[y.VertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;b[y.VertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;b[y.VertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;var a={};a[y.VertexAttrConstants.POSITION]={size:3,data:this.builder.originData};a[y.VertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};
a[y.VertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};a[y.VertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};a[y.VertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new r.GeometryData(a,b,r.GeometryData.DefaultOffsets,"triangle")};return a}(n);a.FastUpdatePathGeometry=n})(t||(t={}));var x=p.vec3f64.create(),z=b.vec2f64.create(),A=b.vec2f64.create(),E=b.vec2f64.create(),B=p.vec3f64.create(),G=p.vec3f64.create(),
F=p.vec3f64.create(),K=p.vec3f64.create(),H=p.vec3f64.create(),N=t.makeFrame(),I=f.mat4f64.create();return t})},"esri/core/libs/gl-matrix-2/mat2f64":function(){define(["require","exports","./factories/mat2f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat2f64=m})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,0,1]};a.clone=function(a){return[a[0],
a[1],a[2],a[3]]};a.fromValues=function(a,k,h,d){return[a,k,h,d]};a.createView=function(a,k){return new Float64Array(a,k,4)}})},"esri/views/3d/webgl-engine/shaders/PathPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.VertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"};
a.vertexAttributeLocations={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};var h=function(a){return k.glslifyDefineMap({FLIPV:a.flipV,DOUBLESIDED:a.doubleSided,WINDINGORDERDOUBLESIDED:a.windowOrderDoubleSided,RECEIVE_SHADOWS:a.receiveShadows,RECEIVE_SSAO:a.receiveSSAO,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VV_OPACITY:a.vvOpacity,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,SLICE:a.slice,TRANSPARENCY_DISCARD:a.transparencyDiscard,BIAS_SHADOWMAP:a.shadowMap,WIREFRAME:a.wireframe})};
a.colorPass={name:"path-color",shaders:function(a){return{vertexShader:h(a)+m.resolveIncludes("materials/pathMaterial/colorPass.vert"),fragmentShader:h(a)+m.resolveIncludes("materials/pathMaterial/colorPass.frag")}},attributes:a.vertexAttributeLocations};a.depthPass={name:"path-depth",shaders:function(a){return{vertexShader:h(a)+m.resolveIncludes("materials/pathMaterial/depthPass.vert"),fragmentShader:h(a)+m.resolveIncludes("materials/pathMaterial/depthPass.frag")}},attributes:a.vertexAttributeLocations};
a.normalPass={name:"path-normal",shaders:function(a){return{vertexShader:h(a)+m.resolveIncludes("materials/pathMaterial/normalPass.vert"),fragmentShader:h(a)+m.resolveIncludes("materials/pathMaterial/normalPass.frag")}},attributes:a.vertexAttributeLocations};a.highlightPass={name:"path-highlight",shaders:function(a){return{vertexShader:h(a)+m.resolveIncludes("materials/pathMaterial/highlightPass.vert"),fragmentShader:h(a)+m.resolveIncludes("materials/pathMaterial/highlightPass.frag")}},attributes:a.vertexAttributeLocations}})},
"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/PathPrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v){function y(b,a){a.vvSizeEnabled&&(b.setUniform3fv("vvSizeMinSize",a.vvSizeMinSize),b.setUniform3fv("vvSizeMaxSize",a.vvSizeMaxSize),b.setUniform3fv("vvSizeOffset",a.vvSizeOffset),b.setUniform3fv("vvSizeFactor",a.vvSizeFactor));a.vvColorEnabled&&(b.setUniform1fv("vvColorValues",a.vvColorValues),b.setUniform4fv("vvColorColors",a.vvColorColors));a.vvOpacityEnabled&&(b.setUniform1fv("vvOpacityValues",a.vvOpacityValues),b.setUniform1fv("vvOpacityOpacities",
a.vvOpacityOpacities))}var t=b.assert;n=function(b){function a(c,d){d=b.call(this,d)||this;d.supportsEdges=!0;d.params=r.copyParameters(c,G);d.vertexBufferLayout=a.getVertexBufferLayout(d.params);return d}k(a,b);a.prototype.isVisibleInPass=function(b){return 3===b?this.params.castShadows:!0};a.prototype.isVisible=function(){var a=this.params;if(!b.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var c="replace"===a.colorMixMode,d=0<a.opacity,e=a.externalColor&&0<a.externalColor[3];return a.vvColorEnabled?
c?!0:d:c?e:d};a.prototype.setParameterValues=function(b){var a=this.params,c;for(c in b)a[c]=b[c];this.notifyDirty("matChanged")};a.prototype.getParameters=function(){return this.params};a.prototype.intersect=function(b,a,c,e,f,g,l,k){if(b.metadata){a=b.metadata.pathGeometry;c=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){k=this.params.vvSizeOffset;var p=this.params.vvSizeFactor,m=this.params.vvSizeMinSize,q=this.params.vvSizeMaxSize,u=a.sizeAttributeValue;c[0]*=h.clamp(k[0]+
u*p[0],m[0],q[0]);c[1]*=h.clamp(k[1]+u*p[1],m[1],q[1])}k=Math.max(c[0],c[1]);b=d.fromValues(b.boundingInfo.bbMin[0]-k,b.boundingInfo.bbMin[1]-k,b.boundingInfo.bbMin[2]-k,b.boundingInfo.bbMax[0]+k,b.boundingInfo.bbMax[1]+k,b.boundingInfo.bbMax[2]+k);k=[g[0]-f[0],g[1]-f[1],g[2]-f[2]];p=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]);r.intersectAabbInvDir(b,f,[p/k[0],p/k[1],p/k[2]],e.tolerance)&&(a.baked.size&&a.baked.size[0]===c[0]&&a.baked.size[1]===c[1]||a.baked.bake(c),a.baked.intersect(f,g,l))}};a.prototype.createBufferWriter=
function(){return new F(this.vertexBufferLayout)};a.prototype.createRenderer=function(b,a){return new w(b,a,this,u.vertexAttributeLocations)};a.prototype.getGLMaterials=function(){return{color:x,depth:z,depthShadowMap:this.params.castShadows?A:null,normal:E,highlight:B}};a.getVertexBufferLayout=function(b){var a=l.newLayout().vec3f(u.VertexAttrConstants.POSITION).vec4f(u.VertexAttrConstants.PROFILERIGHT).vec4f(u.VertexAttrConstants.PROFILEUP).vec4f(u.VertexAttrConstants.PROFILEVERTEXANDNORMAL);if(b.vvColorEnabled||
b.vvSizeEnabled||b.vvOpacityEnabled)a=a.vec4f(u.VertexAttrConstants.FEATUREVALUE);return a};return a}(c.Material);var x=function(b){function a(a){var c=b.call(this,a)||this;c.params=r.copyParameters(a.material.getParameters());c.slot=c.params.transparent?7:5;c._createPrograms();c.selectPipeline();return c}k(a,b);a.prototype._createPrograms=function(){var b=this;this.programs=q.BindParametersMap.create(this.params,function(a){return b._createProgram(a)})};a.prototype._createProgram=function(b){var a=
this.params;return this.programRep.getProgram(u.colorPass,{flipV:a.flipV,doubleSided:a.doubleSided&&"normal"===a.doubleSidedType,windowOrderDoubleSided:a.doubleSided&&"winding-order"===a.doubleSidedType,receiveShadows:b.receiveShadows,receiveSSAO:b.receiveSSAO,vvSize:a.vvSizeEnabled,vvColor:a.vvColorEnabled,vvOpacity:a.vvOpacityEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent,wireframe:a.wireframe})};
a.prototype.selectPipeline=function(){var b=this.params;this.pipelineState=v.makePipelineState({blending:b.transparent&&v.separateBlendingParams(770,1,771,771),culling:H(b),polygonOffset:b.polygonOffset&&K,depthTest:{func:513},depthWrite:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams})};a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};a.prototype.getPrograms=function(){return q.BindParametersMap.programs(this.programs)};
a.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.slot=this.params.transparent?7:5;this._createPrograms();this.selectPipeline()};a.prototype.bind=function(b,a){var c=this.params,d=this.program=q.BindParametersMap.lookup(this.programs,a);b.bindProgram(d);b.setPipelineState(this.pipelineState);d.setUniform3fv("size",c.size);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",c.specular);d.setUniform4fv("externalColor",
c.externalColor);d.setUniform1i("colorMixMode",r.colorMixModes[c.colorMixMode]);d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);r.bindVerticalOffset(c.verticalOffset,a,d);r.bindScreenSizePerspective(c.screenSizePerspective,d);y(d,c)};a.prototype.release=function(b,a){};a.prototype.bindView=function(b,a){b=this.program=q.BindParametersMap.lookup(this.programs,a);var c=this.params,d=a.origin;r.bindView(d,a.view,b);r.bindCamPos(d,a.viewInvTransp,b);c.slicePlaneEnabled&&
r.bindSlicePlane(d,a.slicePlane,b);a.shadowMappingEnabled&&a.shadowMap.bindView(b,d)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return a}(f),z=function(b){function a(a){var c=b.call(this,a)||this;c.biased=!!a.biased;c.updateParameters();return c}k(a,b);a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=
function(){return this.program};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(u.depthPass,{flipV:b.flipV,shadowMap:this.biased,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,vvOpacity:b.vvOpacityEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,transparencyDiscard:b.transparent});this.pipelineState=v.makePipelineState({culling:H(b),polygonOffset:b.polygonOffset&&K,depthTest:{func:513},
depthWrite:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams})};a.prototype.selectSlot=function(){this.slot=this.params.transparent?7:5};a.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot()};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);c.setUniform3fv("size",d.size);c.setUniform2fv("nearFar",a.nearFar);r.bindVerticalOffset(d.verticalOffset,
a,c);r.bindScreenSizePerspective(d.screenSizePerspective,c);y(c,d)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params,d=a.origin;r.bindView(d,a.view,b);c.slicePlaneEnabled&&r.bindSlicePlane(a.origin,a.slicePlane,b);c.screenSizePerspective&&r.bindCamPos(d,a.viewInvTransp,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return a}(f),
A=function(b){function a(a){return b.call(this,m({},a,{biased:!0}))||this}k(a,b);return a}(z),E=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}k(a,b);a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=function(){return this.program};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(u.normalPass,{flipV:b.flipV,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,vvOpacity:b.vvOpacityEnabled,verticalOffset:null!==
b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,transparencyDiscard:b.transparent});this.pipelineState=v.makePipelineState({polygonOffset:b.polygonOffset&&K,culling:H(b),depthTest:{func:513},depthWrite:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams})};a.prototype.selectSlot=function(){this.slot=this.params.transparent?7:5};a.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();
this.selectSlot()};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);c.setUniform3fv("size",d.size);r.bindVerticalOffset(d.verticalOffset,a,c);r.bindScreenSizePerspective(d.screenSizePerspective,c);y(c,d)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params,d=a.origin;r.bindView(d,a.view,b);b.setUniformMatrix4fv("viewNormal",a.viewInvTransp);c.slicePlaneEnabled&&r.bindSlicePlane(a.origin,
a.slicePlane,b);c.screenSizePerspective&&r.bindCamPos(d,a.viewInvTransp,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return a}(f),B=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}k(a,b);a.prototype.beginSlot=function(b){return b===this.slot};a.prototype.getProgram=function(){return this.program};
a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(u.highlightPass,{flipV:b.flipV,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,vvOpacity:b.vvOpacityEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,transparencyDiscard:b.transparent});this.pipelineState=v.makePipelineState({polygonOffset:b.polygonOffset&&K,culling:H(b),depthTest:{func:513},depthWrite:v.defaultDepthWriteParams,
colorWrite:v.defaultColorWriteParams})};a.prototype.selectSlot=function(){this.slot=this.params.transparent?7:5};a.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot()};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);c.setUniform3fv("size",d.size);r.bindVerticalOffset(d.verticalOffset,a,c);r.bindScreenSizePerspective(d.screenSizePerspective,c);
y(c,d)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params,d=a.origin;r.bindView(d,a.view,b);c.slicePlaneEnabled&&r.bindSlicePlane(a.origin,a.slicePlane,b);c.screenSizePerspective&&r.bindCamPos(d,a.viewInvTransp,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};a.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return a}(f),
G=m({size:[1,1,1],wireframe:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,transparent:!1,polygonOffset:!1},e.Default),F=function(){function b(b){this.vertexBufferLayout=b}b.prototype.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};b.prototype.elementCount=
function(b){return b.indices[u.VertexAttrConstants.POSITION].length};b.prototype.write=function(b,a,c,d){if(u.VertexAttrConstants.PROFILERIGHT in a.vertexAttr){var e=a.vertexAttr[u.VertexAttrConstants.PROFILERIGHT],f=a.indices[u.VertexAttrConstants.PROFILERIGHT];t(4===e.size);var l=c.getField(u.VertexAttrConstants.PROFILERIGHT,g.BufferViewVec4f);if(l)p.writeBufferVec4(f,e.data,l,d);else throw Error("unable to acquire view for "+u.VertexAttrConstants.PROFILERIGHT);}if(u.VertexAttrConstants.PROFILEUP in
a.vertexAttr)if(e=a.vertexAttr[u.VertexAttrConstants.PROFILEUP],f=a.indices[u.VertexAttrConstants.PROFILEUP],t(4===e.size),l=c.getField(u.VertexAttrConstants.PROFILEUP,g.BufferViewVec4f))p.writeBufferVec4(f,e.data,l,d);else throw Error("unable to acquire view for "+u.VertexAttrConstants.PROFILEUP);if(u.VertexAttrConstants.PROFILEVERTEXANDNORMAL in a.vertexAttr)if(e=a.vertexAttr[u.VertexAttrConstants.PROFILEVERTEXANDNORMAL],f=a.indices[u.VertexAttrConstants.PROFILEVERTEXANDNORMAL],t(4===e.size),l=
c.getField(u.VertexAttrConstants.PROFILEVERTEXANDNORMAL,g.BufferViewVec4f))p.writeBufferVec4(f,e.data,l,d);else throw Error("unable to acquire view for "+u.VertexAttrConstants.PROFILEVERTEXANDNORMAL);if(this.vertexBufferLayout.hasField(u.VertexAttrConstants.FEATUREVALUE)&&u.VertexAttrConstants.FEATUREVALUE in a.vertexAttr)if(e=a.vertexAttr[u.VertexAttrConstants.FEATUREVALUE],f=a.indices[u.VertexAttrConstants.FEATUREVALUE],t(4===e.size),l=c.getField(u.VertexAttrConstants.FEATUREVALUE,g.BufferViewVec4f))p.writeBufferVec4(f,
e.data,l,d);else throw Error("unable to acquire view for "+u.VertexAttrConstants.FEATUREVALUE);p.writeDefaultAttributes(a,this.vertexBufferLayout,b.transformation,b.invTranspTransformation,c,d)};return b}(),K={factor:2,units:2},H=function(b){var a;a=b.slicePlaneEnabled?!1:b.cullFace?"none"!==b.cullFace:!b.transparent&&!b.doubleSided;return a&&{face:"front"===b.cullFace?1028:1029,mode:2305}};return n})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./constants ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(b,c,d,e){return a.call(this,b,c,d,e)||this}m(e,a);e.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return k(this,function(b){this._prepareFillResources();this._prepareOutlineResources();return[2]})})};e.prototype._prepareFillResources=function(){var b=g.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacityAndColor(b);this._material=
new G({color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_colormat"));this._context.stage.add(3,this._material)};e.prototype._prepareOutlineResources=function(){var b=this.symbolLayer.outline;if(this._hasOutline=!!(g.isSome(b)&&b.size&&0<b.size&&g.isSome(b.color)))b=l.pt2px(g.isSome(b)?b.size:0),b=1.5<=b?new K({width:b,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},
this._getIdHint("_outline_ribbonlinemat")):new F({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_outline_nativelinemat")),this._outlineMaterial=b,this._context.stage.add(3,this._outlineMaterial)};e.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=null)};
e.prototype.createGraphics3DGraphic=function(b){var a=b.graphic;if(!this._validateGeometryType(a.geometry,e.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(a.geometry))return null;var c="graphic"+a.uid;b=this._getVertexOpacityAndColor(b.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(a);return"on-the-ground"===d.mode?this._createAsOverlay(a,b,d,c):this._createAs3DShape(a,b,d,c,a.uid)};e.prototype.layerOpacityChanged=function(){var b=this._material.getParameters().color,
a=g.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacity(a);this._material.setParameterValues({color:[b[0],b[1],b[2],a],transparent:1>a||this._isPropertyDriven("opacity")});this._outlineMaterial&&(b=this._outlineMaterial.getParameters().color,this._outlineMaterial.setParameterValues({color:[b[0],b[1],b[2],this._getOutlineOpacity()]}));return!0};e.prototype.layerElevationInfoChanged=function(b,a,c){var d=this._elevationContext.mode;c=v.elevationModeChangeUpdateType(e.elevationModeChangeTypes,
c,d);if(c!==v.SymbolUpdateType.UPDATE)return c;var f=v.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(b,a,function(){return f})};e.prototype.slicePlaneEnabledChanged=function(b,a){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};e.prototype.physicalBasedRenderingChanged=function(b,a){return!0};e.prototype.pixelRatioChanged=
function(b,a){return!0};e.prototype.setDrawOrder=function(b,a,c){this.updateSymbolLayerOrder(b,a);this._material&&(this._material.renderPriority=b+a/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=b,c.add(this._outlineMaterial.id))};e.prototype._createAs3DShape=function(b,a,c,d,e){var f=v.getGeometryAsPolygon(b.geometry);b=v.getGeometryVertexData3D(f.rings,f.hasZ,f.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,
c);I.idHint=d;I.color=a;I.data=b;var g;this._hasOutline&&(g=new Float64Array(b.vertexData));I.outNum=0;I.outGeometries=[];I.outTransforms=[];I.outMaterials=[];this._createAs3DShapeFill(I);I.data.vertexData=g;this._createAs3DShapeOutline(I);this._logGeometryCreationWarnings(I.data,f.rings,"rings","FillSymbol3DLayer");if(0===I.outNum)return null;a=new E({geometries:I.outGeometries,materials:I.outMaterials,transformations:I.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e},
idHint:d});a=new u(this,a,I.outGeometries,null,null,r.perVertexElevationAligner,c);a.alignedTerrainElevation=b.terrainElevation;a.needsElevationUpdates=v.needsElevationUpdates2D(c.mode);return a};e.prototype._createAs3DShapeFill=function(a){for(var d=a.data.geometryData.polygons,e=a.data.eleVertexData,g=a.data.vertexData,l=function(l){var k=d[l],p=k.count,m=k.index;if(h._context.clippingExtent&&(v.computeBoundingBox(e,m,p,H),v.boundingBoxClipped(H,h._context.clippingExtent)))return"continue";l=new Float64Array(e.buffer,
3*m*e.BYTES_PER_ELEMENT,3*p);k=k.holeIndices.map(function(b){return b-m});k=f(l,k,3);if(0===k.length)return"continue";v.applyOrigin(g,m,p,N);k=new Uint32Array(k);p=new Float64Array(g.buffer,3*m*g.BYTES_PER_ELEMENT,3*p);l=z.createPolygonGeometryData({indices:k,vertices:p,color:a.color,eleVertices:l});l=new A(l,a.idHint);l.singleUse=!0;p=b.mat4f64.create();c.mat4.translate(p,p,N);a.outGeometries.push(l);a.outMaterials.push(h._material);a.outTransforms.push(p);a.outNum++},h=this,k=0;k<d.length;++k)l(k)};
e.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var d=a.data.geometryData.outlines,e=a.data.eleVertexData,f=a.data.vertexData,g=0;g<d.length;++g){var l=d[g],h=l.index,k=l.count;if(this._context.clippingExtent&&(v.computeBoundingBox(e,h,k,H),v.boundingBoxClipped(H,this._context.clippingExtent)))continue;v.applyOrigin(f,h,k,N);l=new Float64Array(e.buffer,3*h*e.BYTES_PER_ELEMENT,3*k);h=new Float64Array(f.buffer,3*h*f.BYTES_PER_ELEMENT,3*k);h=x.createPolylineGeometry(h,l,!1,q.WHITE,
1);h=new A(h,a.idHint+"outline"+g);h.singleUse=!0;l=b.mat4f64.create();c.mat4.translate(l,l,N);a.outGeometries.push(h);a.outMaterials.push(this._outlineMaterial);a.outTransforms.push(l);a.outNum++}};e.prototype._createAsOverlay=function(b,a,c,d){c=v.getGeometryAsPolygon(b.geometry);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);var e=v.getGeometryVertexDataDraped(c.rings,c.spatialReference,
this._context.overlaySR);I.idHint=d;I.color=a;I.data=e;var f;this._hasOutline&&(f=new Float64Array(e.vertexData));I.outNum=0;I.outGeometries=[];I.outBoundingBox=p.empty();I.layerUid=this._context.layer.uid;I.graphicsUid=b.uid;this._createAsOverlayFill(I);I.data.vertexData=f;this._createAsOverlayOutline(I);this._logGeometryCreationWarnings(I.data,c.rings,"rings","FillSymbol3DLayer");return 0<I.outNum?new w(this,I.outGeometries,I.outBoundingBox):null};e.prototype._createAsOverlayFill=function(a){for(var d=
a.data.vertexData,e=a.data.geometryData.polygons,g=function(g){var h=e[g];g=h.count;var k=h.index;v.computeBoundingBox(d,k,g,H);if(v.boundingBoxClipped(H,l._context.clippingExtent))return"continue";var m=new Float64Array(d.buffer,3*k*d.BYTES_PER_ELEMENT,3*g),h=h.holeIndices.map(function(b){return b-k}),m=f(m,h,3);if(0===m.length)return"continue";p.expand(a.outBoundingBox,H);v.applyOrigin(d,k,g,N);v.setZ(d,k,g,l._getDrapedZ());g=new Uint32Array(m.length);for(h=0;h<m.length;h++)g[h]=m[h]+k;g=z.createPolygonGeometryData({indices:g,
vertices:d,color:a.color});m=new B(g);m.data.layerUid=a.layerUid;m.data.graphicUid=a.graphicsUid;m.material=l._material;h=H;m.center=[.5*(h[0]+h[3]),.5*(h[1]+h[4]),0];m.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]));h=b.mat4f64.create();c.mat4.translate(h,h,N);m.transformation=h;m.name=a.idHint;m.uniqueName=a.idHint+"#"+g.id;a.outGeometries.push(m);a.outNum++},l=this,h=0;h<e.length;++h)g(h)};e.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var d=a.data.vertexData,
e=a.data.geometryData.outlines,f=0;f<e.length;++f){var g=e[f],l=g.index,g=g.count;v.computeBoundingBox(d,l,g,H);if(!v.boundingBoxClipped(H,this._context.clippingExtent)){p.expand(a.outBoundingBox,H);v.applyOrigin(d,l,g,N);v.setZ(d,l,g,this._getDrapedZ());l=new Float64Array(d.buffer,3*l*d.BYTES_PER_ELEMENT,3*g);l=x.createPolylineGeometry(l,null,!0,q.WHITE,1);g=new B(l);g.data.layerUid=a.layerUid;g.data.graphicUid=a.graphicsUid;g.material=this._outlineMaterial;var h=H;g.center=[.5*(h[0]+h[3]),.5*(h[1]+
h[4]),0];g.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]));h=b.mat4f64.create();c.mat4.translate(h,h,N);g.transformation=h;g.name=a.idHint+"outline";g.uniqueName=a.idHint+"outline#"+l.id;a.outGeometries.push(g);a.outNum++}}};e.prototype._getOutlineOpacity=function(){var b=g.get(this.symbolLayer,"outline","color");return this._getLayerOpacity()*(g.isSome(b)?b.a:0)};e.prototype._getOutlineColor=function(){var b=g.get(this.symbolLayer,"outline","color"),a=this._getOutlineOpacity();
return t.mixinColorAndOpacity(g.isSome(b)?d.toUnitRGB(b):null,a)};e.validGeometryTypes=["polyline","polygon","extent"];e.elevationModeChangeTypes={definedChanged:v.SymbolUpdateType.RECREATE,staysOnTheGround:v.SymbolUpdateType.NONE,onTheGroundChanged:v.SymbolUpdateType.RECREATE};return e}(y.default);a.Graphics3DPolygonFillSymbolLayer=n;var H=p.create(),N=e.vec3f64.create(),I={idHint:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null,color:null};a.default=
n})},"esri/views/3d/layers/graphics/polygonUtils":function(){define(["require","exports","../../webgl-engine/lib/GeometryData","../../webgl-engine/lib/Util"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.createPolygonGeometryData=function(a){var d={},g={};g[k.VertexAttrConstants.POSITION]={size:3,data:a.vertices};d[k.VertexAttrConstants.POSITION]=a.indices;if(a.color){var l=new Uint32Array(a.indices.length);g[k.VertexAttrConstants.COLOR]={size:4,data:a.color};d[k.VertexAttrConstants.COLOR]=
l}a.uv0&&(g[k.VertexAttrConstants.UV0]={size:2,data:a.uv0},d[k.VertexAttrConstants.UV0]=a.indices);a.eleVertices&&(g.mapPos={size:3,data:a.eleVertices},d.mapPos=a.indices);return new m.GeometryData(g,d)}})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ColorPrograms ../../../webgl/renderState".split(" "),
function(n,a,m,k,h,d,g,l,f,c){n=function(a){function c(b,c){c=a.call(this,c)||this;c.supportsEdges=!0;c.params=g.copyParameters(b,p);return c}m(c,a);c.prototype.setParameterValues=function(b){var a=this.params,c;for(c in b)a[c]=b[c];this.notifyDirty("matChanged")};c.prototype.getParameters=function(){return this.params};c.prototype.intersect=function(b,a,c,d,e,f,l,h,k){g.intersectTriangleGeometry(b,a,d,e,f,l)};c.prototype.getGLMaterials=function(){return{color:b,depthShadowMap:void 0,normal:void 0,
depth:void 0,highlight:e}};c.prototype.createBufferWriter=function(){return new d.DefaultBufferWriter(d.PositionColorLayout)};c.prototype.createRenderer=function(b,a){return new l(b,a,this)};return c}(h.Material);var b=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}m(a,b);a.prototype.updateParameters=function(){this.params=g.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(f.colorPass,
{vertexColors:b.vertexColors,slice:b.slicePlaneEnabled});this.pipelineState=c.makePipelineState({blending:b.transparent&&c.separateBlendingParams(770,1,771,771),polygonOffset:b.polygonOffset&&q,culling:r(b.cullFace),depthTest:b.testDepth&&{func:513},depthWrite:b.writeDepth&&c.defaultDepthWriteParams,colorWrite:c.defaultColorWriteParams})};a.prototype.beginSlot=function(b){var a=5;this.params.transparent&&(a=this.params.writeDepth?7:10);return b===a};a.prototype.getProgram=function(){return this.program};
a.prototype.bind=function(b,a){a=this.program;var c=this.params;b.bindProgram(a);b.setPipelineState(this.pipelineState);a.setUniform4fv("eColor",c.color)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params;g.bindView(a.origin,a.view,b);c.slicePlaneEnabled&&g.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=function(){return 4};return a}(k),
e=function(b){function a(a){a=b.call(this,a)||this;a.updateParameters();return a}m(a,b);a.prototype.updateParameters=function(){this.params=g.copyParameters(this.material.getParameters());this.selectProgram()};a.prototype.selectProgram=function(){var b=this.params;this.program=this.programRep.getProgram(f.colorPass,{vertexColors:b.vertexColors,slice:b.slicePlaneEnabled});this.pipelineState=c.makePipelineState({polygonOffset:b.polygonOffset&&q,culling:r(b.cullFace),depthTest:b.testDepth&&{func:513},
depthWrite:b.writeDepth&&c.defaultDepthWriteParams,colorWrite:c.defaultColorWriteParams})};a.prototype.beginSlot=function(b){return 5===b};a.prototype.getProgram=function(){return this.program};a.prototype.bind=function(b,a){var c=this.program,d=this.params;b.bindProgram(c);b.setPipelineState(this.pipelineState);g.bindHighlightRendering(b,a,c);c.setUniform4fv("eColor",d.color)};a.prototype.release=function(b){};a.prototype.bindView=function(b,a){b=this.program;var c=this.params;g.bindView(a.origin,
a.view,b);c.slicePlaneEnabled&&g.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){this.program.setUniformMatrix4fv("model",a.transformation)};a.prototype.getDrawMode=function(){return 4};return a}(k),p={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:"none"},q={factor:1,units:1},r=function(b){return"none"!==b&&{face:"front"===b?1028:1029,mode:2305}};return n})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["require",
"exports","../../../support/buffer/InterleavedLayout","../../lib/Util","./bufferWriterUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});a.PositionUVLayout=m.newLayout().vec3f(k.VertexAttrConstants.POSITION).vec2f(k.VertexAttrConstants.UV0);a.PositionColorLayout=m.newLayout().vec3f(k.VertexAttrConstants.POSITION).vec4u8(k.VertexAttrConstants.COLOR);n=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices[k.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,d,f,c){h.writeDefaultAttributes(d,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,f,c)};return a}();a.DefaultBufferWriter=n})},"esri/views/3d/webgl-engine/shaders/ColorPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",
{value:!0});var d=function(a){return h.glslifyDefineMap({VERTEX_COLORS:a.vertexColors,SLICE:a.slice})};a.colorPass={name:"color-color",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("materials/color/color.vert"),fragmentShader:d(a)+k.resolveIncludes("materials/color/color.frag")}},attributes:m.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){function A(b,a,c){b&&b.forEach(function(b){var d=a(b);g.isSome(d)&&c(d,b.graphic)})}Object.defineProperty(a,"__esModule",{value:!0});var E=[0,0,1];n=function(a){function r(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._geometryDataPool=new l(v.GeometryData,function(b,a,c){var d=a.translation;c=g.isSome(c)?[c.displayWidth,c.displayHeight]:[0,0];a=a.centerOffset;0===b.indexCount?y.createPointGeometry(E,d,null,c,a,[0,0],null,b):y.updatePointGeometry(null,
d,null,c,a,null,null,b)});b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return b}m(r,a);r.prototype.doLoad=function(){return h(this,void 0,void 0,function(){var b;return k(this,function(a){if(!this._isPropertyDriven("size")&&(b=w.validateSymbolLayerSize(this.symbolLayer.size)))throw new d("graphics3dtextsymbollayer:invalid-size",b);this._createTextRenderParameters();return[2]})})};r.prototype._createTextRenderParameters=function(){this._textRenderParameters=t.default.fromSymbol(this.symbolLayer,
this._context.layerView.view.pixelRatio)};r.prototype.destroy=function(){a.prototype.destroy.call(this);this._geometryDataPool.destroy()};r.prototype.createGraphics3DGraphic=function(a){a=a.graphic;var c=q.placePointOnGeometry(a.geometry);if(g.isNone(c))return this.logger.warn("unsupported geometry type for text symbol: "+a.geometry.type),null;var d=this.symbolLayer.text;if(!d)return null;var e=b.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(a,
c,d,e)};r.prototype.onRemoveGraphic=function(b){this._geometryDataPool.release(b.stageObject.geometries[0].data)};r.prototype.createLabel=function(b,a,c,d){b=b.graphic;var e=q.placePointOnGeometry(b.geometry);if(g.isNone(e))return this.logger.warn("unsupported geometry type for label: "+b.geometry.type),null;var f=a.text;return f?this._createAs3DShape(b,e,f,a,a,c,d):null};r.prototype.getGraphicElevationContext=function(b,c){void 0===c&&(c=0);b=a.prototype.getGraphicElevationContext.call(this,b);b.addOffsetRenderUnits(c);
return b};r.prototype.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};r.prototype.layerElevationInfoChanged=function(b,a){var c=this;A(b,a,function(b,a){c.updateGraphicElevationContext(a,b)});return q.SymbolUpdateType.UPDATE};r.prototype.slicePlaneEnabledChanged=function(b,a){var c=this;A(b,a,function(b){var a=0;for(b=b.stageObject.geometryRecords;a<b.length;a++)b[a].material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});
return!0};r.prototype.physicalBasedRenderingChanged=function(b,a){return!0};r.prototype.pixelRatioChanged=function(b,a){return!1};r.prototype.updateGraphicElevationContext=function(b,a){b=this.getGraphicElevationContext(b,a.metadata.elevationOffset);a.elevationContext.set(b);a.needsElevationUpdates=q.needsElevationUpdates2D(b.mode)||"absolute-height"===b.mode};r.prototype._defaultElevationInfoNoZ=function(){return B};r.prototype._createAs3DShape=function(b,a,d,l,h,k,m){void 0===h&&(h=G);var r=this.getGraphicElevationContext(b,
h.elevationOffset),n=this._context.layer.id+"_label_"+b.uid,t="polyline"===g.get(b.geometry,"type"),v=b.uid;b=this._context.stage.renderView.renderingContext;var y=w.namedAnchorToHUDMaterialAnchorPos[h.anchor in w.namedAnchorToHUDMaterialAnchorPos?h.anchor:"center"];b=g.isNone(m)?new x(b,d,this._textRenderParameters,n):null;y={occlusionTest:!0,screenOffset:h.screenOffset,anchorPos:y,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:h.centerOffsetUnits,debugDrawBorder:h.debugDrawBorder,drawInSecondSlot:!0};
g.isSome(b)&&(y.textureId=b.id,y.texCoordScale=b.texcoordScale);g.isSome(m)&&(y.textureId=m.textureId);if(g.isSome(l)&&g.isSome(l.verticalOffset)){l=l.verticalOffset;m=l.minWorldLength;var A=l.maxWorldLength;y.verticalOffset={screenLength:f.pt2px(l.screenLength),minWorldLength:m||0,maxWorldLength:null!=A?A:Infinity}}this._context.screenSizePerspectiveEnabled&&(l=this._context.sharedResources,m=l.screenSizePerspectiveSettings,y.screenSizePerspective=l.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),
y.screenSizePerspectiveAlignment=m);t&&(y.shaderPolygonOffset=1E-4);y.slicePlaneEnabled=this._context.slicePlaneEnabled;t=null;l=JSON.stringify(y);g.isSome(k)?(t=k.getMaterial(l),null==t&&(t=new z(y,n),k.addMaterial(l,t))):t=new z(y,n);t=[t];y=this._geometryDataPool.acquire(h,b);y=[new u(y,n)];n=q.createStageObjectForPoint(this._context,a,y,t,null,null,r,n,this._context.layer.uid,v,!0);if(null===n)return null;v=e.perObjectElevationAligner;k=new p(this,n.object,y,g.isNone(k)?t:null,g.isSome(b)?[b]:
null,v,r);k.alignedTerrainElevation=n.terrainElevation;k.needsElevationUpdates=q.needsElevationUpdates2D(r.mode)||"absolute-height"===r.mode;var r=g.isSome(b)?b:h,B=r.displayWidth,H=r.displayHeight;k.getScreenSize=function(b){void 0===b&&(b=c.vec2f64.create());b[0]=B;b[1]=H;return b};k.metadata={labelText:d,elevationOffset:h.elevationOffset};q.extendPointGraphicElevationContext(k,a,this._context.elevationProvider);return k};return r}(r.default);a.Graphics3DTextSymbolLayer=n;var B={mode:"relative-to-ground",
offset:0},G={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};a.default=n})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("require exports ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",
{value:!0});n=function(){function a(a){this.definition=a;this.key=JSON.stringify(a);this.haloSize=Math.round(a.halo.size);this.fillStyle=this.colorToRGBA(a.color);this.haloStyle=this.colorToRGB(a.halo.color)}a.prototype.colorToRGB=function(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"};a.prototype.colorToRGBA=function(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"};a.fromSymbol=function(g,f){void 0===f&&(f=
1);var c=k.get(g,"material","color"),c=k.isSome(c)?m.toUnitRGBA(c):d.ZEROS,b=g.halo,e=null!=g.size?h.pt2px(g.size):12;g={family:g.font&&g.font.family?g.font.family:"sans-serif",weight:g.font&&g.font.weight?g.font.weight:"normal",style:g.font&&g.font.style?g.font.style:"normal"};b=k.isSome(b)&&k.isSome(b.color)&&0<b.size?{size:h.pt2px(b.size),color:m.toUnitRGBA(b.color)}:{size:0,color:d.ZEROS};return new a({size:e,color:c,font:g,halo:b,pixelRatio:f})};return a}();a.TextRenderParameters=n;a.default=
n})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/mathUtils ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),function(n,a,m,k,h,d,g){var l={canvas:null};return function(){function a(a,b,d,f){this._idHint=f;this._requiresPowerOfTwo=!g.default(a.gl);this._renderer=new k.default(b,d)}Object.defineProperty(a.prototype,"id",{get:function(){null==this._id&&(this._id=h.idGen.gen(this._idHint));return this._id},
enumerable:!0,configurable:!0});a.prototype.deferredLoading=function(){return!1};a.prototype.getWidth=function(){return this._renderer.renderedWidth};a.prototype.getHeight=function(){return this._renderer.renderedHeight};Object.defineProperty(a.prototype,"textureWidth",{get:function(){var a=this.getWidth();return this._requiresPowerOfTwo?m.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureHeight",{get:function(){var a=this.getHeight();return this._requiresPowerOfTwo?
m.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},
enumerable:!0,configurable:!0});a.prototype.initializeThroughRender=function(a,b){var c=k.getTextHelperCanvas(l,this.textureWidth,this.textureHeight),f=c.getContext("2d");f.save();b.samplingMode=9987;b.wrapMode=33071;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this._renderer.render(f,0,this.textureHeight-this._renderer.renderedHeight);a=new d(a,b,c);f.restore();return a};a.prototype.setUnloadFunc=function(a){this._unloadFunc=a};a.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),
this._unloadFunc=null)};return a}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require","exports","../../../../core/maybe","./TextRenderParameters"],function(n,a,m,k){function h(a,b,d){a.canvas||(a.canvas=document.createElement("canvas"));a.canvas.width=b;a.canvas.height=d;return a.canvas}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,c,d){void 0===d&&(d=2048);this.text=a;this.maxSize=d;this._displayWidth=this._renderPixelRatio=null;this.parameters=
c instanceof k.default?c:new k.default(c);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}Object.defineProperty(a.prototype,"displayWidth",{get:function(){m.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*
this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderPixelRatio",{get:function(){if(m.isNone(this._renderPixelRatio)){var a=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},
enumerable:!0,configurable:!0});a.prototype.render=function(a,c,d){void 0===c&&(c=0);void 0===d&&(d=0);var b=this.renderedLineHeight,e=this.renderedHaloSize,f=a.textAlign,g=this.renderedWidth,f=("center"===f?.5*g:"right"===f?g:0)+e;a.save();0<e&&this.renderHalo(a,f,e,c,d);this.setFontProperties(a,this.renderedFontSize);d+=e;c+=f;e=0;for(f=this.textLines;e<f.length;e++)g=f[e],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(g,c,d),a.globalCompositeOperation="source-over",
a.fillStyle=this.parameters.fillStyle,a.fillText(g,c,d),d+=b;a.restore()};a.prototype.renderHalo=function(a,c,d,g,k){var b=this.renderedWidth,e=this.renderedHeight,p=h(l,Math.max(b,f),Math.max(e,f)),m=p.getContext("2d");m.clearRect(0,0,b,e);this.setFontProperties(m,this.renderedFontSize);m.fillStyle=this.parameters.haloStyle;m.strokeStyle=this.parameters.haloStyle;var q=3>this.renderedHaloSize;m.lineJoin=q?"miter":"round";q?this.renderHaloEmulated(m,c,d):this.renderHaloNative(m,c,d);a.globalAlpha=
this.parameters.definition.halo.color[3];a.drawImage(p,0,0,b,e,g,k,b,e);a.globalAlpha=1};a.prototype.renderHaloEmulated=function(a,c,f){for(var b=this.renderedLineHeight,e=this.renderedHaloSize,g=0,l=this.textLines;g<l.length;g++){for(var h=l[g],k=0,p=d;k<p.length;k++){var m=p[k];a.fillText(h,c+e*m[0],f+e*m[1])}f+=b}};a.prototype.renderHaloNative=function(a,c,d){for(var b=this.renderedLineHeight,e=this.renderedHaloSize,f=0,g=this.textLines;f<g.length;f++){for(var l=g[f],h=2*e,k=0;5>k;k++)a.lineWidth=
(.6+.1*k)*h,a.strokeText(l,c,d);d+=b}};a.prototype.setFontProperties=function(a,c){var b=this.parameters.definition.font;a.font=b.style+" "+b.weight+" "+c+"px "+b.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};a.prototype.computeTextWidth=function(){var a=h(l,f,f).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var c=0,d=0,g=this.textLines;d<g.length;d++)c=Math.max(c,a.measureText(g[d]).width);d=this.parameters.definition.font;if("italic"===d.style||
"oblique"===d.style||"string"===typeof d.weight&&("bold"===d.weight||"bolder"===d.weight)||"number"===typeof d.weight&&600<d.weight)c+=.3*a.measureText("A").width;c+=2*this.parameters.haloSize;return Math.round(c)};a.prototype.computeLineHeight=function(){return Math.floor(1.275*this.parameters.definition.size+2*this.parameters.haloSize)};return a}();a.TextRenderer=n;for(var d=[],g=0;360>g;g+=22.5)d.push([Math.cos(Math.PI*g/180),Math.sin(Math.PI*g/180)]);a.getTextHelperCanvas=h;var l={canvas:null},
f=512;a.default=n})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function r(b,c,d,e){return a.call(this,b,c,d,e)||this}k(r,a);r.prototype.doLoad=function(){return d(this,void 0,void 0,function(){var a,b;return h(this,function(c){a=N.waterParameterDefaultsLocal;b=m({},a);this._updateMaterialParameters(b);b.isDraped=!0;this._drapedMaterial=new H.WaterMaterial(b,"waterDraped");this._context.stage.add(3,this._drapedMaterial);this._updateMaterialParameters(a);
this._material=new H.WaterMaterial(a,"water");this._context.stage.add(3,this._material);return[2]})})};r.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(3,this._drapedMaterial.id),this._drapedMaterial=null)};r.prototype.createGraphics3DGraphic=function(a){a=a.graphic;if(!this._validateGeometryType(a.geometry,r.validGeometryTypes,this.symbolLayer.type)||
!this._validateGeometry(a.geometry))return null;var b="graphic"+a.uid,c=this.getGraphicElevationContext(a);return"on-the-ground"===c.mode?this._createAsOverlay(a,b):this._createAs3DShape(a,c,b,a.uid)};r.prototype.layerOpacityChanged=function(){var a=this._material.getParameters().color,b=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),c=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:c});this._drapedMaterial.setParameterValues({color:[a[0],
a[1],a[2],b],transparent:c});return!0};r.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=A.elevationModeChangeUpdateType(r.elevationModeChangeTypes,c,d);if(c!==A.SymbolUpdateType.UPDATE)return c;var e=A.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};r.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._drapedMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};r.prototype.physicalBasedRenderingChanged=function(a,b){return!0};r.prototype.pixelRatioChanged=function(a,b){return!0};r.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._drapedMaterial&&(this._drapedMaterial.renderPriority=a+b/2,c.add(this._drapedMaterial.id))};r.prototype._createAs3DShape=function(a,b,c,d){var e=A.getGeometryAsPolygon(a.geometry);a=A.getGeometryVertexData3D(e.rings,
e.hasZ,e.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,b);var f=a.vertexData.length/3;a.uvCoords=new Float64Array(2*f);O.idHint=c;O.data=a;O.outNum=0;O.outGeometries=[];O.outTransforms=[];O.outMaterials=[];this._create3DShapeGeometries(O);this._logGeometryCreationWarnings(O.data,e.rings,"rings","WaterSymbol3DLayer");if(0===O.outNum)return null;this._createUVCoordsFromVertices(O.data.uvCoords,O.data.eleVertexData,f,this._context.elevationProvider.spatialReference);
c=new F({geometries:O.outGeometries,materials:O.outMaterials,transformations:O.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:c});c=new z(this,c,O.outGeometries,null,null,t.perVertexElevationAligner,b);c.alignedTerrainElevation=a.terrainElevation;c.needsElevationUpdates=A.needsElevationUpdates2D(b.mode);return c};r.prototype._createUVCoordsFromVertices=function(a,b,c,d){d=f.getMetersPerUnitForSR(d);y.empty(J);for(var e=0;e<c;e++)p.vec2.set(M,b[3*e+0],b[3*
e+1]),y.expandPointInPlace(J,M);w.vec4.scale(J,J,d);e=J[1]%r.unitSizeOfTexture;I[0]=J[0]-J[0]%r.unitSizeOfTexture;I[1]=J[1]-e;for(e=0;e<c;e++)a[2*e+0]=(b[3*e+0]*d-I[0])/r.unitSizeOfTexture,a[2*e+1]=(b[3*e+1]*d-I[1])/r.unitSizeOfTexture};r.prototype._create3DShapeGeometries=function(a){for(var c=a.data.eleVertexData,d=a.data.vertexData,f=a.data.uvCoords,g=0,l=a.data.geometryData.polygons;g<l.length;g++){var h=l[g],k=h.count,p=h.index;if(this._context.clippingExtent&&(A.computeBoundingBox(c,p,k,L),
A.boundingBoxClipped(L,this._context.clippingExtent)))continue;var m=new Float64Array(c.buffer,3*p*c.BYTES_PER_ELEMENT,3*k),h=this._runEarcut(m,h);if(0!==h.length){h=new Uint32Array(h);A.applyOrigin(d,p,k,R);var q=new Float64Array(d.buffer,3*p*d.BYTES_PER_ELEMENT,3*k),k=new Float64Array(f.buffer,2*p*f.BYTES_PER_ELEMENT,2*k),m=B.createPolygonGeometryData({indices:h,vertices:q,uv0:k,eleVertices:m}),m=new G(m,a.idHint);m.singleUse=!0;k=e.mat4f64.create();b.mat4.translate(k,k,R);a.outGeometries.push(m);
a.outMaterials.push(this._material);a.outTransforms.push(k);a.outNum++}}};r.prototype._updateMaterialParameters=function(a){var b=this.symbolLayer.color;l.isSome(b)&&(a.color=g.toUnitRGBA(b));b=this._getCombinedOpacity(b,{hasIntrinsicColor:!0});a.color=[a.color[0],a.color[1],a.color[2],b];a.transparent=1>b||this._isPropertyDriven("opacity");a.waveDirection=l.isSome(this.symbolLayer.waveDirection)?r.headingVectorFromAngle(this.symbolLayer.waveDirection):q.vec2f64.fromValues(0,0);b=N.wavePresets[this.symbolLayer.waveStrength+
"-"+this.symbolLayer.waterbodySize];a.waveStrength=b.waveStrength;a.waveTextureRepeat=b.textureRepeat;a.waveVelocity=b.waveVelocity;a.flowStrength=b.perturbationStrength};r.prototype._createAsOverlay=function(a,b){var c=A.getGeometryAsPolygon(a.geometry);this._drapedMaterial.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;var d=A.getGeometryVertexDataDraped(c.rings,c.spatialReference,this._context.overlaySR);O.idHint=b;O.data=d;b=d.vertexData.length/3;d.uvCoords=new Float64Array(2*
b);O.outNum=0;O.outGeometries=[];O.outBoundingBox=v.empty();O.layerUid=this._context.layer.uid;O.graphicsUid=a.uid;this._createAsOverlayWater(O);this._logGeometryCreationWarnings(O.data,c.rings,"rings","WaterSymbol3DLayer");if(0===O.outNum)return null;this._createUVCoordsFromVertices(O.data.uvCoords,O.data.vertexData,b,c.spatialReference);return 0<O.outNum?new x(this,O.outGeometries,O.outBoundingBox):null};r.prototype._runEarcut=function(a,b){var d=b.holeIndices.map(function(a){return a-b.index});
return c(a,d,3)};r.prototype._createAsOverlayWater=function(a){for(var c=a.data.vertexData,d=a.data.uvCoords,f=0,g=a.data.geometryData.polygons;f<g.length;f++){var l=g[f],h=l.count,k=l.index;A.computeBoundingBox(c,k,h,L);if(!A.boundingBoxClipped(L,this._context.clippingExtent)){v.expand(a.outBoundingBox,L);var p=new Float64Array(c.buffer,3*k*c.BYTES_PER_ELEMENT,3*h),l=this._runEarcut(p,l);0!==l.length&&(l=new Uint32Array(l),A.applyOrigin(c,k,h,R),A.setZ(c,k,h,this._getDrapedZ()),h=new Float64Array(d.buffer,
2*k*d.BYTES_PER_ELEMENT,2*h),p=B.createPolygonGeometryData({indices:l,vertices:p,uv0:h}),h=new K(p),h.data.layerUid=a.layerUid,h.data.graphicUid=a.graphicsUid,h.material=this._drapedMaterial,k=L,h.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0],h.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1])),k=e.mat4f64.create(),b.mat4.translate(k,k,R),h.transformation=k,h.name=a.idHint,h.uniqueName=a.idHint+"#"+p.id,a.outGeometries.push(h),a.outNum++)}}};r.headingVectorFromAngle=function(a){var b=
q.vec2f64.create();a=u.toRadian(a);b[0]=Math.sin(a);b[1]=Math.cos(a);return b};Object.defineProperty(r.prototype,"test",{get:function(){var a=this;return{create3DShape:function(b){return a._createAs3DShape(b.graphic,b.elevationContext,b.idHint,b.graphicUid)}}},enumerable:!0,configurable:!0});r.validGeometryTypes=["polyline","polygon","extent"];r.unitSizeOfTexture=100;r.elevationModeChangeTypes={definedChanged:A.SymbolUpdateType.RECREATE,staysOnTheGround:A.SymbolUpdateType.NONE,onTheGroundChanged:A.SymbolUpdateType.RECREATE};
return r}(E.default);a.Graphics3DWaterSymbolLayer=n;var I=q.vec2f64.create(),J=y.create(),M=q.vec2f64.create(),L=v.create(),R=r.vec3f64.create(),O={idHint:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.default=n})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../lib/AnimationTimer ../lib/Material ./WaterGLMaterial ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils ./renderers/MergedRenderer".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(b,d){d=a.call(this,d)||this;d.animation=new h.AnimationTimer;d.params=f.copyParameters(b,c.waterParameterDefaultsLocal);return d}m(d,a);d.prototype.setParameterValues=function(a){this.params=k({},this.params,a);this.notifyDirty("matChanged")};d.prototype.getParameters=function(){return this.params};d.prototype.update=function(a){this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*
Math.min(a.camera.relativeElevation,a.camera.distance)<e;this.animation.advance(a.dt);return this.animation.enabled};d.prototype.intersect=function(a,b,c,d,e,g,l,h,k){f.intersectTriangleGeometry(a,b,d,e,g,l)};d.prototype.getGLMaterials=function(){return{color:this.params.isDraped?g.WaterDrapedGLMaterial:g.WaterGLMaterial,depthShadowMap:void 0,normal:g.WaterNormalGLMaterial,depth:void 0,highlight:void 0}};d.prototype.createBufferWriter=function(){return new l.DefaultBufferWriter(l.PositionUVLayout)};
d.prototype.createRenderer=function(a,c){return new b(a,c,this)};return d}(d.Material);a.WaterMaterial=n;var e=35E3})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["require","exports","../../../../core/maybe"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){void 0===a&&(a=!0);this.enabled=a;this._time=0}Object.defineProperty(a.prototype,"time",{get:function(){return m.isSome(this._forcedTime)?this._forcedTime:this._time},enumerable:!0,
configurable:!0});a.prototype.advance=function(a){this.enabled&&(this._time+=a)};a.prototype.forceTime=function(a){this._forcedTime=a};return a}();a.AnimationTimer=n})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Loadable ./symbolComplexity".split(" "),function(n,a,m,k,h,d,g){return function(a){function d(c,b){var d=a.call(this)||
this;d.symbol=c;d.convert=b;d.graphics3DSymbol=null;d.referenced=0;return d}m(d,a);d.prototype.whenSymbolLayerSize=function(a){return h(this,void 0,void 0,function(){return k(this,function(b){switch(b.label){case 0:return[4,this.load()];case 1:return b.sent(),[2,this.graphics3DSymbol.whenSymbolLayerSize(a)]}})})};d.prototype.doLoad=function(a){return h(this,void 0,void 0,function(){var b;return k(this,function(c){switch(c.label){case 0:return[4,this.symbol.fetchSymbol({signal:a})];case 1:return b=
c.sent(),b.id=this.symbol.id,this.graphics3DSymbol=this.convert(b),[4,this.graphics3DSymbol.load()];case 2:return c.sent(),[2]}})})};d.prototype.createGraphics3DGraphic=function(a){return this.graphics3DSymbol.createGraphics3DGraphic(a,this)};Object.defineProperty(d.prototype,"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:g.emptySymbolComplexity},enumerable:!0,configurable:!0});d.prototype.globalPropertyChanged=function(a,b){return this.graphics3DSymbol.globalPropertyChanged(a,
b)};d.prototype.applyRendererDiff=function(a,b){return this.graphics3DSymbol.applyRendererDiff(a,b)};d.prototype.prepareSymbolPatch=function(a){this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(a)};d.prototype.updateGeometry=function(a,b){return this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(a,b):!1};d.prototype.onRemoveGraphic=function(a){};d.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,
slow:0}};d.prototype.setDrawOrder=function(a,b){this.graphics3DSymbol&&this.graphics3DSymbol.setDrawOrder(a,b)};d.prototype.destroy=function(){this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return d}(d.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){function q(a){return e.getGraphics3DSymbol(a.graphics3DGraphic.graphics3DSymbol).symbol.symbolLayers.getItemAt(0)}function r(a){var b=a.graphics3DGraphic.graphic.geometry;if(h.isNone(b))return null;b=b.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return"extrude"===q(a).type?z["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return z["above-center"];
case "mesh":return z["above-center"];default:m.neverReached(b)}}function w(a,b){null==x&&(t.log(a,b),x=d.schedule(function(){x.remove();x=null}))}function u(a,b,c){c=c.graphics3DGraphic._graphics[0];c=h.isSome(c)?c.getBoundingBoxObjectSpace(F):F;c=f.vec3f64.fromValues(c[3]-c[0],c[4]-c[1],c[5]-c[2]);a.centerOffset[0]=1.1*Math.sqrt(c[0]*c[0]+c[1]*c[1])/2*b.normalizedOffset[0];var d=a.translation[2],e=c[2]/2*b.normalizedOffset[1];a.translation[2]=e*(1.1-1);a.elevationOffset=d+e;c=l.vec3.length(c);a.centerOffset[2]=
1.1*c/2*b.normalizedOffset[2]}function v(a){var b=a.labelClass.labelPlacement,c=a.labelSymbol,d=a.graphics3DGraphic,f=e.getGraphics3DSymbol(d.graphics3DSymbol).symbol;a=z[b]||r(a);if("point-3d"===f.type&&f.supportsCallout()&&f.hasVisibleVerticalOffset()&&!d.isDraped())return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(f.verticalOffset),anchor:null,normalizedOffset:null};if(c&&c.hasVisibleVerticalOffset()&&("point-3d"!==f.type||!f.supportsCallout()||!f.verticalOffset||d.isDraped())){a:switch(a.placement){case "above-center":d=
!0;break a;default:d=!1}return d?{placement:"above-center",verticalOffset:y(c.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(w("error","Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+b+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,
maxWorldLength:a.maxWorldLength}}Object.defineProperty(a,"__esModule",{value:!0});var t=k.getLogger("esri.views.3d.layers.graphics.labelPlacement"),x=null;a.get=function(a){var d=v(a);if(h.isNone(d))return null;var e;if(d.anchor)e=d;else{var l=a.labelClass.labelPlacement,k=z[l];e=k||r(a);l&&!k&&w("warn","the requested label placement '"+l+"' is not currently supported in SceneView");l=a.graphics3DGraphic.graphic.geometry;if(h.isNone(l))e=null;else switch(l=l.type,l){case "polyline":case "polygon":case "extent":case "multipoint":a.labelClass.labelPlacement&&
(w("warn","the requested label placement '"+e.placement+"' is currently unsupported for '"+l+"' geometries in SceneView"),e=r(a));break;case "point":case "mesh":break;default:m.neverReached(l)}}if(h.isNone(e))return null;l=!!d.hasLabelVerticalOffset;d={anchor:e.anchor,verticalOffset:d.verticalOffset,screenOffset:g.vec2f64.create(),centerOffset:c.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:f.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:l};l=a.graphics3DGraphic.graphic.geometry;
if(h.isNone(l))a=null;else{switch(l.type){case "point":l=a.graphics3DGraphic;k=q(a);l.getCenterObjectSpace(d.translation);switch(k.type){case "icon":case "text":k=a.graphics3DGraphic;l=k._graphics[0].getScreenSize();k.isDraped()?d.hasLabelVerticalOffset||"center"===d.anchor||(z[a.labelClass.labelPlacement]&&w("warn","the requested placement '"+e.placement+"' is currently unsupported for draped graphics"),d.anchor="center"):(k=void 0,void 0===k&&(k=G),a=a.graphics3DGraphic._graphics[0].stageObject.geometryRecords[0].material,
a instanceof p?(a=a.getParameters().anchorPos,k[0]=2*(a[0]-.5),k[1]=2*(a[1]-.5)):(k[0]=0,k[1]=0),a=k,B[0]=l[0]/2*(e.normalizedOffset[0]-a[0]),B[1]=l[1]/2*(e.normalizedOffset[1]-a[1]),d.screenOffset[0]=B[0],d.hasLabelVerticalOffset?(d.centerOffset[1]=B[1],d.centerOffsetUnits="screen"):d.screenOffset[1]=B[1]);break;case "object":u(d,e,a)}break;case "polygon":switch(q(a).type){case "extrude":l=a.graphics3DGraphic._graphics[0],h.isSome(l)&&l.getBoundingBoxObjectSpace(F),b.center(F,d.translation),d.translation[2]=
b.height(F)/2,u(d,e,a)}break;case "mesh":u(d,e,a)}a=d}return a};var z={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",
normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},A={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],
"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};n=function(a){var b=z[a];A[a].forEach(function(a){z[a]=b})};for(var E in A)n(E);Object.freeze&&(Object.freeze(z),Object.keys(z).forEach(function(a){Object.freeze(z[a]);Object.freeze(z[a].normalizedOffset)}));
var B=[0,0],G=[0,0],F=b.create()})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/arrayUtils ../../../../core/Evented ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./Octree".split(" "),function(n,a,m,k,h,d,g,l,f){return function(a){function b(c,d,f){var e=a.call(this)||this;e._parentStages=new Map;e._children=new Set;e.id=b._idGen.gen(c);e.apiLayerUid=f;e.name=c;d=d||{};
e.group=d.group||"";e.isVisible=null!=d.isVisible?d.isVisible:!0;e.isPickable=null!=d.isPickable?d.isPickable:!0;e.isSliceable=!1;e.translation=d.translation?g.vec3f64.clone(d.translation):g.vec3f64.create();e._extent=[g.vec3f64.fromValues(0,0,0),g.vec3f64.fromValues(1E3,1E3,1E3)];e._extentDirty=!0;return e}m(b,a);b.prototype.addParentStage=function(a){if(!this._parentStages.has(a)){var b=this.on("dirty",function(b){a.notifyDirty(b.contentType,b.origin,b.dirtyType,b.subObject)});this._parentStages.set(a,
b)}};b.prototype.removeParentStage=function(a){var b=this._parentStages.get(a);b&&(b.remove(),this._parentStages.delete(a));this.invalidateSpatialQueryAccelerator()};b.prototype.getName=function(){return this.name};b.prototype.getGroup=function(){return this.group};b.prototype.getTranslation=function(){return this.translation};b.prototype.getObjectIds=function(){return k.keysOfSet(this._children,function(a){return a.id})};b.prototype.getObjects=function(){return k.keysOfSet(this._children)};b.prototype.getExtent=
function(){this._updateExtent();return this._extent};b.prototype.addObject=function(a){this._children.add(a);a.parentLayer=this;this.notifyDirty("layerObjectAdded",a);this._invalidateExtent();this._octree&&this._octree.add(a)};b.prototype.hasObject=function(a){return this._children.has(a)};b.prototype.removeObject=function(a){return this._children.delete(a)?(a.parentLayer=null,this.notifyDirty("layerObjectRemoved",a),this._invalidateExtent(),this._octree&&this._octree.remove(a),!0):!1};b.prototype.notifyObjectBBChanged=
function(a,b){this._octree&&this._octree.update(a,b)};b.prototype.getCenter=function(){this._updateExtent();var a=g.vec3f64.create();return d.vec3.lerp(a,this._extent[0],this._extent[1],.5)};b.prototype.getBSRadius=function(){this._updateExtent();return.5*d.vec3.distance(this._extent[0],this._extent[1])};b.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};b.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",
null)};b.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};b.prototype.notifyDirty=function(a,b,c,d){this.emit("dirty",{contentType:c||0,origin:d||this,dirtyType:a,subObject:b})};b.prototype._createOctree=function(){for(var a=this.getExtent(),b=0,c=0;3>c;c++)b=Math.max(b,a[1][c]-a[0][c]);c=g.vec3f64.create();d.vec3.lerp(c,a[0],a[1],.5);this._octree=new f(c,1.2*b,{getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});
this._octree.add(k.keysOfSet(this._children))};b.prototype._invalidateExtent=function(){this._extentDirty=!0};b.prototype._updateExtent=function(){var a=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var b=null;this._children.forEach(function(c){var d=c.getBBMin();c=c.getBBMax();if(b)for(var e=0;3>e;++e)a._extent[0][e]=Math.min(a._extent[0][e],d[e]),a._extent[1][e]=Math.max(a._extent[1][e],c[e]);else b=[g.vec3f64.clone(d),g.vec3f64.clone(c)]});
this._extent=b}};b._idGen=new l.IdGen;return b}(h)})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports"],function(n,a){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=function(a,h){this.materials[a]=h;this.stage.add(3,h)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(3,this.materials[a].id);this.materials={}};return a}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/iteratorUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ./Texture ../../../support/index ../../../webgl/Texture".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function h(b){b=a.call(this)||this;b.dirty=!1;b.needsClear=!1;b.elementsToAdd=new Map;b.elementsToRemove=new Map;b.elementsToRender=new Map;b.elements=new Map;b.stageObjects=new Map;return b}m(h,a);r=h;h.prototype.initialize=function(){this.id=f.idGen.gen(this.idHint);this.stage=this.view._stage;this.scheduler=this.view.resourceController.scheduler;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(4,this);var a=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(a);this.update2DCanvasSize();this.resetAtlasCursor()};h.prototype.setUnloadFunc=function(a){this.unloadFunc=a};h.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};h.prototype.deferredLoading=function(){return!1};h.prototype.getWidth=function(){return this.atlas.size.width};h.prototype.getHeight=function(){return this.atlas.size.height};
h.prototype.initializeThroughRender=function(a,d){var e=this;d.wrapMode=33071;d.samplingMode=9987;d.flipped=!0;d.preMultiplyAlpha=!0;d.hasMipmap=!0;this.glTexture=new b(a,d,this.canvas);this.frameWorker=this.scheduler.registerTask(c.Task.TEXT_TEXTURE_ATLAS,function(a){return e.run(e.makeRunContext(a))},function(){return e.dirty});return this.glTexture};h.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAdd=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),
this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(4,this.id));this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};h.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};h.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());
this.canvas.setAttribute("height",this.atlas.size.height.toString())};h.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};h.prototype.computeAtlasResolution=function(a,b){a=Math.max(a,b);a=g.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};h.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,b);this.update2DCanvasSize()};h.prototype.resetAtlasCursor=
function(){var a=this.atlas;a.cursor.x=e;a.cursor.y=e+p;a.lineHeight=0;this.needsClear=!0};h.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};h.prototype.getExpectedAtlasUsage=function(){var a=this.elementsToRemove.size,b=this.elementsToAdd.size,c=this.elements.size;return this.getAtlasUsage()/c*(c+b-a)};h.prototype.addAtlasElement=function(a,b,c,d){var e=this.atlas,f=a.textRenderer,g=f.renderedWidth,h=f.renderedHeight,l=
f.displayWidth,f=f.displayHeight;a.placement.offset.x=e.cursor.x;a.placement.offset.y=e.cursor.y;a.placement.size.width=g;a.placement.size.height=h;a.placement.size.displayWidth=l;a.placement.size.displayHeight=f;a.placement.uvMinMax=[a.placement.offset.x/e.size.width,1-(a.placement.offset.y+h)/e.size.height,(a.placement.offset.x+g)/e.size.width,1-a.placement.offset.y/e.size.height];e.cursor.x+=c;e.lineHeight=Math.max(e.lineHeight,d);this.elements.set(b,a)};h.prototype.removeAtlasElement=function(a){if(a&&
this.elements.has(a.textId)){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);this.elements.delete(a.textId)}};h.prototype.ensureStageObjects=function(a){var b=this.stageObjects.get(a);if(b)return b;b=new Set;this.stageObjects.set(a,b);return b};h.prototype.addStageObject=function(a,b){this.ensureStageObjects(a).add(b)};h.prototype.removeStageObject=function(a,b){(a=this.stageObjects.get(a))&&a.delete(b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,
0]),b.geometryVertexAttrsUpdated(0))};h.prototype.processAdditionRequest=function(a,b){var c=this.atlas,d=a.textId,f=a.textRenderer.renderedWidth+e,g=a.textRenderer.renderedHeight+e+p;b=b.repackingEnabled;if(c.cursor.x+f<c.size.width&&c.cursor.y+g<c.size.height)this.addAtlasElement(a,d,f,g),this.elementsToRender.set(d,a),this.elementsToAdd.delete(d);else if(c.cursor.y+g+c.lineHeight<c.size.height)c.cursor.x=e,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,d,f,g),this.elementsToRender.set(d,
a),this.elementsToAdd.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);if(!b||!d&&.95<a&&4096===c.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};h.prototype.processRemovals=function(){var a=this;this.elementsToRemove.forEach(function(b,c){var d=a.stageObjects.get(c);d&&0!==d.size||a.removeAtlasElement(b);d&&0===d.size&&a.stageObjects.delete(c)});this.elementsToRemove.clear()};h.prototype.repack=
function(){var a=this;this.processRemovals();this.elements.forEach(function(b,c){b.rendered=!1;a.elementsToAdd.set(c,b)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};h.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var b=this.stageObjects.get(a.textId);b&&b.forEach(function(b){b.geometries[0].data.vertexAttributes.uv0.data=
new Float32Array(a.placement.uvMinMax);b.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);b.geometryVertexAttrsUpdated(0)});a.rendered=!0};h.prototype.run=function(a){var b=this;if(this.glTexture){var c=a.budget,e=!1;d.everyMap(this.elementsToAdd,function(c,d){return(c=b.elements.get(d))&&c.rendered?((c=b.stageObjects.get(d))&&c.forEach(function(a){var c=a.geometries[0].data.vertexAttributes,e=b.elements.get(d);c.uv0.data=
new Float32Array(e.placement.uvMinMax);c.size.data=new Float32Array([e.placement.size.displayWidth,e.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),b.elementsToAdd.delete(d),!0):1===b.processAdditionRequest(b.elementsToAdd.get(d),a)?(e=!0,!1):!0});if(e)a.budget=null,a.repackingEnabled=!1,this.run(a);else{var f=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);d.everyMap(this.elementsToRender,function(a,
d){b.processRenderingRequest(a);b.elementsToRender.delete(d);f=!0;return c&&(c.madeProgress(),c.done)?!1:!0});f&&this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;this.dirty||(r.test.orderedRepackingEnabled&&this.repackOrdered(),this.notifyChange("updating"))}}};h.prototype.makeRunContext=function(a){void 0===a&&(a=null);q.budget=a;q.repackingEnabled=!0;return q};h.prototype.addTextTexture=function(a,b){var c=a.key;this.elementsToAdd.has(c)||this.elementsToAdd.set(c,{textId:c,
placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(c,b);this.elementsToRemove.delete(c);this.setDirty()};h.prototype.removeTextTexture=function(a,b){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.elementsToAdd.delete(a);this.removeStageObject(a,b)};Object.defineProperty(h.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return this.isDirty},enumerable:!0,configurable:!0});h.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.notifyChange("updating"))};Object.defineProperty(h.prototype,"test",{get:function(){return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:this.resizeAtlas.bind(this)}},enumerable:!0,
configurable:!0});h.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(b,c){return a.push({element:b,key:c})});for(var b=!0,c=0;c<a.length-1;c++)if(0<a[c].key.localeCompare(a[c+1].key)){b=!1;break}if(!b){a.sort(function(a,b){return a.key.localeCompare(b.key)});this.elements.clear();for(b=0;b<a.length;b++)c=a[b],this.elements.set(c.key,c.element);this.repack();this.setDirty()}}};var r;h.test={orderedRepackingEnabled:!1};k([l.property({constructOnly:!0})],
h.prototype,"idHint",void 0);k([l.property({constructOnly:!0})],h.prototype,"view",void 0);k([l.property({type:Boolean,readOnly:!0})],h.prototype,"updating",null);return h=r=k([l.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],h)}(l.declared(h));a.TextTextureAtlas=n;var e=2,p=2,q={budget:null,repackingEnabled:!0};a.default=n})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils ../../../support/index".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){Object.defineProperty(a,"__esModule",{value:!0});var u=l.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");n=function(a){function h(b){b=a.call(this,b)||this;b.tiles=new d;b.tileSize=512;b.idToTile=new Map;b.handles=new g;b.clients=new Set;b._dirty=!1;b._newTiles=new f;return b}m(h,a);Object.defineProperty(h.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))u.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this._setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;
var a=e.create();r.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),this._setDirty())},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"updating",{get:function(){return this._dirty||!!this._pendingTiles},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a._reset()},!0));this.handles.add(c.init(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"],function(){return a._setDirty()}));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(w.Task.FEATURE_TILE_TREE,
function(b){return a._update(b)},function(){return a.updating}))};h.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&(this.handles.destroy(),this.handles=null)};h.prototype.addClient=function(){var a=this,b=v++;this.clients.add(b);1===this.clients.size&&this._setDirty();return{remove:function(){return a._removeClient(b)}}};h.prototype._removeClient=function(a){this.clients.delete(a);this._hasClients||this._clear()};Object.defineProperty(h.prototype,
"_hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});h.prototype._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(w.noBudget))};h.prototype._clear=function(){this.tiles.removeAll();this.idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};h.prototype._update=function(a){this._dirty=!1;this._pendingTiles||(this._startUpdate(a),this._frameWorker&&
(this._frameWorker.task=w.Task.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(a);!this._pendingTiles&&this._frameWorker&&(this._frameWorker.task=w.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};h.prototype._startUpdate=function(a){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new q.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:t})),a=this.cameraOnSurface.location,
this._tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z),this._pendingTiles=this._getRootTiles()):this._clear())};h.prototype._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};h.prototype._getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new p.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};h.prototype._purgeHorizonTiles=function(a){a.sort(function(a,b){a=a.measures.screen.rect;
b=b.measures.screen.rect;return a[1]+a[3]-(b[1]+b[3])});e.empty(y);for(var b=0;b<a.length;b++)if(e.expand(y,a.data[b].measures.screen.rect),e.height(y)>t)return a.data.slice(b,a.length);return[]};h.prototype._subdivideTilesForView=function(a){var b;if(this._pendingTiles){for(;0<this._pendingTiles.length&&!a.done;){var c=this._pendingTiles.pop();a.madeProgress();if(!this.filterExtentRect||e.intersects(this.filterExtentRect,c.extent))this._tileMeasurements.updateTile(c),0!==c.measures.visibility&&(c.measures.shouldSplit?
(this.tilingScheme.ensureMaxLod(c.lij[0]+1),(b=this._pendingTiles).push.apply(b,c.getChildren())):this._newTiles.push(c))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};h.prototype._updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,
a);return!c});c=this.tiles.items.filter(function(a){return a.used?!1:(b.idToTile.delete(a.id),!0)});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};h.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};k([b.property({constructOnly:!0})],h.prototype,"scheduler",void 0);k([b.property({constructOnly:!0})],
h.prototype,"renderCoordsHelper",void 0);k([b.property({constructOnly:!0})],h.prototype,"tilingSchemeOwner",void 0);k([b.property({constructOnly:!0})],h.prototype,"cameraOnSurface",void 0);k([b.property({constructOnly:!0})],h.prototype,"focus",void 0);k([b.property({constructOnly:!0})],h.prototype,"viewState",void 0);k([b.property()],h.prototype,"tiles",void 0);k([b.property()],h.prototype,"tileSize",void 0);k([b.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],h.prototype,"tilingScheme",
null);k([b.property()],h.prototype,"filterExtent",null);k([b.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],h.prototype,"filterExtentRect",null);k([b.property({readOnly:!0,dependsOn:["filterExtentRect"]})],h.prototype,"rootTileIds",null);k([b.property({value:!1})],h.prototype,"suspended",null);k([b.property({readOnly:!0})],h.prototype,"updating",null);return h=k([b.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],h)}(b.declared(h));a.FeatureTileTree3D=n;var v=0,y=e.create(),
t=10;a.default=n})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g,l){void 0===l&&(l=null);this.lij=[0,0,0];this.extent=m.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:m.create()},distance:0,shouldSplit:!1};this.used=!1;l&&this.acquire(a,d,g,l)}a.prototype.acquire=function(h,
d,g,l){this.tilingScheme=l;this.id=a.id(h,d,g);this.lij[0]=h;this.lij[1]=d;this.lij[2]=g;l.getExtent(h,d,g,this.extent);this.resolution=l.resolutionAtLevel(h)};a.prototype.release=function(){this.tilingScheme=null};a.prototype.getChildren=function(h){var d=this.lij[0]+1,g=2*this.lij[1],l=2*this.lij[2];if(!h)return[new a(d,g,l,this.tilingScheme),new a(d,g+1,l,this.tilingScheme),new a(d,g,l+1,this.tilingScheme),new a(d,g+1,l+1,this.tilingScheme)];h[0].acquire(d,g,l,this.tilingScheme);h[1].acquire(d,
g+1,l,this.tilingScheme);h[2].acquire(d,g,l+1,this.tilingScheme);h[3].acquire(d,g+1,l+1,this.tilingScheme);return h};a.prototype.copyMeasurementsFrom=function(a){this.measures.visibility=a.measures.visibility;this.measures.shouldSplit=a.measures.shouldSplit;this.measures.distance=a.measures.distance;m.set(a.measures.screen.rect,this.measures.screen.rect)};a.id=function(a,d,g){return a+"/"+d+"/"+g};return a}();a.FeatureTileDescriptor3D=n;a.default=n})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils ../../webgl-engine/lib/Camera".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.camera=new f.default;this.pointOfInterestInMap=[0,0];this.screenRect=d.create();this.tileSize=a.tileSize;this.maxVerticalScreenSize=a.maxVerticalScreenSize;this.renderCoordsHelper=a.renderCoordsHelper;this.tilingScheme=a.tilingScheme;this.visibility=new g.FeatureTileVisibility3D({renderCoordsHelper:a.renderCoordsHelper})}a.prototype.begin=function(a,b,c){this.camera.copyFrom(a);this.z=c;this.pointOfInterestInMap[0]=
b.x;this.pointOfInterestInMap[1]=b.y;d.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(this.camera,c)};a.prototype.end=function(){this.visibility.end()};a.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};a.prototype.updateDistanceMeasure=function(a){a.measures.distance=d.distance(a.extent,this.pointOfInterestInMap)};a.prototype.updateScreenMeasure=
function(a){var b=e,c=1<<b,f=a.measures.screen.rect;d.empty(f);for(var g=0,h=a.lij[0]+b,l=a.lij[1]<<b,b=a.lij[2]<<b,k=this.tileSizeWithBias(a),k=k*k,p=!1,m=0;m<c;m++){for(var q=0;q<c&&!(p=this.computeScreenArea(a,h,l+m,b+q,f),g+=p.area,p=g>k&&d.height(f)>this.maxVerticalScreenSize);q++);if(p)break}a.measures.shouldSplit=g>k};a.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*p:this.tileSize};a.prototype.computeScreenArea=function(a,e,f,g,h){var k=q.points;this.projectToScreen(e,
f,g,1===a.measures.visibility,k);d.empty(c);for(a=0;4>a;a++)d.expandPointInPlace(c,k[a]);d.expand(h,c);d.intersection(c,this.screenRect,b);q.screenOverlap=d.area(b)/d.area(c);q.area=l.triangle.areaPoints2d(k[0],k[1],k[2])+l.triangle.areaPoints2d(k[0],k[2],k[3]);return q};a.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,r);this.toRenderCoords(r,0,3,u[0]);this.toRenderCoords(r,2,3,u[1]);this.toRenderCoords(r,2,1,u[2]);this.toRenderCoords(r,
0,1,u[3]);d&&(this.projectToPlane(u,this.camera.frustum.planes[4]),this.projectToPlane(u,this.camera.frustum.planes[3]),this.projectToPlane(u,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(u[a],y),this.camera.renderToScreen(y,e[a])};a.prototype.projectToPlane=function(a,b){for(var c=0;4>c;c++)v[c]=l.plane.signedDistance(b,a[c]);c=Math.max(v[0],v[1],v[2],v[3]);if(0<c)for(b=k.vec3.scale(w,b,-c),c=0;4>c;c++)k.vec3.add(a[c],a[c],b)};a.prototype.toRenderCoords=function(a,b,c,
d){w[0]=a[b];w[1]=a[c];w[2]=this.z;this.renderCoordsHelper.toRenderCoords(w,this.tilingScheme.spatialReference,d);return d};return a}();a.FeatureTileMeasurements3D=n;var c=d.create(),b=d.create(),e=2,p=5,q={points:[m.createScreenPointArray(),m.createScreenPointArray(),m.createScreenPointArray(),m.createScreenPointArray()],area:0,screenOverlap:0},r=d.create(),w=h.vec3f64.create(),u=[h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create()],v=[0,0,0,0],y=m.createRenderScreenPointArray3();
a.default=n})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils".split(" "),function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.surfaceElevation=0;this.cache=
new Map;a=a.renderCoordsHelper;this.frustum=new l.Frustum({renderCoordsHelper:a});this.extendedFrustum=new l.Frustum({renderCoordsHelper:a});this.intersector=new f.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}a.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};a.prototype.end=function(){this.cache.clear()};
a.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var c="global"===this.renderCoordsHelper.type&&a.lij[0]>=b&&a.lij[0]<e,d=this.getOrCalculateSingleTileVisibility(a,!c);return 0!==d&&c?this.calculateAggregatedChildrenVisibility(a):d};a.prototype.shortenFrustumFarPlane=function(a){for(var b=a.mutablePoints,c=0,d=l.Frustum.nearFarLineIndices;c<d.length;c++){var e=d[c],f=e[1],e=b[e[0]];h.vec3.subtract(r,b[f],e);h.vec3.scale(r,r,q);h.vec3.add(b[f],e,r)}a.updatePoints(b)};a.prototype.calculateAggregatedChildrenVisibility=
function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=v.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}v.release(c);this.cache.set(a.id,b);return b};a.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);b&&this.cache.set(a.id,c);return c};a.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&
a.lij[0]<p){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};a.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};a.prototype.updateExtendedFrustum=
function(a,b){var d=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var e=this.renderCoordsHelper.worldUpAtPosition(a.eye,r);this.aboveGround||h.vec3.negate(e,e);e=m.acosClamped(-h.vec3.dot(e,a.viewForward));this.allTilesInvisible=e>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=e>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;for(e=0;4>e;e++){var f=a.pointIndices[e],g=b[f],l=d.getAltitude(g);
if(a.needsAltitudeAdjustment(l)){this.renderCoordsHelper.worldUpAtPosition(g,r);switch(f){case 4:case 7:case 0:case 3:c.plane.projectVector(this.extendedFrustum.planes[0],r,r);break;case 5:case 6:case 1:case 2:c.plane.projectVector(this.extendedFrustum.planes[1],r,r)}h.vec3.scale(r,r,a.direction);this.renderCoordsHelper.intersectInfiniteManifold(c.ray.wrap(g,r),a.zWithMargin,g)}}this.extendedFrustum.updatePoints(b);c.plane.fromPoints(b[0],b[1],b[2],w);c.plane.fromPoints(b[1],b[2],b[3],u);0>h.vec3.dot(w,
u)&&(d=this.extendedFrustum.mutablePoints,this.aboveGround?(a=[d[1],d[0]],d[0]=a[0],d[1]=a[1]):(a=[d[2],d[3]],d[3]=a[0],d[2]=a[1]),this.extendedFrustum.updatePoints(d))}};a.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};a.prototype.extendedFrustumParametersAboveSurface=function(a,b){var c=a-b;return{zWithMargin:c,pointIndices:l.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:function(a){return a>
c}}};a.prototype.extendedFrustumParametersBelowSurface=function(a,b){var c=a+b;return{zWithMargin:c,pointIndices:l.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<c}}};return a}();a.FeatureTileVisibility3D=n;var b=2,e=6,p=12,q=.95,r=d.vec3f64.create(),w=c.plane.create(),u=c.plane.create(),v=new k(Array,function(a){4!==a.length&&(a[0]=new g.FeatureTileDescriptor3D,a[1]=new g.FeatureTileDescriptor3D,a[2]=new g.FeatureTileDescriptor3D,a[3]=new g.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});a.default=n})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.frustum=d.create();this.lines=Array(12);this.origin=k.vec3f64.create();this.direction=k.vec3f64.create();
this._altitude=null;this.renderCoordsHelper=a?a.renderCoordsHelper:null;for(a=0;12>a;a++)this.lines[a]={origin:null,direction:k.vec3f64.create(),endpoint:null}}Object.defineProperty(a.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,
configurable:!0});a.prototype.update=function(a){d.fromMatrix(a.viewMatrix,a.projectionMatrix,this.frustum);m.vec3.copy(this.origin,a.eye);m.vec3.copy(this.direction,a.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};a.prototype.updatePoints=function(a){for(var f=0;f<this.frustum.points.length;f++)m.vec3.copy(this.frustum.points[f],a[f]);d.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(a.prototype,"altitude",{get:function(){return this._altitude},
enumerable:!0,configurable:!0});a.prototype.intersectsSphere=function(a){return d.intersectsSphere(this.frustum.planes,a)};a.prototype.intersectsRay=function(a){return d.intersectsRay(this.frustum.planes,a)};a.prototype.intersectsLineSegment=function(a,f){return d.intersectsLineSegment(this.frustum.planes,a,f)};a.prototype.intersectsPoint=function(a){return d.intersectsPoint(this.frustum.planes,a)};a.prototype.updateLines=function(){for(var a=this.frustum.points,d=0;4>d;d++){var c=d,b=d+4;this.updateLine(this.lines[d],
a[c],a[b]);this.updateLine(this.lines[d+4],a[c],3===d?a[0]:a[c+1]);this.updateLine(this.lines[d+8],a[b],3===d?a[4]:a[b+1])}};a.prototype.updateLine=function(a,d,c){a.origin=d;a.endpoint=c;h.directionFromTo(a.direction,d,c)};a.planePointIndices=d.planePointIndices;a.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return a}();a.Frustum=n;a.default=n})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){Object.defineProperty(a,"__esModule",{value:!0});n=.5*Math.PI;var w=n/Math.PI*180,u=n*b.earthRadius,v=.9*b.earthRadius;b=function(){function a(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:l.vec3f64.create(),direction:l.vec3f64.create()};for(a=0;4>a;a++)this.extent[a]={origin:l.vec3f64.create(),direction:l.vec3f64.create(),cap:{next:null,direction:l.vec3f64.create()}},this.planes[a]=
e.plane.create();this.planes[4]=e.plane.create();this.planes[5]=e.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}a.prototype.update=function(a,b,c,d){void 0===d&&(d=!0);var f=this.extent;this.toRenderBoundingExtent(a,b,c);g.vec3.add(this.center.origin,f[0].origin,f[2].origin);g.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);d||g.vec3.scale(this.center.direction,this.center.direction,-1);for(c=0;4>
c;c++){var h=f[c];this.renderCoordsHelper.worldUpAtPosition(h.origin,h.direction);var l=f[3===c?0:c+1];h.cap.next=l.origin;q.directionFromTo(h.cap.direction,h.origin,l.origin);e.plane.fromVectorsAndPoint(h.direction,h.cap.direction,h.origin,this.planes[c]);d||g.vec3.scale(h.direction,h.direction,-1)}e.plane.fromVectorsAndPoint(f[0].cap.direction,f[1].cap.direction,f[0].origin,this.planes[4]);d?e.plane.negate(this.planes[4],this.planes[5]):(e.plane.copy(this.planes[4],this.planes[5]),e.plane.negate(this.planes[4],
this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b};a.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if(null==a)return!1;if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?w:u))return!0;if(a.altitude>=v)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan){var c=this.extent[0];return!b&&a.intersectsRay(e.ray.wrap(c.origin,c.direction))?!0:!1}for(var d=0;d<this.extent.length;d++)if(c=
this.extent[d],!b&&a.intersectsRay(e.ray.wrap(c.origin,c.direction))||a.intersectsLineSegment(e.lineSegment.fromPoints(c.origin,c.cap.next,E),c.cap.direction))return!0;b=b?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(c=a.lines[d],p.frustumLineSegment(b,c.origin,c.endpoint,c.direction))return!0;return!1};a.prototype.toRenderBoundingExtentGlobal=function(a,b,d){c.center(a,t);t[2]=d;r.computeLinearTransformation(b,t,x,this.renderCoordsHelper.spatialReference);h.mat4.invert(z,x);
f.empty(A);for(var e=0,l=y;e<l.length;e++)for(var p=l[e],m=p.x0,q=p.x1,u=p.y0,p=p.y1,n=0;5>n;n++){var w=n/4;t[0]=k.lerp(a[m],a[q],w);t[1]=k.lerp(a[u],a[p],w);t[2]=d;r.vectorToVector(t,b,t,this.renderCoordsHelper.spatialReference);g.vec3.transformMat4(t,t,z);f.expandPointInPlace(A,t)}g.vec3.set(this.extent[0].origin,A[0],A[1],A[2]);g.vec3.set(this.extent[1].origin,A[3],A[1],A[2]);g.vec3.set(this.extent[2].origin,A[3],A[4],A[2]);g.vec3.set(this.extent[3].origin,A[0],A[4],A[2]);for(n=0;4>n;++n)g.vec3.transformMat4(this.extent[n].origin,
this.extent[n].origin,x)};a.prototype.toRenderBoundingExtentLocal=function(a,b,c){g.vec3.set(this.extent[0].origin,a[0],a[1],c);g.vec3.set(this.extent[1].origin,a[2],a[1],c);g.vec3.set(this.extent[2].origin,a[2],a[3],c);g.vec3.set(this.extent[3].origin,a[0],a[3],c)};a.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c);break;default:m.neverReached(this.renderCoordsHelper.type)}};
a.prototype.isVisibleInFrustumGlobal=function(a){if(0>g.vec3.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>g.vec3.dot(this.extent[b].direction,a.direction))return!0;return!1};return a}();a.FrustumExtentIntersection=b;var y=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],t=l.vec3f64.create(),x=d.mat4f64.create(),z=d.mat4f64.create(),A=f.create(),E=e.lineSegment.create();a.default=b})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.isMemoryManagedLayerView=function(a){return"function"===typeof a.getUsedMemory}})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Evented ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function h(b){b=a.call(this,b)||this;b.propertiesPool=new q.default({camera:r.default},b);b.lastSeenCameraProjectionValues=new r.default;b.events=new d;b.updateQueue=[];b.processingUpdates=!1;return b}m(h,a);h.prototype.destroy=function(){this.cameraController=null;this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};h.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new c.default({mode:a.viewingMode})}};Object.defineProperty(h.prototype,"animation",{get:function(){return this.cameraController instanceof b.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==w&&w.copyFrom(a);w.markViewDirty();w.computeUp(this.mode);u.camera=w;this.events.emit("before-camera-change",
u);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,w)&&(this.lastSeenCameraProjectionValues.copyFrom(w),v.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",v));a&&a.equals(w)||this._set("camera",this.propertiesPool.get("camera").copyFrom(w))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isLocal",
{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===e.State.Finished||c===e.State.Stopped)b._set("cameraController",
null),b.updateCamera(function(b){return a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=e.State.Rejected)},enumerable:!0,configurable:!0});h.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==e.State.Rejected};h.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};h.prototype.cameraChanged=function(){this.updateCamera(function(){})};
h.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};h.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();w.copyFrom(this._get("camera"));a(w);this.camera=w;this.processingUpdates=!1;this.processUpdateQueue()}};h.prototype.createInitialCamera=function(a){return"global"===a?new r.default(l.vec3f64.fromValues(4*p.earthRadius,0,0),l.vec3f64.fromValues(p.earthRadius,
0,0),l.vec3f64.fromValues(0,0,1)):new r.default(l.vec3f64.fromValues(0,0,100),l.vec3f64.fromValues(0,0,0),l.vec3f64.fromValues(0,1,0))};h.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};k([g.property({readOnly:!0,
type:f,dependsOn:["cameraController"]})],h.prototype,"animation",null);k([g.property({type:r.default})],h.prototype,"camera",null);k([g.property({constructOnly:!0})],h.prototype,"constraints",void 0);k([g.property({readOnly:!0})],h.prototype,"events",void 0);k([g.property({readOnly:!0,dependsOn:["isLocal"]})],h.prototype,"isGlobal",null);k([g.property({readOnly:!0,dependsOn:["mode"]})],h.prototype,"isLocal",null);k([g.property({constructOnly:!0})],h.prototype,"mode",void 0);k([g.property({constructOnly:!0})],
h.prototype,"spatialReference",void 0);k([g.property({readOnly:!0,dependsOn:["cameraController"]})],h.prototype,"interacting",null);k([g.property()],h.prototype,"cameraController",null);return h=k([g.subclass("esri.views.3d.state.ViewState")],h)}(g.declared(h));a.ViewState=n;var w=new r.default,u={camera:null},v={camera:null};a.default=n})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(n,
a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,g){var d=this;this.owner=g;this.properties={};this.afterDispatchHandle=null;for(var f in a)g=new m.ReentrantObjectPool(a[f],null,null,2,2),this.properties[f]={pool:g,acquired:[]};this.afterDispatchHandle=k.afterDispatch(function(){return d.release()})}a.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(var a in this.properties){for(var g=this.properties[a],
h=0,f=g.acquired;h<f.length;h++){var c=f[h];k.isValueInUse(c)||g.pool.release(c)}g.pool.destroy();g.pool=null;g.acquired=null}this.owner=this.properties=null};a.prototype.get=function(a){var d=this.owner._get(a);a=this.properties[a];var h=a.pool.acquire();for(a.acquired.push(h);h===d;)a.acquired.push(h),h=a.pool.acquire();return h};a.prototype.release=function(){for(var a in this.properties){for(var g=this.properties[a],h=0,f=0,c=g.acquired;f<c.length;f++){var b=c[f];k.isValueInUse(b)?g.acquired[h++]=
b:g.pool.release(b)}g.acquired.length=h}};return a}();a.PropertiesPool=n;a.default=n})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L,R){Object.defineProperty(a,"__esModule",{value:!0});var O=p.getLogger("esri.views.3d.state.ViewStateManager");n=function(a){function c(b){b=a.call(this)||this;b.propertiesPool=new J.default({frustum:K.default},b);b.handles=new e;b.cameraSetByUser=!1;b.internalSetOrder=[];b.immediateGoToController=null;b.animatedGoToController=null;b.ready=!1;b.updateDevicePixelRatio=null;return b}k(c,a);Object.defineProperty(c.prototype,
"camera",{get:function(){return this.ready?I.internalToExternal(this.view,this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(I.externalToInternal(this.view,a),{applyConstraints:!1})||O.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",
a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():O.error("#center\x3d","Invalid center",a):O.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):O.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"extent",
{get:function(){return this.ready?I.toExtent(this.view,null,null,null,V):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||O.error("#extent\x3d","Invalid extent",a):O.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):O.error("#extent\x3d","Extent may not be null or undefined"))},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");
var a=this.view.pointsOfInterest.centerOnContent;return I.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||O.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera,b=a.padding,c=a.pixelRatio,a=this._get("padding"),d=b[0]/
c,e=b[1]/c,f=b[2]/c,b=b[3]/c;return null!=a&&a.top===d&&a.right===e&&a.bottom===f&&a.left===b?a:{top:d,right:e,bottom:f,left:b}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,Q),this.view.state.updateCamera(function(a){return a.padding=Q}))},enumerable:!0,configurable:!0});c.prototype.paddingToArray=function(a,b,c){a?t.vec4.set(c,a.top||0,a.right||0,a.bottom||0,a.left||0):t.vec4.set(c,0,0,0,0);for(a=0;4>a;a++)c[a]=Math.round(c[a]*
b)};Object.defineProperty(c.prototype,"screenCenter",{get:function(){var a=this.padding;return u.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"viewpoint",{get:function(){return this.ready?M.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),
{applyConstraints:!a.camera})||O.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;O.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else O.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"zoom",{get:function(){return this.ready?I.scaleToZoom(this.view,
this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||O.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),v.on(this.view,"state.events","before-camera-change",function(b){return a.updateElevation(b.camera)})]);v.once(this.view,"state.camera",
function(b){return a.updateElevation(b)},!0);this.handles.add(w.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(Z);a.cancelImmediateGoTo()}));this.handles.add(v.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};c.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),
this.propertiesPool=null)};c.prototype.init=function(){var a=this;this.constraintsManager=new F.default({view:this.view});this.prepareFrame();var b=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(v.whenOnce(this.view.basemapTerrain,
"ready",function(){a.handles.remove(Z);a.setInitialView(a.view.groundExtent)}),Z))};c.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(Z),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};c.prototype.goTo=function(a,b){return g(this,void 0,
void 0,function(){var c;return d(this,function(d){c=m({animate:!0},b);return c.animate?[2,this.goToAnimated(a,c)]:[2,this.goToImmediate(a,c)]})})};c.prototype.debugSetCameraOnContent=function(){this.setStateCamera(G.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};c.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};c.prototype.cancelImmediateGoTo=
function(){var a=this.immediateGoToController;q.isSome(a)&&(this.immediateGoToController=null,a.abort())};c.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToController;q.isSome(a)&&(this.animatedGoToController=null,a.abort())};c.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=[],d=0,e=U;d<e.length;d++){var f=e[d],g=f.propertyName,f=f.overrides,h=b.has(g),l=this._isOverridden(g);!h&&l&&c.push({name:g,value:this._get(g)});this._clearOverride(g);(h||l)&&f.forEach(function(a){return b.add(a)})}return c.sort(function(b,
c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};c.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof l)this.setStateCamera(I.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof f)if(a.targetGeometry instanceof z){var b=I.fromExtent(this.view,a.targetGeometry,0,.5,I.OrientationMode.LOCKED);this.setStateCamera(I.externalToInternal(this.view,b),{applyConstraints:!0})}else b={applyConstraints:!a.camera},
a=this.viewpointToCamera(a),this.setStateCamera(a,b);else b=I.fromExtent(this.view,a,0,.5,I.OrientationMode.LOCKED),this.setStateCamera(I.externalToInternal(this.view,b),{applyConstraints:!0})};c.prototype.updatePropertyBeforeReady=function(a,b){if(!this.ready){this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==T.indexOf(a)&&this._override("hasInitialView",!0));return!0}return!1};c.prototype.isCompatible=
function(a){return a?a instanceof f?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof l?this.isCompatible(a.position):a.spatialReference&&E.canProject(a.spatialReference,this.view.spatialReference):!1};c.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=P);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};c.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===c&&(c=W);var d=this.getPreservingHeadingTilt();
return(a=I.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,I.OrientationMode.ADJUST))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};c.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.update();return this.centerPointAtDistanceToCamera(a,b.distance)};c.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=I.fromExtent(this.view,a,b.heading,b.tilt,I.OrientationMode.ADJUST,V);return I.externalToInternal(this.view,
a)};c.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.update();var c=b.renderLocation;a=I.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,a)};c.prototype.zoomToCamera=function(a){return this.scaleToCamera(I.zoomToScale(this.view,a))};c.prototype.viewpointToCamera=function(a){return(a=M.toCamera(this.view,a))?I.externalToInternal(this.view,a):null};c.prototype.setStateCamera=function(a,b){var c=
this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);b.applyConstraints&&B.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=new N.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};c.prototype.prepareFrame=function(){var a=this.view,b=a.container,c=a.canvas;if(b&&c){q.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();
var a=this.view.pixelRatio,d=Math.round(b.clientWidth*a),b=Math.round(b.clientHeight*a);0!==d&&0!==b&&(c.width=d,c.height=b,this.view.state&&(c=this.view.state.camera,c.fullWidth!==d||c.fullHeight!==b||c.pixelRatio!==a))&&(W.copyFrom(c),W.pixelRatio!==a&&(this.paddingToArray(this.padding,a,Q),W.padding=Q),W.fullWidth=d,W.fullHeight=b,W.pixelRatio=a,this.view.state.camera=W)}};c.prototype.updateElevation=function(a){var b=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,c=this.view.renderCoordsHelper.getAltitude(a.eye),
b=b?G.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};c.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};c.prototype.createGoToCamera=function(a,c){return g(this,void 0,void 0,function(){var e,g,h,k,p,m,q,u;return d(this,function(d){switch(d.label){case 0:return[4,v.whenOnce(this,"ready",c.signal,!0)];case 1:return d.sent(),r.throwIfAborted(c),[4,M.create(this.view,a,c.signal)];case 2:e=d.sent();g=!!(a instanceof f&&a.camera||a instanceof
l);h=e.camera;if(!this.isCompatible(h))throw m=(p=(k=h.position)&&k.spatialReference)?p.wkid:"none",q=this.view.spatialReference.wkid,new b("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+m+", view: "+q+")",{camera:h});u=I.externalToInternal(this.view,h);if(!u)throw new b("goto:invalid-camera","Resulting camera is invalid");return[2,{viewpoint:e,camera:u,isFullySpecified:g}]}})})};c.prototype.cancellableGoTo=function(a,b){var c=this,d,e=function(){c.view.state.cameraController===
a&&a.active&&a.asyncResult===d&&a.stopController()};return r.create(function(c,f){d={resolve:c,reject:f};a.asyncResult=d;r.onAbort(b,e)},e)};c.prototype.goToImmediate=function(a,c){return g(this,void 0,void 0,function(){var e,f,g,h=this;return d(this,function(d){this.cancelAnimatedGoTo();this.cancelImmediateGoTo();e=r.createAbortController();r.onAbort(c,function(){return e.abort()});f=this.createGoToCamera(a,m({},c,{signal:e.signal}));g=function(){h.immediateGoToController===e&&(h.immediateGoToController=
null)};this.immediateGoToController=e;return[2,f.then(function(a){g();h.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){g();!r.isAbortError(a)&&a instanceof b&&a.message&&O.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;})]})})};c.prototype.goToAnimatedBeforeReady=function(a,b){return g(this,void 0,void 0,function(){var c;return d(this,function(d){switch(d.label){case 0:return this.cancelAnimatedGoTo(),
c=r.createAbortController(),r.onAbort(b,function(){return c.abort()}),this.animatedGoToController=c,b=m({},b,{signal:c.signal}),[4,v.whenOnce(this.view,"ready",c.signal)];case 1:return d.sent(),this.animatedGoToController=null,[2,this.goToAnimated(a,b)]}})})};c.prototype.goToAnimated=function(a,c){return g(this,void 0,void 0,function(){var e,f,h,l,k,p,m=this;return d(this,function(q){this.cancelAnimatedGoTo();if(!this.ready)return[2,this.goToAnimatedBeforeReady(a,c)];e=this.view.state.cameraController;
e instanceof H.PointToPointAnimationController&&(e.updateStateFromViewAnimation(),e.active&&(f=e));null==f&&(f=new H.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper));h=f.viewAnimation;l=this.createGoToCamera(a,c);h.update(l.then(function(a){return a.viewpoint}));if(f!==e&&!this.view.state.switchCameraController(f))return h.stop(),O.error("#goTo()","Cannot start an animation while interacting"),[2,r.reject(new b("view:goto-cannot-interrupt","Cannot start an animation while interacting"))];
k=h.target;p=function(){return m.view.state.cameraController===f&&f.viewAnimation.target===k&&f.active};l.then(function(a){var b=a.viewpoint,e=a.camera,l=a.isFullySpecified;return g(m,void 0,void 0,function(){var a,g;return d(this,function(d){switch(d.label){case 0:if(!p())return[2];f.viewAnimation.update(b);k=f.viewAnimation.target;l?(a=new N.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:e}),B.applySurfaceCollision(this.view,e,1)):B.applyAll(this.view,e);f.begin(e,this.internalAnimateOptions(c));
return[4,h.when()];case 1:return d.sent(),g=this.view.state.cameraController,a&&(g&&g.active?g instanceof H.PointToPointAnimationController&&g.viewAnimation.target===k&&(this.view.state.cameraController=a):f.viewAnimation.target===k&&(this.view.state.cameraController=a)),[2]}})})}).catch(function(a){!r.isAbortError(a)&&a instanceof b&&a.message&&O.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(p())throw m.view.state.cameraController.stopController(),
a;});return[2,this.cancellableGoTo(f,c)]})})};c.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?R.named[a.easing]:a.easing));return b};h([y.property({type:l,dependsOn:["view.state.camera","ready"]})],c.prototype,"camera",null);h([y.property({type:A,dependsOn:["view.pointsOfInterest.centerOnContent.location",
"ready"]})],c.prototype,"center",null);h([y.property({type:z,dependsOn:["view.state.camera","ready"]})],c.prototype,"extent",null);h([y.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],c.prototype,"frustum",null);h([y.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],c.prototype,"hasInitialView",null);h([y.property({readOnly:!0,type:Boolean})],c.prototype,"ready",void 0);h([y.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],
type:Number})],c.prototype,"scale",null);h([y.property({dependsOn:["view.state.camera","ready"]})],c.prototype,"padding",null);h([y.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],c.prototype,"screenCenter",null);h([y.property({constructOnly:!0})],c.prototype,"view",void 0);h([y.property({type:f,dependsOn:["camera","ready"]})],c.prototype,"viewpoint",null);h([y.property({type:Number,dependsOn:["scale"]})],c.prototype,"zoom",null);h([y.property({constructOnly:!0})],c.prototype,
"updateDevicePixelRatio",void 0);return c=h([y.subclass("esri.views.3d.state.ViewStateManager")],c)}(y.declared(c));a.ViewStateManager=n;var T="camera viewpoint extent scale center zoom".split(" "),U=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],
P={heading:0,tilt:0},V=new l,W=new L.default,Q=x.vec4f64.create(),Z="pending-initial-view";a.default=n})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function h(b){var c=a.call(this)||this;c.handles=new d;c.nearFarHeuristic=e.createNearFarHeuristic(b.view.state.mode,b.view.basemapTerrain,b.view.renderCoordsHelper.spatialReference);return c}m(h,a);h.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(l.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new p.default({view:this.view}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};h.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};h.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};h.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};h.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};h.prototype.cameraUpdateNearFarAuto=function(a,c){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,b.surfaceElevationBelowEye(this.view,a),a);c&&c.autoUpdate(a.near,a.far)};h.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};h.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};h.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};h.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};h.prototype.handleTiltModeChanged=function(){this.updateTilt()};h.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};h.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};h.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(g.deg2rad(a.max))};h.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};h.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(g.rad2deg(b)))}};h.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};h.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(d){return c.applyAll(b.view,d,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};k([f.property({constructOnly:!0})],h.prototype,"view",void 0);k([f.property({readOnly:!0})],h.prototype,"surfaceCollisionConstraint",void 0);return h=k([f.subclass("esri.views.3d.state.ConstraintsManager")],
h)}(f.declared(h));a.ConstraintsManager=n;a.default=n})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/mathUtils ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils".split(" "),function(n,a,m,k,h,d,g,l){function f(a,b,c,d){c=p/c;a/b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(a,"__esModule",{value:!0});a.createNearFarHeuristic=
function(a,d,e){return"global"===a?new b:new c(d,e)};var c=function(){function a(a,b){this.elevationProvider=a;this.unitInMeters=h.getMetersPerUnitForSR(b)}a.prototype.compute=function(a,b,c,g,h){h||(h={near:0,far:0});var p=l.earthRadius,n=a[2]*this.unitInMeters,t=n;g=n-g;var v=this.elevationProvider?this.elevationProvider.elevationBounds:null;v&&(n=0<=g?t-this.unitInMeters*v.min:this.unitInMeters*v.max-t);t=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,4*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));d.vec3.subtract(u,
b,a);w[0]=0<u[0]?c.xmax:c.xmin;w[1]=0<u[1]?c.ymax:c.ymin;w[2]=0<u[2]?t/2:-t/2;d.vec3.subtract(w,w,a);d.vec3.normalize(u,u);a=1.1*d.vec3.dot(w,u)*this.unitInMeters;p=Math.sqrt(n*(n+2*p));c=Math.max(c.xmax-c.xmin,c.ymax-c.ymin);b=c*r*this.unitInMeters;n=m.clamp((n-b)/(c*q*this.unitInMeters-b),0,1);n=k.lerp(p,a,n*n*n);n*=Math.max(Math.log(Math.abs(g)),1);n=Math.min(n,Math.max(34064E4,t));n/=this.unitInMeters;return f(n,e,this.unitInMeters,h)};return a}(),b=function(){function a(){}a.prototype.compute=
function(a,b,c,e,g){g||(g={near:0,far:0});b=l.earthRadius;a=d.vec3.length(a)-b;a=Math.max(Math.abs(a-e),Math.abs(a));e=Math.sqrt(a*(a+2*(b+Math.min(0,e))));a=m.clamp(2E4-(Math.log(a)-7.983)/9.011*19E3,1E3,2E4);return f(1.2*e,a,1,g)};return a}(),e=2E4,p=2,q=.001,r=1E-4,w=g.vec3f64.create(),u=g.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(b){b=a.call(this)||this;b.handles=new d;return b}m(b,a);b.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.handleElevationChangeEvent=function(a){this.view.state.cameraController||f.eyeWithinExtent(this.view,
this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};b.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){l.applySurfaceCollision(a.view,b,1)})};k([g.property({constructOnly:!0})],b.prototype,"view",void 0);return b=k([g.subclass("esri.views.3d.state.ElevationCollisionConstraint")],b)}(g.declared(h));a.SurfaceCollisionConstraint=n;a.default=n})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function f(c){var b=a.call(this)||this;b.handles=new k;b.view=c.view;b.desiredCamera=c.desiredCamera.clone();return b}m(f,a);Object.defineProperty(f.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});f.prototype.onControllerStart=function(c){var b=
this;a.prototype.onControllerStart.call(this,c);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return b.handleElevationChangeEvent(a)}));this.applyCorrection()};f.prototype.onControllerEnd=function(c){this.handles.removeAll();this.view=null;a.prototype.onControllerEnd.call(this,c)};f.prototype.handleElevationChangeEvent=function(a){d.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};f.prototype.applyCorrection=function(){var a=
this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);h.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=g.State.Stopped)})};return f}(g.CameraController);a.SurfaceCollisionCorrectionController=n})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G){function F(a){return 360-B.cyclicalDeg.normalize(a)}function K(a){return B.cyclicalDeg.normalize(360-a)}function H(a,b){a&&a.resolver&&(null==b?a.resolver.reject():a.resolver.resolve(b));return b}function N(a,b,c,e){if(!b)return H(e);var f=a.spatialReference||d.SpatialReference.WGS84;if(b.camera){a=b.get("camera.position.spatialReference");if(!x.canProject(a,f))return H(e);b=b.camera.clone();a.equals(f)||(b.position=x.project(b.position,
f));return H(e,b)}var g=b.get("targetGeometry.spatialReference");if(g&&!x.canProject(g,f))return H(e);f=A.internalToExternal(a,a.state.camera);g=A.OrientationMode.ADJUST;null!=b.rotation&&(f.heading=F(b.rotation),g=A.OrientationMode.LOCKED);null!=c&&(f.tilt=c);if("point"===b.targetGeometry.type){c=b.targetGeometry;var h=void 0,l=b.targetGeometry.clone(),h=null!=b.scale?A.scaleToDistance(a,b.scale,c.latitude):a.state.camera.distance;return A.fromCenterDistance(a,l,h,f,g,e)}return A.fromExtent(a,b.targetGeometry.extent,
f.heading,f.tilt,g,e)}function I(a,b){return null==b.scale&&null!=b.zoom?A.zoomToScale(a,b.zoom):b.scale}function J(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=F(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function M(a,b,c){var e=a.spatialReference||d.SpatialReference.WGS84;b=b||A.externalToInternal(a,c.camera);c.targetGeometry=G.vectorToPoint(b.center,a.renderSpatialReference,e);c.scale=A.computeScale(a,b);c.rotation=
K(c.camera.heading);return c}function L(a,d,e){if(d){if(!x.canProject(d.spatialReference,a.spatialReference))throw new b("viewpointutils:incompatible-spatialreference","Spatial reference ("+(d.spatialReference?d.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:d});var f=[];if(!d.hasZ&&a.basemapTerrain){var g=void 0;switch(d.type){case "point":g=d;break;case "multipoint":case "polyline":case "mesh":g=d.extent.center;break;case "extent":g=d.center;
break;case "polygon":g=d.centroid;break;default:c.neverReached(d)}g&&x.canProject(g,a.basemapTerrain.spatialReference)?X[2]=a.basemapTerrain.getElevation(g)||0:X[2]=0}(0,ra[d.type])(d,function(a){f.push(a[0],a[1],a[2])},X);var h=f.length/3;if(0!==h&&(g=Array(f.length),G.bufferToBuffer(f,d.spatialReference,0,g,a.spatialReference,0,h)))for(d.hasZ&&(e.hasZ=!0),a=0;a<g.length;a+=3)d.hasZ?(X[0]=g[a+0],X[1]=g[a+1],X[2]=g[a+2]):(X[0]=g[a+0],X[1]=g[a+1]),y.expand(e.boundingBox,X)}}function R(a,b,c,d){return k(this,
void 0,void 0,function(){var g,h,l,k,p,q;return m(this,function(m){switch(m.label){case 0:return[4,f.result(a.whenViewForGraphic(b))];case 1:g=m.sent();if(!1===g.ok||e.isNone(g.value)||!("whenGraphicBounds"in g.value))return L(a,b.geometry,d),[2];h=g.value;return[4,f.result(h.whenGraphicBounds(b,{minDemResolution:c}))];case 2:l=m.sent();if(!1===l.ok)return L(a,b.geometry,d),[2];k=l.value;p=k.screenSpaceObjects;q=k.boundingBox;y.expand(d.boundingBox,q);p&&p.forEach(function(a){d.screenSpaceObjects.push(a)});
isFinite(q[2])&&(d.hasZ=!0);return[2]}})})}function O(a,b,c,e){return k(this,void 0,void 0,function(){var f,h;return m(this,function(l){switch(l.label){case 0:return Array.isArray(b)&&2===b.length&&(f=b[0],h=b[1],"number"===typeof f&&"number"===typeof h)?(la.x=f,la.y=h,la.z=void 0,la.spatialReference=a.spatialReference.isGeographic?a.spatialReference:d.SpatialReference.WGS84,L(a,la,e),[2]):b&&"function"===typeof b.map?[4,p.eachAlways(b.map(function(b){return O(a,b,c,e)}))]:[3,2];case 1:return l.sent(),
[2];case 2:if(!(b instanceof d.BaseGeometry))return[3,3];L(a,b,e);return[3,5];case 3:return b instanceof g?[4,R(a,b,c,e)]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2]}})})}function T(a,b,c,d,e){return k(this,void 0,void 0,function(){var f,g,h;return m(this,function(l){switch(l.label){case 0:if(b.camera)return[2,U(a,c,b.camera,e)];e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=c.heading?e.rotation=K(c.heading):null!=c.rotation&&
(e.rotation=c.rotation);f=I(a,c);null!=f&&(e.scale=f);g=A.createAsyncContext(d);N(a,e,c.tilt,g);h=e;return[4,g.resolver.promise];case 1:return h.camera=l.sent(),[2,e]}})})}function U(a,b,c,d){d.camera=c.clone();d.camera.fov=a.camera.fov;b=a.spatialReference;c=d.camera.position.spatialReference;if(!x.canProject(c,b))return null;c.equals(b)||(d.camera.position=x.project(d.camera.position,b));return M(a,null,d)}function P(a,c,e,f,g){return k(this,void 0,void 0,function(){var h,l,k,p,q,r;return m(this,
function(m){switch(m.label){case 0:if(!e)throw new b("createfromcenter","invalid point");g.targetGeometry=e.clone();h=z.cameraOnContentAlongViewDirection(a);if(c.position){m=g.targetGeometry;var n=h,w=a.renderSpatialReference;G.pointToVector(c.position,ba,w);G.pointToVector(m,oa,w);g.targetGeometry=new d.Point(m);g.camera.position=new d.Point(c.position);u.vec3.subtract(ia,oa,ba);A.directionToHeadingTilt(a,ba,ia,n.up,g.camera);g.scale=A.distanceToScale(a,u.vec3.distance(ba,oa),g.targetGeometry.latitude);
g.rotation=K(g.camera.heading);return[2,g]}c.zoomFactor&&(l=h.distance/c.zoomFactor,k=u.vec3.scale(X,h.viewForward,-l),u.vec3.add(h.eye,h.center,k),h.markViewDirty(),g.scale=A.distanceToScale(a,l,e.latitude));A.internalToExternal(a,h,g.camera);p=J(g.camera,c)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;if(c.zoomFactor)return[3,2];g.scale=I(a,c);null==g.scale&&(G.pointToVector(e,X,a.renderSpatialReference),E.frustum.intersectsPoint(h.frustum.planes,X)?g.scale=A.distanceToScale(a,u.vec3.distance(h.eye,
X),e.latitude):g.scale=A.computeScale(a,h));q=A.createAsyncContext(f);A.fromCenterScale(a,g.targetGeometry,g.scale,g.camera,p,q);r=g;return[4,q.resolver.promise];case 1:r.camera=m.sent(),m.label=2;case 2:return[2,g]}})})}function V(a,b,c,d){return k(this,void 0,void 0,function(){var e,f;return m(this,function(g){e=z.cameraOnContentAlongViewDirection(a);f=G.vectorToPoint(e.center,a.renderSpatialReference,la,a.spatialReference);return[2,P(a,b,f,c,d)]})})}function W(a,b,c,d,e){return k(this,void 0,void 0,
function(){var f,g,h,l;return m(this,function(k){switch(k.label){case 0:return e.targetGeometry=c.clone(),f=z.cameraOnContentAlongViewDirection(a),A.internalToExternal(a,f,e.camera),g=J(e.camera,b)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST,h=A.createAsyncContext(d),A.fromExtent(a,c,e.camera.heading,e.camera.tilt,g,h),l=e,[4,h.resolver.promise];case 1:return l.camera=k.sent(),[2,e]}})})}function Q(a,b,c,d,e,f,g){return k(this,void 0,void 0,function(){var h,l,k,p,r;return m(this,function(m){switch(m.label){case 0:g.targetGeometry=
c.clone();m=h=z.cameraOnContentAlongViewDirection(a);var n=0;c.hasZ?n=c.z:a.basemapTerrain&&(n=a.basemapTerrain.getElevation(c));u.vec3.set(X,c.x,c.y,n);G.computeLinearTransformation(a.spatialReference,X,aa,a.renderSpatialReference);q.mat3.fromMat4(da,aa);q.mat3.transpose(da,da);y.empty(ga);for(var w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t=0;t<w.length;t++){var v=w[t],x=d[v[2]];isFinite(x)||(x=n);u.vec3.set(X,d[v[0]],d[v[1]],x);G.vectorToVector(X,a.spatialReference,X,a.renderSpatialReference);
y.expand(ga,u.vec3.transformMat3(X,X,da))}n=y.width(ga);w=y.height(ga);t=y.depth(ga);v=1/Math.tan(m.fovY/2);l=Math.max(.5*Math.sqrt(n*n+t*t)*Math.max(v,1/Math.tan(m.fovX/2))+.5*w,.5*w*v+.5*Math.max(n,t))/e;A.internalToExternal(a,h,g.camera);k=J(g.camera,b)?A.OrientationMode.LOCKED:A.OrientationMode.ADJUST;g.scale=A.distanceToScale(a,l,g.targetGeometry.latitude);p=A.createAsyncContext(f);A.fromCenterScale(a,g.targetGeometry,g.scale,g.camera,k,p);r=g;return[4,p.resolver.promise];case 1:return r.camera=
m.sent(),[2,g]}})})}function Z(a){a&&(a.rotation=K(a.camera.heading));return a}Object.defineProperty(a,"__esModule",{value:!0});a.DEFAULT_FRAME_COVERAGE=.66;a.rotationToHeading=F;a.headingToRotation=K;a.toCamera=N;a.fromInternalCamera=function(a,b,c){c||(c=new l({camera:new h}));A.internalToExternal(a,b,c.camera);return M(a,b,c)};a.fromCamera=function(a,b,c){c||(c=new l);c.camera=b.clone();return M(a,null,c)};a.create=function(c,e,f){return k(this,void 0,void 0,function(){var g,k,p,q,r,n,w,v,x,B,
H,J,F;return m(this,function(m){switch(m.label){case 0:if(e&&c.spatialReference){m={target:null};if("declaredClass"in e||Array.isArray(e))m.target=e;else{for(var E in e)m[E]=e[E];e.center&&!m.target&&(m.target=e.center)}g=m}else g=null;if(!g)throw new b("viewpointutils-create:no-target","Missing target for creating viewpoint");k=new l({camera:new h({fov:c.camera.fov})});return g.target instanceof l?[4,T(c,g.target,g,f,k)]:[3,2];case 1:return p=m.sent(),[2,Z(p)];case 2:if(g.target instanceof h)return[2,
Z(U(c,g,g.target,k))];q=null!=g.scale||null!=g.zoom;if(!(g.target instanceof d.Extent))return[3,6];r=g.target.xmin===g.target.xmax||g.target.ymin===g.target.ymax;if(!q&&!r)return[3,4];n=Z;return[4,P(c,g,g.target.center,f,k)];case 3:return[2,n.apply(void 0,[m.sent()])];case 4:return w=Z,[4,W(c,g,g.target,f,k)];case 5:return[2,w.apply(void 0,[m.sent()])];case 6:return v={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]},x=q?A.scaleToResolution(c,I(c,g)):void 0,[4,O(c,g.target,x,v)];case 7:m.sent();
if(!isFinite(v.boundingBox[0]))return[3,11];y.center(v.boundingBox,X);la.x=X[0];la.y=X[1];la.z=X[2];la.spatialReference=c.spatialReference;r=void 0;isFinite(la.z)&&v.hasZ?r=y.isPoint(v.boundingBox):(la.z=void 0,r=t.isPoint(y.toRect(v.boundingBox,ca)));if(!q&&!r)return[3,9];B=Z;return[4,P(c,g,la,f,k)];case 8:return[2,B.apply(void 0,[m.sent()])];case 9:E=v.screenSpaceObjects;m=a.DEFAULT_FRAME_COVERAGE;if(E.length){for(var G=Number.NEGATIVE_INFINITY,K=0;K<E.length;K++)var L=E[K].screenSpaceBoundingRect,
G=Math.max(G,Math.abs(L[0]),Math.abs(L[1]),Math.abs(L[2]),Math.abs(L[3]));H=m-G/Math.min(c.width,c.height)*2}else H=m;J=Z;return[4,Q(c,g,la,v.boundingBox,H,f,k)];case 10:return[2,J.apply(void 0,[m.sent()])];case 11:if(g.position)return E=g,m=k,G=z.cameraOnContentAlongViewDirection(c),u.vec3.copy(ia,G.viewForward),A.directionToHeadingTilt(c,G.eye,ia,G.up,ha),m.camera.position=new d.Point(E.position),m.camera.heading=null!=E.heading?E.heading:ha.heading,m.camera.tilt=null!=E.tilt?E.tilt:ha.tilt,E=M(c,
null,m),[2,Z(E)];F=Z;return[4,V(c,g,f,k)];case 12:return[2,F.apply(void 0,[m.sent()])]}})})};var X=v.vec3f64.create(),aa=w.mat4f64.create(),da=r.mat3f64.create(),ga=y.create(),ca=t.create(),ia=v.vec3f64.create(),ba=v.vec3f64.create(),oa=v.vec3f64.create(),ha={heading:0,tilt:0},la=new d.Point,ra={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var f=a.rings[e],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&(c[2]=
f[g][2]),b(c)},polyline:function(a,b,c){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&(c[2]=f[g][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(u.vec3.set(c,a.xmin,a.ymin,a.zmin)),b(u.vec3.set(c,a.xmax,a.ymin,a.zmin)),b(u.vec3.set(c,a.xmin,a.ymax,a.zmin)),b(u.vec3.set(c,a.xmax,a.ymax,a.zmin)),b(u.vec3.set(c,a.xmin,
a.ymin,a.zmax)),b(u.vec3.set(c,a.xmax,a.ymin,a.zmax)),b(u.vec3.set(c,a.xmin,a.ymax,a.zmax)),b(u.vec3.set(c,a.xmax,a.ymax,a.zmax))):(b(u.vec3.set(c,a.xmin,a.ymin,c[2])),b(u.vec3.set(c,a.xmax,a.ymin,c[2])),b(u.vec3.set(c,a.xmin,a.ymax,c[2])),b(u.vec3.set(c,a.xmax,a.ymax,c[2])))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(u.vec3.set(c,a[d+0],a[d+1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(n,a,m,k,h,d,g,l,f){function c(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];b&&!b(e)||c.push(e)}return c}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b,c){this.viewingMode=a;this.layerProvider=b;this.view=c;this.tmpIntersector=new l(this.viewingMode);this.tmpRay=d.ray.create();this.externalIntersectionHandlers=new Set;this.intersectionTolerance=l.DEFAULT_TOLERANCE;this.validateHUDIntersector=new l(this.viewingMode);this.validateHUDIntersector.enable.hud=!1}a.prototype.intersectScreen=
function(a,b,c,d){return this.intersectRay(this.getPickRay(a,this.tmpRay),b,c,d)};a.prototype.intersectScreenFreePointFallback=function(a,b,c,d){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),b,c,d)};a.prototype.intersectRay=function(a,b,c,d){d=this.computeIntersection(a,c,!1,d||this.tmpIntersector);b=d?(a=d.results.min)?a.getIntersectionPoint(b):!1:!1;return b};a.prototype.intersectRayFreePointFallback=function(a,b,c,d){return this.intersectRay(a,b,c,d)||this.intersectRayFreePointLocal(a,
b)};a.prototype.intersectIntersectorScreen=function(a,b,c,d,e){void 0===d&&(d=!1);void 0===e&&(e=!1);return this.computeIntersection(this.getPickRay(a,this.tmpRay),c,d,b,e)};a.prototype.intersectToolIntersectorScreen=function(a,b,c){a=this.getPickRay(a,this.tmpRay);var d=this.computeIntersection(a,c,!0,b),e=d.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||e.hasIntersectionPoint&&"TerrainRenderer"!==e.intersector||(d=this.computeIntersection(a,c,!1,b));return d};a.prototype.setTolerance=
function(a){void 0===a&&(a=l.DEFAULT_TOLERANCE);this.intersectionTolerance=a};a.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.add(a)};a.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.delete(a)};a.prototype.getPickRay=function(a,b){void 0===b&&(b=d.ray.create());return d.ray.fromScreen(this.view.state.camera,a,b)};a.prototype.intersectRayFreePointLocal=function(a,b){if("local"!==this.viewingMode)return!1;var c=this.view.dataExtent,
d=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));if(0===d)return h.vec3.add(b,a.origin,h.vec3.normalize(g.sv3d.get(),a.direction)),!0;var e=this.view.state.camera,f=Math.max(0,c.xmin-e.eye[0],e.eye[0]-c.xmax),c=Math.max(0,c.ymin-e.eye[1],e.eye[1]-c.ymax),e=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(e.relativeElevation)+Number.MIN_VALUE))),2)),e=Math.max(e,Math.min(Math.sqrt(f*f+c*c),d)),d=h.vec3.scale(g.sv3d.get(),a.direction,e/h.vec3.length(a.direction));
h.vec3.add(b,a.origin,d);return!0};a.prototype.computeIntersection=function(a,c,d,e,m){var p=this,q=this.view.state.camera,r=k.castRenderScreenPointArray3(g.sv3d.get());q.projectPoint(a.origin,r);var n=this.prepareFilters(c,b);e=e||new l(this.viewingMode);e.enable.storeAll=c&&c.allEnabled;e.enable.storeTerrainResults=n.filterLayerUid(f.TERRAIN_ID);e.enable.selectOpaqueTerrainOnly=!c||!("include"in c||"exclude"in c);var u=a.origin,w=h.vec3.add(g.sv3d.get(),a.origin,a.direction);e.intersect(n.layers,
u,w,r,q,this.intersectionTolerance,d,null);var E=(a=this.view.slicePlane)?f.sliceFilterPredicate(a):null;e.intersect(n.sliceableLayers,u,w,r,q,this.intersectionTolerance,d,E,!1);var B=c&&c.terrainLocationFeedbackEnabled||m;this.externalIntersectionHandlers.forEach(function(a){if(a.intersectionHandlerId===f.TERRAIN_ID){if(!B&&!n.filterLayerUid(f.TERRAIN_ID))return}else if(!n.filterLayerUid(a.intersectionHandlerId))return;a.intersect(e,a.slicePlaneEnabled?E:null,u,w,r)});c=g.sv3d.get();m&&e.results.terrain.getIntersectionPoint(c)&&
(m=this.view._stage.renderView.getDrapedRenderer(),a=g.sv3d.get(),this.view.renderCoordsHelper.fromRenderCoords(c,a,this.view.spatialReference),a[2]=this.view.basemapTerrain.getElevation(c)||0,m.intersect(e,a,n.filterRenderGeometry));e.sortResults();m=e.results.hud;if(m.hasIntersectionPoint){var G=k.castRenderScreenPointArray3(g.sv3d.get()),F=g.sv3d.get(),K=g.sv3d.get();this.unprojectHUDResultRay(m.center,G,F,K);c=h.vec3.distance(m.center,F)/h.vec3.distance(F,K)*.99;this.validateHUDIntersector.intersect(n.layers,
F,K,G,q,this.intersectionTolerance,d,null);this.validateHUDIntersector.intersect(n.sliceableLayers,F,K,G,q,this.intersectionTolerance,d,E,!1);this.externalIntersectionHandlers.forEach(function(a){n.filterLayerUid(a.intersectionHandlerId)&&a.intersect(p.validateHUDIntersector,a.slicePlaneEnabled?E:null,F,K,G)});d=this.validateHUDIntersector.results.min;if(null==d.dist||c<=d.dist)e.results.min.copyFrom(m),e.results.all.splice(0,0,m)}return e};a.prototype.prepareFilters=function(a,b){var d=[],e=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&
(a.isSliceable?e:d).push(a)});b.include=a&&a.include;b.exclude=a&&a.exclude;b.layers.length=0;b.sliceableLayers.length=0;c(d,b.filterLayer,b.layers);c(e,b.filterLayer,b.sliceableLayers);return b};a.prototype.unprojectHUDResultRay=function(a,b,c,d){var e=this.view.state.camera;e.projectPoint(a,b);a=k.castRenderScreenPointArray3(g.sv3d.get());a[0]=b[0];a[1]=b[1];a[2]=0;e.unprojectPoint(a,c);a[2]=1;e.unprojectPoint(a,d)};return a}();a.SceneIntersectionHelper=n;var b={include:null,exclude:null,layers:[],
sliceableLayers:[],filterLayer:function(a){return b.filterLayerUid(a.apiLayerUid)},filterLayerUid:function(a){var c=b.include,d=b.exclude;return m.isNone(a)?null==c&&null==d:(null==c||c.has(a))&&(null==d||!d.has(a))},filterRenderGeometry:function(a){return b.filterLayerUid(a.data.layerUid)}}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){return function(a){function d(b){b=a.call(this)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;return b}m(d,a);d.prototype.getElevation=function(a,b){var c=null,d=!0;"scene"===b&&(c=this._updateElevation(c,this.providers.im,a,b),null!=c&&(d=!1));d&&(c=this._updateElevation(c,this.providers.ground,a,b));"scene"===b&&(c=this._updateElevation(c,this.providers.scene,a,b));return c};d.prototype._updateElevation=function(a,b,c,d){for(var e=0;e<b.length;e++){var f=
b[e].getElevation(c,d);null!=f&&(a=null!=a?Math.max(f,a):f)}return a};d.prototype.queryElevation=function(a,c,d,g){var h=this;void 0===d&&(d=0);this._elevationService||(this._elevationService=new e.ElevationQuery(this.view.spatialReference,function(){return h.view.map&&h.view.map.ground},{maximumAutoTileRequests:4}));var l=f.createResolver();(b.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,c,d):this._elevationService.queryElevation(a[0],a[1],c,d)).then(function(b){"scene"===g&&(b=h._updateElevation(b,
h.providers.scene,a,g));l.resolve(b)}).catch(function(b){f.isAbortError(b)?l.reject(b):l.resolve(h.getElevation(a))});return l.promise};d.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",a)}));this.providers[a].push(b)};d.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],e=this.providers[d].indexOf(a);
-1<e&&this.providers[d].splice(e,1)}};k([c.property({constructOnly:!0})],d.prototype,"view",void 0);k([c.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d.prototype,"spatialReference",void 0);return d=k([c.subclass("esri.views.3d.support.CombinedElevationProvider")],d)}(c.declared(l.EventedMixin(g)))})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b){this.spatialReference=a;this.view=b;this.point=new d.Point;this.point.spatialReference=a}a.prototype.getElevation=function(a,b,c){this.point.x=a;this.point.y=b;return this.view.elevationProvider.getElevation(this.point,c)};a.prototype.queryElevation=function(a,b,c,d,e){return k(this,void 0,void 0,function(){return m(this,function(f){this.point.x=a;this.point.y=b;return[2,this.view.elevationProvider.queryElevation(this.point,
c,d,e)]})})};return a}();a.ViewElevationProvider=n;n=function(){function a(a,b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=h({},c,{ignoreInvisibleLayers:!0})}a.prototype.queryElevation=function(a,b,d,e,f){void 0===e&&(e=0);return k(this,void 0,void 0,function(){var f=this;return m(this,function(h){return[2,c.create(function(h,l){var k={x:a,y:b,minDemResolution:e,result:{resolve:h,reject:l},signal:d};f._queries.push(k);c.onAbort(d,
function(){g.remove(f._queries,k);l(c.createAbortError())});f._scheduleDoQuery()})]})})};a.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(b.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};a.prototype._doQuery=function(){return k(this,void 0,void 0,function(){var a,b,e,g,k,n,y,t,x,z,A,E;return m(this,function(p){switch(p.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];if(0===a.length)return[2];b=a.map(function(a){return[a.x,a.y]});e=a.reduce(function(a,
b){return Math.min(a,b.minDemResolution)},Infinity);g=new d.Multipoint({points:b,spatialReference:this.spatialReference});k=this._getElevationQueryProvider();if(!k)return a.forEach(function(a,b){return a.result.reject()}),[2];n=1<a.length&&a.some(function(a){return!!a.signal})?c.createAbortController():null;y=f.isSome(n)?n.signal:a[0].signal;f.isSome(n)&&(t=0,a.forEach(function(b){return c.onAbort(b.signal,function(){t++;b.result.reject(c.createAbortError());t===a.length&&n.abort()})}));x=h({},this._queryOptions,
{minDemResolution:e,signal:y});return[4,l.result(k.queryElevation(g,x))];case 1:z=p.sent();for(A=0;A<a.length;A++)E=a[A],f.isSome(E.signal)&&E.signal.aborted?E.result.reject(c.createAbortError()):!1===z.ok?E.result.reject(z.error):E.result.resolve(z.value.geometry.points[A][2]);return[2]}})})};return a}();a.ElevationQuery=n})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/has"],function(n,a,m){function k(){var a=!!m("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,
maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:a?.8:1,polylineLodFactor:a?1.2:1.5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:a},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!m("disable-feature:reduce-map-tile-levels")},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!1,memoryLimit:a?400:500,additionalCacheMemory:a?0:100,frameRate:0,maximumRenderResolution:null,
maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:a?1.2:2,polylineLodFactor:a?1.2:2},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!m("disable-feature:reduce-map-tile-levels")},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,memoryLimit:a?600:1E3,
additionalCacheMemory:0,frameRate:0,maximumRenderResolution:a?null:4096,maximumPixelRatio:a?1:null}}}n=function(){function a(){}a.isValidProfile=function(d){return d in a.profiles};a.getDefaultProfile=function(){return m("esri-iPhone")?"low":"medium"};a.apply=function(d,g){d=a.profiles[d];g.graphics3D.maxTotalNumberOfFeatures=d.graphics3D.maxTotalNumberOfFeatures;g.graphics3D.maxTotalNumberOfPrimitives=d.graphics3D.maxTotalNumberOfPrimitives;g.graphics3D.polygonLodFactor=d.graphics3D.polygonLodFactor;
g.graphics3D.polylineLodFactor=d.graphics3D.polylineLodFactor;g.sceneService["3dObject"].lodFactor=d.sceneService["3dObject"].lodFactor;g.sceneService.point.lodFactor=d.sceneService.point.lodFactor;g.sceneService.integratedMesh.lodFactor=d.sceneService.integratedMesh.lodFactor;g.sceneService.pointCloud.lodFactor=d.sceneService.pointCloud.lodFactor;g.sceneService.uncompressedTextureDownsamplingEnabled=d.sceneService.uncompressedTextureDownsamplingEnabled;g.tiledSurface.lodBias=d.tiledSurface.lodBias;
g.tiledSurface.angledSplitBias=d.tiledSurface.angledSplitBias;g.tiledSurface.reduceTileLevelDifferences=d.tiledSurface.reduceTileLevelDifferences;g.antialiasingEnabled=d.antialiasingEnabled;g.physicallyBasedRenderingEnabled=d.physicalBasedRenderingEnabled;g.memoryLimit=d.memoryLimit;g.additionalCacheMemory=d.additionalCacheMemory;g.frameRate=d.frameRate;g.maximumRenderResolution=d.maximumRenderResolution;g.maximumPixelRatio=d.maximumPixelRatio};a.debug={reset:function(){var d=k(),g;for(g in d)a.profiles[g]=
d[g]}};return a}();(n||(n={})).profiles=k();return n})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),function(n,a,m,k,h,d,g,l,f){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.color=new h([0,255,255]);b.haloColor=
null;b.haloOpacity=1;b.fillOpacity=.25;return b}m(b,a);b.toEngineOptions=function(a){var b=h.toUnitRGBA(a.color),c=g.isSome(a.haloColor)?h.toUnitRGBA(a.haloColor):b;return{color:f.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloColor:f.vec4f32.fromValues(c[0],c[1],c[2],c[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};k([l.property({type:h})],b.prototype,"color",void 0);k([l.property({type:h})],b.prototype,"haloColor",
void 0);k([l.property()],b.prototype,"haloOpacity",void 0);k([l.property()],b.prototype,"fillOpacity",void 0);return b=k([l.subclass("esri.views.3d.support.HighlightOptions")],b)}(l.declared(d))})},"esri/views/3d/support/index":function(){define(["require","exports","./ResourceController","./MemoryController"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.ResourceControllerMaster=m.ResourceControllerMaster;a.newResourceController=m.newResourceController;a.newMemoryController=
k.newMemoryController;n=new Map;m=0;for(k=[[0,15],[1,20],[2,5]];m<k.length;m++){var h=k[m];n.set(h[0],h[1])}a.downloadSlotsPerClient=n})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/Handles ../../../core/now ../../../core/scheduling ../../../core/accessorSupport/decorators ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});var q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.updating=!1;return b}k(b,a);m([f.property({readOnly:!0})],b.prototype,"updating",void 0);return b=m([f.subclass("esri.views.3d.support.ResourceController")],b)}(f.declared(h));a.ResourceControllerMaster=q;a.newResourceController=function(a,b){void 0===b&&(b=g);return new r.ResourceController({view:a,now:b})};var r;(function(a){var g=function(a){function g(){var b=
null!==a&&a.apply(this,arguments)||this;b._scheduler=null;b._memoryController=null;b._streamDataLoader=null;b._lastTargetChangeTime=0;b._handles=new d;b._frameTask=null;return b}k(g,a);g.prototype.initialize=function(){var a=this;this._lastTargetChangeTime=this.now();this._scheduler=p.newScheduler(this.now);this._memoryController=b.newMemoryController(this.view);this._streamDataLoader=new e.default;this._streamDataLoader.setup(c.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",
function(){return a._cameraChangedHandler()},!0),this.view.watch("stationary",function(){return a._stationaryChangedHandler()}),this._memoryController.events.on("updating-changed",function(){return a.notifyChange("updating")})]);this._frameTask=l.addFrameTask({update:function(b){return a.frame(b)}})};g.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=
null);this._memoryController.destroy();this._memoryController=null;this._scheduler.destroy();this._scheduler=null};Object.defineProperty(g.prototype,"updating",{get:function(){return!!(this._memoryController&&this._memoryController.updating||this._streamDataLoader&&this._streamDataLoader.updating)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"memoryController",
{get:function(){return this._memoryController},enumerable:!0,configurable:!0});g.prototype.createStreamDataRequester=function(a){var b=this._streamDataLoader;return{request:function(c,d,e){return b.request(c,d,a,e)},get busy(){return b.busy}}};g.prototype.frame=function(a){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(a.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame()):
this._memoryController.updating&&this._memoryController.update()}};g.prototype._cameraChangedHandler=function(){this._lastTargetChangeTime=this._scheduler.now;this._scheduler.state=this.state};g.prototype._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};Object.defineProperty(g.prototype,"state",{get:function(){return this._scheduler.now-this._lastTargetChangeTime>h?2:this.view.animation?0:1},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"test",{get:function(){var a=
this;return{getQueueStats:function(b){return a._streamDataLoader.test.loadQueue.getStatsForType(b)}}},enumerable:!0,configurable:!0});m([f.property({constructOnly:!0})],g.prototype,"view",void 0);m([f.property({constructOnly:!0})],g.prototype,"now",void 0);m([f.property()],g.prototype,"_streamDataLoader",void 0);m([f.property({readOnly:!0,dependsOn:["_streamDataLoader.updating"]})],g.prototype,"updating",null);return g=m([f.subclass("esri.views.3d.support.ResourceController")],g)}(f.declared(q));
a.ResourceController=g;var h=300})(r||(r={}))})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Evented ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g=k.getLogger("esri.views.3d.support.MemoryController");a.newMemoryController=function(a){return new l(a)};var l=function(){function a(a){this._view=a;this.events=new m;this.minQuality=
.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new h.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}a.prototype.destroy=function(){this.events=null};a.prototype.getMemCache=function(a,b){return new h.MemCache(a,this._cacheStorage,b)};Object.defineProperty(a.prototype,"maxMemory",{get:function(){return this._maxMemory},set:function(a){null!=
a&&0<a&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<a&&this._updateQuality(1),this._maxMemory=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"additionalCacheMemory",{set:function(a){null!=a&&0<=a&&(this._additionalCacheMemory=a)},enumerable:!0,configurable:!0});a.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096};Object.defineProperty(a.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});a.prototype.resetStableQuality=function(){this._stableQuality=0};a.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var a=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=
!1,this._updateQuality(1);else if(a){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,a=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=
this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.1*(.75-this._memoryUsed+.1))):1>this._quality&&(this._canFastRecover=!0));this.updating!==a&&(this._updating=a,this.events.emit("updating-changed",this.updating))}};a.prototype._updateQuality=function(a){a=Math.min(Math.max(a,this.minQuality),1);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",this._quality);
++this._numQualityChanges;return!0};a.prototype._layersUpdating=function(){return this._view.allLayerViews.some(function(a){return!!a.updating})};a.prototype._updateMemory=function(){var a=this,b=0,e=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(b+=this._view.basemapTerrain.getUsedMemory());var f=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;f&&(b+=f.getUsedMemory());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(c){if(d.isMemoryManagedLayerView(c)){var f=
c.ignoresMemoryFactor()?a._quality:1;b+=c.getUsedMemory()*f;e+=c.getUnloadedMemory()*f}});var h=null==this._warnMemoryUsage||Math.round(10*b)!==Math.round(10*this._warnMemoryUsage),f=1048576*this._maxMemory;if(b>f&&h){this._warnMemoryUsage=b;var h=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},l=Math.round(100*this._quality);g.warn("Memory Limit exceeded! Limit: "+h(f)+" Current: "+h(b)+" Projected: "+h(b+e)+" Quality: "+l+"%")}this._memoryUsed=b/f;this._memoryPredicted=
(b+e)/f;this._cacheStorage.maxSize=Math.max(0,f-b+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(a.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}},enumerable:!0,configurable:!0});return a}()})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/now ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./AsyncQuotaRoundRobinQueue ../webgl-engine/lib/Util ../../../views/support/Scheduler".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b.tasks=new Map;b.doneQueue=[];b.updating=!1;return b}k(d,a);d.prototype.setup=function(a,b){var c=this;this.loadQueue=new q.AsyncQuotaRoundRobinQueue(function(a,b){return c.startLoading(a,b)},function(a,b){return c.doneLoadingCallback(a,b)},a);b&&(this.taskHandle=b.registerTask(w.Task.STREAM_DATA_LOADER,function(a){return c.update(a)},
function(){return 0<c.doneQueue.length}))};d.prototype.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(function(a){a.abortController&&a.abortController.abort()});this.loadQueue.clear();this.tasks=this.doneQueue=this.loadQueue=null};Object.defineProperty(d.prototype,"busy",{get:function(){return this.loadQueue.busy},enumerable:!0,configurable:!0});d.prototype.request=function(a,b,d,f){var g=this,h=e.createResolver();h.__signal=c.isSome(f)?f.signal:
null;var l=c.isSome(f)&&f.uid||a,k=this.createOrUpdateTask(a,b,d,l,h);e.onAbort(f,function(){return g.cancelRequest(k,h)});return h.promise};d.prototype.createTask=function(a,b,c,d,e){a={url:a,docType:b,clientType:c,key:d,result:null,status:1,resourceRequest:null,abortController:null,resolvers:[],_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,e);this.tasks.set(d,a);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(a);return a};d.prototype.cancelRequest=function(a,
b){g.removeUnordered(a.resolvers,b);b.reject(e.createAbortError());0===a.resolvers.length&&(2===a.status&&(a.status=4,this.loadQueue.workerCancelled(a),a.abortController.abort(),a.resourceRequest=null,a.abortController=null),a.status=4,this.tasks.delete(a.key),0===this.tasks.size&&this._set("updating",!1))};d.prototype.taskKey=function(a,b,c){return a+":"+b+":"+c};d.prototype.updateTask=function(a,b){a.resolvers.push(b)};d.prototype.createOrUpdateTask=function(a,b,c,d,e){d=this.taskKey(d,b,c);var f=
this.tasks.get(d);return f?(this.updateTask(f,e),f):this.createTask(a,b,c,d,e)};d.prototype.doneLoadingCallback=function(a,b){r.assert(2===a.status);a.status=3;this.taskHandle?this.doneQueue.push({task:a,err:b}):this.doneLoading(a,b)};d.prototype.update=function(a){for(;!a.done&&0<this.doneQueue.length;){var b=this.doneQueue.shift();3!==b.task.status&&(b.err=b.err||e.createAbortError());this.doneLoading(b.task,b.err);a.madeProgress()}};d.prototype.doneLoading=function(a,b){for(var c=a.result instanceof
HTMLImageElement?0:a.resolvers.length,d=0,g=a.resolvers;d<g.length;d++){var h=g[d];if(b)e.isAbortError(b)?h.reject(b):h.reject(new l("stream-data-loader:request-error","Failed to request resource at '"+a.url+"'. "+b,{url:a.url,error:b}));else{--c;var k=0>=c?a.result:f.clone(a.result);h.resolve(k)}}this.tasks.delete(a.key);0===this.tasks.size&&this._set("updating",!1)};d.prototype.startLoading=function(a,c){if(4===a.status)return!1;a.status=2;var d,f;switch(a.docType){case "binary":f="array-buffer";
d=0;break;case "image":f="image";break;default:f="json"}a.startTime=b();a.abortController=e.createAbortController();a.resourceRequest=h(a.url,{responseType:f,timeout:d,signal:a.abortController.signal});a.resourceRequest.then(function(d){a.duration=b()-a.startTime;a.size="binary"===a.docType?d.data.byteLength:0;a.result=d.data;a.abortController=null;c(a)},function(b){2===a.status&&c(a,b)});return!0};Object.defineProperty(d.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,
configurable:!0});m([p.property({readOnly:!0})],d.prototype,"updating",void 0);return d=m([p.subclass("esri.views.3d.support.StreamDataLoader")],d)}(p.declared(d));a.StreamDataLoader=n;a.default=n})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../webgl-engine/lib/Util"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g){var h=this;this.workerFunc=a;this.callbackFunc=d;this.robin=0;this.type2id=new Map;this.tasks=
[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.maxTotalNumWorkers=this.totalNumWorkers=0;g.forEach(function(a,c){h.type2id.set(c,h.tasks.length);h.tasks.push([]);h.typeNumWorkers.push(0);h.typeStatistics.push({requests:0,size:0,duration:0,speed:0});h.typeWorkerQuota.push(a);h.maxTotalNumWorkers+=a})}Object.defineProperty(a.prototype,"numTypes",{get:function(){return this.tasks.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"busy",{get:function(){return this.totalNumWorkers>=
this.maxTotalNumWorkers},enumerable:!0,configurable:!0});a.prototype.push=function(a){var d=this,g=this.type2id.get(a.clientType);this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[g]++,this.totalNumWorkers++,this.workerFunc(a,function(a,f){return d._taskCallback(a,f)})):this.tasks[g].push(a)};a.prototype.getStatsForType=function(a){a=this.type2id.get(a);return{quota:this.typeWorkerQuota[a],workers:this.typeNumWorkers[a],queueSize:this.tasks[a].length,requestStats:this.typeStatistics[a]}};
a.prototype.removeTasks=function(a,d){for(var g=[],h=0,f=this.tasks[this.type2id.get(d)];h<f.length;h++){var c=f[h];-1===a.indexOf(c)&&g.push(c)}this.tasks[this.type2id.get(d)]=g};a.prototype.workerCancelled=function(a){this.taskFinished(a);a._cancelledInQueue=!0};a.prototype.clear=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a]=[]};a.prototype.taskFinished=function(a){var d=this.type2id.get(a.clientType);this.typeNumWorkers[d]--;this.totalNumWorkers--;this.typeStatistics[d].requests++;
this.typeStatistics[d].size+=a.size||0;this.typeStatistics[d].duration+=a.duration||0;this.typeStatistics[d].speed=0<this.typeStatistics[d].duration?this.typeStatistics[d].size/this.typeStatistics[d].duration:0;m.assert(0<=this.typeNumWorkers[d]);this.next()};a.prototype.next=function(){var a=this.robin,d=!1;do this.typeNumWorkers[a]<this.typeWorkerQuota[a]&&this.processQueue(a)&&(d=!0),a=(a+1)%this.numTypes;while(!d&&a!==this.robin);if(!d){do this.processQueue(a)&&(d=!0),a=(a+1)%this.numTypes;while(!d&&
a!==this.robin)}this.robin=a};a.prototype.processQueue=function(a){for(var d=this;0<this.tasks[a].length;)if(this.workerFunc(this.tasks[a].shift(),function(a,h){return d._taskCallback(a,h)}))return this.typeNumWorkers[a]++,this.totalNumWorkers++,!0;return!1};a.prototype._taskCallback=function(a,d){a._cancelledInQueue||(this.callbackFunc(a,d),this.taskFinished(a))};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{set workerFunc(d){a.workerFunc=d}}},enumerable:!0,configurable:!0});
return a}();a.AsyncQuotaRoundRobinQueue=n})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,c,d){void 0===d&&(d=null);this.spatialReference=
c;this.unitInMeters=g.getMetersPerUnitForSR(this.spatialReference);this._geometryServicePromise=this.loadGeometryService(a,d)}a.prototype.loadGeometryService=function(a,c){return k(this,void 0,void 0,function(){return m(this,function(b){switch(b.label){case 0:if(c)return[2,c];b.label=1;case 1:return b.trys.push([1,3,,4]),[4,l.create(a&&a.get("portalItem"))];case 2:return[2,b.sent()];case 3:throw b.sent(),new d("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");
case 4:return[2]}})})};a.prototype.toGeographic=function(a){return k(this,void 0,void 0,function(){var b,c,d,g,l,k,n,y=this;return m(this,function(e){switch(e.label){case 0:return[4,this._geometryServicePromise];case 1:return b=e.sent(),c=!0,Array.isArray(a[0])&&"number"!==typeof a[0]?d=a:(d=[a],c=!1),g=d.map(function(a){return a instanceof h.Point?a:new h.Point(a,y.spatialReference)}),l=new f({geometries:g,outSpatialReference:h.SpatialReference.WGS84}),[4,b.project(l)];case 2:return k=e.sent(),n=
k.map(function(a){return"point"===a.type?[a.x,a.y]:void 0}),[2,c?n:n[0]]}})})};return a}();a.MapCoordsHelper=n;a.default=n})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../core/Error ../Portal ../PortalItem ../../tasks/GeometryService ../../tasks/support/ProjectParameters @dojo/framework/shim/Promise".split(" "),function(n,a,m,k,h,d,g,l,f,c){function b(a,b){void 0===a&&(a=null);
return k(this,void 0,void 0,function(){var c;return m(this,function(e){switch(e.label){case 0:if(h.geometryServiceUrl)return[2,new f({url:h.geometryServiceUrl})];if(!a)throw new d("internal:geometry-service-url-not-configured");a.isInstanceOf(l)?c=a.portal||g.getDefault():a.isInstanceOf(g)&&(c=a);return[4,c.load({signal:b})];case 1:e.sent();if(c.helperServices&&c.helperServices.geometry&&c.helperServices.geometry.url)return[2,new f({url:c.helperServices.geometry.url})];throw new d("internal:geometry-service-url-not-configured");
}})})}Object.defineProperty(a,"__esModule",{value:!0});a.create=b;a.projectGeometry=function(a,f,g,h){void 0===g&&(g=null);return k(this,void 0,void 0,function(){var e,l,k;return m(this,function(p){switch(p.label){case 0:return[4,b(g,h)];case 1:return e=p.sent(),l=new c,l.geometries=[a],l.outSpatialReference=f,[4,e.project(l,{signal:h})];case 2:if((k=p.sent())&&Array.isArray(k)&&1===k.length)return[2,k[0]];throw new d("internal:geometry-service-projection-failed");}})})}})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(n,a,m,k,h,d){var g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.minTotalNumberOfFeatures=2E3;b.maxTotalNumberOfFeatures=5E4;b.maxTotalNumberOfPrimitives=17E5;b.polygonLodFactor=1;b.polylineLodFactor=1;return b}m(b,a);k([d.property()],b.prototype,"minTotalNumberOfFeatures",void 0);k([d.property()],b.prototype,"maxTotalNumberOfFeatures",void 0);k([d.property()],b.prototype,"maxTotalNumberOfPrimitives",void 0);k([d.property()],b.prototype,"polygonLodFactor",void 0);
k([d.property()],b.prototype,"polylineLodFactor",void 0);return b=k([d.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],b)}(d.declared(h)),l=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.lodFactor=1;return b}m(b,a);k([d.property()],b.prototype,"lodFactor",void 0);return b=k([d.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],b)}(d.declared(h)),f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b["3dObject"]=
new l;b.point=new l;b.integratedMesh=new l;b.pointCloud=new l;b.uncompressedTextureDownsamplingEnabled=!1;return b}m(b,a);k([d.property({type:l})],b.prototype,"3dObject",void 0);k([d.property({type:l})],b.prototype,"point",void 0);k([d.property({type:l})],b.prototype,"integratedMesh",void 0);k([d.property({type:l})],b.prototype,"pointCloud",void 0);k([d.property()],b.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return b=k([d.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],
b)}(d.declared(h)),c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.lodBias=0;b.angledSplitBias=1;b.reduceTileLevelDifferences=!0;return b}m(b,a);k([d.property()],b.prototype,"lodBias",void 0);k([d.property()],b.prototype,"angledSplitBias",void 0);k([d.property()],b.prototype,"reduceTileLevelDifferences",void 0);return b=k([d.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],b)}(d.declared(h));return function(a){function b(){var b=null!==a&&a.apply(this,
arguments)||this;b.graphics3D=new g;b.sceneService=new f;b.tiledSurface=new c;b.antialiasingEnabled=!0;return b}m(b,a);k([d.property({type:g})],b.prototype,"graphics3D",void 0);k([d.property({type:f})],b.prototype,"sceneService",void 0);k([d.property({type:c})],b.prototype,"tiledSurface",void 0);k([d.property()],b.prototype,"antialiasingEnabled",void 0);k([d.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);k([d.property()],b.prototype,"memoryLimit",void 0);k([d.property()],b.prototype,
"additionalCacheMemory",void 0);k([d.property()],b.prototype,"frameRate",void 0);k([d.property()],b.prototype,"maximumRenderResolution",void 0);k([d.property()],b.prototype,"maximumPixelRatio",void 0);return b=k([d.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)}(d.declared(h))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/compilerUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b,c,d){this.type=a;this.spatialReference=b;this.unitInMeters=c;this.coordinateSystem=d;this.tmpCoordinateSystem=q.create(d)}Object.defineProperty(a.prototype,"extent",{set:function(a){a&&q.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});a.prototype.getAltitude=function(a){return q.altitudeAt(this.coordinateSystem,a)};a.prototype.setAltitude=function(a,
b){q.setAltitudeAt(this.coordinateSystem,b,a,b)};a.prototype.setAltitudeOfTransformation=function(a,b){q.setAltitudeOfTransformation(this.coordinateSystem,b,a,b)};a.prototype.worldUpAtPosition=function(a,b){return q.normalAt(this.coordinateSystem,a,b)};a.prototype.worldBasisAtPosition=function(a,b,c){return q.axisAt(this.coordinateSystem,a,b,c)};a.prototype.basisMatrixAtPosition=function(a,b){var c=this.worldBasisAtPosition(a,0,p.sv3d.get()),e=this.worldBasisAtPosition(a,1,p.sv3d.get());a=this.worldBasisAtPosition(a,
2,p.sv3d.get());d.mat4.set(b,c[0],c[1],c[2],0,e[0],e[1],e[2],0,a[0],a[1],a[2],0,0,0,0,1);return b};a.prototype.intersectManifoldClosestSilhouette=function(a,b,c){q.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);q.intersectRayClosestSilhouette(this.tmpCoordinateSystem,a,c);return c};a.prototype.intersectManifold=function(a,b,c){q.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=p.sv3d.get();return q.intersectRay(this.tmpCoordinateSystem,a,b)?(g.vec3.copy(c,b),!0):!1};a.prototype.intersectInfiniteManifold=
function(a,c,d){if("global"===this.type)return this.intersectManifold(a,c,d);q.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);c=this.tmpCoordinateSystem.value;var e=p.sv3d.get();return b.plane.intersectRay(c.plane,a,e)?(g.vec3.copy(d,e),!0):!1};a.prototype.toRenderCoords=function(a,b,c){return f.isPoint(a)?e.pointToVector(a,b,this.spatialReference):e.vectorToVector(a,b,c,this.spatialReference)};a.prototype.fromRenderCoords=function(a,b,c){return f.isPoint(b)?e.vectorToPoint(a,this.spatialReference,
b,c):b instanceof l?e.vectorToPoint(a,this.spatialReference,b):e.vectorToVector(a,this.spatialReference,b,c)};a.createGlobal=function(d){void 0===d&&(d=e.SphericalECEFSpatialReference);var f=q.fromValues(b.sphere,b.sphere.fromValues(c.earthRadius,[0,0,0]));return new a("global",d,1,f)};a.createLocal=function(c){var d=q.fromValues(b.boundedPlane,b.boundedPlane.fromValues([0,0,0],[r,0,0],[0,r,0])),e=h.getMetersPerUnitForSR(c);return new a("local",c,e,d)};a.createMode=function(b,c){switch(b){case "local":return a.createLocal(c);
case "global":return a.createGlobal();default:k.neverReached(b)}};return a}();a.RenderCoordsHelper=n;var r=Math.pow(2,50)})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=
this.screenSizePerspectiveHandles=null;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataRequester=this.resourceController.createStreamDataRequester(2);this.textures=new h.default(this.streamDataRequester,a.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=d.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=d.getLabelSettings(a.viewingMode)}a.prototype.destroy=
function(){this.textures.destroy();this.streamDataRequester=this.textures=null};a.prototype.addGraphicsOwner=function(a){var c=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var b="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return c.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){b&&(b.remove(),m.removeUnordered(c.graphicsOwners,a),c.updateScreenSizePerspectiveEnabled())}}};a.prototype.updateScreenSizePerspectiveEnabled=
function(){var a=this,c=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});c&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new k,c=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",c,!0),this.viewState.events.on("camera-projection-changed",c)]),this.updateScreenSizePerspectiveSettings()):!c&&this.screenSizePerspectiveHandles&&
(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};a.prototype.updateScreenSizePerspectiveSettings=function(){g.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;g.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(g);this.screenSizePerspectiveSettingsLabels.update(g);this.stage.renderView.setNeedsRender()};return a}();a.SharedSymbolResources=n;var g={distance:0,fovY:0};a.default=n})},"esri/views/3d/support/TextureCollection":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/lib/Texture".split(" "),
function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b,c,d){void 0===d&&(d=l.schedule);this._streamDataRequester=a;this._stage=b;this._textureOptions=c;this._schedule=d;this._textureRequests=new Map}a.prototype.destroy=function(){var a=this;this._textureRequests.forEach(function(b){return a.releaseTextureRequest(b)});this._textureRequests=null};a.prototype.fromUrl=function(a,b,c){return h(this,void 0,void 0,function(){var e,f,h,l,p,m=this;return k(this,
function(k){g.throwIfAborted(c);e=d.isSome(c)&&c.signal;f=this.makeUid(a,b);h=this._textureRequests.get(f);h||(l=g.createAbortController(),p=this._streamDataRequester.request(a,"image",{uid:f,signal:l.signal}),h={referenceCount:0,texture:null,textureAsync:null,abortController:l},this._textureRequests.set(f,h),h.textureAsync=p.then(function(c){c=m.createTexture(a,c,b);h.texture=c;h.abortController=null;m.addToStage(c);return{uid:f,texture:c}},function(a){h.abortController=null;throw a;}));h.referenceCount++;
return[2,g.create(function(a,b){g.onAbort(e,function(){b(g.createAbortError())});h.textureAsync.then(a,b)}).catch(function(a){m.release(f);throw a;})]})})};a.prototype.fromData=function(a,b){a=this.makeUid(a);var c=this._textureRequests.get(a);c||(c={referenceCount:0,texture:b(),textureAsync:null,abortController:null},this.addToStage(c.texture),this._textureRequests.set(a,c));c.referenceCount++;return{uid:a,texture:c.texture}};a.prototype.release=function(a){var b=this;if(this._textureRequests){var c=
this._textureRequests.get(a);c?(1>c.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),c.referenceCount--,1>c.referenceCount&&this._schedule(function(){return b.releaseNow(a)})):console.warn("TextureCollection: texture doesn't exist: '"+a+"'")}};Object.defineProperty(a.prototype,"test",{get:function(){return{textureRequests:this._textureRequests}},enumerable:!0,configurable:!0});a.prototype.releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);
!b||0<b.referenceCount||(this.releaseTextureRequest(b),this._textureRequests.delete(a))}};a.prototype.releaseTextureRequest=function(a){a.texture?this.removeFromStage(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};a.prototype.createTexture=function(a,b,d){f.isSVG(a)&&(d||0===b.width&&0===b.height)&&(a=b.width?b.height/b.width:1,d=d||64,1<a?(b.width=Math.round(d/a),b.height=d):(b.width=d,b.height=Math.round(d*a)));d=m({},this._textureOptions,{width:b.width,height:b.height,
powerOfTwoResizeMode:2});return new c(b,"symbol",d)};a.prototype.addToStage=function(a){this._stage.add(4,a)};a.prototype.removeFromStage=function(a){this._stage.remove(4,a.id)};a.prototype.makeUid=function(a,b){return null!=b?a+"."+b+"px":a};return a}();a.TextureCollection=n;a.default=n})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils ../../../support/index".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(c){c=a.call(this,c)||this;c.handles=new g;c.surfaceAltitudeAtCenter=0;c.surfaceAltitudeAtCenterDirty=!0;c.surfaceAltitudeAtCenterWithContent=0;c.surfaceAltitudeAtCenterWithContentDirty=!0;c.propertiesPool=new e.PropertiesPool({renderPointOfView:A},c);c.renderPointOfView=b.vec3f64.create();return c}m(d,a);d.prototype.initialize=function(){var a=this,b=this.view,c=b.state,
d=b.basemapTerrain,e=b.renderCoordsHelper,b=b.map;this.surfaceIntersector=new t(c.mode);this.surfaceIntersector.enable.backfacesTerrain=c.isGlobal?!1:!0;this.surfaceIntersector.enable.invisibleTerrain=!1;this.contentIntersector=new t(c.mode);this.contentIntersectorOptions={exclude:l.SetFromValues([x.TERRAIN_ID])};var f=this.estimateSurfaceAltitudeAtCenter.bind(this),g={state:c,scheduler:this.view.resourceController.scheduler,surface:d,renderCoordsHelper:e};this._set("centerOnSurfaceInfrequent",new q.default(h({},
g,{task:z.Task.POINT_OF_INTEREST_SLOW,estimateSurfaceAltitudeAtCenter:f})));this._set("centerOnSurfaceFrequent",new q.default(h({},g,{task:z.Task.POINT_OF_INTEREST_FAST,estimateSurfaceAltitudeAtCenter:f})));this._set("centerOnContent",new q.default(h({},g,{task:z.Task.POINT_OF_INTEREST_FAST,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this)})));this._set("cameraOnSurface",new p.default(h({},g,{task:z.Task.POINT_OF_INTEREST_SLOW,map:b})));this._set("surfaceGeometryUpdates",
new y.default(h({},g,{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})));this._set("contentGeometryUpdates",new r.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:e}));this._set("surfaceOrigin",new v.default({view:this.view}));this._set("focus",new u.default({state:c,surface:d,renderCoordsHelper:e,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add([c.watch("camera",function(b){return a.cameraChanged(b)},!0),d.watch("extent",
function(){return a.updateCenterPointsOfInterest()}),this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}),this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()})]);this.cameraChanged(this.view.state.camera);this.centerOnContent.update();this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update();this.cameraOnSurface.update()};d.prototype.destroy=function(){w.default(this,"handles",
"centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(d.prototype,"updating",{get:function(){return!!(this.surfaceGeometryUpdates&&this.surfaceGeometryUpdates.updating||this.centerOnContent&&this.centerOnContent.updating||this.centerOnSurfaceInfrequent&&this.centerOnSurfaceInfrequent.updating||this.centerOnSurfaceFrequent&&this.centerOnSurfaceFrequent.updating||this.cameraOnSurface&&this.cameraOnSurface.updating||
this.focus&&this.focus.updating)},enumerable:!0,configurable:!0});d.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;this.view.sceneIntersectionHelper.intersectRay(this.view.state.camera.ray,E,this.contentIntersectorOptions,this.contentIntersector)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(E):this.surfaceAltitudeAtCenterWithContent=
this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};d.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;this.surfaceIntersector.intersect(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,a.eye,a.center);this.surfaceIntersector.results.min.getIntersectionPoint(E)&&
(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(E));return this.surfaceAltitudeAtCenter};d.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest();a=a.eye;c.vec3.equals(this.renderPointOfView,a)||this._set("renderPointOfView",c.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};d.prototype.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.updateRenderLocation();
this.centerOnSurfaceInfrequent.updateRenderLocation();this.cameraOnSurface.updateRenderLocation();this.focus.updateRenderLocation();this.centerOnContent.updateRenderLocation()};d.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.updateRenderLocation()};Object.defineProperty(d.prototype,"test",{get:function(){var a=this;return{update:function(){a.surfaceGeometryUpdates.update();a.centerOnSurfaceFrequent.update();a.centerOnSurfaceInfrequent.update()},
surfaceGeometryUpdates:this.surfaceGeometryUpdates}},enumerable:!0,configurable:!0});k([f.property({readOnly:!0})],d.prototype,"centerOnContent",void 0);k([f.property({readOnly:!0})],d.prototype,"centerOnSurfaceFrequent",void 0);k([f.property({readOnly:!0})],d.prototype,"centerOnSurfaceInfrequent",void 0);k([f.property({readOnly:!0})],d.prototype,"cameraOnSurface",void 0);k([f.property({readOnly:!0})],d.prototype,"focus",void 0);k([f.property({readOnly:!0})],d.prototype,"renderPointOfView",void 0);
k([f.property({readOnly:!0})],d.prototype,"surfaceOrigin",void 0);k([f.property({readOnly:!0})],d.prototype,"contentGeometryUpdates",void 0);k([f.property({readOnly:!0})],d.prototype,"surfaceGeometryUpdates",void 0);k([f.property({constructOnly:!0})],d.prototype,"view",void 0);k([f.property({readOnly:!0,dependsOn:"surfaceGeometryUpdates.updating centerOnContent.updating centerOnSurfaceInfrequent.updating centerOnSurfaceFrequent.updating cameraOnSurface.updating focus.updating".split(" ")})],d.prototype,
"updating",null);return d=k([f.subclass("esri.views.3d.support.PointsOfInterest")],d)}(f.declared(d));a.PointsOfInterest=n;var A=Array,E=b.vec3f64.create();a.default=n})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});var p=Array;n=function(a){function e(d){d=a.call(this,d)||this;d._dirty=!1;d._propertiesPool=new b.default({location:c,renderLocation:p},d);d._estimatedSurfaceAltitude=0;d._pendingElevationQueryController=null;d.renderLocation=f.vec3f64.create();return d}m(e,a);e.prototype.initialize=function(){var a=this;this.handles.add(this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a._needsUpdate()}));
this._measureSurfaceAltitude();if(this.map){var b=function(){return a._setDirty()};this.handles.add([d.on(this.map,"ground.layers","change",b,b,b)])}};e.prototype.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(e.prototype,"location",{get:function(){var a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"updating",{get:function(){return this._dirty||null!=this._pendingElevationQueryController},enumerable:!0,configurable:!0});e.prototype.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};e.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};e.prototype._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};e.prototype._needsUpdate=function(){return!this._pendingElevationQueryController&&
this._dirty};e.prototype._cancelPendingRequest=function(){var a=this._pendingElevationQueryController;a&&(this._pendingElevationQueryController=null,a.abort(),this.notifyChange("updating"))};e.prototype._measureSurfaceAltitude=function(){var a=this;this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,r,this.state.spatialReference);var b=h.createAbortController();this.map.ground.queryElevation(r,
{signal:b.signal}).then(function(b){return a._updateSurfaceAltitude(b.geometry.z)}).catch(function(b){h.isAbortError(b)||a._updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a._pendingElevationQueryController===b&&(a._pendingElevationQueryController=null,a.notifyChange("updating"));b=null});this._pendingElevationQueryController=b}else this._updateSurfaceAltitude(0)};e.prototype._updateSurfaceAltitude=function(a){this._estimatedSurfaceAltitude!==a&&(this._estimatedSurfaceAltitude=a,this._updateRenderLocation())};
e.prototype._updateRenderLocation=function(){l.vec3.copy(q,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,q);l.vec3.equals(this._get("renderLocation"),q)||this._set("renderLocation",l.vec3.copy(this._propertiesPool.get("renderLocation"),q))};k([g.property({constructOnly:!0})],e.prototype,"scheduler",void 0);k([g.property({constructOnly:!0})],e.prototype,"task",void 0);k([g.property({readOnly:!0,dependsOn:["renderLocation"]})],e.prototype,"location",null);
k([g.property({constructOnly:!0})],e.prototype,"map",void 0);k([g.property({readOnly:!0})],e.prototype,"renderLocation",void 0);k([g.property({readOnly:!0})],e.prototype,"updating",null);return e=k([g.subclass("esri.views.3d.support.CameraOnSurface")],e)}(g.declared(e.PointOfInterest));a.CameraOnSurface=n;var q=f.vec3f64.create(),r=new c;a.default=n})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b){b=a.call(this)||this;b.handles=new d;return b}m(c,a);c.prototype.destroy=function(){l.default(this,"handles")};k([g.property({constructOnly:!0})],c.prototype,"renderCoordsHelper",void 0);k([g.property({constructOnly:!0})],c.prototype,"surface",void 0);k([g.property({constructOnly:!0})],c.prototype,"state",void 0);return c=k([g.subclass("esri.views.3d.support.PointOfInterest")],c)}(g.declared(h));
a.PointOfInterest=n;a.default=n})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(n,a,m){function k(a){for(var d=[],g=1;g<arguments.length;g++)d[g-1]=arguments[g];if(a instanceof m&&a.destroyed)try{throw Error("instance is already destroyed");}catch(c){console.warn(c.stack)}else for(g=0;g<d.length;g++){var h=d[g];if(!(h in a))throw Error("Property '"+h+"' does not exist and cannot be disposed");var f=a[h];f&&("function"===
typeof f.destroy?f.destroy():"function"===typeof f.dispose?f.dispose():"function"===typeof f.remove&&f.remove());a instanceof m&&h in a.__accessor__.metadatas?a._set(h,null):a[h]=null}}Object.defineProperty(a,"__esModule",{value:!0});a.disposeMembers=k;a.default=k})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../earthUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});var q=Array;n=function(a){function p(b){b=a.call(this,b)||this;b.propertiesPool=new e.default({location:f,renderLocation:q},b);b.currentSurfaceAltitude=0;b.latestSurfaceAltitude=0;b.distance=0;b.renderLocation=l.vec3f64.create();b.updating=!1;return b}m(p,a);p.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a.updating});
this._measureSurfaceAltitude()};p.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(p.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});p.prototype.updateRenderLocation=function(){this._set("updating",!0);this._updateRenderLocation()};
p.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};Object.defineProperty(p.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});p.prototype._measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this._set("updating",!1)};p.prototype._updateRenderLocation=function(){var a=w,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,
a),c=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=u;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(g.vec3.copy(a,c),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=g.vec3.distance(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,g.vec3.scale(a,b.viewForward,this._get("distance")),
g.vec3.add(a,a,b.eye));g.vec3.equals(this._get("renderLocation"),a)||this._set("renderLocation",g.vec3.copy(this.propertiesPool.get("renderLocation"),a))};p.prototype.calculateSurfaceIntersection=function(a,c){var d=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(d.ray,a,c))return!1;if(this.state.isGlobal){a=b.earthRadius+a;var e=g.vec3.squaredLength(d.eye),f=e<a*a,l=g.vec3.distance(d.eye,c);f&&l>b.earthRadius/4&&(g.vec3.scale(c,d.viewForward,a-Math.sqrt(e)),g.vec3.add(c,c,d.eye))}else if(d=
this.surface.ready&&this.surface.extent)c[0]=h.clamp(c[0],d[0],d[2]),c[1]=h.clamp(c[1],d[1],d[3]);return!0};p.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var d=this.state.camera.eye;a=g.vec3.distance(d,a);b=g.vec3.distance(d,b);if(c.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(b-a)/a>r)return!0}return!1};k([d.property({constructOnly:!0})],
p.prototype,"scheduler",void 0);k([d.property({constructOnly:!0})],p.prototype,"task",void 0);k([d.property({readOnly:!0})],p.prototype,"distance",void 0);k([d.property({constructOnly:!0})],p.prototype,"estimateSurfaceAltitudeAtCenter",void 0);k([d.property({readOnly:!0,dependsOn:["renderLocation"]})],p.prototype,"location",null);k([d.property({readOnly:!0})],p.prototype,"renderLocation",void 0);k([d.property({readOnly:!0})],p.prototype,"updating",void 0);return p=k([d.subclass("esri.views.3d.support.CenterOnSurface")],
p)}(d.declared(p.PointOfInterest));a.CenterOnSurface=n;var r=.05,w=l.vec3f64.create(),u=l.vec3f64.create();a.default=n})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Evented","../../../../core/Handles"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.handles=new k;this.events=new m;this.contentLayerViews=a.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",
this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.layerViewsChanged=function(a){var d=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&d.handles.add(a.on("visible-geometry-changed",d.contentChanged.bind(d)),a.uid)});a.removed.forEach(function(a){return d.handles.remove(a.uid)})};
a.prototype.contentChanged=function(){this.events.emit("request-update",h)};return a}();a.ContentGeometryUpdates=n;var h={};a.default=n})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});var q=Array;n=function(a){function f(b){b=a.call(this,b)||this;b.propertiesPool=new e.default({locationOnSurface:c,renderLocationOnSurface:q},b);b.centerOnSurface=null;return b}m(f,a);f.prototype.destroy=function(){this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(f.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,
a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,b=this.renderCoordsHelper,c=this.calculateScreenHorizontalEdgeOnSurface(v);l.vec3.subtract(r,a,this.state.camera.eye);l.vec3.normalize(r,r);b.worldUpAtPosition(a,w);var d=Math.abs(Math.acos(l.vec3.dot(w,r))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),d=1-h.clamp(d/(.5*Math.PI),0,1);l.vec3.lerp(b,
a,c,d*d*d);return b},enumerable:!0,configurable:!0});f.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var c=this.state.camera,e=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),f=this.renderCoordsHelper.getAltitude(c.eye)>=e,g=c.getRenderCenter(d.createRenderScreenPointArray3());g[1]=f?c.padding[2]:c.fullHeight-c.padding[0];c.unprojectPoint(g,u);l.vec3.subtract(u,u,c.eye);f=l.vec3.normalize(u,u);if(this.renderCoordsHelper.intersectManifold(b.ray.wrap(c.eye,f),
e,a))return a;l.vec3.copy(a,c.eye);this.renderCoordsHelper.setAltitude(e,a);return a};f.prototype.updateRenderLocation=function(){};k([g.property({constructOnly:!0})],f.prototype,"centerOnSurface",void 0);k([g.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],f.prototype,"locationOnSurface",null);k([g.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],f.prototype,"renderLocationOnSurface",null);k([g.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],f.prototype,
"updating",void 0);return f=k([g.subclass("esri.views.3d.support.CenterOnSurface")],f)}(g.declared(p.PointOfInterest));a.Focus=n;var r=f.vec3f64.create(),w=f.vec3f64.create(),u=f.vec3f64.create(),v=f.vec3f64.create();a.default=n})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function h(b){b=a.call(this,b)||this;b.location=null;b._updateController=null;b._handles=new d;return b}m(h,a);Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=c.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&
(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],function(){return a._update()}),l.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};h.prototype.destroy=function(){this._handles.destroy()};h.prototype._update=function(){var a=this;this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var c=e.center(this.surfaceView.extent),
c=new b({x:c[0],y:c[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=g.createAbortController(),this.surface.queryElevation(c,{noDataValue:0,signal:this._updateController.signal}).then(function(b){a._updateController=null;a._set("location",b.geometry)}).catch(function(a){g.isAbortError(a)||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):
this._set("location",c)}else this._set("location",null)};k([f.property({constructOnly:!0})],h.prototype,"view",void 0);k([f.property({readOnly:!0,aliasOf:"view.map.ground"})],h.prototype,"surface",void 0);k([f.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,"surfaceView",void 0);k([f.property({readOnly:!0})],h.prototype,"location",void 0);k([f.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null);return h=k([f.subclass("esri.views.3d.terrain.StableSurfaceCenter")],
h)}(f.declared(h));a.StableSurfaceCenter=n;a.default=n})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/index".split(" "),function(n,a,
m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function f(){var b=null!==a&&a.apply(this,arguments)||this;b.handles=new g;b._tileGeometryUpdateExtent=c.empty();b._tileGeometryUpdateSpatialReference=null;b.events=new d;b.updating=!1;return b}k(f,a);f.prototype.initialize=function(){var a=this;this.handles.add([this.surface.on("elevation-change",function(b){return a._tileGeometryChanged(b)}),this.scheduler.registerTask(b.Task.SURFACE_GEOMETRY_UPDATES,function(){return a.update()},
function(){return a.updating})])};f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};f.prototype.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",e),c.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};f.prototype._tileGeometryChanged=function(a){this._tileGeometryUpdateSpatialReference=a.spatialReference;c.expand(this._tileGeometryUpdateExtent,
a.tile.extent);this._set("updating",!0)};f.prototype._furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaces[0],b=1;b<this.centerOnSurfaces.length;b++){var c=this.centerOnSurfaces[b];c.distance>a.distance&&(a=c)}return a};f.prototype._centerIntersectsExtent=function(a,b){var d=this.state.camera.eye,e=r,f=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(d,p,b);this.renderCoordsHelper.fromRenderCoords(f.renderLocation,q,b);p[0]<q[0]?(e[0]=p[0],e[2]=q[0]):(e[0]=q[0],
e[2]=p[0]);p[1]<q[1]?(e[1]=p[1],e[3]=q[1]):(e[1]=q[1],e[3]=p[1]);return c.intersects(e,a)};m([l.property({constructOnly:!0})],f.prototype,"state",void 0);m([l.property({constructOnly:!0})],f.prototype,"centerOnSurfaces",void 0);m([l.property({constructOnly:!0})],f.prototype,"renderCoordsHelper",void 0);m([l.property({constructOnly:!0})],f.prototype,"scheduler",void 0);m([l.property({constructOnly:!0})],f.prototype,"surface",void 0);m([l.property({readOnly:!0})],f.prototype,"updating",void 0);return f=
m([l.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],f)}(l.declared(h));a.SurfaceGeometryUpdates=n;var e={},p=f.vec3f64.create(),q=f.vec3f64.create(),r=c.empty();a.default=n})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/LercWorker ../../../layers/support/TilemapCache ../../2d/engine/vectorTiles/VectorTileDisplayObject ../support/debugFlags ../support/geometryUtils ../support/projectionUtils ./ElevationBounds ./ElevationData ./ElevationTileAgent ./MapTileAgent ./OverlayManager ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./Tile ./TilemapOnlyTile ./tileUtils ./tileUtils ./UpsampleInfo ../../support/index ../../webgl/Texture ../../webgl/Util @dojo/framework/shim/Promise".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L,R,O,T,U,P,V,W,Q,Z,X,aa,da,ga,ca,ia,ba,oa,ha,la){function ra(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function va(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var f=0;f<e.layerInfo.length;f++)for(var g=0,h=e.layerInfo[f];g<h.length;g++){var l=h[g].upsampleFromTile;if(l&&l.tile===b)return!0}c=c||va(e,b)}}return c}function ja(a){return a.isLeaf?!1:a.children[0].shouldRender||a.children[1].shouldRender||
a.children[2].shouldRender||a.children[3].shouldRender||ja(a.children[0])||ja(a.children[1])||ja(a.children[2])||ja(a.children[3])}var pa=p.getLogger("esri.views.3d.terrain.TerrainSurface");a=function(a){function b(b,c){c=a.call(this)||this;c.defaultTileBackground=Z.DEFAULT_TILE_BACKGROUND;c.hideSkirtsDistanceFromExtentMargin=C;c.hideSkirtsMinimumCameraTilt=ua;c.hideSkirtsMaximumCameraTilt=wa;c._clippingExtent=null;c._dataExtent=null;c._elevationBounds=new L.ElevationBounds;c._rootExtent=F.create();
c._iteratorPool=new w(ia.IteratorPreorder);c._postorderIterator=new ia.IteratorPostorder;c._visible=!1;c._pendingUpdates=!1;c._asyncWorkItems=0;c._usedMemory=D;c._isFrameProcessing=!1;c._viewChangeUpdateDirty=!1;c._overlayOpacity=1;c._eyePosRenderSR=B.vec3f64.create();c._eyePosSurfaceSR=B.vec3f64.create();c._splitLimits=new da.SplitLimits;c._snapLevel=Infinity;c._frustum=J.frustum.create();c._viewProjectionMatrix=A.mat4f64.create();c._layerViews=[[],[]];c._layerIndexByLayerViewId=[new Map,new Map];
c._basemapLayerViewHandles=new Map;c._handles=new e;c._lowPrioUpdates=new u;c._topLevelTilemapOnlyTiles=[];c._upsampleInfoPool=new w(ba);c._visibleLevels=new u({deallocator:null});c._getElevationData={spatialReference:null,rootTiles:null};c.maxTextureScale=1.2;c.rootTiles=null;c.backgroundImage=Z.DEFAULT_TILE_BACKGROUND;c.backgroundColor=null;c._scheduledLayerViewChangesHandle=null;c._lercWorker=K.acquireInstance(b.resourceController.scheduler);return c}k(b,a);b.prototype.normalizeCtorArgs=function(a,
b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};b.prototype.initialize=function(){var a=this;this._tilePool="planar"===this.manifold?new w(P.PlanarPatch):new w(V.SphericalPatch);this._memCache=this._view.resourceController.memoryController.getMemCache("esri.views.3d.terrain",function(b){return a._renderer.releaseTileGeometry(b.renderData)});this._renderer=new X({manifold:this.manifold,memCache:this._memCache});this._renderer.install(this._view._stage);t.init(this,"_background",
function(){a._renderer.setTileBackground(a._background)});this._handles.add([this._view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}),t.init(I,"TERRAIN_TILE_TREE_SHOW_TILES",function(b){b&&!a._treeDebugger?(new Promise(function(a,b){n(["../layers/support/TerrainTileTree3DDebugger"],a,b)})).then(function(b){b=b.TerrainTileTree3DDebugger;!a._treeDebugger&&I.TERRAIN_TILE_TREE_SHOW_TILES&&(a._treeDebugger=new b({view:a._view}))}):b||!a._treeDebugger||I.TERRAIN_TILE_TREE_SHOW_TILES||
(a._treeDebugger.destroy(),a._treeDebugger=null)})]);this._set("overlayManager",new U.OverlayManager({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",function(b){return a._handleHasHighlights(b)}),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new W.SurfaceExtentHelperGlobal(b):new W.SurfaceExtentHelperLocal(b);
this._handles.add(t.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this._view.defaultsFromMap?new c({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new Q({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",
this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataRequester=this._view.resourceController.createStreamDataRequester(0);this._handles.add(this._view.resourceController.scheduler.registerTask(oa.Task.TERRAIN_SURFACE,function(b){return a._frame(b)},function(){return a.updating}));this._view.resourceController.memoryController.events.on("quality-changed",
function(){return a._viewChangeUpdate()});this._handles.add([this._view.on("resize",function(){return a._viewChangeUpdate()}),this._view.watch("state.camera",function(){return a._viewChangeUpdate()},!0),this._view.watch("qualitySettings.tiledSurface.lodBias",function(){return a._viewChangeUpdate()}),this._view.watch("qualitySettings.tiledSurface.reduceTileLevelDifferences",function(){return a._viewChangeUpdate()}),this._view.watch("clippingArea",function(){return a._clippingChanged()})]);this._handles.add(this._view.allLayerViews.on("after-changes",
function(){return a._scheduleLayerViewChangesUpdate()}));this._handleLayerViewChanges();this._updateClippingExtent();this.notifyChange("extent")};b.prototype.destroy=function(){var a=this;this._handles.destroy();K.releaseInstance(this._lercWorker);this._lercWorker=null;this._removeAllTiles();this._memCache.destroy();this._memCache=null;this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;this._basemapLayerViewHandles.forEach(function(b,
c){return a._unregisterTiledLayerView(c)});this._streamDataRequester=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();this._tilePool=null;O.Pool.prune(0);T.Pool.prune(0);this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer.uninstall(this._stage);this._renderer.destroy();this._renderer=null;this._iteratorPool.destroy();this._stage=this._view=this._iteratorPool=null;this._upsampleInfoPool.destroy();
this._upsampleInfoPool=null};Object.defineProperty(b.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"snapLevel",{get:function(){return Math.round(this._snapLevel)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!(!(this._pendingUpdates||this._renderer.updating||this._scheduledLayerViewChangesHandle)||!this.ready||this._get("suspended"))},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"baseOpacity",{set:function(a){var b=this._renderer.opaque;this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(b!==this._renderer.opaque)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:
this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"slicePlaneEnabled",{set:function(a){this._renderer.slicePlaneEnabled=a;this._set("slicePlaneEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOvergroundEnabled=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);
this._set("wireframe",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{set:function(a){a!==this._visible&&(this._visible=a,this._renderer.setVisibility(a),this.suspended=!a)},enumerable:!0,configurable:!0});b.prototype.isOpaque=function(){return this._renderer.opaque};Object.defineProperty(b.prototype,"suspended",{set:function(a){this._set("suspended",a);this._viewChangeUpdate()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"reduceTileLevelDifferences",
{get:function(){return this._view.qualitySettings.tiledSurface.reduceTileLevelDifferences},enumerable:!0,configurable:!0});b.prototype.intersect=function(a,b,c,d){this._renderer.intersect(a,b,c,d,null)};b.prototype.getElevation=function(a){var b=this._getElevationData.rootTiles;if(!b||!b.length||0===b[0].layerInfo[0].length)return null;var c=qa;if(Array.isArray(a))c=a;else if("point"===a.type&&!M.pointToVector(a,c,this._getElevationData.spatialReference))return pa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;for(var d=0;d<b.length;d++)if(a=b[d],a.containsPoint(c)){for(;a&&!a.rendered&&!a.isLeaf;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];if(b=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null)return R.sample(c[0],c[1],b);break}return null};Object.defineProperty(b.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});b.prototype.getScale=function(a){if(this.tilingScheme){if(!M.pointToVector(a,
qa,this.spatialReference))return pa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;var b=this.rootTiles;if(b)for(var c=0;c<b.length;c++)if(a=b[c],a.containsPoint(qa)){for(;null!=a.children[0];)b=0,qa[0]>a.children[0].extent[2]&&(b+=1),qa[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.level)}}return 1E100};b.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):
0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};b.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=a&&!F.equals(a,this._dataExtent);b&&(this._dataExtent?F.set(this._dataExtent,a):this._dataExtent=F.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(aa.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),
this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize),this.overlayManager.setSpatialReference(a.spatialReference,"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};b.prototype._acquireTile=function(a,b,c,d){var e=this._tilePool.acquire();S[0]=a;S[1]=b;S[2]=c;e.init(S,d,this);return e};b.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){this._memCache.clear();
var d=na,e=c.rootTilesInExtent(b,d,Infinity),f=function(b){b=a._acquireTile(0,b[1],b[2],null);1===b.shouldSplit(a._splitLimits,a._eyePosRenderSR,0)&&b.setPendingUpdate(1);a._loadTile(b);return b};if(this.rootTiles){if(e.length>Z.MAX_ROOT_TILES){pa.warn(Z.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),g=l.difference(b,e,ra);if(0<g.removed.length||0<g.added.length){var h=this.rootTiles.filter(function(b){return-1<l.findIndex(g.removed,ra.bind(null,
b.lij))?(a._purgeTile(b),!1):!0});g.added.forEach(function(a){return h.push(f(a))});this._setRootTiles(h)}}else e.length>Z.MAX_ROOT_TILES&&(pa.warn(Z.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),e=c.rootTilesInExtent(b,d,Z.MAX_ROOT_TILES)),this._setRootTiles(e.map(function(a){return f(a)}));F.equals(d,this._rootExtent)||(this._rootExtent=F.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};
b.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles);this._updateTiles(a)};b.prototype._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};b.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._isFrameProcessing?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),
this._updateSkirts(),this.updateOverlayOpacity(),this._updateTiles(this.rootTiles)))};b.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(16)&&this._updateTileGeometry(a)};b.prototype._updateTiles=function(a){if(a){var b=this._iteratorPool.acquire();b.reset(a);var c;ca.hasVisibleSiblings(a)?(a=this._elevationBounds.min,c=this._elevationBounds.max):(a=Infinity,c=-Infinity);for(;!b.done;){var d=b.next();this._updateClippingStatus(d);d.updateVisibility();
d.setPendingUpdate(8);if(d.visible){d.updateScreenDepth(this._viewProjectionMatrix);d.renderData&&(a=Math.min(d.elevationBounds[0],a),c=Math.max(d.elevationBounds[1],c));var e=d.shouldSplit(this._splitLimits,this._eyePosRenderSR,0);if(1===e){d.resetPendingUpdate(4);d.isLeaf&&(d.setPendingUpdate(1),b.skipSubtree());this._pendingUpdates=this._pendingUpdates||d.updating;continue}d.resetPendingUpdate(1)&&d.updateAgentSuspension();2===e&&d.updateAgents(0)}b.skipSubtree();if(!d.isLeaf){d.setPendingUpdate(4);
d.resetPendingUpdate(1);e=this._iteratorPool.acquire();for(e.resetOne(d);!e.done;){var f=e.next();this._updateClippingStatus(f);f.updateVisibility();f.visible&&f.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(e)}this._pendingUpdates=this._pendingUpdates||d.updating}this._iteratorPool.release(b);isFinite(a)&&isFinite(c)&&(this._elevationBounds.min!==a||this._elevationBounds.max!==c)&&(this._elevationBounds.min=a,this._elevationBounds.max=c,this.emit("elevation-bounds-change",
null))}};b.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias())*a.pixelRatio;this._splitLimits.aboveGround=a.aboveGround;this._splitLimits.fovX=b;this._splitLimits.fovY=c;this._splitLimits.relativeWidthLimit=d/a.width*this.maxTextureScale*e;this._splitLimits.relativeHeightLimit=d/a.height*this.maxTextureScale*e;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();
this._splitLimits.angledSplitBias=this._view.qualitySettings.tiledSurface.angledSplitBias;J.frustum.copy(a.frustum,this._frustum);z.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);E.vec3.copy(this._eyePosRenderSR,a.eye);M.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};b.prototype._updateSnapLevel=function(){if(this.reduceTileLevelDifferences){var a=I.TESTS_DISABLE_UPDATE_THRESHOLDS?0:.1,b=this._findSnapLevel();
Math.abs(this._snapLevel-b)<a||(a=this._snapLevel,this._snapLevel=b,a!==this._snapLevel&&this._updateTiles(this.rootTiles))}};b.prototype._findSnapLevel=function(){if(0>=this._visibleLevels.length)return this._snapLevel;var a=this._visibleLevels,b=Math.round(a.length*(Math.abs(this._view.camera.tilt-90)/90*.4+.3));if(b>=a.length)return this._snapLevel;a.sort(function(a,b){return a-b});for(var c=0,d=b;d<a.length;++d)c+=a.getItemAt(d);d=a.getItemAt(Math.round(.95*a.length)-1);b=c/(a.length-b);a.clear();
return Math.max(b,d-1)};b.prototype._updateSkirts=function(){aa.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};b.prototype._updateRender=function(a){a.rendered&&!a.shouldRender&&(ja(a)?this._loadChildren(a):a.isLeaf&&a.parent&&a.parent.shouldRender&&this._loadParent(a))};b.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);this._elevationUpdate(a);this._usedMemory=D};b.prototype._elevationUpdate=function(a){Ea.spatialReference=
this.spatialReference;Ea.tile=a;Ea.extent=a.extent;this.emit("elevation-change",Ea);F.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};b.prototype._frame=function(a){var b=this;this._isFrameProcessing=!0;this._frameTraversal(a);a.run(function(){ca.sortTiles(b._renderer.renderOrder,b._lowPrioUpdates);return!1});a.run(function(){return b._processElevation(a)});a.run(function(){return b._processTextures(a)});0!==this._asyncWorkItems&&(this._pendingUpdates=!0);this._lowPrioUpdates.clear();
this._isFrameProcessing=!1;this._runViewChangeUpdateIfDirty();this.notifyChange("updating")};b.prototype._frameTraversal=function(a){var b=this;if(!this.suspended&&this._pendingUpdates){this._pendingUpdates=!1;this._lowPrioUpdates.clear();var c=this._iteratorPool.acquire(),d=this._eyePosRenderSR;c.reset(this.rootTiles,d);var e=0,f=!1,g=!1,h=[];this._visibleLevels.clear();for(var l=function(){},k=this.reduceTileLevelDifferences?function(a){a.visible&&1!==a.shouldSplit(b._splitLimits,d,1)&&a.parent&&
1===a.parent.shouldSplit(b._splitLimits,d,1)&&b._visibleLevels.push(a.level)}:l;!c.done&&!a.done;){var p=c.next(),e=e+p.usedMemory;k(p);p.resetPendingUpdate(4)?(this._mergeTile(p),g=!0,a.madeProgress(),c.skipSubtree()):p.resetPendingUpdate(1)&&(this._splitTile(p)&&h.push(p),f=!0,a.madeProgress());p.resetPendingUpdate(8)&&(this._updateRender(p),a.madeProgress());p.hasPendingUpdates&&this._lowPrioUpdates.push(p);this._pendingUpdates=this._pendingUpdates||p.updating;c.done&&(c.reset(h),h.length=0,k!==
l&&(this._updateSnapLevel(),k=l))}this._pendingUpdates=this._pendingUpdates||!c.done||0<this._lowPrioUpdates.length;f||g?this._treeDebugger&&this._treeDebugger.update():c.done&&(this._usedMemory=e);this._iteratorPool.release(c);this._visibleLevels.clear()}};b.prototype._processElevation=function(a){var b=this;this._lowPrioUpdates.some(function(c){if(a.done)return!0;c.resetPendingUpdate(16)&&(b._updateTileGeometry(c),a.madeProgress());return!1});return a.hasProgressed};b.prototype._processTextures=
function(a){var b=this;this._lowPrioUpdates.some(function(c){if(a.done)return!0;c.resetPendingUpdate(32)&&(b._renderer.updateTileTexture(c),b._usedMemory=D,a.madeProgress());return!1});return a.hasProgressed};b.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=F.create(),b=null;M.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(b=a);if(F.equals(b,this._clippingExtent))return!1;this._memCache.clear();this._clippingExtent=b;this._renderer.clippingExtent=
b;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};b.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};b.prototype._getLodBias=function(){return this._view.qualitySettings.tiledSurface.lodBias-(1-this._view.resourceController.memoryController.memoryFactor)*Z.MAX_MEMORY_LOD_BIAS};b.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=q.clamp(a-this._getLodBias(),
0,b.length-1);var c=a-Math.floor(a);return b[Math.floor(a)].scale*(1-c)+b[Math.ceil(a)].scale*c};b.prototype._cancelTilemapRequests=function(a){var b=0;for(a=a.layerInfo;b<a.length;b++){var c=a[b];if(c)for(var d=0;d<c.length;d++)c[d].abortTilemapRequest()}};b.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){return a._purgeTile(b)}),this._setRootTiles(null),this.notifyChange("ready"));for(var b=0,c=this._topLevelTilemapOnlyTiles;b<c.length;b++){var d=
c[b];r.isSome(d)&&this._cancelTilemapRequests(d)}this.visible=!1};b.prototype._purgeChildTiles=function(a){if(a.isLeaf)return!1;var b=this._purgeTile(a.children[0]),b=this._purgeTile(a.children[1])||b,b=this._purgeTile(a.children[2])||b,b=this._purgeTile(a.children[3])||b;a.unsetChildren();return b};b.prototype._purgeTile=function(a){var b=this._purgeChildTiles(a)||a.rendered;a.unload(this._renderer);this._cancelTilemapRequests(a);a.dispose();this._tilePool.release(a);return b};b.prototype._splitTile=
function(a){aa.weakAssert(a.isLeaf,"tile that is already split should not be split again!");var b=a.level+1,c=2*a.lij[1],d=2*a.lij[2];a.setChildren(this._createTile(b,c,d,a),this._createTile(b,c,d+1,a),this._createTile(b,c+1,d,a),this._createTile(b,c+1,d+1,a));a.setPendingUpdate(8);a.updateAgentSuspension();Fa.spatialReference=this.spatialReference;Fa.extent=a.extent;Fa.scale=this._getLodBiasCorrectedScale(b);this._pendingUpdates=!0;this.emit("scale-change",Fa);return a.children[0].hasPendingUpdate(1)||
a.children[1].hasPendingUpdate(1)||a.children[2].hasPendingUpdate(1)||a.children[3].hasPendingUpdate(1)};b.prototype._createTile=function(a,b,c,d){aa.weakAssert(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),1===a.shouldSplit(this._splitLimits,this._eyePosRenderSR,0)&&a.setPendingUpdate(1));return a};b.prototype._mergeTile=function(a){aa.weakAssert(!a.hasPendingUpdate(1),"_mergeTile sanity check");
this._purgeChildTiles(a)&&(aa.weakAssert(!a.renderData,"_mergeTile sanity check"),this._loadTile(a));Fa.spatialReference=this.spatialReference;Fa.extent=a.extent;Fa.scale=this._getLodBiasCorrectedScale(a.level);this._pendingUpdates=!0;this.emit("scale-change",Fa)};b.prototype._loadChildren=function(a){aa.weakAssert(a.rendered,"parent should be rendered");a.unload(this._renderer);this._loadTile(a.children[0]);this._loadTile(a.children[1]);this._loadTile(a.children[2]);this._loadTile(a.children[3])};
b.prototype._loadParent=function(a){a=a.parent;this._unloadChildren(a);this._loadTile(a)};b.prototype._unloadChildren=function(a){a.isLeaf||(this._unloadChildren(a.children[0]),a.children[0].unload(this._renderer),this._unloadChildren(a.children[1]),a.children[1].unload(this._renderer),this._unloadChildren(a.children[2]),a.children[2].unload(this._renderer),this._unloadChildren(a.children[3]),a.children[3].unload(this._renderer))};b.prototype._loadTile=function(a){a.load(this._renderer);a.setPendingUpdate(8);
this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};b.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};b.prototype._elevationDataUpdated=function(a,b){var c=a.layerInfo[0][b],d=[a],e=a.level,f=this._iteratorPool.acquire();for(f.reset(d);!f.done;){var g=f.next();g.findElevationBoundsForLayer(b,e);g.computeElevationBounds()}this._iteratorPool.release(f);a.dataArrived(b,
0,c.data);this._updateTiles(d)};b.prototype._scheduleLayerViewChangesUpdate=function(){var a=this;this._scheduledLayerViewChangesHandle||(this._scheduledLayerViewChangesHandle=y.schedule(function(){return a._handleLayerViewChanges()}),this._handles.add(this._scheduledLayerViewChangesHandle,"scheduledLayerViewChangesHandle"))};b.prototype._handleLayerViewChanges=function(){var a=this;this._handles.remove("scheduledLayerViewChangesHandle");this._scheduledLayerViewChangesHandle=null;for(var b=!1,c=new Set,
d=-1,e=0,f=this._view.allLayerViews.items;e<f.length;e++){var g=f[e];c.add(g.uid);if(aa.isTiledLayerView(g))if(this._basemapLayerViewHandles.has(g.uid)){var h=this.layerClassFromLayerView(g),g=this._layerIndexByLayerViewId[h].get(g.uid);g<d&&(b=!0);d=g}else this._registerTiledLayerView(g),g.layer.loaded&&(b=!0)}this._basemapLayerViewHandles.forEach(function(d,e){c.has(e)||(a._unregisterTiledLayerView(e),b=!0)});this.overlayManager&&this.overlayManager.updateLayerViews(c);b&&this._updateTiledLayers()};
b.prototype.layerClassFromLayerView=function(a){return aa.isElevationLayerView(a)?0:1};b.prototype._registerTiledLayerView=function(a){var b=this,c=[],d=this.layerClassFromLayerView(a);c.push(a.watch("suspended",function(){return b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures(!1)}));c.push(a.layer.watch("scaleRangeId",function(){return b._restartAllAgents(d)}));a.on("data-changed",function(){var c=b._layerIndexByLayerViewId[d].get(a.uid);null!=c&&b._invalidateLayerData(c,
d)});this._basemapLayerViewHandles.set(a.uid,c)};b.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles.get(a);if(b){for(var c=0;c<b.length;c++)b[c].remove();this._basemapLayerViewHandles.delete(a)}};b.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme&&!this._view.suspended){var b=this._view.allLayerViews,c=[[],[]],d=null,e=F.empty();b.forEach(function(b){var f=b.layer;if(f&&!b.suspended&&aa.isTiledLayerView(b)){var g=b.fullExtent;g?a.tilingScheme.compatibleWith(b.tileInfo)?
(F.expand(e,g),f=a.layerClassFromLayerView(b),1===f&&(g=b.displayLevelRange,Infinity!==g.maxLevel&&(null===d||g.maxLevel>d)&&(d=g.maxLevel)),c[f].push(b)):pa.warn("Terrain: tiling scheme of layer "+f.id+" is incompatible with other tiled layers, will not be drawn"):pa.warn("Terrain: Map or elevation layer does not have fullExtent: "+f.id)}});for(b=0;2>b;b++){var f=this._layerViews[b],g=c[b];g.reverse();var h=g.length,l=f.length!==h,k=Array(h),p=Array(f.length);this._layerIndexByLayerViewId[b].clear();
for(var m=0;m<h;m++){this._layerIndexByLayerViewId[b].set(g[m].uid,m);var q=f.indexOf(g[m]);k[m]=q;m!==q&&(l=!0);-1<q&&(p[q]=m)}if(l){f=0;for(h=this._topLevelTilemapOnlyTiles;f<h.length;f++)l=h[f],r.isSome(l)&&l.modifyLayers(p,k,b);f=this._postorderIterator;for(f.reset(this.rootTiles);!f.done;)f.next().modifyLayers(p,k,b);this._layerViews[b]=g;0===b&&this._memCache.clear();this._restartAllAgents(b);this._updateTiles(this.rootTiles)}}this.tilingScheme.ensureMaxLod(d)&&this._viewChangeUpdate()}};b.prototype._restartAllAgents=
function(a){var b=this._postorderIterator;for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.restartAgents(a);0===a&&c.computeElevationBounds()}};b.prototype._hasFixedExtent=function(){return!!this._clippingExtent};b.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};b.prototype.numLayers=function(a){return this._layerViews[a].length};b.prototype._updateTileTextures=function(a){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.updateAgents(1);
a?this.renderer.updateTileTexture(c):c.updateRenderData(1)}this._iteratorPool.release(b)};b.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c);0===b&&this._memCache.clear()};b.prototype.requestRender=function(a){void 0===a&&(a=1);this.renderer.setNeedsRender(a)};b.prototype.setPendingUpdates=function(){this._pendingUpdates||
(this._pendingUpdates=!0,this.notifyChange("updating"))};b.prototype.requestTileData=function(a,b,c,d){var e=this,f=this.layerViewByIndex(b,c),g=f.layer;if(g.tilemapCache&&!aa.isVectorTileLayerView(f)){var h=this.getTilemapTile(a),l=h.layerInfo[c][b];if(l.tilemap){if(!h.hasDataAvailable(a,b,c))return this._dispatchDataEvent(a,"dataMissing",c,f,{notInTilemap:!0}),v.reject()}else return l.tilemapRequestPromise||(l.tilemapRequestAbort=v.createAbortController(),l.tilemapRequestPromise=this.requestTilemap(h,
b,c,f,g,{signal:l.tilemapRequestAbort.signal})),++this._asyncWorkItems,l.tilemapRequestPromise.catch(function(){}).then(function(){--e._asyncWorkItems;l.tilemapRequestPromise=null;l.tilemapRequestAbort=null;v.throwIfAborted(d);var b=e._layerIndexByLayerViewId[c].get(f.uid);if(null!=b){if(h.hasDataAvailable(a,b,c))return e._requestTileData(a,b,c,f,d);e._dispatchDataEvent(a,"dataMissing",c,f,{notInTilemap:!0});return v.reject()}})}return this._requestTileData(a,b,c,f,d)};b.prototype._requestTileData=
function(a,b,c,d,e){return 0===c?this._requestElevationTileData(a,b,c,d,e):this._requestMapTileData(a,c,d,e)};b.prototype._requestElevationTileData=function(a,b,c,d,e){var f=this;if(aa.isElevationLayerView(d)){var g=function(e){--f._asyncWorkItems;var g=f._layerIndexByLayerViewId[c].get(d.uid);null==g?pa.warn("TerrainSurface: received data from unknown layer %d %s",c,a.lij.toString()):(f._usedMemory=D,f._pendingUpdates=!0,a.layerInfo[c][g].data=R.create(a.lij,a.extent,e),f._elevationDataUpdated(a,
b))},h=function(b){--f._asyncWorkItems;v.isAbortError(b)||f._dispatchDataEvent(a,"dataMissing",c,d,b)};++this._asyncWorkItems;if(aa.useFetchTileForLayer(d.layer))return d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],{noDataValue:Z.ELEVATION_NODATA_VALUE,signal:e.signal}).then(function(a){return g(a)},h);var l=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);return this._streamDataRequester.request(l,"binary",e).then(function(a){return f._lercWorker.decode(a,{noDataValue:Z.ELEVATION_NODATA_VALUE},e.signal)}).then(function(a){g({values:a.pixelData,
width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})}).catch(function(a){return h(a)})}aa.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};b.prototype._requestMapTileData=function(a,b,c,d){var e=this;++this._asyncWorkItems;var g=function(d){--e._asyncWorkItems;e._dispatchDataEvent(a,"dataArrived",b,c,d)},h=function(d){--e._asyncWorkItems;v.isAbortError(d)||e._dispatchDataEvent(a,"dataMissing",b,c,d)};if(aa.isVectorTileLayerView(c)){var l=
c.tileHandler,k=c.schemaHelper.getLevelRowColumn(a.lij);return f.safeCast(l.getVectorTile(k[0],k[1],k[2])).then(function(a){v.isAborted(d)?--e._asyncWorkItems:g(a)},h)}if(aa.useFetchTileForLayer(c.layer)&&aa.isTileLayerView(c))return c.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],d).then(g,h);l=c.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=c.refreshInterval&&c.refreshTimestamp&&(l+=(-1<l.indexOf("?")?"\x26":"?")+"_ts\x3d"+c.refreshTimestamp);return this._streamDataRequester.request(l,"image",d).then(g,
h)};b.prototype.requestTilemap=function(a,b,c,d,e,f){var g=this;return e.tilemapCache.fetchTilemap(a.lij[0]+H.TILEMAP_SIZE_EXP,Math.round(a.lij[1]*Math.pow(2,H.TILEMAP_SIZE_EXP)),Math.round(a.lij[2]*Math.pow(2,H.TILEMAP_SIZE_EXP)),m({},f,{timeout:6E3})).then(function(e){b=g._layerIndexByLayerViewId[c].get(d.uid);null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(a){})};b.prototype.getTilemapTile=function(a){var b=a.level;if(b>H.TILEMAP_SIZE_EXP)return ca.getTileNLevelsUp(a,H.TILEMAP_SIZE_EXP);
var c=this._topLevelTilemapOnlyTiles[b];if(r.isSome(c))return c;a=ca.getRootTile(a);c=H.TILEMAP_SIZE_EXP-b+a.level;c=new ga([b-H.TILEMAP_SIZE_EXP,a.lij[1]/Math.pow(2,c),a.lij[2]/Math.pow(2,c)],this._upsampleInfoPool,[this._layerViews[0].length,this._layerViews[1].length]);return this._topLevelTilemapOnlyTiles[b]=c};b.prototype._dispatchDataEvent=function(a,b,c,d,e){d=this._layerIndexByLayerViewId[c].get(d.uid);if(null!=d)a[b](d,c,e);else pa.warn("TerrainSurface: received data from unknown layer")};
b.prototype.updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};b.prototype.updateOverlayOpacity=function(){if(this.overlayManager){var a=this.overlayManager.updateOpacity(this._eyePosSurfaceSR[2]);if(!isNaN(a)&&a!==this._overlayOpacity){var b=
this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b);this._overlayOpacity=a;this._renderer.setNeedsRender()}}};b.prototype.getStats=function(){var a={numNodes:0,numLeaves:0,numVisible:0,numRendered:0,numVisiblePerLevel:[],numLoadedPerLevel:[]},b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();a.numNodes++;c.isLeaf&&a.numLeaves++;var d=c.level;c.rendered&&(a.numRendered++,
a.numLoadedPerLevel[d]=(a.numLoadedPerLevel[d]||0)+1);c.visible&&(a.numVisible++,a.numVisiblePerLevel[d]=(a.numVisiblePerLevel[d]||0)+1)}this._iteratorPool.release(b);return a};b.prototype.getUsedMemory=function(){if(!this.tilingScheme)return 0;if(this._usedMemory===D){var a=this._iteratorPool.acquire();a.reset(this.rootTiles);for(this._usedMemory=0;!a.done;){var b=a.next();this._usedMemory+=b.usedMemory}this._iteratorPool.release(a)}return this._usedMemory};b.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};
var a=0,b=0,c=0,d=this._iteratorPool.acquire();d.reset(this.rootTiles);for(var e=this.tilingScheme.pixelSize,e=e*e*4;!d.done;){for(var f=d.next(),g=va(f),h=0,l=f.layerInfo[1];h<l.length;h++){var k=l[h],k=k.data,p=0,m=0;k instanceof ha?p+=la.getGpuMemoryUsage(k):k instanceof HTMLImageElement?m+=e:k instanceof N&&(c+=k.getMemoryUsage());f.renderData||g?(a+=m,a+=p):(b+=m,b+=p)}g=0;for(h=f.layerInfo[0];g<h.length;g++)k=h[g],k=k.data,a+=k?e:0;f.renderData&&(k=f.renderData.textureDescriptor,a+=k?la.getGpuMemoryUsage(k):
0,f=f.renderData.estimatedGeometryMemoryUsage,c+=f,c+=f)}this._iteratorPool.release(d);return{visibleImageData:a,invisibleImageData:b,geometryData:c}};b.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return l.find(this.rootTiles,function(a){return a.lij[1]===b[1]&&a.lij[2]===b[2]});var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),e=Math.floor(b[2]/c),f;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(f=a,!0):!1});if(f){for(c=1<<b[0]-1;f.lij[0]<
b[0];){var g=b[1]&c?2:0;0<(b[2]&c)&&g++;if(!f.children[g])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+ca.tile2str(f)),null;f=f.children[g];c>>=1}aa.weakAssert(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};b.prototype.setBorders=function(a){this._renderer.renderPatchBorders=a};b.prototype.setDisableRendering=function(a){this._renderer.renderingDisabled=a};b.prototype.getRenderedTiles=function(){Ca.clear();var a=this._iteratorPool.acquire();
for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.visible&&b.rendered&&Ca.push(b)}this._iteratorPool.release(a);ca.sortTiles(this.renderOrder,Ca);return Ca.toArray()};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,lercWorker:this._lercWorker,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)}}},enumerable:!0,configurable:!0});h([x.property()],b.prototype,"_renderer",void 0);h([x.property({value:!1})],
b.prototype,"cullBackFaces",null);h([x.property({readOnly:!0})],b.prototype,"extent",null);h([x.property({readOnly:!0,dependsOn:["ready","_renderer.updating","_scheduledLayerViewChangesHandle"]})],b.prototype,"updating",null);h([x.property({value:1})],b.prototype,"baseOpacity",null);h([x.property({readOnly:!0})],b.prototype,"overlayManager",void 0);h([x.property({readOnly:!0})],b.prototype,"manifold",void 0);h([x.property()],b.prototype,"maxTextureScale",void 0);h([x.property({readOnly:!0})],b.prototype,
"ready",null);h([x.property({value:1})],b.prototype,"renderOrder",null);h([x.property({readOnly:!0})],b.prototype,"rootTiles",void 0);h([x.property({value:!0})],b.prototype,"skirtScale",null);h([x.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],b.prototype,"spatialReference",null);h([x.property({})],b.prototype,"backgroundImage",void 0);h([x.property({type:d})],b.prototype,"backgroundColor",void 0);h([x.property({dependsOn:["backgroundColor","backgroundImage"]})],b.prototype,
"_background",null);h([x.property({value:!1})],b.prototype,"slicePlaneEnabled",null);h([x.property({readOnly:!0})],b.prototype,"tilingScheme",void 0);h([x.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],b.prototype,"tilingSchemeLocked",void 0);h([x.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],b.prototype,"tilingSchemeDone",void 0);h([x.property({readOnly:!0})],b.prototype,"tilingSchemeLogic",void 0);h([x.property({value:!0})],b.prototype,"velvetOverground",
null);h([x.property({value:!1})],b.prototype,"wireframe",null);h([x.property({value:!1})],b.prototype,"suspended",null);h([x.property()],b.prototype,"_scheduledLayerViewChangesHandle",void 0);return b=h([x.subclass("esri.views.3d.terrain.TerrainSurface")],b)}(x.declared(b.EventedMixin(g)));var C=1.2,ua=80/180*Math.PI,wa=110/180*Math.PI,D=-1,qa=G.vec4f64.create(),na=F.create(),S=[0,0,0],Ca=new u,Ea={spatialReference:null,tile:null,extent:null,context:"ground"},Fa={spatialReference:null,extent:null,
scale:0};return a})},"esri/layers/support/LercWorker":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/extendsHelper ../../core/promiseUtils ../../core/requireUtils ../../core/workers module".split(" "),function(n,a,m,k,h,d,g,l){function f(){return h.create(function(a){return n(["./rasterFormats/LercCodec"],a)})}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(){}a.prototype._decode=function(a){return f().then(function(b){b=b.decode;
b=b(a.buffer,a.options);return{result:b,transferList:[b.pixelData.buffer]}})};return a}(),b=function(a){function b(b){var c=a.call(this)||this;c.scheduler=b;c._threadInitialized=h.create(function(a,e){g.open(d.getAbsMid("./LercWorker",n,l),{strategy:"dedicated",scheduler:b}).then(function(b){void 0===c._thread?(c._thread=b,a()):(b.close(),e())})});return c}k(b,a);b.prototype.destroy=function(){this._thread&&this._thread.close();this._thread=null};Object.defineProperty(b.prototype,"test",{get:function(){return{threadInitialized:this._threadInitialized}},
enumerable:!0,configurable:!0});b.prototype.decode=function(a,b,c){return a&&0!==a.byteLength?this._thread?this._thread.invoke("_decode",{buffer:a,options:b},{transferList:[a],signal:c}):f().then(function(d){d=d.decode;h.throwIfAborted(c);return d(a,b)}):h.resolve(null)};return b}(c);a.LercWorkerMaster=b;var e=new Map;a.acquireInstance=function(a){var c=e.get(a);c||(c={instance:new b(a),ref:0},e.set(a,c));++c.ref;return c.instance};a.releaseInstance=function(a){if(null!=a){a=a.scheduler;var b=e.get(a);
b&&0>=--b.ref&&(b.instance.destroy(),e.delete(a))}};a.default=function(){return new c}})},"esri/views/2d/engine/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/support/spatialReferenceUtils ../../../webgl ../../engine ./RenderBucket".split(" "),function(n,a,m,k,h,d,g,l,f,c){var b="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");
return function(a){function e(){for(var b,c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];e=a.call(this)||this;e._renderBuckets=[];e._vectorTileData=null;e._symbolUpdateData=null;e._memoryUsed=-1;e.coords=[0,0];e.bounds=[0,0,0,0];e.tileTransform={transform:h.mat4f32.create(),displayCoord:d.vec2f32.create()};e.stencilData={mask:0,reference:0};e._referenced=0;e.triangleCount=0;0<c.length&&(b=e.acquire).call.apply(b,[e].concat(c));return e}m(e,a);Object.defineProperty(e.prototype,"stencilRef",{get:function(){return this.stencilData.reference},
enumerable:!0,configurable:!0});e.prototype.acquire=function(a,b,c,d){this.key=a;this._referenced=1;this._memoryUsed=-1;this._vectorTileData=this._symbolUpdateData=null;var e=b.lodAt(a.level),e=null!==e?e.resolution:0,f=b.size[0]*e,h=b.origin,l=a.col*f,k=a.row*f,p=b.spatialReference,m=0;p&&(p._isWrappable?p._isWrappable():p.isWrappable)&&(p=g.getInfo(p),m=p.valid[1]-p.valid[0]);l=h.x+l+a.world*m;h=h.y-k;this.coords[0]=l;this.coords[1]=h;this.bounds[0]=l;this.bounds[1]=h;this.bounds[2]=l+f;this.bounds[3]=
h-f;this.widthInPixels=b.size[1];this.coordRange=4096;this.resolution=e;this.rotation=d;this.styleLayers=c;this.id=a.id};e.prototype.setData=function(a,b,c){this._vectorTileData=a;this.client=b;this.refKeys=c;this._memoryUsed=-1};e.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};e.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender();this._memoryUsed=-1};e.prototype.dispose=function(){for(var a=0,b="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
b.length;a++){var c=b[a];this[c]&&(this[c].dispose(),this[c]=null)}this._renderBuckets.length=0;this._memoryUsed=-1};e.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.attached=!1,this.stage=null,!0):!1};e.prototype.reference=function(){++this._referenced};Object.defineProperty(e.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});e.prototype.getMemoryUsage=function(){var a=this;-1===this._memoryUsed&&(this._memoryUsed=b.reduce(function(b,
c){return a[c]?b+a[c].size:b},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength));return this._memoryUsed/(this._referenced||1)};e.prototype.attach=function(){return this._vectorTileData?(this.ready(),!0):
!1};e.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};e.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null,this._memoryUsed=-1)};e.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,d=0;d<b;){var e=a[d];switch(a[d+1]){case 0:var f=new c.BackgroundRenderBucket;f.layerID=e;this._renderBuckets.push(f);
d+=2;break;case 1:f=new c.FillRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];f.outlineElementStart=a[d+4];f.outlineElementCount=a[d+5];this._renderBuckets.push(f);d+=6;break;case 2:f=new c.LineRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];this._renderBuckets.push(f);d+=4;break;case 3:f=new c.SymbolRenderBucket;f.layerID=e;f.isSDF=0!==a[d+2];var g=d+3,e=a[g];g++;for(var h=0;h<e;h++){var l=a[g],k=a[g+1],p=a[g+2];f.markerPerPageElementsMap.set(l,
[k,p]);g+=3}var m=a[g];g++;for(h=0;h<m;h++)l=a[g],k=a[g+1],p=a[g+2],f.glyphPerPageElementsMap.set(l,[k,p]),g+=3;this._renderBuckets.push(f);d+=5+3*e+3*m;break;case 4:f=new c.CircleRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];this._renderBuckets.push(f);d+=4;break;default:console.error("Bad bucket type!"),d+=2}}};e._createBufferToObject=function(){var a=[];a[1]={create:l.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:l.BufferObject.createVertex,
var:"fillDDVertexBuffer"};a[3]={create:l.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:l.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:l.BufferObject.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:l.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:l.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:l.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:l.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:l.BufferObject.createVertex,
var:"iconVertexBuffer"};a[11]={create:l.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:l.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:l.BufferObject.createVertex,var:"textVertexBuffer"};a[14]={create:l.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:l.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:l.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:l.BufferObject.createIndex,var:"circleIndexBuffer"};return a};e.prototype._createBufferObjects=
function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),c=b.length,d=0;d<c;d+=2){var f=d/2;if(!(0>=b[d+1]||0===this._vectorTileData.bufferData[f].byteLength)){var g=b[d],h=e.bufferToObject[g];h?this[h.var]?this[h.var].setData(this._vectorTileData.bufferData[f]):this[h.var]=h.create(a,35044,this._vectorTileData.bufferData[f]):console.error("Bad buffer type "+g)}}};e.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id);
this.dispose();a.prototype.detach.call(this)};e.prototype.doRender=function(a){if(this.visible&&this.isReady){var b=this.stage.context,c=a.renderer;if(b&&c){this._commitChanges();var d=a.drawphase;this._symbolUpdateData&&(this._updateSymbolData(a,this._symbolUpdateData),this._symbolUpdateData=null);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,f=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==f){var g=this._renderBuckets.length;if(1===d)for(var h=
g-1;0<=h;h--){var l=this._renderBuckets[h],k=e.layers[l.layerID];if(!l||!k)break;1!==l.type&&0!==l.type||!l.hasData()||(this.triangleCount+=c.renderBucket(b,l,a.displayLevel,a.requiredLevel,d,this,k,f))}else for(h=0;h<g;h++){l=this._renderBuckets[h];k=e.layers[l.layerID];if(!l||!k)break;l.hasData()&&(this.triangleCount+=c.renderBucket(b,l,a.displayLevel,a.requiredLevel,d,this,k,f))}}}}};e.prototype._updateSymbolData=function(a,b){if(!b||!b.bucketDataInfo)return!0;a=new Uint32Array(b.bucketDataInfo);
var d=a.length;if(0===d)return!0;this._memoryUsed=-1;if(!this.isReady)return this.requestRender(),!1;for(var e=this.stage.context,f=new Uint32Array(b.bufferDataInfo),g=f.length,h=0,k=0;k<g;k+=2,h++)switch(f[k]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=l.BufferObject.createVertex(e,35044,b.bufferData[h]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=
l.BufferObject.createVertex(e,35044,b.bufferData[h]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=l.BufferObject.createIndex(e,35044,b.bufferData[h]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=l.BufferObject.createVertex(e,35044,b.bufferData[h]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=
l.BufferObject.createVertex(e,35044,b.bufferData[h]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=l.BufferObject.createIndex(e,35044,b.bufferData[h])}b=[];for(e=0;e<this._renderBuckets.length;e++)this._renderBuckets[e]instanceof c.SymbolRenderBucket||b.push(this._renderBuckets[e]);this._renderBuckets=b;for(e=0;e<d;){g=a[e];f=new c.SymbolRenderBucket;f.layerID=g;f.isSDF=0!==a[e+2];this.styleLayers.layers.length>f.layerID&&this.styleLayers.layers[f.layerID].type===
f.type&&b.push(f);var p=e+3,g=a[p];p++;for(h=0;h<g;h++){var k=a[p],m=a[p+1],q=a[p+2];f.markerPerPageElementsMap.set(k,[m,q]);p+=3}var n=a[p];p++;for(h=0;h<n;h++)k=a[p],m=a[p+1],q=a[p+2],f.glyphPerPageElementsMap.set(k,[m,q]),p+=3;e+=5+3*g+3*n}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};e.pool=new k(e);e.bufferToObject=e._createBufferToObject();return e}(f.DisplayObject)})},"esri/views/webgl":function(){define("require exports ./webgl/BufferObject ./webgl/enums ./webgl/FramebufferObject ./webgl/Program ./webgl/Renderbuffer ./webgl/RenderingContext ./webgl/ShaderCompiler ./webgl/Texture ./webgl/VertexArrayObject ./webgl/ProgramCache ./webgl/programUtils ./webgl/context-util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){Object.defineProperty(a,"__esModule",{value:!0});a.BufferObject=m;a.enums=k;a.FramebufferObject=h;a.Program=d;a.Renderbuffer=g;a.RenderingContext=l;a.ShaderCompiler=f;a.Texture=c;a.VertexArrayObject=b;a.ProgramCache=e.ProgramCache;a.createProgram=p.createProgram;a.glslifyDefineMap=p.glslifyDefineMap;a.createContextOrErrorHTML=q.createContextOrErrorHTML})},"esri/views/webgl/enums":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",
{value:!0});a.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(n,a,m,k,h,d,g,l){function f(a,b){switch(a){case 0:return 2*b;case 4:return b/3;case 5:return b-2;case 6:return b-2}return 0}return function(){function a(a,c){var b=this;this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState=
{srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=
[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=g.default(a)?"webgl2":"webgl";this.gl=a;a instanceof
WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=l.loadCapabilities(a,c);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};m("esri-webgl-debug")&&(this.instanceCounter=new h);this._stateTracker=new d.StateTracker({setBlending:function(a){a?(b.setBlendingEnabled(!0),b.setBlendEquationSeparate(a.opRgb,a.opAlpha),b.setBlendFunctionSeparate(a.srcRgb,a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,b.setBlendColor(a.r,a.g,a.b,
a.a)):b.setBlendingEnabled(!1)},setCulling:function(a){a?(b.setFaceCullingEnabled(!0),b.setCullFace(a.face),b.setFrontFace(a.mode)):b.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(b.setPolygonOffsetFillEnabled(!0),b.setPolygonOffset(a.factor,a.units)):b.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(b.setDepthTestEnabled(!0),b.setDepthFunction(a.func)):b.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){b.setStencilTestEnabled(!0);var c=a.function;b.setStencilFunction(c.func,
c.ref,c.mask);a=a.operation;b.setStencilOp(a.fail,a.zFail,a.zPass)}else b.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(b.setDepthWriteEnabled(!0),b.setDepthRange(a.zNear,a.zFar)):b.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?b.setColorMask(a.r,a.g,a.b,a.a):b.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?b.setStencilWriteMask(a.mask):b.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parameters",{get:function(){if(!this._parameters){var a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)}}return this._parameters},
enumerable:!0,configurable:!0});a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};m("esri-webgl-debug")&&this.instanceCounter.printResourceCount();this.gl=null};a.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a,this._stateTracker.invalidateBlending())};
a.prototype.setBlendColor=function(a,c,d,f){if(a!==this._blendColorState.r||c!==this._blendColorState.g||d!==this._blendColorState.b||f!==this._blendColorState.a)this.gl.blendColor(a,c,d,f),this._blendColorState.r=a,this._blendColorState.g=c,this._blendColorState.b=d,this._blendColorState.a=f,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunction=function(a,c){if(a!==this._blendFunctionState.srcRGB||c!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,c),this._blendFunctionState.srcRGB=
a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=c,this._blendFunctionState.dstAlpha=c,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunctionSeparate=function(a,c,d,f){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==d||this._blendFunctionState.dstRGB!==c||this._blendFunctionState.dstAlpha!==f)this.gl.blendFuncSeparate(a,c,d,f),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=d,this._blendFunctionState.dstRGB=c,this._blendFunctionState.dstAlpha=
f,this._stateTracker.invalidateBlending()};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendEquationSeparate=function(a,c){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==c)this.gl.blendEquationSeparate(a,c),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=c,this._stateTracker.invalidateBlending()};
a.prototype.setColorMask=function(a,c,d,f){if(this._colorMaskState.r!==a||this._colorMaskState.g!==c||this._colorMaskState.b!==d||this._colorMaskState.a!==f)this.gl.colorMask(a,c,d,f),this._colorMaskState.r=a,this._colorMaskState.g=c,this._colorMaskState.b=d,this._colorMaskState.a=f,this._stateTracker.invalidateColorWrite()};a.prototype.setClearColor=function(a,c,d,f){if(this._clearColor.r!==a||this._clearColor.g!==c||this._clearColor.b!==d||this._clearColor.a!==f)this.gl.clearColor(a,c,d,f),this._clearColor.r=
a,this._clearColor.g=c,this._clearColor.b=d,this._clearColor.a=f};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=
a,this._stateTracker.invalidatePolygonOffset())};a.prototype.setPolygonOffset=function(a,c){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==c)this._polygonOffset[0]=a,this._polygonOffset[1]=c,this.gl.polygonOffset(a,c),this._stateTracker.invalidatePolygonOffset()};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=
a,this._stateTracker.invalidateCulling())};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,c,d,f){if(this._scissorRect.x!==a||this._scissorRect.y!==c||this._scissorRect.width!==d||this._scissorRect.height!==f)this.gl.scissor(a,c,d,f),this._scissorRect.x=a,this._scissorRect.y=c,this._scissorRect.width=d,this._scissorRect.height=
f};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a,this._stateTracker.invalidateDepthTest())};a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a,this._stateTracker.invalidateDepthTest())};a.prototype.setDepthWriteEnabled=
function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};a.prototype.setDepthRange=function(a,c){if(this._depthRange.zNear!==a||this._depthRange.zFar!==c)this.gl.depthRange(a,c),this._depthRange.zNear=a,this._depthRange.zFar=c,this._stateTracker.invalidateDepthWrite()};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),
this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};a.prototype.setStencilFunction=function(a,c,d){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==c||this._stencilFunction.mask!==d)this.gl.stencilFunc(a,c,d),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=c,this._stencilFunction.mask=d,this._stateTracker.invalidateStencilTest()};
a.prototype.setStencilFunctionSeparate=function(a,c,d,f){if(this._stencilFunction.face!==a||this._stencilFunction.func!==c||this._stencilFunction.ref!==d||this._stencilFunction.mask!==f)this.gl.stencilFuncSeparate(a,c,d,f),this._stencilFunction.face=a,this._stencilFunction.func=c,this._stencilFunction.ref=d,this._stencilFunction.mask=f,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=
a,this._stateTracker.invalidateStencilWrite())};a.prototype.setStencilOp=function(a,c,d){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==d)this.gl.stencilOp(a,c,d),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=c,this._stencilOperation.zPass=d,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilOpSeparate=function(a,c,d,f){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==
c||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==f)this.gl.stencilOpSeparate(a,c,d,f),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=c,this._stencilOperation.zFail=d,this._stencilOperation.zPass=f,this._stateTracker.invalidateStencilTest()};a.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(k.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};a.prototype.clear=
function(a){a&&this.gl.clear(a)};a.prototype.clearSafe=function(a){a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(255),this.gl.clear(a))};a.prototype.drawArrays=function(a,c,d){m("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=f(a,d));this.gl.drawArrays(a,c,d)};a.prototype.drawElements=function(a,c,d,g){m("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=f(a,c));5123===d?this.gl.drawElements(a,c,
d,g):5125===d&&this.gl.drawElements(a,c,d,g)};a.prototype.logIno=function(){m("esri-webgl-debug")&&console.log("DrawCalls: "+this._numOfDrawCalls+", Triangles: "+this._numOfTriangles)};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});a.prototype.setViewport=function(a,c,d,f){var b=this._viewport;if(b.x!==a||b.y!==c||b.width!==d||b.height!==f)b.x=a,b.y=c,b.width=d,b.height=f,this.gl.viewport(a,c,d,f)};a.prototype.getViewport=
function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};a.prototype.bindTexture=function(b,c){void 0===c&&(c=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(c>=a._MAX_TEXTURE_IMAGE_UNITS||
0>c)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[c];this.setActiveTexture(c);null==b||null==b.glName?(null!=d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(c,!1)),this._textureUnitMap[c]=null):d&&d.id===b.id?b.applyChanges():(d&&d.setBoundToUnit(c,!1),this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(c,!0),b.applyChanges(),this._textureUnitMap[c]=b)};a.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==
a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};a.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,
null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(b){34962===b?this._activeVertexBuffer=a._bindBuffer(this.gl,null,b,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&
(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,
a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,
7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,c=this.capabilities.vao;c&&c.bindVertexArray(null);for(var d=0;d<this.parameters.maxVertexAttributes;d++)a.disableVertexAttribArray(d);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,
this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:
null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);
a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);
a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,
this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)a.activeTexture(k.BASE_TEXTURE_UNIT+c),a.bindTexture(3553,null),(d=this._textureUnitMap[c])&&a.bindTexture(d.descriptor.target,d.glName);a.activeTexture(k.BASE_TEXTURE_UNIT+
this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height);m("esri-webgl-debug")&&(this._numOfTriangles=this._numOfDrawCalls=0)};a._bindBuffer=function(a,c,d,f){if(!c)return a.bindBuffer(d,null),null;if(f===c)return f;a.bindBuffer(d,c.glName);return c};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(n,a){return function(){function a(){this._instanceCount={textureCount:0,
bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}a.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};a.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;
break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};a.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+
this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return a}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),function(n,a,m,k,h,d,g){function l(a,c,b,d,g){if(d&&h.default(a))return!0;if(c[b])return!1;for(c=0;c<g.length;c++)if(a.getExtension(g[c]))return!0;
return!1}Object.defineProperty(a,"__esModule",{value:!0});a.loadCapabilities=function(a,c){var b=c&&c.disabledExtensions||{},e=c&&c.debugWebGLExtensions||{},f,q,n,w,u,v,y,t,x,z=null,A=null,E=null,B=null;return{get instancing(){f||(f=k.load(a));return f},get vao(){q||(q=g.load(a,b));return q},get compressedTextureS3TC(){if(!n)if(b.compressedTextureS3TC)n=null;else{var c=a.getExtension("WEBGL_compressed_texture_s3tc");n=c?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return n},get textureFilterAnisotropic(){if(!w)if(b.textureFilterAnisotropic)w=null;else{var c=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");w=c?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null}return w},
get disjointTimerQuery(){u||(u=m.load(a,b));return u},get textureFloat(){if(!v)if(h.default(a))v={textureFloat:!0,textureFloatLinear:!b.textureFloatLinear&&!!a.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!b.textureHalfFloatLinear&&!!a.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:a.HALF_FLOAT};else if(a instanceof WebGLRenderingContext){var c=!b.textureHalfFloat&&a.getExtension("OES_texture_half_float");v={textureFloat:!b.textureFloat&&!!a.getExtension("OES_texture_float"),
textureFloatLinear:!b.textureFloatLinear&&!!a.getExtension("OES_texture_float_linear"),textureHalfFloat:!!c,textureHalfFloatLinear:!b.textureHalfFloatLinear&&!!a.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:c?c.HALF_FLOAT_OES:void 0}}else v=null;return v},get colorBufferFloat(){if(!y)if(h.default(a)){var c=!b.colorBufferFloat&&a.getExtension("EXT_color_buffer_half_float"),d=!b.colorBufferFloat&&a.getExtension("EXT_color_buffer_float");y=c||d?{textureFloat:!!d,textureHalfFloat:!!c,R16F:a.R16F,
RG16F:a.RG16F,RGBA16F:a.RGBA16F,R32F:a.R32F,RG32F:a.RG32F,RGBA32F:a.RGBA32F,R11F_G11F_B10F:a.R11F_G11F_B10F,RGB16F:a.RGB16F}:null}else a instanceof WebGLRenderingContext?(c=!b.colorBufferFloat&&a.getExtension("EXT_color_buffer_half_float"),d=!b.colorBufferFloat&&a.getExtension("WEBGL_color_buffer_float"),y=c||d?{textureFloat:!!d,textureHalfFloat:!!c,RGBA16F:c?c.RGBA16F_EXT:void 0,RGB16F:c?c.RGB16F_EXT:void 0,RGBA32F:d?d.RGBA32F_EXT:void 0}:null):y=null;return y},get blendMinMax(){if(!t)if(h.default(a))t=
{MIN:a.MIN,MAX:a.MAX};else if(b.blendMinMax)t=null;else{var c=a.getExtension("EXT_blend_minmax");t=c?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null}return t},get depthTexture(){null===z&&(z=l(a,b,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return z},get standardDerivatives(){null===A&&(A=l(a,b,"standardDerivatives",!0,["OES_standard_derivatives"]));return A},get shaderTextureLOD(){null===E&&(E=l(a,b,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return E},
get fragDepth(){null===B&&(B=l(a,b,"fragDepth",!0,["EXT_frag_depth"]));return B},get loseContext(){x||(x=d.load(a,e));return x}}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a,h){if(h.disjointTimerQuery)return null;var d=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return d?m.default(a)?{createQuery:function(){return a.createQuery()},
resultAvailable:function(d){return a.getQueryParameter(d,a.QUERY_RESULT_AVAILABLE)},getResult:function(d){return a.getQueryParameter(d,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(d.GPU_DISJOINT_EXT)},beginTimeElapsed:function(g){return a.beginQuery(d.TIME_ELAPSED_EXT,g)},endTimeElapsed:function(){return a.endQuery(d.TIME_ELAPSED_EXT)},createTimestamp:function(a){return d.queryCounterEXT(a,d.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(d.TIMESTAMP_EXT,d.QUERY_COUNTER_BITS_EXT)}}:
{createQuery:function(){return d.createQueryEXT()},resultAvailable:function(a){return d.getQueryObjectEXT(a,d.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return d.getQueryObjectEXT(a,d.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(d.GPU_DISJOINT_EXT)},beginTimeElapsed:function(a){return d.beginQueryEXT(d.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return d.endQueryEXT(d.TIME_ELAPSED_EXT)},createTimestamp:function(a){return d.queryCounterEXT(a,d.TIMESTAMP_EXT)},timestampBits:function(){return d.getQueryEXT(d.TIMESTAMP_EXT,
d.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a){return m.default(a)?{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),
drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/LoseContext":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a,k){var h=k.loseContext&&a.getExtension("WEBGL_lose_context");return h?{loseRenderingContext:function(){return h.loseContext()}}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require",
"exports","./isWebGL2Context"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a,h){return m.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:h.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),
bindVertexArray:a.bindVertexArrayOES.bind(a)}:null}})},"esri/views/webgl/ProgramCache":function(){define(["require","exports","./programUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this._programCacheByTemplate=new Map;this._rctx=a}a.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};a.prototype.getProgram=function(a,d){var g=this;this._programCacheByTemplate.has(a)||
this.addProgramTemplate(a,function(d){return m.createProgram(g._rctx,a,d)});return this.getProgramTemplateInstance(a,d)};a.prototype.addProgramTemplate=function(a,d){this._programCacheByTemplate.set(a,{constructor:d,programs:new Map})};a.prototype.getProgramTemplateInstance=function(a,d){if(a=this._programCacheByTemplate.get(a)){var g=d?JSON.stringify(d):"default";a.programs.has(g)||(d=a.constructor(d),a.programs.set(g,d));return a.programs.get(g)}return null};return a}();a.ProgramCache=n})},"esri/views/2d/engine":function(){define("require exports ./engine/Bitmap ./engine/BitmapContainer ./engine/BitmapTile ./engine/Container ./engine/webgl/TileContainer ./engine/DisplayObject ./engine/Stage ./engine/webgl/AttributeStoreView ./engine/webgl/collisions/CollisionGrid ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./engine/webgl/Geometry ./engine/webgl/alignmentUtils ./engine/webgl/color ./engine/webgl/definitions ./engine/webgl/enums ./engine/webgl/fontUtils ./engine/webgl/Utils ./engine/webgl/brushes/BrushBitmap ./engine/webgl/brushes/BrushClip ./engine/webgl/brushes/WGLBrushStencil ./engine/webgl/brushes/WGLGeometryBrush ./engine/webgl/brushes/WGLGeometryBrushFill ./engine/webgl/brushes/WGLGeometryBrushLabel ./engine/webgl/brushes/WGLGeometryBrushLine ./engine/webgl/brushes/WGLGeometryBrushMarker ./engine/webgl/brushes/WGLGeometryBrushText ./engine/webgl/util/debug ./engine/webgl/TileClipper ./engine/webgl/TurboLine ./engine/webgl/mesh/factories/matcherUtils ./engine/webgl/mesh/factories/WGLMeshFactory ./engine/webgl/mesh/MeshData ./engine/webgl/mesh/templates/WGLTemplateStore ./engine/webgl/Painter ./engine/webgl/TextShaping ./engine/webgl/TextShapingNew ./engine/webgl/TileData ./engine/webgl/util/BidiText ./engine/webgl/util/Matcher ./engine/webgl/util/vvFlagUtils ./engine/webgl/visualVariablesUtils ./engine/webgl/WGLRendererInfo ./engine/webgl/WGLTile ./engine/webgl/BitBlitRenderer ./engine/webgl/shaders/MagnifierPrograms ../../symbols/cim/CIMSymbolHelper ./engine/webgl/Rect ./engine/webgl/mesh/templates/util ./engine/webgl/painter/RenderPass ./engine/webgl/TiledDisplayObject ./engine/BitmapTileContainer".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L,R,O,T,U,P,V,W,Q,Z,X,aa,da,ga,ca,ia,ba,oa,ha,la,ra){Object.defineProperty(a,"__esModule",{value:!0});a.Bitmap=m.Bitmap;a.BitmapContainer=k.BitmapContainer;a.BitmapTile=h.BitmapTile;a.Container=d.Container;a.TileContainer=g.default;a.DisplayObject=l.DisplayObject;a.Stage=f.Stage;a.AttributeStoreView=c.AttributeStoreView;a.CollisionGrid=b.CollisionGrid;a.CollisionEngine=e.CollisionEngine;a.LayerViewSorter=p.LayerViewSorter;
a.Point=q.Point;a.alignmentUtils=r;a.color=w;a.definitions=u;a.enums=v;a.fontUtils=y;a.Utils=t;a.debug=N;a.TileClipper=I.TileClipper;a.SimpleBuilder=I.SimpleBuilder;a.tessellate=J.tessellate;a.TessellationState=J.TessellationState;a.splitVertex=J.splitVertex;a.createMatcher=M.createMatcher;a.WGLMeshFactory=L.WGLMeshFactory;a.MeshData=R.MeshData;a.WGLTemplateStore=O.WGLTemplateStore;a.Painter=T.default;a.PainterOptions=T.PainterOptions;a.TextShaping=U.TextShaping;a.TextShapingNew=P.TextShaping;a.TileData=
V.TileData;a.bidiText=W.bidiText;a.FeatureMatcher=Q.FeatureMatcher;a.getVVFlags=Z.getVVFlags;a.getTypeOfSizeVisualVariable=X.getTypeOfSizeVisualVariable;a.WGLRendererInfo=aa.WGLRendererInfo;a.WGLTile=da.WGLTile;a.BitBlitRenderer=ga.BitBlitRenderer;a.createMagnifierProgram=ca.createMagnifierProgram;a.magnifier=ca.magnifier;a.CIMSymbolHelper=ia.CIMSymbolHelper;a.Rect=ba.default;a.getLimitCosine=oa.getLimitCosine;n=a.brushes||(a.brushes={});n.Geometry=E.default;n.Marker=K.default;n.Line=F.default;n.Fill=
B.default;n.Text=H.default;n.Label=G.default;n.Clip=z.default;n.Stencil=A.default;n.Bitmap=x.default;a.RenderPass=ha.default;a.TiledDisplayObject=la.TiledDisplayObject;a.BitmapTileContainer=ra.BitmapTileContainer})},"esri/views/2d/engine/Bitmap":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../webgl ./DisplayObject ./ImageryBitmapSource".split(" "),function(n,
a,m,k,h,d,g,l,f){function c(a){var b=document.createElement("canvas");b.width=a.width;b.height=a.height;a.render(b.getContext("2d"));return b}function b(a,b,c){var d={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};b&&c&&(d.width=b,d.height=c);return new g.Texture(a,d)}function e(a){q.has(a)&&(p.splice(p.indexOf(a),1),q.delete(a))}Object.defineProperty(a,"__esModule",{value:!0});var p=[],q=new Set;n=function(a){function g(b,c){void 0===b&&(b=null);void 0===c&&(c=function(){return null});
var d=a.call(this)||this;d.stencilRef=0;d.coordScale=[1,1];d._height=void 0;d.pixelRatio=1;d.resolution=0;d.rotation=0;d._source=null;d._width=void 0;d.x=0;d.y=0;d.transforms={dvs:h.mat3f32.create()};d.source=b;d.requestRender=c;return d}m(g,a);Object.defineProperty(g.prototype,"isSourceScaled",{get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){return void 0!==this._height?
this._height:this.sourceHeight},set:function(a){this._height=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"source",{get:function(){return this._source},set:function(a){this._source=a;this.invalidateTexture()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"sourceWidth",
{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(a){this._width=a},enumerable:!0,configurable:!0});g.prototype.attach=function(){this.updateTexture();return!0};g.prototype.detach=function(){this._texture.dispose();this._texture=null;e(this)};g.prototype.invalidateTexture=function(){this.attached?
this.updateTexture():e(this)};g.prototype.setTransform=function(a){var b=k.mat3.identity(this.transforms.dvs),c=a.toScreenNoRotation([0,0],this.x,this.y),e=this.resolution/this.pixelRatio/a.resolution,f=e*this.width,e=e*this.height,g=Math.PI*this.rotation/180;k.mat3.translate(b,b,d.vec2f32.fromValues(c[0],c[1]));k.mat3.translate(b,b,d.vec2f32.fromValues(f/2,e/2));k.mat3.rotate(b,b,-g);k.mat3.translate(b,b,d.vec2f32.fromValues(-f/2,-e/2));k.mat3.scaleByVec2(b,b,d.vec2f32.fromValues(f,e));k.mat3.multiply(this.transforms.dvs,
a.displayViewMat3,b)};g.prototype.updateTexture=function(){this._texture||(this._texture=this.source?b(this.stage.context,this.sourceWidth,this.sourceHeight):b(this.stage.context));var a=this.source;a?(this._texture.resize(this.sourceWidth,this.sourceHeight),a&&"render"in a?a instanceof f.default?(a=a.getRenderedRasterPixels(),this._texture.setData(a.renderedRasterPixels)):this._texture.setData(c(a)):!a||"render"in a||this._texture.setData(a),this.ready(),this.requestRender()):this._texture.setData(null)};
g.prototype.setSamplingProfile=function(a){this._texture&&(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(a.samplingMode))};g.prototype.bind=function(a){this._texture&&this.stage.context.bindTexture(this._texture,a)};return g}(l.DisplayObject);a.Bitmap=n})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat3f32=m})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){var a=new Float32Array(9);a[0]=1;a[4]=1;a[8]=1;return a};a.clone=function(a){var k=new Float32Array(9);k[0]=a[0];k[1]=a[1];k[2]=a[2];k[3]=a[3];k[4]=a[4];k[5]=a[5];k[6]=a[6];k[7]=a[7];k[8]=a[8];return k};a.fromValues=function(a,k,h,d,g,l,f,c,b){var e=new Float32Array(9);e[0]=a;e[1]=k;e[2]=h;e[3]=d;e[4]=g;e[5]=l;e[6]=f;e[7]=c;e[8]=b;return e};a.createView=function(a,k){return new Float32Array(a,k,9)}})},"esri/views/2d/engine/DisplayObject":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../../../core/Evented"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){var d=null!==a&&a.apply(this,arguments)||this;d._renderRequestedCalled=!1;d._attached=!1;d._isReady=!1;d._opacity=1;d.renderRequested=!1;d._visible=!0;return d}m(d,a);Object.defineProperty(d.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&
this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visible",{get:function(){return this._visible},
set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});d.prototype.attach=function(){this.ready();return!0};d.prototype.setTransform=function(a){};d.prototype.detach=function(){};d.prototype.processRender=function(a){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(a),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};d.prototype.requestRender=function(){var a=
this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};d.prototype.dispose=function(){};d.prototype.doRender=function(a){};d.prototype.ready=function(){this._isReady=!0;this.emit("isReady")};return d}(k);a.DisplayObject=n})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});n=function(){function a(a,h,d){this.pixelBlock=a;this.extent=h;this.originalPixelBlock=d}Object.defineProperty(a.prototype,"width",{get:function(){return this.pixelBlock?this.pixelBlock.width:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.pixelBlock?this.pixelBlock.height:0},enumerable:!0,configurable:!0});a.prototype.render=function(a){if(this.pixelBlock){var h=this.filter({pixelBlock:this.pixelBlock}),d=h.pixelBlock.getAsRGBA(),
h=a.createImageData(h.pixelBlock.width,h.pixelBlock.height);h.data.set(d);a.putImageData(h,0,0)}};a.prototype.getRenderedRasterPixels=function(){var a=this.filter({pixelBlock:this.pixelBlock});return{width:a.pixelBlock.width,height:a.pixelBlock.height,renderedRasterPixels:new Uint8Array(a.pixelBlock.getAsRGBA().buffer)}};return a}();a.default=n})},"esri/views/2d/engine/BitmapContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../engine ./webgl/WGLContainer".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}m(d,a);d.prototype.prepareRenderPasses=function(d){var c=this,b=d.registerRenderPass({name:"bitmap",brushes:[h.brushes.Bitmap],target:function(){return c.children}});return a.prototype.prepareRenderPasses.call(this,d).concat([b])};return d}(d.default);a.BitmapContainer=n})},"esri/views/2d/engine/webgl/WGLContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../engine ../Container ./ClippingInfo ./enums".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(b){var c=a.call(this)||this;c.name=c.constructor.name;c._lastTime=null;c.setClips(b);return c}m(b,a);b.prototype.setClips=function(a){var b=this;h.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(function(a){return a.destroy()}),this._clippingInfos=null);h.isSome(a)&&a.length&&(this._clippingInfos=a.items.map(function(a){return l.default.fromClipArea(b,a)}));this.requestRender()};b.prototype.doRender=
function(a){this.attachChildren();this.detachChildren();var b=this.createRenderParams(a),c=b.context,d=b.painter,e=b.globalOpacity,g=b.profiler,e=b.drawPhase===f.WGLDrawPhase.LABEL?1:e*this.opacity;g.recordContainerStart(this.name);d.beforeRenderLayer(c,this._clippingInfos?255:0,e);this.updateTransforms(a.state);this.renderChildren(b);d.compositeLayer(c,e);g.recordContainerEnd(this.name)};b.prototype.renderChildren=function(a){h.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(this.stage.painter));
for(var b=0,c=this._renderPasses;b<c.length;b++)c[b].render(a)};b.prototype.createRenderParams=function(a){var b=Date.now(),c=(h.isSome(this._lastTime)?b-this._lastTime:0)/1E3;this._lastTime=b;return k({},a,{context:this.stage.context,painter:this.stage.painter,profiler:this.stage.profiler,renderingOptions:this.stage.renderingOptions,driverTestResult:this.stage.driverTestResult,timeDelta:c,timeline:this.stage.timeline})};b.prototype.prepareRenderPasses=function(a){var b=this;return[a.registerRenderPass({name:"clip",
brushes:[d.brushes.Clip],target:function(){return b._clippingInfos},drawPhase:f.WGLDrawPhase.MAP|f.WGLDrawPhase.LABEL|f.WGLDrawPhase.LABEL_ALPHA})]};b.prototype.updateTransforms=function(a){for(var b=0,c=this.children;b<c.length;b++)c[b].setTransform(a)};return b}(g.Container);a.default=n})},"esri/views/2d/engine/Container":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./DisplayObject"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){var d=
null!==a&&a.apply(this,arguments)||this;d._childrenSet=new Set;d._childrenToAttach=[];d._childrenToDetach=[];d.children=[];return d}m(d,a);Object.defineProperty(d.prototype,"numChildren",{get:function(){return this.children.length},enumerable:!0,configurable:!0});d.prototype.detach=function(){for(var a=0,d=this.children.concat(this._childrenToDetach);a<d.length;a++){var f=d[a];f.attached&&(this.detachChild(f),f.attached=!1,f.parent=null)}};d.prototype.doRender=function(a){var d=a.globalOpacity;a.globalOpacity*=
this.opacity;this.attachChildren();this.detachChildren();this.renderChildren(a);a.globalOpacity=d};d.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};d.prototype.addChildAt=function(a,d){void 0===d&&(d=this.numChildren);if(!a||this.contains(a))return a;var f=a.parent;f&&f!==this&&f.removeChild(a);d>=this.numChildren?this.children.push(a):this.children.splice(d,0,a);this._childrenSet.add(a);d=this._childrenToDetach.indexOf(a);-1<d&&this._childrenToDetach.splice(d,1);this._childrenToAttach.push(a);
this.requestRender();return a};d.prototype.contains=function(a){return this._childrenSet.has(a)};d.prototype.getChildIndex=function(a){return this.children.indexOf(a)};d.prototype.getChildAt=function(a){return 0>a||a>this.children.length?null:this.children[a]};d.prototype.removeAllChildren=function(){for(var a=this.numChildren;a--;)this.removeChildAt(0)};d.prototype.removeChild=function(a){return this.contains(a)?this.removeChildAt(this.getChildIndex(a)):a};d.prototype.removeChildAt=function(a){if(0>
a||a>=this.children.length)return null;a=this.children.splice(a,1)[0];this._childrenSet["delete"](a);if(a.attached)this._childrenToDetach.push(a);else{var d=this._childrenToAttach.indexOf(a);-1<d&&this._childrenToAttach.splice(d,1)}return a};d.prototype.requestChildRender=function(a){this.requestRender()};d.prototype.setChildIndex=function(a,d){var f=this.getChildIndex(a);-1<f&&(this.children.splice(f,1),this.children.splice(d,0,a))};d.prototype.sortChildren=function(a){return this.children.sort(a)};
d.prototype.attachChildren=function(){var a=this._childrenToAttach;if(0!==a.length)for(var d=0,f=!1;!f;)f=a[d],f.parent=this,f.stage=this.stage,this.attachChild(f)?(f.attached=!0,a.splice(d,1)):++d,f=a.length===d};d.prototype.detachChildren=function(){for(var a=this._childrenToDetach;0<a.length;){var d=a.shift();this.detachChild(d);d.attached=!1;d.parent=null;d.stage=null}};d.prototype.renderChildren=function(a){for(var d=this.children,f=d.length,c=0;c<f;c++)d[c].processRender(a)};d.prototype.attachChild=
function(a){return a.attach()};d.prototype.detachChild=function(a){a.detach()};return d}(k.DisplayObject);a.Container=n})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});var c=h.getLogger("esri.views.2d.engine.webgl.ClippingInfo");
n=function(a){function b(b,c){var d=a.call(this)||this;d._cache={};d.parent=b;d._handle=c.watch("version",function(){return d._invalidate()});d._clip=c;d.attach();d.attached=!0;return d}m(b,a);b.fromClipArea=function(a,c){return new b(a,c)};b.prototype._destroyGL=function(){d.isSome(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null);d.isSome(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)};b.prototype.destroy=function(){this._destroyGL();this._handle.remove()};
b.prototype.doRender=function(a){};b.prototype.getVAO=function(a,b,c,e){var g=b.size,h=g[0],g=g[1];if("geometry"===this._clip.type||this._lastWidth!==h||this._lastHeight!==g)this._lastWidth=h,this._lastHeight=g,this._destroyGL();d.isNone(this._cache.vao)&&(b=this._createMesh(b,this._clip),h=b.getIndexBuffer(a),g=b.getVertexBuffers(a),this._cache.mesh=b,this._cache.vao=new f(a,c,e,g,h));return this._cache.vao};b.prototype._invalidate=function(){this._destroyGL();this.requestRender()};b.prototype._createScreenRect=
function(a,b){var c=a.size;a=c[0];var c=c[1],d="string"===typeof b.left?parseFloat(b.left)/100*a:b.left,e="string"===typeof b.right?parseFloat(b.right)/100*a:b.right,f="string"===typeof b.top?parseFloat(b.top)/100*c:b.top;b="string"===typeof b.bottom?parseFloat(b.bottom)/100*c:b.bottom;return{x:d,y:f,width:Math.max(a-e-d,0),height:Math.max(c-b-f,0)}};b.prototype._createMesh=function(a,b){switch(b.type){case "rect":return l.default.fromRect(this._createScreenRect(a,b));case "path":return l.default.fromPath(b);
case "geometry":return l.default.fromGeometry(a,b);default:return c.error(new k("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),l.default.fromRect({x:0,y:0,width:1,height:1})}};return b}(g.DisplayObject);a.default=n})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});var q=h.getLogger("esri.views.2d.engine.webgl.Mesh2D"),r=function(a,b){var c=a.coords;a=a.lengths;for(var d=[],e=0,f=0;e<a.length;f+=a[e],e+=1){for(var h=f,l=[];e<a.length-1;e+=1,f+=a[e]){for(var k=f+a[e],m=0,p=1;p<a[e+1];p++)m+=(c[2*(k+p)]-c[2*(k+p-1)])*(c[2*(k+p)+1]+c[2*(k+p-1)+1]);if(!(b?0<m:0>m))break;l.push(f+a[e]-h)}m=c.slice(2*h,2*(f+a[e]));k=0;for(l=g(m,l,2);k<l.length;k++)d.push(l[k]+h)}return d};n=function(){function a(a,
b,c,d){void 0===d&&(d=!1);this._cache={};this.vertices=a;this.indices=b;this.primitiveType=c;this.isMapSpace=d}a.fromRect=function(b){var c=b.x,d=b.y;return a.fromScreenExtent({xmin:c,ymin:d,xmax:c+b.width,ymax:d+b.height})};a.fromPath=function(d){var f=c.convertFromNestedArray(new b.default,d.path,!1,!1);d=f.coords;for(var f=new Uint32Array(r(f,!0)),g=new Uint32Array(d.length/2),h=0;h<g.length;h++)g[h]=e.i1616to32(Math.floor(d[2*h]),Math.floor(d[2*h+1]));return new a({geometry:g},f,4)};a.fromGeometry=
function(b,c){var d=c.geometry.type;switch(d){case "polygon":return a.fromPolygon(b,c.geometry);case "extent":return a.fromMapExtent(b,c.geometry);default:return q.error(new k("mapview-bad-type","Unable to create a mesh from type "+d,c)),a.fromRect({x:0,y:0,width:1,height:1})}};a.fromPolygon=function(d,g){var h=c.convertFromPolygon(new b.default,g,!1,!1);g=h.coords;for(var h=new Uint32Array(r(h,!1)),k=new Uint32Array(g.length/2),m=f.vec2f64.create(),p=f.vec2f64.create(),q=0;q<k.length;q++)l.vec2.set(m,
g[2*q],g[2*q+1]),d.toScreen(p,m),k[q]=e.i1616to32(Math.floor(p[0]),Math.floor(p[1]));return new a({geometry:k},h,4,!0)};a.fromScreenExtent=function(b){var c=b.xmin,d=b.xmax,f=b.ymin;b=b.ymax;c={geometry:new Uint32Array([e.i1616to32(c,f),e.i1616to32(d,f),e.i1616to32(c,b),e.i1616to32(c,b),e.i1616to32(d,f),e.i1616to32(d,b)])};d=new Uint32Array([0,1,2,3,4,5]);return new a(c,d,4)};a.fromMapExtent=function(b,c){var d=b.toScreen([0,0],[c.xmin,c.ymin]),f=d[0],d=d[1];c=b.toScreen([0,0],[c.xmax,c.ymax]);b=
c[0];c=c[1];f={geometry:new Uint32Array([e.i1616to32(f,d),e.i1616to32(b,d),e.i1616to32(f,c),e.i1616to32(f,c),e.i1616to32(b,d),e.i1616to32(b,c)])};d=new Uint32Array([0,1,2,3,4,5]);return new a(f,d,4)};a.prototype.destroy=function(){d.isSome(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(var a in this._cache.vertexBuffers)d.isSome(this._cache.vertexBuffers[a])&&this._cache.vertexBuffers[a].dispose()};Object.defineProperty(a.prototype,"elementType",{get:function(){var a;a:switch(this.indices.BYTES_PER_ELEMENT){case 1:a=
5121;break a;case 2:a=5123;break a;case 4:a=5125;break a;default:throw new k("Cannot get DataType of array");}return a},enumerable:!0,configurable:!0});a.prototype.getIndexBuffer=function(a,b){void 0===b&&(b=35044);this._cache.indexBuffer||(this._cache.indexBuffer=p.createIndex(a,b,this.indices));return this._cache.indexBuffer};a.prototype.getVertexBuffers=function(a,b){var c=this;void 0===b&&(b=35044);this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(function(d,
e){var f;return m({},d,(f={},f[e]=p.createVertex(a,b,c.vertices[e]),f))},{}));return this._cache.vertexBuffers};return a}();a.default=n})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports"],function(n,a){function m(a,g,h){return Math.round(Math.max(Math.min(a,h),g))}Object.defineProperty(a,"__esModule",{value:!0});var k=new Float32Array(1),h=new Uint32Array(k.buffer);a.i8=function(a){return m(a,-128,127)};a.i16=function(a){return m(a,-32768,32767)};a.i32=function(a){return m(a,
-2147483648,2147483647)};a.u8=function(a){return m(a,0,255)};a.u16=function(a){return m(a,0,65535)};a.u32=function(a){return m(a,0,4294967295)};a.toUint32=function(a){k[0]=a;return h[0]};a.toFloat32=function(a){h[0]=a;return k[0]};a.i1616to32=function(a,g){return 65535&a|g<<16};a.i8888to32=function(a,g,h,f){return a&255|(g&255)<<8|(h&255)<<16|f<<24};a.i8816to32=function(a,g,h){return a&255|(g&255)<<8|h<<16};a.numTo32=function(a){return a|0}})},"esri/views/2d/engine/webgl/enums":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});(function(a){a[a.FILL=0]="FILL";a[a.LINE=1]="LINE";a[a.MARKER=2]="MARKER";a[a.TEXT=3]="TEXT";a[a.LABEL=4]="LABEL"})(a.WGLGeometryType||(a.WGLGeometryType={}));(function(a){a[a.SUCCEEDED=0]="SUCCEEDED";a[a.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"})(a.WGLGeometryTransactionStatus||(a.WGLGeometryTransactionStatus={}));(function(a){a[a.NONE=0]="NONE";a[a.MAP=1]="MAP";a[a.LABEL=2]="LABEL";a[a.LABEL_ALPHA=4]="LABEL_ALPHA";a[a.HITTEST=
8]="HITTEST";a[a.HIGHLIGHT=16]="HIGHLIGHT";a[a.CLIP=32]="CLIP";a[a.DEBUG=64]="DEBUG";a[a.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(a.WGLDrawPhase||(a.WGLDrawPhase={}));(function(a){a[a.SIZE=0]="SIZE";a[a.COLOR=1]="COLOR";a[a.OPACITY=2]="OPACITY";a[a.ROTATION=3]="ROTATION"})(a.VVType||(a.VVType={}));(function(a){a[a.NONE=0]="NONE";a[a.OPACITY=1]="OPACITY";a[a.COLOR=2]="COLOR";a[a.ROTATION=4]="ROTATION";a[a.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";a[a.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";a[a.SIZE_FIELD_STOPS=
32]="SIZE_FIELD_STOPS";a[a.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(a.WGLVVFlag||(a.WGLVVFlag={}));(function(a){a[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";a[a.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(a.WGLVVTarget||(a.WGLVVTarget={}));(function(a){a[a.SPRITE=0]="SPRITE";a[a.GLYPH=1]="GLYPH"})(a.MosaicType||(a.MosaicType={}))})},"esri/views/2d/engine/BitmapTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Bitmap ./webgl/TiledDisplayObject".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(d,c,b,e){void 0===e&&(e=null);var f=a.call(this,d,c,b)||this;d=f.requestRender.bind(f);f.bitmap=new h.Bitmap(e,d);f.bitmap.coordScale=b;f.bitmap.once("isReady",function(){return f.ready()});return f}m(d,a);Object.defineProperty(d.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(a){this.bitmap.stencilRef=a},enumerable:!0,configurable:!0});d.prototype.setTransform=function(d,
c){a.prototype.setTransform.call(this,d,c);this.bitmap.transforms.dvs=this.transforms.dvs};d.prototype.attach=function(){this.bitmap.stage=this.stage;var a=this.bitmap.attach();a&&(this.bitmap.attached=!0);return a};d.prototype.detach=function(){this.bitmap.detach()};return d}(d.TiledDisplayObject);a.BitmapTile=n})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,c,f){var e=a.call(this)||this;e.transforms={dvs:d.mat3f32.create(),tileMat3:d.mat3f32.create()};e.key=l.pool.acquire(b);e.bounds=c;e.size=f;return e}m(c,a);c.prototype.destroy=function(){l.pool.release(this.key);this.texture&&this.texture.dispose()};Object.defineProperty(c.prototype,"coords",{get:function(){return this._coords},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"bounds",
{get:function(){return this._bounds},set:function(a){this._coords=[a[0],a[3]];this._bounds=a},enumerable:!0,configurable:!0});c.prototype.setTransform=function(a,c){k("esri-2d-debug")&&null==c&&console.debug("Tried to set tile transform but lod resolution was null");c/=a.resolution*a.pixelRatio;var b=this.transforms.tileMat3,d=a.toScreenNoRotation([0,0],this.coords);h.mat3.set(this.transforms.tileMat3,c,0,0,0,c,0,d[0],d[1],1);h.mat3.multiply(this.transforms.dvs,a.displayViewMat3,b)};return c}(g.DisplayObject);
a.TiledDisplayObject=n})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(n,a,m){return function(){function a(a,d,g,l){this.set(a,d,g,l)}a.getId=function(a,d,g,l){return"object"===typeof a?a.level+"/"+a.row+"/"+a.col+"/"+a.world:a+"/"+d+"/"+g+"/"+l};Object.defineProperty(a.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this.toString()},enumerable:!0,
configurable:!0});a.prototype.equals=function(a){return this.level===a.level&&this.row===a.row&&this.col===a.col&&this.world===a.world};a.prototype.release=function(){this.world=this.col=this.row=this.level=0};a.prototype.set=function(a,d,g,l){null==a?this.world=this.col=this.row=this.level=0:"object"===typeof a?(this.level=a.level||0,this.row=a.row||0,this.col=a.col||0,this.world=a.world||0):"string"===typeof a?(a=a.split("/"),d=a[1],g=a[2],l=a[3],this.level=parseFloat(a[0]),this.row=parseFloat(d),
this.col=parseFloat(g),this.world=parseFloat(l)):(this.level=+a,this.row=+d,this.col=+g,this.world=+l||0);return this};a.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};a.prototype.getChildKeys=function(){var h=this.level+1,d=this.row<<1,g=this.col<<1,l=this.world;return[new a(h,d,g,l),new a(h,d,g+1,l),new a(h,d+1,g,l),new a(h,d+1,g+1,l)]};a.prototype.compareRowMajor=function(a){return this.row<a.row?-1:this.row>a.row?1:this.col<a.col?-1:this.col>a.col?1:
0};a.pool=new m(a,!0,null,25,50);return a}()})},"esri/views/2d/engine/webgl/TileContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ./WGLContainer ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=function(a,c){return 0!==a.key.level-c.key.level?a.key.level-c.key.level:0!==a.key.row-c.key.row?a.key.row-c.key.row:a.key.col-c.key.col};n=
function(a){function c(b,c){c=a.call(this,c)||this;c._tileInfoView=b;return c}m(c,a);c.prototype.renderChildren=function(b){this.sortChildren(l);this._setStencilReference(this.children);a.prototype.renderChildren.call(this,b)};c.prototype.createRenderParams=function(b){var c=b.state;return k({},a.prototype.createRenderParams.call(this,b),{requiredLevel:this._tileInfoView.getClosestInfoForScale(c.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(c.scale)})};c.prototype.prepareRenderPasses=
function(b){var c=this,f=b.registerRenderPass({name:"stencil",brushes:[g.default],target:function(){return c.children}}),h=b.registerRenderPass({name:"tileInfo",brushes:[d.default],target:function(){return c.children},has:"esri-feature-tiles-debug"});return a.prototype.prepareRenderPasses.call(this,b).concat([f,h])};c.prototype.updateTransforms=function(a){for(var b=0,c=this.children;b<c.length;b++){var d=c[b],f=this._tileInfoView.getTileResolution(d.key);d.setTransform(a,f)}};c.prototype._setStencilReference=
function(a){a=1;for(var b=0,c=this.children;b<c.length;b++)c[b].stencilRef=a++};return c}(h.default);a.default=n})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../GeometryUtils ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms".split(" "),function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b._initialized=!1;b._color=k.vec4f32.fromValues(1,0,0,1);b._maxWidth=0;return b}m(b,a);b.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),
this._tileInfoVertexArrayObject=null);this._canvas=null};b.prototype.prepareState=function(a,b){a=a.context;a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};b.prototype.draw=function(a,b){a=a.context;if(b.isReady){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",
b.transforms.dvs);this._outlineProgram.setUniform2f("u_coord_range",b.size[0],b.size[1]);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);a.drawArrays(3,0,4);a.bindVAO();var c=this._getTexture(a,b);c&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(this._tileInfoProgram),a.bindTexture(c,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",
1,1),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())}};b.prototype._initialize=function(a){if(this._initialized)return!0;var b=h.createProgram(a,l.background),c=h.createProgram(a,f.tileInfo),d={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},e=new Int8Array([0,0,1,0,1,1,0,1]),e=h.BufferObject.createVertex(a,35044,e),e=new h.VertexArrayObject(a,
l.background.attributes,d,{geometry:e}),g=new Int8Array([0,0,1,0,0,1,1,1]),g=h.BufferObject.createVertex(a,35044,g);a=new h.VertexArrayObject(a,f.tileInfo.attributes,d,{geometry:g});this._outlineProgram=b;this._tileInfoProgram=c;this._outlineVertexArrayObject=e;this._tileInfoVertexArrayObject=a;return this._initialized=!0};b.prototype._getTexture=function(a,b){if(b.texture)return b.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width",
"256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var c=b.key.id,e=this._canvas.getContext("2d");e.font="24px sans-serif";e.textAlign="left";e.textBaseline="middle";var f=e.measureText(c),f=Math.pow(2,Math.ceil(d.log2(f.width+2)));f>this._maxWidth&&(this._maxWidth=f);e.clearRect(0,0,this._maxWidth,32);e.fillStyle="blue";e.fillText(c,0,16);b.texture=new h.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return b.texture};
return b}(g.default);a.default=n})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(n,a){function m(a,d){a%=d;return 0<=a?a:a+d}Object.defineProperty(a,"__esModule",{value:!0});a.C_INFINITY=Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var k=1/Math.LN2;a.positiveMod=m;a.radToByte=
function(h){return m(h*a.C_RAD_TO_256,256)};a.degToByte=function(h){return m(h*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*k};a.sqr=function(a){return a*a};a.interpolate=function(a,d,g){return a*(1-g)+d*g};a.between=function(a,d,g){return a>=d&&a<=g||a>=g&&a<=d}})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this.name=this.constructor.name||"UnnamedBrush"}
a.prototype.prepareState=function(a,h,d){};return a}();a.default=n})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.background={name:"background",shaders:{vertexShader:m.resolveIncludes("background/background.vert"),fragmentShader:m.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require",
"exports","../../../../../webgl","./shaderRepository"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=new m.ShaderCompiler(function(a){var d=k;a.split("/").forEach(function(a){d&&(d=d[a])});return d});a.resolveIncludes=function(a){return h.resolveIncludes(a)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(n,a){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor \x3d u_color;\n}",
"background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\n  gl_FragColor \x3d color *  u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n  v_uv \x3d a_tex;\n}"},
filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\n  float b \x3d 1.0 / 6.0;\n  float v2 \x3d v * v;\n  float v3 \x3d v2 * v;\n  float w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\n  float w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\n  float w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\n  float w3 \x3d b * v3;\n  return vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\n  vec4 w \x3d computeWeights(v);\n  float g0 \x3d w.x + w.y;\n  float g1 \x3d w.z + w.w;\n  float h0 \x3d 1.0 - (w.y / g0) + v;\n  float h1 \x3d 1.0 + (w.w / g1) - v;\n  return vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\n  vec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\n  vec2 texel \x3d coords * texSize - 0.5;\n  vec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\n  vec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\n  vec2 coords10 \x3d coords + hgX.x * eX;\n  vec2 coords00 \x3d coords - hgX.y * eX;\n  vec2 coords11 \x3d coords10 + hgY.x * eY;\n  vec2 coords01 \x3d coords00 + hgY.x * eY;\n  coords10 \x3d coords10 - hgY.y * eY;\n  coords00 \x3d coords00 - hgY.y * eY;\n  vec4 color00 \x3d texture2D(sampler, coords00);\n  vec4 color10 \x3d texture2D(sampler, coords10);\n  vec4 color01 \x3d texture2D(sampler, coords01);\n  vec4 color11 \x3d texture2D(sampler, coords11);\n  color00 \x3d mix(color00, color01, hgY.z);\n  color10 \x3d mix(color10, color11, hgY.z);\n  color00 \x3d mix(color00, color10, hgX.z);\n  return color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 texelStart \x3d floor(coords * texSize);\n  vec2 coord0 \x3d texelStart / texSize;\n  vec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\n  vec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\n  vec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\n  vec4 color0 \x3d texture2D(sampler, coord0);\n  vec4 color1 \x3d texture2D(sampler, coord1);\n  vec4 color2 \x3d texture2D(sampler, coord2);\n  vec4 color3 \x3d texture2D(sampler, coord3);\n  vec2 blend \x3d fract(coords * texSize);\n  vec4 color01 \x3d mix(color0, color1, blend.x);\n  vec4 color23 \x3d mix(color2, color3, blend.x);\n  return mix(color01, color23, blend.y);\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\n  vec2 invSize \x3d 1.0 / texSize;\n  vec2 texel \x3d coords * texSize;\n  vec2 texel_i \x3d floor(texel);\n  vec2 texel_frac \x3d fract(texel);\n  vec4 colorP \x3d texture2D(sampler, texel_i * invSize);\n  vec4 colorP1 \x3d vec4(colorP);\n  vec4 colorP2 \x3d vec4(colorP);\n  vec4 colorP3 \x3d vec4(colorP);\n  vec4 colorP4 \x3d vec4(colorP);\n  vec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\n  vec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\n  vec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\n  vec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\n  if (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\n    colorP1 \x3d colorA;\n  }\n  if (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\n    colorP2 \x3d colorB;\n  }\n  if (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\n    colorP3 \x3d colorC;\n  }\n  if (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\n    colorP4 \x3d colorD;\n  }\n  vec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\n  vec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\n  return mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  vec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\n  float flags \x3d data0.r * 255.0;\n  float groupMinZoom \x3d data0.g * 255.0;\n  float isVisible \x3d getFilterBit(flags, 0);\n  float wouldClip \x3d step(groupMinZoom, u_zoomLevel);\n  float direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\n  float dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\n  vec4 nextState \x3d vec4(texel + direction * dt);\n  gl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  gl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_texture;\nmediump vec4 gauss4(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\n}\nmediump float gauss1(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\n  return u_channelSelector * sample;\n}\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\n  mediump vec4 w \x3d gauss4(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\n  weight +\x3d w;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\n  mediump float w \x3d gauss1(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\n  weight +\x3d w;\n}\nvoid main(void) {\n  mediump float tot \x3d 0.0;\n  mediump float weight \x3d 0.0;\n  accumGauss1(-4.0, tot, weight);\n  accumGauss1(-3.0, tot, weight);\n  accumGauss1(-2.0, tot, weight);\n  accumGauss1(-1.0, tot, weight);\n  accumGauss1(0.0, tot, weight);\n  accumGauss1(1.0, tot, weight);\n  accumGauss1(2.0, tot, weight);\n  accumGauss1(3.0, tot, weight);\n  accumGauss1(4.0, tot, weight);\n  gl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\n  mediump float sigma \x3d u_sigmas[3];\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\n  const mediump float y0 \x3d 0.5;\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);\n  mediump float d \x3d (y - y0) / m0;\n  return d;\n}\nmediump vec4 shade(mediump float d) {\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\n  mediump float d \x3d estimateDistance();\n  gl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\n  v_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlyTexture;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  lowp vec4 color \x3d texture2D(u_readbackTexture, v_texCoord);\n  color \x3d color + (1.0 - color.a) * u_background;\n  lowp vec4 mask_color \x3d texture2D(u_maskTexture, v_texCoord);\n  lowp float gray \x3d 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\n  color *\x3d gray;\n  lowp vec4 overley_color \x3d texture2D(u_overlyTexture, v_texCoord);\n  overley_color.rgb *\x3d overley_color.a;\n  gl_FragColor \x3d overley_color + (1.0 - overley_color.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec2 u_drawPos;\nuniform mediump float u_width;\nuniform mediump float u_height;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  v_texCoord \x3d a_pos;\n  vec2 coord \x3d u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\n  gl_Position \x3d vec4(coord, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec4 id) {\n  float size \x3d float(u_attributeTextureSize);\n  highp float u32 \x3d float(int(id.r) + int(id.g) * 256 + int(id.b) * 256 * 256 + int(id.a) * 256 * 256 * 256);\n  highp float col \x3d mod(u32, size);\n  highp float row \x3d (u32 - col) / size;\n  highp float u \x3d col / size;\n  highp float v \x3d row / size;\n  return vec2(u, v);\n}\nhighp vec4 getAttributeData0(in highp vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData3, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\n  bool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\n  if (isMagic) {\n    return NAN_MAGIC_NUMBER;\n  }\n  return (v.x + v.y * float(0x100)) - 32768.0;\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.0000001;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;",
"effects.glsl":"uniform highp mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp float u_insideOpacities[ MAX_FILTER_COUNT ];\nuniform highp float u_outsideOpacities[ MAX_FILTER_COUNT ];\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  return vec4(rgbw.rgb * a, a);\n}\nvec3 applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 0; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  color.rgb \x3d rgbw.rgb * a;\n  color.a \x3d a;\n  pos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef HIGHLIGHT\n  pos.z +\x3d 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n  return pos;\n}\nvec3 applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  float bit \x3d getFilterBit(filterFlags, 0);\n  pos.z +\x3d 2.0 * (1.0 - bit);\n#ifndef OUTSIDE_LABELS_VISIBLE\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    pos.z +\x3d 2.0 * (1.0 - bit);\n  }\n#endif\n  return pos;\n}",
fill:{"common.glsl":"#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\n#endif\n#ifdef DOT_DENSITY\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying vec3 v_pos;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying highp float v_flags;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nvarying vec4 v_dotThresholds[ 2 ];\nvarying vec2 v_dotTextureCoords;\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\n#include \x3cmaterials/effects.glsl\x3e\n#endif\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#ifdef DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\nvoid main() {\n#ifdef ID\n  gl_FragColor \x3d v_id;\n#elif defined(PATTERN)\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_opacity * v_color * color;\n#elif defined(DOT_DENSITY) \x26\x26 !defined(HIGHLIGHT)\n  vec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\n  vec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\n  vec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\n  vec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\n  vec4 isPositive0 \x3d step(0.0, difference0);\n  vec4 isPositive1 \x3d step(0.0, difference1);\n  float weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\n  float lessThanEqZero \x3d step(weightSum, 0.0);\n  float greaterThanZero \x3d 1.0 - lessThanEqZero ;\n  float divisor \x3d (weightSum + lessThanEqZero);\n  vec4 weights0 \x3d difference0 * isPositive0 / divisor;\n  vec4 weights1 \x3d difference1 * isPositive1 / divisor;\n  vec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\n  vec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\n  float diffMax \x3d max(max4(difference0), max4(difference1));\n  float lessThanZero \x3d step(diffMax, 0.0);\n  float greaterOrEqZero \x3d 1.0 - lessThanZero;\n  vec4 isMax0 \x3d step(diffMax, difference0);\n  vec4 isMax1 \x3d step(diffMax, difference1);\n  vec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\n  vec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\n  gl_FragColor \x3d getEffectColor(preEffectColor, v_flags);\n#else\n  gl_FragColor \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d 1.0;\n#endif\n}",
"fill.vert":"precision mediump float;\n#ifdef DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec4 a_aux3 \x3d vec4(0.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_tlbr;\nattribute vec4 a_aux1;\nattribute vec2 a_aux2;\nattribute vec4 a_aux3;\n#endif\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef PATTERN\nmat3 getPatternMatrix() {\n  mat3 patternMatrix \x3d mat3(1.0);\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux1.x * aux2.x);\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux1.y * aux2.y);\n  return patternMatrix;\n}\n#endif\nvoid main()\n{\n  INIT;\n  float a_bitSet \x3d a_aux3.a;\n  v_color     \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity   \x3d getOpacity(a_bitSet, 1);\n  v_id        \x3d norm(a_id);\n  v_pos       \x3d u_dvsMat3 * vec3(a_pos, 1.);\n  v_flags     \x3d getFilterFlags();\n#ifdef PATTERN\n  vec2 symbolOffset \x3d u_zoomFactor * (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED);\n  v_tileTextureCoord \x3d (getPatternMatrix() * vec3(a_pos + symbolOffset, 1.0)).xy;\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\n#elif defined(DOT_DENSITY)\n  vec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\n  vec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\n  float size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\n  v_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\n  v_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\n  v_dotTextureCoords \x3d (a_pos + 0.5) / size;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_flags), 1.0);\n}"},
icon:{"common.glsl":"uniform vec2 u_mosaicSize;\nvarying vec3 v_pos;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying vec2 v_tex;\nvarying vec2 v_size;\nvarying float v_filters;\n#ifdef SDF\nvarying float v_isThin;\nvarying float v_overridingOutlineColor;\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\n#endif","icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  float outlineWidth \x3d v_outlineWidth;\n  #ifdef HIGHLIGHT\n    outlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n  #endif\n  if (outlineWidth \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\n    float clampedOutlineSize \x3d min(outlineWidth, size);\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\n    gl_FragColor \x3d v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_opacity * fillPixelColor;\n  }\n#else\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n   gl_FragColor \x3d v_opacity * getEffectColor(texColor, v_filters);\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec4 a_bitSetAndDistRatio;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\n#ifdef VV_SIZE\n  float r \x3d getSize(baseSize.y) / referenceSize;\n  baseSize.xy *\x3d r;\n  offset.xy *\x3d r;\n  float scaleSymbolProportionally \x3d getBit(bitSet, 3);\n  outlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\n  return baseSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\n  float isMapAligned \x3d getBit(a_bitSet, 0);\n  vec3  offset       \x3d getRotation() * vec3(in_offset, 0.0);\n  return getMatrix(isMapAligned) * offset;\n}\nvoid main()\n{\n  INIT;\n  vec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 256.0;\n  vec2  a_offset \x3d a_vertexOffset / 16.0;\n  float a_outlineSize \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 256.0;\n  float a_bitSet \x3d a_bitSetAndDistRatio.z;\n  v_color    \x3d getColor(a_color, a_bitSet, 1);\n  v_opacity  \x3d getOpacity(a_bitSet, 1);\n  v_size     \x3d getMarkerSize(a_offset, a_size, a_outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 256.0, a_bitSet);\n  v_id       \x3d norm(a_id);\n  v_filters  \x3d getFilterFlags();\n  v_tex      \x3d a_texCoords / u_mosaicSize;\n  v_pos      \x3d u_dvsMat3 * vec3(a_pos, 1.0) + getOffset(a_offset, a_bitSet);\n#ifdef SDF\n  v_isThin   \x3d getBit(a_bitSet, 2);\n  #ifdef VV_COLOR\n    v_overridingOutlineColor \x3d v_isThin;\n  #else\n    v_overridingOutlineColor \x3d 0.0;\n  #endif\n  v_outlineWidth \x3d min(a_outlineSize, max(max(v_size.x, v_size.y) - 0.99, 0.0));\n  v_outlineColor \x3d getEffectColor(a_outlineColor, v_filters);\n  v_distRatio \x3d a_bitSetAndDistRatio.w / 126.0;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_filters), 1.0);\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nuniform vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"precision mediump float;\n#include \x3cmaterials/label/common.glsl\x3e\nuniform mediump vec2 u_screenSize;\nuniform highp float u_pixelRatio;\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  mediump vec2 refTextPos \x3d gl_FragCoord.xy / (u_pixelRatio * u_screenSize.xy);\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  lowp float sdfAlpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist);\n  gl_FragColor \x3d v_animation.r * sdfAlpha * v_color;\n}",
"label.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_zoomRangeAndEmpty;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/label/common.glsl\x3e\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\n  float glyphAngle \x3d angle * 360.0 / 254.0;\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\n  float z \x3d 0.0;\n  z +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_zoomLevel)));\n  z +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\n  return z;\n}\nvoid main()\n{\n  INIT;\n  float groupMinZoom    \x3d getMinZoom();\n  float glyphMinZoom    \x3d a_zoomRangeAndEmpty.x;\n  float a_minZoom       \x3d max(groupMinZoom, glyphMinZoom);\n  float a_maxZoom       \x3d a_zoomRangeAndEmpty.y;\n  vec2  a_placementDir  \x3d a_refSymbolAndPlacementOffset.zw - 1.0;\n  float a_refSymbolSize \x3d a_refSymbolAndPlacementOffset.y;\n  float fontSize        \x3d a_texAndSize.z;\n  float isHalo          \x3d mod(a_pos, 2.0).x;\n  vec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  pos          \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float z            \x3d getZ(a_minZoom, a_maxZoom, a_refSymbolAndPlacementOffset.x);\n  float fontScale    \x3d fontSize / SDF_FONT_SIZE;\n  float halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\n  v_color     \x3d a_color;\n  v_tex       \x3d a_texAndSize.xy / u_mosaicSize;\n  v_animation \x3d pow(getAnimationState(), vec4(2.0));\n  v_edgeDistanceOffset \x3d isHalo * OUTLINE_SCALE * a_texAndSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.106 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  vec2 placementOffset \x3d a_placementDir * (halfSize + PLACEMENT_PADDING);\n  vec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\n  vec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\n  gl_Position \x3d vec4(applyFilterLabels(v_color, v_pos, getFilterFlags()), 1.0);\n#ifdef DEBUG\n  v_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying vec3 v_pos;\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif","line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nuniform lowp float u_blur;\nuniform mediump float u_zoomFactor;\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\n#endif\n#ifdef SDF\nconst float sdfPatternHalfWidth \x3d 15.5;\nconst float widthFactor \x3d 2.0;\n#endif\nvoid main()\n{\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\n  float dist \x3d d * lineHalfWidth;\n  lowp vec4 fillPixelColor \x3d v_opacity * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n  gl_FragColor \x3d fillPixelColor;\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT)\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d v_opacity * alpha * v_color * color;\n#else\n  gl_FragColor \x3d v_opacity * alpha * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nconst float SCALE \x3d 1.0 / 31.0;\nfloat getBaseLineHalfWidth(in float in_lineHalfWidth) {\n#ifdef VV_SIZE\n  float referenceHalfWidth \x3d a_aux.x * SCALE;\n  float lineWidth \x3d 2.0 * in_lineHalfWidth;\n  return 0.5 * (in_lineHalfWidth / referenceHalfWidth) * getSize(lineWidth);\n#else\n  return in_lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\n  float halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\n  halfWidth \x3d max(halfWidth, 2.0);\n#endif\n  return halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\n  float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  thinLineFactor *\x3d 2.0;\n#endif\n  return thinLineFactor * halfWidth * offset * SCALE;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet          \x3d a_segmentDirection.w;\n  float a_accumulatedDist \x3d a_accumulatedDistanceAndHalfWidth.x;\n  float a_lineHalfWidth   \x3d a_accumulatedDistanceAndHalfWidth.y * SCALE;\n  float aa                \x3d 0.5 * u_antialiasing;\n  vec2  a_offset          \x3d a_offsetAndNormal.xy;\n  float baseWidth \x3d getBaseLineHalfWidth(a_lineHalfWidth);\n  float halfWidth \x3d getLineHalfWidth(baseWidth, aa);\n  float z         \x3d 2.0 * step(baseWidth, 0.0);\n  vec2  dist      \x3d getDist(a_offset, halfWidth);\n  vec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\n  vec3  pos       \x3d u_dvsMat3 * vec3(a_pos.xy, 1.0) + offset;\n  v_color         \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity       \x3d getOpacity(a_bitSet, 0);\n  v_lineHalfWidth \x3d halfWidth;\n  v_id            \x3d norm(a_id);\n  v_normal        \x3d a_offsetAndNormal.zw * SCALE;\n  v_pos           \x3d vec3(pos.xy, z);\n#ifdef PATTERN\n  v_tlbr          \x3d a_tlbr / u_mosaicSize.xyxy;\n  v_patternSize   \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\n#endif\n#if defined(PATTERN) || defined(SDF)\n  v_accumulatedDistance \x3d a_accumulatedDist + dot(SCALE * a_segmentDirection.xy, dist / u_zoomFactor);\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
text:{"common.glsl":"uniform vec2 u_mosaicSize;\nvarying highp vec4 v_id;\nvarying vec3 v_pos;\nvarying vec4 v_color;\nvarying vec2 v_tex;\nvarying float v_opacity;\nvarying float v_antialiasingWidth;\nvarying float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  #ifdef HIGHLIGHT\n    glyphEdgeDistance /\x3d 2.0;\n  #endif\n  lowp float alpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_opacity;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"precision mediump float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nfloat getTextSize(inout vec2 offset, in float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\n   float ratio \x3d baseSize / referenceSize;\n   baseSize \x3d ratio * getSize(baseSize);\n#endif\n  return baseSize;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet    \x3d a_aux.w;\n  float a_fontSize  \x3d a_texFontSize.z;\n  vec2  a_offset    \x3d a_vertexOffset * OFFSET_PRECISION;\n  float a_isHalo    \x3d getBit(a_pos.x, 0);\n  vec3  in_pos      \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float fontSize    \x3d getTextSize(a_offset, a_fontSize, a_aux.z * a_aux.z / 256.0);\n  float scaleFactor \x3d fontSize / a_fontSize;\n  float fontScale   \x3d fontSize / SDF_FONT_SIZE;\n  vec3  offset      \x3d getRotation() * vec3(scaleFactor * a_offset, 0.0);\n  v_color   \x3d a_isHalo * a_color + (1.0 - a_isHalo) * getColor(a_color, a_bitSet, 0);\n  v_opacity \x3d getOpacity(a_bitSet, 0);\n  v_id      \x3d norm(a_id);\n  v_tex     \x3d a_texFontSize.xy / u_mosaicSize;\n  v_pos     \x3d u_dvsMat3 * in_pos + u_displayMat3 * offset;\n  v_edgeDistanceOffset \x3d a_isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  gl_Position \x3d  vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\n  return floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\n  return getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\n  return getBit(bitset, 0);\n}\nvec4 unpack(in float u32) {\n  float r \x3d mod(rshift(u32, 0), 255.0);\n  float g \x3d mod(rshift(u32, 8), 255.0);\n  float b \x3d mod(rshift(u32, 16), 255.0);\n  float a \x3d mod(rshift(u32, 24), 255.0);\n  return vec4(r, g, b, a);\n}\nvec4 norm(in vec4 v) {\n  return v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\n  return max(max(max(target.x, target.y), target.z), target.w);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec4 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef OES_TEXTURE_FLOAT\n  target.rgba \x3d getAttributeData2(a_id);\n#else\n  vec4 data0 \x3d getAttributeData2(a_id);\n  vec4 data1 \x3d getAttributeData3(a_id);\n  target.r \x3d u88VVToFloat(data0.rg * 255.0);\n  target.g \x3d u88VVToFloat(data0.ba * 255.0);\n  target.b \x3d u88VVToFloat(data1.rg * 255.0);\n  target.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n  #define INIT loadVisualVariableData(VV_ADATA)\n#else\n  #define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\n  float isColorLocked   \x3d getBit(a_bitSet, index);\n  return getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\n  return a_color;\n#endif\n}\nfloat getOpacity(in float a_bitSet, in int index) {\n#ifdef VV_OPACITY\n  float isOpacityLocked \x3d getBit(a_bitSet, index);\n  return getVVOpacity(VV_ADATA[ATTR_VV_OPACITY], isOpacityLocked);\n#else\n  return 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\n  return getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\n  return in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\n  return getVVRotationMat3(VV_ADATA[ATTR_VV_ROTATION]);\n#else\n  return mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\n  return ceil(getAttributeData0(a_id).x * 255.0);\n#else\n  return getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\n  return getAttributeData1(a_id);\n}\nfloat getMinZoom() {\n  vec4 data0 \x3d getAttributeData0(a_id) * 255.0;\n  return data0.g;\n}\nmat3 getMatrix(float isMapAligned) {\n  return isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n  #define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n  #define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\n  return (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\n    return u_vvSizeFieldStopsSizes[0];\n  }\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n    }\n  }\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue, float isOpacityLocked) {\n  if (isNan(opacityValue) || isOpacityLocked \x3d\x3d 1.0) {\n    return 1.0;\n  }\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\n    return u_vvOpacities[0];\n  }\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n    }\n  }\n  return u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat4(1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat4(cosA, sinA, 0, 0,\n              -sinA,  cosA, 0, 0,\n              0,     0, 1, 0,\n              0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat3(1, 0, 0,\n                0, 1, 0,\n                0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * -rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat3(cosA, -sinA, 0,\n             sinA, cosA, 0,\n              0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\n  if (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\n    return fallback;\n  }\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\n    return u_vvColors[0];\n  }\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\n    }\n  }\n  return u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\n  return getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\n  return u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\n  return getVVStopsSize(vvSize, size);\n#elif defined(VV_SIZE_UNIT_VALUE)\n  return getVVUnitValue(vvSize, size);\n#else\n  return size;\n#endif\n}"},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\n  vec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},
stencil:{"stencil.frag":"void main() {\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nvoid main() {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require","exports","./sources/resolver"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.tileInfo={name:"tileInfo",shaders:{vertexShader:m.resolveIncludes("tileInfo/tileInfo.vert"),
fragmentShader:m.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._color=k.vec4f32.fromValues(1,
0,0,1);c._initialized=!1;return c}m(d,a);d.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};d.prototype.prepareState=function(a,b){a=a.context;a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setStencilFunctionSeparate(1032,
516,b.stencilRef,255)};d.prototype.draw=function(a,b){a=a.context;this._initialized||this._initialize(a);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);this._solidProgram.setUniform2fv("u_coord_range",b.size);this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);a.drawArrays(5,0,4);a.bindVAO()};d.prototype._initialize=function(a){if(this._initialized)return!0;
var b=h.createProgram(a,g.background);if(!b)return!1;var c=new Int8Array([0,0,1,0,0,1,1,1]),c=h.BufferObject.createVertex(a,35044,c);a=new h.VertexArrayObject(a,g.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:c});this._solidProgram=b;this._solidVertexArrayObject=a;return this._initialized=!0};return d}(d.default);a.default=n})},"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/events ../../../core/has ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/libs/gl-matrix-2/common ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../webgl ./Container ./webgl/BitBlitRenderer ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/Profiler ./webgl/WebGLDriverTest ./webgl/shaders/StencilPrograms ../support/Timeline ../../support/screenshotUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function k(b,c){var e=a.call(this)||this;e._renderParameters={drawPhase:0,state:e.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1};e._clipData=new Float32Array(8);e._upperLeft=r.vec2f64.create();e._upperRight=r.vec2f64.create();e._lowerLeft=r.vec2f64.create();e._lowerRight=r.vec2f64.create();e._mat2=p.mat2df64.create();e._clipRendererInitialized=!1;e._supersampleScreenshots=
!0;e.stage=e;e._stationary=!0;e.attached=!0;var l=c.canvas,l=void 0===l?document.createElement("canvas"):l,k=c.alpha,m=c.stencil,q=c.renderContext,n=c.supersampleScreenshots,n=void 0===n?!0:n,u=c.contextOptions,u=void 0===u?{}:u;e._canvas=l;k=w.createContextOrErrorHTML(l,{alpha:void 0===k?!0:k,antialias:!1,depth:!0,stencil:void 0===m?!0:m},void 0===q?"webgl":q);e.context=new w.RenderingContext(k,u);e.painter=new x.default(e.context);e._taskHandle=f.addFrameTask({render:function(){return e.renderFrame()}});
e._taskHandle.pause();e._supersampleScreenshots=n;e._lostWebGLContextHandle=d.on(l,"webglcontextlost",function(){e.emit("webgl-error",{error:new h("webgl-context-lost")})});g("esri-2d-profiler")&&(e._debugOutput=document.createElement("div"),e._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),b.appendChild(e._debugOutput));l.setAttribute("style","width: 100%; height:100%; display:block;");e.profiler=new z.Profiler(e.context,e._debugOutput);e.renderingOptions=
c.renderingOptions;e.timeline=c.timeline||new B.Timeline;e.driverTestResult=A.testWebGLDriver(e.context);b.appendChild(l);return e}m(k,a);k.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&
(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this.painter.dispose();this.context.dispose();this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput);this._canvas=null};Object.defineProperty(k.prototype,"background",{get:function(){return this._background},
set:function(a){this._background=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){var b=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null);if(this._highlightOptions=a)this._highlightOptionsHandle=c.init(this._highlightOptions,"version",function(){b.painter.setHighlightOptions(a);b.requestRender()})},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"renderingOptions",{get:function(){return this._renderingOptions},set:function(a){this._renderingOptions=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"state",{get:function(){return this._state},set:function(a){this._state=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"stationary",{get:function(){return this._stationary},set:function(a){this._stationary!==a&&(this._stationary=
a,this.requestRender())},enumerable:!0,configurable:!0});k.prototype.requestRender=function(){this._lastRenderRequestTime=Date.now();this._taskHandle&&this._taskHandle.resume()};k.prototype.renderFrame=function(){var a=Date.now()-this._lastRenderRequestTime;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this.processRender(this._renderParameters);a>=y.MAX_ANIMATION_TIME_MS&&
this._taskHandle.pause()};k.prototype.renderChildren=function(a){var b=this.context,c=this.children,c=a.children?a.children:c;this.profiler.recordStart("drawLayers");this.beforeRenderChildren(a);a.drawPhase=t.WGLDrawPhase.MAP;this.painter.beforeRenderLayers(b);for(var d=0;d<c.length;d++){var e=c[d];e.attached&&e.processRender(a)}this.painter.renderLayers(b);a.drawPhase=t.WGLDrawPhase.LABEL;this.painter.beforeRenderLayers(b);for(d=0;d<c.length;d++)e=c[d],e.attached&&e.processRender(a);this.painter.renderLayers(b);
this.profiler.recordEnd("drawLayers");this.afterRenderChildren()};k.prototype.beforeRenderChildren=function(a){var c=this.context,d=a.state,f=a.pixelRatio;if(this.painter){c.enforceState();var g=d.size;a=d.rotation;var h=Math.round(g[0]*f),g=Math.round(g[1]*f);this._boundFBO=c.getBoundFramebufferObject();if(d.spatialReference&&(d.spatialReference._isWrappable?d.spatialReference._isWrappable():d.spatialReference.isWrappable)){var l=b.common.toRadian(a),k=Math.abs(Math.cos(l)),m=Math.abs(Math.sin(l)),
p=Math.round(d.worldScreenWidth);if(Math.round(h*k+g*m)<=p)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===h&&this._clipFBO.height===g||(this._clipFBO=new w.FramebufferObject(c,{colorTarget:0,depthStencilTarget:3,width:h,height:g}));var n=(this.state.padding.left-this.state.padding.right)/2,r=(this.state.padding.bottom-this.state.padding.top)/2,u=.5*h,t=.5*g,d=1/h,v=1/g,f=.5*p*f,y=.5*(h*m+g*k),h=this._upperLeft,k=this._upperRight,m=this._lowerLeft,p=this._lowerRight;q.vec2.set(h,-f,-y);
q.vec2.set(k,f,-y);q.vec2.set(m,-f,y);q.vec2.set(p,f,y);e.mat2d.identity(this._mat2);e.mat2d.translate(this._mat2,this._mat2,[u+n,t+r]);0!==a&&e.mat2d.rotate(this._mat2,this._mat2,l);q.vec2.transformMat2d(h,h,this._mat2);q.vec2.transformMat2d(k,k,this._mat2);q.vec2.transformMat2d(m,m,this._mat2);q.vec2.transformMat2d(p,p,this._mat2);a=this._clipData;a.set([2*m[0]*d-1,2*(g-m[1])*v-1,2*p[0]*d-1,2*(g-p[1])*v-1,2*h[0]*d-1,2*(g-h[1])*v-1,2*k[0]*d-1,2*(g-k[1])*v-1]);this._clipRendererInitialized||this._initializeClipRenderer(c);
this._clipVBO.setData(a);this._boundFBO=c.getBoundFramebufferObject();c.bindFramebuffer(this._clipFBO);c.setDepthWriteEnabled(!0);c.setStencilWriteMask(255);c.setClearColor(0,0,0,0);c.setClearDepth(1);c.setClearStencil(0);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT);c.setDepthWriteEnabled(!1);this._clipFrame=!0}}else this._clipFrame=!1}};k.prototype.afterRenderChildren=function(){var a=this.context;a.logIno();this._clipFrame&&this._clipRendererInitialized&&(a.bindFramebuffer(this._boundFBO),
this._boundFBO=null,a.bindVAO(this._clipVAO),a.bindProgram(this._clipStencilProgram),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!1),a.setColorMask(!1,!1,!1,!1),a.setStencilOp(7680,7680,7681),a.setStencilWriteMask(255),a.setStencilFunction(519,1,255),a.drawElements(4,6,5123,0),a.bindVAO(),a.setColorMask(!0,!0,!0,!0),a.setBlendingEnabled(!0),a.setStencilFunction(514,1,255),this._blitRenderer.render(a,this._clipFBO.colorTexture,9728,1),a.setStencilTestEnabled(!1))};
k.prototype.doRender=function(b){var c=this.context,d=b.state,e=b.pixelRatio;this._resizeCanvas(b);this.context.enforceState();c.setViewport(0,0,e*d.size[0],e*d.size[1]);c.setDepthWriteEnabled(!0);c.setStencilWriteMask(255);this.background&&this.background.color?(d=this.background.color,c.setClearColor(d.r/255,d.g/255,d.b/255,d.a)):c.setClearColor(0,0,0,0);c.setClearDepth(1);c.setClearStencil(0);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT);c.setDepthWriteEnabled(!1);
a.prototype.doRender.call(this,b)};k.prototype.takeScreenshot=function(a,b){var c=G.screenshotSuperSampleSettings(a,this._supersampleScreenshots),d=c.framebufferWidth,e=c.framebufferHeight,f=this.context,g=a.layers,h={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:c.pixelRatio};if(null!=a.rotation){var k=h.state.viewpoint;k.rotation=a.rotation;h.state.viewpoint=k}0<g.length&&(h.children=[],g.forEach(function(a){var c=b.find(function(b){return b.layer.id===
a.id});c&&c.container&&c.attached&&h.children.push(c.container)}));var m=w.FramebufferObject.create(f,{colorTarget:0,depthStencilTarget:3,width:d,height:e}),g=f.getBoundFramebufferObject(),k=f.getViewport();f.bindFramebuffer(m);f.setViewport(0,0,d,e);d=f.gl;!a.ignoreBackground&&this.background&&this.background.color?(e=this.background.color,f.setClearColor(e.r/255,e.g/255,e.b/255,e.a)):f.setClearColor(0,0,0,0);f.setClearDepth(1);f.setClearStencil(0);f.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);
this.renderChildren(h);c=this._readbackScreenshot(c);f.bindFramebuffer(g);f.setViewport(k.x,k.y,k.width,k.height);this.requestRender();f=this._ensureScreenshotEncodeCanvas();a=G.encodeResult(c,a,f,{flipY:!0,premultipliedAlpha:!0});return l.resolve(a)};k.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};k.prototype._readbackScreenshot=function(a){var b=a.framebufferWidth,
c=a.framebufferHeight,d=a.region;a=a.resample;var e=this.context.gl;if(a){var f=G.createEmptyImageData(b,c,this._ensureScreenshotEncodeCanvas());e.readPixels(0,0,b,c,6408,5121,new Uint8Array(f.data.buffer));b=G.createEmptyImageData(d.width,d.height,this._ensureScreenshotEncodeCanvas());return G.resampleHermite(f,b,!0,a.region.x,c-(a.region.y+a.region.height),a.region.width,a.region.height)}f=G.createEmptyImageData(d.width,d.height,this._ensureScreenshotEncodeCanvas());e.readPixels(d.x,c-(d.y+d.height),
d.width,d.height,6408,5121,new Uint8Array(f.data.buffer));return f};k.prototype._resizeCanvas=function(a){var b=this._canvas,c=b.style,d=a.state.size,e=a.pixelRatio;a=d[0];var d=d[1],f=Math.round(a*e),e=Math.round(d*e);if(b.width!==f||b.height!==e)b.width=f,b.height=e;c.width=a+"px";c.height=d+"px"};k.prototype._initializeClipRenderer=function(a){if(this._clipRendererInitialized)return!0;this._blitRenderer=new v.BitBlitRenderer;var b=E.stencil.attributes,c=w.createProgram(a,E.stencil);if(!c)return!1;
var d=w.BufferObject.createVertex(a,35040,32),e=new Uint16Array([0,1,2,2,1,3]),e=w.BufferObject.createIndex(a,35044,e);a=new w.VertexArrayObject(a,b,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:d},e);this._clipStencilProgram=c;this._clipVBO=d;this._clipVAO=a;return this._clipRendererInitialized=!0};return k}(u.Container);a.Stage=n})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(n,a,m){Object.defineProperty(a,
"__esModule",{value:!0});a.common=m})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat2d=m})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(n,a,m){function k(a,g,h){var d=g[0],c=g[1],b=g[2],e=g[3],l=g[4];g=g[5];var k=h[0],m=h[1],n=h[2],u=h[3],v=h[4];h=h[5];a[0]=d*k+b*m;a[1]=c*k+e*m;a[2]=d*n+b*u;a[3]=c*n+e*u;a[4]=d*v+b*h+l;a[5]=c*v+e*
h+g;return a}function h(a,g,h){a[0]=g[0]-h[0];a[1]=g[1]-h[1];a[2]=g[2]-h[2];a[3]=g[3]-h[3];a[4]=g[4]-h[4];a[5]=g[5]-h[5];return a}Object.defineProperty(a,"__esModule",{value:!0});a.copy=function(a,g){a[0]=g[0];a[1]=g[1];a[2]=g[2];a[3]=g[3];a[4]=g[4];a[5]=g[5];return a};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};a.set=function(a,g,h,f,c,b,e){a[0]=g;a[1]=h;a[2]=f;a[3]=c;a[4]=b;a[5]=e;return a};a.invert=function(a,g){var d=g[0],f=g[1],c=g[2],b=g[3],e=g[4];g=g[5];var h=
d*b-f*c;if(!h)return null;h=1/h;a[0]=b*h;a[1]=-f*h;a[2]=-c*h;a[3]=d*h;a[4]=(c*g-b*e)*h;a[5]=(f*e-d*g)*h;return a};a.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};a.multiply=k;a.rotate=function(a,g,h){var d=g[0],c=g[1],b=g[2],e=g[3],l=g[4];g=g[5];var k=Math.sin(h);h=Math.cos(h);a[0]=d*h+b*k;a[1]=c*h+e*k;a[2]=d*-k+b*h;a[3]=c*-k+e*h;a[4]=l;a[5]=g;return a};a.scale=function(a,g,h){var d=g[1],c=g[2],b=g[3],e=g[4],l=g[5],k=h[0];h=h[1];a[0]=g[0]*k;a[1]=d*k;a[2]=c*h;a[3]=b*h;a[4]=e;a[5]=l;return a};
a.translate=function(a,g,h){var d=g[0],c=g[1],b=g[2],e=g[3],l=g[4];g=g[5];var k=h[0];h=h[1];a[0]=d;a[1]=c;a[2]=b;a[3]=e;a[4]=d*k+b*h+l;a[5]=c*k+e*h+g;return a};a.fromRotation=function(a,g){var d=Math.sin(g);g=Math.cos(g);a[0]=g;a[1]=d;a[2]=-d;a[3]=g;a[4]=0;a[5]=0;return a};a.fromScaling=function(a,g){a[0]=g[0];a[1]=0;a[2]=0;a[3]=g[1];a[4]=0;a[5]=0;return a};a.fromTranslation=function(a,g){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=g[0];a[5]=g[1];return a};a.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+
a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};a.add=function(a,g,h){a[0]=g[0]+h[0];a[1]=g[1]+h[1];a[2]=g[2]+h[2];a[3]=g[3]+h[3];a[4]=g[4]+h[4];a[5]=g[5]+h[5];return a};a.subtract=h;a.multiplyScalar=function(a,g,h){a[0]=g[0]*h;a[1]=g[1]*h;a[2]=g[2]*h;a[3]=g[3]*h;a[4]=g[4]*h;a[5]=g[5]*h;return a};a.multiplyScalarAndAdd=function(a,g,h,f){a[0]=g[0]+h[0]*f;a[1]=g[1]+h[1]*
f;a[2]=g[2]+h[2]*f;a[3]=g[3]+h[3]*f;a[4]=g[4]+h[4]*f;a[5]=g[5]+h[5]*f;return a};a.exactEquals=function(a,g){return a[0]===g[0]&&a[1]===g[1]&&a[2]===g[2]&&a[3]===g[3]&&a[4]===g[4]&&a[5]===g[5]};a.equals=function(a,g){var d=a[0],f=a[1],c=a[2],b=a[3],e=a[4];a=a[5];var h=g[0],k=g[1],n=g[2],w=g[3],u=g[4];g=g[5];return Math.abs(d-h)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(f-k)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(c-n)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(n))&&
Math.abs(b-w)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(e-u)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(a-g)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))};a.mul=k;a.sub=h})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports","./factories/mat2df64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat2df64=m})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});a.create=function(){return[1,0,0,1,0,0]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5]]};a.fromValues=function(a,k,h,d,g,l){return[a,k,h,d,g,l]};a.createView=function(a,k){return new Float64Array(a,k,6)}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define(["require","exports","../../../webgl","./shaders/BitBlitPrograms"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._initialized=!1}a.prototype.dispose=
function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};a.prototype.render=function(a,g,h,f){a&&(this._initialized||this._initialize(a),a.setBlendFunctionSeparate(1,771,1,771),a.bindVAO(this._vertexArrayObject),a.bindProgram(this._program),g.setSamplingMode(h),a.bindTexture(g,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",f),a.drawArrays(5,0,4),a.bindVAO())};a.prototype._initialize=
function(a){if(this._initialized)return!0;var d=k.bitBlit.attributes,h=m.createProgram(a,k.bitBlit);if(!h)return!1;var f=new Int8Array(16);f[0]=-1;f[1]=-1;f[2]=0;f[3]=0;f[4]=1;f[5]=-1;f[6]=1;f[7]=0;f[8]=-1;f[9]=1;f[10]=0;f[11]=1;f[12]=1;f[13]=1;f[14]=1;f[15]=1;a=new m.VertexArrayObject(a,d,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:m.BufferObject.createVertex(a,35044,f)});
this._program=h;this._vertexArrayObject=a;return this._initialized=!0};return a}();a.BitBlitRenderer=n})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require","exports","./sources/resolver"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.bitBlit={name:"bitBlit",shaders:{vertexShader:m.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:m.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,a_tex:1}}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.WEBGL_MAX_STOPS=8;a.WEBGL_MAX_INNER_STOPS=a.WEBGL_MAX_STOPS-2;a.NAN_MAGIC_NUMBER=1E-30;a.EXTRUDE_SCALE=64;a.PICTURE_FILL_COLOR=4294967295;a.TILE_SIZE=512;a.RASTER_TILE_SIZE=256;a.ANGLE_FACTOR_256=256/360;a.DEBUG_LABELS=!1;a.COLLISION_BUCKET_SIZE=128;a.DOT_DENSITY_MAX_FIELDS=8;a.COLLISION_MAX_ZOOM_DELTA=3;a.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;a.COLLISION_BOX_PADDING=16;a.COLLISION_TILE_BOX_SIZE=a.TILE_SIZE/a.COLLISION_BUCKET_SIZE;
a.COLLISION_PLACEMENT_PADDING=8;a.HEURISTIC_GLYPHS_PER_LINE=50;a.HEURISTIC_GLYPHS_PER_FEATURE=10;a.GLYPH_SIZE=24;a.TEXT_LINE_HEIGHT=1.2*a.GLYPH_SIZE;a.TEXT_MAX_WIDTH=10*a.GLYPH_SIZE;a.TEXT_SPACING=0;a.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};a.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;a.TEXTURE_BINDING_SPRITE_ATLAS=0;a.TEXTURE_BINDING_GLYPH_ATLAS=0;a.TEXTURE_BINDING_BITMAP=0;a.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;a.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;a.TEXTURE_BINDING_ATTRIBUTE_DATA_2=
3;a.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;a.TEXTURE_BINDING_HIGHLIGHT_0=5;a.TEXTURE_BINDING_HIGHLIGHT_1=6;a.TEXTURE_BINDING_RENDERER_0=5;a.TEXTURE_BINDING_RENDERER_1=6;a.ATTRIBUTE_DATA_FILTER_FLAGS=0;a.ATTRIBUTE_DATA_ANIMATION=1;a.ATTRIBUTE_DATA_VV=2;a.ATTRIBUTE_DATA_DD0=3;a.ATTRIBUTE_DATA_DD1=3;a.MAX_FILTERS=2;a.HIGHLIGHT_FLAG=1;a.FILTER_FLAG_0=2;a.EFFECT_FLAG_0=4;a.THIN_LINE_THRESHOLD=2.5;a.HITTEST_SEARCH_SIZE=24;a.MAX_ANIMATION_TIME_MS=2E3})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl ../../engine ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./effects/AnimationEffect ./effects/HighlightEffect ./effects/HittestEffect ./painter/RenderPass".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});n=function(){return function(){}}();a.PainterOptions=n;n=function(){function a(a){this.context=a;this._blitRenderer=new d.BitBlitRenderer;this._brushCache=new Map;this.textureManager=new f;this.effects={highlight:new b.default,hittest:new e.HittestEffect,integrate:new c.AnimationEffect};this.materialManager=new l(a)}a.prototype.getFbos=function(a,b,c){if(b!==this._lastWidth||c!==this._lastHeight){this._lastWidth=
b;this._lastHeight=c;if(this._fbos)for(var d in this._fbos)this._fbos[d].dispose();a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:b,height:c};d={colorTarget:0,depthStencilTarget:3};b=new k.Renderbuffer(this.context,{width:b,height:c,internalFormat:34041});this._fbos={output:k.FramebufferObject.createWithAttachments(this.context,a,d,b),alpha:k.FramebufferObject.createWithAttachments(this.context,a,d,b),effect0:k.FramebufferObject.createWithAttachments(this.context,
a,d,b)}}return this._fbos};a.prototype.beforeRenderLayers=function(a){var b=a.getViewport(),b=this.getFbos(a,b.width,b.height);this._prevFBO=a.getBoundFramebufferObject();a.bindFramebuffer(b.output);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)};a.prototype.beforeRenderLayer=function(a,b,c){1!==c?(a.bindFramebuffer(this._fbos.alpha),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT)):a.bindFramebuffer(this._fbos.output);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);
a.setClearStencil(b);a.setStencilWriteMask(255);a.clear(a.gl.STENCIL_BUFFER_BIT)};a.prototype.compositeLayer=function(a,b){1!==b&&(a.bindFramebuffer(this._fbos.output),a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(1,771,1,771),a.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(a,this._fbos.alpha.colorTexture,9728,b))};a.prototype.renderLayers=function(a){a.bindFramebuffer(this._prevFBO);this._fbos&&(a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),
a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(1,771,1,771),a.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(a,this._fbos.output.colorTexture,9728,1))};a.prototype.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();this.effects.highlight.dispose();this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null)};a.prototype.getGeometryBrush=function(a){var b;a=(b={},b[g.WGLGeometryType.FILL]=h.brushes.Fill,b[g.WGLGeometryType.LINE]=h.brushes.Line,b[g.WGLGeometryType.MARKER]=
h.brushes.Marker,b[g.WGLGeometryType.TEXT]=h.brushes.Text,b)[a];this._brushCache.has(a)||this._brushCache.set(a,new a);return this._brushCache.get(a)};a.prototype.registerRenderPass=function(a){var b=this,c=a.brushes.map(function(a){b._brushCache.has(a)||b._brushCache.set(a,new a);return b._brushCache.get(a)});return new p.default(c,a)};a.prototype.setHighlightOptions=function(a){this.effects.highlight.setHighlightOptions(a)};return a}();a.default=n})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),
function(n,a,m,k,h,d,g){var l=function(a){return a===d.WGLDrawPhase.HITTEST||a===d.WGLDrawPhase.LABEL_ALPHA},f=function(a,b,e,f){f=f.reduce(function(b,c){var d;return m({},b,(d={},d[c]=a.driverTestResult[c],d))},{});b=m({},b.getVariation(),a.rendererInfo.getVariation(),{highlight:a.drawPhase===d.WGLDrawPhase.HIGHLIGHT,id:l(a.drawPhase)},f);if(k.isSome(e))for(f=0;f<e.length;f++)b[e[f]]=!0;return b};return function(){function a(a){this._programByKey=new Map;this._programCache=new h.ProgramCache(a)}
a.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};a.prototype.getProgram=function(a,c,d,f){void 0===d&&(d=[]);void 0===f&&(f=[]);var b=c.path+d.join(".")+f.join(".");if(this._programByKey.has(b))return this._programByKey.get(b);f=f.reduce(function(b,c){var d;return m({},b,(d={},d[c]=a.driverTestResult[c],d))},{});d=m({},d.reduce(function(a,b){var c;return m({},a,(c={},c[b]=!0,c))},{}),f);c=this._programCache.getProgram(g.createProgramTemplate(c.path,c.attributes),d);
if(!c)throw Error("Unable to get program for key: ${key}");this._programByKey.set(b,c);return c};a.prototype.getMaterialProgram=function(a,c,h,m,n,w){void 0===w&&(w=["ignoresSamplerPrecision"]);var b,e=w;b=a.rendererInfo;var p=a.drawPhase,e=c.getVariationHash()+"-"+e.join(".")+"-",p=(l(p)?1:0)|(p===d.WGLDrawPhase.HIGHLIGHT?2:0);b=e+p+"-"+b.getVariationHash()+"-"+(k.isSome(n)&&n.join("."));if(this._programByKey.has(b))return this._programByKey.get(b);a=f(a,c,n,w);h=this._programCache.getProgram(g.createProgramTemplate(h,
m),a);if(!h)throw Error("Unable to get program for key: ${key}");this._programByKey.set(b,h);return h};return a}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=function(a){var d={},h;for(h in a){for(var f=h,c=void 0,c=""+f[0].toUpperCase(),b=1;b<f.length;b++){var e=f[b];e===e.toUpperCase()?(c+="_",c+=e):c+=e.toUpperCase()}d[c]=a[h]}return m.glslifyDefineMap(d)};
a.createProgramTemplate=function(a,g){var d=a+a.substring(a.lastIndexOf("/"));return{name:name,attributes:g,shaders:function(a){return{vertexShader:h(a)+k.resolveIncludes(d+".vert"),fragmentShader:h(a)+k.resolveIncludes(d+".frag")}}}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../config ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../symbols/cim/Rasterizer ./definitions ./enums ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./util/Result ./util/symbolUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A){var E=p.vec2f32.create(),B=c.getLogger("esri.views.2d.engine.webgl.TextureManager"),G=function(){function a(a,b,c){this.mosaicType=a;this.page=b;this.sdf=c}a.fromMosaic=function(b,c){return new a(b,c.page,c.sdf)};return a}();return function(){function a(){this._invalidFontsMap=new Map;this._sdfConverter=new t.default(126);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._rasterizer=new q.default;this._spriteMosaic=new x(2048,2048,
500);this._glyphSource=new y(d.fontsUrl+"/{fontstack}/{range}.pbf");this._glyphMosaic=new v(1024,1024,this._glyphSource)}Object.defineProperty(a.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._rasterizer=this._glyphMosaic=
this._spriteMosaic=null};a.prototype._hashMosaic=function(a,b){return 1|a<<1|(b.sdf?1:0)<<2|b.page<<3};a.prototype._setTextureBinding=function(a,b){var c=this._hashMosaic(a,b);this._hashToBindingIndex.has(c)||(a=G.fromMosaic(a,b),this._hashToBindingIndex.set(c,this._bindingInfos.length+1),this._bindingInfos.push(a));b.textureBinding=this._hashToBindingIndex.get(c)};a.prototype.rasterizeItem=function(a,c,d){var e=this;void 0===c&&(c=null);return a?a.type&&-1!==a.type.toLowerCase().indexOf("3d")?(B.error(new f("mapview-invalid-type",
"MapView does not support 3d symbol type: "+a.type,a)),b.resolve({glyphMosaicItems:[],spriteMosaicItem:null})):!a.type||"text"!==a.type&&"esriTS"!==a.type&&"CIMTextSymbol"!==a.type?l.safeCast(this._rasterizeSpriteSymbol(a,d)).then(function(a){z.ok(a)&&a&&e._setTextureBinding(w.MosaicType.SPRITE,a);return{spriteMosaicItem:a}}):this._rasterizeTextSymbol(a,c,d).then(function(a){a.forEach(function(a){return e._setTextureBinding(w.MosaicType.GLYPH,a)});return{glyphMosaicItems:a}}):(B.error(new f("mapview-null-resource",
"Unable to rasterize null resource")),b.resolve(null))};a.prototype.bindTextures=function(a,b,c,d){void 0===d&&(d=1);if(0!==c.textureBinding){var f=this._bindingInfos[c.textureBinding-1];c=f.page;switch(f.mosaicType){case w.MosaicType.SPRITE:f=this.sprites.getWidth(c)/d;d=this.sprites.getHeight(c)/d;d=e.vec2.set(E,f,d);this._bindSpritePage(a,c,r.TEXTURE_BINDING_SPRITE_ATLAS,9729);b.setUniform1i("u_texture",r.TEXTURE_BINDING_SPRITE_ATLAS);b.setUniform2fv("u_mosaicSize",d);break;case w.MosaicType.GLYPH:f=
this.glyphs.width/d;d=this.glyphs.height/d;d=e.vec2.set(E,f,d);this._bindGlyphsPage(a,c,r.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform1i("u_texture",r.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform2fv("u_mosaicSize",d);break;default:B.error("mapview-texture-manager","Cannot handle unknown type "+f.mosaicType)}}};a.prototype._bindSpritePage=function(a,b,c,d){d||(d=9729);this._spriteMosaic.bind(a,d,b,c)};a.prototype._bindGlyphsPage=function(a,b,c){this._glyphMosaic.bind(a,9729,b,c)};a.prototype._rasterizeTextSymbol=
function(a,b,c){var d=this,e=u.getFullyQualifiedFontName(a.font);a=this._invalidFontsMap.has(e);return this._glyphMosaic.getGlyphItems(a?"arial-unicode-ms-regular":e,b,c).catch(function(a){B.error(new f("mapview-invalid-resource","Couldn't find font "+e+". Falling back to Arial Unicode MS Regular"));d._invalidFontsMap.set(e,!0);return d._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",b,c)})};a.prototype._rasterizeSpriteSymbol=function(a,b){return k(this,void 0,void 0,function(){var c,d,e,g,
l,k;return h(this,function(h){h="CIMSolidStroke"===a.type||"CIMSolidFill"===a.type?!0:a&&(A.isFillSymbol(a)||A.isLineSymbol(a))&&"style"in a&&("solid"===a.style||"esriSFSSolid"===a.style||"esriSLSSolid"===a.style||"none"===a.style||"esriSFSNull"===a.style||"esriSLSNull"===a.style);if(h)return[2,null];c=A.keyFromSymbol(a);return this._spriteMosaic.has(c)?[2,this._spriteMosaic.getSpriteItem(c)]:"simple-marker"!==a.type&&"esriSMS"!==a.type||!a.path?a.url||a.imageData?[2,this._handleImage(a,c,b)]:(d=
this._rasterizer.rasterizeJSONResource(a))?(e=d.size,g=d.image,l=d.sdf,k=d.simplePattern,[2,this._addItemToMosaic(c,e,g,!A.isMarkerSymbol(a),l,k)]):[2,new f("TextureManager","unrecognized or null rasterized image")]:[2,this._handleSVG(a,c,b)]})})};a.prototype._handleSVG=function(a,b,c){return k(this,void 0,void 0,function(){var d,e;return h(this,function(f){switch(f.label){case 0:return d=[126,126],[4,this._sdfConverter.draw(a.path,c)];case 1:return e=f.sent(),[2,this._addItemToMosaic(b,d,new Uint32Array(e.buffer),
!1,!0,!0)]}})})};a.prototype._handleImage=function(a,c,d){return k(this,void 0,void 0,function(){var e,l,k,p,q,n,r;return h(this,function(h){switch(h.label){case 0:e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,g(e,m({responseType:"image"},d))];case 2:return l=h.sent().data,k=this._rasterizer.rasterizeImageResource(l,a.colorSubstitutions),p=k.size,q=k.sdf,n=k.image,[2,this._addItemToMosaic(c,p,n,!A.isMarkerSymbol(a),q,!1)];case 3:return r=
h.sent(),b.isAbortError(r)?[3,4]:[2,new f("mapview-invalid-resource","Could not fetch requested resource at "+e)];case 4:return[2,void 0]}})})};a.prototype._addItemToMosaic=function(a,b,c,d,e,f){return this._spriteMosaic.addSpriteItem(a,b,c,d,e,f)};return a}()})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(n,a){function m(a){a=a.toLowerCase().split(" ").join("-");switch(a){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";
case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return a}}Object.defineProperty(a,"__esModule",{value:!0});a.getFullyQualifiedFontName=function(a){var h;a:{if(a.weight)switch(a.weight.toLowerCase()){case "bold":case "bolder":h="-bold";break a}h=""}var d;a:{if(a.style)switch(a.style.toLowerCase()){case "italic":case "oblic":d="-italic";break a}d=""}h+=d;return m(a.family)+(0<h.length?h:"-regular")};a.getFontDecorationTop=function(a){switch(a){case "underline":return-26;
case "line-through":return-18}return NaN}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./Rect ./RectangleBinPack".split(" "),function(n,a,m,k,h,d,g){var l;m("stable-symbol-rendering")&&(l=new Set);return function(){function a(a,b,d){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;!l&&m("stable-symbol-rendering")&&
(l=new Set);this.width=a;this.height=b;this._glyphSource=d;this._binPack=new g(a-4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(void 0);this._addDecorationGlyph()}a.prototype.getGlyphItems=function(a,b,d){for(var c=this,e=[],f=this._glyphSource,g=new Set,h=1/256,n=0;n<b.length;n++)g.add(Math.floor(b[n]*h));var y=[];g.forEach(function(b){if(256>=b){var e=a+b;c._rangePromises.has(e)?y.push(c._rangePromises.get(e)):(b=f.getRange(a,b,d).then(function(){c._rangePromises["delete"](e)}).catch(function(a){c._rangePromises["delete"](e);
if(!k.isAbortError(a))throw Error("Unable to query resource");}),c._rangePromises.set(e,b),y.push(b))}});return k.all(y).then(function(d){d=c._glyphIndex[a];d||(d={},c._glyphIndex[a]=d);var h;if(m("stable-symbol-rendering")){l.clear();for(var k=0;k<b.length;k++)h=b[k],l.add(h);var p=[];g.forEach(function(a){p.push(a)});p.sort();h=[];for(k=0;k<p.length;k++)for(var q=p[k],n=0;256>n;++n)h.push(256*q+n)}else h=b;k=0;for(q=h;k<q.length;k++)if(h=q[k],n=d[h]){if(!m("stable-symbol-rendering")||l.has(h))e[h]=
{sdf:!0,rect:n.rect,metrics:n.metrics,page:n.page}}else if((n=f.getGlyph(a,h))&&n.metrics){var r=c._recordGlyph(n,h);d[h]={rect:r,metrics:n.metrics,tileIDs:null,page:c._currentPage};if(!m("stable-symbol-rendering")||l.has(h))e[h]={sdf:!0,rect:r,metrics:n.metrics,page:c._currentPage};c._dirties[c._currentPage]=!0}return e})};a.prototype._recordGlyph=function(a,b){var c=a.metrics;if(0===c.width)c=new d.default(0,0,0,0);else{b=c.width+6;var f=c.height+6,h=b%4?4-b%4:4,l=f%4?4-f%4:4;1===h&&(h=5);1===l&&
(l=5);c=this._binPack.allocate(b+h,f+l);c.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new g(this.width-4,this.height-4),c=this._binPack.allocate(b+h,f+l));h=this._glyphData[this._currentPage];a=a.bitmap;var k=l=void 0;if(a)for(var m=0;m<f;m++)for(var l=b*m,k=this.width*(c.y+m+1)+c.x,n=0;n<b;n++)h[k+
n+1]=a[l+n]}return c};a.prototype._addDecorationGlyph=function(){for(var a=[117,149,181,207,207,181,149,117],b=[],d=0;d<a.length;d++)for(var f=a[d],g=0;11>g;g++)b.push(f);a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(b)};this._recordGlyph(a,0)};a.prototype.bind=function(a,b,d,f){this._textures[d]||(this._textures[d]=new h.Texture(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var c=this._textures[d];c.setSamplingMode(b);
this._dirties[d]&&c.setData(this._glyphData[d]);a.bindTexture(c,f);this._dirties[d]=!1};a.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var d=b[a];d&&d.dispose()}this._textures.length=0;this._glyphData.length=0};return a}()})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,h,d,g){void 0===a&&(a=0);void 0===h&&(h=0);void 0===d&&(d=0);void 0===
g&&(g=0);this.x=a;this.y=h;this.width=d;this.height=g}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});a.prototype.union=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=Math.max(this.width,a.width);this.height=Math.max(this.height,a.height)};return a}();a.default=n})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(n,a,m){return function(){function a(a,
d){this._height=this._width=0;this._free=[];this._width=a;this._height=d;this._free.push(new m.default(0,0,a,d))}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.allocate=function(a,d){if(a>this._width||d>this._height)return new m.default;for(var g=null,h=-1,f=0;f<this._free.length;++f){var c=this._free[f];a<=c.width&&
d<=c.height&&(null===g||c.y<=g.y&&c.x<=g.x)&&(g=c,h=f)}if(null===g)return new m.default;this._free.splice(h,1);g.width<g.height?(g.width>a&&this._free.push(new m.default(g.x+a,g.y,g.width-a,d)),g.height>d&&this._free.push(new m.default(g.x,g.y+d,g.width,g.height-d))):(g.width>a&&this._free.push(new m.default(g.x+a,g.y,g.width-a,g.height)),g.height>d&&this._free.push(new m.default(g.x,g.y+d,a,g.height-d)));return new m.default(g.x,g.y,a,d)};a.prototype.release=function(a){for(var d=0;d<this._free.length;++d){var g=
this._free[d];if(g.y===a.y&&g.height===a.height&&g.x+g.width===a.x)g.width+=a.width;else if(g.x===a.x&&g.width===a.width&&g.y+g.height===a.y)g.height+=a.height;else if(a.y===g.y&&a.height===g.height&&a.x+a.width===g.x)g.x=a.x,g.width+=a.width;else if(a.x===g.x&&a.width===g.width&&a.y+a.height===g.y)g.y=a.y,g.height+=a.height;else continue;this._free.splice(d,1);this.release(a)}this._free.push(a)};return a}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../request ../../../../core/pbf ../../../../core/promiseUtils".split(" "),
function(n,a,m,k,h,d){var g=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var c=b.getMessage(),d=void 0,f=void 0,g=void 0,h=void 0,l=void 0,k=void 0,m=void 0;c.next();)switch(c.tag()){case 1:d=c.getUInt32();break;case 2:f=c.getBytes();break;case 3:g=c.getUInt32();break;case 4:h=c.getUInt32();break;case 5:l=c.getSInt32();break;case 6:k=c.getSInt32();break;case 7:m=c.getUInt32();break;default:c.skip()}c.release();
d&&(this._metrics[d]={width:g,height:h,left:l,top:k,advance:m},this._bitmaps[d]=f);break;default:b.skip()}b.release();break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),l=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function a(a){this._glyphInfo={};this._baseURL=
a}a.prototype.getRange=function(a,b,e){var c=this._getFontStack(a);if(c.getRange(b))return d.resolve();var f=256*b,l=f+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",f+"-"+l);return k(a,m({responseType:"array-buffer"},e)).then(function(a){c.addRange(b,new g(new h(new Uint8Array(a.data),new DataView(a.data))))})};a.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};
a.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new l);return b};return a}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports","../../../../core/promiseUtils","../../../../core/promiseUtils","./packingUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.size=a;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=a;this.context=this.canvas.getContext("2d");
this._gridOuter=new Float64Array(a*a);this._gridInner=new Float64Array(a*a);this._f=new Float64Array(a);this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a)}a.prototype.draw=function(a,d,f){var c=this;void 0===f&&(f=31);this._initSVG();var b=this._createSVGString(a);return m.create(function(a,g){var e=new Image;e.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(b);e.onload=function(){c.context.clearRect(0,0,c.size,c.size);c.context.drawImage(e,0,0,c.size,
c.size);for(var b=c.context.getImageData(0,0,c.size,c.size),d=new Uint8Array(c.size*c.size*4),g=0;g<c.size*c.size;g++){var l=b.data[4*g+3]/255;c._gridOuter[g]=1===l?0:0===l?1E20:Math.pow(Math.max(0,.5-l),2);c._gridInner[g]=1===l?1E20:0===l?0:Math.pow(Math.max(0,l-.5),2)}c._edt(c._gridOuter,c.size,c.size);c._edt(c._gridInner,c.size,c.size);for(g=0;g<c.size*c.size;g++)h.packFloatRGBA(.5-(c._gridOuter[g]-c._gridInner[g])/(2*f),d,4*g);a(d)};var l=d&&d.signal;if(l)k.onAbort(l,function(){return g(k.createAbortError())})})};
a.prototype._initSVG=function(){if(!this._svg){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("style","position: absolute;");a.setAttribute("width","0");a.setAttribute("height","0");a.setAttribute("aria-hidden","true");a.setAttribute("role","presentation");document.body.appendChild(a);this._svg=a}};a.prototype._createSVGString=function(a){var d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",a);this._svg.appendChild(d);a=d.getBBox();
var f=a.width/a.height,c=this.size/2,b,e,g;1<f?(e=b=c/a.width,g=this.size/4,f=c-1/f*c/2):(b=e=c/a.height,g=c-c*f/2,f=this.size/4);d.setAttribute("style","transform: matrix("+b+", 0, 0, "+e+", "+(-a.x*b+g)+", "+(-a.y*e+f)+")");a='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(d);return a};a.prototype._edt=function(a,d,f){for(var c=this._f,b=this._d,e=this._v,g=this._z,
h=0;h<d;h++){for(var l=0;l<f;l++)c[l]=a[l*d+h];this._edt1d(c,b,e,g,f);for(l=0;l<f;l++)a[l*d+h]=b[l]}for(l=0;l<f;l++){for(h=0;h<d;h++)c[h]=a[l*d+h];this._edt1d(c,b,e,g,d);for(h=0;h<d;h++)a[l*d+h]=Math.sqrt(b[h])}};a.prototype._edt1d=function(a,d,f,c,b){f[0]=0;c[0]=-1E20;c[1]=1E20;for(var e=1,g=0;e<b;e++){for(var h=(a[e]+e*e-(a[f[g]]+f[g]*f[g]))/(2*e-2*f[g]);h<=c[g];)g--,h=(a[e]+e*e-(a[f[g]]+f[g]*f[g]))/(2*e-2*f[g]);g++;f[g]=e;c[g]=h;c[g+1]=1E20}for(g=e=0;e<b;e++){for(;c[g+1]<e;)g++;d[e]=(e-f[g])*(e-
f[g])+a[f[g]]}};return a}();a.default=n})},"esri/views/2d/engine/webgl/packingUtils":function(){define(["require","exports"],function(n,a){function m(a){return a-Math.floor(a)}Object.defineProperty(a,"__esModule",{value:!0});var k=[1,256,65536,16777216],h=[1/256,1/65536,1/16777216,1/4294967296],d=function(a,d){void 0===d&&(d=0);for(var f=0,c=0;4>c;c++)f+=a[d+c]*h[c];return f}(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(a,h,f){void 0===f&&(f=0);a=0>a?0:a>d?d:a;for(var c=0;4>
c;c++)h[f+c]=Math.floor(256*m(a*k[c]))}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ../../../../core/has ../../../webgl ./GeometryUtils ./Rect ./RectangleBinPack".split(" "),function(n,a,m,k,h,d,g){return function(){function a(a,c,b){void 0===b&&(b=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._currentPage=this._maxItemSize=0;this._fixSpriteLocationsTable=m("fix-sprite-locations");this._testId=m("test-id");this._pageHeight=this._pageWidth=
0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=a||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=c;0<b&&(this._maxItemSize=b);this.pixelRatio=window.devicePixelRatio||1;if(this._fixSpriteLocationsTable){a=[];for(var d in this._fixSpriteLocationsTable[this._testId])c=this._fixSpriteLocationsTable[this._testId][d],a[c.page]=c.pageSize;for(d=0;d<a.length;d++)c=a[d],this._mosaicsData.push(new Uint32Array(c[0]*
c[1])),this._dirties.push(!0),this._size.push([c[0],c[1]]),this._textures.push(void 0)}this._binPack=new g(this._pageWidth,this._pageHeight);this._mosaicsData.push(new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight)));this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}a.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};a.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};
a.prototype.getPage=function(a){return a<this._textures.length?this._textures[a]:null};a.prototype.has=function(a){return this._mosaicRects.has(a)};Object.defineProperty(a.prototype,"itemCount",{get:function(){return this._mosaicRects.size},enumerable:!0,configurable:!0});a.prototype.getSpriteItem=function(a){return this._mosaicRects.get(a)};a.prototype.addSpriteItem=function(a,c,b,d,g,h){var e;if(this._mosaicRects.has(a))return this._mosaicRects.get(a);var f,l;this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&
this._fixSpriteLocationsTable[this._testId][a]?(e=this._fixSpriteLocationsTable[this._testId][a],f=e.rect,l=e.page,e=e.pageSize):(e=this._allocateImage(c[0],c[1]),f=e[0],l=e[1],e=e[2]);if(0>=f.width||0>=f.height)return null;h={rect:f,width:c[0],height:c[1],sdf:g,simplePattern:h,pixelRatio:1,page:l};this._mosaicRects.set(a,h);this._copy({rect:f,spriteSize:c,spriteData:b,page:l,pageSize:e,repeat:d,sdf:g});return h};a.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};a.prototype.processNextItem=
function(){var a=this._spriteCopyQueue.pop();a&&this._copy(a)};a.prototype.getSpriteItems=function(a){for(var c={},b=0;b<a.length;b++){var d=a[b];c[d]=this.getSpriteItem(d)}return c};a.prototype.getMosaicItemPosition=function(a,c){c=(a=this.getSpriteItem(a))&&a.rect;if(!c)return null;c.width=a.width;c.height=a.height;return{size:[a.width,a.height],tl:[(c.x+1)/this._size[a.page][0],(c.y+1)/this._size[a.page][1]],br:[(c.x+1+a.width)/this._size[a.page][0],(c.y+1+a.height)/this._size[a.page][1]],page:a.page}};
a.prototype.bind=function(a,c,b,d){void 0===b&&(b=0);void 0===d&&(d=0);this._textures[b]||(this._textures[b]=new k.Texture(a,{pixelFormat:6408,dataType:5121,width:this._size[b][0],height:this._size[b][1]},new Uint8Array(this._mosaicsData[b].buffer)));var e=this._textures[b];e.setSamplingMode(c);this._dirties[b]&&(e.setData(new Uint8Array(this._mosaicsData[b].buffer)),e.generateMipmap());a.bindTexture(e,d);this._dirties[b]=!1};a._copyBits=function(a,c,b,d,g,h,l,k,m,n,y){var e=d*c+b;l=k*h+l;if(y)for(l-=
h,y=-1;y<=n;y++,e=((y+n)%n+d)*c+b,l+=h)for(k=-1;k<=m;k++)g[l+k]=a[e+(k+m)%m];else for(y=0;y<n;y++){for(k=0;k<m;k++)g[l+k]=a[e+k];e+=c;l+=h}};a.prototype._copy=function(d){if(!(d.page>=this._mosaicsData.length)){var c=d.spriteData,b=this._mosaicsData[d.page];b&&c||console.error("Source or target images are uninitialized!");a._copyBits(c,d.spriteSize[0],0,0,b,d.pageSize[0],d.rect.x+1,d.rect.y+1,d.spriteSize[0],d.spriteSize[1],d.repeat);this._dirties[d.page]=!0}};a.prototype._allocateImage=function(a,
c){a+=2;c+=2;var b=Math.max(a,c);if(this._maxItemSize&&this._maxItemSize<b){var b=Math.pow(2,Math.ceil(h.log2(a))),e=Math.pow(2,Math.ceil(h.log2(c)));a=new d.default(0,0,a,c);this._mosaicsData.push(new Uint32Array(b*e));this._dirties.push(!0);this._size.push([b,e]);this._textures.push(void 0);return[a,this._mosaicsData.length-1,[b,e]]}b=this._binPack.allocate(a,c);return 0>=b.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,
this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new g(this._pageWidth,this._pageHeight),this._allocateImage(a,c)):[b,this._currentPage,[this._pageWidth,this._pageHeight]]};a.prototype.dispose=function(){this._binPack=null;for(var a=0,c=this._textures;a<c.length;a++){var b=c[a];b&&b.dispose()}this._textures.length=0;this._mosaicsData.length=0;this._mosaicRects.clear()};
return a}()})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.ok=function(a,h){return a&&"name"in a?(h&&h.error(new m(a.name,a.message,a.details)),!1):!0}})},"esri/views/2d/engine/webgl/util/symbolUtils":function(){define(["require","exports"],function(n,a){function m(a){switch(a){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";case "esriSLS":return"simple-line";
case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return a}function k(a){if(a=m(a.type))switch(a){case "picture-marker":case "picture-line":case "picture-fill":return!0;case "CIMPictureMarker":return!0}return!1}Object.defineProperty(a,"__esModule",{value:!0});a.keyFromSymbol=function(a){if(a.type){switch(m(a.type)){case "simple-marker":return a.path?"simple-marker"+a.style+a.path:"simple-marker"+a.style;case "simple-line":return"simple-line"+
a.style+a.cap;case "simple-fill":return"simple-fill"+a.style}if(a.mosaicHash)return a.mosaicHash;if(k(a))return a.imageData?a.imageData:a.url+(""+a.width+a.height)}return JSON.stringify(a)};a.normalizeSymbolType=m;a.isMarkerSymbol=function(a){if(a=m(a.type)){switch(a){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0;case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!0}return!1}};a.isFillSymbol=function(a){if(a=m(a.type)){switch(a){case "simple-fill":case "picture-fill":return!0;
case "CIMPolygonSymbol":return!0}return!1}};a.isLineSymbol=function(a){if(a=m(a.type)){switch(a){case "simple-line":case "picture-line":return!0;case "CIMLineSymbol":return!0}return!1}};a.isPictureSymbol=k;a.isTextSymbol=function(a){if(a=m(a.type)){switch(a){case "text":return!0;case "CIMTextSymbol":return!0}return!1}}})},"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../definitions ../VertexStream ./Effect".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c.defines=[];c._desc={path:"fx/integrate",attributes:{a_position:0}};return c}m(f,a);f.prototype.bind=function(a){};f.prototype.unbind=function(a){};f.prototype.draw=function(a,b){if(b.size){var c=a.context,f=a.renderingOptions;this._quad||(this._quad=new d(c,[0,0,1,0,0,1,1,1]));var g=c.getBoundFramebufferObject(),l=c.getViewport(),m=l.x,n=l.y,v=l.width,
l=l.height;b.bindTextures(c);var y=b.getBlock(h.ATTRIBUTE_DATA_ANIMATION);if(!k.isNone(y)){var t=y.getFBO(c),y=y.getFBO(c,1);c.setViewport(0,0,b.size,b.size);this._computeDelta(a,y,f.labelsAnimationTime);this._updateAnimationState(a,y,t);c.bindFramebuffer(g);c.setViewport(m,n,v,l)}}};f.prototype._computeDelta=function(a,b,d){var c=a.context,e=a.displayLevel,f=a.painter.materialManager.getProgram(a,this._desc,["delta"]);c.bindFramebuffer(b);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(f);
f.setUniform1i("u_maskTexture",h.TEXTURE_BINDING_ATTRIBUTE_DATA_0);f.setUniform1i("u_sourceTexture",h.TEXTURE_BINDING_ATTRIBUTE_DATA_1);f.setUniform1f("u_timeDelta",a.timeDelta);f.setUniform1f("u_animationTime",d/1E3);f.setUniform1f("u_zoomLevel",Math.round(10*e));this._quad.draw()};f.prototype._updateAnimationState=function(a,b,d){var c=a.context;a=a.painter.materialManager.getProgram(a,this._desc,["update"]);c.bindTexture(b.colorTexture,1);c.bindProgram(a);a.setUniform1i("u_sourceTexture",1);c.bindFramebuffer(d);
c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._quad.draw()};return f}(g.Effect);a.AnimationEffect=n})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../webgl"],function(n,a,m,k){return function(){function a(a,g){this.rctx=a;this._vertexBuffer=k.BufferObject.createVertex(a,35044,new Uint16Array(g));this._vao=new k.VertexArrayObject(a,{a_position:0},{geometry:[{name:"a_position",count:2,type:5123,
offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}a.prototype.bind=function(){this._vao.bind()};a.prototype.unbind=function(){this._vao.unbind()};a.prototype.dispose=function(){this._vao.dispose(!1);this._vertexBuffer.dispose()};a.prototype.draw=function(){this.rctx.bindVAO(this._vao);this.rctx.drawArrays(5,0,4)};return a}()})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){return function(){this.name=
this.constructor.name}}();a.Effect=n})},"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/has ../BitBlitRenderer ../effects/Effect ./highlight/HighlightGradient ./highlight/HighlightRenderer ./highlight/HighlightSurfaces".split(" "),function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.defines=["highlight"];
b._hlRenderer=new l.default;b._hlGradient=new g.default;b._width=void 0;b._height=void 0;b._hlSurfaces=new f.default;b._adjustedWidth=void 0;b._adjustedHeight=void 0;b._blitRenderer=new h.BitBlitRenderer;return b}m(b,a);b.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();this._hlGradient&&this._hlGradient.destroy();this._boundFBO=null};b.prototype.bind=function(a){var b=a.context,c=a.painter,d=b.getViewport(),e=d.width,d=d.height,
c=c.getFbos(b,e,d).effect0;this.setup(a,e,d);b.bindFramebuffer(c);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)};b.prototype.unbind=function(a){};b.prototype.setup=function(a,b,c){a=a.context;this._width=b;this._height=c;var d=b%4,e=c%4;b+=2>d?-d:4-d;c+=2>e?-e:4-e;this._adjustedWidth=b;this._adjustedHeight=c;this._boundFBO=a.getBoundFramebufferObject();b=Math.round(.75*b);c=Math.round(.75*c);this._hlRenderer.setup(a,b,c);this._hlSurfaces.setup(a,b,c)};b.prototype.draw=function(a){a=a.context;
var b=a.getBoundFramebufferObject();a.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setStencilTestEnabled(!1);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(a,b.colorTexture,9728,1);a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);
k("esri-feature-highlight-debug")?(a.bindFramebuffer(null),a.clear(a.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex)):(a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex),a.bindFramebuffer(this._boundFBO),a.setBlendingEnabled(!0),a.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),
this._boundFBO=null)};b.prototype.setHighlightOptions=function(a){this._hlGradient.setHighlightOptions(a)};return b}(d.Effect);a.default=n})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("require exports ../../../../../../core/Logger ../../../../../webgl ../../definitions ./parameters".split(" "),function(n,a,m,k,h,d){function g(a,b){b.fillColor[0]=a.color.r/255;b.fillColor[1]=a.color.g/255;b.fillColor[2]=a.color.b/255;b.fillColor[3]=a.color.a;a.haloColor?(b.outlineColor[0]=
a.haloColor.r/255,b.outlineColor[1]=a.haloColor.g/255,b.outlineColor[2]=a.haloColor.b/255,b.outlineColor[3]=a.haloColor.a):(b.outlineColor[0]=b.fillColor[0],b.outlineColor[1]=b.fillColor[1],b.outlineColor[2]=b.fillColor[2],b.outlineColor[3]=b.fillColor[3]);b.fillColor[3]*=a.fillOpacity;b.outlineColor[3]*=a.haloOpacity;b.fillColor[0]*=b.fillColor[3];b.fillColor[1]*=b.fillColor[3];b.fillColor[2]*=b.fillColor[3];b.outlineColor[0]*=b.outlineColor[3];b.outlineColor[1]*=b.outlineColor[3];b.outlineColor[2]*=
b.outlineColor[3];b.outlineWidth=d.HIGHLIGHT_SIZING.outlineWidth;b.outerHaloWidth=d.HIGHLIGHT_SIZING.outerHaloWidth;b.innerHaloWidth=d.HIGHLIGHT_SIZING.innerHaloWidth;b.outlinePosition=d.HIGHLIGHT_SIZING.outlinePosition}Object.defineProperty(a,"__esModule",{value:!0});var l=m.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),f=[0,0,0,0];n=function(){function a(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:d.HIGHLIGHT_SIZING.outlinePosition,
outlineWidth:d.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:d.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:d.HIGHLIGHT_SIZING.outerHaloWidth};this.shadeTexChanged=!0;this.texelData=new Uint8Array(4*d.SHADE_TEXTURE_SIZE);this.minMaxDistance=[0,0]}a.prototype.setHighlightOptions=function(a){function b(a,b,c){t[0]=(1-c)*a[0]+c*b[0];t[1]=(1-c)*a[1]+c*b[1];t[2]=(1-c)*a[2]+c*b[2];t[3]=(1-c)*a[3]+c*b[3]}var c,h=this._convertedHighlightOptions;g(a,h);a=h.outlinePosition-h.outlineWidth/2-h.outerHaloWidth;
var k=h.outlinePosition-h.outlineWidth/2,m=h.outlinePosition+h.outlineWidth/2,n=h.outlinePosition+h.outlineWidth/2+h.innerHaloWidth,v=Math.sqrt(Math.PI/2)*d.SIGMAS[3],y=Math.abs(a)>v?Math.round(10*(Math.abs(a)-v))/10:0,v=Math.abs(n)>v?Math.round(10*(Math.abs(n)-v))/10:0;y&&!v?l.error("The outer rim of the highlight is "+y+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!y&&v?l.error("The inner rim of the highlight is "+
v+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):y&&v&&l.error("The highlight is "+Math.max(y,v)+"px away from the edge of the feature; consider reducing some width values.");for(var t=[void 0,void 0,void 0,void 0],y=this.texelData,v=0;v<d.SHADE_TEXTURE_SIZE;++v)c=a+v/(d.SHADE_TEXTURE_SIZE-1)*(n-a),c<a?(t[4*v+0]=0,t[4*v+1]=0,t[4*v+2]=0,t[4*v+3]=0):c<k?b(f,h.outlineColor,(c-a)/(k-a)):c<m?(c=h.outlineColor,
t[0]=c[0],t[1]=c[1],t[2]=c[2],t[3]=c[3]):c<n?b(h.outlineColor,h.fillColor,(c-m)/(n-m)):(c=h.fillColor,t[4*v+0]=c[0],t[4*v+1]=c[1],t[4*v+2]=c[2],t[4*v+3]=c[3]),y[4*v+0]=255*t[0],y[4*v+1]=255*t[1],y[4*v+2]=255*t[2],y[4*v+3]=255*t[3];this.minMaxDistance[0]=a;this.minMaxDistance[1]=n;this.shadeTexChanged=!0};a.prototype.applyHighlightOptions=function(a,c){this.shadeTex||(this.shadeTex=new k.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:d.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729}));
this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,d.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1);a.bindTexture(this.shadeTex,h.TEXTURE_BINDING_HIGHLIGHT_1);c.setUniform2fv("u_minMaxDistance",this.minMaxDistance)};a.prototype.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)};return a}();a.default=n})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",
{value:!0});a.SIGMAS=[void 0,void 0,void 0,1];a.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];a.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.SHADE_TEXTURE_SIZE=256;a.HIGHLIGHT_SIZING={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("require exports ../../../../../webgl ../../definitions ./parameters ../../shaders/HighlightPrograms".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)};a.prototype.preBlur=function(a,d){a.bindTexture(d,k.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",
[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",h.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype.finalBlur=function(a,d){a.bindTexture(d,k.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",h.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);
a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype.renderHighlight=function(a,d,c){a.bindTexture(d,k.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.highlightProgram);c.applyHighlightOptions(a,this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.setBlendingEnabled(!0);a.setBlendFunction(1,771);a.drawArrays(5,0,4);a.bindVAO()};a.prototype._initialize=function(a,f,c){this._width=f;this._height=c;f=new m.BufferObject(a,34962,35044,(new Int8Array([-1,
-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);c=new m.VertexArrayObject(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:f});var b=m.createProgram(a,d.highlight);a=m.createProgram(a,d.blur);b.setUniform1i("u_texture",k.TEXTURE_BINDING_HIGHLIGHT_0);b.setUniform1i("u_shade",k.TEXTURE_BINDING_HIGHLIGHT_1);b.setUniform4fv("u_sigmas",h.SIGMAS);a.setUniform1i("u_texture",
k.TEXTURE_BINDING_HIGHLIGHT_0);a.setUniform4fv("u_sigmas",h.SIGMAS);this._resources={quadGeometry:f,quadVAO:c,highlightProgram:b,blurProgram:a}};a.prototype.setup=function(a,d,c){this._resources?(this._width=d,this._height=c):this._initialize(a,d,c)};return a}();a.default=n})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require","exports","./sources/resolver"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.highlight={name:"highlight",shaders:{vertexShader:m.resolveIncludes("highlight/textured.vert"),
fragmentShader:m.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,a_texcoord:1}};a.blur={name:"blur",shaders:{vertexShader:m.resolveIncludes("highlight/textured.vert"),fragmentShader:m.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["require","exports","../../../../../webgl"],function(n,a,m){function k(a,d,g){d=new m.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,
wrapMode:33071,width:d,height:g,samplingMode:9729});a=m.FramebufferObject.createWithAttachments(a,d,{colorTarget:0,depthStencilTarget:2});return[d,a]}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=
null)};a.prototype._initialize=function(a,g,h){this._width=g;this._height=h;var d=k(a,g,h),c=d[0],d=d[1];a=k(a,g,h);this._resources={sharedBlur1Tex:c,sharedBlur1Fbo:d,sharedBlur2Tex:a[0],sharedBlur2Fbo:a[1]}};a.prototype.setup=function(a,g,h){!this._resources||this._width===g&&this._height===h||this.dispose();this._resources||this._initialize(a,g,h)};Object.defineProperty(a.prototype,"sharedBlur1Tex",{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"sharedBlur1Fbo",{get:function(){return this._resources.sharedBlur1Fbo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});return a}();a.default=n})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/iteratorUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c.name=c.constructor.name;c.defines=["id"];c._buf=new Uint8Array(4*d.HITTEST_SEARCH_SIZE*d.HITTEST_SEARCH_SIZE);c._buf32=new Uint32Array(c._buf.buffer);return c}m(f,a);f.prototype.destroy=function(){h.isSome(this._fbo)&&this._fbo.dispose()};f.prototype.bind=function(a){var b=a.context;a=a.painter;var c=b.getViewport();a=a.getFbos(b,c.width,c.height).effect0;
b.bindFramebuffer(a);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT)};f.prototype.unbind=function(a){};f.prototype.draw=function(a,b){var c=this,f=a.state,g=a.pixelRatio,h=d.HITTEST_SEARCH_SIZE,l=a.context.getBoundFramebufferObject(),m=f.size[1],n=h/2,y=h/2;b.forEach(function(a,e){var f=new Map;l.readPixels(Math.floor((e[0]-d.HITTEST_SEARCH_SIZE/2)*g),Math.floor((m-e[1]-d.HITTEST_SEARCH_SIZE/2)*g),h,h,6408,5121,c._buf);for(var p=0;p<c._buf32.length;p++){var q=c._buf32[p];if(4294967295!==q&&
0!==q){var r=p%h,u=h-Math.floor(p/h),r=(n-r)*(n-r)+(y-u)*(y-u),u=f.has(q)?f.get(q):4294967295;f.set(q,Math.min(r,u))}}f=k.pairsOfMap(f).sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]});a.resolve(f);b.delete(e)})};return f}(g.Effect);a.HittestEffect=n})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define("require exports @dojo/framework/shim/iterator ../../../../../core/has ../../../../../core/maybe ../enums".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,
"__esModule",{value:!0});n=function(){function a(a,f){this.brushes=a;this.name=f.name;this.drawPhase=f.drawPhase||d.WGLDrawPhase.MAP;this._targetFn=f.target;this.effects=f.effects||[];this.has=f.has}a.prototype.render=function(a){var d=a.context,c=a.profiler,b=this._targetFn(),e=this.drawPhase&a.drawPhase;c.recordPassStart(this.name);if(e&&(!this.has||k(this.has))){this._doRender(a,b);c.recordPassEnd(this.name);for(var e=0,g=this.effects;e<g.length;e++){var h=g[e];if(h.enable()){var l=h.apply;c.recordPassStart(this.name+
"."+l.name);c.recordBrushStart(l.name);var h=h.args&&h.args(),m=d.getViewport(),n=m.x,v=m.y,y=m.width,m=m.height,t=d.getBoundFramebufferObject();l.bind(a,h);this._doRender(a,b,l.defines);l.draw(a,h);l.unbind(a,h);d.bindFramebuffer(t);d.setViewport(n,v,y,m);c.recordBrushEnd(l.name);c.recordPassEnd(this.name+"."+l.name)}}}};a.prototype._doRender=function(a,d,c){if(!h.isNone(d))if(m.isArrayLike(d))for(var b=0;b<d.length;b++){var e=d[b];if(e.isReady)for(var f=0,g=this.brushes;f<g.length;f++){var l=g[f];
a.profiler.recordBrushStart(l.name);l.prepareState(a,e,c);l.draw(a,e,c);a.profiler.recordBrushEnd(l.name)}}else for(b=0,e=this.brushes;b<e.length;b++)l=e[b],a.profiler.recordBrushStart(l.name),l.prepareState(a,d,c),l.draw(a,d,c),a.profiler.recordBrushEnd(l.name)};return a}();a.default=n})},"esri/views/2d/engine/webgl/Profiler":function(){define("require exports ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../../core/maybe ../../../webgl/capabilities/DisjointTimerQuery".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=h("esri-2d-profiler");n=function(){function a(a,b){var c=this;this._events=new k;this._entries=new Map;this._timings=new m.default(10);if(l){this._ext=g.load(a.gl,{});this._debugOutput=b;var d=a.gl;if(this.enableCommandLogging){a=function(a){if("function"===typeof d[a]){var b=d[a],e=-1!==a.indexOf("draw");d[a]=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];c._events.emit("command",{container:c._currentContainer,
pass:c._currentPass,brush:c._currentBrush,method:a,args:f,isDrawCommand:e});c._currentSummary&&(c._currentSummary.commands++,e&&c._currentSummary.drawCommands++);return b.apply(d,f)}}};for(var f in d)a(f)}}}Object.defineProperty(a.prototype,"enableCommandLogging",{get:function(){return!("object"===typeof l&&l.disableCommands)},enumerable:!0,configurable:!0});a.prototype.recordContainerStart=function(a){l&&(this._currentContainer=a)};a.prototype.recordContainerEnd=function(a){l&&(this._currentContainer=
null)};a.prototype.recordPassStart=function(a){l&&(this._currentPass=a,this._initSummary())};a.prototype.recordPassEnd=function(a){l&&(this._currentPass=null,this._emitSummary())};a.prototype.recordBrushStart=function(a){l&&(this._currentBrush=a)};a.prototype.recordBrushEnd=function(a){l&&(this._currentBrush=null)};a.prototype.recordStart=function(a){if(l&&d.isSome(this._ext)){if(this._entries.has(a)){var b=this._entries.get(a),c=this._ext.resultAvailable(b.query),f=this._ext.disjoint();if(c&&!f){c=
this._ext.getResult(b.query)/1E6;f=0;if(d.isSome(this._timings.enqueue(c))){for(var f=this._timings.entries,g=f.length,h=0,k=0;k<f.length;k++)h+=f[k];f=h/g}c=c.toFixed(2);f=f?f.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for "+a+", "+c+" ms ("+f+" last 10 avg)\n"+b.commandsLen+" Commands ("+b.drawCommands+" draw)"),console.log("RenderPass breakdown: "),console.table(b.summaries),console.log("Commands: ",b.commands),console.groupEnd()):console.log("Frame report for "+
a+", "+c+" ms ("+f+" last 10 avg)");this._debugOutput.innerHTML=c+" ("+f+")"}c=0;for(b=b.handles;c<b.length;c++)b[c].remove();this._entries.delete(a)}var m={name:a,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(m.handles.push(this._events.on("command",function(a){m.commandsLen++;m.commands.push(a);a.isDrawCommand&&m.drawCommands++})),m.handles.push(this._events.on("summary",function(a){delete a.target;m.summaries.push(a)})));
this._ext.beginTimeElapsed(m.query);this._entries.set(a,m)}};a.prototype.recordEnd=function(a){l&&d.isSome(this._ext)&&this._entries.has(a)&&this._ext.endTimeElapsed()};a.prototype._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})};a.prototype._emitSummary=function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)};return a}();a.Profiler=n})},"esri/core/CircularArray":function(){define(["require",
"exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this._start=this.size=0;this.maxSize=a;this._buffer=Array(a)}Object.defineProperty(a.prototype,"entries",{get:function(){return this._buffer},enumerable:!0,configurable:!0});a.prototype.enqueue=function(a){if(this.size===this.maxSize){var h=this._buffer[this._start];this._buffer[this._start]=a;this._start=(this._start+1)%this.maxSize;return h}this._buffer[(this._start+this.size++)%this.maxSize]=a;
return null};a.prototype.dequeue=function(){if(0===this.size)throw Error("Cannot dequeue from empty buffer");var a=this._buffer[this._start];this.size--;this._start=(this._start+1)%this.maxSize;return a};return a}();a.default=n})},"esri/views/2d/engine/webgl/WebGLDriverTest":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../../../webgl ./VertexStream".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g=m.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest"),
l=function(){function d(a){this._ignoresSamplerPrecision=null;this._context=a}Object.defineProperty(d.prototype,"ignoresSamplerPrecision",{get:function(){k.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=a.testSamplerPrecision(this._context));return this._ignoresSamplerPrecision},enumerable:!0,configurable:!0});return d}();a.testWebGLDriver=function(a){return new l(a)};a.testSamplerPrecision=function(a){var c=h.FramebufferObject.createWithAttachments(a,{target:3553,wrapMode:33071,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},{colorTarget:0,depthStencilTarget:0}),b=new Uint8Array(4),e=new d(a,[0,0,1,0,0,1,1,1]),f=new h.Program(a,"\nprecision highp float; \n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color; \n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n  \n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n  \n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0); \n}\n",
"\nprecision highp float; \n\nvarying vec4 v_color; \n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",{a_pos:0}),l=new h.Texture(a,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));f.setUniform1i("u_texture",0);a.bindTexture(l,0);a.bindFramebuffer(c);a.bindProgram(f);var k=a.getViewport(),l=k.x,m=k.y,n=k.width,k=k.height;a.setViewport(0,0,1,1);e.draw();a.setViewport(l,m,n,k);c.readPixels(0,0,1,1,6408,5121,b);f.dispose();
e.dispose();c.dispose();(a=255!==b[0]||255!==b[1]||255!==b[2]||255!==b[3])&&g.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. ["+b[0]+"."+b[1]+"."+b[2]+"."+b[3]+"]");return a}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require",
"exports","./sources/resolver"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.stencil={name:"stencil",shaders:{vertexShader:m.resolveIncludes("stencil/stencil.vert"),fragmentShader:m.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/2d/support/Timeline":function(){define(["require","exports","../../../core/tsSupport/decorateHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/accessorSupport/decorators"],function(n,a,m,k,h){Object.defineProperty(a,
"__esModule",{value:!0});n=function(){function a(){this._names=new Map}a.prototype.begin=function(a){this._names.has(a)||(this._names.set(a,!1),-1!==a.indexOf("Brush")&&this.record("Esri.FirstDraw"),performance.mark("Esri."+a+".Start"))};a.prototype.end=function(a){this._names.has(a)&&!this._names.get(a)&&(this._names.set(a,!0),performance.mark("Esri."+a+".End"))};a.prototype.record=function(a){this._names.has(a)||(this._names.set(a,!0),performance.mark("Esri."+a))};return a=m([h.subclass("esri.views.2d.support.Timeline")],
a)}();a.Timeline=n})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../webgl ./definitions ./Utils ./util/debug ../../../webgl/FramebufferObject".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){Object.defineProperty(a,"__esModule",{value:!0});var r=g.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),
w=p.createDebugLogger(p.DEBUG_ATTR_UPDATES,r),u=!1,v=function(){function a(a,b,c){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;var d=a.buffer,f=a.pixelType;a=a.textureOnly;var g=e.getPixelArrayCtor(f);this.shared=c;this.pixelType=f;this.size=b;this.textureOnly=a;a||(this.data=new g(l.expect(d)));this._resetRange()}a.prototype.destroy=function(){l.andThen(this._texture,function(a){return a.dispose()});var a=function(a){l.andThen(b._fbos[a],function(b){"0"===a&&b.detachColorTexture();
b.dispose()});b._fbos[a]=null},b=this,c;for(c in this._fbos)a(c);this._texture=null};Object.defineProperty(a.prototype,"_textureDesc",{get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}},enumerable:!0,configurable:!0});a.prototype.setData=function(a,b,c){var e=l.expect(this.data);b=a*this.texelSize+b;!e||b>=e.length?d("esri-2d-debug")&&!u&&(r.error(new h("mapview-attributeStore","Attempted to set out of bounds index")),
u=!0):(e[b]=c,this.dirtyStart=Math.min(this.dirtyStart,a),this.dirtyEnd=Math.max(this.dirtyEnd,a))};a.prototype.getData=function(a,b){if(l.isNone(this.data))return null;a=a*this.texelSize+b;return!this.data||a>=this.data.length?(d("esri-2d-debug")&&!u&&(r.error(new h("mapview-attributeStore","Attempted to read out of bounds index")),u=!0),null):this.data[a]};a.prototype.getTexture=function(a){var b=this;return l.unwrapOr(this._texture,function(){return b._initTexture(a)})};a.prototype.getFBO=function(a,
b){void 0===b&&(b=0);if(l.isNone(this._fbos[b])){var c=0===b?this.getTexture(a):this._textureDesc;this._fbos[b]=q.createWithAttachments(a,c,{colorTarget:0,depthStencilTarget:0})}return this._fbos[b]};Object.defineProperty(a.prototype,"locked",{get:function(){return 5121===this.pixelType&&this.shared&&!this.textureOnly&&d("esri-atomics")&&this.data?1===Atomics.load(this.data,0):!1},enumerable:!0,configurable:!0});a.prototype.updateTexture=function(a){if(!this.locked)try{var b=this.dirtyStart,c=this.dirtyEnd;
if(!(b>c)){this._resetRange();var d=l.expect(this.data).buffer,f=this.getTexture(a),g=(b-b%this.size)/this.size,k=(c-c%this.size)/this.size,m=g*this.size*4,p=4*(this.size+k*this.size)-m,q=e.getPixelArrayCtor(this.pixelType),n=q.BYTES_PER_ELEMENT;try{new q(d,m*n,p)}catch(M){console.debug(M)}var u=new q(d,m*n,p),w=this.size;a=k-g+1;a>this.size?r.error(new h("mapview-webgl","Out-of-bounds index when updating AttributeData")):f.updateData(0,0,g,w,a,u)}}catch(M){console.debug(M)}};a.prototype.update=function(a){var b=
a.data,c=a.start,d=a.end;if(l.isSome(b))for(var e=this.data,f=c*this.texelSize,g=0;g<b.length;g++)a.layout&1<<g%this.texelSize&&(e[f+g]=b[g]);this.dirtyStart=Math.min(this.dirtyStart,c);this.dirtyEnd=Math.max(this.dirtyEnd,d)};a.prototype.resize=function(a,b){var c=this.size;this.size=b;this.textureOnly?c!==this.size&&(this._lastTexture=this._texture,this._texture=null):(b=e.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new b(l.expect(a.buffer)))};a.prototype._resetRange=function(){this.dirtyStart=
4294967295;this.dirtyEnd=0};a.prototype._initTexture=function(a){var b=new c.Texture(a,this._textureDesc,l.unwrapOr(this.data,void 0));if(l.isSome(this._lastTexture)&&this._fbos[0]){var d=this._lastTexture.descriptor.width,f=this._lastTexture.descriptor.height,g=this._lastTexture.descriptor.dataType,h=this._lastTexture.descriptor.pixelFormat,k=this.getFBO(a),m=e.getPixelBytes(g),p=e.getPixelArrayCtor(g),m=new ArrayBuffer(d*f*m*this.texelSize),p=new p(m),m=a.getBoundFramebufferObject(),q=a.getViewport(),
n=q.x,r=q.y,u=q.width,q=q.height;a.bindFramebuffer(k);k.readPixels(0,0,d,f,h,g,p);b.updateData(0,0,0,2*d,f/2,p);a.setViewport(n,r,u,q);a.bindFramebuffer(m)}this.destroy();return this._texture=b};return a}();n=function(){function a(){this._locked=this._forceNextUpload=this._initialized=!1}a.prototype.initialize=function(a){var b=a.blocks,c=a.shared,d=a.size;this.shared=c;this.size=d;w("Initializing AttributeStoreView",a);if(l.isNone(this._data))this._data=l.mapMany(b,function(a){return new v(a,d,c)});
else for(a=0;a<this._data.length;a++){var e=this._data[a],f=b[a];l.isSome(f)&&(l.isNone(e)?this._data[a]=new v(f,d,c):e.resize(f,d))}this._initialized=!0};a.prototype.destroy=function(){l.andThen(this._data,function(a){return l.mapMany(a,function(a){return a.destroy()})});l.andThen(this._defaultTexture,function(a){return a.dispose()})};a.prototype.getBlock=function(a){return l.isNone(this._data)?null:this._data[a]};a.prototype.setLabelMinZoom=function(a,b){this.setData(a,0,1,b)};a.prototype.getLabelMinZoom=
function(a){return this.getData(a,0,1,255)};a.prototype.getFilterFlags=function(a){return this.getData(a,0,0,0)};a.prototype.getVVSize=function(a){return this.getData(a,b.ATTRIBUTE_DATA_VV,0,0)};a.prototype.getData=function(a,b,c,d){if(!this._data)return 0;b=l.expect(this._data)[b];if(l.isNone(b))return 0;a=b.getData(a,c);return l.isSome(a)?a:d};a.prototype.setData=function(a,b,c,d){b=l.expect(this._data)[b];l.expect(b).setData(a,c,d)};a.prototype.lockTextureUpload=function(){this._locked=!0};a.prototype.unlockTextureUpload=
function(){this._locked=!1};a.prototype.forceTextureUpload=function(){this._forceNextUpload=!0};a.prototype.requestUpdate=function(a){return k(this,void 0,void 0,function(){var b;return m(this,function(c){if(this._pendingAttributeUpdate)return r.error(new h("mapview-webgl","Tried to update attribute data with a pending update")),[2];b=f.createResolver();w("AttributeStoreView Update Requested",a);this._pendingAttributeUpdate={data:a,resolver:b};return[2,b.promise]})})};a.prototype.update=function(){if(this._initialized&&
l.isSome(this._pendingAttributeUpdate)){for(var a=this._pendingAttributeUpdate,b=a.data,a=a.resolver,c=l.expect(this._data),d=function(a){var d=b.blocks[a];l.andThen(c[a],function(b){return l.andThen(d,function(c){w("Updating block "+a,c);b.update(c)})})},e=0;e<b.blocks.length;e++)d(e);this._pendingAttributeUpdate=null;a()}};a.prototype.bindTextures=function(a){this.update();var c=this._getDefaultTexture(a);if(this._initialized){var d=l.expect(this._data);if(!this._locked||this._forceNextUpload)l.forEachSome(d,
function(b){return b.updateTexture(a)}),this._forceNextUpload=!1;a.bindTexture(l.mapOr(d[0],c,function(b){return b.getTexture(a)}),b.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.bindTexture(l.mapOr(d[1],c,function(b){return b.getTexture(a)}),b.TEXTURE_BINDING_ATTRIBUTE_DATA_1);a.bindTexture(l.mapOr(d[2],c,function(b){return b.getTexture(a)}),b.TEXTURE_BINDING_ATTRIBUTE_DATA_2);a.bindTexture(l.mapOr(d[3],c,function(b){return b.getTexture(a)}),b.TEXTURE_BINDING_ATTRIBUTE_DATA_3)}else a.bindTexture(c,b.TEXTURE_BINDING_ATTRIBUTE_DATA_0),
a.bindTexture(c,b.TEXTURE_BINDING_ATTRIBUTE_DATA_1),a.bindTexture(c,b.TEXTURE_BINDING_ATTRIBUTE_DATA_2),a.bindTexture(c,b.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};a.prototype._getDefaultTexture=function(a){l.isNone(this._defaultTexture)&&(this._defaultTexture=new c.Texture(a,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4)));return this._defaultTexture};return a}();a.AttributeStoreView=n})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){function p(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.name]=d.strideInBytes}return b}function q(a){switch(a){case b.WGLGeometryType.MARKER:return x;case b.WGLGeometryType.FILL:return z;case b.WGLGeometryType.LINE:return A;case b.WGLGeometryType.TEXT:return E;case b.WGLGeometryType.LABEL:return B}return null}function r(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function w(a){return"string"===typeof a}function u(a){switch(a){case 5120:case 5121:return 1;
case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function v(a){var b={},c=function(c){var d=0;b[c]=a[c].map(function(a){var b=m({},a,{normalized:a.normalized||!1,divisor:a.divisor||0,offset:d,stride:0});d+=a.count*u(a.type);return b});b[c].forEach(function(a){return a.stride=d})},d;for(d in a)c(d);return b}Object.defineProperty(a,"__esModule",{value:!0});var y,t=h.getLogger("esri.views.2d.engine.webgl.Utils");a.C_VBO_GEOMETRY="geometry";a.C_VBO_PERINSTANCE="per_instance";a.C_VBO_PERINSTANCE_VV=
"per_instance_vv";a.C_ICON_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_FILL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_FILL_VERTEX_DEF_DD=[{name:a.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];a.C_LINE_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];a.C_TEXT_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];a.C_LABEL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];a.C_ICON_STRIDE_SPEC=p(a.C_ICON_VERTEX_DEF);
a.C_FILL_STRIDE_SPEC=p(a.C_FILL_VERTEX_DEF);a.C_FILL_STRIDE_SPEC_DD=p(a.C_FILL_VERTEX_DEF_DD);a.C_LINE_STRIDE_SPEC=p(a.C_LINE_VERTEX_DEF);a.C_TEXT_STRIDE_SPEC=p(a.C_TEXT_VERTEX_DEF);a.C_LABEL_STRIDE_SPEC=p(a.C_LABEL_VERTEX_DEF);a.getStrides=function(c,d){switch(c){case b.WGLGeometryType.MARKER:return a.C_ICON_STRIDE_SPEC;case b.WGLGeometryType.FILL:return d?a.C_FILL_STRIDE_SPEC_DD:a.C_FILL_STRIDE_SPEC;case b.WGLGeometryType.LINE:return a.C_LINE_STRIDE_SPEC;case b.WGLGeometryType.TEXT:return a.C_TEXT_STRIDE_SPEC;
case b.WGLGeometryType.LABEL:return a.C_LABEL_STRIDE_SPEC}return null};var x=[a.C_VBO_GEOMETRY],z=[a.C_VBO_GEOMETRY],A=[a.C_VBO_GEOMETRY],E=[a.C_VBO_GEOMETRY],B=[a.C_VBO_GEOMETRY];a.getNamedBuffers=q;a.strideToPackingFactor=r;a.allocateTypedArrayBuffer=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(Math.floor(a*b/4));case 1:case 3:return new Uint8Array(a*b)}};a.allocateTypedArrayBufferwithData=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};
a.getTextProperties=function(a){return e.TextProperties.pool.acquire(a.color?c.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?c.copyAndPremultiply(a.haloColor):[255,255,255,255],g.pt2px(a.haloSize),g.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};a.isDefined=function(a){return null!=a};a.isNumber=function(a){return"number"===
typeof a};a.isString=w;a.isStringOrNull=function(a){return null==a||w(a)};n=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(b)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();a.KeysGetter=n;n=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);
return this._arr};return a}();a.ValuesGetter=n;a.getCapType=function(a,b){switch(a){case "butt":return l.CapType.BUTT;case "round":return b?l.CapType.SQUARE:l.CapType.ROUND;case "square":return l.CapType.SQUARE;default:return t.error(new k("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),l.CapType.ROUND}};a.getJoinType=function(a){switch(a){case "miter":return l.JoinType.MITER;case "bevel":return l.JoinType.BEVEL;case "round":return l.JoinType.ROUND;default:return t.error(new k("mapview-invalid-type",
"Join type "+a+" is not a valid option. Defaulting to round")),l.JoinType.ROUND}};a.getVVType=function(a){switch(a){case "opacity":return b.VVType.OPACITY;case "color":return b.VVType.COLOR;case "rotation":return b.VVType.ROTATION;case "size":return b.VVType.SIZE;default:return t.error("Cannot interpret unknown vv: "+a),null}};a.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};a.copyMeshData=function(a,b,c,d,e,f,g){for(var h in f)for(var l=f[h].stride,k=r(l),m=
f[h].data,p=c[h].data,q=l*e.vertexCount/k,n=l*a/k,k=l*e.vertexFrom/k,l=0;l<q;++l)p[l+n]=m[l+k];c=e.indexCount;for(l=0;l<c;++l)d[l+b]=g[l+e.indexFrom]-e.vertexFrom+a};a.C_VBO_INFO=(y={},y[a.C_VBO_GEOMETRY]=35044,y);a.createGeometryData=function(a,b){for(var c=[],d=0;5>d;++d){for(var e={},f=0,g=q(d);f<g.length;f++){var h=g[f];e[h]={data:b(d,h)}}c.push({data:a(d),buffers:e})}return c};a.createTextureFromTexelData=function(a,b){var c,e;d.isPowerOfTwo(b.width)&&d.isPowerOfTwo(b.height)?(c=!0,e=9987):(c=
!1,e=9729);return new f.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:c,samplingMode:e,wrapMode:33071,flipped:!0},b)};a.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};a.getBytes=u;a.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:t.error(new k("webgl-utils","Unable to handle type "+a))}};a.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;case 32819:return Uint16Array;
case 5126:return Float32Array;default:t.error(new k("webgl-utils","Unable to handle type "+a))}};var G=new Map;a.createProgramDescriptor=function(a,b){if(!G.has(a)){var c=v(b),d={},e;for(e in c){var f=c[e];d[e]=f.length?f[0].stride:0}e={};for(var g in b)for(var f=0,h=b[g];f<h.length;f++){var l=h[f];e[l.name]=l.location}G.set(a,{strides:d,bufferLayouts:c,attributes:e})}return G.get(a)}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],function(n,a,m){function k(a,
d){Array.isArray(d)?(a[0]=d[0],a[1]=d[1],a[2]=d[2],a[3]=d[3]):(a[0]=d.r,a[1]=d.g,a[2]=d.b,a[3]=d.a);return a}function h(a,d,f){void 0===d&&(d=0);void 0===f&&(f=!1);var c=a[d+3];a[d+0]*=c;a[d+1]*=c;a[d+2]*=c;f||(a[d+3]*=255);return a}Object.defineProperty(a,"__esModule",{value:!0});a.white=[255,255,255,1];var d=[0,0,0,0];a.premultiplyAlpha=h;a.copyAndPremultiply=function(a){return h(k([],a))};a.premultiplyAlphaUint32=function(a){h(k(d,a));return m.i8888to32(d[0],d[1],d[2],d[3])};a.premultiplyAlphaRGBA=
function(a){var d=a.a;return m.i8888to32(a.r*d,a.g*d,a.b*d,255*d)}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require","exports","../../../../core/ObjectPool"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}a.prototype.acquire=function(a,d,g,l,f,c,b,e,k){this.color=a;this.haloColor=d;this.haloSize=
g;this.size=l;this.angle=f;this.offsetX=c;this.offsetY=b;this.hAnchor=e;this.vAnchor=k};a.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};a.pool=new m(a);return a}();a.TextProperties=n})},"esri/views/2d/engine/webgl/util/debug":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});a.createDebugLogger=function(a,k){return a&&function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return k.warn.apply(k,["DEBUG:"].concat(a))}||function(){return null}};a.DEBUG_ATTR_UPDATES=!1})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["require","exports","../definitions"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this._bucketSize=a;this._rowsLength=m.TILE_SIZE/a;this._colsLength=
m.TILE_SIZE/a;this._grid=this._initGrid()}a.prototype.checkOverlap=function(a,d){a=Math.floor(a/this._bucketSize);d=Math.floor(d/this._bucketSize);if(0>a||a>=this._rowsLength||0>d||d>=this._colsLength||this._grid[d][a])return!0;this._grid[d][a]=!0;return!1};a.prototype.reset=function(){this._grid=this._initGrid()};a.prototype._initGrid=function(){for(var a=[],d=0;d<this._rowsLength;d++)a.push(Array(this._colsLength));return a};return a}();a.CollisionGrid=n})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports ../../../../../core/Error ../../../../../core/iteratorUtils ../../../../../core/Logger ../../../../../core/mathUtils ../definitions ./CollisionBucket ./LayerCollisionInfo".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});var c=g.TILE_SIZE/g.COLLISION_BUCKET_SIZE,b=h.getLogger("esri.views.2d.engine.webgl.collisions.CollisionEngine");n=function(){function a(a){this._layers=new Map;this._collisionBuckets=new Map;this._didError=!1;this._tilingScheme=a}Object.defineProperty(a.prototype,"collisionInfos",{get:function(){return k.valuesOfMap(this._layers)},enumerable:!0,configurable:!0});a.prototype.registerLayerView=function(a,b){if(!this._layers.has(a)){var c=
f.default.create(a,b,this.collisionInfos,this._tilingScheme);this._layers.set(a,c);this._collisionBuckets.forEach(function(a){return a.onRegisterLayer(c.index)})}};a.prototype.unregisterLayerView=function(a){var b=this;if(this._layers.has(a)){var c=this._layers.get(a);f.default.delete(c.index,this.collisionInfos);this._layers.delete(a);this._collisionBuckets.forEach(function(a,d){var e=a.getTile(c.index);e&&(a.onUnregisterLayer(c.index),a.canDelete()&&b._collisionBuckets.delete(d),e.reference&&(e.reference.isDirty=
!1))})}};a.prototype.addTile=function(a,b){var c=b.key.id;this._layers.has(a)&&(this._collisionBuckets.has(c)||this._collisionBuckets.set(c,new l.default(b.key,this._layers.size)),a=this._getIndex(a),this._collisionBuckets.get(c).getTile(a).reference=b)};a.prototype.removeTile=function(a,b){this._layers.has(a)&&this._collisionBuckets.has(b)&&(a=this._getIndex(a),b=this._collisionBuckets.get(b).getTile(a),b.dirty=!1,b.reference=null)};a.prototype.run=function(a,c){var d=k.valuesOfMap(this._collisionBuckets).sort(function(a,
b){return a.key.compareRowMajor(b.key)}),e=!0,g=a.renderingOptions.labelCollisionsEnabled&&!this._didError,h=this.collisionInfos;try{for(var l=0;l<d.length;l++)for(var p=d[l],e=e||p.isDirty,q=0;q<this._layers.size;q++){var n=f.default.find(q,h);p.computeNeighbors(this._collisionBuckets);p.reset(a,e,n)}for(a=0;a<this._layers.size;a++)for(n=f.default.find(a,h),e=0,l=d;e<l.length;e++)p=l[e],this._run(g,p,n,c)}catch(A){b.error(new m("mapview-labeling","Encountered an error during decluttering. Disabling collisions",
A)),this._didError=!0}for(c=0;c<d.length;c++)p=d[c],p.ready()};a.prototype._run=function(a,b,c,d){var e=b.getReference(c.index);e&&e.hasData&&(e.key.level!==d?this._resetLabelsMinZoom(b,c):this._runVisibility(a,b,e,c,d))};a.prototype._resetLabelsMinZoom=function(a,b){if(a&&"polyline"!==b.geometryType&&(a=a.getReference(b.index))&&a.hasData){b=b.layerView.tileRenderer.featuresView.attributeView;var c=0;for(a=a.displayObjects;c<a.length;c++)b.setLabelMinZoom(a[c].id,255)}};a.prototype._checkLabelsVisible=
function(a,b){var c=!b.effect||b.effect.excludedLabelsVisible||!!(a&g.EFFECT_FLAG_0);return(!b.filter||!!(a&g.FILTER_FLAG_0))&&c};a.prototype._runVisibility=function(a,b,c,d,e){for(var f=d.layerView.tileRenderer.featuresView.attributeView,g=0,h=c.displayObjects.sort(function(a,b){a=f.getLabelMinZoom(a.id);b=f.getLabelMinZoom(b.id);return a-b});g<h.length;g++){var l=h[g];if(l.metrics.length){var k="polyline"===d.geometryType?0:10*(e-1),m=f.getFilterFlags(l.id),p=this._checkLabelsVisible(m,d.layerView);
if(a)for(var q=0;q<l.metrics.length;q++)m=l.metrics[q],m=p?-1!==m.minZoom?m.minZoom:this._computeLabelVisibility(l,m,d.index,b,c,m.baseZoom,e):255,k=Math.max(m,k);f.setLabelMinZoom(l.id,k);p=0;for(l=l.metrics;p<l.length;p++)m=l[p],m.minZoom=k}}};a.prototype._computeLabelVisibility=function(a,b,d,e,f,g,h){for(var l=b.xBucket,k=b.yBucket,m=b.xOverflow,p=b.yOverflow,q=l-m,l=l+m+1,m=k+p+1,k=k-p;k<m;k++)for(p=q;p<l;p++)if(!(p<-c||k<-c||p>c||k>c))for(var n=0;n<=d;n++){var r=this._getRelativeSubBucket(n,
e,f,p,k);if(r)for(var u=0;u<r.length;u++){var w=r[u];w.id!==a.id&&(w=this._compareLabels(b,w,g,h),g=Math.max(w,g))}}return g};a.prototype._compareLabels=function(a,b,c,e){if(-1===b.minZoom||b.minZoom>10*(e+1))return c;a=a.findCollisionDelta(b);e=d.clamp(Math.floor(10*(a+e)),0,255);return b.minZoom>=e?c:Math.max(c,e)};a.prototype._getNeighboringTile=function(a,b,c,d,e){return(b=b.neighbors[3*(1+e)+(1+d)])&&b.getTile(a)};a.prototype._getRelativeSubBucket=function(a,b,c,e,f){var g=d.sign(Math.floor(e/
4)),h=d.sign(Math.floor(f/4));return(a=this._getNeighboringTile(a,b,c,g,h))&&a.reference&&a.index&&a.reference.hasData?a.index[f-4*h][e-4*g]:null};a.prototype._getIndex=function(a){return this._layers.get(a).index};return a}();a.CollisionEngine=n})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require","exports","../../../tiling","./CollisionBucketEntry"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,g){this.neighbors=Array(9);
this._tiles=Array(g);for(var d=0;d<g;d++)this._tiles[d]=new k.default;this.key=a}Object.defineProperty(a.prototype,"isDirty",{get:function(){for(var a=0,g=this._tiles;a<g.length;a++)if(g[a].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._tiles.length},enumerable:!0,configurable:!0});a.prototype.getTile=function(a){return this._tiles[a]};a.prototype.getReference=function(a){return(a=this._tiles[a])&&a.reference};a.prototype.onRegisterLayer=
function(a){this.invalidateRange(a);this._add(a)};a.prototype.onUnregisterLayer=function(a){this.invalidateRange(a);this._remove(a)};a.prototype.onLabelsRendered=function(){};a.prototype.invalidateRange=function(a){for(;a<this._tiles.length;a++)this._tiles[a].dirty=!0};a.prototype.add=function(a){this._add(a)};a.prototype.remove=function(a){this._remove(a)};a.prototype.canDelete=function(){return 0===this._tiles.length};a.prototype.ready=function(){for(var a=0,g=this._tiles;a<g.length;a++)g[a].dirty=
!1};a.prototype.computeNeighbors=function(a){this.neighbors[0]=this._getNeighbor(a,-1,-1);this.neighbors[1]=this._getNeighbor(a,0,-1);this.neighbors[2]=this._getNeighbor(a,1,-1);this.neighbors[3]=this._getNeighbor(a,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(a,1,0);this.neighbors[6]=this._getNeighbor(a,-1,1);this.neighbors[7]=this._getNeighbor(a,0,1);this.neighbors[8]=this._getNeighbor(a,1,1)};a.prototype.reset=function(a,g,h){for(var d=0,c=this._tiles;d<c.length;d++){var b=
c[d];b&&b.reset(a,g,h)}};a.prototype._add=function(a){var d=[];if(a>=this._tiles.length)this._tiles.push(new k.default);else{for(var h=0;h<this._tiles.length;h++)h===a&&d.push(new k.default),d.push(this._tiles[h]);this._tiles=d}};a.prototype._remove=function(a){for(var d=[],h=0;h<this._tiles.length;h++)h!==a&&d.push(this._tiles[h]);this._tiles=d};a.prototype._getNeighbor=function(a,g,h){var d=this.key;g=m.TileKey.getId(d.level,d.row+h,d.col+g,d.world);return a.has(g)?a.get(g):null};return a}();a.default=
n})},"esri/views/2d/tiling":function(){define("require exports ./tiling/TileInfoView ./tiling/TileKey ./tiling/TileQueue ./tiling/TileStrategy".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});a.TileInfoView=m;a.TileKey=k;a.TileQueue=h;a.TileStrategy=d})},"esri/views/2d/tiling/TileInfoView":function(){define("require exports ../../../geometry/support/spatialReferenceUtils ./LODInfo ./TileCoverage ./TileKey ./TileSpan".split(" "),function(n,a,m,k,h,d,g){var l=new d("0/0/0/0"),
f=function(){function a(a,b,c,d,f,g,h,l){this.x=a;this.ymin=b;this.ymax=c;this.invM=d;this.leftAdjust=f;this.rightAdjust=g;this.leftBound=h;this.rightBound=l}a.create=function(b,c){var d;b[1]>c[1]&&(d=[c,b],b=d[0],c=d[1]);d=b[0];b=b[1];var e=c[0];c=c[1];var f=e-d,g=c-b,g=0!==g?f/g:0,h=(Math.ceil(b)-b)*g,l=(Math.floor(b)-b)*g;return new a(d,Math.floor(b),Math.ceil(c),g,0>f?h:l,0>f?l:h,0>f?e:d,0>f?d:e)};a.prototype.incrRow=function(){this.x+=this.invM};a.prototype.getLeftCol=function(){return Math.max(this.x+
this.leftAdjust,this.leftBound)};a.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)};return a}(),c=[[0,0],[0,0],[0,0],[0,0]];return function(){function a(a,b){var c=this;this.tileInfo=a;this.fullExtent=b;this.scales=[];this._lodInfos=null;this._infoByScale={};this._infoByLevel={};var d=a.lods.slice();d.sort(function(a,b){return b.scale-a.scale});var e=this._lodInfos=d.map(function(c){return k.create(a,c,b)});d.forEach(function(a,b){c._infoByLevel[a.level]=
e[b];c._infoByScale[a.scale]=e[b];c.scales[b]=a.scale},this);this._wrap=a.isWrappable}Object.defineProperty(a.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},enumerable:!0,configurable:!0});a.prototype.getLODInfoAt=function(a){return this._infoByLevel["number"===typeof a?a:a.level]};a.prototype.getTileBounds=function(a,b,c){void 0===c&&(c=!1);l.set(b);return(b=this._infoByLevel[l.level])?b.getTileBounds(a,l,c):a};a.prototype.getTileCoords=function(a,b,c){void 0===
c&&(c=!1);l.set(b);return(b=this._infoByLevel[l.level])?b.getTileCoords(a,l,c):a};a.prototype.getTileCoverage=function(a,b,d){void 0===b&&(b=192);void 0===d&&(d="closest");d="closest"===d?this.getClosestInfoForScale(a.scale):this.getSmallestInfoForScale(a.scale);var e=h.pool.acquire(d),l=this._wrap,k;k=Infinity;var m=-Infinity,p,q,n=e.spans;c[0][0]=c[0][1]=c[1][1]=c[3][0]=-b;c[1][0]=c[2][0]=a.size[0]+b;c[2][1]=c[3][1]=a.size[1]+b;for(b=0;b<c.length;b++){var z=c[b];a.toMap(z,z);z[0]=d.getColumnForX(z[0]);
z[1]=d.getRowForY(z[1])}a=[];z=3;for(b=0;4>b;b++){if(c[b][1]!==c[z][1]){var A=f.create(c[b],c[z]);k=Math.min(A.ymin,k);m=Math.max(A.ymax,m);void 0===a[A.ymin]&&(a[A.ymin]=[]);a[A.ymin].push(A)}z=b}if(null==k||null==m||100<m-k)return null;for(z=[];k<m;){null!=a[k]&&(z=z.concat(a[k]));p=Infinity;q=-Infinity;for(b=z.length-1;0<=b;b--)A=z[b],p=Math.min(p,A.getLeftCol()),q=Math.max(q,A.getRightCol());p=Math.floor(p);q=Math.floor(q);if(k>=d.first[1]&&k<=d.last[1])if(l)if(d.size[0]<d.worldSize[0])for(A=
Math.floor(q/d.worldSize[0]),b=Math.floor(p/d.worldSize[0]);b<=A;b++)n.push(new g(k,Math.max(d.getFirstColumnForWorld(b),p),Math.min(d.getLastColumnForWorld(b),q)));else n.push(new g(k,p,q));else p>d.last[0]||q<d.first[0]||(p=Math.max(p,d.first[0]),q=Math.min(q,d.last[0]),n.push(new g(k,p,q)));k+=1;for(b=z.length-1;0<=b;b--)A=z[b],A.ymax>=k?A.incrRow():z.splice(b,1)}return e};a.prototype.getTileParentId=function(a){l.set(a);a=this._lodInfos.indexOf(this._infoByLevel[l.level])-1;if(0>a)return null;
this._getTileIdAtLOD(l,this._lodInfos[a],l);return l.id};a.prototype.getTileResolution=function(a){return(a=this._infoByLevel["object"===typeof a?a.level:a])?a.resolution:-1};a.prototype.getTileScale=function(a){return(a=this._infoByLevel[a.level])?a.scale:-1};a.prototype.intersects=function(a,b){l.set(b);b=this._infoByLevel[l.level];var c=a.lodInfo;if(c.resolution>b.resolution){this._getTileIdAtLOD(l,c,l);for(var d=c.denormalizeCol(l.col,l.world),e=0,f=a.spans;e<f.length;e++){var g=f[e];if(g.row===
l.row&&g.colFrom<=d&&g.colTo>=d)return!0}}if(c.resolution<b.resolution){f=a.spans.reduce(function(a,b){a[0]=Math.min(a[0],b.row);a[1]=Math.max(a[1],b.row);a[2]=Math.min(a[2],b.colFrom);a[3]=Math.max(a[3],b.colTo);return a},[Infinity,-Infinity,Infinity,-Infinity]);a=f[0];var d=f[1],e=f[2],f=f[3],h=b.denormalizeCol(l.col,l.world),g=c.getColumnForX(b.getXForColumn(h)),k=c.getRowForY(b.getYForRow(l.row)),h=c.getColumnForX(b.getXForColumn(h+1))-1;b=c.getRowForY(b.getYForRow(l.row+1))-1;return!(g>f||h<
e||k>d||b<a)}var m=c.denormalizeCol(l.col,l.world);return a.spans.some(function(a){return a.row===l.row&&a.colFrom<=m&&a.colTo>=m})};a.prototype.normalizeBounds=function(a,b,c){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];this._wrap&&(b=m.getInfo(this.tileInfo.spatialReference),c=-c*(b.valid[1]-b.valid[0]),a[0]+=c,a[2]+=c);return a};a.prototype.getSmallestInfoForScale=function(a){var b=this.scales;if(this._infoByScale[a])return this._infoByScale[a];if(a>b[0])return this._infoByScale[b[0]];for(var c=1;c<
b.length-1;c++)if(a>b[c]+1E-6)return this._infoByScale[b[c-1]];return this._infoByScale[b[b.length-1]]};a.prototype.getClosestInfoForScale=function(a){var b=this.scales;if(this._infoByScale[a])return this._infoByScale[a];a=b.reduce(function(b,c,d,e){return Math.abs(c-a)<Math.abs(b-a)?c:b},b[0]);return this._infoByScale[a]};a.prototype.scaleToLevel=function(a){var b=this.scales;if(this._infoByScale[a])return this._infoByScale[a].level;for(var c=b.length-1;0<=c;c--)if(a<b[c])return c===b.length-1?this._infoByScale[b[b.length-
1]].level:this._infoByScale[b[c]].level+(b[c]-a)/(b[c]-b[c+1]);return this._infoByScale[b[0]].level};a.prototype.scaleToZoom=function(a){return this.tileInfo.scaleToZoom(a)};a.prototype._getTileIdAtLOD=function(a,b,c){var d=this._infoByLevel[c.level];a.set(c);if(b.resolution<d.resolution)return null;if(b.resolution===d.resolution)return a;a.level=b.level;a.col=Math.floor(c.col*d.resolution/b.resolution+.01);a.row=Math.floor(c.row*d.resolution/b.resolution+.01);return a};return a}()})},"esri/views/2d/tiling/LODInfo":function(){define(["require",
"exports","../../../geometry/support/spatialReferenceUtils","./TileKey"],function(n,a,m,k){function h(a,d,f){a[0]=d;a[1]=f;return a}var d=new k("0/0/0/0");return function(){function a(a,d,c,b,e,g,h,k,m,n,v,y){this.level=a;this.resolution=d;this.scale=c;this.origin=b;this.first=e;this.last=g;this.size=h;this.norm=k;this.worldStart=m;this.worldEnd=n;this.worldSize=v;this.wrap=y}a.create=function(d,f,c){var b=m.getInfo(d.spatialReference),e=[d.origin.x,d.origin.y],g=[d.size[0]*f.resolution,d.size[1]*
f.resolution],l=[-Infinity,-Infinity],k=[Infinity,Infinity],n=[Infinity,Infinity];c&&(h(l,Math.max(0,Math.floor((c.xmin-e[0])/g[0])),Math.max(0,Math.floor((e[1]-c.ymax)/g[1]))),h(k,Math.max(0,Math.floor((c.xmax-e[0])/g[0])),Math.max(0,Math.floor((e[1]-c.ymin)/g[1]))),h(n,k[0]-l[0]+1,k[1]-l[1]+1));var u;d.isWrappable?(d=[Math.ceil(Math.round(2*b.origin[1]/f.resolution)/d.size[0]),n[1]],b=[Math.floor((b.origin[0]-e[0])/g[0]),l[1]],c=[d[0]+b[0]-1,k[1]],u=!0):(b=l,c=k,d=n,u=!1);return new a(f.level,f.resolution,
f.scale,e,l,k,n,g,b,c,d,u)};a.prototype.normalizeCol=function(a){if(!this.wrap)return a;var d=this.worldSize[0];return 0>a?d-1-Math.abs((a+1)%d):a%d};a.prototype.denormalizeCol=function(a,d){return this.wrap?this.worldSize[0]*d+a:a};a.prototype.getWorldForColumn=function(a){return this.wrap?Math.floor(a/this.worldSize[0]):0};a.prototype.getFirstColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]};a.prototype.getLastColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]+
this.size[0]-1};a.prototype.getColumnForX=function(a){return(a-this.origin[0])/this.norm[0]};a.prototype.getXForColumn=function(a){return this.origin[0]+a*this.norm[0]};a.prototype.getRowForY=function(a){return(this.origin[1]-a)/this.norm[1]};a.prototype.getYForRow=function(a){return this.origin[1]-a*this.norm[1]};a.prototype.getTileBounds=function(a,f,c){void 0===c&&(c=!1);d.set(f);var b=c?d.col:this.denormalizeCol(d.col,d.world),e=d.row;f=this.getXForColumn(b);c=this.getYForRow(e+1);b=this.getXForColumn(b+
1);e=this.getYForRow(e);a[0]=f;a[1]=c;a[2]=b;a[3]=e;return a};a.prototype.getTileCoords=function(a,f,c){void 0===c&&(c=!1);d.set(f);f=c?d.col:this.denormalizeCol(d.col,d.world);Array.isArray(a)?h(a,this.getXForColumn(f),this.getYForRow(d.row)):(a.x=this.getXForColumn(f),a.y=this.getYForRow(d.row));return a};return a}()})},"esri/views/2d/tiling/TileCoverage":function(){define(["require","exports","../../../core/ObjectPool"],function(n,a,m){return function(){function a(a){this.lodInfo=a;this.spans=
[]}a.prototype.release=function(){};a.prototype.forEach=function(a,d){var g=this.spans,h=this.lodInfo,f=h.level;if(0!==g.length)for(var c=0;c<g.length;c++)for(var b=g[c],e=b.row,k=b.colTo,b=b.colFrom;b<=k;b++)a.call(d,f,e,h.normalizeCol(b),h.getWorldForColumn(b))};a.pool=new m(a,!0);return a}()})},"esri/views/2d/tiling/TileSpan":function(){define(["require","exports","../../../core/ObjectPool"],function(n,a,m){return function(){function a(a,d,g){this.row=a;this.colFrom=d;this.colTo=g}a.pool=new m(a,
!0);return a}()})},"esri/views/2d/tiling/TileQueue":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../support/QueueProcessor".split(" "),function(n,a,m,k,h,d,g,l,f,c){function b(a,b){a.length=0;b.forEach(function(b){return a.push(b)});return a}var e=
new Set,p=[],q=new Map,r=[0,0];return function(a){function g(b){b=a.call(this,b)||this;b._keyToItem=new Map;b.concurrency=6;b.strategy="scale-first";b.tileInfoView=null;return b}m(g,a);g.prototype.initialize=function(){var a=this,b=this.concurrency,d=this.process,e="scale-first"===this.strategy?this._peekByScaleFirst.bind(this):this._peekByCenterFirst.bind(this);this._queue=new c.QueueProcessor({concurrency:b,process:function(b,c){b=a._keyToItem.get(b);return d(b,{signal:c})},peeker:e})};g.prototype.destroy=
function(){this.clear();this._queue.destroy();this._queue=null};Object.defineProperty(g.prototype,"length",{get:function(){return this._queue?this._queue.length:0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"onGoingCount",{get:function(){return this._keyToItem.size},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return 0<this.length||0<this.onGoingCount},enumerable:!0,configurable:!0});g.prototype.abort=function(a){this._queue.abort("string"===
typeof a?a:a.id)};g.prototype.clear=function(){this._queue.clear();this._keyToItem.clear();this.notifyChange("updating")};g.prototype.get=function(a){return this._queue.get("string"===typeof a?a:a.id)};g.prototype.has=function(a){return"string"===typeof a?this._keyToItem.has(a):this._keyToItem.has(a.id)};g.prototype.isOngoing=function(a){a="string"===typeof a?a:a.id;return this.has(a)&&this._queue.isOngoing(a)};g.prototype.pause=function(){this._queue.pause()};g.prototype.push=function(a){return d(this,
void 0,void 0,function(){var b,c,d,e=this;return h(this,function(f){b=a.key.id;if(this.has(b))return[2,this.get(b)];c=this._queue.push(b);d=function(){e._keyToItem.delete(b);e.notifyChange("updating")};this._keyToItem.set(b,a);c.then(d,d);this.notifyChange("updating");return[2,c]})})};g.prototype.reset=function(){this._queue.reset();this.notifyChange("updating")};g.prototype.resume=function(){this._queue.resume()};g.prototype._peekByScaleFirst=function(a){if(!this.state)return a[0];for(var c=this.tileInfoView,
d=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,g=0;g<a.length;g++){var h=this._keyToItem.get(a[g]),l=this.tileInfoView.getTileScale(h.key);q.has(l)||(q.set(l,[]),d=Math.max(l,d),f=Math.min(l,f));q.get(l).push(h.key);e.add(l)}var k=this.state.scale;q.has(k)||(b(p,e),p.sort(),k=p.reduce(function(a,b,c,d){return Math.abs(b-k)<Math.abs(a-k)?b:a},p[0]));k=Math.min(k,d);k=Math.max(k,f);a=q.get(k);var m=c.getClosestInfoForScale(k),n=m.getColumnForX(this.state.center[0]),r=m.getRowForY(this.state.center[1]);
a.sort(function(a,b){var c=m.denormalizeCol(a.col,a.world),d=m.denormalizeCol(b.col,b.world);return Math.sqrt((n-c)*(n-c)+(r-a.row)*(r-a.row))-Math.sqrt((n-d)*(n-d)+(r-b.row)*(r-b.row))});e.clear();q.clear();return a[0].id};g.prototype._peekByCenterFirst=function(a){if(!this.state)return a[0];for(var b=this.tileInfoView,c=this.state.center,d=Number.POSITIVE_INFINITY,e=null,g=0;g<a.length;g++){var h=this._keyToItem.get(a[g]);b.getTileCoords(r,h.key);var l=f.vec2.distance(r,c);l<d&&(d=l,e=h.key)}return e.id};
k([l.property({constructOnly:!0})],g.prototype,"concurrency",void 0);k([l.property({constructOnly:!0})],g.prototype,"process",void 0);k([l.property()],g.prototype,"state",void 0);k([l.property({constructOnly:!0})],g.prototype,"strategy",void 0);k([l.property({constructOnly:!0})],g.prototype,"tileInfoView",void 0);k([l.property({readOnly:!0})],g.prototype,"updating",null);return g=k([l.subclass("esri.views.2d.tiling.TileQueue")],g)}(l.declared(g))})},"esri/views/support/QueueProcessor":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/scheduling".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});var f=function(){return function(a,b){this.item=a;this.controller=b;this.promise=null}}();n=function(){function a(a){var b=this;this._deferreds=new Map;this._controllers=new Map;this._processingItems=new Map;this._isPaused=!1;this._task=this._schedule=null;this.concurrency=1;a.concurrency&&(this.concurrency=a.concurrency);this._queue=new g({peeker:a.peeker});this.process=a.process;var c=a.scheduler;a.task&&h.isSome(c)&&(this._task=
c.registerTask(a.task,function(a){return b.update(a)},function(){return b.needsUpdate()}))}a.prototype.destroy=function(){this.clear();this._schedule&&(this._schedule.remove(),this._schedule=null);this._task&&(this._task.remove(),this._task=null)};Object.defineProperty(a.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0});a.prototype.abort=function(a){(a=this._controllers.get(a))&&a.abort()};a.prototype.clear=function(){this._queue.clear();
var a=[];this._controllers.forEach(function(b){return a.push(b)});this._controllers.clear();a.forEach(function(a){return a.abort()});this._processingItems.clear();this._cancelNext()};a.prototype.get=function(a){return(a=this._deferreds.get(a))?a.promise:void 0};a.prototype.isOngoing=function(a){return this._processingItems.has(a)};a.prototype.has=function(a){return this._deferreds.has(a)};a.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())};a.prototype.push=function(a){return k(this,
void 0,void 0,function(){var b,c,f,g,h,l,k=this;return m(this,function(e){if(b=this.get(a))return[2,b];f=d.createAbortController();g=function(){var b=k._processingItems.get(a);b&&b.controller.abort();h();c.reject(d.createAbortError())};h=function(){l.remove();k._deferreds.delete(a);k._controllers.delete(a);k._queue.remove(a);k._processingItems.delete(a);k._scheduleNext()};l=d.onAbortOrThrow(f.signal,g);c=d.createDeferred();this._deferreds.set(a,c);this._controllers.set(a,f);c.promise.then(h,h);this._queue.push(a);
this._scheduleNext();return[2,c.promise]})})};a.prototype.reset=function(){var a=[];this._processingItems.forEach(function(b){return a.push(b)});this._processingItems.clear();for(var c=0;c<a.length;c++){var d=a[c];this._queue.push(d.item);d.controller.abort()}this._scheduleNext()};a.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};a.prototype.needsUpdate=function(){return!this._isPaused&&0<this._queue.length&&this._processingItems.size<this.concurrency};a.prototype.update=
function(a){for(;!a.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),a.madeProgress()};a.prototype._scheduleNext=function(){var a=this;this._task||this._isPaused||this._schedule||(this._schedule=l.schedule(function(){a._schedule=null;a._next()}))};a.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};a.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),
this._schedule=null)};a.prototype._processResult=function(a,c){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).resolve(c))};a.prototype._processError=function(a,c){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).reject(c))};a.prototype._canProcessFulfillment=function(a){return this._deferreds.get(a.item)&&this._processingItems.get(a.item)===a?!0:!1};a.prototype._process=function(a){var b=this;if(!h.isNone(a)){var c,g=d.createAbortController(),
l=new f(a,g);this._processingItems.set(a,l);try{c=this.process(a,g.signal)}catch(w){this._processError(l,w)}c&&"function"===typeof c.then?(l.promise=c,c.then(function(a){return b._processResult(l,a)},function(a){return b._processError(l,a)})):this._processResult(l,c)}};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{update:function(b){return a.update(b)}}},enumerable:!0,configurable:!0});return a}();a.QueueProcessor=n})},"esri/core/Queue":function(){define(["require","exports"],
function(n,a){return function(){function a(a){this._items=[];this._itemSet=new Set;this._peeker=function(a){return a[0]};this._length=0;a&&a.peeker&&(this._peeker=a.peeker)}Object.defineProperty(a.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._itemSet.clear();this._length=this._items.length=0};a.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)};a.prototype.push=function(a){this.contains(a)||this._add(a)};
a.prototype.contains=function(a){return 0<this._length&&this._itemSet.has(a)};a.prototype.pop=function(){if(0!==this._length){var a=this.peek();this._remove(a);return a}};a.prototype.remove=function(a){this.contains(a)&&this._remove(a)};a.prototype._add=function(a){this._items.push(a);this._itemSet.add(a);this._length++};a.prototype._remove=function(a){this._itemSet.delete(a);this._items.splice(this._items.indexOf(a),1);this._length--};return a}()})},"esri/views/2d/tiling/TileStrategy":function(){define("require exports ../../../core/tsSupport/extendsHelper ./TileCache ./TileCoverage ./TileKey".split(" "),
function(n,a,m,k,h,d){var g=new d(0,0,0,0),l=new Map,f=[],c=[];return function(){function a(a){var b=this;this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;this.resampling=null==a.resampling||!!a.resampling;a.cachePolicy&&(this.cachePolicy=a.cachePolicy);a.coveragePolicy&&(this.coveragePolicy=
a.coveragePolicy);null!=a.buffer&&(this.buffer=a.buffer);a.cacheSize&&(this._tileCache=new k.default(a.cacheSize,this.tileInfoView,function(a){b.releaseTile(a)}))}a.prototype.destroy=function(){this.tileIndex.clear()};a.prototype.update=function(a){var b=this,d=this.resampling,e=this.tileIndex,k=this.tileInfoView.getTileCoverage(a.state,this.buffer,this.coveragePolicy);c.length=0;f.length=0;l.clear();if(k){var m=this.tileInfoView.tileInfo,n=m.minScale,y=m.maxScale,t=k.spans,x=k.lodInfo,z=x.level,
A=a.state,E=A.scale,m=A.center,A=A.resolution,B=!a.stationary&&E>this._previousScale;this._previousScale=E;this.tiles.length=0;if(!d&&(E>n||E<y))return this.tiles.length=0,l.clear(),e.forEach(function(a){b.releaseTile(a)}),e.clear(),c.length=0,f.length=0,l.clear(),h.pool.release(k),!0;e.forEach(function(a){return a.visible=!0});y=n=0;if(0<t.length)for(E=0;E<t.length;E++){a=t[E];for(var G=a.row,F=a.colTo,K=a.colFrom;K<=F;K++)if(n++,a=g.set(z,G,x.normalizeCol(K),x.getWorldForColumn(K)).id,e.has(a))d=
e.get(a),d.isReady?(l.set(a,d),y++):B||this._addParentTile(a,l);else{d=void 0;if(this._tileCache&&this._tileCache.has(a)){if(d=this._tileCache.pop(a),this.tileIndex.set(a,d),d.isReady){l.set(a,d);y++;continue}}else d=this.acquireTile(g),this.tileIndex.set(a,d);B||this._addParentTile(a,l)}}var H=y===n;e.forEach(function(a,d){g.set(d);if(!l.has(d)){var e=b.tileInfoView.intersects(k,g);!e||!B&&H?"purge"===b.cachePolicy?g.level===z&&e||f.push(d):(g.level>z||!e)&&f.push(d):a.isReady?c.push(d):g.level>
z&&f.push(d)}});for(t=0;t<c.length;t++)a=c[t],(d=e.get(a))&&d.isReady&&l.set(a,d);for(t=0;t<f.length;t++)a=f[t],d=e.get(a),this._tileCache?this._tileCache.add(d):this.releaseTile(d),e["delete"](a);l.forEach(function(a){return b.tiles.push(a)});e.forEach(function(a){l.has(a.key.id)||(a.visible=!1)});this._tileCache&&this._tileCache.prune(z,m,A);h.pool.release(k);return H}};a.prototype.clear=function(){var a=this,b=this.tileIndex;b.forEach(function(b){a.releaseTile(b)});b.clear()};a.prototype._addParentTile=
function(a,b){for(var c=null;;){a=this.tileInfoView.getTileParentId(a);if(!a)break;if(this.tileIndex.has(a)){if((c=this.tileIndex.get(a))&&c.isReady){b.has(c.key.id)||b.set(c.key.id,c);break}}else if(this._tileCache&&this._tileCache.has(a)&&(c=this._tileCache.pop(a),this.tileIndex.set(a,c),c&&c.isReady)){b.has(c.key.id)||b.set(c.key.id,c);break}}};return a}()})},"esri/views/2d/tiling/TileCache":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2"],function(n,a,m){Object.defineProperty(a,
"__esModule",{value:!0});var k=[0,0],h=[0,0];n=function(){function a(a,d,f){this.maxSize=a;this.tileInfoView=d;this.removedFunc=f;this._tilePerId=new Map;this._tileKeysPerLevel=[]}a.prototype.has=function(a){return this._tilePerId.has(a)};a.prototype.get=function(a){return this._tilePerId.get(a)};a.prototype.pop=function(a){var d=this._tilePerId.get(a);if(!d)return null;var f=this._tileKeysPerLevel[d.key.level];this._tilePerId["delete"](a);for(var c=0;c<f.length;c++)if(f[c].id===a){f.splice(c,1);
break}d.visible=!0;return d};a.prototype.add=function(a){a.visible=!1;var d=a.key,f=d.id;this._tilePerId.has(f)||(this._tilePerId.set(f,a),a=d.level,this._tileKeysPerLevel[a]||(this._tileKeysPerLevel[a]=[]),this._tileKeysPerLevel[a].push(d))};a.prototype.prune=function(a,d,f){var c=this._tilePerId.size;if(!(c<=this.maxSize)){for(var b=this._tileKeysPerLevel.length-1;c>this.maxSize&&0<=b;)b!==a&&(c=this._pruneAroundCenterTile(c,d,f,b)),b--;c>this.maxSize&&(c=this._pruneAroundCenterTile(c,d,f,a))}};
a.prototype._pruneAroundCenterTile=function(a,d,f,c){c=this._tileKeysPerLevel[c];if(!c||0===c.length)return a;var b=this.tileInfoView.tileInfo,e=b.size,g=b.origin,l=f*e[0],n=f*e[1];for(c.sort(function(a,b){k[0]=g.x+l*(a.col+.5);k[1]=g.y-n*(a.row+.5);h[0]=g.x+l*(b.col+.5);h[1]=g.y-n*(b.row+.5);return m.vec2.squaredDistance(k,d)-m.vec2.squaredDistance(h,d)});0<c.length&&(f=c.pop(),this._removeTile(f.id),a--,a!==this.maxSize););return a};a.prototype._removeTile=function(a){var d=this._tilePerId.get(a);
this.removedFunc&&this.removedFunc(d);this._tilePerId["delete"](a)};return a}();a.default=n})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._reference=null}Object.defineProperty(a.prototype,"dirty",{get:function(){return this.reference&&this.reference.isDirty},set:function(a){this.reference&&this.reference.hasData&&
(a||this.reference.isDirty)&&(this.reference.isDirty=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"reference",{get:function(){return this._reference},set:function(a){this._reference=a},enumerable:!0,configurable:!0});a.prototype.reset=function(a,d,g){var h=a.state;a=a.renderingOptions;var f=g.layerView.tileRenderer,c=this.reference;
if(!c||!c.hasData)return!1;d&&(c.isDirty=!0);d=c.transforms.labelMat2d;for(var b=d[4],e=d[5],k=0,q=c.displayObjects;k<q.length;k++)for(var n=q[k],w=f.featuresView.attributeView,w=g.hasVV()?w.getVVSize(n.id):0,u=0,n=n.metrics;u<n.length;u++){var v=n[u];g.hasVV()&&v.computeOffset(w,g.vvEval);var y=v.bounds.center,t=v.bounds.centerT;c.isDirty&&(v.minZoom=-1);var x=m.vec2.copy(t,v.anchor);h.rotation?m.vec2.transformMat2d(x,x,d):(t[0]=x[0]+b,t[1]=x[1]+e);m.vec2.add(t,x,y);t[0]+=v.offsetX;t[1]+=v.offsetY;
var x=h.size,y=x[0],x=x[1],z=v.bounds,A=z.halfHeight,z=z.halfWidth,E=a.edgeLabelsVisible?-1:1;"polyline"!==g.geometryType&&(0>t[0]-z*E||t[0]+z*E>y||0>t[1]-A*E||t[1]+A*E>x)&&(v.minZoom=255);if(v.boxes)for(t=0,y=v.boxes;t<y.length;t++)x=y[t],A=x.centerT,m.vec2.add(A,v.anchor,x.center),h.rotation?m.vec2.transformMat2d(A,A,d):(A[0]+=b,A[1]+=e)}return!0};return a}();a.default=n})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define("require exports ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/screenUtils ./visualVariableSimpleUtils".split(" "),
function(n,a,m,k,h,d){function g(a){return function(b){return h.pt2px(d.getSizeForValueSimple(b,a))}}function l(a){if(!a)return null;for(var b=0;b<a.length;b++){var c=a[b];if("size"===c.type)return g(c)}return null}Object.defineProperty(a,"__esModule",{value:!0});var f=function(a,b){return a.order-b.order},c=function(a,b){return a.index-b.index},b=m.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");a.createLabelVVEvaluator=l;n=function(){function a(a,b,c,d){var e=this;this._vvHandle=
null;var f=a.layer,g=f.geometryType,h=f.labelingInfo,m=f.renderer;this.vvEval=l("visualVariables"in m&&m.visualVariables);this._vvHandle=f.watch("visualVariables",function(a){e.vvEval=l(a)});f=h.map(function(a){var b=!!a.maxScale,c=!!a.minScale&&d.scaleToZoom(a.minScale)||0;a=b&&d.scaleToZoom(a.maxScale)||255;return{minZoom:k.clamp(Math.floor(10*c),0,255),maxZoom:k.clamp(Math.floor(10*a),0,255)}});this.layerView=a;this.geometryType=g;this.index=b;this.order=c;this.zoomRanges=f;this.layerView=a}a.prototype.hasVV=
function(){return!!this.vvEval};a.prototype.allOrNothing=function(){return"polyline"!==this.geometryType};a.prototype.destroy=function(){this._vvHandle.remove()};a.create=function(b,c,d,e){d=d.sort(f);for(var g=!1,h=-1,l=0;l<d.length;l++){var k=d[l];!g&&k.order>c&&(h=k.index,g=!0);g&&k.index++}g||(h=d.length);return new a(b,h,c,e)};a.delete=function(a,b){for(var d=b.sort(c),e=a+1;e<d.length;e++)b[e].index--;b[a].destroy();b.splice(a,1)};a.find=function(a,c){for(var d=0;d<c.length;d++){var e=c[d];
if(e.index===a)return e}b.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return a}();a.default=n})},"esri/views/2d/engine/webgl/collisions/visualVariableSimpleUtils":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../renderers/support/utils"],function(n,a,m,k){function h(a,c){switch(c.transformationType){case "additive":var b=d(c.minSize,a);return a+(b||c.minDataValue);case "constant":return b=(b=c.stops)&&b.length&&b[0].size,
null==b&&(b=c.minSize),d(b,a);case "clamped-linear":var b=(a-c.minDataValue)/(c.maxDataValue-c.minDataValue),e=d(c.minSize,a),f=d(c.maxSize,a);a=a<=c.minDataValue?e:a>=c.maxDataValue?f:e+b*(f-e);return a;case "proportional":return b=a/c.minDataValue,e=d(c.minSize,a),a=d(c.maxSize,a),m.clamp(b*e,e,a);case "stops":return e=g(a,c.cache.ipData),f=e[0],b=e[1],e=e[2],f===b?a=d(c.stops[f].size,a):(f=d(c.stops[f].size,a),a=d(c.stops[b].size,a),a=f+(a-f)*e),a;case "real-world-size":b=k.meterIn[c.valueUnit];
e=d(c.minSize,a);f=d(c.maxSize,a);c=c.valueRepresentation;var h=null,h="area"===c?2*Math.sqrt(a/l)/b:"radius"===c||"distance"===c?2*a/b:a/b;return m.clamp(h,e,f);case "identity":return a;case "unknown":return null}}function d(a,c){return"number"===typeof a?a:h(c,a)}function g(a,c){if(c){var b=0,d=c.length-1;c.some(function(c,e){if(a<c)return d=e,!0;b=e;return!1});return[b,d,(a-c[b])/(c[d]-c[b])]}}Object.defineProperty(a,"__esModule",{value:!0});var l=Math.PI;a.getSizeForValueSimple=h})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require",
"exports"],function(n,a){function m(a){return"esri.views.2d.layers.FeatureLayerView2D"===a.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===a.declaredClass}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d){this.registerLayer=a;this.unregisterLayer=d;this._layerViewState=new Map}a.prototype.findIndex=function(a){return a.view.allLayerViews.findIndex(function(d){return d.uid===a.uid})};a.prototype.update=function(a){for(var d=a.added,g=0,h=a.removed;g<h.length;g++)a=
h[g],m(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(g=0;g<d.length;g++){a=d[g];if(h=m(a))a:switch(a.get("layer.renderer.type")){case "class-breaks":case "simple":case "unique-value":h=!0;break a;default:h=!1}h&&!this._layerViewState.has(a)&&this._createState(a)}this._recomputeOrder()};a.prototype.destroy=function(){this._layerViewState.forEach(function(a,d){return a.handle.remove()})};a.prototype._createState=function(a){var d={priority:-1,handle:null};d.handle=a.watch("labelsVisible",
this._recomputeOrder.bind(this));this._layerViewState.set(a,d);return d};a.prototype._deleteState=function(a){if(this._layerViewState.has(a)){var d=this._layerViewState.get(a);d.handle.remove();-1!==d.priority&&this.unregisterLayer(a);this._layerViewState.delete(a)}};a.prototype._recomputeOrder=function(){var a=this;this._layerViewState.forEach(function(d,g){var h=g.view.map.allLayers.findIndex(function(a){return a.uid===g.layer.uid}),f=g.layer,h=f.visible&&f.labelsVisible&&f.labelingInfo?4294967295-
h:-1;h!==d.priority&&(d.priority=h,a.unregisterLayer(g),-1!==h&&a.registerLayer(g,h))})};return a}();a.LayerViewSorter=n})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,h){this.x=a;this.y=h}a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.equals=function(a,h){return a===this.x&&h===this.y};a.prototype.isEqual=function(a){return a.x===this.x&&a.y===this.y};
a.prototype.setCoords=function(a,h){this.x=a;this.y=h};a.prototype.normalize=function(){var a=this.x,h=this.y,a=Math.sqrt(a*a+h*h);this.x/=a;this.y/=a};a.prototype.rightPerpendicular=function(){var a=this.x;this.x=this.y;this.y=-a};a.prototype.move=function(a,h){this.x+=a;this.y+=h};a.prototype.assign=function(a){this.x=a.x;this.y=a.y};a.prototype.assignAdd=function(a,h){this.x=a.x+h.x;this.y=a.y+h.y};a.prototype.assignSub=function(a,h){this.x=a.x-h.x;this.y=a.y-h.y};a.prototype.rotate=function(a,
h){var d=this.x,g=this.y;this.x=d*a-g*h;this.y=d*h+g*a};a.prototype.scale=function(a){this.x*=a;this.y*=a};a.prototype.length=function(){var a=this.x,h=this.y;return Math.sqrt(a*a+h*h)};a.distance=function(a,h){var d=h.x-a.x;a=h.y-a.y;return Math.sqrt(d*d+a*a)};a.add=function(k,h){return new a(k.x+h.x,k.y+h.y)};a.sub=function(k,h){return new a(k.x-h.x,k.y-h.y)};return a}();a.Point=n})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});a.getXAnchorDirection=function(a){switch(a){case "left":return 1;case "right":return-1;case "center":case "justify":return 0}};a.getYAnchorDirection=function(a){switch(a){case "top":return-1;case "middle":return 0;case "baseline":case "bottom":return 1}};a.getJustification=function(a){switch(a){case "left":return 0;case "right":return 1;case "center":case "justify":return.5}}})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../definitions ../VertexStream ./WGLBrush".split(" "),
function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g={nearest:{defines:[],samplingMode:9728,mips:!1},bilinear:{defines:[],samplingMode:9729,mips:!1},bicubic:{defines:["bicubic"],samplingMode:9729,mips:!1},trilinear:{defines:[],samplingMode:9987,mips:!0}};n=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c._desc={path:"raster/bitmap",attributes:{a_position:0,a_texcoord:1}};return c}m(d,a);d.prototype.dispose=function(){this._quad&&this._quad.dispose()};
d.prototype.prepareState=function(a,b){a=a.context;a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};d.prototype.draw=function(a,b){var c=a.context,d=a.renderingOptions,f=a.painter;if(b.source){a.timeline.begin(this.name);this._quad||(this._quad=new h(c,[0,0,1,0,0,1,1,1]));if("dynamic"===d.samplingMode)var d=a.state,l=b.resolution/b.pixelRatio/d.resolution,m=
Math.round(a.pixelRatio)!==a.pixelRatio,d=d.rotation||1.05<l||.95>l||m||b.isSourceScaled||b.rotation?g.bilinear:g.nearest;else d=g[d.samplingMode];f=f.materialManager.getProgram(a,this._desc,d.defines);b.setSamplingProfile(d);b.bind(k.TEXTURE_BINDING_BITMAP);c.bindProgram(f);f.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);f.setUniform1i("u_texture",k.TEXTURE_BINDING_BITMAP);f.setUniform2fv("u_coordScale",b.coordScale);this._quad.draw();a.timeline.end(this.name)}};return d}(d.default);a.default=
n})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/programUtils".split(" "),function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._color=k.vec4f32.fromValues(0,1,0,1);return b}m(c,a);c.prototype.dispose=function(){this._program&&
this._program.dispose()};c.prototype.prepareState=function(a,c){a=a.context;a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setFaceCullingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setStencilFunction(519,0,255)};c.prototype.draw=function(a,c){var b=a.context;a=a.state;this._program||(this._program=l.createProgram(b,g.background));var d=this._program,e=h.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:5122}]});
c=c.getVAO(b,a,e.attributes,e.bufferLayouts);b.bindProgram(this._program);d.setUniform2fv("u_coord_range",[1,1]);d.setUniform4fv("u_color",this._color);d.setUniformMatrix3fv("u_dvsMat3",a.displayMat3);b.bindVAO(c);b.drawElements(4,c.indexBuffer.size,5125,0);b.bindVAO()};return c}(d.default);a.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../definitions ./WGLBrush".split(" "),function(n,
a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}m(d,a);d.prototype.prepareState=function(a,c,b){a=a.context;b=b&&-1!==b.indexOf("id");a.setBlendingEnabled(!b);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,c.stencilRef,255)};d.prototype.draw=function(a,c,b){var d=this;if(c.isReady&&c.hasData){c.commitChanges(a);var f=
this.getGeometryType(),g=c.getDisplayList(a.drawPhase),h=c.getGeometry(a,f);h&&g&&(a.timeline.begin(this.name),g.byType(f,function(e){d.drawGeometry(a,c,e,h,b)}),a.timeline.end(this.name))}};d.prototype._getVAO=function(a,c,b,d){d.vao||(d.vao=new k.VertexArrayObject(a,b,c,d.vertexBufferMap,d.indexBuffer));return d.vao};d.prototype._setSharedUniforms=function(a,c,b){a.setUniform1f("u_pixelRatio",c.pixelRatio);a.setUniformMatrix3fv("u_dvsMat3",b.transforms.dvs);a.setUniformMatrix3fv("u_displayViewMat3",
c.state.displayViewMat3);a.setUniformMatrix4fv("u_insideEffectMat4",c.rendererInfo.insideEffect);a.setUniformMatrix4fv("u_outsideEffectMat4",c.rendererInfo.outsideEffect);a.setUniform1fv("u_insideOpacities",c.rendererInfo.insideOpacities);a.setUniform1fv("u_outsideOpacities",c.rendererInfo.outsideOpacities);a.setUniform1i("u_attributeTextureSize",c.attributeView.size);a.setUniform1i("u_attributeData0",h.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.setUniform1i("u_attributeData1",h.TEXTURE_BINDING_ATTRIBUTE_DATA_1);
a.setUniform1i("u_attributeData2",h.TEXTURE_BINDING_ATTRIBUTE_DATA_2);a.setUniform1i("u_attributeData3",h.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};return d}(d.default);a.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/RandomLCG ../../../../webgl ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(n,
a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b._dotTextureSize=0;b._dotTextures=null;b._dotSamplers=new Int32Array([g.TEXTURE_BINDING_RENDERER_0,g.TEXTURE_BINDING_RENDERER_1]);return b}m(c,a);c.prototype.dispose=function(){this._disposeTextures()};c.prototype.getGeometryType=function(){return l.WGLGeometryType.FILL};c.prototype.drawGeometry=function(a,c,d,e,h){var l=a.context,k=a.painter,m=a.rendererInfo,
p=a.requiredLevel,q=d.indexCount,n=d.indexFrom;d=b.FillMaterialKey.load(d.materialKey);var r=f.createProgramDescriptor(d.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121}].concat(d.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],d.dotDensity?
[{location:2,name:"a_inverseArea",count:1,type:5126}]:[])}),u=r.bufferLayouts,r=r.attributes;h=k.materialManager.getMaterialProgram(a,d,"materials/fill",r,h);e=this._getVAO(l,u,r,e);l.bindProgram(h);l.bindVAO(e);this._setSharedUniforms(h,a,c);d.textureBinding&&(k.textureManager.bindTextures(l,h,d),k=1/Math.pow(2,p-c.key.level)/a.pixelRatio,h.setUniform1f("u_zoomFactor",k));d.vvColor&&(h.setUniform1fv("u_vvColorValues",m.vvColorValues),h.setUniform4fv("u_vvColors",m.vvColors));d.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",
m.vvOpacityValues),h.setUniform1fv("u_vvOpacities",m.vvOpacities));d.dotDensity&&(d=g.TILE_SIZE/m.ddDotSize,e=d*window.devicePixelRatio*d*window.devicePixelRatio,k=1/Math.pow(2,p-c.key.level),c=1/k*(1/k),a=m.ddDotScale?a.state.scale/m.ddDotScale:1,h.setUniform1f("u_tileZoomFactor",k),h.setUniform1f("u_tileDotsOverArea",e/(g.TILE_SIZE*window.devicePixelRatio*g.TILE_SIZE*window.devicePixelRatio)),h.setUniformMatrix4fv("u_dotColors",m.ddColors),h.setUniform4fv("u_isActive",m.ddActiveDots),h.setUniform4fv("u_dotBackgroundColor",
m.ddBackgroundColor),h.setUniform1f("u_dotValue",Math.max(1,m.ddDotValue*a*c)),this._bindDotDensityTextures(l,h,m,d));l.drawElements(4,q,5125,4*n);l.bindVAO(null)};c.prototype._disposeTextures=function(){if(this._dotTextures){for(var a=0;a<this._dotTextures.length;a++)this._dotTextures[a].dispose();this._dotTextures=null}};c.prototype._bindDotDensityTextures=function(a,b,c,d){c=this._createDotDensityTextures(a,d,c.ddSeed);b.setUniform1iv("u_dotTextures",this._dotSamplers);for(b=0;b<c.length;b++)a.bindTexture(c[b],
this._dotSamplers[b])};c.prototype._createDotDensityTextures=function(a,b,c){if(this._dotTextureSize!==b||this._seed!==c)this._disposeTextures(),this._dotTextureSize=b,this._seed=c;null===this._dotTextures&&(c=new h(c),this._dotTextures=[this._allocDotDensityTexture(a,b,c),this._allocDotDensityTexture(a,b,c)]);return this._dotTextures};c.prototype._allocDotDensityTexture=function(a,b,c){for(var e=new Float32Array(b*b*4),f=0;f<e.length;f++)e[f]=c.getFloat();return new d.Texture(a,{wrapMode:10497,pixelFormat:6408,
dataType:5126,samplingMode:9728,width:b,height:b},e)};return c}(c.default);a.default=n})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Error ../../../../../core/maybe ../enums ../mesh/templates/WGLLabelTemplate ../util/vvFlagUtils".split(" "),function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});a.createMaterialKey=
function(a,b,c,d){if(g.isSome(b)){a:{if("heatmap"===b.type)throw Error("Symbol processor does not support heatmap renderer");switch(a){case l.WGLGeometryType.FILL:a=q.from(b);break a;case l.WGLGeometryType.LINE:a=w.from(b,c);break a;case l.WGLGeometryType.MARKER:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Marker GeometryTypes");a=r.from(b);break a;case l.WGLGeometryType.TEXT:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Text GeometryTypes");
a=u.from(b);break a;case l.WGLGeometryType.LABEL:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Label GeometryTypes");a=v.from(b,d);break a;default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}}return a}switch(a){case l.WGLGeometryType.FILL:return q.from(null);case l.WGLGeometryType.LINE:return w.from(null,c);case l.WGLGeometryType.MARKER:return r.from(null);case l.WGLGeometryType.TEXT:return u.from(null);case l.WGLGeometryType.LABEL:return v.from(null,
d);default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}};n=function(){function a(a){this._data=0;this._data=a}a.load=function(a){var b=this.shared;b.data=a;return b};Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.bits(5,8)},set:function(a){this.setBits(a,5,8)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"mapAligned",{get:function(){return!!this.bit(17)},set:function(a){this.setBit(17,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sdf",{get:function(){return!!this.bit(8)},set:function(a){this.setBit(8,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pattern",{get:function(){return!!this.bit(9)},set:function(a){this.setBit(9,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureBinding",{get:function(){return this.bits(0,5)},set:function(a){this.setBits(a,
0,5)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryTypeString",{get:function(){switch(this.geometryType){case l.WGLGeometryType.FILL:return"fill";case l.WGLGeometryType.MARKER:return"marker";case l.WGLGeometryType.LINE:return"line";case l.WGLGeometryType.TEXT:return"text";case l.WGLGeometryType.LABEL:return"label";default:throw new d("Unable to handle unknown geometryType: "+this.geometryType);}},enumerable:!0,configurable:!0});a.prototype.setBit=function(a,b){a=1<<a;
this._data=b?this._data|a:this._data&~a};a.prototype.bit=function(a){return(this._data&1<<a)>>a};a.prototype.setBits=function(a,b,c){for(var d=0;b<c;b++,d++)this.setBit(b,0!==(a&1<<d))};a.prototype.bits=function(a,b){for(var c=0,d=0;a<b;a++,d++)c|=this.bit(a)<<d;return c};a.prototype.hasVV=function(){return!1};a.prototype.setVV=function(a,b){};a.prototype.getVariation=function(){var a={},b;for(b in this)"boolean"===typeof this[b]&&(a[b]=this[b]);return a};a.prototype.getVariationHash=function(){return this._data&
~(4&this.textureBinding)};a.shared=new a(0);return a}();a.MaterialKeyBase=n;k=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);Object.defineProperty(b.prototype,"vvSizeMinMaxValue",{get:function(){return 0!==this.bit(13)},set:function(a){this.setBit(13,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeScaleStops",{get:function(){return 0!==this.bit(14)},set:function(a){this.setBit(14,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"vvSizeFieldStops",{get:function(){return 0!==this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeUnitValue",{get:function(){return 0!==this.bit(16)},set:function(a){this.setBit(16,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue};b.prototype.setVV=function(b,d){a.prototype.setVV.call(this,
b,d);b&=c.getSizeFlagsMask(b,d);this.vvSizeMinMaxValue=!!(b&l.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(b&l.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(b&l.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(b&l.WGLVVFlag.SIZE_SCALE_STOPS)};return b}(a)};var b=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);Object.defineProperty(b.prototype,"vvRotation",{get:function(){return 0!==this.bit(12)},set:function(a){this.setBit(12,a)},
enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvRotation};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvRotation=!c&&!!(b&l.WGLVVFlag.ROTATION)};return b}(a)},e=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);Object.defineProperty(b.prototype,"vvColor",{get:function(){return 0!==this.bit(10)},set:function(a){this.setBit(10,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=
function(){return a.prototype.hasVV.call(this)||this.vvColor};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvColor=!c&&!!(b&l.WGLVVFlag.COLOR)};return b}(a)},p=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);Object.defineProperty(b.prototype,"vvOpacity",{get:function(){return 0!==this.bit(11)},set:function(a){this.setBit(11,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||
this.vvOpacity};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvOpacity=!c&&!!(b&l.WGLVVFlag.OPACITY)};return b}(a)},q=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=l.WGLGeometryType.FILL;g.isSome(a)&&(a instanceof h.DotDensityRenderer?b.dotDensity=!0:(a=c.getVVFlags(a.visualVariables),b.setVV(a,!1)));return b.data};b.prototype.getVariation=
function(){return a.prototype.getVariation.call(this)};Object.defineProperty(b.prototype,"dotDensity",{get:function(){return!!this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});b.shared=new b(0);return b}(e(p(n)));a.FillMaterialKey=q;var r=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=l.WGLGeometryType.MARKER;g.isSome(a)&&(a=c.getVVFlags(a.visualVariables),
b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(e(p(b(k(n)))));a.MarkerMaterialKey=r;var w=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var d=this.load(0);d.geometryType=l.WGLGeometryType.LINE;g.isSome(a)&&(a=c.getVVFlags(a.visualVariables),d.setVV(a,b));return d.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};
b.shared=new b(0);return b}(e(p(k(n))));a.LineMaterialKey=w;var u=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=l.WGLGeometryType.TEXT;g.isSome(a)&&(a=c.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(e(p(b(k(n)))));a.TextMaterialKey=u;var v=
function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var d=this.load(0);d.geometryType=l.WGLGeometryType.LABEL;g.isSome(a)&&(a=c.getVVFlags(a.visualVariables),d.setVV(a,!1));d.mapAligned=!!f.isMapAligned(b.labelPlacement);return d.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(k(n));a.LabelMaterialKey=v})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/mathUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../vectorTiles/GeometryUtils ../../color ../../definitions ../../enums ../../number ../../TextShaping ../../collisions/Metric ../../materialKey/MaterialKey ./GlyphGroup ./util ./WGLTextTemplate".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){function A(a){switch(a){case "above-left":return[-1,-1];case "above-center":case "above-along":return[0,-1];case "above-right":return[1,-1];case "center-left":return[-1,0];case "center-center":case "center-along":return[0,0];case "center-right":return[1,0];case "below-left":return[-1,1];case "below-center":case "below-along":return[0,1];case "below-right":return[1,1];case "always-horizontal":return[0,0];default:K("Found invalid placement type "+
a)}}Object.defineProperty(a,"__esModule",{value:!0});var E=h.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),B=b.vec2f32.create(),G=f.mat2df32.create(),F={xOffset:0,yOffset:0,width:0,height:0},K=function(a,b){void 0===b&&(b="mapview-labeling");return E.error(new k(b,a))};a.isMapAligned=function(a){switch(a){case "above-along":case "below-along":case "center-along":return 1;default:return 0}};n=function(a){function b(b,c,e,f){e=a.call(this,b,e.font.size,e.haloSize||0,e.font.size,e.color&&
p.premultiplyAlphaRGBA(e.color)||0,e.haloColor&&p.premultiplyAlphaRGBA(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.id)||this;e._refTemplate=F;e.geometryType=r.WGLGeometryType.LABEL;var g=c.symbol,h;h=!!c.minScale&&f.scaleToZoom(c.minScale)||0;h=d.clamp(h,0,25.5);f=!!c.maxScale&&f.scaleToZoom(c.maxScale)||255;f=d.clamp(f,0,25.5);var l=A(c.labelPlacement),k=l[0],l=l[1];e._justify=(-1*k+1)/2;e._xAlignD=k;e._yAlignD=l;e._xPlacementD=
k;e._yPlacementD=l;e._minZoom=h;e._maxZoom=f;b=y.LabelMaterialKey.load(y.createMaterialKey(e.geometryType,b,!1,c));b.sdf=!0;e._materialKey=b.data;b=g.font.decoration.toLowerCase();"underline"===b?e._decorationTop=6:"line-through"===b&&(e._decorationTop=-5);return e}m(b,a);b.fromLabelClass=function(a,c,d){return new b(a,c,c.symbol,d)};b.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);isNaN(this._decorationTop)||u.TextShaping.addDecoration(a,this._decorationTop);
this._shapedGlyphs=a;this._shapedBox=u.TextShaping.getBox(a)};b.prototype._computeShaping=function(a,b){return new u.TextShaping([a],q.TEXT_MAX_WIDTH,q.TEXT_LINE_HEIGHT,q.TEXT_SPACING,[0,0],.5,.5,b)};Object.defineProperty(b.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0});b.prototype.bindReferenceTemplate=function(a){this._refTemplate=a||F};b.prototype._placeGlyphs=function(a,b,c,d){var e=this._size,f=this._haloSize,h=this._shapedBox,l=this._shapedGlyphs,k=this._computeGlyphTransform(h);
if("esriGeometryPolyline"!==a)for(var m=0;m<c.length;m++)for(var p=c[m],q=0,n=l;q<n.length;q++){var r=n[q];p.place(r,a,b,k,this._materialKey,e,f,h,d,this._minZoom,this._maxZoom)}else for(m=0;m<c.length;m++)for(var p=c[m],q=r=p.order,n=q-(q-1)/2-1,u=n-(n-1)/2-1,w=u-(u-1)/2-1,r=-1===r?0:q%2?n%2?u%2?w%2?0:d-3.1:d-2.1:d-1.1:d-.1,q=Math.max(d+g.log2((this._shapedBox.width*this._scale+48)/p.pathLen),Math.max(r,this._minZoom)),n=0,u=l;n<u.length;n++)r=u[n],p.place(r,a,b,k,this._materialKey,e,f,h,d,q,this._maxZoom)};
b.prototype.writeMesh=function(a,b,c,d,e,f,g){var h=this,l=this._computeAnchors(c,e),k=w.i8888to32(0,0,0,this._bitset);if(l.length&&this._shapedGlyphs.length){this._placeGlyphs(c,e,l,f);var m=y.LabelMaterialKey.load(this._materialKey);if("esriGeometryPolyline"!==c){c=l[0];e=this._computeGlyphTransform(this._shapedBox);e=this._createBounds(this._shapedBox,e);f=c.glyphs.get(0);var p=f[0],n=p.anchorX,r=p.anchorY,u=Math.floor(10*p.minZoom),p=Math.floor(10*p.maxZoom),t=a.length;f.forEach(function(a){a.minZoom=
25.5;a.maxZoom=25.5});t=new v.default(d,{from:t,count:a.length-t},n,r,u);n=Math.floor(n/q.COLLISION_BUCKET_SIZE);r=Math.floor(r/q.COLLISION_BUCKET_SIZE);n>=q.COLLISION_TILE_BOX_SIZE||r>=q.COLLISION_TILE_BOX_SIZE||0>n||0>r||(this._writeVertices(a,b,d,f,m,k,u,p),f=Math.max(this._refTemplate.height,this._refTemplate.width),m.vvSizeFieldStops||m.vvSizeMinMaxValue||m.vvSizeScaleStops||m.vvSizeUnitValue?t.setVV(f,this._xPlacementD,this._yPlacementD):(t.offsetX=(f/2+q.COLLISION_PLACEMENT_PADDING)*this._xPlacementD,
t.offsetY=(f/2+q.COLLISION_PLACEMENT_PADDING)*this._yPlacementD),t.bounds=e,g.push(t),c.clear())}else{c=function(c){var e=l[c],f=e.x,p=e.y;c=a.length;var q=new v.default(d,{from:c,count:-1},f,p,25.5);e.glyphs.forEach(function(c){for(var g=0;g<c.length;g++){var l=c[g];l.minZoom=Math.max(e.minZoom,l.minZoom);if(l.bounds){var n=l.anchorY-p;l.bounds.center[0]+=l.anchorX-f;l.bounds.center[1]+=n;q.add(l.bounds)}}q.bounds&&h._writeHalos(a,b,d,c,m,k)});e.glyphs.forEach(function(c){q.bounds&&h._writeText(a,
b,d,c,m,k)});q.range.count=a.length-c;q.bounds&&g.push(q);e.clear()};for(e=0;e<l.length;e++)c(e);this._computedGlyphs=[]}}};b.prototype._outsideTile=function(a,b){return 0>a||512<=a||0>b||512<=b};b.prototype._smoothVertices=function(a,b){if(!(0>=b)){var c=a.length;if(!(3>c)){var d=[],e=0;d.push(0);for(var f=1;f<c;f++)e+=x.dist(a[f],a[f-1]),d.push(e);b=Math.min(b,.2*e);e=[];e.push(a[0][0]);e.push(a[0][1]);var g=a[c-1][0],h=a[c-1][1],f=x.sub([0,0],a[0],a[1]);x.normalize(f);a[0][0]+=b*f[0];a[0][1]+=
b*f[1];x.sub(f,a[c-1],a[c-2]);x.normalize(f);a[c-1][0]+=b*f[0];a[c-1][1]+=b*f[1];for(f=1;f<c;f++)d[f]+=b;d[c-1]+=b;for(var l=.5*b,f=1;f<c-1;f++){for(var k=0,m=0,p=0,q=f-1;0<=q&&!(d[q+1]<d[f]-l);q--){var n=l+d[q+1]-d[f],r=d[q+1]-d[q],u=d[f]-d[q]<l?1:n/r;if(1E-6>Math.abs(u))break;var w=u*u,v=u*n-.5*w*r,t=u*r/b,y=a[q+1],z=a[q][0]-y[0],A=a[q][1]-y[1],k=k+t/v*(y[0]*u*n+.5*w*(n*z-r*y[0])-w*u*r*z/3),m=m+t/v*(y[1]*u*n+.5*w*(n*A-r*y[1])-w*u*r*A/3),p=p+t}for(q=f+1;q<c&&!(d[q-1]>d[f]+l);q++){n=l-d[q-1]+d[f];
r=d[q]-d[q-1];u=d[q]-d[f]<l?1:n/r;if(1E-6>Math.abs(u))break;w=u*u;v=u*n-.5*w*r;t=u*r/b;y=a[q-1];z=a[q][0]-y[0];A=a[q][1]-y[1];k+=t/v*(y[0]*u*n+.5*w*(n*z-r*y[0])-w*u*r*z/3);m+=t/v*(y[1]*u*n+.5*w*(n*A-r*y[1])-w*u*r*A/3);p+=t}e.push(k/p);e.push(m/p)}e.push(g);e.push(h);for(q=f=0;f<c;f++)a[f][0]=e[q++],a[f][1]=e[q++]}}};b.prototype._computeLineAnchors=function(a,b,c){b=b.paths;var d=this._scale*this._shapedBox.width;c=d/2+c;for(var d=d/2+16,e=this._shapedBox.width*this._scale,f=0;f<b.length;f++){var g=
b[f],h=[];h.push(g[0]);for(var l=1;l<g.length;l++){var k=h[l-1],m=k[0],k=k[1],m=m+g[l][0],k=k+g[l][1];h.push([m,k])}this._smoothVertices(h,e);g=[];g.push(h[0]);for(l=1;l<h.length;l++){var k=h[l-1],p=h[l],m=Math.round(p[0]-k[0]),k=Math.round(p[1]-k[1]);g.push([m,k])}b[f]=g;h=this._getPathLength(g);if(!(h<2*d))for(var l=h/2,q=0,p=g[0][0],n=g[0][1],r=1;r<g.length;r++){var m=g[r][0],k=g[r][1],u=Math.sqrt(m*m+k*k),q=q+u;if(0<=q-l){var w=q-l,v=u-w,y=v/u,z=p+m*y,x=n+k*y;this._outsideTile(z,x)||(q=new t.default(z,
x,y,f,r,p,n,u,h,-1),a.push(q));for(var A=-1,x=0,x=v-c;0<=x;x-=c){var y=x/u,z=p+m*y,B=n+k*y;A++;this._outsideTile(z,B)||(q=new t.default(z,B,y,f,r,p,n,u,h,A),a.push(q))}q=x+c;x=u-w;y=p;z=n;for(B=r-1;0!==B;B--){var E=g[B][0],G=g[B][1],J=Math.sqrt(E*E+G*G);if(q+J>=c){for(var H=q=c-q;H<J;H+=c){var F=H/J,M=y-E*F,I=z-G*F;A++;(q=H+x+d<l)&&!this._outsideTile(M,I)&&(q=new t.default(M,I,1-F,f,B,y-E,z-G,J,h,A),a.push(q))}q=J-(H-c)}else q+=J;x+=J;y-=E;z-=G}A=-1;for(x=v+c;x<=u;x+=c)y=x/u,z=p+m*y,v=n+k*y,A++,this._outsideTile(z,
v)||(q=new t.default(z,v,y,f,r,p,n,u,h,A),a.push(q));y=p+m;z=n+k;q=u-(x-c);x=w;for(B=r+1;B<g.length;B++){m=g[B][0];k=g[B][1];p=Math.sqrt(m*m+k*k);if(q+p>=c){for(n=q=c-q;n<p;n+=c)r=n/p,u=y+m*r,w=z+k*r,A++,(q=n+x+d<l)&&!this._outsideTile(u,w)&&(q=new t.default(u,w,r,f,B,y,z,p,h,A),a.push(q));q=p-(n-c)}else q+=p;x+=p;y+=m;z+=k}break}p+=m;n+=k}}return a};b.prototype._computeAnchors=function(a,b){var c=[];switch(a){case "esriGeometryPoint":return b=b.geometry,a=b.x,b=b.y,a=new t.default(a,b),c.push(a),
c;case "esriGeometryPolygon":if(b.centroid)return b=b.centroid,a=b.x,b=b.y,a=new t.default(a,b),c.push(a),c;K("Non-centroid polygon anchor placement not supported");break;case "esriGeometryPolyline":return this._computeLineAnchors(c,b.geometry,376);default:return K("Unable to handle geometryType: "+a),c}};b.prototype._getPathLength=function(a){for(var b=0,c=1;c<a.length;c++)var d=a[c][0],e=a[c][1],b=b+Math.sqrt(d*d+e*e);return b};b.prototype._computeGlyphTransform=function(a){var b=this._scale,d=
this._angle*e.C_DEG_TO_RAD,f=a.width/2,g=a.height/2,f=this._xAlignD*f*b+(this._xOffset+this._refTemplate.xOffset)+(a.x+f);a=this._yAlignD*g*b-(this._yOffset+this._refTemplate.yOffset)-(a.y+g);g=l.mat2d.identity(G);l.mat2d.translate(g,g,c.vec2.set(B,f,a));l.mat2d.scale(g,g,c.vec2.set(B,b,b));l.mat2d.rotate(g,g,d);return g};b.prototype._writeVertex=function(a,b,c,d,e,f,g,h,l){b=b.get("geometry");g=Math.min(Math.floor(Math.max(this._refTemplate.width,this._refTemplate.height)),255);var k=this._xPlacementD+
1,m=this._yPlacementD+1;h=w.i8888to32(h,l,0,0);this._refSymbolAndPlacementOffset=w.i8888to32(f.angle,g,k,m);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperLeft);b.push(f.texFontSizeUpperLeft);b.push(this._refSymbolAndPlacementOffset);b.push(h);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperRight);b.push(f.texFontSizeUpperRight);b.push(this._refSymbolAndPlacementOffset);b.push(h);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerLeft);b.push(f.texFontSizeLowerLeft);b.push(this._refSymbolAndPlacementOffset);
b.push(h);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerRight);b.push(f.texFontSizeLowerRight);b.push(this._refSymbolAndPlacementOffset);b.push(h);a.vertexCount+=4};return b}(z.default);a.default=n})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require","exports","./factories/mat2df32"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.mat2df32=m})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});a.create=function(){var a=new Float32Array(6);a[0]=1;a[3]=1;return a};a.clone=function(a){var k=new Float32Array(6);k[0]=a[0];k[1]=a[1];k[2]=a[2];k[3]=a[3];k[4]=a[4];k[5]=a[5];return k};a.fromValues=function(a,k,h,d,g,l){var f=new Float32Array(6);f[0]=a;f[1]=k;f[2]=h;f[3]=d;f[4]=g;f[5]=l;return f};a.createView=function(a,k){return new Float32Array(a,k,6)}})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(n,a){function m(a,
d){a%=d;return 0<=a?a:a+d}Object.defineProperty(a,"__esModule",{value:!0});a.C_INFINITY=Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var k=1/Math.LN2;a.positiveMod=m;a.radToByte=function(h){return m(h*a.C_RAD_TO_256,256)};a.degToByte=function(h){return m(h*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*k};
a.sqr=function(a){return a*a};a.interpolate=function(a,d,g){return a*(1-g)+d*g};a.between=function(a,d,g){return a>=d&&a<=g||a>=g&&a<=d}})},"esri/views/2d/engine/webgl/TextShaping":function(){define(["require","exports","./Rect"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g,l,f,c,b,e){this._glyphItems=a;this._maxWidth=d;this._lineHeight=g;this._letterSpacing=l;this._offset=f;this._hAnchor=c;this._vAnchor=b;this._justify=e}a.prototype.getShaping=function(a,
d){for(var g=this._letterSpacing,h=this._lineHeight,f=this._justify,c=this._maxWidth,b=[],e=0,k=0,m=0,n=0,w=-1,u=0,v=-1,y=a.length,t=0;t<y;t++){var x=a.charCodeAt(t);if(10===x){if(t!==y-1){if(w>=n){var e=b[w],z=e.x+e.glyphMosaicItem.metrics.advance,u=Math.max(z,u);f&&this._applyJustification(b,n,w);n=b.length}k=d?k-h:k+h;e=0;++m}}else{for(var z=void 0,A=0,E=this._glyphItems;A<E.length&&!(z=E[A][x]);A++);if(z){b.push({codePoint:x,x:e,y:k,glyphMosaicItem:z});e+=z.metrics.advance+g;if(0<c&&e>c&&0<=v){A=
v+1;z=b[A].x;u=Math.max(z,u);for(E=A;E<b.length;E++)b[E].y=d?b[E].y-h:b[E].y+h,b[E].x-=z;f&&this._applyJustification(b,n,v);k=d?k-h:k+h;e-=z;++m;n=A;v=-1}++w;32===x&&(v=b.length-1)}}}w>=n&&(e=b[w],u=Math.max(u,e.x+e.glyphMosaicItem.metrics.advance),f&&this._applyJustification(b,n,w));if(0<b.length)for(a=(f-this._hAnchor)*u,g=(-this._vAnchor*(m+1)+.5)*h,d&&m&&(g+=m*h),a+=this._offset[0],g+=this._offset[1],d=0;d<b.length;d++)h=b[d],h.x+=a,h.y+=g;return b};a.getBox=function(a){if(!a.length)return null;
for(var d=Infinity,g=Infinity,h=0,f=0,c=0;c<a.length;c++)var b=a[c],e=b.glyphMosaicItem.metrics,k=e.height,m=b.x,b=b.y-(k-Math.abs(e.top)),e=m+e.width+e.left,k=b+k,d=Math.min(d,m),h=Math.max(h,e),g=Math.min(g,b),f=Math.max(f,k);return{x:d,y:g,width:h-d,height:f-g}};a.addDecoration=function(a,d){var g=a.length;if(0!==g){for(var h=a[0].x+a[0].glyphMosaicItem.metrics.left,f=a[0].y,c=1;c<g;c++){var b=a[c];if(b.y!==f){var e=a[c-1].x+a[c-1].glyphMosaicItem.metrics.left+a[c-1].glyphMosaicItem.metrics.width;
a.push({codePoint:0,x:h,y:f+d-3,glyphMosaicItem:{sdf:!0,rect:new m.default(4,0,4,8),metrics:{width:e-h,height:8,left:0,top:0,advance:0},page:0}});f=b.y;h=b.x+b.glyphMosaicItem.metrics.left}}g=a[g-1].x+a[g-1].glyphMosaicItem.metrics.left+a[g-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:h,y:f+d-3,glyphMosaicItem:{sdf:!0,rect:new m.default(4,0,4,8),metrics:{width:g-h,height:8,left:0,top:0,advance:0},page:0}})}};a.prototype._applyJustification=function(a,d,g){for(var h=a[g],h=(h.x+h.glyphMosaicItem.metrics.advance)*
this._justify;d<=g;d++)a[d].x-=h};return a}();a.TextShaping=n})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f32 ../definitions ./BoundingBox ../util/serializationUtils".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=m.getLogger("esri/views/2d/engine/webgl/collisions/Metric");n=function(){function a(a,b,d,f,g){this.id=a;this.range=b;this.boxes=null;this.minZoom=
-1;this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=0;this.anchor=k.vec2f32.fromValues(d,f);this.baseZoom=g}a.prototype.add=function(a){this.bounds?(this.boxes?this.boxes.push(a):(this.boxes=[this.bounds,a],this.bounds=this.bounds.clone()),this.bounds.extend(a)):this.bounds=a};a.prototype.computeIndex=function(){var a=this.bounds,b=this.anchor[0],d=this.anchor[1],f=Math.floor(b/h.COLLISION_BUCKET_SIZE),g=Math.floor(d/h.COLLISION_BUCKET_SIZE),l=0;if(f>h.COLLISION_TILE_BOX_SIZE||
g>h.COLLISION_TILE_BOX_SIZE)g=f=h.COLLISION_TILE_BOX_SIZE,l=1;if(0>f||0>g)g=f=0,l=1;a=2*Math.max(a.halfWidth+Math.abs(a.center[0]),a.halfHeight+Math.abs(a.center[1]));b%=h.COLLISION_BUCKET_SIZE;d%=h.COLLISION_BUCKET_SIZE;this.xBucket=f;this.yBucket=g;this.xOverflow=Math.ceil(Math.abs((a-b)/h.COLLISION_BUCKET_SIZE))+l;this.yOverflow=Math.ceil(Math.abs((a-d)/h.COLLISION_BUCKET_SIZE))+l};a.prototype.findCollisionDelta=function(a){var b=this.bounds.findCollisionDelta(a.bounds),c=this.boxes&&this.boxes.length,
d=a.boxes&&a.boxes.length;return Math.abs(b)>h.COLLISION_MAX_ZOOM_DELTA||!c&&!d?b:c&&d?this._boxesToBoxes(a):c?this._boxesToBox(a):this._boxToBoxes(a)};a.prototype.computeOffset=function(a,b){b||l.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+b);var c=this.size;this.hasVV&&(a=b(a),c=isNaN(a)||null==a||Infinity===a?this.size:a);this.offsetX=this.directionX*(c/2+h.COLLISION_PLACEMENT_PADDING);this.offsetY=this.directionY*(c/2+h.COLLISION_PLACEMENT_PADDING)};
a.prototype.setVV=function(a,b,d){this.hasVV=!0;this.size=a;this.directionX=b;this.directionY=d};a.prototype.clone=function(){var c=new a(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);c.minZoom=this.minZoom;this.bounds&&(c.bounds=this.bounds.clone());this.boxes&&(c.boxes=this.boxes.map(function(a){return a.clone()}));c.xBucket=this.xBucket;c.yBucket=this.yBucket;c.xOverflow=this.xOverflow;c.yOverflow=this.yOverflow;c.hasVV=this.hasVV;c.size=this.size;c.directionX=this.directionX;
c.directionY=this.directionY;c.offsetX=this.offsetX;c.offsetY=this.offsetY;return c};a.prototype._boxToBoxes=function(a){var b=-Infinity,c=0;for(a=a.boxes;c<a.length;c++)var d=this.bounds.findCollisionDelta(a[c]),b=Math.max(d,b);return b};a.prototype._boxesToBox=function(a){for(var b=this.boxes[0].findCollisionDelta(a.bounds),c=1;c<this.boxes.length;c++)var d=this.boxes[c].findCollisionDelta(a.bounds),b=Math.max(d,b);return b};a.prototype._boxesToBoxes=function(a){for(var b=-Infinity,c=0;c<this.boxes.length;c++)for(var d=
this.boxes[c],f=0,g=a.boxes;f<g.length;f++)var h=d.findCollisionDelta(g[f]),b=Math.max(h,b);return b};a.prototype.serialize=function(a){a.push(this.id);this.bounds.serialize(a);a.push(this.range.from);a.push(this.range.count);a.push(this.anchor[0]);a.push(this.anchor[1]);a.push(this.baseZoom);a.push(this.hasVV?1:0);a.push(this.size);a.push(this.directionX);a.push(this.directionY);a.push(this.offsetX);a.push(this.offsetY);g.serializeList(a,this.boxes);return a};a.deserialize=function(c){var b=c.readInt32(),
e=d.default.deserialize(c),f=c.readInt32(),h=c.readInt32(),l={from:f,count:h},k=c.readInt32(),m=c.readInt32(),n=c.readInt32(),f=c.readInt32(),h=c.readInt32(),y=c.readInt32(),t=c.readInt32(),x=c.readInt32(),z=c.readInt32();c=g.deserializeList(c,d.default);b=new a(b,l,k,m,n);b.bounds=e;b.boxes=c;b.computeIndex();f&&b.setVV(h,y,t);b.offsetX=x;b.offsetY=z;return b};return a}();a.default=n})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/mathUtils",
"../../../../../core/libs/gl-matrix-2/vec2f32"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,g,h,f){this.center=k.vec2f32.fromValues(a,g);this.centerT=k.vec2f32.create();this.halfWidth=h/2;this.halfHeight=f/2;this.width=h;this.height=f}Object.defineProperty(a.prototype,"x",{get:function(){return this.center[0]},set:function(a){this.center[0]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.center[1]},
set:function(a){this.center[1]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trX",{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trY",{get:function(){return this.center[1]+
this.halfHeight},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.serialize=function(a){a.writeF32(this.center[0]);a.writeF32(this.center[1]);a.push(this.width);a.push(this.height);return a};a.prototype.findCollisionDelta=function(a){return m.log2(Math.min((a.halfWidth+this.halfWidth)/Math.abs(a.centerT[0]-this.centerT[0]),(a.halfHeight+this.halfHeight)/Math.abs(a.centerT[1]-this.centerT[1])))};a.prototype.extend=function(a){var d=
Math.min(this.blX,a.blX),h=Math.min(this.blY,a.blY),f=Math.max(this.trY,a.trY);this.width=Math.max(this.trX,a.trX)-d;this.height=f-h;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=d+this.halfWidth;this.y=h+this.halfHeight};a.deserialize=function(d){var g=d.readF32(),h=d.readF32(),f=d.readInt32();d=d.readInt32();return new a(g,h,f,d)};return a}();a.default=n})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});a.serializeList=function(a,k){if(null===k)a.push(0);else{a.push(k.length);for(var h=0;h<k.length;h++)k[h].serialize(a);return a}};a.deserializeList=function(a,k,h){for(var d=a.readInt32(),d=Array(d),g=0;g<d.length;g++)d[g]=k.deserialize(a,h);return d}})},"esri/views/2d/engine/webgl/mesh/templates/GlyphGroup":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../definitions ../../materialKey/MaterialKey ./ComputedGlyph ./util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});var e=k.getLogger("esri.views.2d.engine.webgl.GlyphGroup");n=function(){function a(a,b,c,d,e,f,g,h,l,k){void 0===c&&(c=0);void 0===d&&(d=-1);void 0===e&&(e=-1);void 0===f&&(f=-1);void 0===g&&(g=-1);void 0===h&&(h=-1);void 0===l&&(l=0);void 0===k&&(k=-1);this.x=a;this.y=b;this.t=c;this.i=d;this.j=e;this.segmentPosX=f;this.segmentPosY=g;this.segmentLen=h;this.pathLen=l;this.order=k;this._glyphs=new Map;this.minZoom=0}Object.defineProperty(a.prototype,
"glyphs",{get:function(){return this._glyphs},enumerable:!0,configurable:!0});a.prototype.add=function(a,b){var c=this._glyphs.get(b);c?c.push(a):this._glyphs.set(b,[a])};a.prototype.clear=function(){this._glyphs.clear()};a.prototype.place=function(a,b,d,g,h,l,k,p,n,A,E){var q=a.x,r=a.y,u=a.codePoint,w=a.glyphMosaicItem;h=f.MaterialKeyBase.load(h);h.textureBinding=a.glyphMosaicItem.textureBinding;switch(b){case "esriGeometryPoint":case "esriGeometryPolygon":a=c.default.from(q,r,this.x,this.y,-1,A,
E,w,u,h.data,g,l,k);this.add(a,0);break;case "esriGeometryPolyline":b=d.geometry;this._placeGlyphAlongLine(a,h.data,b,g,p,l,k,n,A,E,-1);this._placeGlyphAlongLine(a,h.data,b,g,p,l,k,n,A,E,1);break;case "esriGeometryMultipoint":case "esriGeometryEnvelope":a=void 0,void 0===a&&(a="mapview-labeling"),e.error(new m(a,"Cannot place for unsupported geometryType: "+b))}};a.prototype._findLabelTheta=function(a,b,c,d){b*=d;a=Math.acos((0*b+-1*d*-a)/(1*c));0<b&&(a=2*Math.PI-a);return a};a.prototype._placeGlyphAlongLine=
function(a,e,f,k,m,p,n,x,z,A,E){f=f.paths[this.i];var q=f[this.j],r=q[0],u=q[1],q=a.x,w=a.y,v=a.glyphMosaicItem,t=a.codePoint,y=a.glyphMosaicItem.metrics,y=(a.x+y.left+y.width/2)*p/24;a=E*h.sign(y)||1;var y=Math.abs(y),J=b.len(r,u),M=this._findLabelTheta(r,u,J,E),L=(a+1)/2,J=-a*(-1*L+this.t)*J,R=d.mat2d.rotate(g.mat2df32.create(),k,-M),O=48<m.height;m=0===J?A:Math.max(Math.max(x+h.log2(Math.abs(y/J)),0),z);O&&(m=z);A=c.default.from(q,w,this.x,this.y,M,m,A,v,t,e,R,p,n,O||m<=x&&A>=x&&1===E);this.add(A,
this.j);if(!O)for(A=this.segmentPosX+L*r,r=this.segmentPosY+L*u,R=m,u=this.j+a;0<u&&u<f.length;u+=a){var T=A,U=r,L=f[u];m=L[0];var L=L[1],P=b.len(m,L),O=this._findLabelTheta(m,L,P,E),O=d.mat2d.rotate(g.mat2df32.create(),k,-O),T=T+-a*m/P*J,U=U+-a*L/P*J,J=J+P,P=R-.1,R=0===J?P:Math.max(Math.max(x+h.log2(Math.abs(y/J)),0),z),O=c.default.from(q,w,T,U,M,R,P,v,t,e,O,p,n,R<=x&&P>=x&&1===E);this.add(O,u);if(R<x-l.COLLISION_MAX_ZOOM_DELTA){this.minZoom=Math.max(R,this.minZoom);break}A+=a*m;r+=a*L}};return a}();
a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/ComputedGlyph":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../number ../../collisions/BoundingBox".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=k.vec2f32.create();n=function(){function a(a,b,d,f,g,h,l,k,m,n,t,x,z,A,E){this.anchorX=a;this.anchorY=b;this.angle=d;this.bounds=f;this.minZoom=g;this.maxZoom=
h;this.materialKey=l;this.vertexOffsetUpperLeft=k;this.vertexOffsetUpperRight=m;this.vertexOffsetLowerLeft=n;this.vertexOffsetLowerRight=t;this.texFontSizeUpperLeft=x;this.texFontSizeUpperRight=z;this.texFontSizeLowerLeft=A;this.texFontSizeLowerRight=E}a.from=function(c,b,e,f,k,n,w,u,v,y,t,x,z,A,E){void 0===A&&(A=!1);void 0===E&&(E=!1);var p=u.rect,q=u.metrics;k=-1===k?255:Math.floor(180*k/Math.PI/360*254);var r=Math.round(p.x/4),K=Math.round(p.y/4);u=r+Math.round(p.width/4);var H=K+Math.round(p.height/
4),N=-24-q.top,I=q.left,J=-q.top,M=p.width,p=p.height;v||(E||(N=0),I=4,M=q.width);c+=I;v=E?b+J:b+N;M=c+M;N=v;b=c;J=v+p;p=M;E=J;var I=b+q.width,L=J-q.height,R=q.width*x/24,q=q.height*x/24;t&&(m.vec2.transformMat2d(l,m.vec2.set(l,c,v),t),c=l[0],v=l[1],m.vec2.transformMat2d(l,m.vec2.set(l,M,N),t),M=l[0],N=l[1],m.vec2.transformMat2d(l,m.vec2.set(l,b,J),t),b=l[0],J=l[1],m.vec2.transformMat2d(l,m.vec2.set(l,p,E),t),p=l[0],E=l[1],m.vec2.transformMat2d(l,m.vec2.set(l,I,L),t),I=l[0],L=l[1]);t=A?new g.default(I,
L,R+h.COLLISION_BOX_PADDING,q+h.COLLISION_BOX_PADDING):null;A=d.i1616to32(8*c,8*v);q=d.i1616to32(8*M,8*N);c=d.i1616to32(8*b,8*J);b=d.i1616to32(8*p,8*E);p=d.i8888to32(r,K,x,z);K=d.i8888to32(u,K,x,z);r=d.i8888to32(r,H,x,z);x=d.i8888to32(u,H,x,z);return new a(e|0,f|0,k,t,n,w,y,A,q,c,b,p,K,r,x)};return a}();a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(n,a){function m(a,h){return Math.sqrt(a*a+h*h)}Object.defineProperty(a,"__esModule",
{value:!0});a.sub=function(a,h,d){a[0]=h[0]-d[0];a[1]=h[1]-d[1];return a};a.len=m;a.normalize=function(a){var h=m(a[0],a[1]);a[0]/=h;a[1]/=h};a.dist=function(a,h){return m(a[0]-h[0],a[1]-h[1])};a.isFunction=function(a){return"function"===typeof a};a.getLimitCosine=function(a){return 1/Math.max(a,1)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./WGLBaseTextTemplate ./WGLMeshTemplate ../../util/BidiText".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,c,d,e,f,m,p,n,z,A,E,B,G,F){e=a.call(this)||this;e._xOffset=k.pt2px(B);e._yOffset=k.pt2px(G);e._decorationTop=g.getFontDecorationTop(z);e._color=f;e._haloColor=m;e._haloSize=Math.min(Math.floor(5*k.pt2px(k.toPt(d))),127);e._size=Math.min(Math.round(k.pt2px(c)),127);c=Math.min(Math.round(k.pt2px(c)),127);e._referenceSize=Math.round(Math.sqrt(256*c));e._scale=e._size/24;e._angle=E;e._justify=h.getJustification(p||
"center");e._xAlignD=h.getXAnchorDirection(p||"center");e._yAlignD=-h.getYAnchorDirection(n||"baseline");e._baseline="baseline"===(n||"baseline");e._bitset=A?1:0;b=l.MaterialKeyBase.load(l.createMaterialKey(e.geometryType,b,!1));b.sdf=!0;e._materialKey=b.data;e.symbolId=F;return e}m(c,a);c.fromText=function(a,e,f){a=new c(a,e.font.size,e.haloSize||0,e.font.size,e.color&&d.premultiplyAlphaRGBA(e.color)||0,e.haloColor&&d.premultiplyAlphaRGBA(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,
e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.id);e=b.bidiText(e.text);a.bindTextInfo(f,e[0],e[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};c.fromCIMText=function(a,e,f){a=new c(a,e.size*e.sizeRatio,e.outlineSize*e.sizeRatio,e.referenceSize*e.sizeRatio,d.premultiplyAlphaRGBA(e.color),d.premultiplyAlphaRGBA(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio,e.offsetY*e.sizeRatio,e.materialHash);e=b.bidiText(e.text);
a.bindTextInfo(f,e[0],e[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};return c}(f.default(c.default));a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../enums ../../number ../../TextShapingNew ../../WGLDisplayRecord ../../collisions/BoundingBox ../../materialKey/MaterialKey ./ComputedGlyph".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u){Object.defineProperty(a,"__esModule",{value:!0});var v=h.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),y=Math.PI/180,t=g.mat2df32.create(),x=f.vec2f32.create();a.default=function(a){return function(a){function g(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c=a.apply(this,c)||this;c.geometryType=b.WGLGeometryType.TEXT;return c}m(g,a);g.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);
isNaN(this._decorationTop)||p.TextShaping.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=p.TextShaping.getBox(a)};g.prototype.writeMesh=function(a,b,c,d,f){var g=this._computedGlyphs;if(g){var h=w.TextMaterialKey.load(this._materialKey),l=e.i8888to32(0,0,this._referenceSize,this._bitset);switch(c){case "esriGeometryPoint":f=f.geometry;c=f.x;f=f.y;for(var m=0;m<g.length;m++){var p=g[m];p.anchorX=c;p.anchorY=f}this._writeVertices(a,b,d,g,h,l,0,0);break;case "esriGeometryPolygon":if(f.centroid){f=
f.centroid;c=f.x;f=f.y;for(m=0;m<g.length;m++)p=g[m],p.anchorX=c,p.anchorY=f;this._writeVertices(a,b,d,g,h,l,0,0);break}case "esriGeometryMultipoint":for(var m=f.geometry.points,n=f=c=0;n<m.length;n++){p=m[n];c+=p[0];f+=p[1];for(var q=0,r=g;q<r.length;q++)p=r[q],p.anchorX=c,p.anchorY=f;this._writeVertices(a,b,d,g,h,l,0,0)}break;default:a=void 0,void 0===a&&(a="mapview-processing"),v.error(new k(a,"Unable to handle geometryType: "+c))}}};g.prototype._computeGlyphs=function(a,b){if(a&&0!==a.length){var c=
Array(a.length);b=this._computeGlyphTransform(b);for(var d=w.MaterialKeyBase.load(this._materialKey),e=0;e<a.length;e++){var f=a[e],g=f.x,h=f.y,l=f.codePoint,f=f.glyphMosaicItem;d.textureBinding=f.textureBinding;c[e]=u.default.from(g,h,0,0,-1,0,25,f,l,d.data,b,this._size,this._haloSize,!1,!0)}this._computedGlyphs=c}};g.prototype._createBounds=function(a,b){var d=a.width/2,e=a.height/2,g=b[4],h=b[5],k;if(this._angle){a=f.vec2f32.fromValues(-d,-e);k=f.vec2f32.fromValues(d,-e);var m=f.vec2f32.fromValues(-d,
e),p=f.vec2f32.fromValues(d,e);l.vec2.transformMat2d(a,a,b);l.vec2.transformMat2d(k,k,b);l.vec2.transformMat2d(m,m,b);l.vec2.transformMat2d(p,p,b);b=e=Infinity;var n=0,q=d=0;for(a=[a,k,m,p];q<a.length;q++)k=a[q],e=Math.min(k[0],e),n=Math.max(k[0],n),b=Math.min(k[1],b),d=Math.max(k[1],d);k=n-e;a=d-b}else k=a.width*this._scale,a=a.height*this._scale;return new r.default(g,h,k+c.COLLISION_BOX_PADDING,a+c.COLLISION_BOX_PADDING)};g.prototype._computeShaping=function(a,b){return new p.TextShaping([a],512,
c.TEXT_LINE_HEIGHT,c.TEXT_SPACING,[0,.5*-c.TEXT_LINE_HEIGHT],.5*(1-this._xAlignD),0,b)};g.prototype._computeGlyphTransform=function(a){var b=this._scale,c=this._angle*y,e=d.mat2d.identity(t);d.mat2d.rotate(e,e,c);d.mat2d.translate(e,e,l.vec2.set(x,this._xOffset,-this._yOffset));d.mat2d.scale(e,e,l.vec2.set(x,b,b));d.mat2d.translate(e,e,l.vec2.set(x,-4,-4-(this._baseline?25:a.y+(1-this._yAlignD)*a.height*.5)));return e};g.prototype._writeVertices=function(a,b,c,d,e,f,g,h){this._writeHalos(a,b,c,d,
e,f,g,h);this._writeText(a,b,c,d,e,f,g,h)};g.prototype._writeHalos=function(a,b,c,d,f,g,h,l){f=b.indexVector;var k=b.getVector("geometry").vertexCount,m=0;if(this._haloSize)for(var p=0;p<d.length;p++,m+=4){var n=d[p],r=e.i1616to32(2*n.anchorX+1,2*n.anchorY),u=null==h?Math.floor(10*n.minZoom):h,w=null==l?Math.floor(10*n.maxZoom):l,t=new q(c,this.geometryType,n.materialKey,u,w);t.vertexFrom=k+m;t.indexFrom=f.length;this._writeVertex(t,b,c,r,this._haloColor,n,g,u,w);this._writeIndices(t,f,k+m);a.push(t)}};
g.prototype._writeText=function(a,b,c,d,f,g,h,l){f=b.indexVector;for(var k=b.getVector("geometry").vertexCount,m=0,p=0;p<d.length;p++,m+=4){var n=d[p],r=e.i1616to32(2*n.anchorX,2*n.anchorY),u=null==h?Math.floor(10*n.minZoom):h,w=null==l?Math.floor(10*n.maxZoom):l,t=new q(c,this.geometryType,n.materialKey,u,w);t.vertexFrom=k+m;t.indexFrom=f.length;this._writeVertex(t,b,c,r,this._color,n,g,u,w);this._writeIndices(t,f,k+m);a.push(t)}};g.prototype._writeVertex=function(a,b,c,d,e,f,g,h,l){b=b.get("geometry");
b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperLeft);b.push(f.texFontSizeUpperLeft);b.push(g);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetUpperRight);b.push(f.texFontSizeUpperRight);b.push(g);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerLeft);b.push(f.texFontSizeLowerLeft);b.push(g);b.push(d);b.push(c);b.push(e);b.push(f.vertexOffsetLowerRight);b.push(f.texFontSizeLowerRight);b.push(g);a.vertexCount+=4};g.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+
2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return g}(a)}})},"esri/views/2d/engine/webgl/TextShapingNew":function(){define(["require","exports","./Rect"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d,g,l,f,c,b,e){this._glyphItems=a;this._maxWidth=d;this._lineHeight=g;this._letterSpacing=l;this._offset=f;this._hAnchor=c;this._vAnchor=b;this._justify=e}a.prototype.getShaping=function(a,d){for(var g=this._letterSpacing,h=this._lineHeight,f=this._justify,
c=this._maxWidth,b=[],e=0,k=0,m=0,n=0,w=-1,u=0,v=-1,y=a.length,t=0;t<y;t++){var x=a.charCodeAt(t);if(10===x){if(t!==y-1){if(w>=n){var e=b[w],z=e.x+e.glyphMosaicItem.metrics.advance,u=Math.max(z,u);f&&this._applyJustification(b,n,w);n=b.length}k=d?k-h:k+h;e=0;++m}}else{for(var z=void 0,A=0,E=this._glyphItems;A<E.length&&!(z=E[A][x]);A++);if(z){b.push({codePoint:x,x:e,y:k,glyphMosaicItem:z});e+=z.metrics.advance+g;if(0<c&&e>c&&0<=v){A=v+1;z=b[A].x;u=Math.max(z,u);for(E=A;E<b.length;E++)b[E].y=d?b[E].y-
h:b[E].y+h,b[E].x-=z;f&&this._applyJustification(b,n,v);k=d?k-h:k+h;e-=z;++m;n=A;v=-1}++w;32===x&&(v=b.length-1)}}}w>=n&&(e=b[w],u=Math.max(u,e.x+e.glyphMosaicItem.metrics.advance),f&&this._applyJustification(b,n,w));if(0<b.length)for(a=(f-this._hAnchor)*u,g=(-this._vAnchor*(m+1)+.5)*h,d&&m&&(g+=m*h),a+=this._offset[0],g+=this._offset[1],d=0;d<b.length;d++)h=b[d],h.x+=a,h.y+=g;return b};a.prototype.getEstimatedShaping=function(a,d,g){for(var h=this._letterSpacing,f=this._lineHeight,c=this._justify,
b=this._maxWidth,e=[],k=0,m=0,n=0,w=0,u=-1,v=0,y=-1,t=a.length,x=0;x<t;x++){var z=a.charCodeAt(x);if(10===z){if(x!==t-1){if(u>=w){var k=e[u],A=k.x+k.glyphMosaicItem.metrics.advance,v=Math.max(A,v);c&&this._applyJustification(e,w,u);w=e.length}m=d?m-f:m+f;k=0;++n}}else{A=g;e.push({codePoint:z,x:k,y:m,glyphMosaicItem:A});k+=A.metrics.advance+h;if(0<b&&k>b&&0<=y){for(var E=y+1,A=e[E].x,v=Math.max(A,v),B=E;B<e.length;B++)e[B].y=d?e[B].y-f:e[B].y+f,e[B].x-=A;c&&this._applyJustification(e,w,y);m=d?m-f:
m+f;k-=A;++n;w=E;y=-1}++u;32===z&&(y=e.length-1)}}u>=w&&(k=e[u],v=Math.max(v,k.x+k.glyphMosaicItem.metrics.advance),c&&this._applyJustification(e,w,u));if(0<e.length)for(a=(c-this._hAnchor)*v,g=(-this._vAnchor*(n+1)+.5)*f,d&&n&&(g+=n*f),a+=this._offset[0],g+=this._offset[1],d=0;d<e.length;d++)f=e[d],f.x+=a,f.y+=g;return e};a.getBox=function(a){if(!a.length)return null;for(var d=Infinity,g=Infinity,h=-Infinity,f=-Infinity,c=0;c<a.length;c++)var b=a[c],e=b.glyphMosaicItem.metrics,k=b.x+e.left,b=b.y-
e.top,m=k+e.width,e=b+e.height,d=Math.min(d,k),h=Math.max(h,m),g=Math.min(g,b),f=Math.max(f,e);return{x:d,y:g,width:h-d,height:f-g}};a.addDecoration=function(a,d){var g=a.length;if(0!==g){for(var h=a[0].x+a[0].glyphMosaicItem.metrics.left,f=a[0].y,c=1;c<g;c++){var b=a[c];if(b.y!==f){var e=a[c-1].x+a[c-1].glyphMosaicItem.metrics.left+a[c-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:h,y:f,glyphMosaicItem:{sdf:!0,rect:new m.default(4,0,4,8),metrics:{width:e-h,height:2,left:0,top:d,advance:0},
page:0}});f=b.y;h=b.x+b.glyphMosaicItem.metrics.left}}g=a[g-1].x+a[g-1].glyphMosaicItem.metrics.left+a[g-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:h,y:f,glyphMosaicItem:{sdf:!0,rect:new m.default(4,0,4,8),metrics:{width:g-h,height:2,left:0,top:d,advance:0},page:0}})}};a.prototype._applyJustification=function(a,d,g){for(var h=a[g],h=(h.x+h.glyphMosaicItem.metrics.advance)*this._justify;d<=g;d++)a[d].x-=h};return a}();a.TextShaping=n})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require",
"exports","./MeshData","./Utils"],function(n,a,m,k){return function(){function a(a,g,h,f,c){void 0===f&&(f=0);void 0===c&&(c=0);this.id=a;this.geometryType=g;this.materialKey=h;this.minZoom=f;this.maxZoom=c;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(a.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});a.prototype.clone=function(){return this.copy()};
a.prototype.copy=function(){var d=new a(this.id,this.geometryType,this.materialKey);d.vertexFrom=this.vertexFrom;d.vertexCount=this.vertexCount;d.indexFrom=this.indexFrom;d.indexCount=this.indexCount;d.zOrder=this.zOrder;d.symbolLevel=this.symbolLevel;d.meshData=this.meshData;d.minZoom=this.minZoom;d.maxZoom=this.maxZoom;return d};a.prototype.setMeshDataFromBuffers=function(a,g,h){var d=new m,c;for(c in g){for(var b=g[c].stride,e=g[c].data,l=[],n=k.strideToPackingFactor(b),r=0;r<b*a.vertexCount/n;++r)l[r]=
e[r+b*a.vertexFrom/n];d.vertexData.set(c,l)}for(r=d.indexData.length=0;r<a.indexCount;++r)d.indexData[r]=h[r+a.indexFrom]-a.vertexFrom;d.vertexCount=a.vertexCount;this.meshData=d};a.prototype.readMeshDataFromBuffers=function(a,g){this.meshData?this.meshData.clear():this.meshData=new m;for(var d in a){for(var f=a[d].stride,c=a[d].data,b=[],e=k.strideToPackingFactor(f),h=0;h<f*this.vertexCount/e;++h)b[h]=c[h+f*this.vertexFrom/e];this.meshData.vertexData.set(d,b)}for(h=this.meshData.indexData.length=
0;h<this.indexCount;++h)this.meshData.indexData[h]=g[h+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};a.prototype.writeMeshDataToBuffers=function(a,g,h,f){for(var c in g)for(var b=g[c].stride,d=this.meshData.vertexData.get(c),l=g[c].data,m=k.strideToPackingFactor(b),n=0;n<b*this.meshData.vertexCount/m;++n)l[n+b*a/m]=d[n];for(n=0;n<this.meshData.indexData.length;++n)f[n+h]=this.meshData.indexData[n]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=
h;this.indexCount=this.meshData.indexData.length};a.writeAllMeshDataToBuffers=function(a,g,h){for(var d=0,c=0,b=0;b<a.length;b++){var e=a[b];e.writeMeshDataToBuffers(d,g,c,h);d+=e.vertexCount;c+=e.indexCount}};a.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};a.prototype.serialize=function(a){a.push(this.geometryType);a.push(this.materialKey);a.push(this.symbolLevel);a.push(this.zOrder);a.push(this.vertexFrom);a.push(this.vertexCount);
a.push(this.indexFrom);a.push(this.indexCount);a.push(this.minZoom);a.push(this.maxZoom);return a};a.deserialize=function(d,g){var h=d.readInt32(),f=d.readInt32();g=new a(g.id,h,f);g.symbolLevel=d.readInt32();g.zOrder=d.readInt32();g.vertexFrom=d.readInt32();g.vertexCount=d.readInt32();g.indexFrom=d.readInt32();g.indexCount=d.readInt32();g.minZoom=d.readInt32();g.maxZoom=d.readInt32();return g};return a}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(n,
a){return function(){function a(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}a.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};a.prototype.update=function(a,h,d){for(var g in a)this.vertexData.set(g,a[g]);for(g in this.vertexData)null===a[g]&&this.vertexData.delete(g);this.vertexCount=h;this.indexData=d};return a}()})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){}a.prototype.writeMesh=function(a,d,g,l,f){};a.prototype.bindFeature=function(a,d,g){};return a}();a.default=n})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require","exports","dojox/string/BidiEngine"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});var k=new m;a.bidiText=function(a){if(!k.hasBidiChar(a))return[a,!1];var d;d="rtl"===k.checkContextual(a)?"IDNNN":"ICNNN";
return[k.bidiTransform(a,d,"VLYSN"),!0]}})},"dojox/string/BidiEngine":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Stateful"],function(n,a,m){function k(a,b,c,e,f){var g=a;void 0===b&&(b=f.defInFormat);void 0===c&&(c=f.defOutFormat);void 0===e&&(e=f.defSwap);if(b!==c){var m,p=b.substring(0,1);m=b.substring(1,4);var n=c.substring(0,1),q=c.substring(1,4);"C"===m.charAt(0)&&(m=h(g),m="ltr"===m||"rtl"===m?m.toUpperCase():"L"===b.charAt(2)?"LTR":"RTL",b=p+m);"C"===q.charAt(0)&&(m=h(g),
"rtl"===m?q="RTL":"ltr"===m?(g=g.split(""),g.reverse(),m=h(g.join("")),q=m.toUpperCase()):q="L"===c.charAt(2)?"LTR":"RTL",c=n+q)}if(b===c)return a;n=b.substring(0,1);g=b.substring(1,4);p=c.substring(0,1);q=c.substring(1,4);f.inFormat=b;f.outFormat=c;f.swap=e;if("L"===n&&"VLTR"===c){if("LTR"===g)return f.dir=E,d(a,f);if("RTL"===g)return f.dir=B,d(a,f)}if("V"===n&&"V"===p)return f.dir="RTL"===g?B:E,l(a,f);if("L"===n&&"VRTL"===c)return f.dir="LTR"===g?E:B,a=d(a,f),l(a);if("VLTR"===b&&"LLTR"===c)return f.dir=
E,d(a,f);if("V"===n&&"L"===p&&g!==q)return a=l(a),"RTL"===g?k(a,"LLTR","VLTR",e,f):k(a,"LRTL","VRTL",e,f);if("VRTL"===b&&"LRTL"===c)return k(a,"LRTL","VRTL",e,f);if("L"===n&&"L"===p)return b=f.swap,f.swap=b.substr(0,1)+"N","RTL"===g?(f.dir=B,a=d(a,f),f.swap="N"+b.substr(1,2),f.dir=E,a=d(a,f)):(f.dir=E,a=d(a,f),f.swap="N"+b.substr(1,2),a=k(a,"VLTR","LRTL",f.swap,f)),a}function h(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?"z">=a[0]?"ltr":"rtl":""}
function d(a,c){a=a.split("");var d=[];g(a,d,c);if(0!==c.hiLevel&&c.swap.substr(0,1)!==c.swap.substr(1,2))for(var e=0;e<a.length;e++)if(1===d[e]){var f=e,h;b:{h=a[e];for(var l=void 0,k=0,m=K.length-1;k<=m;)if(l=Math.floor((k+m)/2),h<K[l][0])m=l-1;else if(h>K[l][0])k=l+1;else{h=K[l][1];break b}}a[f]=h}b(2,a,d,c);b(1,a,d,c);t=d;return a.join("")}function g(a,b,c){var d=a.length,f=c.dir?Q:W,g=null,h=null,l=null,g=0,h=h=null,k=-1,m=h=null,p=[],n=[];c.hiLevel=c.dir;c.lastArabic=!1;c.hasUbatAl=!1;c.hasUbatB=
!1;c.hasUbatS=!1;for(h=0;h<d;h++){var m=h,l=a[h].charCodeAt(0),q=Ca[l>>8];p[m]=q<va?q:Ea[q-va][l&255]}for(m=0;m<d;m++){n[m]=h=e(a,p,n,m,c);g=f[g][h];h=g&240;g&=15;b[m]=l=f[g][z];if(0<h){if(16===h)for(h=k;h<m;h++)b[h]=1;k=-1}if(h=f[g][A])-1===k&&(k=m);else if(-1<k){for(h=k;h<m;h++)b[h]=l;k=-1}p[m]===ca&&(b[m]=0);c.hiLevel|=l}if(c.hasUbatS)for(a=0;a<d;a++)if(p[a]===ia)for(b[a]=c.dir,f=a-1;0<=f;f--)if(p[f]===oa)b[f]=c.dir;else break}function l(a,b){a=a.split("");if(b){var c=[];g(a,c,b);t=c}a.reverse();
v.reverse();return a.join("")}function f(a){for(var b=0;b<P.length;b++)if(a>=P[b]&&a<=V[b])return!0;return!1}function c(a,b,c,d){for(;b*c<d&&q(a[b]);)b+=c;return b*c<d&&f(a[b])?!0:!1}function b(a,b,c,d){if(!(d.hiLevel<a))if(1!==a||d.dir!==B||d.hasUbatB){d=b.length;for(var e=0,f,g,h;e<d;){if(c[e]>=a){for(f=e+1;f<d&&c[f]>=a;)f++;for(g=f-1;e<g;e++,g--)h=b[e],b[e]=b[g],b[g]=h,h=v[e],v[e]=v[g],v[g]=h;e=f}e++}}else b.reverse(),v.reverse()}function e(a,b,c,d,e){return{UBAT_L:function(){e.lastArabic=!1;return Z},
UBAT_R:function(){e.lastArabic=!1;return X},UBAT_ON:function(){return ga},UBAT_AN:function(){return da},UBAT_EN:function(){return e.lastArabic?da:aa},UBAT_AL:function(){e.lastArabic=!0;e.hasUbatAl=!0;return X},UBAT_WS:function(){return ga},UBAT_CS:function(){var a,f;if(1>d||d+1>=b.length||(a=c[d-1])!==aa&&a!==da||(f=b[d+1])!==aa&&f!==da)return ga;e.lastArabic&&(f=da);return f===a?f:ga},UBAT_ES:function(){return(0<d?c[d-1]:ca)===aa&&d+1<b.length&&b[d+1]===aa?aa:ga},UBAT_ET:function(){if(0<d&&c[d-1]===
aa)return aa;if(e.lastArabic)return ga;for(var a=d+1,f=b.length;a<f&&b[a]===ha;)a++;return a<f&&b[a]===aa?aa:ga},UBAT_NSM:function(){if("VLTR"===e.inFormat){for(var f=b.length,g=d+1;g<f&&b[g]===la;)g++;if(g<f&&(f=a[d],g=b[g],(1425<=f&&2303>=f||64286===f)&&(g===X||g===ba)))return X}return 1>d||b[d-1]===ca?ga:c[d-1]},UBAT_B:function(){e.lastArabic=!0;e.hasUbatB=!0;return e.dir},UBAT_S:function(){e.hasUbatS=!0;return ga},UBAT_LRE:function(){e.lastArabic=!1;return ga},UBAT_RLE:function(){e.lastArabic=
!1;return ga},UBAT_LRO:function(){e.lastArabic=!1;return ga},UBAT_RLO:function(){e.lastArabic=!1;return ga},UBAT_PDF:function(){e.lastArabic=!1;return ga},UBAT_BN:function(){return ga}}[ra[b[d]]]()}function p(a,b){for(var c=0;c<J.length;c++)if(a===J[c])return b[c];return a}function q(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function r(a){if("L"===a)return"LTR";if("R"===a)return"RTL";if("C"===a)return"CLR";if("D"===a)return"CRL"}function w(a,b){for(var c=0;c<H.length;c++)if(a===H[c])return b[c];return a}
function u(a,b,c,d){for(var e=0;e<a.length;e++)if(a[e]>b||!c&&a[e]===b)a[e]+=d}n.getObject("string",!0,dojox);n=a("dojox.string.BidiEngine",m,{inputFormat:"ILYNN",outputFormat:"VLNNN",sourceToTarget:[],targetToSource:[],levels:[],bidiTransform:function(a,b,d){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var e=this.sourceToTarget,g=this.targetToSource,h=a.length;v=[];t=[];for(var l=0;l<h;l++)e[l]=l,g[l]=l,v[l]=l;if(!this.checkParameters(b,d))return a;b=this.inputFormat;d=this.outputFormat;
var e=a,e=x,l=r(b.charAt(1)),g=r(d.charAt(1)),m="I"===b.charAt(0)?"L":b.charAt(0),h="I"===d.charAt(0)?"L":d.charAt(0),l=m+l,g=h+g,h=b.charAt(2)+d.charAt(2);e.defInFormat=l;e.defOutFormat=g;e.defSwap=h;a=k(a,l,g,h,e);e=!1;if("R"===d.charAt(1))e=!0;else if("C"===d.charAt(1)||"D"===d.charAt(1))e=this.checkContextual(a);g=this.sourceToTarget=v;h=Array(g.length);for(l=0;l<g.length;l++)h[g[l]]=l;y=this.targetToSource=h;if(b.charAt(3)===d.charAt(3))e=a;else if("S"===d.charAt(3))if(b=e,d=!0,0===a.length)e=
void 0;else{void 0===b&&(b=!0);void 0===d&&(d=!0);a=String(a);a=a.split("");var n=0,g=1,e=a.length;b||(n=a.length-1,g=-1,e=1);for(var h=e,l=d,z=0,e=[],m=0;n*g<h;n+=g)if(f(a[n])||q(a[n])){var A;if(A="\u0644"===a[n])b:{for(var B=a,E=n+g,G=g,F=h;E*G<F&&q(B[E]);)E+=G;A=" ";if(E*G<F)for(A=B[E],B=0;B<H.length;B++)if(H[B]===A){A=!0;break b}A=!1}if(A){a[n]=0===z?w(a[n+g],N):w(a[n+g],I);n+=g;z=a;A=n;B=g;for(E=h;A*B<E&&q(z[A]);)A+=B;A*B<E&&(z[A]=" ");l&&(e[m]=n,m++);z=0}else{A=a[n];if(1===z){B=n;if(c(a,n+g,
g,h))b:for(E=a[n],G=0;G<J.length;G++){if(E===J[G]){E=R[G];break b}}else E=p(a[n],L);a[B]=E}else!0===c(a,n+g,g,h)?a[n]=p(a[n],O):a[n]=p(a[n],M);q(A)||(z=1);b:{for(B=0;B<T.length;B++)if(T[B]===A){A=!0;break b}A=!1}!0===A&&(z=0)}}else z=0;g="";for(h=0;h<a.length;h++){if(l=d){b:{for(l=0;l<e.length;l++)if(e[l]===h)break b;l=-1}l=-1<l}l?(u(y,h,!b,-1),v.splice(h,1)):g+=a[h]}e=g}else if(b=a,d=e,a=!0,0===b.length)e=void 0;else for(void 0===a&&(a=!0),void 0===d&&(d=!0),b=String(b),e="",g=[],g=b.split(""),h=
0;h<b.length;h++)l=!1,"\ufe70"<=g[h]&&"\ufeff">g[h]?(m=b.charCodeAt(h),"\ufef5"<=g[h]&&"\ufefc">=g[h]?(d?(0<h&&a&&" "===g[h-1]?e=e.substring(0,e.length-1)+"\u0644":(e+="\u0644",l=!0),e+=H[(m-65269)/2]):(e+=H[(m-65269)/2],e+="\u0644",h+1<b.length&&a&&" "===g[h+1]?h++:l=!0),l&&(u(y,h,!0,1),v.splice(h,0,v[h]))):e+=U[m-65136]):e+=g[h];this.sourceToTarget=v;this.targetToSource=y;this.levels=t;return e},_inputFormatSetter:function(a){if(!G.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.inputFormat=a},_outputFormatSetter:function(a){if(!G.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a},checkParameters:function(a,b){a?this.set("inputFormat",a):a=this.inputFormat;b?this.set("outputFormat",b):b=this.outputFormat;return a===b?!1:!0},checkContextual:function(a){a=h(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(Ha){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a},hasBidiChar:function(a){return F.test(a)}});var v=
[],y=[],t=[],x={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1},z=5,A=6,E=0,B=1,G=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,F=/[\u0591-\u06ff\ufb1d-\ufefc]/,K=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],
["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],H=["\u0622","\u0623","\u0625","\u0627"],N=["\ufef5","\ufef7","\ufef9","\ufefb"],I=["\ufef6","\ufef8","\ufefa","\ufefc"],J="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split(""),
M="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split(""),L="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split(""),
R="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split(""),O="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split(""),
T="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split(""),U="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split(""),
P=["\u0621","\u0641"],V=["\u063a","\u064a"],W=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],Q=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],Z=0,X=1,aa=2,da=3,ga=4,ca=5,ia=6,ba=7,oa=8,ha=11,la=12,ra="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" "),va=100;a=Z;m=X;var ja=aa,pa=da,C=ga,ua=ca,wa=ia,D=ba,qa=oa,na=
ha,S=la,Ca=[va+0,a,a,a,a,va+1,va+2,va+3,m,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,va+4,C,C,C,a,C,a,C,a,C,C,C,a,a,C,C,a,a,a,a,a,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,a,a,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,a,a,C,C,a,a,C,C,a,a,C,C,C,C,C,C,C,C,C,C,C,C,
C,C,C,C,C,C,C,C,C,C,C,a,a,a,va+5,D,D,va+6,va+7],Ea=[[18,18,18,18,18,18,18,18,18,wa,ua,wa,qa,ua,18,18,18,18,18,18,18,18,18,18,18,18,18,18,ua,ua,ua,wa,qa,C,C,na,na,na,C,C,C,C,C,10,9,10,9,9,ja,ja,ja,ja,ja,ja,ja,ja,ja,ja,9,C,C,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,C,18,18,18,18,18,18,ua,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,C,na,na,na,na,C,C,C,C,a,C,C,18,C,C,na,na,ja,ja,
C,a,C,C,C,ja,a,C,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,C,C,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,a,a,a,a,a,a,a,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,a,C,C,C,C,C,C,C,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,
S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,m,S,m,S,S,m,S,S,m,S,C,C,C,C,C,C,C,C,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,C,C,C,C,C,m,m,m,m,m,C,C,C,C,C,C,C,C,C,C,C],[pa,pa,pa,pa,C,C,C,C,D,na,na,D,9,D,C,C,S,S,S,S,S,S,S,S,S,S,S,D,C,C,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,pa,pa,pa,pa,pa,pa,pa,pa,pa,pa,na,pa,pa,D,D,D,S,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,
D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,S,S,S,S,S,S,S,pa,C,S,S,S,S,S,S,D,D,S,S,C,S,S,S,S,D,D,ja,ja,ja,ja,ja,ja,ja,ja,ja,ja,D,D,D,D,D,D],[D,D,D,D,D,D,D,D,D,D,D,D,D,D,C,D,D,S,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,C,C,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,
D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,S,S,S,S,S,S,S,S,S,S,S,D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,m,S,S,S,S,S,S,S,S,S,m,m,C,C,C,C,m,C,C,C,C,C],[qa,qa,qa,qa,qa,qa,qa,qa,qa,qa,qa,18,18,18,a,m,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,qa,ua,13,14,15,16,17,9,na,na,na,na,na,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,9,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,qa,18,18,18,18,18,C,C,C,C,C,18,18,18,18,18,18,ja,a,C,C,ja,ja,
ja,ja,ja,ja,10,10,C,C,C,a,ja,ja,ja,ja,ja,ja,ja,ja,ja,ja,10,10,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,na,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[a,a,a,a,a,a,a,C,C,C,C,C,C,C,C,C,C,C,C,a,a,a,a,a,C,C,C,C,C,m,S,m,m,m,m,m,m,m,m,m,m,10,m,m,m,m,m,m,m,m,m,m,m,m,m,C,m,m,m,m,m,C,m,C,m,m,C,m,m,C,m,m,m,m,m,m,m,m,m,m,D,D,D,D,D,D,D,D,D,
D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D],[S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,S,S,S,S,S,S,S,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,9,C,9,
C,C,9,C,C,C,C,C,C,C,C,C,na,C,C,10,10,C,C,C,C,C,na,na,C,C,C,C,C,D,D,D,D,D,C,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,D,C,C,18],[C,C,C,na,na,na,C,C,C,C,C,10,9,10,9,9,ja,ja,ja,ja,ja,ja,ja,ja,ja,ja,9,C,C,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,C,C,C,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,C,C,C,C,C,C,C,C,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,C,C,C,a,a,a,a,a,a,C,C,a,a,a,a,a,a,C,C,a,a,a,a,a,a,C,C,a,a,a,C,C,C,na,na,C,C,C,na,na,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]];return n})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require","exports","../enums","../visualVariablesUtils"],
function(n,a,m,k){function h(a,d){void 0===d&&(d=!1);var f=m.WGLVVFlag.SIZE_FIELD_STOPS|m.WGLVVFlag.SIZE_MINMAX_VALUE|m.WGLVVFlag.SIZE_SCALE_STOPS|m.WGLVVFlag.SIZE_UNIT_VALUE;a=(a&(m.WGLVVTarget.FIELD_TARGETS_OUTLINE|m.WGLVVTarget.MINMAX_TARGETS_OUTLINE|m.WGLVVTarget.SCALE_TARGETS_OUTLINE|m.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return d?f&a:f&~a}function d(a){var d=h(a,!1);return a&(m.WGLVVFlag.COLOR|m.WGLVVFlag.OPACITY|m.WGLVVFlag.ROTATION|d)}Object.defineProperty(a,"__esModule",{value:!0});a.getVVFlags=
function(a){if(!a)return m.WGLVVFlag.NONE;for(var d=0,f=0;f<a.length;f++){var c=a[f];if("size"===c.type){var b=k.getTypeOfSizeVisualVariable(c),d=d|b;"outline"===c.target&&(d|=b<<4)}else"color"===c.type?d|=m.WGLVVFlag.COLOR:"opacity"===c.type?d|=m.WGLVVFlag.OPACITY:"rotation"===c.type&&(d|=m.WGLVVFlag.ROTATION)}return d};a.getSizeFlagsMask=h;a.getMarkerVVFlags=d;a.getFillVVFlags=function(a){return a&(m.WGLVVFlag.COLOR|m.WGLVVFlag.OPACITY)};a.getLineVVFlags=function(a,d){if(d)return d=h(a,!0),a&d;
d=h(a,!1);return a&(m.WGLVVFlag.COLOR|m.WGLVVFlag.OPACITY|d)};a.getTextVVFlags=function(a){return d(a)};a.getLabelVVFlags=function(a){var d=h(a,!1);return a&d}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ./enums ./Utils".split(" "),function(n,a,m,k,h,d){Object.defineProperty(a,"__esModule",{value:!0});var g=k.getLogger("esri.views.2d.engine.webgl");a.getTypeOfSizeVisualVariable=function(a){if(d.isNumber(a.minDataValue)&&
d.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize)return h.WGLVVFlag.SIZE_MINMAX_VALUE;if((a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops))return h.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&Array.isArray(a.stops))return h.WGLVVFlag.SIZE_FIELD_STOPS;if((null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&
"$view.scale"!==a.valueExpression)&&null!=a.valueUnit)return h.WGLVVFlag.SIZE_UNIT_VALUE;g.error(new m("mapview-bad-type","Found invalid size VisualVariable",a));return h.WGLVVFlag.NONE}})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(){return null!==
a&&a.apply(this,arguments)||this}m(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return h.WGLGeometryType.LABEL};c.prototype.drawGeometry=function(a,c,f,g,h){var b=a.context,e=a.painter,k=a.state,m=a.rendererInfo,p=f.indexCount,n=f.indexFrom;f=l.LabelMaterialKey.load(f.materialKey);var q=f.mapAligned?1:0;if(q||!(1<=Math.abs(c.key.level-Math.round(100*a.displayLevel)/100))){var r=d.createProgramDescriptor(f.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},
{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:6,name:"a_zoomRangeAndEmpty",count:4,type:5121}]}),E=r.bufferLayouts,r=r.attributes;h=e.materialManager.getMaterialProgram(a,f,"materials/label",r,h);g=this._getVAO(b,E,r,g);a.context.setStencilFunction(514,0,255);b.bindProgram(h);
b.bindVAO(g);this._setSharedUniforms(h,a,c);e.textureManager.bindTextures(b,h,f,4);c=1===q?k.displayViewMat3:k.displayMat3;f.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",m.vvSizeMinMaxValue);f.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",m.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",m.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",m.vvSizeFieldStopsSizes));f.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",
m.vvSizeUnitValueToPixelsRatio);h.setUniform1f("u_mapRotation",Math.floor(k.rotation/360*254));h.setUniform1f("u_mapAligned",q);h.setUniformMatrix3fv("u_displayMat3",c);h.setUniform1f("u_opacity",1);h.setUniform1f("u_zoomLevel",Math.round(10*a.displayLevel));h.setUniform2fv("u_screenSize",a.state.size);b.drawElements(4,p,5125,4*n);b.bindVAO(null);b.setStencilTestEnabled(!0);b.setBlendingEnabled(!0)}};return c}(g.default);a.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}m(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return h.WGLGeometryType.LINE};c.prototype.drawGeometry=function(a,c,f,g,h){var b=a.context,e=a.painter,k=a.rendererInfo,m=a.requiredLevel,p=f.indexFrom,n=f.indexCount;f=l.LineMaterialKey.load(f.materialKey);var q=d.createProgramDescriptor(f.data,{geometry:[{location:0,name:"a_pos",
count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123},{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120},{location:7,name:"a_aux",count:2,type:5123}]}),r=q.bufferLayouts,q=q.attributes;h=e.materialManager.getMaterialProgram(a,f,"materials/line",q,h);g=this._getVAO(b,
r,q,g);r=1/a.pixelRatio;b.bindProgram(h);b.bindVAO(g);this._setSharedUniforms(h,a,c);f.textureBinding&&e.textureManager.bindTextures(b,h,f);h.setUniform1f("u_zoomFactor",Math.pow(2,m-c.key.level)/a.pixelRatio);h.setUniform1f("u_blur",0+r);h.setUniform1f("u_antialiasing",r);f.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue);f.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",
k.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes));f.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio);f.vvColor&&(h.setUniform1fv("u_vvColorValues",k.vvColorValues),h.setUniform4fv("u_vvColors",k.vvColors));f.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),h.setUniform1fv("u_vvOpacities",k.vvOpacities));b.setFaceCullingEnabled(!0);b.setFrontFace(2305);b.setCullFace(1029);b.drawElements(4,
n,5125,4*p);b.setFaceCullingEnabled(!1);b.bindVAO(null)};return c}(g.default);a.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(){return null!==a&&a.apply(this,
arguments)||this}m(b,a);b.prototype.dispose=function(){};b.prototype.getGeometryType=function(){return d.WGLGeometryType.MARKER};b.prototype.drawGeometry=function(a,b,c,d,h){var e=a.context,l=a.painter,k=a.rendererInfo,m=a.state,p=c.indexCount,n=c.indexFrom;c=f.MarkerMaterialKey.load(c.materialKey);var q=g.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_vertexOffset",count:2,type:5122},{location:2,name:"a_texCoords",count:2,type:5123},{location:3,
name:"a_bitSetAndDistRatio",count:4,type:5121},{location:4,name:"a_id",count:4,type:5121},{location:5,name:"a_color",count:4,type:5121,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:5121}]}),r=q.bufferLayouts,q=q.attributes;h=l.materialManager.getMaterialProgram(a,c,"materials/icon",q,h);d=this._getVAO(e,r,q,d);e.bindProgram(h);e.bindVAO(d);c.textureBinding&&l.textureManager.bindTextures(e,h,c,1);this._setSharedUniforms(h,
a,b);h.setUniformMatrix3fv("u_displayMat3",c.vvRotation?m.displayViewMat3:m.displayMat3);c.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue);c.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",k.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes));c.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio);
c.vvColor&&(h.setUniform1fv("u_vvColorValues",k.vvColorValues),h.setUniform4fv("u_vvColors",k.vvColors));c.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),h.setUniform1fv("u_vvOpacities",k.vvOpacities));c.vvRotation&&h.setUniform1f("u_vvRotationType","geographic"===k.vvMaterialParameters.vvRotationType?0:1);e.drawElements(4,p,5125,4*n);e.bindVAO(null)};return b}(l.default);a.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}m(c,a);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return h.WGLGeometryType.TEXT};c.prototype.drawGeometry=function(a,c,f,g,h){var b=a.context,e=a.painter,k=a.rendererInfo,m=a.state,p=f.indexCount,n=f.indexFrom;f=l.TextMaterialKey.load(f.materialKey);var q=d.createProgramDescriptor(f.data,{geometry:[{location:0,name:"a_pos",
count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texFontSize",count:4,type:5120},{location:5,name:"a_aux",count:4,type:5120}]}),r=q.bufferLayouts,q=q.attributes;h=e.materialManager.getMaterialProgram(a,f,"materials/text",q,h);g=this._getVAO(b,r,q,g);b.bindProgram(h);b.bindVAO(g);this._setSharedUniforms(h,a,c);e.textureManager.bindTextures(b,h,f,4);h.setUniformMatrix3fv("u_displayMat3",
m.displayMat3);f.vvSizeMinMaxValue&&h.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue);f.vvSizeScaleStops&&h.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue);f.vvSizeFieldStops&&(h.setUniform1fv("u_vvSizeFieldStopsValues",k.vvSizeFieldStopsValues),h.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes));f.vvSizeUnitValue&&h.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio);f.vvColor&&(h.setUniform1fv("u_vvColorValues",k.vvColorValues),
h.setUniform4fv("u_vvColors",k.vvColors));f.vvOpacity&&(h.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),h.setUniform1fv("u_vvOpacities",k.vvOpacities));f.vvRotation&&h.setUniform1f("u_vvRotationType","geographic"===k.vvMaterialParameters.vvRotationType?0:1);b.drawElements(4,p,5125,4*n);b.bindVAO(null)};return c}(g.default);a.default=n})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(n,a,m,k,h){Object.defineProperty(a,
"__esModule",{value:!0});var d=function(){return function(a,d,c){this.ratio=a;this.x=d;this.y=c}}();n=function(){function a(a,c,b,d,g){void 0===d&&(d=8);void 0===g&&(g=8);this.lines=[];this.starts=[];this.pixelRatio=d;this.pixelMargin=g;this.tileSize=m.TILE_SIZE*d;this.dz=a;this.yPos=c;this.xPos=b}a.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var c=this.pixelRatio*this.pixelMargin,c=c/this.finalRatio;a>>=this.dz;c>a&&(c=a);this.margin=c;this.xmin=a*this.xPos-c;this.ymin=
a*this.yPos-c;this.xmax=this.xmin+a+2*c;this.ymax=this.ymin+a+2*c};a.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};a.prototype.moveTo=function(a,c){this._pushLine();this._prevIsIn=this._isIn(a,c);this._moveTo(a,c,this._prevIsIn);this._prevPt=new k.Point(a,c);this._firstPt=new k.Point(a,c);this._dist=0};a.prototype.lineTo=function(a,c){var b=this._isIn(a,c),e=new k.Point(a,c),f=k.Point.distance(this._prevPt,e),g,h,l;if(b)this._prevIsIn?this._lineTo(a,
c,!0):(g=this._prevPt,h=e,a=this._intersect(h,g),this.start=this._dist+f*(1-this._r),this._lineTo(a.x,a.y,!0),this._lineTo(h.x,h.y,!0));else if(this._prevIsIn)h=this._prevPt,g=e,a=this._intersect(h,g),this._lineTo(a.x,a.y,!0),this._lineTo(g.x,g.y,!1);else{var m=this._prevPt;if(!(m.x<=this.xmin&&e.x<=this.xmin||m.x>=this.xmax&&e.x>=this.xmax||m.y<=this.ymin&&e.y<=this.ymin||m.y>=this.ymax&&e.y>=this.ymax)){a=[];if(m.x<this.xmin&&e.x>this.xmin||m.x>this.xmin&&e.x<this.xmin)c=(this.xmin-m.x)/(e.x-m.x),
l=m.y+c*(e.y-m.y),l<=this.ymin?h=!1:l>=this.ymax?h=!0:a.push(new d(c,this.xmin,l));if(m.x<this.xmax&&e.x>this.xmax||m.x>this.xmax&&e.x<this.xmax)c=(this.xmax-m.x)/(e.x-m.x),l=m.y+c*(e.y-m.y),l<=this.ymin?h=!1:l>=this.ymax?h=!0:a.push(new d(c,this.xmax,l));if(m.y<this.ymin&&e.y>this.ymin||m.y>this.ymin&&e.y<this.ymin)c=(this.ymin-m.y)/(e.y-m.y),l=m.x+c*(e.x-m.x),l<=this.xmin?g=!1:l>=this.xmax?g=!0:a.push(new d(c,l,this.ymin));if(m.y<this.ymax&&e.y>this.ymax||m.y>this.ymax&&e.y<this.ymax)c=(this.ymax-
m.y)/(e.y-m.y),l=m.x+c*(e.x-m.x),l<=this.xmin?g=!1:l>=this.xmax?g=!0:a.push(new d(c,l,this.ymax));if(0===a.length)g?h?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):h?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this.start=this._dist+f*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+f*a[0].ratio,g=0;g<a.length;g++)this._lineTo(a[g].x,a[g].y,!0)}this._lineTo(e.x,
e.y,!1)}this._dist+=f;this._prevIsIn=b;this._prevPt=e};a.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,c=this._prevPt;a.x===c.x&&a.y===c.y||this.lineTo(a.x,a.y);a=this.line;for(c=a.length;4<=c;)if(a[0].x===a[1].x&&a[0].x===a[c-2].x||a[0].y===a[1].y&&a[0].y===a[c-2].y)a.pop(),a[0].x=a[c-2].x,a[0].y=a[c-2].y,--c;else break}};a.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&g.simplify(this.tileSize,this.margin*
this.finalRatio,this.lines);return this.lines};a.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,c=a.length;if(0===c)return null;for(var b=[],d=0;d<c;d++)b.push({line:a[d],start:this.starts[d]||0});return b};a.prototype._isIn=function(a,c){return a>=this.xmin&&a<=this.xmax&&c>=this.ymin&&c<=this.ymax};a.prototype._intersect=function(a,c){var b,d,f;if(c.x>=this.xmin&&c.x<=this.xmax)d=c.y<=this.ymin?this.ymin:this.ymax,f=(d-
a.y)/(c.y-a.y),b=a.x+f*(c.x-a.x);else if(c.y>=this.ymin&&c.y<=this.ymax)b=c.x<=this.xmin?this.xmin:this.xmax,f=(b-a.x)/(c.x-a.x),d=a.y+f*(c.y-a.y);else{d=c.y<=this.ymin?this.ymin:this.ymax;b=c.x<=this.xmin?this.xmin:this.xmax;var g=(b-a.x)/(c.x-a.x),h=(d-a.y)/(c.y-a.y);g<h?(f=g,d=a.y+g*(c.y-a.y)):(f=h,b=a.x+h*(c.x-a.x))}this._r=f;return new k.Point(b,d)};a.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?
1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};a.prototype._moveTo=function(a,c,b){3!==this.type?b&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),c=Math.round((c-(this.ymin+this.margin))*this.finalRatio),this.line.push(new k.Point(a,c))):(b||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),c<this.ymin&&(c=this.ymin),c>this.ymax&&
(c=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),c=Math.round((c-(this.ymin+this.margin))*this.finalRatio),this.line.push(new k.Point(a,c)),this._is_v=this._is_h=!1)};a.prototype._lineTo=function(a,c,b){if(3!==this.type)if(b){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);c=Math.round((c-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(b=this.line[this.line.length-1],b.equals(a,c)))return;this.line.push(new k.Point(a,c))}else this.line&&0<this.line.length&&
this._pushLine();else if(b||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),c<this.ymin&&(c=this.ymin),c>this.ymax&&(c=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),c=Math.round((c-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){b=this.line[this.line.length-1];var d=b.x===a,f=b.y===c;d&&f||(this._is_h&&d?(b.x=a,b.y=c,b=this.line[this.line.length-2],b.x===a&&b.y===c?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(b=this.line[this.line.length-
2],this._is_h=b.x===a,this._is_v=b.y===c)):(this._is_h=b.x===a,this._is_v=b.y===c)):this._is_v&&f?(b.x=a,b.y=c,b=this.line[this.line.length-2],b.x===a&&b.y===c?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(b=this.line[this.line.length-2],this._is_h=b.x===a,this._is_v=b.y===c)):(this._is_h=b.x===a,this._is_v=b.y===c)):(this.line.push(new k.Point(a,c)),this._is_h=d,this._is_v=f))}else this.line.push(new k.Point(a,c))};return a}();a.TileClipper=n;n=function(){function a(){}a.prototype.setExtent=
function(a){this._ratio=4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,c){this.line&&this.lines.push(this.line);this.line=[];var b=this._ratio;this.line.push(new k.Point(Math.round(a*b),Math.round(c*b)))};a.prototype.lineTo=function(a,c){var b=this._ratio;this.line.push(new k.Point(Math.round(a*b),Math.round(c*b)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=
function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&g.simplify(4096,64,this.lines);return this.lines};return a}();a.SimpleBuilder=n;var g=function(){function a(){}a.simplify=function(d,c,b){if(b){var e=-c,f=d+c,g=-c,h=d+c;d=[];c=[];for(var l=b.length,k=0;k<l;++k){var m=b[k];if(m&&!(2>m.length))for(var n=m[0],t=void 0,x=m.length,z=1;z<x;++z)t=m[z],n.x===t.x&&(n.x<=e&&(n.y>t.y?(d.push(k),d.push(z),d.push(0),d.push(-1)):(c.push(k),c.push(z),
c.push(0),c.push(-1))),n.x>=f&&(n.y<t.y?(d.push(k),d.push(z),d.push(1),d.push(-1)):(c.push(k),c.push(z),c.push(1),c.push(-1)))),n.y===t.y&&(n.y<=g&&(n.x<t.x?(d.push(k),d.push(z),d.push(2),d.push(-1)):(c.push(k),c.push(z),c.push(2),c.push(-1))),n.y>=h&&(n.x>t.x?(d.push(k),d.push(z),d.push(3),d.push(-1)):(c.push(k),c.push(z),c.push(3),c.push(-1)))),n=t}0!==d.length&&0!==c.length&&(a.fillParent(b,c,d),a.fillParent(b,d,c),e=[],a.calcDeltas(e,c,d),a.calcDeltas(e,d,c),a.addDeltas(e,b))}};a.fillParent=function(a,
c,b){for(var d=b.length,f=c.length,g=0;g<f;g+=4){for(var l=c[g],k=c[g+1],m=c[g+2],n=a[l][k-1],l=a[l][k],k=8092,y=-1,t=0;t<d;t+=4)if(b[t+2]===m){var x=b[t],z=b[t+1],A=a[x][z-1],x=a[x][z];switch(m){case 0:case 1:h.between(n.y,A.y,x.y)&&h.between(l.y,A.y,x.y)&&(A=Math.abs(x.y-A.y),A<k&&(k=A,y=t));break;case 2:case 3:h.between(n.x,A.x,x.x)&&h.between(l.x,A.x,x.x)&&(A=Math.abs(x.x-A.x),A<k&&(k=A,y=t))}}c[g+3]=y}};a.calcDeltas=function(d,c,b){for(var e=c.length,f=0;f<e;f+=4){var g=a.calcDelta(f,c,b,[]);
d.push(c[f]);d.push(c[f+1]);d.push(c[f+2]);d.push(g)}};a.calcDelta=function(d,c,b,e){d=c[d+3];if(-1===d)return 0;var f=e.length;if(1<f&&e[f-2]===d)return 0;e.push(d);return a.calcDelta(d,b,c,e)+1};a.addDeltas=function(a,c){for(var b=a.length,d=0,f=0;f<b;f+=4){var g=a[f+3];g>d&&(d=g)}for(f=0;f<b;f+=4){var h=c[a[f]],l=a[f+1],g=d-a[f+3];switch(a[f+2]){case 0:h[l-1].x-=g;h[l].x-=g;1===l&&(h[h.length-1].x-=g);l===h.length-1&&(h[0].x-=g);break;case 1:h[l-1].x+=g;h[l].x+=g;1===l&&(h[h.length-1].x+=g);l===
h.length-1&&(h[0].x+=g);break;case 2:h[l-1].y-=g;h[l].y-=g;1===l&&(h[h.length-1].y-=g);l===h.length-1&&(h[0].y-=g);break;case 3:h[l-1].y+=g,h[l].y+=g,1===l&&(h[h.length-1].y+=g),l===h.length-1&&(h[0].y+=g)}}};return a}()})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["require","exports","../../../../symbols/cim/enums","./mesh/templates/util"],function(n,a,m,k){function h(){if(t.cosine<e.innerBisectorAutoSplitThreshold){t.splitInner=!0;t.gapInner=!0;var a=Math.max(e.innerBisectorAutoSplitThreshold,
t.cosine),a=Math.sqrt(1-a*a)/a;t.leftInner.x=t.nextNormal.x+t.sign*a*t.outbound.x;t.leftInner.y=t.nextNormal.y+t.sign*a*t.outbound.y;t.rightInner.x=t.prevNormal.x-t.sign*a*t.inbound.x;t.rightInner.y=t.prevNormal.y-t.sign*a*t.inbound.y}else e.enableInnerBisectorSplit&&(t.splitInner=!0,t.gapInner=!1,t.leftInner.x=t.rightInner.x=t.bisector.x/t.cosine,t.leftInner.y=t.rightInner.y=t.bisector.y/t.cosine);t.cosine<e.outerBisectorAutoSplitThreshold?(t.splitOuter=!0,t.gapOuter=!0,a=Math.max(e.outerBisectorAutoSplitThreshold,
t.cosine),a=Math.sqrt(1-a*a)/a,t.leftOuter.x=t.prevNormal.x-t.sign*a*t.inbound.x,t.leftOuter.y=t.prevNormal.y-t.sign*a*t.inbound.y,t.rightOuter.x=t.nextNormal.x+t.sign*a*t.outbound.x,t.rightOuter.y=t.nextNormal.y+t.sign*a*t.outbound.y):e.enableOuterBisectorSplit&&(t.splitOuter=!0,t.gapOuter=!1,t.leftOuter.x=t.rightOuter.x=t.bisector.x/t.cosine,t.leftOuter.y=t.rightOuter.y=t.bisector.y/t.cosine)}function d(){if(u)t.distance=0,u=t.isCap=t.isFirstVertex=t.isLastVertex=!1;else{if(0===r)if(t.isFirstVertex=
0===q,y=b[q],0===q){if(r=0,t.closed){t.inbound.x=y.x-b[b.length-2].x;t.inbound.y=y.y-b[b.length-2].y;var a=Math.sqrt(t.inbound.x*t.inbound.x+t.inbound.y*t.inbound.y);t.inbound.x/=a;t.inbound.y/=a}}else t.inbound.x=y.x-v.x,t.inbound.y=y.y-v.y,r=Math.sqrt(t.inbound.x*t.inbound.x+t.inbound.y*t.inbound.y),t.inbound.x/=r,t.inbound.y/=r;t.distance+r-w<=e.wrapDistance?(q<b.length-1?(t.outbound.x=b[q+1].x-y.x,t.outbound.y=b[q+1].y-y.y,a=Math.sqrt(t.outbound.x*t.outbound.x+t.outbound.y*t.outbound.y),t.outbound.x/=
a,t.outbound.y/=a):t.closed?(t.outbound.x=b[1].x-y.x,t.outbound.y=b[1].y-y.y,a=Math.sqrt(t.outbound.x*t.outbound.x+t.outbound.y*t.outbound.y),t.outbound.x/=a,t.outbound.y/=a):(t.outbound.x=t.inbound.x,t.outbound.y=t.inbound.y),0!==q||t.closed||(t.inbound.x=t.outbound.x,t.inbound.y=t.outbound.y),++q,t.isLastVertex=q===b.length,t.isCap=!t.closed&&(t.isFirstVertex||t.isLastVertex),t.distance+=r-w,w=r=0,u=t.distance+r-w===e.wrapDistance,t.currentVertex.x=y.x,t.currentVertex.y=y.y,v=y,y=null):(t.outbound.x=
t.inbound.x,t.outbound.y=t.inbound.y,w+=e.wrapDistance-t.distance,t.distance=e.wrapDistance,u=!0,a=w/r,t.currentVertex.x=(1-a)*v.x+a*y.x,t.currentVertex.y=(1-a)*v.y+a*y.y)}}function g(){t.prevNormal.x=-t.inbound.y;t.prevNormal.y=t.inbound.x;t.nextNormal.x=-t.outbound.y;t.nextNormal.y=t.outbound.x}function l(){g();t.bisector.x=t.prevNormal.x+t.nextNormal.x;t.bisector.y=t.prevNormal.y+t.nextNormal.y;var a=Math.sqrt(t.bisector.x*t.bisector.x+t.bisector.y*t.bisector.y);.001>a?(t.bisector.x=void 0,t.bisector.y=
void 0,t.cosine=0,t.sign=void 0):(t.bisector.x/=a,t.bisector.y/=a,t.cosine=t.bisector.x*t.nextNormal.x+t.bisector.y*t.nextNormal.y,t.sign=0<=t.prevNormal.x*t.nextNormal.y-t.prevNormal.y*t.nextNormal.x?1:-1)}function f(a){p.vertex(t);1===a?(t.leftEntry0=t.entry0,t.leftEntry1=t.entry1,t.leftEntry2=t.entry2,t.leftExit0=t.exit0,t.leftExit1=t.exit1,t.leftExit2=t.exit2):2===a&&(t.rightEntry0=t.entry0,t.rightEntry1=t.entry1,t.rightEntry2=t.entry2,t.rightExit0=t.exit0,t.rightExit1=t.exit1,t.rightExit2=t.exit2)}
function c(a){p.vertex(t);1===a?(t.leftEntry0=t.entry0,t.leftEntry2=t.entry2,t.leftExit0=t.exit0,t.leftExit2=t.exit2):2===a&&(t.rightEntry0=t.entry0,t.rightEntry2=t.entry2,t.rightExit0=t.exit0,t.rightExit2=t.exit2)}Object.defineProperty(a,"__esModule",{value:!0});n=function(){return function(){this.isCap=this.isLastVertex=this.isFirstVertex=this.closed=void 0;this.currentVertex={x:void 0,y:void 0};this.inbound={x:void 0,y:void 0};this.outbound={x:void 0,y:void 0};this.prevNormal={x:void 0,y:void 0};
this.nextNormal={x:void 0,y:void 0};this.bisector={x:void 0,y:void 0};this.leftInner={x:void 0,y:void 0};this.rightInner={x:void 0,y:void 0};this.leftOuter={x:void 0,y:void 0};this.rightOuter={x:void 0,y:void 0}}}();a.TessellationState=n;a.tessellate=function(a,h,k){e.trackDistance=null!=h.trackDistance?h.trackDistance:!1;e.wrapDistance=null!=h.wrapDistance?h.wrapDistance:65535;e.thin=null!=h.thin?h.thin:!1;e.initialDistance=null!=h.initialDistance?h.initialDistance:0;e.enableOuterBisectorSplit=null!=
h.enableOuterBisectorSplit?h.enableOuterBisectorSplit:!1;e.outerBisectorAutoSplitThreshold=null!=h.outerBisectorAutoSplitThreshold?h.outerBisectorAutoSplitThreshold:0;e.enableInnerBisectorSplit=null!=h.enableOuterBisectorSplit?h.enableOuterBisectorSplit:!1;e.innerBisectorAutoSplitThreshold=null!=h.innerBisectorAutoSplitThreshold?h.innerBisectorAutoSplitThreshold:0;b=a;p=k;w=r=q=0;u=!1;y=v=null;t.currentVertex.x=null;t.currentVertex.y=null;t.distance=e.initialDistance;a=b[0];h=b[b.length-1];t.canSplit=
!1;t.closed=a.x===h.x&&a.y===h.y;if(!(2>b.length||2===b.length&&t.closed))if(e.thin)if(e.trackDistance)for(d(),g(),c(1);r-w>e.wrapDistance||q<b.length;)d(),g(),c(2),p.bridge(t),t.leftExit0=t.rightExit0,t.leftExit2=t.rightExit2;else for(;q<b.length;)0<q&&(t.inbound.x=t.outbound.x,t.inbound.y=t.outbound.y),q<b.length-1?(t.outbound.x=b[q+1].x-b[q].x,t.outbound.y=b[q+1].y-b[q].y,a=Math.sqrt(t.outbound.x*t.outbound.x+t.outbound.y*t.outbound.y),t.distance+=a,t.outbound.x/=a,t.outbound.y/=a):(t.outbound.x=
t.inbound.x,t.outbound.y=t.inbound.y),0===q&&(t.inbound.x=t.outbound.x,t.inbound.y=t.outbound.y),t.currentVertex.x=b[q].x,t.currentVertex.y=b[q].y,t.prevNormal.x=-t.inbound.y,t.prevNormal.y=t.inbound.x,t.nextNormal.x=-t.outbound.y,t.nextNormal.y=t.outbound.x,0===q?(p.vertex(t),t.leftEntry0=t.entry0,t.leftEntry2=t.entry2,t.leftExit0=t.exit0,t.leftExit2=t.exit2):(p.vertex(t),t.rightEntry0=t.entry0,t.rightEntry2=t.entry2,t.rightExit0=t.exit0,t.rightExit2=t.exit2,p.bridge(t),t.leftExit0=t.rightExit0,
t.leftExit2=t.rightExit2),++q;else{if(e.enableOuterBisectorSplit||0<e.outerBisectorAutoSplitThreshold||e.enableInnerBisectorSplit||0<e.innerBisectorAutoSplitThreshold)for(t.canSplit=!0,d(),l(),t.splitInner=t.gapInner=t.splitOuter=t.gapOuter=!1,f(1),t.closure0=t.leftEntry0,t.closure1=t.leftEntry1,t.closure2=t.leftEntry2;r-w>e.wrapDistance||q<b.length-1||q<b.length&&(!t.closed||e.trackDistance);)d(),l(),t.splitInner=t.gapInner=t.splitOuter=t.gapOuter=!1,f(2),p.bridge(t),t.leftExit0=t.rightExit0,t.leftExit1=
t.rightExit1,t.leftExit2=t.rightExit2;else for(d(),l(),f(1),t.closure0=t.leftEntry0,t.closure1=t.leftEntry1,t.closure2=t.leftEntry2;r-w>e.wrapDistance||q<b.length-1||q<b.length&&(!t.closed||e.trackDistance);)d(),l(),f(2),p.bridge(t),t.leftExit0=t.rightExit0,t.leftExit1=t.rightExit1,t.leftExit2=t.rightExit2;t.closed&&!e.trackDistance&&(t.rightEntry0=t.closure0,t.rightEntry1=t.closure1,t.rightEntry2=t.closure2,p.bridge(t),t.leftExit0=t.rightExit0,t.leftExit1=t.rightExit1,t.leftExit2=t.rightExit2)}};
a.cleanup=function(){p=b=null};a.splitVertex=h;var b,e={},p,q=void 0,r,w,u,v,y,t=new n;n=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b;this.capType=m.CapType.BUTT;this.joinType=m.JoinType.MITER;this.miterLimitCosine=k.getLimitCosine(2);this.roundLimitCosine=Math.cos(23*Math.PI/180);this.almostParallelCosine=.97;this.radsPerSlice=.8;this.joinOnUTurn=this.textured=!1}a.prototype.vertex=function(a){var b=this.joinType===m.JoinType.MITER?this.miterLimitCosine:this.roundLimitCosine,
c=a.isCap&&this.capType!==m.CapType.BUTT,d=!1;a.cosine>this.almostParallelCosine?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):a.cosine<1-this.almostParallelCosine?(d=!a.isCap&&this.joinOnUTurn,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,
a.prevNormal.y,0,-1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.canSplit?(h(),0<a.sign?(a.splitInner?(a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.leftInner.x,
a.leftInner.y,0,-1,a.distance),a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.rightInner.x,a.rightInner.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.leftOuter.x,-a.leftOuter.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.rightOuter.x,-a.rightOuter.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.splitInner?
(a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.leftInner.x,-a.leftInner.y,0,1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.rightInner.x,-a.rightInner.y,0,1,a.distance)):a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,
a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.leftOuter.x,a.leftOuter.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.rightOuter.x,a.rightOuter.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance))):0<a.sign?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance));b=a.canSplit&&(a.splitInner||a.splitOuter)||d||c?a.entry1=a.exit1=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,0,0,0,0,a.distance):a.entry1=a.exit1=null;if(d&&this.joinType!==m.JoinType.ROUND)this.writeTriangle(b,0<a.sign?a.exit2:a.entry0,0<a.sign?a.entry2:a.exit0);else if(c&&this.capType===m.CapType.ROUND||d&&this.joinType===m.JoinType.ROUND){var e=d=c=void 0,f=void 0,g=void 0,l=void 0;if(a.isCap){var k=
Math.PI,g=Math.ceil(k/this.radsPerSlice),l=k/g;a.isFirstVertex?(c=a.prevNormal.x,d=a.prevNormal.y,e=a.entry0,f=a.entry2):a.isLastVertex&&(c=-a.nextNormal.x,d=-a.nextNormal.y,e=a.exit2,f=a.exit0)}else k=2*Math.acos(a.cosine),g=Math.ceil(k/this.radsPerSlice),l=k/g,c=0<a.sign?-a.prevNormal.x:a.nextNormal.x,d=0<a.sign?-a.prevNormal.y:a.nextNormal.y,e=0<a.sign?a.entry2:a.exit0,f=0<a.sign?a.exit2:a.entry0;for(var k=Math.cos(l),l=Math.sin(l),p=l*c+k*d,c=k*c-l*d,d=p,n,p=void 0,q=0;q<g;++q)n=p,q<g-1&&(p=a.isCap?
this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,a.isFirstVertex?-1:1,0,a.distance):this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,0,a.sign,a.distance)),this.writeTriangle(0===q?e:n,b,q===g-1?f:p),n=l*c+k*d,c=k*c-l*d,d=n}else c&&this.capType===m.CapType.SQUARE&&(c=a.isFirstVertex?1:-1,e=d=void 0,this.textured?(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,-c,-1,a.distance),e=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,-c,1,a.distance)):(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,0,-1,a.distance),e=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,0,1,a.distance)),0<c?(this.writeTriangle(b,a.entry2,e),this.writeTriangle(b,e,d),this.writeTriangle(b,d,a.entry0)):(this.writeTriangle(b,e,a.exit2),
this.writeTriangle(b,d,e),this.writeTriangle(b,a.exit0,d)))};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,null!=a.leftExit1?a.leftExit1:a.leftExit2);this.writeTriangle(a.rightEntry0,null!=a.rightEntry1?a.rightEntry1:a.rightEntry2,null!=a.leftExit1?a.leftExit1:a.leftExit2);null!=a.leftExit1&&null!=a.rightEntry1?(this.writeTriangle(a.leftExit1,a.rightEntry1,a.leftExit2),this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)):null!=a.leftExit1?this.writeTriangle(a.leftExit1,
a.rightEntry2,a.leftExit2):null!=a.rightEntry1&&this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)};return a}();a.StandardTessellationCallbacks=n;n=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b}a.prototype.vertex=function(a){a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance);a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance);a.exit0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance);a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,a.leftExit2);this.writeTriangle(a.rightEntry0,a.rightEntry2,a.leftExit2)};return a}();a.ThinTessellationCallbacks=n})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define("require exports ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/Logger ../../util/Matcher".split(" "),
function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=d.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");a.createMatcher=function(a,c,b){return k(this,void 0,void 0,function(){return m(this,function(d){switch(a.type){case "simple":case "dot-density":return[2,g.FeatureMatcher.fromBasicRenderer(a,c,b)];case "unique-value":return[2,g.MapMatcher.fromUVRenderer(a,c,b)];case "class-breaks":return[2,g.IntervalMatcher.fromCBRenderer(a,c,b)];case "dictionary":return[2,
g.DictionaryMatcher.fromDictionaryRenderer(a,c,b)];default:return l.error(new h("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),[2,null]}})})}})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../support/arcadeOnDemand ../../../../../symbols/support/cimSymbolUtils ../../../arcade/utils".split(" "),
function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});var b=d.getLogger("esri/views/2d/engine/webgl/util/Matcher");n=function(){function a(){this._defaultResult=null}a.fromBasicRenderer=function(b,c,d){return h(this,void 0,void 0,function(){var e,g,h;return k(this,function(l){switch(l.label){case 0:return[4,f.expandSymbols(b.getSymbols())];case 1:return e=l.sent(),g=new a,e.length?[4,c.createTemplateGroup(e[0],null,b,d)]:[3,3];case 2:h=l.sent(),g.setDefault(h),l.label=3;case 3:return[2,
g]}})})};a.prototype.size=function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};a.prototype.setDefault=function(a){this._defaultResult=a};a.prototype.match=function(a,b,c,d,e){return this.getDefault()};a.prototype.analyze=function(a,b,c,d,e){return h(this,void 0,void 0,function(){return k(this,function(a){return[2]})})};return a}();a.FeatureMatcher=n;d=function(a){function d(b,d,e,f){var g=a.call(this)||this;g._intervals=[];g._isMaxInclusive=d;f?g._getValue=c.callWithFeature.bind(null,
f):b&&b.length?"function"===typeof b?(g._field=null,g._getValue=b):(g._field=b,g._normalizationInfo=e,g._getValue=g._getValueFromField.bind(g)):g._field=null;return g}m(d,a);d.fromCBRenderer=function(a,b,c){return h(this,void 0,void 0,function(){var e,g,h,m,p,n,q,r,w,G,F,K,H,N,I,J,M,L,R;return k(this,function(k){switch(k.label){case 0:return e=a.isMaxInclusive,g=a.normalizationField,h=a.normalizationTotal,m=a.normalizationType,p=a.field,n={normalizationField:g,normalizationTotal:h,normalizationType:m},
(w=q=a.valueExpression)?[4,l.createRendererExpression(q,c.spatialReference,c.fields)]:[3,2];case 1:w=k.sent(),k.label=2;case 2:return r=w,G=new d(p,e,n,r),[4,f.expandSymbol(a.backgroundFillSymbol)];case 3:F=k.sent(),K=0,H=a.classBreakInfos,k.label=4;case 4:if(!(K<H.length))return[3,8];N=H[K];return[4,f.expandSymbol(N.symbol)];case 5:return I=k.sent(),[4,b.createTemplateGroup(I,F,a,c)];case 6:J=k.sent(),M={min:N.minValue,max:N.maxValue},G.add(M,J),k.label=7;case 7:return K++,[3,4];case 8:return[4,
f.expandSymbol(a.defaultSymbol)];case 9:return(L=k.sent())?[4,b.createTemplateGroup(L,F,a,c)]:[3,11];case 10:R=k.sent(),G.setDefault(R),k.label=11;case 11:return[2,G]}})})};d.prototype.add=function(a,b){this._intervals.push({interval:a,result:b});this._intervals.sort(function(a,b){return a.interval.min-b.interval.min})};d.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};d.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,
{$view:e},c,d);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(b=0;b<this._intervals.length;b++)if(d=this._intervals[b],c=d.interval,d=d.result,e=this._isMaxInclusive?a<=c.max:a<c.max,a>=c.min&&e)return d;return this.getDefault()};d.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};d.prototype._getValueFromField=function(a){var c=a.attributes[this._field];if(!this._needsNormalization())return c;
var d=this._normalizationInfo,e=d.normalizationField,f=d.normalizationTotal,d=d.normalizationType;a=!!e&&a.attributes[e];if(d)switch(d){case "field":return(a||void 0)&&c/a;case "log":return Math.log(c)*Math.LOG10E;case "percent-of-total":return c/f*100;default:b.error("Found unknown normalization type: "+d)}else b.error("Normalization is required, but no type was set!")};return d}(n);a.IntervalMatcher=d;d=function(a){function b(b,d,e){var f=a.call(this)||this;f._resultsMap=new Map;e?f._getValue=c.callWithFeature.bind(null,
e):b&&b.length?"function"===typeof b[0]?(f._fields=null,f._getValue=b[0]):(f._fields=b,f._seperator=d||"",f._getValue=f._getValueFromFields.bind(f)):f._fields=null;return f}m(b,a);b.fromUVRenderer=function(a,c,d){return h(this,void 0,void 0,function(){var e,g,h,m,p,n,q,r,w,G,F,K,H,N,I;return k(this,function(k){switch(k.label){case 0:return e=a.uniqueValueInfos,g=a.fieldDelimiter,h=[a.field],m=a.valueExpression,a.field2&&h.push(a.field2),a.field3&&h.push(a.field3),[4,f.expandSymbol(a.backgroundFillSymbol)];
case 1:return p=k.sent(),(q=m)?[4,l.createRendererExpression(m,d.spatialReference,d.fields)]:[3,3];case 2:q=k.sent(),k.label=3;case 3:n=q,r=new b(h,g,n),w=0,G=e,k.label=4;case 4:if(!(w<G.length))return[3,8];F=G[w];return[4,f.expandSymbol(F.symbol)];case 5:return K=k.sent(),[4,c.createTemplateGroup(K,p,a,d)];case 6:H=k.sent(),r.add(F.value,H),k.label=7;case 7:return w++,[3,4];case 8:return[4,f.expandSymbol(a.defaultSymbol)];case 9:return(N=k.sent())?[4,c.createTemplateGroup(a.defaultSymbol,p,a,d)]:
[3,11];case 10:I=k.sent(),r.setDefault(I),k.label=11;case 11:return[2,r]}})})};b.prototype.add=function(a,b){this._resultsMap.set(a.toString(),b)};b.prototype.size=function(){return a.prototype.size.call(this)+this._resultsMap.size};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:e},c,d);if(!a&&(null===a||void 0===a))return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};b.prototype._getValueFromFields=
function(a){for(var b=[],c=0,d=this._fields;c<d.length;c++)b.push(a.attributes[d[c]]);return b.join(this._seperator)};return b}(n);a.MapMatcher=d;n=function(a){function b(b,c,d){var e=a.call(this)||this;e._fidToAttributeHash=new Map;e._attributeHashToGroup=new Map;e._renderer=b;e._fieldMap=b.fieldMap;e._templates=c;e._info=d;return e}m(b,a);b.fromDictionaryRenderer=function(a,c,d){return h(this,void 0,void 0,function(){return k(this,function(e){a.fetchResources({spatialReference:d.spatialReference,
fields:d.fields});return[2,new b(a,c,d)]})})};b.prototype.analyze=function(a,b,c,d,e){return h(this,void 0,void 0,function(){var c,f,h,l,m,p,n=this;return k(this,function(k){switch(k.label){case 0:c=[];f=function(b){var f=b.attributes[a],g=h._fidToAttributeHash.get(f),l=h._hashAttributes(b);if(g===l)return"continue";h._fidToAttributeHash.set(f,l);h._attributeHashToGroup.has(l)||(b=h._renderer.getSymbolAsync(b,{scale:d&&d.scale,viewingMode:d&&d.viewingMode,spatialReference:h._info.spatialReference,
abortOptions:e,fields:h._info.fields}).then(function(a){return n._templates.createTemplateGroup(a,null,n._renderer,n._info).then(function(a){return n._attributeHashToGroup.set(l,a)})}),c.push(b))};h=this;l=0;for(m=b;l<m.length;l++)p=m[l],f(p);return[4,g.all(c)];case 1:return k.sent(),[2]}})})};b.prototype.match=function(a,b,c,d,e){a=this._fidToAttributeHash.get(b.attributes[a]);return this._attributeHashToGroup.get(a)};b.prototype._hashAttributes=function(a){var b="",c;for(c in this._fieldMap)b+=
". "+a.attributes[this._fieldMap[c]];return b};return b}(n);a.DictionaryMatcher=n})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/SpatialReference ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../MeshData ../VertexVector ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){function A(a){var c=(a.attributes?Object.keys(a.attributes):[]).map(function(b){return{name:b,alias:b,type:"string"===typeof a.attributes[b]?"esriFieldTypeString":"esriFieldTypeDouble"}});return{geometryType:null!=a.centroid?"esriGeometryPolygon":e.getJsonType(a.geometry),spatialReference:b.fromJSON(a.geometry.spatialReference),fields:c}}Object.defineProperty(a,"__esModule",{value:!0});var E=l.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),
B={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};n=function(){function a(a,b,c,d,e,g){this._isDD=!1;this._labelsDebugTemplate=null;this._isDD=f.isSome(c)&&"dot-density"===c.type;this._geometryType=a;this._idField=b;this._templateStore=d;e&&this._validateLabelingInfo(e)&&
(this._labelTemplates=e.map(function(a){return y.default.fromLabelClass(c,a,g)}))}Object.defineProperty(a.prototype,"templates",{get:function(){return this._templateStore},enumerable:!0,configurable:!0});a.prototype.createMeshData=function(a){var b=Array(5),c=this._labelTemplates&&0<this._labelTemplates.length,d="esriGeometryPolyline"===this._geometryType?q.HEURISTIC_GLYPHS_PER_LINE:q.HEURISTIC_GLYPHS_PER_FEATURE;b[r.WGLGeometryType.MARKER]=new v.VertexVectors(r.WGLGeometryType.MARKER,a);b[r.WGLGeometryType.FILL]=
new v.VertexVectors(r.WGLGeometryType.FILL,a,this._isDD);b[r.WGLGeometryType.LINE]=new v.VertexVectors(r.WGLGeometryType.LINE,a);b[r.WGLGeometryType.TEXT]=new v.VertexVectors(r.WGLGeometryType.TEXT,a);b[r.WGLGeometryType.LABEL]=new v.VertexVectors(r.WGLGeometryType.LABEL,c?d:0);return new u.MeshData([],b)};a.prototype.analyze=function(a,b,d,e,g,l){return h(this,void 0,void 0,function(){var h,m,p,n,q,u,r,w,t,v,y;return k(this,function(k){switch(k.label){case 0:return h=a,c.isAborted(l)?[2,[]]:f.isSome(d)?
[4,d.analyze(this._idField,a,e,g,l)]:[3,2];case 1:k.sent(),k.label=2;case 2:m=0,p=h,k.label=3;case 3:if(!(m<p.length))return[3,10];n=p[m];q=-1;if(!b)return[3,7];u=n;if(null==u.symbol)return[3,5];r=null;"cim"===u.symbol.type&&(r=A(n));return[4,this._templateStore.createTemplateGroup(u.symbol,null,null,r)];case 4:return q=k.sent(),[3,6];case 5:f.isSome(d)&&(q=d.match(this._idField,n,null,null,g)),k.label=6;case 6:return[3,8];case 7:f.isSome(d)&&(q=d.match(this._idField,n,this._geometryType,e,g)),k.label=
8;case 8:if(z.isDynamicId(q))for(w=this._templateStore.getDynamicTemplateGroup(q),t=0,v=w;t<v.length;t++)(y=v[t])&&y.analyze&&y.analyze(this._templateStore,n,e,g);n.groupId=q;k.label=9;case 9:return m++,[3,3];case 10:return[2,this._templateStore.finalize(l).then(function(){return h})]}})})};a.prototype.write=function(a,b,c,d,f,h,l){var k=this._templateStore.getTemplateGroup(b.groupId),m=b.localId;if(null==m)g("esri-2d-debug")&&console.debug("Got null id for feature");else{var p=new w(m),n=!!h&&!!this._labelTemplates&&
h.has(m);if(z.isDynamicId(b.groupId))for(var q=0;q<k.length;q++){var u=k[q];u.bindFeature(b,c,d)}if(k&&(b.geometry||b.centroid)){d=p.displayRecords;u=b.insertAfter;void 0!==u&&(p.insertAfter=u);(c=this._geometryType)||(c=null!=b.centroid?"esriGeometryPolygon":e.getJsonType(b.geometry));for(q=0;q<k.length;q++){var u=k[q],r=a.get(u.geometryType);u.writeMesh(d,r,c,m,b)}n&&(k=this._getLabelReference(k),h=h.get(m),this._writeLabelMesh(p,a,m,b,l,h,k,f,c));a.pushDisplayObject(p)}}};a.prototype._hasBadLabelClass=
function(a,b){var c=a.labelPlacement,e=B[b];if(!a.symbol)return E.warn("No LabelClass symbol specified."),!0;if(!e)return E.error(new d("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, "+b+" is not supported")),!0;e.some(function(a){return a===c})||(e=e[0],c&&E.warn("Found invalid label placement type "+c+" for "+b+". Defaulting to "+e),a.labelPlacement=e);return!1};a.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a,
b._geometryType)})};a.prototype._getLabelReference=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c instanceof x.default)return c}return null};a.prototype._writeLabelMesh=function(a,b,c,d,e,f,g,h,l){for(var k=a.displayRecords,m=[],p=0;p<f.length;p++){var n=f[p],u=n.text,r=n.rtl,n=this._labelTemplates[n.id],w=b.get(n.geometryType),t=e.get(n.symbolId).glyphMosaicItems;n.bindReferenceTemplate(g);n.bindTextInfo(t,u,r);n.writeMesh(k,w,l,c,d,h,m)}a.metrics=m;q.DEBUG_LABELS&&this._debugLabels(a,b)};
a.prototype._debugLabels=function(a,b){var c=a.displayRecords,d=a.id,e=0;for(a=a.metrics;e<a.length;e++)for(var f=a[e],g=0,h=f.boxes?f.boxes.concat([f.bounds]):[f.bounds];g<h.length;g++){var l=h[g],l={geometry:{paths:[[[f.anchor[0]+f.offsetX+l.center[0]-l.width/2,f.anchor[1]+f.offsetY+l.center[1]+l.height/2],[0,-l.height],[l.width,0],[0,l.height],[-l.width,0]]]},attributes:{}},k=this._getLabelDebugTemplate(),m=b.get(k.geometryType);k.writeMesh(c,m,"esriGeometryPolyline",d,l)}};a.prototype._getLabelDebugTemplate=
function(){this._labelsDebugTemplate||(this._labelsDebugTemplate=this._createLabelsDebugTemplate());return this._labelsDebugTemplate};a.prototype._createLabelsDebugTemplate=function(){var a=new p({style:"solid",width:1,color:[255,0,0,1]});return t.default.fromSimpleLine(null,!1,a,null,!1)};return a}();a.WGLMeshFactory=n})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./collisions/Metric","./util/serializationUtils"],function(n,a,m,k,h){return function(){function a(a){this.insertAfter=
null;this.id=a;this.displayRecords=[];this.metrics=[]}a.prototype.copy=function(){var d=new a(this.id);d.set(this);return d};a.prototype.clone=function(){var d=new a(this.id);d.displayRecords=this.displayRecords.map(function(a){return a.clone()});d.metrics=this.metrics.map(function(a){return a.clone()});d.insertAfter=this.insertAfter;return d};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=a.insertAfter};a.prototype.serialize=
function(a){a.push(this.id);h.serializeList(a,this.metrics);h.serializeList(a,this.displayRecords);return a};a.deserialize=function(d){var g=d.readInt32(),f=new a(g),g={id:g},c=h.deserializeList(d,k.default);c.length&&(f.metrics=c);f.displayRecords=h.deserializeList(d,m,g);return f};return a}()})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require","exports","../util/serializationUtils","../util/Writer"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,
g){this.displayObjects=a;this.vertexVectorsMap=g}Object.defineProperty(a.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});a.prototype.get=function(a){return this.vertexVectorsMap[a]};a.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};
a.prototype.encode=function(a,g){var d=m.serializeList(new k.default(Uint32Array,this._guessSize()),this.displayObjects).buffer(),f={};g.push(d);for(var c=0;c<this.vertexVectorsMap.length;c++){var b=this.vertexVectorsMap[c];f[c]={};b.transfer(f[c],g)}a.displayObjects=d;a.vertexBuffersMap=f;this.destroy()};a.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};a.prototype._guessSize=function(){for(var a=this.displayObjects,g=Math.min(a.length,4),h=0,f=0;f<g;f++)h=Math.max(h,
a[f].displayRecords.length);return 2*(12*a.length+a.length*h*40)};return a}();a.MeshData=n})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,h){this._pos=0;h=h?this._roundToNearest(h,a.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(h);this._buffer=new a(this._array);this._ctor=a}Object.defineProperty(a.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});
a.prototype._roundToNearest=function(a,h){a=Math.round(a);return a+(h-a%h)};a.prototype._ensureSize=function(a){if(this._pos+a>=this._buffer.length){a=this._roundToNearest(1.5*(this._array.byteLength+a*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);a=new ArrayBuffer(a);var h=new this._ctor(a);h.set(this._buffer,0);this._array=a;this._buffer=h}};a.prototype.writeF32=function(a){this._ensureSize(1);var h=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=a;this._pos++;return h};
a.prototype.push=function(a){this._ensureSize(1);var h=this._pos;this._buffer[this._pos++]=a;return h};a.prototype.writeRegion=function(a){this._ensureSize(a.length);var h=this._pos;this._buffer.set(a,this._pos);this._pos+=a.length;return h};a.prototype.buffer=function(){var a=this._array.slice(0,4*this._pos);this.destroy();return a};a.prototype.seek=function(a){this._pos=a};a.prototype.destroy=function(){this._buffer=this._array=null};return a}();a.default=n})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require",
"exports","../Utils","./VertexBuffer","../util/Writer"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(){function a(a,d){this.data=a;this.stride=d}Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.length/(this.stride/4)},enumerable:!0,configurable:!0});a.prototype.transfer=function(a,d){var c=this.data.buffer();a.vertexCount=this.vertexCount;a.data=c;a.stride=this.stride;d.push(c)};return a}();a.default=d;n=function(){function a(a,
f,c){void 0===c&&(c=!1);this.geometryType=a;this.indexVector=new h.default(Uint32Array,f);this.namedVectors={};a=m.getStrides(a,c);for(var b in a){c=a[b];var e=void 0;switch(c%4){case 0:case 2:e=new h.default(Uint32Array,c/4*f);break;case 1:case 3:e=new h.default(Uint8Array,c*f)}this.namedVectors[b]=new d(e,c)}}a.prototype.get=function(a){return this.namedVectors[a].data};a.prototype.getVector=function(a){return this.namedVectors[a]};a.prototype.transfer=function(a,d){var c=this.indexVector.buffer(),
b={};d.push(c);for(var e in this.namedVectors){var f=this.namedVectors[e];b[e]={};f.transfer(b[e],d)}a.geometryType=this.geometryType;a.indexBuffer=c;a.namedBuffers=b;this.destroy()};a.prototype.intoBuffers=function(){var a=k.VertexBuffers.fromVertexVectors(this);this.destroy();return a};a.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return a}();a.VertexVectors=n})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(n,
a,m){Object.defineProperty(a,"__esModule",{value:!0});var k=function(){function a(a,g,h){this.data=a;this.stride=g;this.vertexCount=h}a.decode=function(d){var g=m.allocateTypedArrayBufferwithData(d.data,d.stride);return new a(g,d.stride,d.vertexCount)};a.fromVertexVector=function(d){var g=m.allocateTypedArrayBufferwithData(d.data.buffer(),d.stride);return new a(g,d.stride,d.vertexCount)};return a}();a.default=k;n=function(){function a(a,g,h){this.geometryType=a;this.indexBuffer=new Uint32Array(g);
this.namedBuffers=h}a.decode=function(d){var g=d.geometryType,h=d.indexBuffer,f={},c;for(c in d.namedBuffers)f[c]=k.decode(d.namedBuffers[c]);return new a(g,h,f)};a.fromVertexVectors=function(d){var g=d.geometryType,h=d.indexVector.buffer(),f={},c;for(c in d.namedVectors)f[c]=k.fromVertexVector(d.namedVectors[c]);return new a(g,h,f)};return a}();a.VertexBuffers=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});var q=k.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");n=function(a){function e(d,e,f,g,h,l,k,m,p,n,q,r,w,N,I,J){var u=a.call(this)||this;d=c.LineMaterialKey.load(c.createMaterialKey(u.geometryType,d,w));e&&(d.sdf=e.sdf,d.pattern=!0,d.textureBinding=e.textureBinding);u._capType=g;u._joinType=h;u._miterLimitCosine=b.getLimitCosine(l);u.tessellationProperties._fillColor=k;u.tessellationProperties._tl=m;u.tessellationProperties._br=
p;u._hasPattern=n;u._isDashed=q;u._joinOnUTurn=J;u._isColorLocked=r;u._isOutline=w;u._zOrder=I;u._materialKey=d.data;u.tessellationProperties._bitset=r?1:0;u.tessellationProperties._halfWidth=.5*f;u.tessellationProperties._halfReferenceWidth=.5*N;u._initializeTessellator(!1);return u}m(e,a);e.fromCIMLine=function(a,b,c,f,k){var m=b.color,p=b.isDashed,n=b.cap;p&&n===d.CapType.ROUND&&(n=d.CapType.SQUARE);var q=b.join,u=h.pt2px(b.width),r=h.pt2px(b.referenceWidth),w=h.pt2px(b.miterLimit),m=m&&g.premultiplyAlphaRGBA(m)||
0;if(!c)return new e(a,c,u,n,q,w,m,0,0,!1,p,b.colorLocked,f,r,b.zOrder,k);var t=c.rect,v=t.x+1+c.width,y=t.y+1+c.height,t=l.i1616to32(t.x+1,t.y+1),v=l.i1616to32(v,y);return new e(a,c,u,n,q,w,m,t,v,!0,p,b.colorLocked,f,r,b.zOrder,k)};e.fromSimpleLine=function(a,b,c,d,k){var m=c.color,p="solid"!==c.style&&"none"!==c.style,n=f.getCapType(c.cap||"round",p),q=f.getJoinType(c.join||"round"),m=m&&"none"!==c.style&&g.premultiplyAlphaRGBA(m)||0;"none"===c.style&&(m=0);var u=h.pt2px(c.width);c=c.miterLimit;
if(!d)return new e(a,d,u,n,q,c,m,0,0,!1,p,!1,b,u,0,k);var r=d.rect,w=r.x+1+d.width,t=r.y+1+d.height,r=l.i1616to32(r.x+1,r.y+1),w=l.i1616to32(w,t);return new e(a,d,u,n,q,c,m,r,w,!0,p,!1,b,u,0,k)};e.fromPictureLineSymbol=function(a,b,c,d){q.error("PictureLineSymbol support does not exist!");return null};return e}(e.default(p.default));a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/has ../../../../../../core/Logger ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});var p=h.getLogger("esri.views.2d.engine.webgl.WGLLineTemplateBase"),q=d.TILE_SIZE+16,r=1/3.8,w=new f.TileClipper(0,0,0,1,16);w.setExtent(d.TILE_SIZE);var u=0,v=0,y=0;k("esri-tiles-performance")&&setInterval(function(){console.log("New (FL)","feat\x3d"+y,"secs\x3d"+u,"tris\x3d"+v,"tris/sec\x3d"+Math.round(v/u))},1E4);var t=new Uint32Array(9),x=new Uint32Array(36),z=new Uint32Array(3),A=new Uint32Array(6),E=function(a){return function(b){b.entry0=
a.offset+a.vertexCount++;var c=l.i1616to32(b.distance,31*a._halfWidth),d=l.i8888to32(Math.round(31*b.prevNormal.x),Math.round(31*b.prevNormal.y),Math.round(0),Math.round(-31)),e=l.i8888to32(0,0,0,a._bitset);x[0]=l.i1616to32(b.currentVertex.x,b.currentVertex.y);x[1]=a.id;x[2]=a._fillColor;x[3]=d;x[4]=c;x[5]=a._tl;x[6]=a._br;x[7]=e;x[8]=l.i1616to32(31*a._halfReferenceWidth,0);b.entry2=a.offset+a.vertexCount++;c=l.i1616to32(b.distance,31*a._halfWidth);d=l.i8888to32(Math.round(31*-b.prevNormal.x),Math.round(31*
-b.prevNormal.y),Math.round(0),Math.round(31));e=l.i8888to32(0,0,0,a._bitset);x[9]=l.i1616to32(b.currentVertex.x,b.currentVertex.y);x[10]=a.id;x[11]=a._fillColor;x[12]=d;x[13]=c;x[14]=a._tl;x[15]=a._br;x[16]=e;x[17]=l.i1616to32(31*a._halfReferenceWidth,0);b.exit0=a.offset+a.vertexCount++;c=l.i1616to32(b.distance,31*a._halfWidth);d=l.i8888to32(Math.round(31*b.nextNormal.x),Math.round(31*b.nextNormal.y),Math.round(0),Math.round(-31));e=l.i8888to32(0,0,0,a._bitset);x[18]=l.i1616to32(b.currentVertex.x,
b.currentVertex.y);x[19]=a.id;x[20]=a._fillColor;x[21]=d;x[22]=c;x[23]=a._tl;x[24]=a._br;x[25]=e;x[26]=l.i1616to32(31*a._halfReferenceWidth,0);b.exit2=a.offset+a.vertexCount++;c=l.i1616to32(b.distance,31*a._halfWidth);d=l.i8888to32(Math.round(31*-b.nextNormal.x),Math.round(31*-b.nextNormal.y),Math.round(0),Math.round(31));e=l.i8888to32(0,0,0,a._bitset);x[27]=l.i1616to32(b.currentVertex.x,b.currentVertex.y);x[28]=a.id;x[29]=a._fillColor;x[30]=d;x[31]=c;x[32]=a._tl;x[33]=a._br;x[34]=e;x[35]=l.i1616to32(31*
a._halfReferenceWidth,0);a.geometryBuf.writeRegion(x)}},B=function(a){return function(b){A[0]=b.leftExit0;A[1]=b.rightEntry0;A[2]=b.leftExit2;A[3]=b.rightEntry0;A[4]=b.rightEntry2;A[5]=b.leftExit2;a.indexCount+=6;a.indexBuf.writeRegion(A)}},G=function(a){return function(b,c,d,e,f,g,h,k,m){m=l.i1616to32(m,31*a._halfWidth);f=l.i8888to32(Math.round(31*f),Math.round(31*g),Math.round(31*h),Math.round(31*k));d=l.i8888to32(31*d,31*e,0,a._bitset);t[0]=l.i1616to32(b,c);t[1]=a.id;t[2]=a._fillColor;t[3]=f;t[4]=
m;t[5]=a._tl;t[6]=a._br;t[7]=d;t[8]=l.i1616to32(31*a._halfReferenceWidth,0);a.geometryBuf.writeRegion(t);return a.offset+a.vertexCount++}},F=function(a){return function(b,c,d){z[0]=b;z[1]=c;z[2]=d;a.indexCount+=3;a.indexBuf.writeRegion(z)}};a.default=function(a){return function(a){function f(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,
indexCount:null,geometryBuf:null,vertexCount:null,offset:null};b._tessellationOptions={};b.geometryType=g.WGLGeometryType.LINE;return b}m(f,a);f.prototype.writeMesh=function(a,c,d,e,f){var g=c.indexVector,h=c.get("geometry"),l=new b(e,this.geometryType,this._materialKey);c=c.getVector("geometry").vertexCount;l.vertexFrom=c;l.indexFrom=g.length;switch(d){case "esriGeometryPolyline":d=this._clipLines(f.geometry.paths);if(0===d.length)break;this._write(l,g,h,c,e,d);a.push(l);break;case "esriGeometryPolygon":d=
this._clipLines(f.geometry.rings);if(0===d.length)break;this._write(l,g,h,c,e,d);a.push(l);break;default:p.error("Unable to handle geometryType: "+d)}};f.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],f=a[d];w.reset(2);var g=f[0],h=g[0],g=g[1];if(c)w.moveTo(h,g);else{if(-16>h||h>q||-16>g||g>q){c=!0;continue}e.push({x:h,y:g})}for(var l=!1,k=f.length,m=1;m<k;++m)if(h+=f[m][0],g+=f[m][1],c)w.lineTo(h,g);else{if(-16>h||h>q||-16>g||g>q){l=!0;break}e.push({x:h,y:g})}if(l)c=
!0;else{if(c){if(e=w.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,start:0});d++;c=!1}}return b};f.prototype._write=function(a,b,d,e,f,g){var h;k("esri-tiles-performance")&&(h=performance.now());this.tessellationProperties.id=f;this.tessellationProperties.indexBuf=b;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=d;this.tessellationProperties.vertexCount=0;this.tessellationProperties.offset=e;for(b=0;b<g.length;b++)d=g[b],e=d.line,2>e.length||
(this._tessellationOptions.initialDistance=d.start%65535,this._tessellationCallbacks instanceof c.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),c.tessellate(e,this._tessellationOptions,this._tessellationCallbacks),c.cleanup(),k("esri-tiles-performance")&&y++);a.vertexCount=this.tessellationProperties.vertexCount;a.indexCount=this.tessellationProperties.indexCount;a.zOrder=this._zOrder;k("esri-tiles-performance")&&
(u+=(performance.now()-h)/1E3,v+=a.indexCount/3)};f.prototype._initializeTessellator=function(a){var b=e.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!a&&this.tessellationProperties._halfWidth<d.THIN_LINE_THRESHOLD/2&&!(b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=
r;this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=r;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:E(this.tessellationProperties),bridge:B(this.tessellationProperties)}:(a=new c.StandardTessellationCallbacks(G(this.tessellationProperties),F(this.tessellationProperties)),a.miterLimitCosine=this._miterLimitCosine,
a.textured=this._isDashed||this._hasPattern,a.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=a)};return f}(a)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function n(b,c,k,m,n,q,u,r,w,F,K,H,N,I,J,M,L,R){var t=a.call(this)||this;t.height=u;t.width=q;t.xOffset=c;t.yOffset=k;var v=l.vec2f32.create(),y=d.mat2df32.create();K=(I===f.Alignment.MAP?1:0)|(K?1:0)<<1|(N?1:0)<<2|(H?1:0)<<3;H=J&&J.sdf;h.mat2d.translate(y,y,l.vec2f32.fromValues(c,-k));m&&h.mat2d.rotate(y,y,3.14159265359/180*m);b=p.MarkerMaterialKey.load(p.createMaterialKey(t.geometryType,b,!1));
b.sdf=H;b.pattern=!0;b.textureBinding=J.textureBinding;t._materialKey=b.data;t._fillColor=n;t._outlineColor=w;t._sizeOutlineWidth=e.i8888to32(Math.round(Math.sqrt(256*q)),Math.round(Math.sqrt(256*u)),Math.round(Math.sqrt(256*F)),Math.round(Math.sqrt(256*r)));n=J.rect.x;r=J.rect.y;w=n+J.rect.width;F=r+J.rect.height;M=.5-((.5+M)*J.width+1)/J.rect.width;L=.5-((.5+L)*J.height+1)/J.rect.height;b=Math.round(Math.min(64*R,255));q*=J.rect.width/J.width*R;u*=J.rect.height/J.height*R;J=(M-.5)*q;L=(L-.5)*u;
t._bitestAndDistRatio=e.i8888to32(0,0,K,b);g.vec2.set(v,J,L);g.vec2.transformMat2d(v,v,y);t._offsetUpperLeft=e.i1616to32(16*v[0],16*v[1]);t._texUpperLeft=e.i1616to32(n,r);g.vec2.set(v,J+q,L);g.vec2.transformMat2d(v,v,y);t._offsetUpperRight=e.i1616to32(16*v[0],16*v[1]);t._texUpperRight=e.i1616to32(w,r);g.vec2.set(v,J,L+u);g.vec2.transformMat2d(v,v,y);t._offsetBottomLeft=e.i1616to32(16*v[0],16*v[1]);t._texBottomLeft=e.i1616to32(n,F);g.vec2.set(v,J+q,L+u);g.vec2.transformMat2d(v,v,y);t._offsetBottomRight=
e.i1616to32(16*v[0],16*v[1]);t._texBottomRight=e.i1616to32(w,F);return t}m(n,a);n.fromCIMMarker=function(a,b,d){var e=b.size,g=(d&&d.width||1)/(d&&d.height||1)*b.scaleX,h=b.scaleSymbolsProportionally&&b.frameHeight?e/b.frameHeight:1,l=c.premultiplyAlphaRGBA(b.color),m=c.premultiplyAlphaRGBA(b.outlineColor),p=k.pt2px(e),q=p*g,u=k.pt2px(b.offsetX||0),r=k.pt2px(b.offsetY||0),h=k.pt2px(b.outlineWidth||0)*h,w=b.alignment||f.Alignment.SCREEN,t=k.pt2px(b.referenceSize),v=b.rotation||0;b.rotateClockwise||
(v=-v);var y=0,L=0,R=b.anchorPoint;R&&(b.isAbsoluteAnchorPoint?e&&(y=-R.x/(e*g),L=R.y/e):(y=R.x,L=R.y));return new n(a,u,r,v,l,q,p,t,m,h,b.colorLocked,b.scaleSymbolsProportionally,!1,w,d,y,L,b.sizeRatio)};n.fromPictureMarker=function(a,c,d){var e=Math.round(k.pt2px(c.width)),g=Math.round(k.pt2px(c.height)),h=b.PICTURE_FILL_COLOR,l=Math.round(k.pt2px(c.xoffset||0)),m=Math.round(k.pt2px(c.yoffset||0));return new n(a,l,m,c.angle,h,e,g,g,0,0,!1,!1,!1,f.Alignment.SCREEN,d,0,0,1)};n.fromSimpleMarker=function(a,
b,d){var e=c.premultiplyAlphaRGBA(b.color),g=Math.round(k.pt2px(b.size)),h=Math.round(k.pt2px(b.xoffset||0)),l=Math.round(k.pt2px(b.yoffset||0)),m=b.style,p=b.outline,q=(p&&p.color&&c.premultiplyAlphaRGBA(p.color))|0,p=(p&&p.width&&Math.round(k.pt2px(p.width)))|0;return new n(a,h,l,b.angle,e,g,g,g,q,p,!1,!1,"cross"===m||"x"===m,f.Alignment.SCREEN,d,0,0,1.96875)};return n}(q.default(r.default));a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});var f=k.getLogger("esri.views.2d.engine.webgl.WGLMarkerTemplateBase");a.default=function(a){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.xOffset=0;b.yOffset=0;b.width=0;b.height=0;b.geometryType=h.WGLGeometryType.MARKER;return b}m(b,a);b.prototype.writeMesh=function(a,b,c,d,e){var h=l.MarkerMaterialKey.load(this._materialKey),k=b.indexVector,m=b.get("geometry"),
p=new g(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;a.push(p);p.vertexFrom=b;p.indexFrom=k.length;switch(c){case "esriGeometryPoint":c=e.geometry;a=c.x;c=c.y;this._writeVertices(p,m,d,this._getPos(a,c),h);this._writeIndices(p,k,b);break;case "esriGeometryPolyline":this._writeMany(p,k,m,b,d,e.geometry.paths[0],h);break;case "esriGeometryPolygon":(c=e.centroid)?(a=c.x,c=c.y,this._writeVertices(p,m,d,this._getPos(a,c),h),this._writeIndices(p,k,b)):f.error("Tried to render polygon geometries as markers, but found no centroid!");
break;case "esriGeometryMultipoint":this._writeMany(p,k,m,b,d,e.geometry.points,h);break;default:f.error("Unable to handle geometryType: "+c)}};b.prototype._getPos=function(a,b){return d.i1616to32(a,b)};b.prototype._writeMany=function(a,b,c,d,e,f,g){for(var h=0,l=0,k=0,m=0;m<f.length;m++){var p=f[m],n=p[0],p=p[1],q=this._getPos(n+h,p+l);this._writeVertices(a,c,e,q,g);this._writeIndices(a,b,d+k);h+=n;l+=p;k+=4}};b.prototype._writeVertices=function(a,b,c,d,e){b.push(d);b.push(this._offsetUpperLeft);
b.push(this._texUpperLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetUpperRight);b.push(this._texUpperRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomLeft);b.push(this._texBottomLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);
b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomRight);b.push(this._texBottomRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);a.vertexCount+=4};b.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return b}(a)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ../../../../../../symbols/support/defaults ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/BidiText ../../util/Lock ../../util/Result".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){function t(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}function x(a){return!!(a&1)}Object.defineProperty(a,"__esModule",{value:!0});var z=d.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),A=[];a.isDynamicId=x;n=function(){function a(a,b){this._templateIdCounter=this._idCounter=0;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=
new Map;this._cimAnalyses=[];this._lock=new v.default;this._fetchResource=a;this._joinOnUTurn=b}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"_textError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c,d){return m(this,void 0,void 0,function(){var e,f,g;return k(this,function(h){switch(h.label){case 0:return[4,this._initErrorTemplates()];case 1:h.sent();e=JSON.stringify(a);if(this._symbolToTemplate.has(e))return[2,this._symbolToTemplate.get(e)];f=[];return b?[4,this._createMeshTemplates(f,b,c,d,!0)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,this._createMeshTemplates(f,
a,c,d,!1)];case 4:return h.sent(),g=this._createGroupId("cim"===a.type),this._idToTemplateGroup.set(g,f),this._symbolToTemplate.set(e,g),[2,g]}})})};a.prototype.getCIMMosaicItem=function(a,b){var c=this,d=this._createTemplateId(),e=g.create(function(a){return c._idToResolver.set(d,a)});this._fetchQueue.push({symbol:a,id:d,glyphIds:b});return e};a.prototype.getTemplateGroup=function(a){return this._idToTemplateGroup.has(a)?this._idToTemplateGroup.get(a):A};a.prototype.getDynamicTemplateGroup=function(a){if(!this._idToTemplateGroup.has(a))return A;
x(a)||z.error("mapview-template-store","Id "+a+" does not refer to a dynamic template");return this._idToTemplateGroup.get(a)};a.prototype.finalize=function(a){return this._fetchQueue.length||this._lock.isHeld()?v.withLock(this._lock,this._fetchAllQueuedResources.bind(this),a):g.resolve()};a.prototype._initErrorTemplates=function(){return m(this,void 0,void 0,function(){var a,b,c,d;return k(this,function(e){switch(e.label){case 0:if(this._errorTemplates)return[2];a=this._createMeshTemplates([],f.errorPolygonSymbol2D,
null,null,!1);b=this._createMeshTemplates([],f.errorPointSymbol2D,null,null,!1);c=this._createMeshTemplates([],f.errorPolylineSymbol2D,null,null,!1);return[4,g.all([a,b,c])];case 1:return d=e.sent(),this._errorTemplates={fill:d[0],marker:d[1],line:d[2]},[2]}})})};a.prototype._fetchAllQueuedResources=function(a){var b=this;if(!this._fetchQueue.length)return g.resolve();var c=this._fetchQueue,d=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return g.all(d).then(function(){return b._fetchResource(c,
a).then(function(a){for(var c=0;c<a.length;c++){var d=a[c],e=d.id,d=d.mosaicItem;b._idToResolver.get(e)(d);b._idToResolver.delete(e)}})}).catch(function(a){g.isAbortError(a)?b._fetchQueue=b._fetchQueue.concat(c):z.error(new h("mapview-template-store","Unable to fetch requested texture resources",a))})};a.prototype._createGroupId=function(a){return this._idCounter++<<1|(a?1:0)};a.prototype._createTemplateId=function(){return this._templateIdCounter++};a.prototype._getCodepoints=function(a){a=u.bidiText(a.text)[0];
for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));return b};a.prototype._getMosaicItem=function(a){var b=this,c=this._createTemplateId(),d="text"===a.type&&this._getCodepoints(a),e=g.create(function(a){return b._idToResolver.set(c,a)});this._fetchQueue.push({symbol:a.toJSON(),id:c,glyphIds:d});return e};a.prototype._createSMS=function(a,b){return m(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,
y.ok(c,z)?[2,r.default.fromSimpleMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b){return m(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,y.ok(c,z)?[2,r.default.fromPictureMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createSFS=function(a,b,c){return m(this,void 0,void 0,function(){var d,e;return k(this,function(f){switch(f.label){case 0:return[4,
this._getMosaicItem(a)];case 1:return d=f.sent().spriteMosaicItem,e=a,y.ok(d,z)?[2,p.default.fromSimpleFill(b,e,d,c)]:[2,this._fillError]}})})};a.prototype._createPFS=function(a,b,c){return m(this,void 0,void 0,function(){var d,e;return k(this,function(f){switch(f.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=f.sent().spriteMosaicItem,e=a,y.ok(d,z)?[2,p.default.fromPictureFill(b,e,d,c)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,c){return m(this,void 0,void 0,function(){var d,
e;return k(this,function(f){switch(f.label){case 0:return[4,this._getMosaicItem(a)];case 1:return d=f.sent().spriteMosaicItem,e=a,y.ok(d,z)?[2,q.default.fromSimpleLine(b,c,e,d,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createTS=function(a,b){return m(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().glyphMosaicItems,[2,w.default.fromText(b,a,c)]}})})};a.prototype._createCIMText=function(a,
b){return m(this,void 0,void 0,function(){var c,d,f,h,l,m;return k(this,function(k){switch(k.label){case 0:if("function"===typeof a.materialHash)return[2,g.resolve(e.default.fromCIMText(b,a))];c=[];if(d=a.text)for(f=d.length,h=0;h<f;h++)l=d.charCodeAt(h),c.push(l);a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim,c)];case 1:return m=k.sent().glyphMosaicItems,y.ok(m,z)?[2,w.default.fromCIMText(b,a,m)]:[2,this._textError]}})})};a.prototype._createCIMFill=function(a,b){return m(this,
void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,y.ok(c,z)?[2,p.default.fromCIMFill(b,a,c,!1)]:[2,this._fillError]}})})};a.prototype._createCIMLine=function(a,b){return m(this,void 0,void 0,function(){var d;return k(this,function(e){switch(e.label){case 0:if("function"===typeof a.materialHash)return[2,g.resolve(c.default.fromCIMLine(b,a))];a.cim.mosaicHash=
a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return d=e.sent().spriteMosaicItem,y.ok(d,z)?[2,q.default.fromCIMLine(b,a,d,!1,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createCIMMarker=function(a,c){return m(this,void 0,void 0,function(){var d;return k(this,function(e){switch(e.label){case 0:if("function"===typeof a.materialHash)return[2,g.resolve(b.default.fromCIMMarker(c,a))];a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return d=e.sent().spriteMosaicItem,
y.ok(d,z)?[2,r.default.fromCIMMarker(c,a,d)]:[2,this._markerError]}})})};a.prototype._createCIM=function(a,b){return m(this,void 0,void 0,function(){var c,d,e=this;return k(this,function(f){c=a.templateHash;if(this._cimTemplateCache.has(c))return[2,this._cimTemplateCache.get(c)];switch(a.type){case "marker":d=this._createCIMMarker(a,b);break;case "line":d=this._createCIMLine(a,b);break;case "fill":d=this._createCIMFill(a,b);break;case "text":d=this._createCIMText(a,b)}d.then(function(a){return e._cimTemplateCache.set(c,
a)});return[2,d]})})};a.prototype._getCIMSymbolLayers=function(a,b,c){return m(this,void 0,void 0,function(){var d,e;return k(this,function(f){switch(f.label){case 0:return d=[],e=[],d.push(l.analyzeCIMSymbol(a.data,b,c,e)),[4,g.all(d)];case 1:return f.sent(),[2,e]}})})};a.prototype._createCIMMeshTemplates=function(a,b,c,d){return m(this,void 0,void 0,function(){var e,f,g,h,l,m,p;return k(this,function(k){switch(k.label){case 0:return f=(e=c)?e.fieldMap:null,g=b,[4,this._getCIMSymbolLayers(g,f,d)];
case 1:h=k.sent();l=0;for(m=h;l<m.length;l++)p=m[l],t(a,this._createCIM(p,c));return[2]}})})};a.prototype._createMeshTemplates=function(a,b,c,d,e){return m(this,void 0,void 0,function(){var f,g,h;return k(this,function(l){switch(l.label){case 0:if(-1!==b.type.indexOf("3d"))return z.error("3D symbols are not supported with MapView"),[2,a];f=b.type;switch(f){case "cim":return[3,1];case "simple-marker":return[3,3];case "picture-marker":return[3,4];case "simple-fill":return[3,5];case "picture-fill":return[3,
6];case "simple-line":return[3,7];case "text":return[3,8]}return[3,9];case 1:return[4,this._createCIMMeshTemplates(a,b,c,d)];case 2:return l.sent(),[2,a];case 3:return[2,t(a,this._createSMS(b,c))];case 4:return[2,t(a,this._createPMS(b,c))];case 5:return g=b,t(a,this._createSFS(g,c,e)),g.outline&&t(a,this._createSLS(g.outline,c,!0)),[2,a];case 6:return h=b,t(a,this._createPFS(h,c,e)),h.outline&&t(a,this._createSLS(h.outline,c,!0)),[2,a];case 7:return[2,t(a,this._createSLS(b,c,!1))];case 8:return[2,
t(a,this._createTS(b,c))];case 9:return z.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),[2,a]}})})};return a}();a.WGLTemplateStore=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(b,c){var e=a.call(this,c)||this;e._cimLineLayer=c;var g=0;f.isFunction(c.width)||(g=.5*k.pt2px(c.width));e._dynamicPropertyMap.set("_halfWidth",function(a,b,d){return f.isFunction(c.width)?.5*k.pt2px(c.width(a,b,d)):g});var m=h.CapType.ROUND;f.isFunction(c.cap)||(m=c.cap);e._dynamicPropertyMap.set("_capType",function(a,b,d){return f.isFunction(c.cap)?c.cap(a,b,d):m});var p;f.isFunction(c.join)||
(p=c.join);e._dynamicPropertyMap.set("_joinType",function(a,b,d){return f.isFunction(c.join)?c.join(a,b,d):p});var n;if(!f.isFunction(c.color)){var q=c.color;n=q&&d.premultiplyAlphaRGBA(q)||0}e._dynamicPropertyMap.set("_fillColor",function(a,b,e){return f.isFunction(c.color)?(a=c.color(a,b,e))&&d.premultiplyAlphaRGBA(a)||0:n});var r;f.isFunction(c.miterLimit)||(r=f.getLimitCosine(c.miterLimit));e._dynamicPropertyMap.set("_miterLimitCosine",function(a,b,d){return f.isFunction(c.miterLimit)?f.getLimitCosine(c.miterLimit(a,
b,d)):r});e._isDashed=c.isDashed;e.tessellationProperties._bitset=c.colorLocked?1:0;e._materialKey=l.createMaterialKey(e.geometryType,b,c.isOutline);e._initializeTessellator(!0);return e}m(b,a);b.fromCIMLine=function(a,c){return new b(a,c)};b.prototype.bindFeature=function(a,b,c){var d=this,f=this._dynamicPropertyMap;f&&f.forEach(function(e,f){d[f]=e(a,b,c)});var f=this._materialCache,h=this._cimLineLayer.materialHash,h=h(a,b,c),h=f.get(h),f=null;h&&e.ok(h.spriteMosaicItem)&&(f=h.spriteMosaicItem);
if(f){this._hasPattern=!0;var h=f.rect,k=h.x+1+f.width,m=h.y+1+f.height;this.tessellationProperties._tl=g.i1616to32(h.x+1,h.y+1);this.tessellationProperties._br=g.i1616to32(k,m)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;h=l.LineMaterialKey.load(this._materialKey);f&&(h.sdf=f.sdf,h.pattern=!0,h.textureBinding=f.textureBinding);this._materialKey=h.data};return b}(c.default(b.default));
a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l=k.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");n=function(a){function c(b){var c=a.call(this)||this;c._ongoingMaterialRequestMap=
new Map;c._materialCache=new Map;c._dynamicPropertyMap=new Map;c._cimLayer=b;return c}m(c,a);c.prototype.analyze=function(a,c,f,g){var b=this,e=this._materialCache,k=this._cimLayer.materialHash;if(!k)return l.error("A Dynamic mesh template must have a material hash function!"),h.reject(null);var m=k(c,f,g);if(e.has(m))return a=e.get(m),h.resolve(a);if(this._ongoingMaterialRequestMap.has(m))return this._ongoingMaterialRequestMap.get(m);c=d.analyzeCIMResource(c,this._cimLayer.cim,this._cimLayer.materialOverrides);
c.mosaicHash=m;a=a.getCIMMosaicItem(c).then(function(a){b._ongoingMaterialRequestMap.delete(m);e.set(m,a);return a}).catch(function(a){b._ongoingMaterialRequestMap.delete(m);l.error(".analyze()",a.message);return null});this._ongoingMaterialRequestMap.set(m,a);return a};return c}(g.default);a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v){Object.defineProperty(a,"__esModule",{value:!0});var y=3.14159265359/180,t=c.vec2f32.create(),x=l.mat2df32.create(),z=h.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");n=function(a){function h(c,f){var g=a.call(this,f)||this;g._cimMarkerLayer=f;var h=0;r.isFunction(f.color)||(h=e.premultiplyAlphaRGBA(f.color));g._dynamicPropertyMap.set("_fillColor",function(a,b,c){return r.isFunction(f.color)?e.premultiplyAlphaRGBA(f.color(a,b,c)):h});
var l=0;r.isFunction(f.outlineColor)||(l=e.premultiplyAlphaRGBA(f.outlineColor));g._dynamicPropertyMap.set("_outlineColor",function(a,b,c){return r.isFunction(f.outlineColor)?e.premultiplyAlphaRGBA(f.outlineColor(a,b,c)):l});var k;r.isFunction(f.size)||(k=d.pt2px(f.size));g._dynamicPropertyMap.set("_size",function(a,b,c){return r.isFunction(f.size)?d.pt2px(f.size(a,b,c)):k});var m;r.isFunction(f.scaleX)||(m=f.scaleX);g._dynamicPropertyMap.set("_scaleX",function(a,b,c){return r.isFunction(f.scaleX)?
f.scaleX(a,b,c):m});var p;r.isFunction(f.offsetX)||(p=d.pt2px(f.offsetX));g._dynamicPropertyMap.set("xOffset",function(a,b,c){return r.isFunction(f.offsetX)?d.pt2px(f.offsetX(a,b,c)):p});var n;r.isFunction(f.offsetY)||(n=d.pt2px(f.offsetY));g._dynamicPropertyMap.set("yOffset",function(a,b,c){return r.isFunction(f.offsetY)?d.pt2px(f.offsetY(a,b,c)):n});var u;r.isFunction(f.outlineWidth)||(u=d.pt2px(f.outlineWidth));g._dynamicPropertyMap.set("_outlineWidth",function(a,b,c){return r.isFunction(f.outlineWidth)?
d.pt2px(f.outlineWidth(a,b,c)):u});var t;r.isFunction(f.rotation)||(t=f.rotation);g._dynamicPropertyMap.set("_angle",function(a,b,c){return r.isFunction(f.rotation)?f.rotation(a,b,c):t});g._bitSet=(f.alignment===b.Alignment.MAP?1:0)|(f.colorLocked?1:0)<<1|(f.scaleSymbolsProportionally?1:0)<<3;g._materialKey=q.createMaterialKey(g.geometryType,c,!1);return g}m(h,a);h.fromCIMMarker=function(a,b){return new h(a,b)};h.prototype.bindFeature=function(a,b,e){var h=this,l=this._dynamicPropertyMap;l&&l.forEach(function(c,
d){h[d]=c(a,b,e)});l=this._cimMarkerLayer.materialHash;l=l(a,b,e);if((l=this._materialCache.get(l))&&v.ok(l.spriteMosaicItem)&&l.spriteMosaicItem){var l=l.spriteMosaicItem,m=this._cimMarkerLayer.sizeRatio,n=l.width/l.height*this._scaleX,u=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,r=this._size,w=r*n,A=this.xOffset,B=this.yOffset,E=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/d.pt2px(this._cimMarkerLayer.frameHeight):1,F=this._outlineWidth*
E,G=d.pt2px(this._cimMarkerLayer.referenceSize),V=0,E=0,W=this._cimMarkerLayer.anchorPoint;W&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(V=-W.x/(this._size*n),E=W.y/this._size):(V=W.x,E=W.y));this._sizeOutlineWidth=p.i8888to32(Math.round(Math.sqrt(256*w)),Math.round(Math.sqrt(256*r)),Math.round(Math.sqrt(256*F)),Math.round(Math.sqrt(256*G)));g.mat2d.identity(x);g.mat2d.translate(x,x,c.vec2f32.fromValues(A,-B));u&&g.mat2d.rotate(x,x,y*u);n=l.rect.x;u=l.rect.y;A=n+l.rect.width;B=u+l.rect.height;
V=.5-((.5+V)*l.width+1)/l.rect.width;E=.5-((.5+E)*l.height+1)/l.rect.height;F=Math.round(64*m);w*=l.rect.width/l.width*m;r*=l.rect.height/l.height*m;m=(V-.5)*w;E=(E-.5)*r;this._bitestAndDistRatio=p.i8888to32(0,0,this._bitSet,F);f.vec2.set(t,m,E);f.vec2.transformMat2d(t,t,x);this._offsetUpperLeft=p.i1616to32(16*t[0],16*t[1]);this._texUpperLeft=p.i1616to32(n,u);f.vec2.set(t,m+w,E);f.vec2.transformMat2d(t,t,x);this._offsetUpperRight=p.i1616to32(16*t[0],16*t[1]);this._texUpperRight=p.i1616to32(A,u);f.vec2.set(t,
m,E+r);f.vec2.transformMat2d(t,t,x);this._offsetBottomLeft=p.i1616to32(16*t[0],16*t[1]);this._texBottomLeft=p.i1616to32(n,B);f.vec2.set(t,m+w,E+r);f.vec2.transformMat2d(t,t,x);this._offsetBottomRight=p.i1616to32(16*t[0],16*t[1]);this._texBottomRight=p.i1616to32(A,B);r=q.MarkerMaterialKey.load(this._materialKey);r.sdf=l.sdf;r.pattern=!0;r.textureBinding=l.textureBinding;this._materialKey=r.data}else z.error(new k("mapview-cim","Encountered an error when binding feature"))};return h}(w.default(u.default));
a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../util/BidiText".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});var p=new Set;n=function(a){function b(b,c){var e=a.call(this,
c)||this;e._horizontalAlignment="center";e._verticalAlignment="middle";e._glyphs=[];e._cimTextLayer=c;var h=0;f.isFunction(c.color)||(h=d.premultiplyAlphaRGBA(c.color));e._dynamicPropertyMap.set("_color",function(a,b,e){return f.isFunction(c.color)?d.premultiplyAlphaRGBA(c.color(a,b,e)):h});var m=0;f.isFunction(c.color)||(m=d.premultiplyAlphaRGBA(c.outlineColor));e._dynamicPropertyMap.set("_haloColor",function(a,b,e){return f.isFunction(c.outlineColor)?d.premultiplyAlphaRGBA(c.outlineColor(a,b,e)):
m});var p;f.isFunction(c.size)||(p=Math.min(Math.round(k.pt2px(c.size*c.sizeRatio)),127));e._dynamicPropertyMap.set("_size",function(a,b,d){return f.isFunction(c.size)?Math.min(Math.round(k.pt2px(c.size(a,b,d)*c.sizeRatio)),127):p});var n;f.isFunction(c.outlineSize)||(n=Math.min(Math.floor(5*k.pt2px(c.outlineSize*c.sizeRatio)),127));e._dynamicPropertyMap.set("_haloSize",function(a,b,d){return f.isFunction(c.outlineSize)?Math.min(Math.floor(5*k.pt2px(c.outlineSize(a,b,d)*c.sizeRatio)),127):n});var q;
f.isFunction(c.offsetX)||(q=Math.round(k.pt2px(c.offsetX*c.sizeRatio)));e._dynamicPropertyMap.set("_xOffset",function(a,b,d){return f.isFunction(c.offsetX)?Math.round(k.pt2px(c.offsetX(a,b,d)*c.sizeRatio)):q});var u;f.isFunction(c.offsetY)||(u=Math.round(k.pt2px(c.offsetY*c.sizeRatio)));e._dynamicPropertyMap.set("_yOffset",function(a,b,d){return f.isFunction(c.offsetY)?Math.round(k.pt2px(c.offsetY(a,b,d)*c.sizeRatio)):u});var r;f.isFunction(c.decoration)||(r=g.getFontDecorationTop(c.decoration));
e._dynamicPropertyMap.set("_decorationTop",function(a,b,d){return f.isFunction(c.decoration)?g.getFontDecorationTop(c.decoration(a,b,d)):r});var w;f.isFunction(c.angle)||(w=c.angle);e._dynamicPropertyMap.set("_angle",function(a,b,d){return f.isFunction(c.angle)?c.angle(a,b,d):w});var F;f.isFunction(c.horizontalAlignment)||(F=c.horizontalAlignment);e._dynamicPropertyMap.set("_horizontalAlignment",function(a,b,d){return f.isFunction(c.horizontalAlignment)?c.horizontalAlignment(a,b,d):F});var K;f.isFunction(c.verticalAlignment)||
(K=c.verticalAlignment);e._dynamicPropertyMap.set("_verticalAlignment",function(a,b,d){return f.isFunction(c.verticalAlignment)?c.verticalAlignment(a,b,d):K});var H;f.isFunction(c.text)||(H=c.text);e._dynamicPropertyMap.set("_text",function(a,b,d){return f.isFunction(c.text)?c.text(a,b,d):H});var N=Math.min(Math.round(k.pt2px(c.referenceSize*c.sizeRatio)),127);e._referenceSize=Math.round(Math.sqrt(256*N));e._materialKey=l.createMaterialKey(e.geometryType,b,!1);b=l.TextMaterialKey.load(e._materialKey);
b.sdf=!0;e._bitset=c.colorLocked?1:0;e._materialKey=b.data;return e}m(b,a);b.fromCIMText=function(a,c){return new b(a,c)};b.prototype.analyze=function(a,b,c,d){var e=this._cimTextLayer;b="string"===typeof e.text?e.text:"function"===typeof e.text?e.text(b,c,d):"";var f=this._glyphs;p.clear();for(c=0;c<b.length;c++)p.add(b.charCodeAt(c));var g=[];p.forEach(function(a){if(f.length<a||void 0===f[a])g[a]=a});return a.getCIMMosaicItem(e.cim,g).then(function(a){if(a.glyphMosaicItems&&0<a.glyphMosaicItems.length)for(var b=
a.glyphMosaicItems,c=0;c<b.length;c++)void 0!==b[c]&&(f[c]=b[c]);return a})};b.prototype.bindFeature=function(a,b,c){var d=this,f=this._dynamicPropertyMap;f&&f.forEach(function(e,f){d[f]=e(a,b,c)});if(this._text&&0!==this._text.length){this._scale=this._size/24;this._justify=h.getJustification(this._horizontalAlignment||"center");this._xAlignD=h.getXAnchorDirection(this._horizontalAlignment||"center");this._yAlignD=-h.getYAnchorDirection(this._verticalAlignment||"baseline");this._baseline="baseline"===
(this._verticalAlignment||"baseline");for(var f=this._glyphs,g=e.bidiText(this._text),l=g[0],g=g[1],k=[],m=0;m<l.length;m++)k[l.charCodeAt(m)]=f[l.charCodeAt(m)];this.bindTextInfo(k,l,g);this._computeGlyphs(this._shapedGlyphs,this._shapedBox)}else this._shapedBox=this._shapedGlyphs=this._computedGlyphs=null};return b}(c.default(b.default));a.default=n})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../../../../../core/libs/earcut/earcut ../../color ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator ./WGLMeshTemplate".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){Object.defineProperty(a,"__esModule",{value:!0});var u=k.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),v=[],y=[];n=function(a){function k(b,d,g,h,l,k,m,p,n){var u=a.call(this)||this;u.fillColor=g;u.tl=h;u.br=l;u.aux1=k;u.aux2=m;u.aux3=p;u.isBFS=n;u.geometryType=c.WGLGeometryType.FILL;u.forceLibtess=!1;b=q.FillMaterialKey.load(q.createMaterialKey(u.geometryType,b,!1));d&&(b.sdf=d.sdf,b.pattern=!0,b.textureBinding=d.textureBinding);
u._materialKey=b.data;u._tesselator=new r.default;u._tileClipper=new e.TileClipper(0,0,0,1,8);u._tileClipper.setExtent(f.TILE_SIZE);return u}m(k,a);k.fromCIMFill=function(a,c,e,f){void 0===f&&(f=!1);var g=c.color,g=g&&l.premultiplyAlphaRGBA(g)||0,m=b.i8888to32(0,0,0,c.colorLocked?1:0);if(!e)return new k(a,null,g,0,0,0,0,m,f);var m=e.rect,p=e.width,n=e.height,q=m.x+1,u=m.y+1,r=q+p,w=u+n,m=h.nextHighestPowerOfTwo(d.pt2px(c.height||0));255<m?m=255:0>=m&&(m=h.nextHighestPowerOfTwo(w-u));p=h.nextHighestPowerOfTwo(d.pt2px(c.height/
n*p||0));255<p?p=255:0>=p&&(p=h.nextHighestPowerOfTwo(r-q));n=d.pt2px(c.offsetX||0)+128;255<n&&(n=255);var t=d.pt2px(-c.offsetY||0)+128;255<t&&(t=255);c=c.scaleX||1;q=b.i1616to32(q,u);r=b.i1616to32(r,w);m=b.i8888to32(p,m,n,t);c=b.i1616to32(128*c,128);return new k(a,e,g,q,r,m,c,0,f)};k.fromSimpleFill=function(a,c,d,e){void 0===e&&(e=!1);var f=c.color;c=f&&"none"!==c.style&&l.premultiplyAlphaRGBA(f)||0;f=b.i8888to32(0,0,0,e?255:0);if(!d)return new k(a,null,c,0,0,0,0,f,e);var g=d.rect,m=g.x+1,p=g.y+
1,n=g.x+1+d.width,q=g.y+1+d.height,g=b.i1616to32(m,p),u=b.i1616to32(n,q),m=b.i8888to32(h.nextHighestPowerOfTwo(n-m),h.nextHighestPowerOfTwo(q-p),0,0),p=b.i1616to32(128,128);return new k(a,d,c,g,u,m,p,f,e)};k.fromPictureFill=function(a,c,e,g){void 0===g&&(g=!1);var l=f.PICTURE_FILL_COLOR,m=e.rect,p=m.x+1,n=m.y+1,m=p+e.width,q=n+e.height,p=b.i1616to32(p,n),m=b.i1616to32(m,q),q=h.nextHighestPowerOfTwo(d.pt2px(c.width));255<q&&(q=255);n=h.nextHighestPowerOfTwo(d.pt2px(c.height));255<n&&(n=255);var u=
d.pt2px(c.xoffset)+128;255<u&&(u=255);var r=d.pt2px(-c.yoffset)+128;255<r&&(r=255);q=b.i8888to32(q,n,u,r);c=b.i1616to32(128*c.xscale,128*c.yscale);n=b.i8888to32(0,0,0,g?255:0);return new k(a,e,l,p,m,q,c,n,g)};k.prototype.writeMesh=function(a,b,c,d,e){v.length=0;if("esriGeometryPolygon"!==c)"esriGeometryPolyline"!==c&&u.error("Unable to handle geometryType: "+c);else{var f=e.geometry;c=q.FillMaterialKey.load(this._materialKey);var g=(e=this._isClippingRequired(f))?this._clip(f,!1):f.rings;if(c.dotDensity){for(var f=
f.rings,h=0,l=0;l<f.length;l++)for(var k=f[l],m=k[0],p=m[0],m=m[1],n=1;n<k.length;n++)var r=k[n],w=p+r[0],r=m+r[1],h=h-(w-p)*(r+m)/2,p=w,m=r;f=h}else f=0;this.forceLibtess?this._writeMeshLibtess(a,b,d,g,e,c,f):this._writeMeshEarcut(a,b,d,g,e,c,f)||this._writeMeshLibtess(a,b,d,g,e,c,f)}};k.prototype._isClippingRequired=function(a){var b=f.TILE_SIZE+8,c=0;for(a=a.rings;c<a.length;c++){var d=a[c],e=d.length;if(!(3>e)){var g=d[0][0],h=d[0][1];if(-8>g||g>b||-8>h||h>b)return!0;for(var l=1;l<e;++l)if(g+=
d[l][0],h+=d[l][1],-8>g||g>b||-8>h||h>b)return!0}}return!1};k.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var f=e[d],g=f.length;if(!(3>g)){a=f[0][0];c=f[0][1];this._tileClipper.moveTo(a,c);for(var h=1;h<g;++h)a+=f[h][0],c+=f[h][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};k.prototype._writeMeshLibtess=function(a,b,c,d,e,f,g){if(d&&d.length){var h=[],l=b.indexVector;b=b.getVector("geometry");
var k=new p(c,this.geometryType,this._materialKey),m=b.vertexCount;k.vertexFrom=m;k.indexFrom=l.length;this._tesselator.beginPolygon(v,h);for(var n=0;n<d.length;n++){var q=d[n];if(!(3>q.length)){this._tesselator.beginContour();var u=void 0,r=void 0;e?(u=q[0].x,r=q[0].y):(u=q[0][0],r=q[0][1]);var w=[u,r,0];this._tesselator.addVertex(w,w);for(w=1;w<q.length-1;w++){var t=void 0,y=void 0;e?(u=q[w].x,r=q[w].y):(t=q[w][0],y=q[w][1],u+=t,r+=y);t=[u,r,0];this._tesselator.addVertex(t,t)}this._tesselator.endContour()}}this._tesselator.endPolygon();
this._writeVerticesLibTess(k,b,c,v,f,g);this._writeIndicesLibTess(k,l,m,h);0<k.indexCount&&a.push(k)}};k.prototype._writeMeshEarcut=function(a,b,c,d,e,f,g){if(d&&d.length){var h=b.indexVector;b=b.getVector("geometry");var l=new p(c,this.geometryType,this._materialKey),k=h.length,m=b.data.length;l.vertexFrom=b.vertexCount;l.indexFrom=h.length;for(var n=0,q=0,u=0;u<d.length;u++){var r=d[u],w=q,t=void 0,x=void 0;e?(t=r[0].x,x=r[0].y):(t=r[0][0],x=r[0][1]);v[q++]=t;v[q++]=x;for(var z=0,A=1;A<r.length;++A){var B=
void 0,E=void 0;e?(B=t,E=x,t=r[A].x,x=r[A].y,B=t-B,E=x-E):(B=r[A][0],E=r[A][1],t+=B,x+=E);z-=B*(x+x-E);v[q++]=t;v[q++]=x}if(0<z){if(0<w-n){if(!this._write(l,h,b,c,v,y,n,w,f,g))return h.seek(k),b.data.seek(m),v.length=y.length=0,!1;n=w}y.length=0}else 0>z?0<w-n?y.push(.5*(w-n)):q=w:q=w}if(0<q-n&&!this._write(l,h,b,c,v,y,n,q,f,g))return h.seek(k),b.data.seek(m),v.length=y.length=0,!1;v.length=y.length=0;a.push(l);return!0}};k.prototype._write=function(a,b,c,d,e,f,h,l,k,m){e=e.slice(h,l);h=g(e,f,2);
if(g.deviation(e,f,2,h))return!1;if(h.length)return f=c.vertexCount,this._writeVertices(a,c,d,e,k,m),this._writeIndices(a,b,f,h),!0};k.prototype._writeVertices=function(a,c,d,e,f,g){for(var h=0;h<e.length;h+=2){var l=b.i1616to32(e[h],e[h+1]);c.data.push(l);c.data.push(d);f.dotDensity?c.data.writeF32(1/g):(c.data.push(this.fillColor),c.data.push(this.tl),c.data.push(this.br),c.data.push(this.aux1),c.data.push(this.aux2),c.data.push(this.aux3));a.vertexCount++}};k.prototype._writeIndices=function(a,
b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};k.prototype._writeVerticesLibTess=function(a,c,d,e,f,g){for(var h=0;h<e.length;h+=2){var l=b.i1616to32(e[h],e[h+1]);c.data.push(l);c.data.push(d);f.dotDensity?c.data.writeF32(1/g):(c.data.push(this.fillColor),c.data.push(this.tl),c.data.push(this.br),c.data.push(this.aux1),c.data.push(this.aux2),c.data.push(this.aux3));a.vertexCount++}};k.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=
0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};return k}(w.default);a.default=n})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=m.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");n=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new k.GluTesselator;
this.glu.gluTessCallback(k.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));
this.glu.gluTessProperty(k.gluEnum.GLU_TESS_WINDING_RULE,k.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,d){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=d};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};
a.prototype.addVertex=function(a,d){this.glu.gluTessVertex(a,d)};a.prototype._vertexCallback=function(a,d){d[d.length]=a[0];d[d.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(a){this._triangleIndices[0]=
-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){h.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=function(a,d,f){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(a){};return a}();a.default=n})},"esri/core/libs/libtess/libtess":function(){define([],function(){var n={DEBUG:!1,assert:function(a,m){if(n.DEBUG&&!a)throw Error("Assertion failed"+
(m?": "+m:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,
GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,
GLU_INVALID_VALUE:100901},geom:{}};n.geom.vertEq=function(a,m){return a.s===m.s&&a.t===m.t};n.geom.vertLeq=function(a,m){return a.s<m.s||a.s===m.s&&a.t<=m.t};n.geom.edgeEval=function(a,m,k){n.assert(n.geom.vertLeq(a,m)&&n.geom.vertLeq(m,k));var h=m.s-a.s,d=k.s-m.s;return 0<h+d?h<d?m.t-a.t+h/(h+d)*(a.t-k.t):m.t-k.t+d/(h+d)*(k.t-a.t):0};n.geom.edgeSign=function(a,m,k){n.assert(n.geom.vertLeq(a,m)&&n.geom.vertLeq(m,k));var h=m.s-a.s,d=k.s-m.s;return 0<h+d?(m.t-k.t)*h+(m.t-a.t)*d:0};n.geom.transLeq=function(a,
m){return a.t<m.t||a.t===m.t&&a.s<=m.s};n.geom.transEval=function(a,m,k){n.assert(n.geom.transLeq(a,m)&&n.geom.transLeq(m,k));var h=m.t-a.t,d=k.t-m.t;return 0<h+d?h<d?m.s-a.s+h/(h+d)*(a.s-k.s):m.s-k.s+d/(h+d)*(k.s-a.s):0};n.geom.transSign=function(a,m,k){n.assert(n.geom.transLeq(a,m)&&n.geom.transLeq(m,k));var h=m.t-a.t,d=k.t-m.t;return 0<h+d?(m.s-k.s)*h+(m.s-a.s)*d:0};n.geom.edgeGoesLeft=function(a){return n.geom.vertLeq(a.dst(),a.org)};n.geom.edgeGoesRight=function(a){return n.geom.vertLeq(a.org,
a.dst())};n.geom.vertL1dist=function(a,m){return Math.abs(a.s-m.s)+Math.abs(a.t-m.t)};n.geom.vertCCW=function(a,m,k){return 0<=a.s*(m.t-k.t)+m.s*(k.t-a.t)+k.s*(a.t-m.t)};n.geom.interpolate_=function(a,m,k,h){a=0>a?0:a;k=0>k?0:k;return a<=k?0===k?(m+h)/2:m+a/(a+k)*(h-m):h+k/(a+k)*(m-h)};n.geom.edgeIntersect=function(a,m,k,h,d){var g,l;n.geom.vertLeq(a,m)||(g=a,a=m,m=g);n.geom.vertLeq(k,h)||(g=k,k=h,h=g);n.geom.vertLeq(a,k)||(g=a,a=k,k=g,g=m,m=h,h=g);n.geom.vertLeq(k,m)?n.geom.vertLeq(m,h)?(g=n.geom.edgeEval(a,
k,m),l=n.geom.edgeEval(k,m,h),0>g+l&&(g=-g,l=-l),d.s=n.geom.interpolate_(g,k.s,l,m.s)):(g=n.geom.edgeSign(a,k,m),l=-n.geom.edgeSign(a,h,m),0>g+l&&(g=-g,l=-l),d.s=n.geom.interpolate_(g,k.s,l,h.s)):d.s=(k.s+m.s)/2;n.geom.transLeq(a,m)||(g=a,a=m,m=g);n.geom.transLeq(k,h)||(g=k,k=h,h=g);n.geom.transLeq(a,k)||(g=a,a=k,k=g,g=m,m=h,h=g);n.geom.transLeq(k,m)?n.geom.transLeq(m,h)?(g=n.geom.transEval(a,k,m),l=n.geom.transEval(k,m,h),0>g+l&&(g=-g,l=-l),d.t=n.geom.interpolate_(g,k.t,l,m.t)):(g=n.geom.transSign(a,
k,m),l=-n.geom.transSign(a,h,m),0>g+l&&(g=-g,l=-l),d.t=n.geom.interpolate_(g,k.t,l,h.t)):d.t=(k.t+m.t)/2};n.mesh={};n.mesh.makeEdge=function(a){var m=n.mesh.makeEdgePair_(a.eHead);n.mesh.makeVertex_(m,a.vHead);n.mesh.makeVertex_(m.sym,a.vHead);n.mesh.makeFace_(m,a.fHead);return m};n.mesh.meshSplice=function(a,m){var k=!1,h=!1;a!==m&&(m.org!==a.org&&(h=!0,n.mesh.killVertex_(m.org,a.org)),m.lFace!==a.lFace&&(k=!0,n.mesh.killFace_(m.lFace,a.lFace)),n.mesh.splice_(m,a),h||(n.mesh.makeVertex_(m,a.org),
a.org.anEdge=a),k||(n.mesh.makeFace_(m,a.lFace),a.lFace.anEdge=a))};n.mesh.deleteEdge=function(a){var m=a.sym,k=!1;a.lFace!==a.rFace()&&(k=!0,n.mesh.killFace_(a.lFace,a.rFace()));a.oNext===a?n.mesh.killVertex_(a.org,null):(a.rFace().anEdge=a.oPrev(),a.org.anEdge=a.oNext,n.mesh.splice_(a,a.oPrev()),k||n.mesh.makeFace_(a,a.lFace));m.oNext===m?(n.mesh.killVertex_(m.org,null),n.mesh.killFace_(m.lFace,null)):(a.lFace.anEdge=m.oPrev(),m.org.anEdge=m.oNext,n.mesh.splice_(m,m.oPrev()));n.mesh.killEdge_(a)};
n.mesh.addEdgeVertex=function(a){var m=n.mesh.makeEdgePair_(a),k=m.sym;n.mesh.splice_(m,a.lNext);m.org=a.dst();n.mesh.makeVertex_(k,m.org);m.lFace=k.lFace=a.lFace;return m};n.mesh.splitEdge=function(a){var m=n.mesh.addEdgeVertex(a).sym;n.mesh.splice_(a.sym,a.sym.oPrev());n.mesh.splice_(a.sym,m);a.sym.org=m.org;m.dst().anEdge=m.sym;m.sym.lFace=a.rFace();m.winding=a.winding;m.sym.winding=a.sym.winding;return m};n.mesh.connect=function(a,m){var k=!1,h=n.mesh.makeEdgePair_(a),d=h.sym;m.lFace!==a.lFace&&
(k=!0,n.mesh.killFace_(m.lFace,a.lFace));n.mesh.splice_(h,a.lNext);n.mesh.splice_(d,m);h.org=a.dst();d.org=m.org;h.lFace=d.lFace=a.lFace;a.lFace.anEdge=d;k||n.mesh.makeFace_(h,a.lFace);return h};n.mesh.zapFace=function(a){var m=a.anEdge,k=m.lNext,h;do if(h=k,k=h.lNext,h.lFace=null,null===h.rFace()){h.oNext===h?n.mesh.killVertex_(h.org,null):(h.org.anEdge=h.oNext,n.mesh.splice_(h,h.oPrev()));var d=h.sym;d.oNext===d?n.mesh.killVertex_(d.org,null):(d.org.anEdge=d.oNext,n.mesh.splice_(d,d.oPrev()));n.mesh.killEdge_(h)}while(h!==
m);m=a.prev;a=a.next;a.prev=m;m.next=a};n.mesh.meshUnion=function(a,m){var k=a.fHead,h=a.vHead,d=a.eHead,g=m.fHead,l=m.vHead;m=m.eHead;g.next!==g&&(k.prev.next=g.next,g.next.prev=k.prev,g.prev.next=k,k.prev=g.prev);l.next!==l&&(h.prev.next=l.next,l.next.prev=h.prev,l.prev.next=h,h.prev=l.prev);m.next!==m&&(d.sym.next.sym.next=m.next,m.next.sym.next=d.sym.next,m.sym.next.sym.next=d,d.sym.next=m.sym.next);return a};n.mesh.deleteMesh=function(a){};n.mesh.makeEdgePair_=function(a){var m=new n.GluHalfEdge,
k=new n.GluHalfEdge,h=a.sym.next;k.next=h;h.sym.next=m;m.next=a;a.sym.next=k;m.sym=k;m.oNext=m;m.lNext=k;k.sym=m;k.oNext=k;return k.lNext=m};n.mesh.splice_=function(a,m){var k=a.oNext,h=m.oNext;k.sym.lNext=m;h.sym.lNext=a;a.oNext=h;m.oNext=k};n.mesh.makeVertex_=function(a,m){var k=m.prev,h=new n.GluVertex(m,k);k.next=h;m.prev=h;m=h.anEdge=a;do m.org=h,m=m.oNext;while(m!==a)};n.mesh.makeFace_=function(a,m){var k=m.prev,h=new n.GluFace(m,k);k.next=h;m.prev=h;h.anEdge=a;h.inside=m.inside;m=a;do m.lFace=
h,m=m.lNext;while(m!==a)};n.mesh.killEdge_=function(a){var m=a.next;a=a.sym.next;m.sym.next=a;a.sym.next=m};n.mesh.killVertex_=function(a,m){var k=a.anEdge,h=k;do h.org=m,h=h.oNext;while(h!==k);m=a.prev;a=a.next;a.prev=m;m.next=a};n.mesh.killFace_=function(a,m){var k=a.anEdge,h=k;do h.lFace=m,h=h.lNext;while(h!==k);m=a.prev;a=a.next;a.prev=m;m.next=a};n.normal={};n.normal.S_UNIT_X_=1;n.normal.S_UNIT_Y_=0;n.normal.projectPolygon=function(a,m,k,h){var d=!1,g=[m,k,h];0===m&&0===k&&0===h&&(n.normal.computeNormal_(a,
g),d=!0);k=n.normal.longAxis_(g);m=a.mesh.vHead;if(n.TRUE_PROJECT){n.normal.normalize_(g);h=[0,0,0];var l=[0,0,0];h[k]=0;h[(k+1)%3]=n.normal.S_UNIT_X_;h[(k+2)%3]=n.normal.S_UNIT_Y_;k=n.normal.dot_(h,g);h[0]-=k*g[0];h[1]-=k*g[1];h[2]-=k*g[2];n.normal.normalize_(h);l[0]=g[1]*h[2]-g[2]*h[1];l[1]=g[2]*h[0]-g[0]*h[2];l[2]=g[0]*h[1]-g[1]*h[0];n.normal.normalize_(l);for(g=m.next;g!==m;g=g.next)g.s=n.normal.dot_(g.coords,h),g.t=n.normal.dot_(g.coords,l)}else for(h=(k+1)%3,l=(k+2)%3,k=0<g[k]?1:-1,g=m.next;g!==
m;g=g.next)g.s=g.coords[h],g.t=k*g.coords[l];d&&n.normal.checkOrientation_(a)};n.normal.dot_=function(a,m){return a[0]*m[0]+a[1]*m[1]+a[2]*m[2]};n.normal.normalize_=function(a){var m=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];n.assert(0<m);m=Math.sqrt(m);a[0]/=m;a[1]/=m;a[2]/=m};n.normal.longAxis_=function(a){var m=0;Math.abs(a[1])>Math.abs(a[0])&&(m=1);Math.abs(a[2])>Math.abs(a[m])&&(m=2);return m};n.normal.computeNormal_=function(a,m){var k=[-2*n.GLU_TESS_MAX_COORD,-2*n.GLU_TESS_MAX_COORD,-2*n.GLU_TESS_MAX_COORD],
h=[2*n.GLU_TESS_MAX_COORD,2*n.GLU_TESS_MAX_COORD,2*n.GLU_TESS_MAX_COORD],d=[],g=[],l;a=a.mesh.vHead;for(l=a.next;l!==a;l=l.next)for(var f=0;3>f;++f){var c=l.coords[f];c<h[f]&&(h[f]=c,g[f]=l);c>k[f]&&(k[f]=c,d[f]=l)}l=0;k[1]-h[1]>k[0]-h[0]&&(l=1);k[2]-h[2]>k[l]-h[l]&&(l=2);if(h[l]>=k[l])m[0]=0,m[1]=0,m[2]=1;else{k=0;h=g[l];d=d[l];g=[0,0,0];h=[h.coords[0]-d.coords[0],h.coords[1]-d.coords[1],h.coords[2]-d.coords[2]];f=[0,0,0];for(l=a.next;l!==a;l=l.next)f[0]=l.coords[0]-d.coords[0],f[1]=l.coords[1]-
d.coords[1],f[2]=l.coords[2]-d.coords[2],g[0]=h[1]*f[2]-h[2]*f[1],g[1]=h[2]*f[0]-h[0]*f[2],g[2]=h[0]*f[1]-h[1]*f[0],c=g[0]*g[0]+g[1]*g[1]+g[2]*g[2],c>k&&(k=c,m[0]=g[0],m[1]=g[1],m[2]=g[2]);0>=k&&(m[0]=m[1]=m[2]=0,m[n.normal.longAxis_(h)]=1)}};n.normal.checkOrientation_=function(a){for(var m=0,k=a.mesh.fHead,h=k.next;h!==k;h=h.next){var d=h.anEdge;if(!(0>=d.winding)){do m+=(d.org.s-d.dst().s)*(d.org.t+d.dst().t),d=d.lNext;while(d!==h.anEdge)}}if(0>m)for(a=a.mesh.vHead,m=a.next;m!==a;m=m.next)m.t=-m.t};
n.render={};n.render.renderMesh=function(a,m,k){for(var h=!1,d=-1,g=m.fHead.prev;g!==m.fHead;g=g.prev)if(g.inside){h||(a.callBeginCallback(n.primitiveType.GL_TRIANGLES),h=!0);var l=g.anEdge;n.assert(l.lNext.lNext.lNext===l,"renderMesh called with non-triangulated mesh");do{if(k){var f=l.rFace().inside?0:1;d!==f&&(d=f,a.callEdgeFlagCallback(!!d))}a.callVertexCallback(l.org.data);l=l.lNext}while(l!==g.anEdge)}h&&a.callEndCallback()};n.render.renderBoundary=function(a,m){for(var k=m.fHead.next;k!==m.fHead;k=
k.next)if(k.inside){a.callBeginCallback(n.primitiveType.GL_LINE_LOOP);var h=k.anEdge;do a.callVertexCallback(h.org.data),h=h.lNext;while(h!==k.anEdge);a.callEndCallback()}};n.sweep={};n.sweep.SENTINEL_COORD_=4*n.GLU_TESS_MAX_COORD;n.sweep.TOLERANCE_NONZERO_=!1;n.sweep.computeInterior=function(a){a.fatalError=!1;n.sweep.removeDegenerateEdges_(a);n.sweep.initPriorityQ_(a);n.sweep.initEdgeDict_(a);for(var m;null!==(m=a.pq.extractMin());){for(;;){var k=a.pq.minimum();if(null===k||!n.geom.vertEq(k,m))break;
k=a.pq.extractMin();n.sweep.spliceMergeVertices_(a,m.anEdge,k.anEdge)}n.sweep.sweepEvent_(a,m)}m=a.dict.getMin().getKey();a.event=m.eUp.org;n.sweep.doneEdgeDict_(a);n.sweep.donePriorityQ_(a);n.sweep.removeDegenerateFaces_(a.mesh);a.mesh.checkMesh()};n.sweep.addWinding_=function(a,m){a.winding+=m.winding;a.sym.winding+=m.sym.winding};n.sweep.edgeLeq_=function(a,m,k){a=a.event;m=m.eUp;k=k.eUp;if(m.dst()===a)return k.dst()===a?n.geom.vertLeq(m.org,k.org)?0>=n.geom.edgeSign(k.dst(),m.org,k.org):0<=n.geom.edgeSign(m.dst(),
k.org,m.org):0>=n.geom.edgeSign(k.dst(),a,k.org);if(k.dst()===a)return 0<=n.geom.edgeSign(m.dst(),a,m.org);m=n.geom.edgeEval(m.dst(),a,m.org);a=n.geom.edgeEval(k.dst(),a,k.org);return m>=a};n.sweep.deleteRegion_=function(a,m){m.fixUpperEdge&&n.assert(0===m.eUp.winding);m.eUp.activeRegion=null;a.dict.deleteNode(m.nodeUp);m.nodeUp=null};n.sweep.fixUpperEdge_=function(a,m){n.assert(a.fixUpperEdge);n.mesh.deleteEdge(a.eUp);a.fixUpperEdge=!1;a.eUp=m;m.activeRegion=a};n.sweep.topLeftRegion_=function(a){var m=
a.eUp.org;do a=a.regionAbove();while(a.eUp.org===m);a.fixUpperEdge&&(m=n.mesh.connect(a.regionBelow().eUp.sym,a.eUp.lNext),n.sweep.fixUpperEdge_(a,m),a=a.regionAbove());return a};n.sweep.topRightRegion_=function(a){var m=a.eUp.dst();do a=a.regionAbove();while(a.eUp.dst()===m);return a};n.sweep.addRegionBelow_=function(a,m,k){var h=new n.ActiveRegion;h.eUp=k;h.nodeUp=a.dict.insertBefore(m.nodeUp,h);return k.activeRegion=h};n.sweep.isWindingInside_=function(a,m){switch(a.windingRule){case n.windingRule.GLU_TESS_WINDING_ODD:return 0!==
(m&1);case n.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==m;case n.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<m;case n.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>m;case n.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=m||-2>=m}n.assert(!1);return!1};n.sweep.computeWinding_=function(a,m){m.windingNumber=m.regionAbove().windingNumber+m.eUp.winding;m.inside=n.sweep.isWindingInside_(a,m.windingNumber)};n.sweep.finishRegion_=function(a,m){var k=m.eUp,h=k.lFace;h.inside=m.inside;h.anEdge=
k;n.sweep.deleteRegion_(a,m)};n.sweep.finishLeftRegions_=function(a,m,k){var h=m;for(m=m.eUp;h!==k;){h.fixUpperEdge=!1;var d=h.regionBelow(),g=d.eUp;if(g.org!==m.org){if(!d.fixUpperEdge){n.sweep.finishRegion_(a,h);break}g=n.mesh.connect(m.lPrev(),g.sym);n.sweep.fixUpperEdge_(d,g)}m.oNext!==g&&(n.mesh.meshSplice(g.oPrev(),g),n.mesh.meshSplice(m,g));n.sweep.finishRegion_(a,h);m=d.eUp;h=d}return m};n.sweep.addRightEdges_=function(a,m,k,h,d,g){var l=!0;do n.assert(n.geom.vertLeq(k.org,k.dst())),n.sweep.addRegionBelow_(a,
m,k.sym),k=k.oNext;while(k!==h);for(null===d&&(d=m.regionBelow().eUp.rPrev());;){h=m.regionBelow();k=h.eUp.sym;if(k.org!==d.org)break;k.oNext!==d&&(n.mesh.meshSplice(k.oPrev(),k),n.mesh.meshSplice(d.oPrev(),k));h.windingNumber=m.windingNumber-k.winding;h.inside=n.sweep.isWindingInside_(a,h.windingNumber);m.dirty=!0;!l&&n.sweep.checkForRightSplice_(a,m)&&(n.sweep.addWinding_(k,d),n.sweep.deleteRegion_(a,m),n.mesh.deleteEdge(d));l=!1;m=h;d=k}m.dirty=!0;n.assert(m.windingNumber-k.winding===h.windingNumber);
g&&n.sweep.walkDirtyRegions_(a,m)};n.sweep.callCombine_=function(a,m,k,h,d){var g=[m.coords[0],m.coords[1],m.coords[2]];m.data=null;m.data=a.callCombineCallback(g,k,h);null===m.data&&(d?a.fatalError||(a.callErrorCallback(n.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),a.fatalError=!0):m.data=k[0])};n.sweep.spliceMergeVertices_=function(a,m,k){var h=[null,null,null,null];h[0]=m.org.data;h[1]=k.org.data;n.sweep.callCombine_(a,m.org,h,[.5,.5,0,0],!1);n.mesh.meshSplice(m,k)};n.sweep.vertexWeights_=function(a,
m,k,h,d){var g=n.geom.vertL1dist(m,a),l=n.geom.vertL1dist(k,a),f=d+1;h[d]=.5*l/(g+l);h[f]=.5*g/(g+l);a.coords[0]+=h[d]*m.coords[0]+h[f]*k.coords[0];a.coords[1]+=h[d]*m.coords[1]+h[f]*k.coords[1];a.coords[2]+=h[d]*m.coords[2]+h[f]*k.coords[2]};n.sweep.getIntersectData_=function(a,m,k,h,d,g){var l=[0,0,0,0],f=[k.data,h.data,d.data,g.data];m.coords[0]=m.coords[1]=m.coords[2]=0;n.sweep.vertexWeights_(m,k,h,l,0);n.sweep.vertexWeights_(m,d,g,l,2);n.sweep.callCombine_(a,m,f,l,!0)};n.sweep.checkForRightSplice_=
function(a,m){var k=m.regionBelow(),h=m.eUp,d=k.eUp;if(n.geom.vertLeq(h.org,d.org)){if(0<n.geom.edgeSign(d.dst(),h.org,d.org))return!1;n.geom.vertEq(h.org,d.org)?h.org!==d.org&&(a.pq.remove(h.org.pqHandle),n.sweep.spliceMergeVertices_(a,d.oPrev(),h)):(n.mesh.splitEdge(d.sym),n.mesh.meshSplice(h,d.oPrev()),m.dirty=k.dirty=!0)}else{if(0>n.geom.edgeSign(h.dst(),d.org,h.org))return!1;m.regionAbove().dirty=m.dirty=!0;n.mesh.splitEdge(h.sym);n.mesh.meshSplice(d.oPrev(),h)}return!0};n.sweep.checkForLeftSplice_=
function(a,m){var k=m.regionBelow();a=m.eUp;var h=k.eUp;n.assert(!n.geom.vertEq(a.dst(),h.dst()));if(n.geom.vertLeq(a.dst(),h.dst())){if(0>n.geom.edgeSign(a.dst(),h.dst(),a.org))return!1;m.regionAbove().dirty=m.dirty=!0;k=n.mesh.splitEdge(a);n.mesh.meshSplice(h.sym,k);k.lFace.inside=m.inside}else{if(0<n.geom.edgeSign(h.dst(),a.dst(),h.org))return!1;m.dirty=k.dirty=!0;k=n.mesh.splitEdge(h);n.mesh.meshSplice(a.lNext,h.sym);k.rFace().inside=m.inside}return!0};n.sweep.checkForIntersect_=function(a,m){var k=
m.regionBelow(),h=m.eUp,d=k.eUp,g=h.org,l=d.org,f=h.dst(),c=d.dst(),b=new n.GluVertex;n.assert(!n.geom.vertEq(c,f));n.assert(0>=n.geom.edgeSign(f,a.event,g));n.assert(0<=n.geom.edgeSign(c,a.event,l));n.assert(g!==a.event&&l!==a.event);n.assert(!m.fixUpperEdge&&!k.fixUpperEdge);if(g===l||Math.min(g.t,f.t)>Math.max(l.t,c.t))return!1;if(n.geom.vertLeq(g,l)){if(0<n.geom.edgeSign(c,g,l))return!1}else if(0>n.geom.edgeSign(f,l,g))return!1;n.geom.edgeIntersect(f,g,c,l,b);n.assert(Math.min(g.t,f.t)<=b.t);
n.assert(b.t<=Math.max(l.t,c.t));n.assert(Math.min(c.s,f.s)<=b.s);n.assert(b.s<=Math.max(l.s,g.s));n.geom.vertLeq(b,a.event)&&(b.s=a.event.s,b.t=a.event.t);var e=n.geom.vertLeq(g,l)?g:l;n.geom.vertLeq(e,b)&&(b.s=e.s,b.t=e.t);if(n.geom.vertEq(b,g)||n.geom.vertEq(b,l))return n.sweep.checkForRightSplice_(a,m),!1;if(!n.geom.vertEq(f,a.event)&&0<=n.geom.edgeSign(f,a.event,b)||!n.geom.vertEq(c,a.event)&&0>=n.geom.edgeSign(c,a.event,b)){if(c===a.event)return n.mesh.splitEdge(h.sym),n.mesh.meshSplice(d.sym,
h),m=n.sweep.topLeftRegion_(m),h=m.regionBelow().eUp,n.sweep.finishLeftRegions_(a,m.regionBelow(),k),n.sweep.addRightEdges_(a,m,h.oPrev(),h,h,!0),!0;if(f===a.event)return n.mesh.splitEdge(d.sym),n.mesh.meshSplice(h.lNext,d.oPrev()),k=m,m=n.sweep.topRightRegion_(m),g=m.regionBelow().eUp.rPrev(),k.eUp=d.oPrev(),d=n.sweep.finishLeftRegions_(a,k,null),n.sweep.addRightEdges_(a,m,d.oNext,h.rPrev(),g,!0),!0;0<=n.geom.edgeSign(f,a.event,b)&&(m.regionAbove().dirty=m.dirty=!0,n.mesh.splitEdge(h.sym),h.org.s=
a.event.s,h.org.t=a.event.t);0>=n.geom.edgeSign(c,a.event,b)&&(m.dirty=k.dirty=!0,n.mesh.splitEdge(d.sym),d.org.s=a.event.s,d.org.t=a.event.t);return!1}n.mesh.splitEdge(h.sym);n.mesh.splitEdge(d.sym);n.mesh.meshSplice(d.oPrev(),h);h.org.s=b.s;h.org.t=b.t;h.org.pqHandle=a.pq.insert(h.org);n.sweep.getIntersectData_(a,h.org,g,f,l,c);m.regionAbove().dirty=m.dirty=k.dirty=!0;return!1};n.sweep.walkDirtyRegions_=function(a,m){for(var k=m.regionBelow();;){for(;k.dirty;)m=k,k=k.regionBelow();if(!m.dirty&&
(k=m,m=m.regionAbove(),null===m||!m.dirty))break;m.dirty=!1;var h=m.eUp,d=k.eUp;h.dst()!==d.dst()&&n.sweep.checkForLeftSplice_(a,m)&&(k.fixUpperEdge?(n.sweep.deleteRegion_(a,k),n.mesh.deleteEdge(d),k=m.regionBelow(),d=k.eUp):m.fixUpperEdge&&(n.sweep.deleteRegion_(a,m),n.mesh.deleteEdge(h),m=k.regionAbove(),h=m.eUp));if(h.org!==d.org)if(h.dst()===d.dst()||m.fixUpperEdge||k.fixUpperEdge||h.dst()!==a.event&&d.dst()!==a.event)n.sweep.checkForRightSplice_(a,m);else if(n.sweep.checkForIntersect_(a,m))break;
h.org===d.org&&h.dst()===d.dst()&&(n.sweep.addWinding_(d,h),n.sweep.deleteRegion_(a,m),n.mesh.deleteEdge(h),m=k.regionAbove())}};n.sweep.connectRightVertex_=function(a,m,k){var h=k.oNext,d=m.regionBelow(),g=m.eUp,l=d.eUp,f=!1;g.dst()!==l.dst()&&n.sweep.checkForIntersect_(a,m);n.geom.vertEq(g.org,a.event)&&(n.mesh.meshSplice(h.oPrev(),g),m=n.sweep.topLeftRegion_(m),h=m.regionBelow().eUp,n.sweep.finishLeftRegions_(a,m.regionBelow(),d),f=!0);n.geom.vertEq(l.org,a.event)&&(n.mesh.meshSplice(k,l.oPrev()),
k=n.sweep.finishLeftRegions_(a,d,null),f=!0);f?n.sweep.addRightEdges_(a,m,k.oNext,h,h,!0):(h=n.geom.vertLeq(l.org,g.org)?l.oPrev():g,h=n.mesh.connect(k.lPrev(),h),n.sweep.addRightEdges_(a,m,h,h.oNext,h.oNext,!1),h.sym.activeRegion.fixUpperEdge=!0,n.sweep.walkDirtyRegions_(a,m))};n.sweep.connectLeftDegenerate_=function(a,m,k){var h=m.eUp;if(n.geom.vertEq(h.org,k))n.assert(n.sweep.TOLERANCE_NONZERO_),n.sweep.TOLERANCE_NONZERO_&&n.sweep.spliceMergeVertices_(a,h,k.anEdge);else if(n.geom.vertEq(h.dst(),
k)){if(n.assert(n.sweep.TOLERANCE_NONZERO_),n.sweep.TOLERANCE_NONZERO_){m=n.sweep.topRightRegion_(m);var h=m.regionBelow(),d=h.eUp.sym,g=d.oNext,l=g;h.fixUpperEdge&&(n.assert(g!==d),n.sweep.deleteRegion_(a,h),n.mesh.deleteEdge(d),d=g.oPrev());n.mesh.meshSplice(k.anEdge,d);n.geom.edgeGoesLeft(g)||(g=null);n.sweep.addRightEdges_(a,m,d.oNext,l,g,!0)}}else n.mesh.splitEdge(h.sym),m.fixUpperEdge&&(n.mesh.deleteEdge(h.oNext),m.fixUpperEdge=!1),n.mesh.meshSplice(k.anEdge,h),n.sweep.sweepEvent_(a,k)};n.sweep.connectLeftVertex_=
function(a,m){var k=new n.ActiveRegion;k.eUp=m.anEdge.sym;var k=a.dict.search(k).getKey(),h=k.regionBelow(),d=k.eUp,g=h.eUp;0===n.geom.edgeSign(d.dst(),m,d.org)?n.sweep.connectLeftDegenerate_(a,k,m):(h=n.geom.vertLeq(g.dst(),d.dst())?k:h,k.inside||h.fixUpperEdge?(d=h===k?n.mesh.connect(m.anEdge.sym,d.lNext):n.mesh.connect(g.dNext(),m.anEdge).sym,h.fixUpperEdge?n.sweep.fixUpperEdge_(h,d):n.sweep.computeWinding_(a,n.sweep.addRegionBelow_(a,k,d)),n.sweep.sweepEvent_(a,m)):n.sweep.addRightEdges_(a,k,
m.anEdge,m.anEdge,null,!0))};n.sweep.sweepEvent_=function(a,m){a.event=m;for(var k=m.anEdge;null===k.activeRegion;)if(k=k.oNext,k===m.anEdge){n.sweep.connectLeftVertex_(a,m);return}m=n.sweep.topLeftRegion_(k.activeRegion);var h=m.regionBelow(),k=h.eUp,h=n.sweep.finishLeftRegions_(a,h,null);h.oNext===k?n.sweep.connectRightVertex_(a,m,h):n.sweep.addRightEdges_(a,m,h.oNext,k,k,!0)};n.sweep.addSentinel_=function(a,m){var k=new n.ActiveRegion,h=n.mesh.makeEdge(a.mesh);h.org.s=n.sweep.SENTINEL_COORD_;h.org.t=
m;h.dst().s=-n.sweep.SENTINEL_COORD_;h.dst().t=m;a.event=h.dst();k.eUp=h;k.windingNumber=0;k.inside=!1;k.fixUpperEdge=!1;k.sentinel=!0;k.dirty=!1;k.nodeUp=a.dict.insert(k)};n.sweep.initEdgeDict_=function(a){a.dict=new n.Dict(a,n.sweep.edgeLeq_);n.sweep.addSentinel_(a,-n.sweep.SENTINEL_COORD_);n.sweep.addSentinel_(a,n.sweep.SENTINEL_COORD_)};n.sweep.doneEdgeDict_=function(a){for(var m=0,k;null!==(k=a.dict.getMin().getKey());)k.sentinel||(n.assert(k.fixUpperEdge),n.assert(1===++m)),n.assert(0===k.windingNumber),
n.sweep.deleteRegion_(a,k);a.dict=null};n.sweep.removeDegenerateEdges_=function(a){for(var m=a.mesh.eHead,k,h=m.next;h!==m;h=k){k=h.next;var d=h.lNext;n.geom.vertEq(h.org,h.dst())&&h.lNext.lNext!==h&&(n.sweep.spliceMergeVertices_(a,d,h),n.mesh.deleteEdge(h),h=d,d=h.lNext);if(d.lNext===h){if(d!==h){if(d===k||d===k.sym)k=k.next;n.mesh.deleteEdge(d)}if(h===k||h===k.sym)k=k.next;n.mesh.deleteEdge(h)}}};n.sweep.initPriorityQ_=function(a){var m=new n.PriorityQ;a.pq=m;a=a.mesh.vHead;var k;for(k=a.next;k!==
a;k=k.next)k.pqHandle=m.insert(k);m.init()};n.sweep.donePriorityQ_=function(a){a.pq.deleteQ();a.pq=null};n.sweep.removeDegenerateFaces_=function(a){for(var m,k=a.fHead.next;k!==a.fHead;k=m)m=k.next,k=k.anEdge,n.assert(k.lNext!==k),k.lNext.lNext===k&&(n.sweep.addWinding_(k.oNext,k),n.mesh.deleteEdge(k))};n.tessmono={};n.tessmono.tessellateMonoRegion_=function(a){a=a.anEdge;for(n.assert(a.lNext!==a&&a.lNext.lNext!==a);n.geom.vertLeq(a.dst(),a.org);a=a.lPrev());for(;n.geom.vertLeq(a.org,a.dst());a=a.lNext);
for(var m=a.lPrev(),k;a.lNext!==m;)if(n.geom.vertLeq(a.dst(),m.org)){for(;m.lNext!==a&&(n.geom.edgeGoesLeft(m.lNext)||0>=n.geom.edgeSign(m.org,m.dst(),m.lNext.dst()));)k=n.mesh.connect(m.lNext,m),m=k.sym;m=m.lPrev()}else{for(;m.lNext!==a&&(n.geom.edgeGoesRight(a.lPrev())||0<=n.geom.edgeSign(a.dst(),a.org,a.lPrev().org));)k=n.mesh.connect(a,a.lPrev()),a=k.sym;a=a.lNext}for(n.assert(m.lNext!==a);m.lNext.lNext!==a;)k=n.mesh.connect(m.lNext,m),m=k.sym};n.tessmono.tessellateInterior=function(a){for(var m,
k=a.fHead.next;k!==a.fHead;k=m)m=k.next,k.inside&&n.tessmono.tessellateMonoRegion_(k)};n.tessmono.discardExterior=function(a){for(var m,k=a.fHead.next;k!==a.fHead;k=m)m=k.next,k.inside||n.mesh.zapFace(k)};n.tessmono.setWindingNumber=function(a,m,k){for(var h,d=a.eHead.next;d!==a.eHead;d=h)h=d.next,d.rFace().inside!==d.lFace.inside?d.winding=d.lFace.inside?m:-m:k?n.mesh.deleteEdge(d):d.winding=0};n.Dict=function(a,m){this.head_=new n.DictNode;this.frame_=a;this.leq_=m};n.Dict.prototype.deleteDict_=
function(){};n.Dict.prototype.insertBefore=function(a,m){do a=a.prev;while(null!==a.key&&!this.leq_(this.frame_,a.key,m));m=new n.DictNode(m,a.next,a);a.next.prev=m;return a.next=m};n.Dict.prototype.insert=function(a){return this.insertBefore(this.head_,a)};n.Dict.prototype.deleteNode=function(a){a.next.prev=a.prev;a.prev.next=a.next};n.Dict.prototype.search=function(a){var m=this.head_;do m=m.next;while(null!==m.key&&!this.leq_(this.frame_,a,m.key));return m};n.Dict.prototype.getMin=function(){return this.head_.next};
n.Dict.prototype.getMax=function(){return this.head_.prev};n.DictNode=function(a,m,k){this.key=a||null;this.next=m||this;this.prev=k||this};n.DictNode.prototype.getKey=function(){return this.key};n.DictNode.prototype.getSuccessor=function(){return this.next};n.DictNode.prototype.getPredecessor=function(){return this.prev};n.GluTesselator=function(){this.state_=n.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=n.windingRule.GLU_TESS_WINDING_ODD;
this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};n.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};n.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(n.GluTesselator.tessState_.T_DORMANT)};n.GluTesselator.prototype.gluTessProperty=function(a,m){switch(a){case n.gluEnum.GLU_TESS_TOLERANCE:return;
case n.gluEnum.GLU_TESS_WINDING_RULE:switch(m){case n.windingRule.GLU_TESS_WINDING_ODD:case n.windingRule.GLU_TESS_WINDING_NONZERO:case n.windingRule.GLU_TESS_WINDING_POSITIVE:case n.windingRule.GLU_TESS_WINDING_NEGATIVE:case n.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=m;return}break;case n.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=!!m;return;default:this.callErrorCallback(n.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(n.gluEnum.GLU_INVALID_VALUE)};n.GluTesselator.prototype.gluGetTessProperty=
function(a){switch(a){case n.gluEnum.GLU_TESS_TOLERANCE:return 0;case n.gluEnum.GLU_TESS_WINDING_RULE:return a=this.windingRule,n.assert(a===n.windingRule.GLU_TESS_WINDING_ODD||a===n.windingRule.GLU_TESS_WINDING_NONZERO||a===n.windingRule.GLU_TESS_WINDING_POSITIVE||a===n.windingRule.GLU_TESS_WINDING_NEGATIVE||a===n.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),a;case n.gluEnum.GLU_TESS_BOUNDARY_ONLY:return n.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(n.gluEnum.GLU_INVALID_ENUM)}return!1};
n.GluTesselator.prototype.gluTessNormal=function(a,m,k){this.normal_[0]=a;this.normal_[1]=m;this.normal_[2]=k};n.GluTesselator.prototype.gluTessCallback=function(a,m){m=m?m:null;switch(a){case n.gluEnum.GLU_TESS_BEGIN:case n.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=m;break;case n.gluEnum.GLU_TESS_EDGE_FLAG:case n.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=m;break;case n.gluEnum.GLU_TESS_VERTEX:case n.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=m;break;case n.gluEnum.GLU_TESS_END:case n.gluEnum.GLU_TESS_END_DATA:this.endCallback_=
m;break;case n.gluEnum.GLU_TESS_ERROR:case n.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=m;break;case n.gluEnum.GLU_TESS_COMBINE:case n.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=m;break;case n.gluEnum.GLU_TESS_MESH:this.meshCallback_=m;break;default:this.callErrorCallback(n.gluEnum.GLU_INVALID_ENUM)}};n.GluTesselator.prototype.gluTessVertex=function(a,m){var k=!1,h=[0,0,0];this.requireState_(n.GluTesselator.tessState_.T_IN_CONTOUR);for(var d=0;3>d;++d){var g=a[d];g<-n.GLU_TESS_MAX_COORD&&
(g=-n.GLU_TESS_MAX_COORD,k=!0);g>n.GLU_TESS_MAX_COORD&&(g=n.GLU_TESS_MAX_COORD,k=!0);h[d]=g}k&&this.callErrorCallback(n.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(h,m)};n.GluTesselator.prototype.gluTessBeginPolygon=function(a){this.requireState_(n.GluTesselator.tessState_.T_DORMANT);this.state_=n.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=new n.GluMesh;this.polygonData_=a};n.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(n.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=n.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};n.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(n.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=n.GluTesselator.tessState_.T_IN_POLYGON};n.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(n.GluTesselator.tessState_.T_IN_POLYGON);this.state_=n.GluTesselator.tessState_.T_DORMANT;n.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);n.sweep.computeInterior(this);
if(!this.fatalError){var a=this.mesh;this.boundaryOnly_?n.tessmono.setWindingNumber(a,1,!0):n.tessmono.tessellateInterior(a);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?n.render.renderBoundary(this,this.mesh):n.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);if(this.meshCallback_){n.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}n.mesh.deleteMesh(this.mesh);
this.mesh=this.polygonData_=null};n.GluTesselator.prototype.requireState_=function(a){this.state_!==a&&this.gotoState_(a)};n.GluTesselator.prototype.gotoState_=function(a){for(;this.state_!==a;)if(this.state_<a)switch(this.state_){case n.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);this.gluTessBeginPolygon(null);break;case n.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case n.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_END_CONTOUR);
this.gluTessEndContour();break;case n.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(n.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};n.GluTesselator.prototype.addVertex_=function(a,m){var k=this.lastEdge_;null===k?(k=n.mesh.makeEdge(this.mesh),n.mesh.meshSplice(k,k.sym)):(n.mesh.splitEdge(k),k=k.lNext);k.org.data=m;k.org.coords[0]=a[0];k.org.coords[1]=a[1];k.org.coords[2]=a[2];k.winding=1;k.sym.winding=-1;this.lastEdge_=k};n.GluTesselator.prototype.callBeginCallback=
function(a){this.beginCallback_&&this.beginCallback_(a,this.polygonData_)};n.GluTesselator.prototype.callVertexCallback=function(a){this.vertexCallback_&&this.vertexCallback_(a,this.polygonData_)};n.GluTesselator.prototype.callEdgeFlagCallback=function(a){this.edgeFlagCallback_&&this.edgeFlagCallback_(a,this.polygonData_)};n.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};n.GluTesselator.prototype.callCombineCallback=function(a,m,k){return this.combineCallback_?
this.combineCallback_(a,m,k,this.polygonData_)||null:null};n.GluTesselator.prototype.callErrorCallback=function(a){this.errorCallback_&&this.errorCallback_(a,this.polygonData_)};n.GluFace=function(a,m){this.next=a||this;this.prev=m||this;this.anEdge=null;this.inside=!1};n.GluHalfEdge=function(a){this.next=a||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};n.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};n.GluHalfEdge.prototype.dst=function(){return this.sym.org};
n.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};n.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};n.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};n.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};n.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};n.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};n.GluMesh=function(){this.vHead=new n.GluVertex;this.fHead=new n.GluFace;this.eHead=new n.GluHalfEdge;this.eHeadSym=
new n.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};n.GluMesh.prototype.checkMesh=function(){if(n.DEBUG){var a=this.fHead,m=this.vHead,k=this.eHead,h,d;for(h=h=a;(d=h.next)!==a;h=d){n.assert(d.prev===h);h=d.anEdge;do n.assert(h.sym!==h),n.assert(h.sym.sym===h),n.assert(h.lNext.oNext.sym===h),n.assert(h.oNext.sym.lNext===h),n.assert(h.lFace===d),h=h.lNext;while(h!==d.anEdge)}n.assert(d.prev===h&&null===d.anEdge);for(h=h=m;(a=h.next)!==m;h=a){n.assert(a.prev===h);h=a.anEdge;
do n.assert(h.sym!==h),n.assert(h.sym.sym===h),n.assert(h.lNext.oNext.sym===h),n.assert(h.oNext.sym.lNext===h),n.assert(h.org===a),h=h.oNext;while(h!==a.anEdge)}n.assert(a.prev===h&&null===a.anEdge&&null===a.data);for(m=m=k;(h=m.next)!==k;m=h)n.assert(h.sym.next===m.sym),n.assert(h.sym!==h),n.assert(h.sym.sym===h),n.assert(null!==h.org),n.assert(null!==h.dst()),n.assert(h.lNext.oNext.sym===h),n.assert(h.oNext.sym.lNext===h);n.assert(h.sym.next===m.sym&&h.sym===this.eHeadSym&&h.sym.sym===h&&null===
h.org&&null===h.dst()&&null===h.lFace&&null===h.rFace())}};n.GluVertex=function(a,m){this.next=a||this;this.prev=m||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=this.s=0};n.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new n.PriorityQHeap};n.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};n.PriorityQ.prototype.init=function(){this.order_=[];for(var a=0;a<this.size_;a++)this.order_[a]=a;
a=function(a){return function(h,d){return n.geom.vertLeq(a[h],a[d])?1:-1}}(this.verts_);this.order_.sort(a);this.initialized_=!0;this.heap_.init();if(n.DEBUG)for(var m=0+this.size_-1,a=0;a<m;++a)n.assert(n.geom.vertLeq(this.verts_[this.order_[a+1]],this.verts_[this.order_[a]]))};n.PriorityQ.prototype.insert=function(a){if(this.initialized_)return this.heap_.insert(a);var m=this.size_++;this.verts_[m]=a;return-(m+1)};n.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();
var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var m=this.heap_.minimum();if(n.geom.vertLeq(m,a))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&null===this.verts_[this.order_[this.size_-1]]);return a};n.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var m=this.heap_.minimum();if(n.geom.vertLeq(m,a))return m}return a};n.PriorityQ.prototype.remove=function(a){if(0<=
a)this.heap_.remove(a);else for(a=-(a+1),n.assert(a<this.verts_.length&&null!==this.verts_[a]),this.verts_[a]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-1]];)--this.size_};n.PriorityQHeap=function(){this.heap_=n.PriorityQHeap.reallocNumeric_([0],n.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=n.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};n.PriorityQHeap.INIT_SIZE_=32;n.PriorityQHeap.reallocNumeric_=
function(a,m){for(var k=Array(m),h=0;h<a.length;h++)k[h]=a[h];for(;h<m;h++)k[h]=0;return k};n.PriorityQHeap.prototype.init=function(){for(var a=this.size_;1<=a;--a)this.floatDown_(a);this.initialized_=!0};n.PriorityQHeap.prototype.insert=function(a){var m=++this.size_;2*m>this.max_&&(this.max_*=2,this.handles_=n.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var k;0===this.freeList_?k=m:(k=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[k]=a;this.handles_[k]=m;
this.heap_[m]=k;this.initialized_&&this.floatUp_(m);return k};n.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};n.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};n.PriorityQHeap.prototype.extractMin=function(){var a=this.heap_,m=this.verts_,k=this.handles_,h=a[1],d=m[h];0<this.size_&&(a[1]=a[this.size_],k[a[1]]=1,m[h]=null,k[h]=this.freeList_,this.freeList_=h,0<--this.size_&&this.floatDown_(1));return d};n.PriorityQHeap.prototype.remove=function(a){var m=
this.heap_,k=this.verts_,h=this.handles_;n.assert(1<=a&&a<=this.max_&&null!==k[a]);var d=h[a];m[d]=m[this.size_];h[m[d]]=d;d<=--this.size_&&(1>=d?this.floatDown_(d):n.geom.vertLeq(k[m[d>>1]],k[m[d]])?this.floatDown_(d):this.floatUp_(d));k[a]=null;h[a]=this.freeList_;this.freeList_=a};n.PriorityQHeap.prototype.floatDown_=function(a){for(var m=this.heap_,k=this.verts_,h=this.handles_,d=m[a];;){var g=a<<1;g<this.size_&&n.geom.vertLeq(k[m[g+1]],k[m[g]])&&(g+=1);n.assert(g<=this.max_);var l=m[g];if(g>
this.size_||n.geom.vertLeq(k[d],k[l])){m[a]=d;h[d]=a;break}m[a]=l;h[l]=a;a=g}};n.PriorityQHeap.prototype.floatUp_=function(a){for(var m=this.heap_,k=this.verts_,h=this.handles_,d=m[a];;){var g=a>>1,l=m[g];if(0===g||n.geom.vertLeq(k[l],k[d])){m[a]=d;h[d]=a;break}m[a]=l;h[l]=a;a=g}};n.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};n.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};
n.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return n})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._resolver=null}a.prototype.isHeld=function(){return!!this._resolver};a.prototype.acquire=function(){var a=this;return this._resolver?this._resolver.promise.then(function(){return a.acquire()}):
(this._resolver=m.createResolver(),m.resolve())};a.prototype.release=function(){var a=this._resolver;this._resolver=null;a.resolve()};return a}();a.default=n;a.withLock=function(a,h,d){return a.acquire().then(function(){return h(d)}).then(function(){return a.release()}).catch(function(d){a.release();throw d;})}})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,"__esModule",{value:!0});var q=new m.default,r=new m.default;n=function(){function a(){this.tileBufferData=this.tileDisplayData=null}a.prototype.reshuffle=function(){q.reset();for(var b=h.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),c=0;c<b.length;c++)for(var e=b[c],f=0,l=e;f<l.length;f++){var m=l[f];m&&q.needMore(m.geometryType,m.meshData?m.meshData.vertexCount:m.vertexCount,m.meshData?m.meshData.indexData.length:m.indexCount)}f=
b.length;c=new k;for(l=0;l<f;++l){c.geometries[l].indexBuffer=new Uint32Array(Math.round(1.15*q.indicesFor(l)));var m=[],p;for(p in this.tileBufferData.geometries[l].vertexBuffer)m.push(this.tileBufferData.geometries[l].vertexBuffer[p].stride);var m=a._computeVertexAlignment(m),e=Math.round(1.15*q.verticesFor(l)),m=a._align(e,m),n;for(n in this.tileBufferData.geometries[l].vertexBuffer)e=this.tileBufferData.geometries[l].vertexBuffer[n].stride,c.geometries[l].vertexBuffer[n]={stride:e,data:g.allocateTypedArrayBuffer(m,
e)}}r.reset();this.tileDisplayData.displayList.clear();for(l=0;l<f;++l){e=b[l];p=0;for(n=e;p<n.length;p++){m=n[p];if(m.meshData)m.writeMeshDataToBuffers(r.verticesFor(l),c.geometries[l].vertexBuffer,r.indicesFor(l),c.geometries[l].indexBuffer),m.meshData=null;else{var w=this.tileBufferData.geometries[l].vertexBuffer,G=this.tileBufferData.geometries[l].indexBuffer,F=c.geometries[l].vertexBuffer,K=c.geometries[l].indexBuffer,H=r.verticesFor(l),N=r.indicesFor(l);d.copyMeshData(H,N,F,K,m,w,G);m.vertexFrom=
H;m.indexFrom=N}r.needMore(l,m.vertexCount,m.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(e)}if(this.tileDisplayData.displayList.unified)for(b=0,f=this.tileDisplayData.displayObjects;b<f.length;b++)this.tileDisplayData.displayList.addToList(f[b].displayRecords);this.tileBufferData=c};a.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var d in c.vertexBuffer)a[b][d]=
c.vertexBuffer[d].stride}return a};a.prototype.clone=function(){var b=new a;b.tileBufferData=this.tileBufferData.clone();b.tileDisplayData=this.tileDisplayData.clone();return b};a.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),c=0,d=0;d<b;d++)c=Math.max(c,a[d].displayRecords.length);return 2*(12*a.length+a.length*c*40)};a.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new p.default(Int32Array,
this._guessSize())).buffer();b.push(c);return{result:{displayData:c,bufferData:a},transferList:b}};a.decode=function(d){var f=e.deserializeList(new b.default(d.displayObjects),l),g={},h;for(h in d.vertexBuffersMap)g[h]=c.VertexBuffers.decode(d.vertexBuffersMap[h]);return a.fromMeshData({displayObjects:f,vertexBuffersMap:g})};a.fromMeshData=function(b){var c=new a,d=new h.default,e=new k;d.displayObjects=b.displayObjects;for(var f in b.vertexBuffersMap){var g=b.vertexBuffersMap[f];e.geometries[f].indexBuffer=
g.indexBuffer;e.geometries[f].vertexBuffer=g.namedBuffers}c.tileDisplayData=d;c.tileBufferData=e;return c};a.bind=function(b,c){var d=new a;d.tileDisplayData=b;d.tileBufferData=c;return d};a.create=function(b,c){var d=new a;d.tileDisplayData=new h.default;d.tileDisplayData.displayObjects=b;for(var e=[0,0,0,0,0],l=[0,0,0,0,0],m=[[],[],[],[],[]],p=0;p<b.length;p++)for(var n=0,q=b[p].displayRecords;n<q.length;n++){var r=q[n];m[r.geometryType].push(r);e[r.geometryType]+=r.meshData.vertexCount;l[r.geometryType]+=
r.meshData.indexData.length}b=new k;c=[c.fill||{},c.line||{},c.icon||{},c.text||{},c.label||{}];for(p=0;5>p;p++){var n=new Uint32Array(l[p]),q=c[p],r=e[p],u={},w=void 0;for(w in q){var v={data:g.allocateTypedArrayBuffer(r,q[w]),stride:q[w]};u[w]=v}q=u;f.writeAllMeshDataToBuffers(m[p],q,n);b.geometries[p]={indexBuffer:n,vertexBuffer:q}}d.tileBufferData=b;return d};a._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};a._computeVertexAlignment=function(a){for(var b=!1,c=!1,d=0;d<a.length;d++){var e=
a[d];2===e%4?b=!0:0!==e%4&&(c=!0)}return c?4:b?2:1};return a}();a.TileData=n})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._byGeometryType=null}Object.defineProperty(a.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._byGeometryType=null};a.prototype.verticesFor=function(a){return this._byGeometryType?
this._byGeometryType[a].vertices:0};a.prototype.indicesFor=function(a){return this._byGeometryType?this._byGeometryType[a].indices:0};a.prototype.needMore=function(a,h,d){if(h||d)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),a=this._byGeometryType[a],a.vertices+=h,a.indices+=d};return a}();a.default=n})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports",
"./Utils"],function(n,a,m){return function(){function a(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}a.prototype.clone=function(){for(var h=new a,d=0;d<this.geometries.length;d++){var g=this.geometries[d],l=h.geometries[d];l.indexBuffer=g.indexBuffer.slice();l.vertexBuffer={};for(var f in g.vertexBuffer){var c=g.vertexBuffer[f],b=c.stride;
l.vertexBuffer[f]={data:c.data.slice(),stride:b}}}return h};a.deserialize=function(h){for(var d=new a,g=0;5>g;++g){d.geometries[g].indexBuffer=new Uint32Array(h.geometries[g].indexBuffer);d.geometries[g].vertexBuffer={};for(var l in h.geometries[g].vertexBuffer)d.geometries[g].vertexBuffer[l]={data:m.allocateTypedArrayBufferwithData(h.geometries[g].vertexBuffer[l].data,h.geometries[g].vertexBuffer[l].stride),stride:h.geometries[g].vertexBuffer[l].stride}}return d};a.prototype.serialize=function(){for(var a=
{geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},d=0;5>d;++d)for(var g in this.geometries[d].vertexBuffer)a.geometries[d].vertexBuffer[g]={data:this.geometries[d].vertexBuffer[g].data.buffer,stride:this.geometries[d].vertexBuffer[g].stride};
return a};a.prototype.getBuffers=function(){for(var a=[],d=0;5>d;++d){a.push(this.geometries[d].indexBuffer.buffer);for(var g in this.geometries[d].vertexBuffer)a.push(this.geometries[d].vertexBuffer[g].data.buffer)}return a};return a}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(n,a,m,k,h){function d(a){for(var d=[[],[],[],[],[]],f=0;f<a.length;f++)for(var c=0,b=a[f].displayRecords;c<
b.length;c++){var e=b[c];d[e.geometryType].push(e)}return d}Object.defineProperty(a,"__esModule",{value:!0});a.groupRecordsByGeometryType=d;n=function(){function a(){}Object.defineProperty(a.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,d=this.displayObjects;a<d.length;a++){var c=d[a];this._displayObjectRegistry.set(c.id,c)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0});a.prototype.computeDisplayList=function(a){this._displayList=new m(a);if(a){a=0;for(var f=this.displayObjects;a<f.length;a++)for(var c=0,b=f[a].displayRecords;c<b.length;c++)this._displayList.addToList(b[c])}else for(a=d(this.displayObjects),f=a.length,c=0;c<f;++c)this._displayList.addToList(a[c])};a.prototype.clone=function(){var d=new a;this.displayObjects&&(d.displayObjects=this.displayObjects.map(function(a){return a.clone()}));
return d};a.prototype.serialize=function(a){h.serializeList(a,this.displayObjects);return a};a.prototype._deserializeObjects=function(a){for(var d=a.readInt32(),d=Array(d),c=new Map,b=0;b<d.length;++b){var e=k.deserialize(a);d[b]=e;c.set(e.id,e)}this.displayObjects=d;this._displayList=null;this._displayObjectRegistry=c};a.deserialize=function(d){var f=new a;f._deserializeObjects(d);return f};return a}();a.default=n})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define(["require","exports",
"../../../../core/tsSupport/generatorHelper","../../../../core/Logger","./enums"],function(n,a,m,k,h){function d(a,b,c){for(var d=[],e=3;e<arguments.length;e++)d[e-3]=arguments[e];b<a.length?a.splice.apply(a,[b,c].concat(d)):a.push.apply(a,d)}var g=k.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");n=new Map;n.set(h.WGLDrawPhase.MAP,[h.WGLGeometryType.FILL,h.WGLGeometryType.LINE,h.WGLGeometryType.MARKER,h.WGLGeometryType.TEXT]);n.set(h.WGLDrawPhase.LABEL,[h.WGLGeometryType.LABEL]);n.set(h.WGLDrawPhase.LABEL_ALPHA,
[h.WGLGeometryType.LABEL]);n=function(){function a(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}a.prototype.replay=function(a,b,c){if(this.unified)for(var d=0,e=this.symbolLevels;d<e.length;d++)for(var f=0,g=e[d].zLevels;f<g.length;f++){var h=g[f].geometryDPInfo,l;for(l in h)if(h[l])for(var k=0,m=h[l];k<m.length;k++){var p=m[k],n=a.painter.getGeometryBrush(p.geometryType),q=b.getGeometry(a,p.geometryType);n.prepareState(a,b);n.drawGeometry(a,b,p,q,c)}}};Object.defineProperty(a.prototype,
"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.symbolLevels.length=0};a.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};a.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};a.prototype.byType=function(a,b){for(var c=0,d=this.symbolLevels;c<
d.length;c++)for(var e=0,f=d[c].zLevels;e<f.length;e++){var g=f[e].geometryDPInfo,h=this.getDPInfoType(a);if(g[h])for(var l=0,g=g[h];l<g.length;l++)b(g[l])}};a.prototype.clone=function(){for(var b=new a(this.unified),c=0,d=this.symbolLevels;c<d.length;c++)b.symbolLevels.push(d[c].clone());return b};a.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=a.indexFrom+a.indexCount,e=0;e<c;++e){var f=b[e];if(f.geometryType===a.geometryType&&
d>f.indexFrom&&d<=f.indexFrom+f.indexCount)return d<f.indexFrom+f.indexCount&&(a=new l,a.geometryType=f.geometryType,a.materialKey=f.materialKey,a.indexFrom=d,a.indexCount=f.indexFrom+f.indexCount-d,b.splice(e+1,0,a),f.indexCount=d-f.indexFrom),e}};a.prototype._addToList=function(a,b){var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType);b=null!=b?b:c.length-1;var e=0<=b&&b<c.length?c[b]:null;null===e||e.materialKey!==a.materialKey||e.indexFrom+e.indexCount!==a.indexFrom||this.unified&&
e.geometryType!==a.geometryType?(e=new l,e.indexFrom=a.indexFrom,e.indexCount=a.indexCount,e.materialKey=a.materialKey,e.geometryType=a.geometryType,d(c,b+1,0,e)):e.indexCount+=a.indexCount};a.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,e=void 0,f=0;f<c;++f){var g=b[f];if(a.indexFrom+a.indexCount>g.indexFrom&&a.indexFrom<g.indexFrom+g.indexCount&&(!this.unified||g.geometryType===a.geometryType)){e=f;break}}if(void 0!==e){g=
b[e];if(a.indexFrom===g.indexFrom)return g.indexCount-=a.indexCount,g.indexFrom+=a.indexCount,0===g.indexCount&&d(b,e,1),e-1;if(a.indexFrom+a.indexCount===g.indexFrom+g.indexCount)return g.indexCount-=a.indexCount,0===g.indexCount?(d(b,e,1),e-1):e;var c=g.indexFrom,f=a.indexFrom-g.indexFrom,h=a.indexCount;a=g.indexFrom+g.indexCount-(a.indexFrom+a.indexCount);g.indexCount=f;var k=new l;k.geometryType=g.geometryType;k.materialKey=g.materialKey;k.indexFrom=c+f+h;k.indexCount=a;d(b,e+1,0,k);return e}return null};
a.prototype._getDisplayList=function(a,d,e){for(var g,l=this.symbolLevels.length,k=0;k<l;k++)if(this.symbolLevels[k].symbolLevel===a){g=this.symbolLevels[k];break}g||(g=new b,g.symbolLevel=a,this.symbolLevels.push(g));var m;a=g.zLevels.length;for(l=0;l<a;l++)if(g.zLevels[l].zLevel===d){m=g.zLevels[l];break}m||(m=new c,m.geometryDPInfo=new f,m.zLevel=d,g.zLevels.push(m));var p;if(this.unified)m.geometryDPInfo.unified||(m.geometryDPInfo.unified=[]),p=m.geometryDPInfo.unified;else switch(e){case h.WGLGeometryType.FILL:m.geometryDPInfo.fill||
(m.geometryDPInfo.fill=[]);p=m.geometryDPInfo.fill;break;case h.WGLGeometryType.LINE:m.geometryDPInfo.line||(m.geometryDPInfo.line=[]);p=m.geometryDPInfo.line;break;case h.WGLGeometryType.MARKER:m.geometryDPInfo.marker||(m.geometryDPInfo.marker=[]);p=m.geometryDPInfo.marker;break;case h.WGLGeometryType.TEXT:m.geometryDPInfo.text||(m.geometryDPInfo.text=[]);p=m.geometryDPInfo.text;break;case h.WGLGeometryType.LABEL:m.geometryDPInfo.label||(m.geometryDPInfo.label=[]);p=m.geometryDPInfo.label;break;
default:console.error("Trying to add a record with geometry type '"+e+"'.")}return p};a.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case h.WGLGeometryType.FILL:return"fill";case h.WGLGeometryType.LINE:return"line";case h.WGLGeometryType.MARKER:return"marker";case h.WGLGeometryType.TEXT:return"text";case h.WGLGeometryType.LABEL:return"label";default:g.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return a}();var l=function(){function a(){this.materialKey=
null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=new a;b.geometryType=this.geometryType;b.materialKey=this.materialKey;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;return b};return a}(),f=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=this.fill&&this.fill.map(function(a){return a.clone()});b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&
this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&this.unified.map(function(a){return a.clone()});return b};return a}(),c=function(){function a(){this.geometryDPInfo=new f}a.prototype.clone=function(){var b=new a;b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();return b};return a}(),b=function(){function a(){this.zLevels=[]}a.prototype.clone=
function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,d=this.zLevels;c<d.length;c++)b.zLevels.push(d[c].clone());return b};return a}();return n})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this._pos=0;this._buffer=a;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}a.prototype.readInt32=function(){return this._i32View[this._pos++]};
a.prototype.readF32=function(){return this._f32View[this._pos++]};return a}();a.default=n})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){function p(a,b){var c=b.length;
if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}function q(a,b,c){void 0===c&&(c=0);var d=b.g,e=b.b,f=b.a;a[c+0]=b.r*f/255;a[c+1]=d*f/255;a[c+2]=e*f/255;a[c+3]=f}Object.defineProperty(a,"__esModule",{value:!0});var r=function(a,b,c){for(var d=c*=16,e=0;d<Math.min(c+16,a.length);d++,e++)a[d]=b[e]},w=f.mat4f32.create();n=function(){function a(){this.symbolLevels=[];this.vvColorValues=
new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);this.insideEffect=new Float32Array(16*b.MAX_FILTERS);this.insideOpacity=1;this.outsideEffect=new Float32Array(16*b.MAX_FILTERS);
this.outsideOpacity=1;this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._buf0=new Float32Array(2);this._buf1=new Float32Array(2);this.symbolLevels.push(0);for(var a=0;a<b.MAX_FILTERS;a++)r(this.insideEffect,w,a),r(this.outsideEffect,w,a)}Object.defineProperty(a.prototype,"insideOpacities",{get:function(){this._buf0[0]=1;this._buf0[1]=this.insideOpacity;return this._buf0},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"outsideOpacities",{get:function(){this._buf1[0]=0;this._buf1[1]=this.outsideOpacity;return this._buf1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});a.prototype.update=function(a){d.isSome(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,a)};a.prototype.setInfo=function(a,b,c){var e=this;d.isSome(c)?(c.forEach(function(a,b){return e._updateEffects(b,
a)}),this.effectCount=c.length):this.effectCount=0;this._vvInfo=b;switch(a.type){case "dot-density":this._updateDotDensityInfo(a)}};a.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:h("esri-webgl-texture-float")}};a.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};a.prototype._updateEffects=function(a,b){a+=
1;if(d.isSome(b)&&b.filter&&b.filter.enabled){this.outsideLabelsVisible=b.excludedLabelsVisible;var c=b.parsedIncludedEffect;b=b.parsedExcludedEffect;d.isSome(c)?(r(this.insideEffect,c.getColorMatrix(),a),this.insideOpacity=c.getOpacity()):(r(this.insideEffect,w,a),this.insideOpacity=1);d.isSome(b)?(r(this.outsideEffect,b.getColorMatrix(),a),this.outsideOpacity=b.getOpacity()):(r(this.outsideEffect,w,a),this.outsideOpacity=1)}else r(this.insideEffect,w,a),r(this.outsideEffect,w,a),this.outsideOpacity=
this.insideOpacity=1};a.prototype._updateVisualVariables=function(a,b){var d=this._vvMaterialParameters;d.vvOpacityEnabled=!1;d.vvSizeEnabled=!1;d.vvColorEnabled=!1;d.vvRotationEnabled=!1;if(a){var f=a.size;if(f){d.vvSizeEnabled=!0;if(f.minMaxValue){var h=f.minMaxValue,k=void 0,m=void 0;e.isDefined(h.minSize)&&e.isDefined(h.maxSize)&&(e.isNumber(h.minSize)&&e.isNumber(h.maxSize)?(k=g.pt2px(h.minSize),m=g.pt2px(h.maxSize)):(m=b.scale,k=g.pt2px(p(m,h.minSize.stops)),m=g.pt2px(p(m,h.maxSize.stops))));
this.vvSizeMinMaxValue.set([h.minDataValue,h.maxDataValue,k,m])}f.scaleStops&&(this.vvSizeScaleStopsValue=g.pt2px(p(b.scale,f.scaleStops.stops)));f.unitValue&&(this.vvSizeUnitValueToPixelsRatio=l.getMetersPerUnitForSR(b.spatialReference)/c.meterIn[f.unitValue.unit]/b.resolution);f.fieldStops&&(this.vvSizeFieldStopsValues.set(f.fieldStops.values),this.vvSizeFieldStopsSizes.set(f.fieldStops.sizes))}if(b=a.color)d.vvColorEnabled=!0,this.vvColorValues.set(b.values),this.vvColors.set(b.colors);if(b=a.opacity)d.vvOpacityEnabled=
!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities);if(a=a.rotation)d.vvRotationEnabled=!0,d.vvRotationType=a.type}};a.prototype._updateDotDensityInfo=function(a){var c=a.attributes;this.ddDotValue=a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=a.seed;for(var d=0;d<b.DOT_DENSITY_MAX_FIELDS;d++){var e=d>=c.length?new k([0,0,0,0]):c[d].color;q(this.ddColors,e,4*d)}for(d=0;8>d;d++)this.ddActiveDots[d]=d<a.attributes.length?
1:0;q(this.ddBackgroundColor,a.backgroundColor)};return a}();a.WGLRendererInfo=n})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ./definitions ./DirtyMap ./DisplayRecordStore ./Fader ./TiledDisplayObject ./WGLBuffers".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p){Object.defineProperty(a,
"__esModule",{value:!0});var q=new Set;n=function(a){function e(c,d,e){void 0===e&&(e=!1);c=a.call(this,c,d,[l.TILE_SIZE,l.TILE_SIZE])||this;c._data=null;c._displayList=null;c._wglBuffers=null;c._dirtyMap=new f.default;c._labelIndex=null;c._dirty=!0;c.fader=new b.default;c._ensureCorrectZOrder=e;c.transforms.labelMat2d=h.mat2df32.create();return c}m(e,a);e.prototype.destroy=function(){this.clear()};Object.defineProperty(e.prototype,"displayObjects",{get:function(){return this._data.tileDisplayData.displayObjects},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canDisplay",{get:function(){return!!this.attached},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||this.ready();this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"labelIndex",
{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});e.prototype.getGeometry=function(a,b){return this._wglBuffers&&this._wglBuffers.has(b)?this._wglBuffers.get(b):null};e.prototype.getDisplayList=function(a){return this._data&&this._displayList};Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});e.prototype.setTransform=function(b,c){a.prototype.setTransform.call(this,b,c);var e=this.transforms.labelMat2d;c=b.getScreenTransform(e,
c);var f=g.vec2f32.create();d.vec2.transformMat2d(f,this.coords,c);k.mat2d.identity(e);k.mat2d.translate(e,e,f);k.mat2d.multiply(e,b.viewMat2d,e)};e.prototype.setData=function(a,b,d){var e=a.addOrUpdate,g=a.remove;!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:e,remove:g},b,d):(e.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new f.default,this._dispRecStore=c.default.fromTileData(e,this._dirtyMap),
this._data=e,this._readyTileIfNoLabels(b,d),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=e.tileDisplayData.displayList.clone())):(this.clear(),this.ready());this.emit("change")};e.prototype.commitChanges=function(a){this.fader.step()||this.requestRender();this._wglBuffers||(this._wglBuffers=new p.default(this.stage.context));this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap);this._displayList=this._data.tileDisplayData.displayList.clone();this._dirtyMap.markAllClean()};
e.prototype.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)};e.prototype.attach=function(){return!0};e.prototype._readyTileIfNoLabels=function(a,b){a&&this._rebuildLabelIndex();this.isDirty=a&&b?!0:!1};e.prototype._doPatchData=function(a,b,d){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=c.default.fromTileData(this._data,this._dirtyMap));this._readyTileIfNoLabels(b,
d);this.requestRender()};e.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,d=b[a].metrics;c<d.length;c++)this._insertIntoLabelIndex(d[c])};e.prototype._insertIntoLabelIndex=function(a){-1!==a.xBucket&&this.labelIndex[a.yBucket][a.xBucket].push(a)};e.prototype._initLabelIndex=function(){for(var a=[],b=0;b<l.TILE_SIZE/l.COLLISION_BUCKET_SIZE;b++){a.push([]);for(var c=0;c<l.TILE_SIZE/l.COLLISION_BUCKET_SIZE;c++)a[b].push([])}return a};
e.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&a.addOrUpdate.tileDisplayData.displayObjects||[],d=(a.remove||[]).slice(),e=0;e<c.length;e++){var f=c[e];null!=f.insertAfter&&d.push(f.id)}for(f=0;f<d.length;f++){var g=d[f];if(e=this._data.tileDisplayData.displayObjectRegistry.get(g)){this._data.tileDisplayData.displayList.removeFromList(e.displayRecords);for(var h=0,l=e.displayRecords;h<l.length;h++)this._dispRecStore.delete(l[h]);this._data.tileDisplayData.displayObjectRegistry.delete(g);
e=this._data.tileDisplayData.displayObjects.indexOf(e);this._data.tileDisplayData.displayObjects.splice(e,1)}}for(d=0;d<c.length;d++){f=c[d];e=this._data.tileDisplayData.displayObjectRegistry.get(f.id);g=void 0;if(e){h=e.displayRecords;e.set(f);e.displayRecords=h;h=e.displayRecords.length;for(l=0;l<h;++l){var k=e.displayRecords[l],m=f.displayRecords[l];if(l>=f.displayRecords.length||k.geometryType!==m.geometryType||k.symbolLevel!==m.symbolLevel||k.zOrder!==m.zOrder||k.materialKey!==m.materialKey)this._dispRecStore.delete(e.displayRecords[l]),
l<f.displayRecords.length&&(e.displayRecords[l]=void 0)}e.displayRecords.length=f.displayRecords.length;e.metrics=f.metrics}else if(e=f.copy(),e.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(f.id,e),l=void 0,k=this._data.tileDisplayData.displayObjects,null!=e.insertAfter?(g={},0<=e.insertAfter?(h=this._data.tileDisplayData.displayObjectRegistry.get(e.insertAfter))?(l=k.indexOf(h)+1,l<k.length?k.splice(l,0,e):(k.push(e),l=k.length)):(k.push(e),l=k.length):(k.unshift(e),l=0)):
(k.push(e),l=k.length),g){m=void 0;if(this._data.tileDisplayData.displayList.unified)m=0<f.displayRecords.length?1:0;else{q.clear();for(var m=0,p=f.displayRecords;m<p.length;m++)h=this._data.tileDisplayData.displayList.getDPInfoType(p[m].geometryType),q.add(h);m=q.size}p=0;for(--l;0<=l&&p<m;--l)for(var n=k[l].displayRecords.length-1;0<=n&&p<m;--n){var r=k[l].displayRecords[n],h=this._data.tileDisplayData.displayList.getDPInfoType(r.geometryType);g[h]||(g[h]=r,++p)}}p=f.displayRecords.length;for(l=
0;l<p;++l){m=f.displayRecords[l];(k=e.displayRecords[l])?(k.meshData=m.meshData,k.materialKey=m.materialKey):(k=m.copy(),k.vertexFrom=void 0,k.indexFrom=void 0,e.displayRecords[l]=k);var n=m.geometryType,h=this._data.tileDisplayData.displayList.getDPInfoType(n),r=a.addOrUpdate.tileBufferData.geometries[n],n=r.vertexBuffer,r=r.indexBuffer,u=void 0;g&&(u=g[h]?this._data.tileDisplayData.displayList.splitAfter(g[h]):-1);b=this._dispRecStore.setMeshData(k,m,n,r,u)&&b;g&&null!=k.indexFrom&&null!=k.indexFrom&&
(g[h]=k)}}return b};return e}(e.TiledDisplayObject);a.WGLTile=n})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require","exports","./Utils"],function(n,a,m){function k(a,d,g){if(!a.allDirty)if(null!=a.from&&null!=a.count){var h=Math.min(a.from,d);d=Math.max(a.from+a.count,d+g)-h;a.from=h;a.count=d}else a.from=d,a.count=g}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this._dirties=m.createGeometryData(function(a){return{indices:{from:null,count:null,allDirty:!1}}},
function(a,g){return{vertices:{from:null,count:null,allDirty:!1}}})}a.prototype.hasDirty=function(){for(var a=0,g=this._dirties;a<g.length;a++){var h=g[a];if(null!==h.data.indices.count||h.data.indices.allDirty)return!0}return!1};a.prototype.markAllClean=function(){for(var a=0,g=this._dirties;a<g.length;a++){var h=g[a];h.data.indices.from=null;h.data.indices.count=null;h.data.indices.allDirty=!1;for(var f in h.buffers)h.buffers[f].data.vertices.from=null,h.buffers[f].data.vertices.count=null,h.buffers[f].data.vertices.allDirty=
!1}};a.prototype.markAllDirty=function(){for(var a=0,g=this._dirties;a<g.length;a++){var h=g[a];h.data.indices.allDirty=!0;for(var f in h.buffers)h.buffers[f].data.vertices.allDirty=!0}};a.prototype.forEach=function(a){for(var d=0;d<this._dirties.length;++d){var h=this._dirties[d],f={},c;for(c in h.buffers){var b=h.buffers[c].data.vertices;if(b.allDirty||null!=b.from&&null!=b.count&&0<b.count)f[c]=b}h=h.data.indices;b=void 0;b=h.allDirty||null!=h.from&&null!=h.count&&0<h.count?{indices:h,vertices:f}:
{indices:null,vertices:f};(b.indices||0<Object.keys(b).length)&&a(b,d)}};a.prototype.markDirtyIndices=function(a,g,h){k(this._dirties[a].data.indices,g,h)};a.prototype.markDirtyVertices=function(a,g,h,f){k(this._dirties[a].buffers[g].data.vertices,h,f)};return a}();a.default=n})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","../../../../core/has","./FreeList","./Utils"],function(n,a,m,k,h){function d(a){a=a.getStrides();for(var d={},c=0;c<a.length;c++)d[g[c]]=
a[c];return d}Object.defineProperty(a,"__esModule",{value:!0});var g=["FILL","LINE","MARKER","TEXT","LABEL"];n=function(){function a(a,c,b,d){this._strides=a;this._displayList=c;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=b;for(var e in a){this._freeListsAndStorage[e]={vtxFreeList:d?new k.FreeList(d):null,idxFreeList:d?new k.FreeList(d):null,vertexBuffers:{},indexBuffer:d?new Uint32Array(d):null};for(var f in a[e])this._freeListsAndStorage[e].vertexBuffers[f]={data:d?h.allocateTypedArrayBuffer(d,
a[e][f]):null,stride:a[e][f]}}}a.fromTileData=function(f,c){var b=d(f),e=[0,0,0,0,0],l=[0,0,0,0,0],m=[];f.tileDisplayData.displayObjectRegistry.forEach(function(a){m.push(a)});for(var n=0;n<m.length;n++)for(var w=0,u=m[n].displayRecords;w<u.length;w++){var v=u[w];e[v.geometryType]=Math.max(e[v.geometryType],v.vertexFrom+v.vertexCount);l[v.geometryType]=Math.max(l[v.geometryType],v.indexFrom+v.indexCount)}c=new a(b,f.tileDisplayData.displayList,c,null);for(b=0;b<f.tileBufferData.geometries.length;++b){var n=
e[b],u=l[b],v=f.tileBufferData.geometries[b],w=c._storageFor(g[b]),y=f.tileBufferData.geometries[b].indexBuffer;w.indexBuffer=y;w.idxFreeList=new k.FreeList(y.length);w.idxFreeList.allocate(u);var u=void 0,t;for(t in v.vertexBuffer)v=f.tileBufferData.geometries[b].vertexBuffer[t],w.vertexBuffers[t].data=v.data,w.vertexBuffers[t].stride=v.stride,y=h.strideToPackingFactor(v.stride),v=v.data.length*y/v.stride,u||(u=v);w.vtxFreeList=new k.FreeList(u);w.vtxFreeList.allocate(n)}return c};a.prototype.delete=
function(a){var c=g[a.geometryType];this._freeVertices(c,a.vertexFrom,a.vertexCount);this._freeIndices(c,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=void 0};a.prototype.setMeshData=function(a,c,b,d,l){var e=g[a.geometryType];a.meshData=null;var f=void 0,k=void 0;void 0===a.vertexFrom?(k=c.vertexCount,f=this._allocateVertices(e,k)):c.vertexCount>a.vertexCount?(this._freeVertices(e,a.vertexFrom,a.vertexCount),k=c.vertexCount,f=this._allocateVertices(e,
k)):c.vertexCount===a.vertexCount?(f=a.vertexFrom,k=a.vertexCount):(this._freeVertices(e,a.vertexFrom+c.vertexCount,a.vertexCount-c.vertexCount),f=a.vertexFrom,k=c.vertexCount);var m=!0,p=void 0,n=void 0,t=void 0;void 0===a.indexFrom?(p=l,t=c.indexCount,n=this._allocateIndices(e,t)):c.indexCount>a.indexCount?(p=this._displayList.removeFromList(a),this._freeIndices(e,a.indexFrom,a.indexCount),t=c.indexCount,n=this._allocateIndices(e,t)):c.indexCount===a.indexCount?(m=!1,n=a.indexFrom,t=a.indexCount):
(p=this._displayList.removeFromList(a),this._freeIndices(e,a.indexFrom+c.indexCount,a.indexCount-c.indexCount),n=a.indexFrom,t=c.indexCount);if(-1!==f&&-1!==n){l=this._storageFor(e);h.copyMeshData(f,n,l.vertexBuffers,l.indexBuffer,c,b,d);a.vertexFrom=f;a.indexFrom=n;a.vertexCount=c.vertexCount;a.indexCount=c.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,a.indexFrom,a.indexCount);for(var x in b)this._dirtyMap.markDirtyVertices(a.geometryType,x,a.vertexFrom,a.vertexCount)}m&&
this._displayList.addToList(a,p);return!0}-1!==f&&this._freeVertices(e,f,k);-1!==n&&this._freeIndices(e,n,t);a.setMeshDataFromBuffers(c,b,d);a.vertexFrom=void 0;a.vertexCount=0;a.indexFrom=void 0;a.indexCount=0;return!1};a.prototype._allocateVertices=function(a,c){a=this._storageFor(a);c=a.vtxFreeList.allocate(c);return-1===c||.5<a.vtxFreeList.fragmentation?-1:c};a.prototype._freeVertices=function(a,c,b){var d=this._storageFor(a);d.vtxFreeList.free(c,b);if(m("esri-feature-tiles-debug"))for(var f in d.vertexBuffers)for(var g=
d.vertexBuffers[f].data,l=this._stridesFor(a,f),k=h.strideToPackingFactor(l),n=c*l/k,l=b*l/k,k=n;k<n+l;++k)g[k]=0};a.prototype._freeIndices=function(a,c,b){a=this._storageFor(a);a.idxFreeList.free(c,b);if(m("esri-feature-tiles-debug")){a=a.indexBuffer;for(var d=c;d<c+b;++d)a[d]=0}};a.prototype._allocateIndices=function(a,c){a=this._storageFor(a);c=a.idxFreeList.allocate(c);return-1===c||.5<a.idxFreeList.fragmentation?-1:c};a.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};a.prototype._stridesFor=
function(a,c){return this._strides[a][c]};return a}();a.default=n})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});var m=function(){function a(a){this._largestRange=null;this._parent=a;this._updateLargestRange()}Object.defineProperty(a.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});a.prototype.rangeCreated=function(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=
a};a.prototype.rangeResized=function(a,d,g){if(a===this._largestRange)a.count<g&&this._updateLargestRange();else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.findBestRange=function(a){for(var d=this._parent._freeHead,g=null;null!==d;)d.count>=a&&(!g||d.count-a<g.count-a)&&(g=d),d=d.next;return g};a.prototype.findAdjacentRanges=function(a,d){for(var g=!0,h=!1,f=null,c=this._parent._freeHead;g&&!h;){var b=null!==c?c.from:this._parent._size;a>=(null!==f?
f.from+f.count:0)&&a+d<=b?(g=!1,h=!0):null!==c?(f=c,c=c.next):g=!1}return[f,c]};a.prototype._updateLargestRange=function(){for(var a=null,d=this._parent._freeHead;null!==d;){if(!a||d.count>a.count)a=d;d=d.next}this._largestRange=a};return a}();n=function(){function a(a,d){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,next:null}:null;this._bookKeeper=d||new m(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}a.prototype.allocate=function(h){var d=this._bookKeeper.findBestRange(h);
if(null===d)return-1;var g=d.from,l=d.count;d.from+=h;d.count-=h;this._bookKeeper.rangeResized(d,g,l);this._allocated+=h;0===d.count&&(h=null!==d.prev?this._freeHead:d.next,a._removeRange(d),this._freeHead=h);return g};a.prototype.free=function(h,d){var g=this._bookKeeper.findAdjacentRanges(h,d),l=g[0],g=g[1];h={from:h,count:d,prev:l,next:g};null!==l&&(l.next=h);null!==g&&(g.prev=h);this._bookKeeper.rangeCreated(h);this._allocated-=d;if(null!==g&&h.from+h.count===g.from){d=h.from;var f=h.count;a._fuse(h,
g);a._removeRange(g);this._bookKeeper.rangeResized(h,d,f);this._bookKeeper.rangeResized(g,void 0,0)}null!==l&&l.from+l.count===h.from&&(d=l.from,f=l.count,a._fuse(l,h),a._removeRange(h),this._bookKeeper.rangeResized(l,d,f),this._bookKeeper.rangeResized(h,void 0,0));this._freeHead=null!==h.prev?this._freeHead:h};Object.defineProperty(a.prototype,"fragmentation",{get:function(){var a=this._size-this._allocated;return 0===a?0:1-this._bookKeeper.largestRange.count/a},enumerable:!0,configurable:!0});a._removeRange=
function(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)};a._fuse=function(a,d){a.count+=d.count;a.next=d.next;d.from+=d.count;d.count=0;null!==d.next&&(d.next.prev=a)};return a}();a.FreeList=n})},"esri/views/2d/engine/webgl/Fader":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){void 0===a&&(a=400);this.duration=a;this._value=this._elapsed=this._lastTime=
0;this._finished=!1}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._value=this._elapsed=this._lastTime=0};a.prototype.step=function(){var a=performance.now();if(0===this._lastTime)return this._lastTime=a,this._value=0,!0;if(this._elapsed>=this.duration)return!0;this._elapsed+=a-this._lastTime;this._lastTime=a;this._value=Math.min(this._elapsed/this.duration,1);return!1};return a}();a.default=n})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require",
"exports","../../../webgl","./Utils"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.geometryMap=k.createGeometryData(function(d){return{indexBuffer:m.BufferObject.createIndex(a,35044),vao:null}},function(d,h){return{vertexBuffer:m.BufferObject.createVertex(a,k.C_VBO_INFO[h])}})}a.prototype.dispose=function(){for(var a=0;5>a;a++){var g=this.geometryMap[a];if(g){g.data.vao&&g.data.vao.dispose(!1);g.data.indexBuffer&&g.data.indexBuffer.dispose();for(var h in g.buffers)g.buffers[h]&&
g.buffers[h].data.vertexBuffer.dispose()}}};a.prototype.get=function(a){var d=this.geometryMap[a];a={};for(var h in d.buffers)a[h]=d.buffers[h].data.vertexBuffer;return{indexBuffer:d.data.indexBuffer,get vao(){return d.data.vao},set vao(a){d.data.vao=a},vertexBufferMap:a}};a.prototype.has=function(a){return null!=this.geometryMap[a]};a.prototype.upload=function(a,g){var d=this;g.forEach(function(f,c){d._upload(f,c,a)})};a.prototype._upload=function(a,g,h){a.indices&&(a.indices.allDirty?this._uploadIndices(h,
g):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(h,g,a.indices.from,a.indices.count));if(a.vertices){a=a.vertices;for(var d in a){var c=a[d];c.allDirty?this._uploadVertices(h,g,d):null!=c.from&&null!=c.count&&this._uploadVertices(h,g,d,c.from,c.count)}}};a.prototype._uploadVertices=function(a,g,h,f,c){var b=this.geometryMap[g];b&&(g=a.geometries[g].vertexBuffer[h])&&(a=g.stride,g=g.data.buffer,b.buffers[h]&&0<g.byteLength&&(null!=f&&null!=c?b.buffers[h].data.vertexBuffer.setSubData(g,
f*a,f*a,(f+c)*a):b.buffers[h].data.vertexBuffer.setData(g)))};a.prototype._uploadIndices=function(a,g,h,f){var c=this.geometryMap[g];c&&(a=a.geometries[g].indexBuffer.buffer,c.data.indexBuffer&&0<a.byteLength&&(null!=h&&null!=f?c.data.indexBuffer.setSubData(a,4*h,4*h,4*(h+f)):c.data.indexBuffer.setData(a)))};return a}();a.default=n})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(n,a,m,k){Object.defineProperty(a,
"__esModule",{value:!0});a.magnifier={name:"magnifier",shaders:{vertexShader:k.resolveIncludes("magnifier/magnifier.vert"),fragmentShader:k.resolveIncludes("magnifier/magnifier.frag")},attributes:{a_pos:0}};a.createMagnifierProgram=function(h){return m.createProgram(h,a.magnifier)}})},"esri/views/2d/engine/BitmapTileContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry/support/aaBoundingRect ../engine ./BitmapTile ./webgl/enums ./webgl/TileContainer".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.prototype.createTile=function(a){var b=this._tileInfoView.getTileBounds(h.create(),a);return new g.BitmapTile(a,b,this._tileInfoView.tileInfo.size)};b.prototype.destroyTile=function(a){};b.prototype.prepareRenderPasses=function(b){var c=this,e=b.registerRenderPass({name:"bitmap (tile)",brushes:[d.brushes.Bitmap],target:function(){return c.children.map(function(a){return a.bitmap})},
drawPhase:l.WGLDrawPhase.MAP});return a.prototype.prepareRenderPasses.call(this,b).concat([e])};b.prototype.doRender=function(b){this.visible&&b.drawPhase===l.WGLDrawPhase.MAP&&a.prototype.doRender.call(this,b)};return b}(f.default);a.BitmapTileContainer=n})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){return function(a){this.type=a}}();
a.RenderBucket=n;var k=function(a){function d(){var d=a.call(this,2)||this;d.triangleElementStart=0;d.triangleElementCount=0;return d}m(d,a);d.prototype.hasData=function(){return 0<this.triangleElementCount};d.prototype.triangleCount=function(){return this.triangleElementCount/3};return d}(n);a.LineRenderBucket=k;k=function(a){function d(){var d=a.call(this,1)||this;d.triangleElementStart=0;d.triangleElementCount=0;d.outlineElementStart=0;d.outlineElementCount=0;return d}m(d,a);d.prototype.hasData=
function(){return 0<this.triangleElementCount||0<this.outlineElementCount};d.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return d}(n);a.FillRenderBucket=k;k=function(a){function d(){var d=a.call(this,3)||this;d.markerPerPageElementsMap=new Map;d.glyphPerPageElementsMap=new Map;d.isSDF=!1;return d}m(d,a);d.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};d.prototype.triangleCount=function(){var a=
0;this.markerPerPageElementsMap.forEach(function(d){a+=d[1]});this.glyphPerPageElementsMap.forEach(function(d){a+=d[1]});return a/3};return d}(n);a.SymbolRenderBucket=k;k=function(a){function d(){var d=a.call(this,4)||this;d.triangleElementStart=0;d.triangleElementCount=0;return d}m(d,a);d.prototype.hasData=function(){return 0<this.triangleElementCount};d.prototype.triangleCount=function(){return this.triangleElementCount/3};return d}(n);a.CircleRenderBucket=k;n=function(a){function d(){return a.call(this,
0)||this}m(d,a);d.prototype.hasData=function(){return!0};d.prototype.triangleCount=function(){return 2};return d}(n);a.BackgroundRenderBucket=n})},"esri/views/3d/terrain/ElevationBounds":function(){define(["require","exports","../../../core/tsSupport/extendsHelper"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d){void 0===a&&(a=0);void 0===d&&(d=0);this.min=a;this.max=d;this.level=0;this.hasNoDataValues=!1}a.prototype.copyFrom=function(a){this.min=a.min;
this.max=a.max;this.level=a.level;this.hasNoDataValues=a.hasNoDataValues};return a}();a.ElevationBounds=n})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(n,a,m,k,h){return function(){function a(a,d,f,c){this.samplerData=null;this.level=a;this.i=d;this.j=f;this.extent=c}a.prototype.release=function(){this.bounds=this.samplerData=null};a.prototype.computeMinMaxValue=function(a,d,f,c){c.min=Infinity;
c.max=-Infinity;c.hasNoDataValues=!1;a-=this.level;if(0>=a)return c;var b=Math.pow(2,a);if(Math.floor(d/b)!==this.i||Math.floor(f/b)!==this.j)return c;var e=Infinity,g=-Infinity,l=this.samplerData.width,m=this.samplerData.pixelData,n=.5*h.ELEVATION_NODATA_VALUE;a=(l-1)/b;f=(f-this.j*b)*a;var u=(d-this.i*b)*a;if(1>a){var v=Math.floor(f),y=Math.floor(u),t=v+y*l;d=m[t];var b=m[t+1],x=m[t+l],t=m[t+l+1];if(d+b+x+t<n)return e=f-v,n=u-y,g=k.bilerp(d,b,x,t,e,n),l=k.bilerp(d,b,x,t,e+a,n),m=k.bilerp(d,b,x,
t,e,n+a),a=k.bilerp(d,b,x,t,e+a,n+a),c.min=Math.min(g,l,m,a),c.max=Math.max(g,l,m,a),c;f=v;u=y;a=1}else f=Math.floor(f),u=Math.floor(u),a=Math.ceil(a);for(d=f;d<=f+a;d++)for(b=u;b<=u+a;b++)t=d+b*l,x=m[t],x<n?(e=Math.min(e,x),g=Math.max(g,x)):c.hasNoDataValues=!0;c.min=e;c.max=g;return c};a.create=function(d,h,f){d=new a(d[0],d[1],d[2],h);h=f.noDataValue;for(var c=f.values,b=Infinity,e=-Infinity,g=!0,l=!1,k=0;k<c.length;k++){var m=c[k];m!==h?(b=m<b?m:b,e=m>e?m:e,g=!1):l=!0}g&&(e=b=0);e=-3E38<e?e:0;
d.samplerData={pixelData:f.values,width:f.width,height:f.height,minValue:b,maxValue:e,noDataValue:h,safeWidth:.99999999*(f.width-1),dx:(f.width-1)/(d.extent[2]-d.extent[0]),dy:(f.width-1)/(d.extent[3]-d.extent[1]),x0:d.extent[0],y1:d.extent[3]};d.bounds=[b,e];d.hasNoDataValues=l;return d};a.sample=function(a,d,f){for(var c=0;c<f.length;c++){var b=f[c];if(b){var e=b.safeWidth,g=b.width,l=b.pixelData,k=m.clamp(b.dy*(b.y1-d),0,e),b=m.clamp(b.dx*(a-b.x0),0,e),e=Math.floor(k),n=Math.floor(b),u=e*g+n,v=
u+g,y=l[u],g=l[v],u=l[u+1],l=l[v+1];if(y+g+u+l<.5*h.ELEVATION_NODATA_VALUE)return k-=e,b-=n,a=y+(u-y)*b,a+(g+(l-g)*b-a)*k}}return null};return a}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent".split(" "),function(n,a,m,k,h,d){return function(a){function d(){var d=null!==a&&a.apply(this,arguments)||this;d._scaleRangeEnabled=!1;return d}m(d,a);d.prototype._desiredMinLevelDelta=
function(){return h.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};d.Pool=new k(d);return d}(d.TileAgent)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./TerrainConst","./tileUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=Error("Abstract method called on TileAgent");n=function(){function a(){}Object.defineProperty(a.prototype,"updating",{get:function(){return!!this._tileRequested},
enumerable:!0,configurable:!0});a.prototype.init=function(a,d,c,b){this.tile=a;this._layerIdx=d;this._layerClass=c;this._suspended=b;this._tileLayerInfo=a.getLayerInfo(d,c);this._tileRequested=null;a=this._findAncestorWithData();this._setUpsampleTile(a)};a.prototype.startLoading=function(){return this._requestNext()};a.prototype.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=
null};a.prototype.setSuspension=function(a){a!==this._suspended&&((this._suspended=a)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};a.prototype.update=function(){var a=this._findAncestorWithData();this._setUpsampleTile(a);return this._requestNext()};a.prototype.dataArrived=function(a){this._setUpsampleTile(a);this._tileRequested=null;a===this.tile?this.tile.updateRenderData(this._layerClass):
this._requestNext()};a.prototype.dataMissing=function(a){this._tileRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};a.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};a.prototype._requestNext=function(){if(this._suspended)return!0;var a=this._findNextDownload();if(this._tileRequested){if(a===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}a?a.requestLayerData(this._layerIdx,
this._layerClass,this)&&(this._tileRequested=a):this._agentDone();return!!this._tileRequested};a.prototype._findNextDownload=function(){for(var a=this._layerIdx,d=this._layerClass,c=this.tile.surface.layerViewByIndex(a,d),b=c.layer,e=c.dataLevelRange,c=e.minLevel,e=e.maxLevel,g=this._desiredMinLevelDelta(),m=k.START_LOADING_LEVEL_DELTA+g,n=this._scaleRangeEnabled?h.fallsWithinLayer:function(){return!0},w,u=this.tile,v=0,y=this._tileLayerInfo.upsampleFromTile,y=y?y.tile.level:-1,t=this.tile.surface,
x=t.getTilemapTile(u);u&&n(u,b,!1)&&u.level>=c;){var z=u.level,A=u.layerInfo[d][a];if(A.data&&v>=g){z>y&&this._setUpsampleTile(u);A.dataInvalidated&&(w=u);break}if((!x||x.hasDataAvailable(u,a,d))&&z<=e&&!A.data&&!A.dataMissing){if(!w||0===z%k.LOADING_LEVEL_MODULO||this.tile.level-w.level<g)w=u;if(v>=m)break}(u=u.parent)&&x&&(x=x.parent||t.getTilemapTile(u));v++}w&&this.tile.level-w.level<g&&this._tileLayerInfo.upsampleFromTile&&(w=null);return w};a.prototype._findAncestorWithData=function(){for(var a=
this.tile.vlevel,d=this._desiredMinLevelDelta(),c,b=this.tile;b;b=b.parent)if(b.hasLayerData(this._layerIdx,this._layerClass)){if(a-b.level>=d)return b;c=b}return c};a.prototype._setUpsampleTile=function(a){this._tileLayerInfo.setUpsampleInfo(this.tile,a);this.tile.updateRenderData(this._layerClass)};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{findNextDownload:function(){return a._findNextDownload()},tileLayerInfo:this._tileLayerInfo}},enumerable:!0,configurable:!0});
return a}();a.TileAgent=n;n=function(a){function g(){return null!==a&&a.apply(this,arguments)||this}m(g,a);g.prototype._desiredMinLevelDelta=function(){throw d;};return g}(n);a.TILE_AGENT_DONE=new n})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","../../../core/maybe","../../../core/PooledArray"],function(n,a,m,k){function h(a){return a[0]+"/"+a[1]+"/"+a[2]}function d(a,c){c(a);if(!a.isLeaf){var b=0;for(a=a.children;b<a.length;b++)d(a[b],c)}}function g(a,c,b){a=a.screenDepth;
c=c.screenDepth;return a<c?-b:a>c?b:0}Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this.q=new k;this._last=null}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!0,configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a,b){this.q.clear();this._eye=b;if(a&&(this.q.pushArray(a),m.isSome(this._eye))){var c=this._eye;this.q.sort(function(a,
b){return b.distanceToSquared(c)-a.distanceToSquared(c)})}this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){if(this._last&&!this._last.isLeaf){var a=this._last.children;if(m.isSome(this._eye)){var b=this._eye;l.pushArray(a);l.sort(function(a,c){return c.distanceToSquared(b)-a.distanceToSquared(b)});this.q.pushArray(l.data,l.length);l.clear()}else this.q.pushArray(a)}return this._last=this.q.pop()};return a}();a.IteratorPreorder=n;var l=new k;n=function(){function a(){this.q=
new k}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length},enumerable:!0,configurable:!0});a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var b=this.q.data[a];b.isLeaf||this.q.pushArray(b.children)}};a.prototype.next=function(){return this.q.pop()};return a}();a.IteratorPostorder=n;a.lij2str=h;a.tile2str=function(a){return h(a.lij)};a.traverseTilesPreorder=function(a,c){if(Array.isArray(a))for(var b=0;b<a.length;b++)d(a[b],
c);else d(a,c)};a.findParentByLIJ=function(a,c){for(;a;a=a.parent)if(a.hasLij(c))return a;return null};a.fallsWithinLayer=function(a,c,b){if(!c)return!1;var d=c.fullExtent,f=a.extent;if(b){if(f[0]<d.xmin||f[1]<d.ymin||f[2]>d.xmax||f[3]>d.ymax)return!1}else if(d.xmin>f[2]||d.ymin>f[3]||d.xmax<f[0]||d.ymax<f[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<c.minScale&&a>1.00000001*c.minScale||0<c.maxScale&&a<.99999999*c.maxScale?!1:!0};a.getTileNLevelsUp=function(a,c){for(;c--;)a=
a.parent;return a};a.getRootTile=function(a){for(;a.parent;)a=a.parent;return a};a.nextTileInAncestry=function(a,c){var b=a.lij[0]-c.lij[0]-1,d=a.lij[2]>>b,f=0;a.lij[1]>>b&1&&(f+=2);d&1&&(f+=1);return c.children[f]};a.sortTiles=function(a,c){c.sort(function(b,c){return g(b,c,a)})};a.compareTiles=g;a.computeUpsampleInfo=function(a,c,b){for(var d=1,f=0,g=0;a!==c;)if(d*=.5,f*=.5,g*=.5,a.lij[2]&1&&(f+=.5),0===(a.lij[1]&1)&&(g+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");
b.init(c,f,g,d)};a.hasVisibleSiblings=function(a){for(var c=0;c<a.length;c++){var b=a[c],d=b.parent;if(d)for(var f=0;4>f;f++){var g=d.children[f];if(g&&g!==b&&g.visible)return!0}}return!1}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/ObjectPool","./TileAgent"],function(n,a,m,k,h){return function(a){function d(){var d=a.call(this)||this;d._scaleRangeEnabled=!0;return d}m(d,a);d.prototype._desiredMinLevelDelta=
function(){return 0};d.Pool=new k(d);return d}(h.TileAgent)})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../support/stack ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../../support/Scheduler".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M){function L(a,b){for(var c=B.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(a[2]-a[0],a[3]-a[1],b[2]-b[0],b[3]-b[1]),d=0;4>d;d++)if(Math.abs(b[d]-a[d])>c)return!0;return!1}Object.defineProperty(a,"__esModule",{value:!0});var R=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],O;n=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||
this;b._handles=new g;b._overlaySR=null;b._renderSR=null;b._overlaySREqualsRenderSR=!0;b._connectedLayers=new Map;b._overlays=null;b._renderedAltitude=0;b._placementDirty=!1;b._drawTexturesDirty=!1;b._drawTexturesAnimateDirty=!1;b._isSpherical=!1;b._latestOriginId=0;b._maxResolution=l("esri-mobile")?2048:4096;b._animationTimeLast=0;b.opacity=0;return b}m(d,a);Object.defineProperty(d.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});d.prototype.initialize=
function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.renderView.getDrapedRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setDrawTexturesDirty()};this._renderer.onUpdatingChanged=function(){return a._setOverlayUpdating()};this._renderer.forceUpdate=function(b){a.updateOverlays(b);a._drawOverlayTextures()};this.groundIntersector=new I(this.view.viewingMode);this.groundIntersector.enable.backfacesTerrain=
!0;this.groundIntersector.enable.invisibleTerrain=!0;this.groundIntersector.enable.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}),this.terrainSurface.on("elevation-change",function(){return a.setOverlayPlacementDirty()}),this.view.on("resize",function(){return a.setOverlayPlacementDirty()}),this.watch("suspended",function(){return a._setOverlayUpdating()},
!0),e.addFrameTask({preRender:function(b){a.hasOverlays()&&(a._dispatchRendererUpdate(b),a._drawOverlayTextures())}}),this.view.resourceController.scheduler.registerTask(M.Task.OVERLAY_MANAGER,function(){return a.updateOverlays()},function(){return a.needsUpdate()})])};d.prototype.destroy=function(){var a=this;this._connectedLayers.forEach(function(b){return a._unregisterLayerView(b.layerView)});this._disposeOverlays();this._handles&&(this._handles.destroy(),this._handles=null)};d.prototype.onHasHighlightsChanged=
function(){this.setOverlayPlacementDirty();this.notifyChange("hasHighlights")};d.prototype.hasOverlays=function(){return!!this._overlays};d.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new K.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new K.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=
null)};d.prototype.updateLayerViews=function(a){for(var b=this,c=0,d=this.view.allLayerViews.items;c<d.length;c++){var e=d[c];"supportsDraping"in e&&e.supportsDraping&&!this._connectedLayers.has(e.uid)&&this._registerLayerView(e)}this._connectedLayers.forEach(function(c,d){c=c.layerView;a.has(d)||b._unregisterLayerView(c)})};d.prototype._registerLayerView=function(a){var b=this,c=a.uid,d=a.on("draped-data-change",function(){return b.setOverlayPlacementDirty()});this._connectedLayers.set(c,{eventHandles:[d],
layerView:a});a.setDrapingExtent&&this._overlays&&this._overlays.forEach(function(c,d){a.setDrapingExtent(d,c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin,c.pixelRatio)});this.setOverlayPlacementDirty();this._setLayerViewOverlayUpdating(a,this.layerViewOverlayUpdating)};d.prototype._unregisterLayerView=function(a){var b=this;this._connectedLayers.forEach(function(c,d){if(c.layerView===a){if(c.eventHandles)for(var e=0;e<c.eventHandles.length;e++)c.eventHandles[e].remove();b._connectedLayers.delete(d);
b.setOverlayPlacementDirty();a.destroyed||b._setLayerViewOverlayUpdating(a,!1)}})};d.prototype.setOverlayPlacementDirty=function(){this._placementDirty||(this._placementDirty=!0,this._setOverlayUpdating())};d.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=f.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+256);var c=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,b,Q);this._initOverlays();this._updateOverlay(0,Q.inner,
c,1);this._updateOverlay(1,Q.outer,c,x.width(Q.inner)/x.width(Q.outer));this.opacity=1;this.terrainSurface.updateTileOverlayParams();this._placementDirty=!1;this.setDrawTexturesDirty();this.terrainSurface.updateOverlayOpacity()}};d.prototype._updateOverlay=function(a,b,c,d){var e=this,f=this._overlays[a];if(L(b,f.extent)||c!==f.resolution||f.pixelRatio!==d)x.set(f.extent,b),f.resolution=c,f.pixelRatio=d,d=x.center(f.extent),f.renderLocalOrigin=J.fromValues(d[0],d[1],0,"OV_"+this._latestOriginId++),
this._connectedLayers.forEach(function(d){d=d.layerView;d.setDrapingExtent&&d.setDrapingExtent(a,b,e._overlaySR,c,f.renderLocalOrigin,f.pixelRatio)})};d.prototype.needsUpdate=function(){return this._placementDirty&&!!this._overlaySR&&!this._get("suspended")&&this.terrainSurface.ready};d.prototype.updateOpacity=function(a){return this._overlays?this._getAltitudeBasedOpacity(a,this._renderedAltitude):1};d.prototype._getAltitudeBasedOpacity=function(a,b){return 3.5*a<b?Math.sqrt(f.clamp((a-b/10)/(b/
3.5-b/10),0,1)):1};d.prototype.setOverlayParamsOfTile=function(a,b,c){var d=this._overlays[0],e=this._overlays[1];a=x.intersection(a.extent,a.surface.extent,Z);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),
this._invalidateTileOverlayData(b.overlays[1]));b.overlayOpacity=void 0!==c?c:1};d.prototype.overlayPixelSizeInMapUnits=function(a){if(!this._overlays)return 0;var b=this._overlays[0],c=this._overlays[1];a=this._pointIsInExtent(a,b.extent)?b:c;return(a.extent[2]-a.extent[0])/a.resolution};d.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],
e),f=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);e>f&&(e=f-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null;c.waterMaskRenderTargetId=b.waterMaskValid?b.waterMaskRenderTargetId:null};d.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null;a.waterMaskRenderTargetId=null};d.prototype._createEmptyOverlay=
function(a){var b=this._renderer.createRenderTarget("overlay"+a,!0,8,9987),c=this._renderer.createRenderTarget("overlayHighlight"+a,!1,8,9987);a=this._renderer.createRenderTarget("overlayWaterMask"+a,!0,8,9987);return{extent:x.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:c,highlightValid:!1,waterMaskRenderTargetId:a,waterMaskValid:!1,renderLocalOrigin:J.fromValues(0,0,0,"O"),pixelRatio:1}};d.prototype._initOverlays=function(){this._overlays||(this._overlays=[this._createEmptyOverlay(0),
this._createEmptyOverlay(1)])};d.prototype._disposeOverlays=function(){var a=this;this._overlays&&(this._overlays.forEach(function(b){a._renderer.disposeRenderTarget(b.renderTargetId);a._renderer.disposeRenderTarget(b.highlightRenderTargetId);a._renderer.disposeRenderTarget(b.waterMaskRenderTargetId)}),this._overlays=null)};d.prototype._dispatchRendererUpdate=function(a){var b=a.time-this._animationTimeLast;b<E.DESIRED_DRAPED_ANIMATION_MS||(this._animationTimeLast=a.time,this._renderer.updateLogic({dt:b,
camera:this._stage.getCamera()})&&(this._drawTexturesAnimateDirty=!0))};d.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty||(this._drawTexturesDirty=!0,this._setOverlayUpdating()):this.setOverlayPlacementDirty()};d.prototype._intersectGroundFromView=function(a,b,c,d){var e=p.createRenderScreenPointArray3(b*a.fullWidth,c*a.fullHeight,1),e=a.unprojectPoint(e,N.sv3d.get());b=p.createRenderScreenPointArray3(b*a.fullWidth,c*a.fullHeight,0);b=a.unprojectPoint(b,N.sv3d.get());
this.groundIntersector.intersect([],b,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundIntersector,null,b,e);return this.groundIntersector.results.min.getIntersectionPoint(d)};d.prototype._setLayerViewOverlayUpdating=function(a,b){"overlayUpdating"in a&&(a.overlayUpdating=b)};Object.defineProperty(d.prototype,"layerViewOverlayUpdating",{get:function(){return this.needsUpdate()||this._drawTexturesDirty||this._renderer.updating},enumerable:!0,configurable:!0});d.prototype._setOverlayUpdating=
function(){var a=this,c=this.layerViewOverlayUpdating;this._connectedLayers.forEach(function(b){return a._setLayerViewOverlayUpdating(b.layerView,c)});var d=this.view.graphicsView;b.isSome(d)&&(d.overlayUpdating=c)};d.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=u.vec3f64.clone(a.eye);w.vec3.normalize(d,d);w.vec3.negate(d,d);b=w.vec3.length(b);b=Math.asin(b/w.vec3.length(a.eye));var e=Math.acos(w.vec3.dot(a.viewForward,d)),d=f.clamp((b-
(e-.5*a.fovY))/a.fovY,0,1);b=f.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=y.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),d=v.vec4.transformMat4(d,d,a.projectionMatrix)[1],d=f.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};d.prototype._computeOverlayExtents=function(a,b,d){var e=this.terrainSurface.extent,f=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
g=u.vec3f64.create();this._findHorizonBasedPointOfInterest(a,f,g)||w.vec3.copy(g,f);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(a.eye);var l=w.vec3.distance(a.eye,g),f=A.viewAngle(this.view.renderCoordsHelper,f,a.eye),f=Math.PI/2-Math.abs(f-Math.PI/2);if(G.OVERLAY_SHOW_CENTER){var k=new z({color:[255,0,0],outline:{color:[255,255,255],width:2}}),m=new t;H.vectorToPoint(g,this._renderSR,m,this._overlaySR);k=new h({geometry:m,symbol:k});void 0!==O&&this.view.graphics.remove(O);this.view.graphics.add(k);
O=k}this._overlaySREqualsRenderSR||H.vectorToVector(g,this._renderSR,g,this._overlaySR);b=b*a.perRenderPixelRatio*l/2;m=!1;l=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(b/=Math.cos(H.webMercator.y2lat(g[1])),l=this.terrainSurface.extent[3],l*=.999):(m=!0,b/=F.metersPerDegree,l=90),b>=l&&(b=l,g[1]=0,this._overlaySR.isWebMercator&&(g[0]=0)));k=1;m&&(k=1/Math.max(.2,Math.cos(Math.abs(c.deg2rad(g[1])))),180<b*k&&(k=180/b));var p=b*k,m=d.inner;m[0]=g[0]-p;m[1]=g[1]-b;m[2]=g[0]+p;m[3]=g[1]+
b;this._isSpherical&&this._shiftExtentToFitBounds(m,Infinity,l);d=d.outer;x.set(d,m);6*p>e[2]-e[0]?x.set(d,e):f<=.25*Math.PI?(d[0]-=p,d[1]-=b,d[2]+=p,d[3]+=b):(H.vectorToVector(a.eye,this._renderSR,W,this._overlaySR),r.vec2.subtract(V,g,W),a=-Math.atan2(V[1],V[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),v.vec4.scale(V,R[Math.floor(a/(.25*Math.PI))],2*b),V[0]*=k,V[2]*=k,v.vec4.add(d,d,V));this._isSpherical&&(d[0]=this._longitudeCyclical.clamp(d[0]),d[2]=this._longitudeCyclical.clamp(d[2]),d[1]=Math.max(d[1],
-l),d[3]=Math.min(d[3],l));!this._isSpherical&&e&&(a=x.intersection(m,e,Z),e=x.intersection(d,e,X),x.contains(a,e)&&(d[2]=d[0],d[3]=d[1]))};d.prototype._drawOverlayTextures=function(){if(this._drawTexturesDirty||this._drawTexturesAnimateDirty){var a=this._drawOverlay(0),b=this._drawOverlay(1);0!==a&&0!==b||this.terrainSurface.updateTileOverlayParams();this._drawTexturesDirty?(this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1,this._setOverlayUpdating(),this.terrainSurface.requestRender(),this.terrainSurface.setPendingUpdates()):
(this._drawTexturesAnimateDirty=!1,this._setOverlayUpdating(),this.terrainSurface.requestRender(0))}};d.prototype._drawOverlay=function(a){var b=this._overlays[a],c=b.valid,d=b.highlightValid,e=b.waterMaskValid,f=b.extent,g=b.resolution,h=b.pixelRatio,l=this._longitudeCyclical?f[2]>this._longitudeCyclical.max:!1,k=this._longitudeCyclical?f[0]<this._longitudeCyclical.min:!1;if(l||k){T.views=P;var k=Math.round((l?this._longitudeCyclical.max-f[0]:this._longitudeCyclical.min-f[0])/(f[2]-f[0])*g),m=T.views[0];
v.vec4.set(m.viewport,0,0,k,g);v.vec4.set(m.extent,f[0],f[1],this._longitudeCyclical.max,f[3]);l||(m.extent[0]+=this._longitudeCyclical.range);m=T.views[1];v.vec4.set(m.viewport,k,0,g-k,g);v.vec4.set(m.extent,this._longitudeCyclical.min,f[1],f[2],f[3]);l&&(m.extent[2]-=this._longitudeCyclical.range)}else T.views=U,x.set(T.views[0].extent,f),v.vec4.set(T.views[0].viewport,0,0,g,g);T.width=g;T.height=g;T.pixelRatio=h*this.view.state.camera.pixelRatio;T.index=a;g=this._renderer;a=g.draw(b.renderTargetId,
T);f=g.drawHighlights(b.highlightRenderTargetId,T);g=g.drawNormals(b.waterMaskRenderTargetId,T);b.valid=a;b.highlightValid=f;b.waterMaskValid=g;return a!==c||f!==d||g!==e?0:1};d.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):x.intersects(a,b)};d.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?
this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:x.contains(b,a)};d.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};d.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);x.offset(a,d,e)};Object.defineProperty(d.prototype,
"test",{get:function(){return{overlays:this._overlays,renderer:this._renderer}},enumerable:!0,configurable:!0});k([q.property()],d.prototype,"view",void 0);k([q.property()],d.prototype,"terrainSurface",void 0);k([q.property({readOnly:!0,aliasOf:"terrainSurface.suspended"})],d.prototype,"suspended",void 0);k([q.property({type:Boolean})],d.prototype,"hasHighlights",null);return d=k([q.subclass("esri.views.3d.terrain.OverlayManager")],d)}(q.declared(d));a.OverlayManager=n;var T={width:0,height:0,pixelRatio:0,
views:null,index:0},U=[{viewport:x.create(),extent:x.create()}],P=[U[0],{viewport:x.create(),extent:x.create()}],V=y.vec4f64.create(),W=u.vec3f64.create(),Q={inner:x.create(),outer:x.create()},Z=x.create(),X=x.create()})},"esri/views/3d/support/animationUtils":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.DESIRED_ANIMATION_FPS=25;a.DESIRED_ANIMATION_MS=1E3/a.DESIRED_ANIMATION_FPS;a.DESIRED_DRAPED_ANIMATION_FPS=20;a.DESIRED_DRAPED_ANIMATION_MS=
1E3/a.DESIRED_DRAPED_ANIMATION_FPS})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.fromVector=function(a,h){return{vec3:m.vec3f64.clone(a),id:h}};a.fromValues=function(a,h,d,g){return{vec3:m.vec3f64.fromValues(a,h,d),id:g}}})},"esri/views/3d/terrain/PlanarPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),
function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function c(b,d,f){var e=a.call(this,c.NumSubdivisionsAtLevel)||this;void 0!==b&&e.init(b,d,f);return e}m(c,a);c.prototype.init=function(b,c,d){a.prototype.init.call(this,b,c,d);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=k.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=k.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=
0;this.updateRadiusAndCenter()};c.prototype.updateRadiusAndCenter=function(){this._updateCenter();var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,c=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(a*a+c*c)};c.prototype._isVisible=function(){return this.intersectsClippingArea&&d.frustum.intersectsAABB(this.surface.frustum.planes,h.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};c.prototype.createGeometry=
function(a,c){g.createPlanarGlobePatch(a,this.extent,c,this.renderData);this.setMemoryDirty()};c.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return c}(l.Tile);a.PlanarPatch=n})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../support/earthUtils ../support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=x.get(f);if(!g){var g=b-1,h=b-1,l=b*b,k=2*g+2*h,m=g*h*6,p=6*k,n=6*(2*g+h-1);d&&(m*=2,p*=2,n*=2);for(var k=65536<l+k?new Uint32Array(m+p):new Uint16Array(m+p),q=0,r=0,u=m,w,t,y,z,A=0,B=0;B<=h;B++){e&&(A=0===B?n:B===h?-n:0);for(var u=u+A,E=0;E<=g;E++)y=v(E,B,g,h),-1<y&&(z=0===B&&E!==g?1:E===g&&B!==h?g+1:B===h&&0!==E?-1:0===E&&0!==B?-(g+1):0,0!==z&&(w=q,t=l+y,y=l+(0===E&&1===B?0:y+1),z=q+z,d?(k[u+0]=w,
k[u+1]=t,k[u+2]=t,k[u+3]=y,k[u+4]=y,k[u+5]=w,k[u+6]=y,k[u+7]=z,k[u+8]=z,k[u+9]=w,k[u+10]=w,k[u+11]=y,u+=12):(k[u+0]=w,k[u+1]=t,k[u+2]=y,k[u+3]=y,k[u+4]=z,k[u+5]=w,u+=6))),++q,E<g&&B<h&&(w=B*(g+1)+E,t=w+1,y=t+(g+1),z=y-1,d?(k[r+0]=w,k[r+1]=t,k[r+2]=t,k[r+3]=y,k[r+4]=y,k[r+5]=w,k[r+6]=y,k[r+7]=z,k[r+8]=z,k[r+9]=w,k[r+10]=w,k[r+11]=y,r+=12):(k[r+0]=w,k[r+1]=t,k[r+2]=y,k[r+3]=y,k[r+4]=z,k[r+5]=w,r+=6));u-=A}g={values:k,numSurfaceIndices:m,numSkirtIndices:p};x.set(f,g)}a.indices=g.values;a.numSurfaceIndices=
g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function w(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function u(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function v(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(a,"__esModule",{value:!0});var y=c.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0),
t=new f.BufferPool(function(a){return y.createBuffer(a)},function(a){return a.count});a.clearCaches=function(){t.clear();x.clear()};a.releaseGeometry=function(a){t.release(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};a.createSphericalGlobePatch=function(a,c,f,h,k,p,n){var q=k[0],y=k[1],x=k[2];k=k[3];var z=.1*l.earthRadius*(k-y),M=a.numVertsPerRow-1,L=a.numVertsPerRow-1,J=a.numVertsPerRow*a.numVertsPerRow,H=t.acquire(J+(2*M+2*L)),F=H.position.typedBuffer,R=H.uv0.typedBuffer,I=h.geometryInfo.boundingBox;
g.empty(I);var N=c[2]-c[0],K=c[3]-c[1],ia=x-q,x=f[0],ba=f[1];f=f[2];for(var oa=0;oa<=M;oa++){var ha=oa/M,la=q+ha*ia;A[oa]=Math.sin(la);E[oa]=Math.cos(la);B[oa]=ha;G[oa]=c[0]+ha*N}q=p&&!!(n&1);N=p&&!!(n&2);for(la=ia=0;la<=L;la++){var ra=la/L,oa=m.lerp(y,k,ra),va=Math.cos(oa),ja=Math.sin(oa),pa=void 0;p?(pa=l.halfEarthRadius*Math.log((1+ja)/(1-ja)),ra=(pa-c[1])/K):pa=180*oa/Math.PI;for(oa=0;oa<=M;oa++){var ha=B[oa],C=A[oa],ua=E[oa],wa=l.earthRadius;a.samplerData&&(wa+=b.sample(G[oa],pa,a.samplerData)||
0);ua=ua*va*wa-x;C=C*va*wa-ba;wa=ja*wa-f;w(ua,C,wa,I);var D=e.GEOMETRY_VERTEX_STRIDE*ia;F[D+0]=ua;F[D+1]=C;F[D+2]=wa;R[D+0]=ha;R[D+1]=ra;D=v(oa,la,M,L);if(-1<D){var D=e.GEOMETRY_VERTEX_STRIDE*(J+D),qa=q&&0===la?-1:N&&la===L?1:0,ua=0===qa?ua:-x,C=0===qa?C:-ba,wa=0===qa?wa:l.earthRadius*qa-f;F[D+0]=ua;F[D+1]=C;F[D+2]=wa;R[D+0]=0===qa?u(ha,ra):ha;R[D+1]=0===qa?z:ra;0!==qa&&w(ua,C,wa,I)}++ia}}h.geometryInfo.numVertsPerRow=a.numVertsPerRow;h.geometryInfo.vertexAttributes=H;h.geometryInfo.skirtLength=z;
d.vec4.set(h.geometryInfo.uvOffsetAndScale,0,0,1,1);r(h.geometryInfo,a.numVertsPerRow,p?n:0,a.wireframe)};a.createPlanarGlobePatch=function(a,c,f,h){var l=c[0],k=c[1],m=c[2]-l,p=c[3]-k,n=a.clippingArea,q=n?Math.max(0,(n[0]-c[0])/m):0,y=n?Math.max(0,(n[1]-c[1])/p):0,x=n?Math.min(1,(n[2]-c[0])/m):1;c=n?Math.min(1,(n[3]-c[1])/p):1;var z=x>q?1/(x-q):1,A=c>y?1/(c-y):1,B=-q*z,E=-y*A,J=.1*m,F=a.numVertsPerRow-1,H=a.numVertsPerRow-1,G=a.numVertsPerRow*a.numVertsPerRow,I=t.acquire(G+(2*F+2*H)),K=I.position.typedBuffer,
N=I.uv0.typedBuffer,ha=h.geometryInfo.boundingBox;g.empty(ha);for(var la=0,ra=0;ra<=H;ra++){var va=ra/H,ja=E+va*A,va=k+va*p;n&&(va<n[1]?(va=n[1],ja=0):va>n[3]&&(va=n[3],ja=1));for(var pa=0;pa<=F;pa++){var C=pa/F,ua=B+C*z,C=l+C*m;n&&(C<n[0]?(C=n[0],ua=0):C>n[2]&&(C=n[2],ua=1));var wa=a.samplerData?b.sample(C,va,a.samplerData)||0:0,C=C-f[0],D=va-f[1],wa=wa-f[2];w(C,D,wa,ha);var qa=e.GEOMETRY_VERTEX_STRIDE*la;K[qa+0]=C;K[qa+1]=D;K[qa+2]=wa;N[qa+0]=ua;N[qa+1]=ja;qa=v(pa,ra,F,F);-1<qa&&(qa=e.GEOMETRY_VERTEX_STRIDE*
(G+qa),K[qa+0]=C,K[qa+1]=D,K[qa+2]=wa,N[qa+0]=u(ua,ja),N[qa+1]=J);++la}}h.geometryInfo.numVertsPerRow=a.numVertsPerRow;h.geometryInfo.vertexAttributes=I;h.geometryInfo.skirtLength=J;d.vec4.set(h.geometryInfo.uvOffsetAndScale,q,y,x-q,c-y);r(h.geometryInfo,a.numVertsPerRow,0,a.wireframe)};var x=new Map,z=Math.pow(2,-52);a.intersectSkirts=function(a,b,c,d,e,f,g,h){var l=f.position;f=f.uv0;var m=a[0],p=a[1];a=a[2];var n=b[0]-m,r=b[1]-p;for(b=b[2]-a;c<d;c++){var u=3*c,w=3*c+1,t=3*c+2,v=l.get(e[u],0),y=
l.get(e[u],1),x=l.get(e[u],2),A=l.get(e[w],0),B=l.get(e[w],1),E=l.get(e[w],2),M=l.get(e[t],0),L=l.get(e[t],1),J=l.get(e[t],2),u=f.get(e[u],0),w=f.get(e[w],0),t=f.get(e[t],0);2<=u&&(k.vec3.set(F,v,y,x),g(F),v+=F[0],y+=F[1],x+=F[2]);2<=w&&(k.vec3.set(F,A,B,E),g(F),A+=F[0],B+=F[1],E+=F[2]);2<=t&&(k.vec3.set(F,M,L,J),g(F),M+=F[0],L+=F[1],J+=F[2]);var A=A-v,B=B-y,E=E-x,M=M-v,L=L-y,J=J-x,u=r*J-L*b,w=b*M-J*n,H=n*L-M*r,t=A*u+B*w+E*H,v=m-v,R=p-y,G=a-x,x=R*E-B*G,y=G*A-E*v,I=v*B-A*R;if(t>z){v=v*u+R*w+G*H;if(0>
v||v>t)continue;u=n*x+r*y+b*I;if(0>u||v+u>t)continue}else if(t<-z){v=v*u+R*w+G*H;if(0<v||v<t)continue;u=n*x+r*y+b*I;if(0<u||v+u<t)continue}else continue;x=(M*x+L*y+J*I)/t;0<=x&&(A=q.computeNormal(A,B,E,M,L,J,K),h(x,A,c))}};var A=Array(e.MAX_PATCH_TESSELATION+1),E=Array(e.MAX_PATCH_TESSELATION+1),B=Array(e.MAX_PATCH_TESSELATION+1),G=Array(e.MAX_PATCH_TESSELATION+1),F=h.vec3f64.create(),K=h.vec3f64.create()})},"esri/views/3d/support/buffer/BufferPool":function(){define(["require","exports","../../../../core/PooledArray"],
function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d){this._factoryCallback=a;this._lengthCallback=d;this._pool=new Map}a.prototype.acquire=function(h){if(!a.test.disabled){var d=this._pool.get(h);if(d&&0!==d.length)return d.pop()}try{return this._factoryCallback(h)}catch(l){var d=window.performance&&window.performance.memory,g="";d&&(g="\n  totalJSHeapSize: "+d.totalJSHeapSize+", usedJSHeapSize: "+d.usedJSHeapSize+", jsHeapSizeLimit: "+d.jsHeapSizeLimit);console.log("Array allocation of size "+
h+" failed: "+l+g);throw l;}};a.prototype.release=function(h){if(!a.test.disabled){var d=this._lengthCallback(h),g=this._pool.get(d);g||(g=new m({shrink:!0}),this._pool.set(d,g));g.push(h)}};a.prototype.clear=function(){this._pool.clear()};Object.defineProperty(a.prototype,"test",{get:function(){return{size:this._pool.size}},enumerable:!0,configurable:!0});a.test={disabled:!1};return a}();a.BufferPool=n})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../2d/engine/vectorTiles/VectorTileDisplayObject ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../webgl/Texture ../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A){function E(a){a.dispose();a instanceof r?r.Pool.release(a):a instanceof w&&w.Pool.release(a)}Object.defineProperty(a,"__esModule",{value:!0});var B=v.weakAssert,G=f.vec3f64.create(),F=f.vec3f64.create(),K=b.vec4f64.create();n=function(){return function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}}();a.SplitLimits=n;n=function(){function a(a){this._numSubdivisionAtLevel=
a;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this.extent=e.create();this._elevationBounds=g.vec2f64.create();this.layerInfo=Array(2);this.extentInRadians=e.create();this.centerAtSeaLevel=f.vec3f64.create();this._center=f.vec3f64.create();this.up=f.vec3f64.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._maxTesselation=0;this._usedMemory=N;this._curvatureHeight=this._radius=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=
0}Object.defineProperty(a.prototype,"usedMemory",{get:function(){for(var a=0,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b].data;d instanceof p&&(a+=d.getMemoryUsage())}this._usedMemory===N&&this._updateMemoryUsed();return this._usedMemory+a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxTesselation",{get:function(){return this._maxTesselation},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"intersectsClippingArea",{get:function(){return this._intersectsClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"clippingArea",{get:function(){return this._clippingArea},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"surface",{get:function(){return this._surface},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"level",{get:function(){return this.lij[0]},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"edgeLen",{get:function(){return this._edgeLen},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){if(this._dirty){var a=this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this._visible=a);this._dirty=!1}return this._visible},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"rendered",{get:function(){return!!this.renderData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"shouldRender",{get:function(){if(!this.visible)return!1;if(this.surface.reduceTileLevelDifferences){var a=this.level-this._surface.snapLevel;if(0===a)return!0;if(1===a)return!1}return this.isLeaf},enumerable:!0,configurable:!0});a.prototype.init=function(a,b,c){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];c.tilingScheme.getExtent(a[0],a[1],a[2],this.extent,this.extentInRadians);
this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._radius=this._edgeLen2=this._edgeLen=0;this.vlevel=a?a[0]:0;b&&b._elevationBounds?d.vec2.copy(this._elevationBounds,b.elevationBounds):d.vec2.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._visible=!1;this._parent=b;this.unsetChildren();this._surface=c;this.updateVisibility();for(a=0;2>a;a++){b=c.numLayers(a);var e=this.layerInfo[a];this.layerInfo[a]?e.length=
b:(e=Array(b),this.layerInfo[a]=e);for(var f=0;f<b;f++)e[f]=t.TilePerLayerInfo.makeEmptyLayerInfo(a,this._surface.upsampleInfoPool,e[f]),0===a&&this.findElevationBoundsForLayer(f,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(c.tilingScheme.pixelSize,u.MAX_PATCH_TESSELATION)};a.prototype.dispose=function(){B(!this.renderData,"tile.renderData was not unloaded");for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this._surface=this._parent=null;this._usedMemory=
N};a.prototype.setMemoryDirty=function(){this._usedMemory=N};a.prototype._updateMemoryUsed=function(){for(var a=this._surface.tilingScheme.pixelSize,a=a*a*4,b=this._usedMemory=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b],d=d.data;d instanceof z?this._usedMemory+=A.getGpuMemoryUsage(d):d instanceof HTMLImageElement&&(this._usedMemory+=a)}b=0;for(c=this.layerInfo[0];b<c.length;b++)d=c[b],this._usedMemory+=d.data?a:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,
a=this.renderData.textureDescriptor)&&(this._usedMemory+=A.getGpuMemoryUsage(a))};a.prototype.updateScreenDepth=function(a){l.vec3.copy(K,this._center);K[3]=1;c.vec4.transformMat4(K,K,a);this.screenDepth=K[2]/K[3]};a.prototype.shouldSplit=function(a,b,c){var d=this.level;l.vec3.subtract(G,this._center,b);var e=l.vec3.squaredLength(G);if(this._edgeLen2>e&&d<a.maxLod||this.surface.reduceTileLevelDifferences&&0===c&&1===this._surface.snapLevel-d)return 1;c=Math.sqrt(e);var f=l.vec3.dot(this.up,G),e=
this._elevationBounds[1]-this._elevationBounds[0],g=e/this.edgeLen;if(this.surface.reduceTileLevelDifferences&&a.aboveGround&&0<f&&.001>g&&0<f/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-g)return 0;g=this._edgeLen/(a.fovX*c*2);return g<a.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,2):0:d>=a.maxLod?(a=d+Math.ceil(-k.log2(a.relativeWidthLimit/g)),a!==this.vlevel?(this.vlevel=a,2):0):6<d&&(l.vec3.scale(F,this.up,f),l.vec3.subtract(F,F,G),d=l.vec3.squaredLength(F),
d>this._radius*this._radius&&(l.vec3.scale(F,F,this._radius/Math.sqrt(d)),l.vec3.add(F,F,this._center),l.vec3.subtract(F,b,F),Math.min(1,(Math.abs(l.vec3.dot(F,this.up))+.5*e+this._curvatureHeight)/l.vec3.length(F))*(this._edgeLen/(a.fovY*c*2))<.1/a.angledSplitBias*a.relativeHeightLimit))?0:1};a.prototype.setChildren=function(a,b,c,d){B(!!(a&&b&&c&&d),"Null child passed");this._children[0]=a;this._children[1]=b;this._children[2]=c;this._children[3]=d};a.prototype.unsetChildren=function(){this._children[0]=
null;this._children[1]=null;this._children[2]=null;this._children[3]=null};a.prototype.load=function(a){for(var b=null==this.renderData&&a.loadCachedElevationData(this),c=0;2>c;c++){var d=this.layerInfo[c];if(d)if(0===c&&b)for(var e=0;e<d.length;e++)d[e].loadingAgent=y.TILE_AGENT_DONE;else this._createOrUpdateAgents(0,c)}a.loadTile(this)};a.prototype.unload=function(a){a.unloadTile(this,this.elevationDone);for(a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];d.loadingAgent&&
d.loadingAgent!==y.TILE_AGENT_DONE&&(E(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.resetPendingUpdate(16);this.resetPendingUpdate(32)};a.prototype.updateClippingStatus=function(a){if(e.equals(a,this._clippingArea))return!1;var b=this._intersectsClippingArea,c=this._isWithinClippingArea;a?(this._intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=a;this.updateVisibility();
a=c&&this._isWithinClippingArea;b=!c&&!b&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||a||b||this.setPendingUpdate(16);return!0};a.prototype.updateVisibility=function(){this._dirty=!0;this._surface.setPendingUpdates()};a.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};a.prototype.hasLayerData=function(a,b){a=this.layerInfo[b][a];return!(!a||!a.data||a.dataInvalidated)};a.prototype.hasDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?
"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};Object.defineProperty(a.prototype,"updating",{get:function(){if(this.hasPendingUpdates)return!0;for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];if(d.loadingAgent&&d.loadingAgent!==y.TILE_AGENT_DONE&&d.loadingAgent.updating)return!0}return!1},enumerable:!0,configurable:!0});a.prototype.isSuspended=function(a){return this.hasPendingUpdate(1)?!0:0===a?!1:!this.visible};Object.defineProperty(a.prototype,"elevationDone",
{get:function(){if(this.hasPendingUpdate(16))return!1;for(var a=0,b=this.layerInfo[0];a<b.length;a++){var c=b[a];if(c.loadingAgent!==y.TILE_AGENT_DONE||!c.upsampleFromTile)return!1}return!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0});a.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};a.prototype.setPendingUpdate=function(a){this._pendingUpdates|=a;this._surface.setPendingUpdates()};
a.prototype.resetPendingUpdate=function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};a.prototype.requestLayerData=function(a,b,c){u.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);
if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),c.dataArrived(this),!0;if(d.requestPromise)return!0;d.requestAbort=h.createAbortController();var e=this._surface.requestTileData(this,a,b,d.requestAbort);if(!e)return d.requestAbort=null,!1;a=function(){d.requestPromise===e&&(d.requestPromise=null,d.requestAbort=null)};d.requestPromise=e;e.then(a,a);return!!d.requestPromise};Object.defineProperty(a.prototype,
"isLeaf",{get:function(){return null==this._children[0]},enumerable:!0,configurable:!0});a.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};a.prototype.findByLij=function(a){return this.hasLij(a)?this:this.isLeaf?null:(a=this._children[0].findByLij(a)||this._children[1].findByLij(a)||this._children[2].findByLij(a)||this._children[3].findByLij(a))?a:null};a.prototype.distanceToSquared=function(a){return l.vec3.squaredLength(l.vec3.subtract(F,this._center,
a))};a.prototype.containsPoint=function(a){var b=this.extent;return a[0]>=b[0]&&a[1]>=b[1]&&a[0]<=b[2]&&a[1]<=b[3]};a.prototype.unrequestLayerData=function(a,b,c){u.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],e=d.waitingAgents;c=null!=m.removeUnordered(e,c);B(c,"agent has not requested this piece of map data");1>e.length&&(d.abortRequest(),u.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",
this.lij.toString(),b,a),this._updateMemoryUsed())};a.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this._updateMemoryUsed()};a.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);
a.waitingAgents.length=0;this._updateMemoryUsed()};a.prototype.updateRenderData=function(a){switch(a){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};a.prototype.updateTexture=function(){this.renderData&&this.setPendingUpdate(32)};a.prototype.updateGeometry=function(){this.setPendingUpdate(16);for(var a=0,b=this.layerInfo[0];a<b.length;a++)b[a].pendingUpdates|=16;this._surface.setPendingUpdates()};a.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();
this.restartAgents(b)};a.prototype.computeElevationBounds=function(){d.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=!0,b=0,c=this.layerInfo[0];b<c.length;b++){var e=c[b];e.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],e.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],e.elevationBounds.max),e.elevationBounds.hasNoDataValues||(a=!1))}a&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=
Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter()};a.prototype._updateCenter=function(){l.vec3.scale(F,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));l.vec3.add(this._center,this.centerAtSeaLevel,F)};a.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[0][a];if(!c.elevationBounds||c.elevationBounds.level<b)if(b=this._surface.layerViewByIndex(a,0),x.fallsWithinLayer(this,b.layer,!1)){b=H;var d=!1;if(c.data){var e=c.data;b.min=e.bounds[0];b.max=
e.bounds[1];b.hasNoDataValues=e.hasNoDataValues;b.level=this.lij[0];d=!0}else{for(var f=0,g=void 0,e=void 0,h=this._parent;h&&(!e||f<u.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(f=this.vlevel-h.level,g=e||g,e=h.layerInfo[0][a].data,!e&&g&&f>=u.ELEVATION_DESIRED_RESOLUTION_LEVEL);h=h._parent);if(e=e||g)e.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],b),Infinity!==b.min&&(b.level=e.level,d=!0)}d&&(c.elevationBounds||(c.elevationBounds=new q.ElevationBounds),c.elevationBounds.copyFrom(b))}};a.prototype.modifyLayers=
function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var f=d[e];f.loadingAgent&&f.loadingAgent!==y.TILE_AGENT_DONE&&(E(f.loadingAgent),f.loadingAgent=null);f.waitingAgents.length=0}if(1===c)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;f=Array(a);for(e=0;e<a;e++){var g=b[e];f[e]=-1<g?d[g]:t.TilePerLayerInfo.makeEmptyLayerInfo(c,this._surface.upsampleInfoPool)}this.layerInfo[c]=f;this._updateMemoryUsed()};a.prototype.restartAgents=function(a){this.renderData&&(this._createOrUpdateAgents(0,
a),this.updateRenderData(a))};a.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===y.TILE_AGENT_DONE&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};a.prototype.updateAgentSuspension=function(){for(var a=0;2>a;a++)for(var b=this.isSuspended(a),c=0,d=this.layerInfo[a];c<d.length;c++){var e=d[c];e.loadingAgent&&e.loadingAgent!==y.TILE_AGENT_DONE&&(e.loadingAgent.setSuspension(b),e.loadingAgent===y.TILE_AGENT_DONE&&
this.updateRenderData(a))}};a.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==y.TILE_AGENT_DONE&&a.loadingAgent.dispose();a.loadingAgent=null};a.prototype.agentDone=function(a,b){var c=this.layerInfo[b][a];c.loadingAgent=y.TILE_AGENT_DONE;c.data||c.upsampleFromTile||this._createOrUpdateAgents(a+1,b)};a.prototype._createOrUpdateAgents=function(a,b){for(var c=this.isSuspended(b),d=this.layerInfo[b];a<d.length;++a){var e=d[a],f=!1,g=this._surface.layerViewByIndex(a,
b);if(e.loadingAgent)x.fallsWithinLayer(this,g.layer,!1)?(e.loadingAgent!==y.TILE_AGENT_DONE&&e.loadingAgent.setSuspension(c),e.loadingAgent!==y.TILE_AGENT_DONE&&(f=e.loadingAgent.update())):e.dispose();else if(x.fallsWithinLayer(this,g.layer,!1)){var f=e,h=a,l=b,k=c,m=0===l?r.Pool.acquire():w.Pool.acquire();m.init(this,h,l,k);f.loadingAgent=m;(f=e.loadingAgent.startLoading())?e.loadingAgent===y.TILE_AGENT_DONE&&this.setPendingUpdate(16):(E(e.loadingAgent),e.loadingAgent=y.TILE_AGENT_DONE)}e.loadingAgent===
y.TILE_AGENT_DONE&&this.updateRenderData(b);if(f&&g.isOpaque)break}};a.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};a.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return a}();a.Tile=n;var H=new q.ElevationBounds,N=-1})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(n,a,m,k,h,d,g,l){function f(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function c(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function b(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function e(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function p(){w={};for(var a in d.esriBasemapDefinitions)d.esriBasemapDefinitions[a].baseMapLayers.forEach(function(a){return w[a.url]=19});w["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function q(a,b,c,d){return r["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(a,"__esModule",{value:!0});var r={planar:g,spherical:l};a.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};a.autoUpdateSkirtsVisibility=function(a,b,c){var d=r[a.manifold],e,f=d.isInsideExtent(a,b);f?e=a.getElevation(b):(e=a.elevationBounds,e=.5*(e.min+e.max));e=b[2]-e;c=.9*Math.abs(e)<c?0:0>e?-1:1;f||(d.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?
(b=d.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};a.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};a.isVectorTileLayer=function(a){return a&&a.isInstanceOf(h)};a.isTileLayerView=f;a.isVectorTileLayerView=c;a.isWMTSLayerView=b;a.isElevationLayerView=e;a.isTiledLayerView=
function(a){return a&&(f(a)||e(a)||c(a)||b(a))};a.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===k.prototype.fetchTile||a.fetchTile===m.prototype.fetchTile)};var w=null;a.getKnownTiledServiceLevelCap=function(a){w||p();a=a&&a.replace(/https?:/,"");return a in w?w[a]:Infinity};a.prepareKnownTiledServiceLevelCaps=p;a.checkIfTileInfoSupportedForView=q;a.getTiledLayerInfo=function(b,c,d){var e,f;if("wmts"===b.type){if(b=b.activeLayer){var g=b.tileMatrixSet;if(g)e=g.tileInfo,f=g.fullExtent;
else if(b=b.tileMatrixSets)if(b=b.find(function(a){return null==q(a.tileInfo,a.fullExtent,c,d)}))return{tileInfo:b.tileInfo,fullExtent:b.fullExtent}}}else e="vector-tile"!==b.type||a.test.force512VTL?b.tileInfo:b.compatibleTileInfo256,f=b.fullExtent;return e&&f&&null==q(e,f,c,d)?{tileInfo:e,fullExtent:f}:{tileInfo:null,fullExtent:null}};a.test={force512VTL:!1}})},"esri/layers/ElevationLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercWorker".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A){var E=c.getLogger("esri.layers.ElevationLayer");return function(a){function c(b){b=a.call(this)||this;b.copyright=null;b.heightModelInfo=null;b.path=null;b.opacity=1;b.operationalLayerType="ArcGISTiledElevationServiceLayer";b.sourceJSON=null;b.type="elevation";b.url=null;b.version=null;b._lercWorker=A.acquireInstance();return b}k(c,a);c.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?m({url:a},b):a};c.prototype.destroy=function(){A.releaseInstance(this._lercWorker);
this._lercWorker=null};Object.defineProperty(c.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&E.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&E.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});c.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=9.3);
return a};c.prototype.load=function(a){var c=this,d=b.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var b=0;b<a.typeKeywords.length;b++)if("elevation 3d layer"===a.typeKeywords[b].toLowerCase())return!0;throw new f("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}},a).then(function(){return c._fetchImageService(d)},
function(){return c._fetchImageService(d)}));return this.when()};c.prototype.fetchTile=function(a,b,c,d){var e=this;void 0===d&&(d={});null!=d&&"number"===typeof d&&(E.warn("Passing noDataValue directly as a parameter is deprecated, use { noDataValue } options object instead (since 4.12)"),d={noDataValue:d});var f={responseType:"array-buffer",signal:d.signal},g={noDataValue:d.noDataValue,returnFileInfo:!0};return this.load().then(function(){return e._fetchTileAvailability(a,b,c,d)}).then(function(){return l(e.getTileUrl(a,
b,c),f)}).then(function(a){return e._lercWorker.decode(a.data,g,d.signal)}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};c.prototype.getTileUrl=function(a,b,c){var d=q.objectToQuery(m({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+b+"/"+c+(d?"?"+d:"")};c.prototype.queryElevation=function(a,
b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(c,a,b)})};c.prototype.createElevationSampler=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(c,a,b)})};c.prototype.importLayerViewModule=function(a){return g(this,void 0,void 0,function(){return d(this,function(b){switch(a.type){case "2d":return[2,p.reject(new f("elevation-layer:view-not-supported","ElevationLayer is only supported in 3D"))];
case "3d":return[2,p.create(function(a){return n(["../views/3d/layers/ElevationLayerView3D"],a)})]}return[2]})})};c.prototype._fetchTileAvailability=function(a,b,c,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,c,d):p.resolve("unknown")};c.prototype._fetchImageService=function(a){return g(this,void 0,void 0,function(){var b,c;return d(this,function(d){switch(d.label){case 0:if(this.sourceJSON)return[2,this.sourceJSON];b={query:m({f:"json"},this.parsedUrl.query),responseType:"json",
signal:a};return[4,l(this.parsedUrl.path,b)];case 1:return c=d.sent(),c.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=c.data,this.read(c.data,{origin:"service",url:this.parsedUrl}),[2]}})})};c.prototype._importElevationQuery=function(){return p.create(function(a){n(["./support/ElevationQuery"],a)})};h([r.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);h([r.property({readOnly:!0,type:w})],c.prototype,"heightModelInfo",void 0);h([r.property({type:String,
json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,"path",void 0);h([r.property({type:["show","hide"]})],c.prototype,"listMode",void 0);h([r.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],c.prototype,"minScale",null);h([r.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],c.prototype,"maxScale",null);
h([r.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],c.prototype,"opacity",void 0);h([r.property({type:["ArcGISTiledElevationServiceLayer"]})],c.prototype,"operationalLayerType",void 0);h([r.property()],c.prototype,"sourceJSON",void 0);h([r.property({json:{read:!1},value:"elevation",readOnly:!0})],c.prototype,"type",void 0);h([r.property(z.url)],c.prototype,"url",void 0);h([r.property()],c.prototype,"version",void 0);h([r.reader("version",["currentVersion"])],c.prototype,
"readVersion",null);return c=h([r.subclass("esri.layers.ElevationLayer")],c)}(r.declared(v.ArcGISCachedService(y.ArcGISService(t.OperationalLayer(x.PortalLayer(e.MultiOriginJSONMixin(u)))))))})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/Error ../core/global ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I){return function(a){function b(b,c){b=a.call(this)||this;b._spriteSourceMap=new Map;b.currentStyleInfo=null;b.style=null;b.isReference=null;b.operationalLayerType="VectorTileLayer";b.type="vector-tile";b.url=null;return b}k(b,a);b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?m({url:a},b):a};b.prototype.load=function(a){var b=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},
a).then(function(){return g(b,void 0,void 0,function(){var b,c;return d(this,function(d){switch(d.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];b=this.portalItem.itemUrl+"/resources/styles/root.json";return[4,l(b,m({},a,{query:{f:"json"}}))];case 1:return c=d.sent(),c.data&&this.read({url:b},K.createForItem(this.portalItem)),[2]}})})}).then(function(){return b._loadStyle(a)},function(){return b._loadStyle(a)});this.addResolvingPromise(c);return this.when()};Object.defineProperty(b.prototype,
"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&q.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();
return a?a.fullExtent:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parsedUrl",{get:function(){return this.serviceUrl?p.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||
null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});b.prototype.writeStyleUrl=function(a,b){a&&q.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};Object.defineProperty(b.prototype,"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileIndexUrl",{get:function(){var a=
this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileInfo",{get:function(){var a=[],b;for(b in this.sourceNameToSource)a.push(this.sourceNameToSource[b]);b=this._getPrimarySource().tileInfo;if(1<a.length)for(var c=0;c<a.length;c++)N.areSchemasOverlapping(b,a[c].tileInfo)&&(b=N.unionTileInfos(b,a[c].tileInfo));return b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();
return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!0,configurable:!0});b.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};Object.defineProperty(b.prototype,"compatibleTileInfo256",{get:function(){return H.create256x256CompatibleTileInfo(this.tileInfo)},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"compatibleTileInfo512",{get:function(){return H.create512x512CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0});b.prototype.loadSpriteSource=function(a,b){void 0===a&&(a=1);return g(this,void 0,void 0,function(){var c,f;return d(this,function(d){this._spriteSourceMap.has(a)||(c=new E.default(this.styleRepository.sprite,a),this._spriteSourceMap.set(a,c.load()));f=this._spriteSourceMap.get(a);return[2,e.create(function(a,
c){f.then(a,c);e.onAbortOrThrow(b,c)})]})})};b.prototype.loadStyle=function(a,b){return g(this,void 0,void 0,function(){var f,g,h,l=this;return d(this,function(d){f=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof f&&this.url===f&&!e.isAborted(this._abortController))return[2,this._loadingPromise];(g=this._abortController)&&g.abort();h=e.createAbortController();this._loadingPromise=e.create(function(a,d){var g={signal:h.signal};l._spriteSourceMap.clear();l._getSourceAndStyle(f,g).then(function(){return l.loadSpriteSource(c.devicePixelRatio||
1,g).then(function(){return a()})}).catch(d);e.onAbort(b,function(){h.abort()})});this._abortController=h;return[2,this._loadingPromise]})})};b.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};b.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};b.prototype.setPaintProperties=function(a,b){var c=this.styleRepository.isPainterDataDriven(a),d=this.styleRepository.setPaintProperties(a,b),e=this.styleRepository.isPainterDataDriven(a);
this.emit("paint-change",{layer:d,paint:b});(c||e)&&this.emit("layout-change",{layer:d,layout:this.styleRepository.getLayoutProperties(a)})};b.prototype.getLayoutProperties=function(a){return this.styleRepository.getLayoutProperties(a)};b.prototype.setLayoutProperties=function(a,b){a=this.styleRepository.setLayoutProperties(a,b);this.emit("layout-change",{layer:a,layout:b})};b.prototype.getTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,
b.toString()).replace(/\{x\}/gi,c.toString())};b.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new f("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};b.prototype.importLayerViewModule=function(a){return g(this,void 0,void 0,function(){return d(this,function(b){switch(a.type){case "2d":return[2,e.create(function(a){return n(["../views/2d/layers/VectorTileLayerView2D"],
a)})];case "3d":return[2,e.create(function(a){return n(["../views/3d/layers/VectorTileLayerView3D"],a)})]}return[2,null]})})};b.prototype._getSourceAndStyle=function(a,b){return g(this,void 0,void 0,function(){var c;return d(this,function(d){switch(d.label){case 0:return a?[4,F.loadMetadata(a,b)]:[2,e.reject(Error("invalid style!"))];case 1:return c=d.sent(),this._set("currentStyleInfo",{serviceUrl:c.serviceUrl,styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition}),
"string"===typeof a?(this.url=a,this.style=null):(this.url=null,this.style=a),this._set("sourceNameToSource",c.sourceNameToSource),this._set("primarySourceName",c.primarySourceName),this._set("styleRepository",new I(c.style,c)),this.read(c.layerDefinition,{origin:"service"}),[2]}})})};b.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(b&&(a=b[3]&&
b[3].toLowerCase()))for(var b=b[2]||"",c=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return q.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+e)}};b.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:
null};b.prototype._loadStyle=function(a){return g(this,void 0,void 0,function(){return d(this,function(b){return this._loadingPromise?[2,this._loadingPromise]:[2,this.loadStyle(null,a)]})})};h([r.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],b.prototype,"attributionDataUrl",null);h([r.property({type:["show","hide"]})],b.prototype,"listMode",void 0);h([r.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"capabilities",null);h([r.property({readOnly:!0})],
b.prototype,"currentStyleInfo",void 0);h([r.property({json:{read:!1},readOnly:!0,type:w,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"fullExtent",null);h([r.property()],b.prototype,"style",void 0);h([r.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],b.prototype,"isReference",void 0);h([r.property({type:["VectorTileLayer"]})],b.prototype,"operationalLayerType",void 0);h([r.property({readOnly:!0,dependsOn:["serviceUrl"]})],
b.prototype,"parsedUrl",null);h([r.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],b.prototype,"serviceUrl",null);h([r.property({type:u,dependsOn:["tileInfo"],readOnly:!0})],b.prototype,"spatialReference",null);h([r.property({readOnly:!0})],b.prototype,"styleRepository",void 0);h([r.property({readOnly:!0})],b.prototype,"sourceNameToSource",void 0);h([r.property({readOnly:!0})],b.prototype,"primarySourceName",void 0);h([r.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},
origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],b.prototype,"styleUrl",null);h([r.writer(["portal-item","web-document"],"styleUrl")],b.prototype,"writeStyleUrl",null);h([r.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileIndexType",null);h([r.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileIndexUrl",null);h([r.property({json:{read:!1,origins:{service:{read:!1}}},
readOnly:!0,type:B,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileInfo",null);h([r.property({json:{read:!1},readOnly:!0,type:G.TilemapCache,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tilemapCache",null);h([r.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileServers",null);h([r.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],b.prototype,"type",void 0);h([r.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},
"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],b.prototype,"url",void 0);h([r.property({readOnly:!0})],b.prototype,"version",void 0);h([r.reader("version",["version","currentVersion"])],b.prototype,"readVersion",null);h([r.property({readOnly:!0,dependsOn:["tileInfo"]})],b.prototype,"compatibleTileInfo256",null);h([r.property({readOnly:!0,dependsOn:["tileInfo"]})],b.prototype,"compatibleTileInfo512",null);return b=h([r.subclass("esri.layers.VectorTileLayer")],b)}(r.declared(A.ScaleRangeLayer(y.ArcGISCachedService(t.ArcGISService(x.OperationalLayer(z.PortalLayer(b.MultiOriginJSONMixin(v))))))))})},
"esri/layers/support/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){Object.defineProperty(a,"__esModule",{value:!0});var p=b.getLogger("esri.layers.support.SpriteSource");n=function(){function a(a,
b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(a.prototype,"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);a.sort();return a},enumerable:!0,configurable:!0});a.prototype.getSpriteInfo=function(a){return this._spritesData[a]};a.prototype.load=function(a){return g(this,void 0,void 0,function(){return d(this,function(b){switch(b.label){case 0:e.throwIfAborted(a);
this.loadStatus="loading";if(!this.baseURL)return[2,e.resolve(this)];b.label=1;case 1:return b.trys.push([1,3,,4]),[4,this._loadSprites(a)];case 2:return b.sent(),this.loadStatus="loaded",[3,4];case 3:return b.sent(),this.loadStatus="failed",[3,4];case 4:return[2,this]}})})};a.prototype._loadSprites=function(a){var b=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var d=this.baseURL,g=this._isRetina?"@2x":"",k=""+d+g+".png";return e.all([l(d+g+".json",a),l(k,h({responseType:"image"},a))]).then(function(a){var g=
a[0];a=a[1];var h=Object.keys(g.data);if(!h||0===h.length||1===h.length&&"_ssl"===h[0]||!a||!a.data)return b._spritesData=b.image=null,b.width=b.height=0,e.resolve(null);b._spritesData=g.data;g=a.data;a=Math.max(c("esri-webgl-max-texture-size"),4096);if(g.width>a||g.height>a)throw g="Sprite resource for style "+d+" is bigger than the maximum allowed of "+a+" pixels}",p.error(g),new f("SpriteSource",g);b.width=g.width;b.height=g.height;a=document.createElement("canvas");h=a.getContext("2d");a.width=
g.width;a.height=g.height;h.drawImage(g,0,0,g.width,g.height);g=h.getImageData(0,0,g.width,g.height);g=new Uint8Array(g.data);for(h=0;h<g.length;h+=4)a=g[h+3]/255,g[h]*=a,g[h+1]*=a,g[h+2]*=a;b.image=g})};return a}();a.default=n})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),
function(n,a,m,k,h,d,g,l,f,c){function b(a){a&&(a=f.getOrigin(a),w&&-1===w.indexOf(a)&&w.push(a))}function e(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)f.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=f.isAbsolute(a[c])?a[c]:f.join(b,a[c]);return b}function p(a,c,d,e,p){return h(this,void 0,void 0,function(){var h,n,u,w,t,v;return k(this,function(k){switch(k.label){case 0:l.throwIfAborted(p);if("string"!==typeof d)return[3,
2];w=f.normalize(d);b(w);t=f.urlToObject(w);return[4,g(t.path,m({query:{f:"json"},responseType:"json"},p))];case 1:return u=k.sent(),n=h=w,[3,3];case 2:u={data:d},h=d.jsonUrl||null,n=e,k.label=3;case 3:return v=u.data,u.ssl&&(h&&(h=h.replace(/^http:/i,"https:")),n&&(n=n.replace(/^http:/i,"https:"))),v.sources?(a.styleUrl=h||null,[2,q(a,v,n,p)]):v.sources?[2,l.reject("You must specify the URL or the JSON for a service or for a style.")]:a.sourceUrl?[2,r(a,v,n,!1,c,p)]:(a.sourceUrl=h||null,[2,r(a,v,
n,!0,c,p)])}})})}function q(a,c,d,g){return h(this,void 0,void 0,function(){var h,m,n,q,r,u;return k(this,function(k){switch(k.label){case 0:h=d?f.removeFile(d):f.appBaseUrl;a.styleBase=h;a.style=c;a.styleUrl&&b(a.styleUrl);m=[];if(!c.sources||!c.sources.esri)return[3,3];n=c.sources.esri;return n.url?[4,p(a,"esri",e(h,n.url),void 0,g)]:[3,2];case 1:return k.sent(),[3,3];case 2:m.push(p(a,"esri",n,h,g)),k.label=3;case 3:q=0;for(r=Object.keys(c.sources);q<r.length;q++)u=r[q],"esri"!==u&&"vector"===
c.sources[u].type&&(c.sources[u].url?m.push(p(a,u,e(h,c.sources[u].url),void 0,g)):m.push(p(a,u,c.sources[u],h,g)));return[4,l.all(m)];case 4:return k.sent(),[2]}})})}function r(a,d,g,m,n,q){return h(this,void 0,void 0,function(){var h,r,u,w;return k(this,function(k){h=g?f.removeTrailingSlash(g)+"/":f.appBaseUrl;k=h;if(d.hasOwnProperty("tileInfo"))r=d;else{for(var t={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},
v=78271.51696400007,y=2.958287637957775E8,x=[],z=d.hasOwnProperty("minzoom")?parseFloat(d.minzoom):0,A=d.hasOwnProperty("maxzoom")?parseFloat(d.maxzoom):16,B=0;B<=A;B++)B>=z&&x.push({level:B,scale:y,resolution:v}),v/=2,y/=2;v=0;for(y=d.tiles;v<y.length;v++)b(e(k,y[v]));r={capabilities:"TilesOnly",initialExtent:t,fullExtent:t,minScale:x[0].scale,maxScale:x[x.length-1].scale,tiles:d.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:x,spatialReference:{wkid:102100}}}}u=
new c(n,h,r);if(!m&&a.primarySourceName in a.sourceNameToSource){w=a.sourceNameToSource[a.primarySourceName];if(!w.isCompatibleWith(u))return[2,l.resolve()];null!=u.fullExtent&&(null!=w.fullExtent?w.fullExtent.union(u.fullExtent):w.fullExtent=u.fullExtent.clone());w.tileInfo.lods.length<u.tileInfo.lods.length&&(w.tileInfo=u.tileInfo)}m?(a.sourceBase=h,a.source=d,a.validatedSource=r,a.primarySourceName=n,a.sourceUrl&&b(a.sourceUrl)):b(h);a.sourceNameToSource[n]=u;return a.style?[2]:null==d.defaultStyles?
[2,l.reject()]:"string"===typeof d.defaultStyles?[2,p(a,"",e(h,d.defaultStyles,"root.json"),void 0,q)]:[2,p(a,"",d.defaultStyles,e(h,"root.json"),q)]})})}Object.defineProperty(a,"__esModule",{value:!0});var w=d.defaults&&d.defaults.io.corsEnabledServers;a.loadMetadata=function(a,c){return h(this,void 0,void 0,function(){var d,g,h,l,m,n;return k(this,function(k){switch(k.label){case 0:return d={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,
sourceNameToSource:{},primarySourceName:""},g="string"===typeof a?[a,null]:[null,a.jsonUrl],h=g[0],l=g[1],m=h?f.urlToObject(h):null,[4,p(d,"esri",a,l,c)];case 1:return k.sent(),n={layerDefinition:d.validatedSource,url:h,parsedUrl:m,serviceUrl:d.sourceUrl,style:d.style,styleUrl:d.styleUrl,spriteUrl:d.style.sprite&&e(d.styleBase,d.style.sprite),glyphsUrl:d.style.glyphs&&e(d.styleBase,d.style.glyphs),sourceNameToSource:d.sourceNameToSource,primarySourceName:d.primarySourceName},b(n.spriteUrl),b(n.glyphsUrl),
[2,n]}})})}})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/lang ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),function(n,a,m,k,h,d,g,l,f,c){return function(){function a(a,b,k){this.tileMapURL="";this.fullExtent=
this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=a;if(this.sourceUrl=b)this.parsedUrl=d.urlToObject(this.sourceUrl);a=h.clone(k);var e=a.tiles;b&&e.forEach(function(a,c){d.isAbsolute(a)||(e[c]=d.join(b,a))});this.tileServers=e;k.tileMap&&(this.tileMapURL=d.join(b,k.tileMap));var m=k.capabilities&&k.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),p=!!k.exportTilesAllowed,m=!!m&&-1!==m.indexOf("tilemap"),n=p&&k.hasOwnProperty("maxExportTilesCount")?
k.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:p,supportsTileMap:m},exportTiles:p?{maxExportTilesCount:+n}:null};this.tileInfo=l.readServiceTileInfo(a.tileInfo,a,null,{ignoreMinMaxLOD:!0});m&&(this.type="vector-tile",this.tilemapCache=new f.TilemapCache({layer:this}),this.tileIndex=new c(this.tilemapCache));this.fullExtent=g.fromJSON(k.fullExtent)}a.prototype.getRefKey=function(a,b){return k(this,void 0,void 0,function(){return m(this,function(c){return this.tileIndex?
[2,this.tileIndex.dataKey(a,b)]:[2,a]})})};a.prototype.getSourceTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};a.prototype.isCompatibleWith=function(a){var b=this.tileInfo;a=a.tileInfo;if(!b.spatialReference.equals(a.spatialReference)||!b.origin.equals(a.origin)||Math.round(b.dpi)!==Math.round(a.dpi))return!1;b=b.lods;a=a.lods;for(var c=Math.min(b.length,a.length),
d=0;d<c;d++){var e=b[d],f=a[d];if(e.level!==f.level||Math.round(e.scale)!==Math.round(f.scale))return!1}return!0};return a}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(n,a,m,k,h){return function(){function a(a){if(a instanceof k.TilemapCache)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}a.prototype.dataKey=
function(a,d){if(this._tilemapCache){var f=a.level,c=a.row,b=a.col,e=new h(a);return this._tilemapCache.fetchAvailabilityUpsample(f,c,b,e,d).then(function(){return e}).catch(function(a){if(m.isAbortError(a))throw a;e.level=f;e.row=c;e.col=b;return e})}return this._getIndexedDataKey(a)};a.prototype.forEach=function(a,d,f,c,b){this._callback=b;this._maxLevel=d+a;this._forEach(this._tilemap,d,f,c)};a.prototype._forEach=function(a,d,f,c){0!==a&&(this._callback(d,f,c),d!==this._maxLevel&&"object"===typeof a&&
(this._forEach(a[0],d+1,2*f,2*c),this._forEach(a[1],d+1,2*f,2*c+1),this._forEach(a[2],d+1,2*f+1,2*c),this._forEach(a[3],d+1,2*f+1,2*c+1)))};a.prototype._getIndexedDataKey=function(a){var d=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return m.resolve(null);for(;0!==a.level;)a=new h(a.level-1,a.row>>1,a.col>>1,a.world),d.push(a);a=this._tilemap;var f=d.pop(),c,b;if(1===a)return m.resolve(f);for(;d.length;)if(c=d.pop(),b=(c.col&1)+((c.row&1)<<1),a){if(0===a[b]){f=null;break}if(1===
a[b]){f=c;break}f=c;a=a[b]}return m.resolve(f)};return a}()})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.createForItem=function(a){return{origin:"portal-item",url:m.urlToObject(a.itemUrl),portal:a.portal||k.getDefault()}}})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["require","exports","../../../../layers/support/LOD","../../../../layers/support/TileInfo"],
function(n,a,m,k){return function(){function a(a,g){this.lockedSchemaPixelSize=a;this.isGCS=g}a.prototype.getLevelRowColumn=function(a){return this.isGCS?[a[0],a[1]>>1,a[2]>>1]:256===this.lockedSchemaPixelSize&&0<a[0]?[a[0]-1,a[1]>>1,a[2]>>1]:a};a.prototype.adjustLevel=function(a){return this.isGCS?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};a.prototype.getShift=function(a,g){var d=0,f=0;if(256===this.lockedSchemaPixelSize||this.isGCS)a[2]%2&&(d=g),a[1]%2&&(f=g);return[d,f]};a.prototype.getScale=
function(a){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===a)return 1;return 2};a.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.size[0]&&256===a.size[1])return a;for(var d=a.spatialReference.isGeographic,h=[],f=a.lods.length,c=0;c<f;c++){var b=a.lods[c];h.push(new m({level:b.level,scale:b.scale,resolution:d?b.resolution:2*b.resolution}))}return new k({size:[256,256],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,
origin:a.origin,spatialReference:a.spatialReference,lods:h})};a.create512x512CompatibleTileInfo=function(a){if(!a||256===a.size[0]||256===a.size[1])return null;for(var d=[],h=a.lods.length,f=0;f<h;f++){var c=a.lods[f];d.push(new m({level:c.level,scale:c.scale,resolution:.5*c.resolution}))}return new k({size:[512,512],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:d})};return a}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["require",
"exports","../../../../layers/support/TileInfo"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});a.areSchemasOverlapping=function(a,h){if(a===h)return!0;if(!a&&null!=h||null!=a&&!h||!a.spatialReference.equals(h.spatialReference)||a.dpi!==h.dpi)return!1;var d=a.origin,g=h.origin;if(1E-6<=Math.abs(d.x-g.x)||1E-6<=Math.abs(d.y-g.y))return!1;a.lods[0].scale>h.lods[0].scale?(d=a,a=h):d=h;for(h=d.lods[0].scale;h>=a.lods[a.lods.length-1].scale-1E-6;h/=2)if(1E-6>Math.abs(h-a.lods[0].scale))return!0;
return!1};a.unionTileInfos=function(a,h){if(a===h)return a;if(!a&&null!=h)return h;if(null!=a&&!h)return a;var d=a.size[0],g=a.format,l=a.dpi,f={x:a.origin.x,y:a.origin.y},c=a.spatialReference.toJSON(),b=a.lods[0].scale>h.lods[0].scale?a.lods[0]:h.lods[0];a=(a.lods[a.lods.length-1].scale<=h.lods[h.lods.length-1].scale?a.lods[a.lods.length-1]:h.lods[h.lods.length-1]).scale;h=[];for(var e=b.scale,b=b.resolution,k=0;e>a;)h.push({level:k,resolution:b,scale:e}),k++,e/=2,b/=2;return new m({size:[d,d],dpi:l,
format:g||"pbf",origin:f,lods:h,spatialReference:c})}})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../../../core/has","./StyleLayer"],function(n,a,m,k){return function(){function a(d,g){this.backgroundBucketIds=[];this._layerByName={};this.styleJSON=d;this.version=parseFloat(d.version);this.sprite=g?g.spriteUrl:d.sprite;this.glyphs=g?g.glyphsUrl:d.glyphs;if(m("stable-symbol-rendering")){var h=(d.layers||[]).filter(function(a){return a.layout&&
a.layout["text-font"]})[0];h&&(d.layers||[]).forEach(function(a){a.layout&&a.layout["text-font"]&&(a.layout["text-font"]=h.layout["text-font"])})}if(this.layers=(d.layers||[]).map(a._create))for(d=void 0,g=0;g<this.layers.length;g++)d=this.layers[g],this._layerByName[d.id.toLowerCase()]=d,0===d.type&&this.backgroundBucketIds.push(g);this._identifyRefLayers()}a.prototype.isPainterDataDriven=function(a){return(a=this._layerByName[a.toLowerCase()])?a.isPainterDataDriven():!1};a.prototype.getStyleLayerId=
function(a){return a>=this.layers.length?null:this.layers[a].id};a.prototype.getLayoutProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.layout:null};a.prototype.getPaintProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.paint:null};a.prototype.setPaintProperties=function(d,g){d=this._layerByName[d.toLowerCase()];if(!d)return"";var h=this.layers.indexOf(d);this.styleJSON.layers[h].paint=g;g=a._recreateLayer({id:d.id,type:d.typeName,source:d.source,sourceLayer:d["source-layer"],
minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:d.layout,paint:g},d);this.layers[h]=g;this._layerByName[d.id.toLowerCase()]=g;return d.id};a.prototype.setLayoutProperties=function(d,g){d=this._layerByName[d.toLowerCase()];if(!d)return"";var h=this.layers.indexOf(d);this.styleJSON.layers[h].layout=g;g=a._recreateLayer({id:d.id,type:d.typeName,source:d.source,sourceLayer:d["source-layer"],minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:g,paint:d.paint},d);this.layers[h]=g;this._layerByName[d.id.toLowerCase()]=
g;return d.id};a.prototype._identifyRefLayers=function(){for(var a=[],g=[],h=0,f=0,c=this.layers;f<c.length;f++){var b=c[f];if(1===b.type){var e=b,k=b.source+"|"+b.sourceLayer,k=k+("|"+JSON.stringify(b.layout&&b.layout.visibility)),k=k+("|"+JSON.stringify(b.minzoom)),k=k+("|"+JSON.stringify(b.maxzoom)),k=k+("|"+JSON.stringify(b.filter));if(e.hasDataDrivenFill||e.hasDataDrivenOutline)k+="|"+JSON.stringify(h);a.push({key:k,layer:b})}2===b.type&&(e=b,k=b.source+"|"+b.sourceLayer,k+="|"+JSON.stringify(b.layout&&
b.layout.visibility),k+="|"+JSON.stringify(b.minzoom),k+="|"+JSON.stringify(b.maxzoom),k+="|"+JSON.stringify(b.filter),k+="|"+JSON.stringify(b.layout&&b.layout["line-cap"]),k+="|"+JSON.stringify(b.layout&&b.layout["line-join"]),e.hasDataDrivenLine&&(k+="|"+JSON.stringify(h)),g.push({key:k,layer:b}));++h}this._assignRefLayers(a);this._assignRefLayers(g)};a.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var d,h,f=a.length,c=0;c<f;c++){var b=a[c];
if(b.key===d)b.layer.refLayerId=h;else if(d=b.key,h=b.layer.id,1===b.layer.type&&!b.layer.getPaintProperty("fill-outline-color"))for(var e=c+1;e<f;e++){var k=a[e];if(k.key===d){if(k.layer.getPaintProperty("fill-outline-color")){a[c]=k;a[e]=b;h=k.layer.id;break}}else break}}};a._create=function(a,g,h){g=1-1/(h.length+1)*(1+g);switch(a.type){case "background":return new k.BackgroundStyleLayer(0,a,g);case "fill":return new k.FillStyleLayer(1,a,g);case "line":return new k.LineStyleLayer(2,a,g);case "symbol":return new k.SymbolStyleLayer(3,
a,g);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,a,g)}throw Error("Unknown vector tile layer");};a._recreateLayer=function(a,g){switch(a.type){case "background":return new k.BackgroundStyleLayer(0,a,g.z);case "fill":return new k.FillStyleLayer(1,a,g.z);case "line":return new k.LineStyleLayer(2,a,g.z);case "symbol":return new k.SymbolStyleLayer(3,a,g.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,
a,g.z)}};return a}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,b,d){this.type=a;this.typeName=b.type;this.id=b.id;this.source=b.source;this.sourceLayer=b["source-layer"];this.minzoom=b.minzoom;this.maxzoom=b.maxzoom;this.filter=b.filter;
this.layout=b.layout;this.paint=b.paint;this.z=d;switch(a){case 0:this._layoutDefinition=h.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=h.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=h.StyleDefinition.fillLayoutDefinition;this._paintDefinition=h.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=h.StyleDefinition.lineLayoutDefinition;this._paintDefinition=h.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=
h.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=h.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=h.StyleDefinition.circleLayoutDefinition,this._paintDefinition=h.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=k.createFilter(this.filter)};a.prototype.getLayoutProperty=
function(a){var b=this._layoutProperties;if(b)return b[a]};a.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};a.prototype.getLayoutValue=function(a,b,d){var c,e=this._layoutProperties;e&&(e=e[a])&&(c=e.getValue(b,d));a=this._layoutDefinition[a];void 0===c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};a.prototype.getPaintValue=function(a,b,d){var c,e=this._paintProperties;e&&(e=e[a])&&(c=e.getValue(b,d));a=this._paintDefinition[a];void 0===
c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};a.prototype.isPainterDataDriven=function(){var a=this._paintProperties;if(a)for(var b in a)if(a[b].isDataDriven)return!0;return!1};a.prototype._parseLayout=function(a){var b={},c;for(c in a){var f=this._layoutDefinition[c];f&&(b[c]=new d(c,f,a[c]))}return b};a.prototype._parsePaint=function(a){var b={},c;for(c in a){var f=this._paintDefinition[c];f&&(b[c]=new d(c,f,a[c]))}return b};return a}();a.StyleLayer=n;var l=function(a){function c(b,
c,d){return a.call(this,b,c,d)||this}m(c,a);return c}(n);a.BackgroundStyleLayer=l;l=function(a){function c(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("fill-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("fill-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;c=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=!c;b.hasDataDrivenOutlineColor=c?c.isDataDriven:!1;b.hasDataDrivenOutline=
(c?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;return b}m(c,a);return c}(n);a.FillStyleLayer=l;l=function(a){function c(b,c,d){b=a.call(this,b,c,d)||this;d=b.getPaintProperty("line-color");b.hasDataDrivenColor=d?d.isDataDriven:!1;d=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=d?d.isDataDriven:!1;d=b.getPaintProperty("line-width");b.hasDataDrivenWidth=d?d.isDataDriven:!1;b.hasDataDrivenLine=b.hasDataDrivenColor||b.hasDataDrivenOpacity||b.hasDataDrivenWidth;
c=c.paint["line-width"];c||(c=h.StyleDefinition.linePaintDefinition["line-width"].default);b.isThinLine=!b.hasDataDrivenWidth&&"number"===typeof c&&c<g.THIN_LINE_THRESHOLD;return b}m(c,a);return c}(n);a.LineStyleLayer=l;l=function(a){function c(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=c?c.isDataDriven:!1;c=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=
c?c.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||b.hasDataDrivenIconSize;c=b.getPaintProperty("text-color");b.hasDataDrivenTextColor=c?c.isDataDriven:!1;c=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=c?c.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}m(c,a);return c}(n);a.SymbolStyleLayer=
l;n=function(a){function c(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("circle-radius");b.hasDataDrivenRadius=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-opacity");
b.hasDataDrivenStrokeOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-blur");b.hasDataDrivenBlur=c?c.isDataDriven:!1;return b}m(c,a);return c}(n);a.CircleStyleLayer=n;n=function(){return function(a,c,b){this.cap=a.getLayoutValue("line-cap",c,b);this.join=a.getLayoutValue("line-join",c,b);this.miterLimit=a.getLayoutValue("line-miter-limit",c,b);this.roundLimit=a.getLayoutValue("line-round-limit",c,b)}}();a.LineLayout=n;n=function(){return function(a,c,b,d){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",
c,d);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",c,d);this.optional=a.getLayoutValue("icon-optional",c,d);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",c,d);this.size=a.getLayoutValue("icon-size",c,d);this.rotate=a.getLayoutValue("icon-rotate",c,d);this.padding=a.getLayoutValue("icon-padding",c,d);this.keepUpright=a.getLayoutValue("icon-keep-upright",c,d);this.offset=a.getLayoutValue("icon-offset",c,d);2===this.rotationAlignment&&(this.rotationAlignment=b?0:1)}}();
a.IconLayout=n;n=function(){return function(a,c,b,d){this.allowOverlap=a.getLayoutValue("text-allow-overlap",c,d);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",c,d);this.optional=a.getLayoutValue("text-optional",c,d);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",c,d);this.fontArray=a.getLayoutValue("text-font",c,d);this.maxWidth=a.getLayoutValue("text-max-width",c,d);this.lineHeight=a.getLayoutValue("text-line-height",c,d);this.letterSpacing=a.getLayoutValue("text-letter-spacing",
c,d);this.justify=a.getLayoutValue("text-justify",c,d);this.anchor=a.getLayoutValue("text-anchor",c,d);this.maxAngle=a.getLayoutValue("text-max-angle",c,d);this.size=a.getLayoutValue("text-size",c,d);this.rotate=a.getLayoutValue("text-rotate",c,d);this.padding=a.getLayoutValue("text-padding",c,d);this.keepUpright=a.getLayoutValue("text-keep-upright",c,d);this.transform=a.getLayoutValue("text-transform",c,d);this.offset=a.getLayoutValue("text-offset",c,d);2===this.rotationAlignment&&(this.rotationAlignment=
b?0:1)}}();a.TextLayout=n})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["require","exports"],function(n,a){return function(){function a(k,h,d){this._op=k;"$type"===h?(this._val=d instanceof Array?d.map(function(d){return a._types.indexOf(d)}):a._types.indexOf(d),this._op+=11):(this._key=h,this._val=d)}a.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<
this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var h=0,d=this._val;h<d.length;h++){var g=d[h];if(g.filter(a))return!0}return!1;case 10:h=0;for(d=this._val;h<d.length;h++)if(g=d[h],!g.filter(a))return!1;return!0;case 11:h=0;for(d=this._val;h<d.length;h++)if(g=d[h],g.filter(a))return!1;
return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type);case 20:return void 0!==a.values[this._key];case 21:return void 0===a.values[this._key]}};a.createFilter=function(k){if(!k)return new a(0,void 0,!0);var h=k[0];if(1>=k.length)return new a(0,void 0,"any"!==
h);switch(h){case "\x3d\x3d":return new a(1,k[1],k[2]);case "!\x3d":return new a(2,k[1],k[2]);case "\x3e":return new a(4,k[1],k[2]);case "\x3c":return new a(3,k[1],k[2]);case "\x3e\x3d":return new a(6,k[1],k[2]);case "\x3c\x3d":return new a(5,k[1],k[2]);case "in":return new a(7,k[1],k.slice(2));case "!in":return new a(8,k[1],k.slice(2));case "any":return new a(9,void 0,k.slice(1).map(a.createFilter.bind(this)));case "all":return new a(10,void 0,k.slice(1).map(a.createFilter.bind(this)));case "none":return new a(11,
void 0,k.slice(1).map(a.createFilter.bind(this)));case "has":return new a(20,k[1],void 0);case "!has":return new a(21,k[1],void 0);default:throw Error("invalid operator: "+h);}};a._types=["Unknown","Point","LineString","Polygon"];return a}()})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){}a.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:"visible"}};a.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};a.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};a.symbolLayoutDefinition={visibility:{type:"enum",
values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",
minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",
minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",
default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};a.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};a.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},
"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};a.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};a.linePaintDefinition=
{"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},
"line-pattern":{type:"string"}};a.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,
maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};a.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},
"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};a.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",
default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1}};return a}();a.StyleDefinition=n})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["require",
"exports","../../../../../Color","../GeometryUtils"],function(n,a,m,k){return function(){function a(d,g,h){this.isDataDriven=!1;switch(g.type){case "number":d=!0;break;case "color":d=!0;h=a._parseColor(h);break;case "array":d="number"===g.value;break;default:d=!1}null==h&&(h=g.default);d&&"interval"===h.type&&(d=!1);var f=h&&h.stops&&0<h.stops.length;if(f)for(var c=0,b=h.stops;c<b.length;c++){var e=b[c];e[1]=this._validate(e[1],g)}if(this.isDataDriven=h?!!h.property:!1)if(void 0!==h.default&&(h.default=
this._validate(h.default,g)),f)switch(h.type){case "identity":this.getValue=this._buildIdentity(h,g);break;case "categorical":this.getValue=this._buildCategorical(h,g);break;default:this.getValue=d?this._buildInterpolate(h,g):this._buildInterval(h,g)}else this.getValue=this._buildIdentity(h,g);else f?this.getValue=d?this._buildZoomInterpolate(h):this._buildZoomInterval(h):(h=this._validate(h,g),this.getValue=this._buildSimple(h))}a.prototype._validate=function(a,g){if("number"===g.type){if(a<g.minimum)return g.minimum;
if(a>g.maximum)return g.maximum}return a};a.prototype._buildSimple=function(a){return function(){return a}};a.prototype._buildIdentity=function(d,g){var h=this;return function(f,c){var b;c&&(b=c.values[d.property],"color"===g.type&&(b=a._parseColor(b)));void 0===b&&(b=d.default);return void 0!==b?h._validate(b,g):g.default}};a.prototype._buildCategorical=function(a,g){var d=this;return function(f,c){var b;c&&(b=c.values[a.property]);b=d._categorical(b,a.stops);return void 0!==b?b:void 0!==a.default?
a.default:g.default}};a.prototype._buildInterval=function(a,g){var d=this;return function(f,c){var b;c&&(b=c.values[a.property]);return"number"===typeof b?d._interval(b,a.stops):void 0!==a.default?a.default:g.default}};a.prototype._buildInterpolate=function(a,g){var d=this;return function(f,c){var b;c&&(b=c.values[a.property]);return"number"===typeof b?d._interpolate(b,a.stops,a.base||1):void 0!==a.default?a.default:g.default}};a.prototype._buildZoomInterpolate=function(a){var d=this;return function(g){return d._interpolate(g,
a.stops,a.base||1)}};a.prototype._buildZoomInterval=function(a){var d=this;return function(g){return d._interval(g,a.stops)}};a.prototype._categorical=function(a,g){for(var d=g.length,f=0;f<d;f++)if(g[f][0]===a)return g[f][1]};a.prototype._interval=function(a,g){for(var d=g.length,f=0,c=0;c<d;c++)if(g[c][0]<=a)f=c;else break;return g[f][1]};a.prototype._interpolate=function(a,g,h){for(var d,c,b=g.length,e=0;e<b;e++){var l=g[e];if(l[0]<=a)d=l;else{c=l;break}}if(d&&c){e=c[0]-d[0];a-=d[0];h=1===h?a/
e:(Math.pow(h,a)-1)/(Math.pow(h,e)-1);if(Array.isArray(d[1])){d=d[1];c=c[1];a=[];for(e=0;e<d.length;e++)a.push(k.interpolate(d[e],c[e],h));return a}return k.interpolate(d[1],c[1],h)}if(d)return d[1];if(c)return c[1]};a._isEmpty=function(a){for(var d in a)if(a.hasOwnProperty(d))return!1;return!0};a._parseColor=function(d){if(Array.isArray(d))return d;if("string"===typeof d){if(d=new m(d),!this._isEmpty(d))return m.toUnitRGBA(d)}else return d&&d.default&&(d.default=a._parseColor(d.default)),d&&d.stops&&
(d.stops=d.stops.map(function(d){return[d[0],a._parseColor(d[1])]})),d};return a}()})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(n,a,m,k,h,d,g,l){function f(a,d,e,f){k.vec3.copy(c,e);c[f]=d[f];f=k.vec3.subtract(c,c,d);var g=k.vec3.subtract(b,a,d),g=k.vec3.dot(g,f),h=k.vec3.dot(f,
f);d=0>=g?d:h<=g?e:k.vec3.add(c,d,k.vec3.scale(f,f,g/h));a=k.vec3.subtract(c,a,d);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}Object.defineProperty(a,"__esModule",{value:!0});var c=h.vec3f64.create(),b=h.vec3f64.create(),e=h.vec3f64.create(),p=h.vec3f64.create();a.isInsideExtent=function(a,b,c){void 0===c&&(c=0);a=a.extent;return 0===c?d.containsPoint(a,b):d.containsPointWithMargin(a,b,c*Math.min(a[2]-a[0],a[3]-a[1]))};a.tiltOnEdge=f;a.tiltToExtentEdge=function(a,b){var c=a.elevationBounds;
a=a.extent;c=.5*(c.min+c.max);e[0]=a[0];e[1]=a[1];e[2]=c;p[0]=a[2];p[1]=a[3];p[2]=c;a=c=Infinity;b[0]<e[0]?c=f(b,e,p,0):b[0]>p[0]&&(c=f(b,p,e,0));b[1]<e[1]?a=f(b,e,p,1):b[1]>p[1]&&(a=f(b,p,e,1));return Math.min(c,a)};a.checkIfTileInfoSupportedForViewSR=function(a,b,c){if(a.spatialReference.isGeographic)return new m("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var e=l.checkUnsupported(a);if(e)return e;var f=a.lods,e=f[0].resolution*Math.pow(2,
f[0].level),h=[e*a.size[0],e*a.size[1]],k=[a.origin.x,a.origin.y];b=d.fromExtent(b);var p=d.create();l.computeRowColExtent(b,h,k,p);h=(p[2]-p[0])*(p[3]-p[1]);h>g.MAX_ROOT_TILES?(f=f[0].scale*Math.pow(2,f[0].level),e=Math.max((b[3]-b[1])/a.size[1],(b[2]-b[0])/a.size[0])*f/e,b=Math.floor(Math.log(e)/Math.log(10)),e=Math.ceil(e/Math.pow(10,b))*Math.pow(10,b),e=new m("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(f).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+
e.toLocaleString()+".",{level0Scale:f,suggestedLevel0Scale:e,requiredNumRootTiles:h,allowedNumRootTiles:g.MAX_ROOT_TILES})):e=null;return e?e:c&&!a.spatialReference.equals(c)?new m("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error","../support/projectionUtils","./TilingScheme"],function(n,a,m,k,h){Object.defineProperty(a,
"__esModule",{value:!0});a.isInsideExtent=function(a,g,h){void 0===h&&(h=0);return!0};a.tiltToExtentEdge=function(a,g){return 0};a.checkIfTileInfoSupportedForViewSR=function(a,g,l){g=a.lods.length-1;if(a.spatialReference.isWebMercator){if(!h.makeWebMercatorAuxiliarySphere(g).compatibleWith(a))return new m("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(k.canProjectToWGS84ComparableLonLat(a.spatialReference)){if(!h.makeGCSWithTileSize(a.spatialReference,
a.size[0],g).compatibleWith(a))return a.spatialReference.isWGS84?new m("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new m("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new m("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(l&&!a.spatialReference.equals(l))return new m("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require","exports","./TileAgent","./tileUtils"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,g){this._pool=g;this.waitingAgents=[];this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleFromTile=this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=this.data=null;this.pendingUpdates=
0;this.elevationBounds=void 0;this.init(a)}a.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=null;this._unsetUpsampleInfo();this.requestAbort=this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;0===a&&(this.elevationBounds=null)};a.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};
a.prototype.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),this.requestAbort=this.requestPromise=null)};a.prototype.abortTilemapRequest=function(){this.tilemapRequestPromise&&(this.tilemapRequestAbort.abort(),this.tilemapRequestAbort=this.tilemapRequestPromise=null)};a.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==m.TILE_AGENT_DONE&&this.loadingAgent.dispose();this.loadingAgent=null;this.abortRequest();this.abortTilemapRequest();this.tilemap=null;this._unsetUpsampleInfo();
this.pendingUpdates=0;this.disposeData()};a.prototype.disposeData=function(){!this.data||this.data instanceof HTMLImageElement||this.data instanceof HTMLCanvasElement||this.data.release();this.data=null};Object.defineProperty(a.prototype,"upsampleFromTile",{get:function(){return this._upsampleFromTile},enumerable:!0,configurable:!0});a.prototype._unsetUpsampleInfo=function(){this._upsampleFromTile&&(this._pool.release(this._upsampleFromTile),this._upsampleFromTile=null)};a.prototype.setUpsampleInfo=
function(a,g){if(a===g||null==g)this._unsetUpsampleInfo();else{if(null==this._upsampleFromTile)this._upsampleFromTile=this._pool.acquire();else if(this._upsampleFromTile.tile===g)return;k.computeUpsampleInfo(a,g,this._upsampleFromTile)}};a.makeEmptyLayerInfo=function(d,g,h){return h?(h.init(d),h):new a(d,g)};return a}();a.TilePerLayerInfo=n})},"esri/views/3d/terrain/SphericalPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/geometryUtils ../support/projectionUtils ./PatchGeometryFactory ./Tile".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(c,e,f){var g=a.call(this,b.NumSubdivisionsAtLevel)||this;g.obb=Array(8);g.isWebMercator=!1;for(var h=0;8>h;h++)g.obb[h]=d.vec3f64.create();void 0!==c&&g.init(c,e,f);return g}m(b,a);b.prototype.init=function(b,c,e){a.prototype.init.call(this,b,c,e);this.isWebMercator=e.tilingScheme.spatialReference.isWebMercator;c=this.extentInRadians[0];e=this.extentInRadians[1];var l=this.extentInRadians[2],
m=this.extentInRadians[3];b=b[0];var p=k.lerp(e,m,.5),n=k.lerp(c,l,.5);this._edgeLen=(l-c)*Math.cos(0===b?0:Math.min(Math.abs(e),Math.abs(m)))*g.earthRadius;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=g.earthRadius-Math.sqrt(g.earthRadius*g.earthRadius-this._edgeLen2/4);f.wgs84ComparableLonLatToECEF(this.centerAtSeaLevel,n,p,0);c=d.vec3f64.fromArray(this.centerAtSeaLevel);h.vec3.normalize(c,c);this.up=c;this._updateOBB();this.updateRadiusAndCenter()};b.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])h.vec3.set(this._center,0,0,0),this._radius=g.earthRadius+this.elevationBounds[1];else{this._updateCenter();var a=Math.max(h.vec3.squaredDistance(this._center,this.obb[0]),h.vec3.squaredDistance(this._center,this.obb[1]));this._radius=Math.sqrt(a)}};b.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return l.frustum.intersectsSphere(a,l.sphere.wrap(this._radius,this._center));for(var b=this.obb,
c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!l.plane.isPointOutside(a[c],b[d]);d++);if(8===d)return!1}return!0};b.prototype.computeElevationBounds=function(){a.prototype.computeElevationBounds.call(this);this._updateOBB()};b.prototype.createGeometry=function(a,b){var d=this._isPole(this.lij[1],this.lij[0]);c.createSphericalGlobePatch(a,this.extent,b,this.renderData,this.extentInRadians,this.isWebMercator,d);this.setMemoryDirty()};b.prototype._updateOBB=function(){for(var a=this.extentInRadians,b=this.obb,
c=0;2>c;c++){var d=this.elevationBounds[c],e=4*c;f.wgs84ComparableLonLatToECEF(b[e++],a[0],a[1],d);f.wgs84ComparableLonLatToECEF(b[e++],a[0],a[3],d);f.wgs84ComparableLonLatToECEF(b[e++],a[2],a[3],d);f.wgs84ComparableLonLatToECEF(b[e++],a[2],a[1],d)}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(h.vec3.set(b[1],0,0,g.earthRadius),h.vec3.set(b[2],0,0,g.earthRadius),h.vec3.set(b[5],0,0,g.earthRadius),h.vec3.set(b[6],0,0,g.earthRadius)):1===a&&(h.vec3.set(b[0],0,0,-g.earthRadius),
h.vec3.set(b[3],0,0,-g.earthRadius),h.vec3.set(b[4],0,0,-g.earthRadius),h.vec3.set(b[7],0,0,-g.earthRadius)))};b.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};b.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];return b}(b.Tile);a.SphericalPatch=n})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){function e(a,b){a&&!a.spatialReference.equals(b)&&(a=f.canProject(a.spatialReference,b)?f.project(a,b):null);return a}Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function b(b){b=a.call(this,b)||this;b._changeListeners=new d;return b}m(b,a);b.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};b.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(b.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});b.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var f=a[d].layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=b&&(f=e(f.fullExtent,b),null!=f&&c.push(l.fromExtent(f)))}return c};
k([g.property({readOnly:!0})],b.prototype,"layerViewsExtent",null);k([g.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],b.prototype,"tiledLayersExtent",null);k([g.property({readOnly:!0,dependsOn:["spatialReference"]})],b.prototype,"stencilEnabledExtents",null);k([g.property()],b.prototype,"spatialReference",null);k([g.property()],b.prototype,"tilingScheme",null);k([g.property()],b.prototype,"defaultTiledLayersExtent",void 0);k([g.property({constructOnly:!0})],b.prototype,"layers",
void 0);k([g.property({constructOnly:!0})],b.prototype,"layerViews",void 0);return b=k([g.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],b)}(g.declared(h));h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};b.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};b.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?c.WEBMERCATOR_WORLD_EXTENT:
c.GEOGRAPHIC_WORLD_EXTENT};k([g.property({dependsOn:["spatialReference"]})],b.prototype,"layerViewsExtent",void 0);return b=k([g.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],b)}(g.declared(n));a.SurfaceExtentHelperGlobal=h;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}m(c,a);c.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};
c.prototype._computeLayerViewsExtent=function(){var a=l.empty(),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,(c=e(c,b))&&l.expand(a,c))});var c=l.allFinite(a)?a:null,d=this._get("layerViewsExtent");return l.equals(c,d)?d:c};c.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var c=this.spatialReference,d=l.empty();this.layers.forEach(function(e){if(e.loaded&&b.isTiledLayer(e)){var f=
b.getTiledLayerInfo(e,c,"local");e=f.tileInfo;f=f.fullExtent;e&&a.compatibleWith(e)&&f&&f.spatialReference.equals(c)&&l.expand(d,f)}});this.defaultTiledLayersExtent&&l.expand(d,this.defaultTiledLayersExtent);var e=l.allFinite(d)?d:null,f=this._get("tiledLayersExtent");return l.equals(e,f)?f:e};return c=k([g.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],c)}(g.declared(n));a.SurfaceExtentHelperLocal=n})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../support/projectionUtils ./terrainUtils ./TilingScheme".split(" "),
function(n,a,m,k,h,d,g,l,f,c){return function(a){function b(b){b=a.call(this,b)||this;b._changeHandles=new d;return b}m(b,a);b.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};b.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};b.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b;this.layers.some(function(c){return!f.isTiledLayer(c)||c.isRejected()?!1:!c.isFulfilled()||f.getTiledLayerInfo(c,a.viewSpatialReference,a.manifold).tileInfo?(b=c,"vector-tile"!==c.type):!1});if(b)if(b.isResolved()){var d=b,e=f.getTiledLayerInfo(d,this.viewSpatialReference,this.manifold).tileInfo,e=new c(e),d=f.getKnownTiledServiceLevelCap(d.url);Infinity>d&&e.capMaxLod(d);
this._set("tilingSchemeDone",!0);this._lockTilingScheme(e)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};b.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};b.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var d=a.levels.length-1;a.spatialReference.isWebMercator?a=c.makeWebMercatorAuxiliarySphere(d):l.canProjectToWGS84ComparableLonLat(a.spatialReference)&&
(a=c.makeGCSWithTileSize(a.spatialReference,a.pixelSize,d))}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};b.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};b.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var a=
this.extentHelper.spatialReference;a.isWebMercator?this.tilingScheme=c.WebMercatorAuxiliarySphere:l.canProjectToWGS84ComparableLonLat(a)&&(this.tilingScheme=c.makeGCSWithTileSize(a,256));this.extent=this.extentHelper.layerViewsExtent}else if(a=this.extentHelper.layerViewsExtent)this.tilingScheme=c.fromExtent(a,this.extentHelper.spatialReference),this.extent=a};k([g.property()],b.prototype,"tilingScheme",void 0);k([g.property()],b.prototype,"extent",void 0);k([g.property({value:!1})],b.prototype,"tilingSchemeLocked",
void 0);k([g.property({readOnly:!0,value:!1})],b.prototype,"tilingSchemeDone",void 0);k([g.property({constructOnly:!0})],b.prototype,"viewSpatialReference",void 0);k([g.property({constructOnly:!0})],b.prototype,"layers",void 0);k([g.property({constructOnly:!0})],b.prototype,"extentHelper",void 0);k([g.property({constructOnly:!0})],b.prototype,"manifold",void 0);return b=k([g.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],b)}(g.declared(h))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ../support/buffer/BufferView ./PatchGeometryFactory ./PatchRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainRendererPrograms ../../webgl/renderState ../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I,J,M,L){var R=N.assert,O=p.mat4f64.create(),T=q.vec2f64.create(),U=y.create(),P=v.vec4f64.create(),V=v.vec4f64.create(),W=v.vec4f64.create(),Q=function(){return function(){this.extent=v.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();n=function(a){function g(b){b=a.call(this,b)||this;b.tileSize=256;b.rctx=null;b.renderDataPool=new f(A.PatchRenderData);b.patchGroups=new c({allocator:function(a){return a||{root:null,
origin:null,patches:new c}},deallocator:function(a){a.root=null;a.origin=null;a.patches.clear();return a}});b.patchGroupsDirty=!0;b.patchGroupsMap=new Map;b.tileIterator=new B.IteratorPreorder;b.highestVisibleLODTile=null;b.visible=!0;b.debugScreenSizePerspective=!1;b._opaque=!0;b._skirtScale=1;b._renderPatchBorders=!1;b._renderingDisabled=!1;b.backfaceCullingEnabled=!1;b._renderOrder=1;b._velvetOvergroundEnabled=!0;b.hasOverlays=!1;b._slicePlaneEnabled=!1;b._wireframeEnabled=!1;b.castShadows=!0;
b.receiveShadows=!1;b.emptyTex=null;b.tileRenderer=null;b.tileBackgroundInitialized=!1;b.stencilEnabledLayerExtents=[];b.numTrianglesRendered=0;b.numTilesRendered=0;b.numTilesCulled=0;b.numOriginsRendered=0;b.clippingExtent=null;b.needsHighlight=!1;b.visibleScaleRangeQueries=new c({initialSize:10});b.visibleScaleRangeQueriesInvPtr=0;b.visibleScaleRangeQueryQueue=new c({initialSize:30});b.visibleScaleRangeQueryPool=new f(Q,!1);return b}m(g,a);g.prototype.destroy=function(){z.clearCaches()};g.prototype.install=
function(a){a.addRenderPlugin([4,9],this);this.drapedRenderer=a.renderView.getDrapedRenderer()};g.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(g.prototype,"updating",{get:function(){return!this.tileBackgroundInitialized},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"canRender",{get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this._renderingDisabled},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"renderingDisabled",{set:function(a){this._renderingDisabled=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"opaque",{get:function(){return this._opaque&&!this._slicePlaneEnabled},set:function(a){this._opaque!==a&&(this._opaque=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"renderPatchBorders",{set:function(a){this._renderPatchBorders!==a&&(this._renderPatchBorders=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"cullBackFaces",{set:function(a){this.backfaceCullingEnabled=a;this._updatePrograms();this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderOrder",{get:function(){return this._renderOrder},set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"velvetOvergroundEnabled",{set:function(a){this._velvetOvergroundEnabled!==a&&(this._velvetOvergroundEnabled=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"intersectionHandlerId",{get:function(){return F.TERRAIN_ID},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=
a,this._updatePrograms())},enumerable:!0,configurable:!0});g.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};g.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};g.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};g.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};g.prototype.loadCachedElevationData=function(a){R(null===
a.renderData);var b=B.tile2str(a);if(b=this.memCache.pop(b)){a.renderData=b.renderData;a.renderData.tile=a;a.renderData.localOrigin=this._getLocalOriginOfTile(a);for(var c=0;c<b.upsampleLIJs.length;c++){var d=B.findParentByLIJ(a,b.upsampleLIJs[c]);a.layerInfo[0][c].setUpsampleInfo(a,d)}}return null!=b};g.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a),this.updateTileGeometry(a));this.updateTileTexture(a)};
g.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();u.vec4.copy(e.extent,a);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};g.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(a),a.resetPendingUpdate(32))};g.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[0];b<
c.length;b++)c[b].pendingUpdates&=-17;a.renderData.updateGeometry(this.rctx,this._wireframeEnabled)&&this.setNeedsRender()};g.prototype.unloadTile=function(a,b){if(a.renderData){a.renderData.releaseTexture();if(b){b={renderData:a.renderData,upsampleLIJs:[]};for(var c=0,d=a.layerInfo[0];c<d.length;c++){var e=d[c].upsampleFromTile.tile.lij;b.upsampleLIJs.push([e[0],e[1],e[2]])}this.memCache.put(B.tile2str(a),b,a.renderData.estimatedGeometryMemoryUsage)}else this.releaseTileGeometry(a.renderData);a.renderData=
null;a.setMemoryDirty();this.setNeedsRender()}};g.prototype._getLocalOriginOfTile=function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return w.vec3f64.ZEROS;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};g.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};g.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,
numOriginsRendered:this.numOriginsRendered}};g.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&(this.debugScreenSizePerspective=a,this._updatePrograms())};g.prototype.setWireframe=function(a){var b=this;this._wireframeEnabled!==a&&(this._wireframeEnabled=a,this.rootTiles&&(B.traverseTilesPreorder(this.rootTiles,function(c){c.renderData&&c.renderData.updateGeometry(b.rctx,a)}),this.setNeedsRender()))};g.prototype.setNeedsRender=function(a){void 0===a&&(a=1);
this.patchGroupsDirty=!0;this._initContext.requestRender(a)};g.prototype.setTileBackground=function(a){this.tileBackground=a;this._updateTileBackground()};g.prototype.initializeRenderContext=function(a){var b=this;this._initContext=a;this.rctx=a.rctx;a=this.programRep=a.programRep;this._updatePrograms();this.tileRenderer=new E(this.rctx,this.tileSize,a,function(){return b.setNeedsRender()});this.tileBackground&&this._updateTileBackground();this.emptyTex=G.createEmptyTexture(this.rctx)};g.prototype.uninitializeRenderContext=
function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};g.prototype.intersect=function(a,b,c,d,e){if(this.rootTiles&&(!a.enable.selectOpaqueTerrainOnly||!a.enable.selectionMode||this._opaque)){var f=da,g=ga;r.vec3.subtract(f,d,c);r.vec3.set(g,1/f[0],1/f[1],1/f[2]);var h=a.results.min,k=a.results.max,m=a.results.terrain,p=null,n=this.clippingExtent,q=this.tileIterator;q.reset(this.rootTiles);e=function(){var e=
q.next();if(null===e.renderData)return"continue";if(a.enable.invisibleTerrain){if(!e.visible&&n&&!e.intersectsExtent(n))return"continue"}else if(!e.visible)return"continue";var t=e.renderData.geometryInfo,w=-u._skirtScale*t.skirtLength;if(0!==w){var v=e.up;y.offset(t.boundingBox,w*v[0],w*v[1],w*v[2],U);y.expandWithBuffer(U,t.boundingBox,0,2)}var v=0===w?t.boundingBox:U,A=e.renderData.localOrigin;r.vec3.subtract(ca,c,A);if(!I.intersectAabbInvDir(v,ca,g,a.tolerance))return"continue";var E=function(a,
b,c,d){a.set(void 0,B.tile2str(b),c,d,O,void 0);a.intersector=ba;a.target=oa},v=function(g,n,q){0<=g&&(a.enable.backfacesTerrain||0>r.vec3.dot(n,f))&&(a.enable.invisibleTerrain||!a.enable.selectionMode||null==b||b(c,d,g))&&((null==m.dist||g<m.dist)&&E(m,e,g,n),a.enable.storeTerrainResults&&(a.enable.storeAll&&(l.isNone(p)?(p=new F.IntersectorResult(a.ray),E(p,e,g,n),a.results.all.push(p)):g<p.dist&&E(p,e,g,n)),(null==h.dist||g<h.dist)&&E(h,e,g,n),(null==k.dist||g>k.dist)&&E(k,e,g,n)))},C=ia;r.vec3.subtract(C,
d,A);var A=t.indices,H=t.vertexAttributes,G={data:H.getField("position",x.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:H.stride/4},t=t.numWithoutSkirtIndices/3;I.intersectTriangles(ca,C,0,t,A,G,null,v);0!==w&&z.intersectSkirts(ca,C,t,A.length/3,A,H,"spherical"===u.manifold?function(a){return r.vec3.scale(a,a,w/r.vec3.length(a))}:function(a){return r.vec3.set(a,0,0,w)},v)};for(var u=this;!q.done;)e()}};g.prototype.render=function(a){if(a.slot!==(this.opaque?4:9))return!1;H.trace("# BEGIN RENDER TERRAIN");
var b=a.pass,c=1===a.scenelightingData.globalFactor,d=this._updatePatchGroups();Z.overlayEnabled=!1;Z.used=!0;switch(b){case 0:Z.overlayEnabled=!0;Z.used=!1;b=a.shadowMap&&a.shadowMap.enabled;this.receiveShadows!==b&&(this.receiveShadows=b,this._updatePrograms());b=!this.drapedRenderer.isEmpty();b!==this.hasOverlays&&(this.hasOverlays=b,this._updatePrograms());this._renderMaterialPass(a,this.programs.color,d,Z);break;case 3:this.castShadows&&c&&this._renderAuxiliaryPass(a,this.programs.depthShadowMap,
d,Z);break;case 1:this._renderAuxiliaryPass(a,this.programs.depth,d,Z);break;case 2:this._renderAuxiliaryPass(a,this.programs.normal,d,Z);break;case 4:this.needsHighlight&&(Z.overlayEnabled=!0,this._renderAuxiliaryPass(a,this.programs.highlight,d,Z),a.rctx.clearSafe(256))}H.trace("# END RENDER TERRAIN");0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};g.prototype._renderMaterialPass=function(a,b,c,d){var e=this,f=a.camera;a.rctx.bindProgram(b);a.shadowMap&&a.shadowMap.bind(b);
a.ssaoHelper&&a.ssaoHelper.setUniforms(b);b.setUniform1i("tex",0);this._bindOverlayUniforms(b);b.setUniformMatrix4fv("viewNormal",f.viewInverseTransposeMatrix);b.setUniformMatrix4fv("proj",f.projectionMatrix);a.scenelightingData.setUniforms(b,!0);f=f.viewMatrix;r.vec3.set(aa,f[12],f[13],f[14]);r.vec3.normalize(aa,aa);b.setUniform3fv("viewDirection",aa);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(a,
b,c,d):a.offscreenRenderingHelper.renderToTargets(function(){return e._renderPatchGroups(a,b,c,d)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};g.prototype._renderAuxiliaryPass=function(a,b,c,d){a.rctx.bindProgram(b);if(4===a.pass){var e=a.offscreenRenderingHelper;a.rctx.bindTexture(e.depthTexture,5);b.setUniform1i("depthTex",5);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height)}else if(b.setUniformMatrix4fv("viewNormal",
a.camera.viewInverseTransposeMatrix),1===a.pass||3===a.pass)T[0]=a.camera.near,T[1]=a.camera.far,b.setUniform2fv("nearFar",T);this._renderPatchGroupsAuxiliary(a,b,c,d)};g.prototype._updateTileBackground=function(){var a=this;if(this.tileRenderer){var b=function(){a.tileBackgroundInitialized=!0;a.rootTiles&&B.traverseTilesPreorder(a.rootTiles,function(b){return a.tileRenderer.updateTileTexture(b)});a.setNeedsRender()};if("string"===typeof this.tileBackground){var c=this.tileBackground;t.requestImage(c).then(function(d){c===
a.tileBackground&&a.tileRenderer&&(a.tileRenderer.setBackground(d),b())})}else{var e=this.tileBackground?d.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(e);b()}}};g.prototype._updatePatchGroups=function(){var a=this,b=this.patchGroups;if(!this.patchGroupsDirty)return b;this.highestVisibleLODTile=null;this._renderCollectOrigins(b);if(0!==this.renderOrder){for(var c=0;c<b.length;c++)B.sortTiles(this.renderOrder,b.data[c].patches);b.sort(function(b,c){var d=a.renderOrder;
b=0===b.patches.length?-d:0===c.patches.length?d:B.compareTiles(b.patches.data[0],c.patches.data[0],d);return b})}this.patchGroupsDirty=!1;return b};g.prototype._renderCollectOrigins=function(a){var b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?w.vec3f64.ZEROS:e.centerAtSeaLevel;f.patches.clear();this._renderCollectOriginsForRoot(a,f)}};g.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;
c.resetOne(b.root);var d=this.patchGroupsMap;d.clear();for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.patches.clear()}if(!b.rendered)this.numTilesCulled++;else if(e){(f=d.get(e.localOrigin))&&f.patches.push(b);if(!this.highestVisibleLODTile||b.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=b;c.skipSubtree()}}}};
g.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};g.prototype._tileIntersectsStencilEnabledLayer=function(a){for(var b=this.stencilEnabledLayerExtents,c=0;c<b.length;c++)if(a.intersectsExtent(b[c]))return!0;
return!1};g.prototype._renderPatchGroupsAuxiliary=function(a,b,c,d){a.rctx.setPipelineState(this.defaultPipelineState);var e=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d.overlayEnabled&&this._bindOverlayUniforms(b);for(var f=0;f<c.length;f++){var g=c.data[f];this._bindViewForPatchGroup(b,g,a.camera.eye,a.camera.viewMatrix);for(var h=0;h<g.patches.length;h++)this._renderPatch(a.rctx,b,g.patches.data[h],
4,e,d)}a.rctx.bindVAO(null)};g.prototype._renderPatchGroups=function(a,b,c,d){var e=a.rctx,f=a.camera,g=f.viewMatrix;e.setPipelineState(this.defaultPipelineState);if(this.debugScreenSizePerspective&&this.pointsOfInterest){var h=K.getSettings("spherical"===this.manifold?"global":"local");h.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});I.bindScreenSizePerspective(h,b,"screenSizePerspective")}h=0<this.stencilEnabledLayerExtents.length;b.setUniform1f("skirtScale",
this._skirtScale);for(var l=this._wireframeEnabled?1:4,k=0;k<c.length;k++){var m=c.data[k],p=m.patches;if(0!==p.length){this._bindViewForPatchGroup(b,m,f.eye,g);var n=a.sliceHelper&&a.sliceHelper.plane;n&&I.bindSlicePlane(m.origin,n,b);a.shadowMap&&a.shadowMap.bindView(b,m.origin);this.numOriginsRendered++;for(m=0;m<p.length;m++){n=p.data[m];H.trace("# RENDER TILE "+B.tile2str(n)+", screenDepth:"+n.screenDepth);var q=n.renderData.geometryInfo.uvOffsetAndScale,r=n.renderData.texOffsetAndScale;u.vec4.set(W,
q[0]*r[2]+r[0],q[1]*r[3]+r[1],q[2]*r[2],q[3]*r[3]);b.setUniform4fv("texOffsetAndScale",W);e.bindTexture(n.renderData.textureReference,0);b.setUniform1f("opacity",n.renderData.opacity);q=this._renderPatch(e,b,n,l,h,d);n.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=q/3;this._scaleQueriesForTile(n)}}}e.bindVAO(null)};g.prototype._renderPatch=function(a,b,c,d,e,f){f.overlayEnabled&&(this._bindOverlayTextures(b,c.renderData.overlays,f.used),b.setUniform1f("overlayOpacity",
c.renderData.overlayOpacity));e&&a.setPipelineState(this._tileIntersectsStencilEnabledLayer(c)?this.stencilPipelineState:this.defaultPipelineState);e=0===this._skirtScale?c.renderData.geometryInfo.numWithoutSkirtIndices:c.renderData.vao.indexBuffer.size;a.bindVAO(c.renderData.vao);L.assertCompatibleVertexAttributeLocations(c.renderData.vao,b);a.drawElements(d,e,c.renderData.vao.indexBuffer.indexType,0);return e};g.prototype._bindViewForPatchGroup=function(a,b,c,d){a.setUniform3fv("origin",b.origin);
e.mat4.translate(X,d,b.origin);a.setUniformMatrix4fv("view",X);a.setUniform3f("camPos",c[0]-b.origin[0],c[1]-b.origin[1],c[2]-b.origin[2])};g.prototype._bindOverlayUniforms=function(a){a.setUniform1i("ovInnerColorTex",1);a.setUniform1i("ovOuterColorTex",2);a.setUniform1i("ovInnerWaterTex",3);a.setUniform1i("ovOuterWaterTex",4)};g.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=c?f.highlightRenderTargetId:f.renderTargetId;g?(P[e]=f.texOffset[0],P[e+1]=f.texOffset[1],
V[e]=f.texScale[0],V[e+1]=f.texScale[1],e=this.drapedRenderer.getRenderTargetTexture(g),this.rctx.bindTexture(e,1+d),(f=f.waterMaskRenderTargetId)?(f=this.drapedRenderer.getRenderTargetTexture(f),this.rctx.bindTexture(f,3+d)):this.rctx.bindTexture(this.emptyTex,3+d)):(P[e]=0,P[e+1]=0,V[e]=0,V[e+1]=0,this.rctx.bindTexture(this.emptyTex,1+d),this.rctx.bindTexture(this.emptyTex,3+d))}a.setUniform4fv("overlayTexOffset",P);a.setUniform4fv("overlayTexScale",V)};g.prototype._updatePrograms=function(){var a=
this.programRep;this.programs={color:a.getProgram(J.colorPass,{overlay:this.hasOverlays,atmosphere:"spherical"===this.manifold&&this._velvetOvergroundEnabled,tileBorders:this._renderPatchBorders,receiveShadows:this.receiveShadows,screenSizePerspective:this.debugScreenSizePerspective,slice:this._slicePlaneEnabled}),normal:a.getProgram(J.normalPass,{alphaZero:!0}),depth:a.getProgram(J.depthPass,{shadowMap:!1}),depthShadowMap:a.getProgram(J.depthPass,{shadowMap:!0}),highlight:a.getProgram(J.highlightPass,
{})};this.defaultPipelineState=M.makePipelineState({culling:this.backfaceCullingEnabled&&M.backFaceCullingParams,depthTest:{func:513},depthWrite:M.defaultDepthWriteParams,colorWrite:M.defaultColorWriteParams});this.stencilPipelineState=M.makePipelineState(k({},this.defaultPipelineState,{stencilTest:{function:{func:517,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7680}}}));this.setNeedsRender()};g.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};
g.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};g.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};Object.defineProperty(g.prototype,
"test",{get:function(){return{tileRenderer:this.tileRenderer}},enumerable:!0,configurable:!0});h([b.property()],g.prototype,"tileBackgroundInitialized",void 0);h([b.property({constructOnly:!0})],g.prototype,"manifold",void 0);h([b.property({constructOnly:!0})],g.prototype,"memCache",void 0);h([b.property({readOnly:!0,dependsOn:["tileBackgroundInitialized"]})],g.prototype,"updating",null);return g=h([b.subclass("esri.views.3d.terrain.TerrainRenderer")],g)}(b.declared(g));var Z={overlayEnabled:!1,used:!0},
X=p.mat4f64.create(),aa=w.vec3f64.create(),da=w.vec3f64.create(),ga=w.vec3f64.create(),ca=w.vec3f64.create(),ia=w.vec3f64.create(),ba="TerrainRenderer",oa={type:"external"};return n})},"esri/views/3d/terrain/PatchRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TerrainConst ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(){this.overlayTexOffset=d.vec2f64.create();this.texOffsetAndScale=l.vec4f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:f.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:l.vec4f64.create()}}a.prototype.init=function(a){this.tile=a;a=this.geometryInfo;a.indices=null;a.vertexAttributes=
null;f.empty(a.boundingBox);a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};this.textureReference=this._texture=this._vao=null;g.vec4.set(this.texOffsetAndScale,0,0,1,1);this.opacity=1;if(this.overlays){a=0;for(var b=this.overlays;a<b.length;a++){var c=b[a];c.renderTargetId=null;c.highlightRenderTargetId=null;c.waterMaskRenderTargetId=null;h.vec2.set(c.texScale,1,1);h.vec2.set(c.texOffset,
0,0)}}else for(this.overlays=[null,null],a=0;2>a;a++)this.overlays[a]={renderTargetId:null,highlightRenderTargetId:null,waterMaskRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};a.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a);return!0};a.prototype.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,
wireframe:!1},!0):!1};a.prototype.ensureTexture=function(a,b){this._texture&&this._texture.descriptor.width!==a&&this.releaseTexture();this._texture||(this._texture=b(),this.tile.setMemoryDirty());return this._texture};a.prototype.releaseTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null);this.textureReference=null};a.prototype._updateGeometryState=function(a){var b=this._getElevationInfo(),c=this.tile.lij[0],d=8>c?this.tile.numSubdivisionsAtLevel[c]+1:2;b.samplerData&&
(d=this.tile.maxTesselation,d=k.clamp((d>>Math.max(c-b.maxTileLevel,e.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-c)))+1,2,d+1));c=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)c=null;var f=this.geometryState,g=!1;f.numVertsPerRow!==d&&(f.numVertsPerRow=d,g=!0);b.changed&&(f.samplerData=b.samplerData,g=!0);m.equals(f.clippingArea,c)||(f.clippingArea=c,g=!0);f.wireframe!==a&&(f.wireframe=a,g=!0);return g};a.prototype._createGeometry=function(a){this.tile.createGeometry(this.geometryState,
this.localOrigin);var b=this.geometryInfo.vertexAttributes,d=this.geometryInfo.indices,e=a.gl;this._vao=new w(a,q.Default3D,{geometry:c.glLayout(b.layout)},{geometry:r.createVertex(a,e.STATIC_DRAW,b.buffer)},r.createIndex(a,e.STATIC_DRAW,d))};a.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;b.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(a.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0});a.prototype._getElevationInfo=
function(){for(var a=this.geometryState.samplerData,b=this.tile.layerInfo[0],c=b.length,d=Array(c),e=0,f=0,g=!1,h=0;h<c;h++){var l=b[h];if(l.upsampleFromTile){var l=l.upsampleFromTile.tile,k=l.layerInfo[0][h].data,k=k&&k.samplerData;a&&a[e]===k||(g=!0);d[e++]=k;f=Math.max(f,l.lij[0])}else l.data&&(k=this.tile.surface.layerViewByIndex(h,0),p.fallsWithinLayer(this.tile,k.layer,!1)&&(k=l.data,a&&a[e]===k.samplerData||(g=!0),d[e++]=k.samplerData,f=this.tile.lij[0]))}a&&a.length!==e&&(g=!0);0<e?d.length=
e:d=null;return{changed:g,samplerData:d,maxTileLevel:f}};Object.defineProperty(a.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureDescriptor",{get:function(){return this._texture?this._texture.descriptor:null},enumerable:!0,configurable:!0});return a}();a.PatchRenderData=n})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4 ../../2d/engine/vectorTiles/tileRendererHelper3D ../../2d/engine/vectorTiles/VectorTileDisplayObject ./terrainUtils ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/shaders/MiscPrograms ../../webgl/FramebufferObject ../../webgl/renderState ../../webgl/Texture ../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){function u(a,b,c){var d=a.layerInfo[1][b];c.layerIndex=b;if(d.data)return k.vec2.set(c.offset,0,0),c.tile=a,c.scale=1,c.sourceLod=a.lij,c.sourceLayerInfo=d,c;if(!d.upsampleFromTile)return null;a=d.upsampleFromTile;b=a.tile.layerInfo[1][b];c.tile=a.tile;k.vec2.copy(c.offset,a.offset);c.scale=a.scale;c.sourceLod=a.tile.lij;c.sourceLayerInfo=b;return c}var v=[],y={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return function(){function a(a,
d,f,g){this._context=a;this.tileSize=d;this._setNeedsRender=g;this._blackTex=this._backgroundTexture=null;this._context.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,this._context.parameters.maxMaxAnisotropy));this._vaoQuad=b.createQuadVAO(this._context,c.Pos3Tex);this._blendLayersProgram=f.getProgram(e.blendLayers);this._blendLayersPipelineState=q.makePipelineState({blending:q.simpleBlendingParams(1,771),colorWrite:q.defaultColorWriteParams});this._applyOpacityPipelineState=
q.makePipelineState({blending:q.simpleBlendingParams(0,770),colorWrite:q.defaultColorWriteParams});this._blackTex=b.createColorTexture(this._context,[0,0,0,1])}a.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._backgroundTexture&&(this._backgroundTexture.dispose(),this._backgroundTexture=null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),
this._blendLayersProgram=null)};a.prototype.updateTileTexture=function(a){for(var b=a.layerInfo[1],c=0;c<b.length;c++)b[c].pendingUpdates&=-33;if(a.renderData){var d=a.surface,e=d.baseOpacity,c=0,g=this.tileSize,h=!1,l,k=b.length;for(l=0;l<b.length&&!h;l++){var p=d.layerViewByIndex(l,1),n=p.fullOpacity;v[l]=n;this._isBaseLayer(p.layer)&&k>=b.length&&(k=l);0!==n&&u(a,l,y)&&(f.isVectorTileLayerView(p)?g=Math.max(g,this.tileSize*p.view.pixelRatio):p.isOpaque&&1===e&&1===n&&(h=!0),c++)}e=g;g=m.nextHighestPowerOfTwo(e);
b=g*g;d=e*e;b===d?g=e:(e=g/2,g=b-d<d-e*e?g:e);b=g/this.tileSize;--l;0===c&&this._backgroundTexture?this._useBackgroundTexture(a):1===c&&h?this._useLayerTexture(a,l):this._composeMapLayers(a,l,k,h,v,g,b);this._setNeedsRender()}};a.prototype.setBackground=function(a){this._backgroundTexture=a instanceof HTMLImageElement?this._buildTexture(a):b.createColorTexture(this._context,a)};a.prototype._buildTexture=function(a){var c={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,
maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},d=this._context,e;if("number"===typeof a)c.width=c.height=a,e=new r(d,c);else try{e=new r(d,c,a)}catch(B){e=b.createEmptyTexture(d),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}d.bindTexture(e);e.generateMipmap();return e};a.prototype._bindFBO=function(a,b,c,d){a&&a.width===b&&a.height===c||(a&&a.dispose(),a=p.create(this._context,{colorTarget:0,depthStencilTarget:d?1:0,width:b,height:c}));
this._context.bindFramebuffer(a);return a};a.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,g=this._vaoQuad;e.bindProgram(f);e.bindVAO(g);w.assertCompatibleVertexAttributeLocations(g,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",b);f.setUniform2f("offset",c[0],c[1]);f.setUniform1f("opacity",d);e.drawArrays(5,0,w.vertexCount(g,"geometry"))};a.prototype._drawVectorData=function(a,b,c){var d=this._context,e=a.tile.surface.layerViewByIndex(a.layerIndex,
1);g.renderVectorTile(d,a.sourceLod,a.sourceLayerInfo.data,e.renderer,e.layer.styleRepository,e.schemaHelper,Math.round(1/a.scale),a.offset,this.tileSize,b,c)};a.prototype._useBackgroundTexture=function(a){a.renderData.opacity=a.surface.baseOpacity;a.renderData.textureReference=this._backgroundTexture;d.vec4.set(a.renderData.texOffsetAndScale,0,0,1,1)};a.prototype._useLayerTexture=function(a,b){b=u(a,b,y);if(this._dataToTexture(b)){a.renderData.textureReference=b.sourceLayerInfo.data;var c=b.offset;
d.vec4.set(a.renderData.texOffsetAndScale,c[0],c[1],b.scale,b.scale)}a.renderData.opacity=a.surface.baseOpacity};a.prototype._composeMapLayers=function(a,b,c,e,f,g,k){var m=this,p=a.renderData.ensureTexture(g,function(){return m._buildTexture(g)}),n=this._context;this._fbo=this._bindFBO(this._fbo,p.descriptor.width,p.descriptor.height,!0);n.setViewport(0,0,g,g);n.setClearColor(0,0,0,0);n.setClearDepth(1);n.clearSafe(16640);var q=!1;!e&&this._backgroundTexture&&(n.setPipelineState(this._blendLayersPipelineState),
this._drawRasterData(this._backgroundTexture,1,h.vec2f64.ZEROS));e=a.surface.baseOpacity;for(var r=!1;0<=b;b--){var w=u(a,b,y);w&&(b<c&&1>e&&!r&&(n.setPipelineState(this._applyOpacityPipelineState),this._drawRasterData(this._blackTex,1,h.vec2f64.ZEROS,e),r=!0),0!==f[b]&&(w&&w.sourceLayerInfo&&w.sourceLayerInfo.data instanceof l?(q&&n.clearSafe(256),n.setPipelineState(this._blendLayersPipelineState),this._drawVectorData(w,k,f[b]),q=!0):this._dataToTexture(w)&&(n.setPipelineState(this._blendLayersPipelineState),
this._drawRasterData(w.sourceLayerInfo.data,w.scale,w.offset,f[b]))))}n.bindTexture(p);c=p.descriptor;n.gl.copyTexImage2D(n.gl.TEXTURE_2D,0,c.pixelFormat,0,0,c.width,c.height,0);p.generateMipmap();n.bindFramebuffer(null);a.renderData.opacity=r?1:e;a.renderData.textureReference=p;d.vec4.set(a.renderData.texOffsetAndScale,0,0,1,1)};a.prototype._dataToTexture=function(a){if(a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof l)return!1;var b=a&&a.sourceLayerInfo&&a.sourceLayerInfo.data;if(b instanceof
HTMLImageElement||b instanceof HTMLCanvasElement)this._rasterDataToTexture(a),a.tile.setMemoryDirty();return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof r};a.prototype._rasterDataToTexture=function(a){a=a.sourceLayerInfo;a.data=this._buildTexture(a.data)};a.prototype._isBaseLayer=function(a){return a.parent&&"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};Object.defineProperty(a.prototype,"test",{get:function(){return{fbo:this._fbo}},enumerable:!0,configurable:!0});
return a}()})},"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":function(){define("require exports ../../../../geometry ../../../../Viewpoint ../../../../core/has ../../../../core/libs/gl-matrix-2/mat4 ../../ViewState ../../../webgl/renderState".split(" "),function(n,a,m,k,h,d,g,l){Object.defineProperty(a,"__esModule",{value:!0});a.renderVectorTile=function(a,g,l,k,m,n,y,t,x,z,A){var p=n.adjustLevel(g[0]);z={context:a,drawPhase:0,state:f,stationary:!0,pixelRatio:z,displayLevel:p,requiredLevel:p,
drawphase:1,renderer:k,layerOpacity:A,globalOpacity:1};k.initializeProgramCache(a);var q=n.getScale(g[0]);n=n.getShift(g,y*q);var r=n[1];l.tileTransform.displayCoord[0]=-1-n[0]-t[0]*y*2;l.tileTransform.displayCoord[1]=1+r+(1-t[1])*y*2-2;t=l.tileTransform.transform;d.mat4.identity(t);y=.125*y*q/x;t[0]=y;t[5]=-y;z.state.size[0]=x;z.state.size[1]=x;k.setStateParams(z.state,z.pixelRatio,g[0]);l.attached||l.attachWithContext(a);l.triangleCount=0;if((g=m.backgroundBucketIds)&&0<g.length)for(a.setPipelineState(c),
x=0;x<g.length;x++)y=g[x],k.renderBackGroundLayer(a,m.layers[y],y,l,p,0,A);a.setPipelineState(b);z.drawphase=1;l.processRender(z);a.setPipelineState(e);z.drawphase=2;l.processRender(z);z.drawphase=3;l.processRender(z);h("esri-vector-tiles-debug")&&k.renderTileInfo(a,l)};var f=new g({viewpoint:new k({targetGeometry:new m.Point(0,0),scale:1,rotation:0}),size:[256,256]}),c=l.makePipelineState({blending:l.simpleBlendingParams(1,771),depthTest:{func:515},colorWrite:l.defaultColorWriteParams}),b=l.makePipelineState({depthTest:{func:515},
depthWrite:l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams}),e=l.makePipelineState({blending:l.simpleBlendingParams(1,771),depthTest:{func:515},colorWrite:l.defaultColorWriteParams})})},"esri/views/2d/ViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){var t=[0,0];return function(a){function g(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c=a.apply(this,c)||this;c._viewpoint2D={center:u.vec2f64.create(),rotation:0,scale:0,spatialReference:null};c.center=[0,0];c.extent=new h.Extent;c.id=0;c.inverseTransform=e.mat2df64.create();c.resolution=0;c.rotation=0;c.scale=0;c.transform=e.mat2df64.create();c.transformNoRotation=e.mat2df64.create();c.displayMat3=q.mat3f32.create();c.displayViewMat3=
q.mat3f32.create();c.viewMat3=q.mat3f32.create();c.viewMat2d=b.mat2df32.create();c.worldScreenWidth=0;c.size=[0,0];return c}m(g,a);n=g;Object.defineProperty(g.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,c=a.targetGeometry;
b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});g.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=y.copy(c,a.viewpoint),this._set("size",r.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};g.prototype.clone=function(){return new n({size:this.size,viewpoint:this.viewpoint.clone(),
pixelRatio:this.pixelRatio})};g.prototype.toMap=function(a,b,c){if(v.isVec2(b))return r.vec2.transformMat2d(a,b,this.inverseTransform);t[0]=b;t[1]=c;return r.vec2.transformMat2d(a,t,this.inverseTransform)};g.prototype.toScreen=function(a,b,c){if(v.isVec2(b))return r.vec2.transformMat2d(a,b,this.transform);t[0]=b;t[1]=c;return r.vec2.transformMat2d(a,t,this.transform)};g.prototype.toScreenNoRotation=function(a,b,c){if(v.isVec2(b))return r.vec2.transformMat2d(a,b,this.transformNoRotation);t[0]=b;t[1]=
c;return r.vec2.transformMat2d(a,t,this.transformNoRotation)};g.prototype.pixelSizeAt=function(a){return y.pixelSizeAt(a,this.viewpoint,this.size)};g.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");y.getMatrix(a,c,e,b,0,d);return a};g.prototype._update=function(){var a=this._viewpoint2D,b=a.center,e=a.spatialReference,g=a.scale,l=a.rotation,a=this._get("pixelRatio")||1,k=this._get("size");this._set("id",this.id+1);var m=new d({targetGeometry:new h.Point(b[0],
b[1],e),scale:g,rotation:l});this._set("viewpoint",m);if(k&&e&&g)return this.resolution=y.getResolution(m),this.rotation=l,this.scale=g,this.spatialReference=e,r.vec2.copy(this.center,b),p.mat3.set(this.displayMat3,0!==k[0]?2/k[0]:0,0,0,0,0!==k[1]?-2/k[1]:0,0,-1,1,1),g=p.mat3.identity(this.viewMat3),b=w.vec2f32.fromValues(k[0]/2,k[1]/2),e=w.vec2f32.fromValues(-k[0]/2,-k[1]/2),l=f.common.toRadian(l),p.mat3.translate(g,g,b),p.mat3.rotate(g,g,l),p.mat3.translate(g,g,e),p.mat3.multiply(this.displayViewMat3,
this.displayMat3,g),g=c.mat2d.identity(this.viewMat2d),c.mat2d.translate(g,g,b),c.mat2d.rotate(g,g,l),c.mat2d.translate(g,g,e),y.getExtent(this.extent,m,k),y.getTransform(this.transform,m,k,a),c.mat2d.invert(this.inverseTransform,this.transform),y.getTransformNoRotation(this.transformNoRotation,m,k,a),this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution),this};var n;k([l.property({readOnly:!0})],g.prototype,"id",void 0);k([l.property({value:1,json:{write:!0}})],g.prototype,
"pixelRatio",null);k([l.property({json:{write:!0}})],g.prototype,"size",null);k([l.property({type:d,json:{write:!0}})],g.prototype,"viewpoint",null);return g=n=k([l.subclass("esri.views.2d.ViewState")],g)}(l.declared(g.JSONSupport))})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require","exports"],function(n,a){function m(a){return a instanceof Float32Array&&2<=a.length}function k(a){return Array.isArray(a)&&2<=a.length}Object.defineProperty(a,"__esModule",{value:!0});a.isVec2f32=
m;a.isVec2f64=k;a.isVec2=function(a){return m(a)||k(a)}})},"esri/views/2d/viewpointUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Viewpoint ../../core/asyncUtils ../../core/Collection ../../core/maybe ../../core/promiseUtils ../../core/unitUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A){function E(a,b,c,d){return d&&c&&!d.equals(c)&&z.canProject(d,c)&&d.isWebMercator?(d.isWebMercator?(c=b[1],89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999),c=Math.sin(e.common.toRadian(c)),a=r.vec2.set(a,e.common.toRadian(b[0])*P,.5*P*Math.log((1+c)/(1-c)))):(c=e.common.toDegree(b[0]/P),a=r.vec2.set(a,c-360*Math.floor((c+180)/360),e.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/P))))),a):r.vec2.copy(a,b)}function B(a){return a.wkid?
a:a.spatialReference||t.WGS84}function G(a,b){return b.type?r.vec2.set(a,b.x,b.y):r.vec2.copy(a,b)}function F(a,b){return Math.max(a.width/b[0],a.height/b[1])*T(a.spatialReference)}function K(a,b,c,d){return k(this,void 0,void 0,function(){var e,h,k,p,n,q,r,w,t,x,A,B,E,H,F,M,D,I,G,L,R,J,N,O,Q,W,P,T;return m(this,function(m){switch(m.label){case 0:if(!a||Array.isArray(a)&&!a.length)return[2,null];g.isCollection(a)&&(a=a.toArray());if(!Array.isArray(a)||!a.length||"object"!==typeof a[0])return[3,7];
h=a.every(function(a){return"attributes"in a});k=a.some(function(a){return!a.geometry});p=a;if(!(h&&k&&b&&b.allLayerViews))return[3,2];n=new Map;q=0;for(r=a;q<r.length;q++)w=r[q],t=w.layer,x=n.get(t)||[],A=w.attributes[t.objectIdField],null!=A&&x.push(A),n.set(t,x);B=[];n.forEach(function(a,c){var d=b.allLayerViews.find(function(a){return a.layer.id===c.id});if("queryFeatures"in d){var e=c.createQuery();e.objectIds=a;e.returnGeometry=!0;B.push(d.queryFeatures(e))}});return[4,f.all(B)];case 1:E=m.sent();
H=[];F=0;for(M=E;F<M.length;F++)if((D=M[F])&&D.features&&D.features.length)for(I=0,G=D.features;I<G.length;I++)w=G[I],l.isSome(w.geometry)&&H.push(w.geometry);p=H;m.label=2;case 2:L=0,R=p,m.label=3;case 3:if(!(L<R.length))return[3,6];J=R[L];return[4,K(J,b,c,d)];case 4:d=m.sent(),m.label=5;case 5:return L++,[3,3];case 6:return[2,d];case 7:if(!Array.isArray(a)||2!==a.length||"number"!==typeof a[0]||"number"!==typeof a[1])return[3,8];e=new y(a);return[3,12];case 8:if(!(a instanceof v))return[3,9];e=
a;return[3,12];case 9:if(!("geometry"in a))return[3,12];if(!a.geometry)return[3,10];e=a.geometry;return[3,12];case 10:if(!a.layer)return[3,12];N=a.layer;O=b.allLayerViews.find(function(a){return a.layer.id===N.id});if(!("queryFeatures"in O))return[3,12];Q=N.createQuery();Q.objectIds=[a.attributes[N.objectIdField]];Q.returnGeometry=!0;return[4,O.queryFeatures(Q)];case 11:W=m.sent(),e=l.get(W,"features",0,"geometry"),m.label=12;case 12:if(l.isNone(e))return[2,null];P="point"===e.type?new u({xmin:e.x,
ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference}):e.extent;if(!P)return[2,null];T=z.canProject(P,c);if(!P.spatialReference.equals(c)&&T)P=z.project(P,c);else if(!T)return[2,null];d=d?d.union(P):P.clone();return[2,d]}})})}function H(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&
a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function N(a,b){return k(this,void 0,void 0,function(){var c,d,e,f,g,l,k,p,n,q,r,t,v,x,M,C;return m(this,function(m){switch(m.label){case 0:if(!a||!b)return[2,new h({targetGeometry:new y,scale:0,rotation:0})];c=b.spatialReference;d=b.size;e=b.viewpoint;f=b.constraints;g=null;"esri.Viewpoint"===
a.declaredClass?g=a:a.viewpoint?g=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&(g=a.target);l=null;if(!g||!g.targetGeometry)return[3,1];l=g.targetGeometry;return[3,10];case 1:if(!(a instanceof u))return[3,2];l=a;return[3,10];case 2:return a||a&&(a.hasOwnProperty("center")||a.hasOwnProperty("extent")||a.hasOwnProperty("target"))?[4,K(a.center,b,c)]:[3,10];case 3:return(n=m.sent())?[3,5]:[4,K(a.extent,b,c)];case 4:n=m.sent(),m.label=5;case 5:return(p=n)?[3,7]:[4,K(a.target,b,c)];
case 6:p=m.sent(),m.label=7;case 7:return(k=p)?[3,9]:[4,K(a,b,c)];case 8:k=m.sent(),m.label=9;case 9:l=k,m.label=10;case 10:!l&&e&&e.targetGeometry?l=e.targetGeometry:!l&&b.extent&&(l=b.extent);q=B(l);c||(c=B(b.spatialReference||b.extent||l));if(!A.canProject(l,c)&&q&&!q.equals(c))return[2,null];r=G(w.vec2f64.create(),l.center?l.center:l);t=new y(E(r,r,q,c),c);v=null;v=g&&g.targetGeometry&&"point"===g.targetGeometry.type?g.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&
-1!==a.zoom&&f&&f.effectiveLODs?f.zoomToScale(a.zoom):Array.isArray(l)||"point"===l.type||"extent"===l.type&&0===l.width&&0===l.height?b.extent&&z.canProject(b.extent,c)?F(z.project(b.extent,c),d):b.extent?F(b.extent,d):e.scale:z.canProject(l.extent,c)?F(z.project(l.extent,c),d):F(l.extent,d);if(x=H(a))x.min&&x.min>v?v=x.min:x.max&&x.max<v&&(v=x.max);M=0;g?M=g.rotation:a.hasOwnProperty("rotation")?M=a.rotation:e&&(M=e.rotation);C=new h({targetGeometry:t,scale:v,rotation:M});f&&(C=f.fit(C),f.rotationEnabled||
(C.rotation=M));return[2,C]}})})}function I(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function J(a,b,c){return c?r.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):r.vec2.scale(a,b,.5)}function M(b,c,d,e){a.getTransform(b,c,d,e);return p.mat2d.invert(b,b)}function L(a,b,c){var d=O(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return r.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*
b+c[0]*d))}function R(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=x.isValid(a)?1/(39.37*c.getMetersPerUnitForSR(a)*96):1;return b*a}function O(a){return e.common.toRadian(a.rotation)||0}function T(a){return x.isValid(a)?39.37*c.getMetersPerUnitForSR(a)*96:1}function U(a){return a.isWrappable?(a=x.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(a,"__esModule",{value:!0});var P=b.wgs84Radius,V=180/Math.PI;a.extentToScale=F;a.create=N;a.copy=I;a.getAnchor=J;a.getExtent=function(){var a=
w.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;G(a,e);c=.5*R(c);b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();a.setExtent=function(b,c,d,e,f){a.centerAt(b,c,d.center);b.scale=F(d,e);f&&f.constraints&&f.constraints.constrain(b);return b};a.getOuterExtent=function(){var a=w.vec2f64.create(),b=w.vec2f64.create();return function(c,d,e){G(a,d.targetGeometry);L(b,d,e);e=.5*R(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-
e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});return c}}();a.getOuterSize=L;a.getPaddingScreenTranslation=function(){var a=w.vec2f64.create();return function(b,c,d){return r.vec2.sub(b,r.vec2.scale(b,c,.5),J(a,c,d))}}();a.getPaddingMapTranslation=function(){var b=q.mat2df64.create(),c=w.vec2f64.create();return function(d,e,f,g){var h=R(e);e=O(e);r.vec2.set(c,h,h);p.mat2d.fromScaling(b,c);p.mat2d.rotate(b,b,e);p.mat2d.translate(b,b,a.getPaddingScreenTranslation(c,
f,g));p.mat2d.translate(b,b,[0,g.top-g.bottom]);return r.vec2.set(d,b[4],b[5])}}();a.getResolution=R;a.getResolutionToScaleFactor=T;a.getMatrix=function(){var a=w.vec2f64.create(),b=w.vec2f64.create(),c=w.vec2f64.create();return function(d,e,f,g,h,l){r.vec2.negate(a,e);r.vec2.scale(b,f,.5*l);r.vec2.set(c,1/g*l,-1/g*l);p.mat2d.identity(d);p.mat2d.translate(d,d,b);h&&p.mat2d.rotate(d,d,h);p.mat2d.scale(d,d,c);p.mat2d.translate(d,d,a);return d}}();a.getTransform=function(){var b=w.vec2f64.create();return function(c,
d,e,f){var g=R(d),h=O(d);G(b,d.targetGeometry);return a.getMatrix(c,b,e,g,h,f)}}();a.getTransformNoRotation=function(){var b=w.vec2f64.create();return function(c,d,e,f){var g=R(d);G(b,d.targetGeometry);return a.getMatrix(c,b,e,g,0,f)}}();a.getWorldWidth=U;a.getWorldScreenWidth=function(a,b){return Math.round(U(a)/b)};a.createAsync=function(a,b){return d.safeCast(N(a,b))};a.angleBetween=function(){var a=w.vec2f64.create(),b=w.vec2f64.create(),c=[0,0,0];return function(d,e,f){r.vec2.subtract(a,d,e);
r.vec2.normalize(a,a);r.vec2.subtract(b,d,f);r.vec2.normalize(b,b);r.vec2.cross(c,a,b);d=Math.acos(r.vec2.dot(a,b)/(r.vec2.length(a)*r.vec2.length(b)))*V;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();a.addPadding=function(){var b=w.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;I(c,d);a.getPaddingMapTranslation(b,d,e,f);g.x+=b[0];g.y+=b[1];return c}}();a.removePadding=function(){var b=w.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;I(c,d);a.getPaddingMapTranslation(b,
d,e,f);g.x-=b[0];g.y-=b[1];return c}}();a.centerAt=function(){var a=w.vec2f64.create();return function(b,c,d){I(b,c);c=b.targetGeometry;var e=B(d),f=B(c);G(a,d);E(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();a.pixelSizeAt=function(a,b,c){return R(b)};a.resize=function(){var b=w.vec2f64.create();return function(c,d,e,f,g){g||(g="center");r.vec2.sub(b,e,f);r.vec2.scale(b,b,.5);e=b[0];f=b[1];switch(g){case "center":r.vec2.set(b,0,0);break;case "left":r.vec2.set(b,-e,0);break;case "top":r.vec2.set(b,0,f);
break;case "right":r.vec2.set(b,e,0);break;case "bottom":r.vec2.set(b,0,-f);break;case "top-left":r.vec2.set(b,-e,f);break;case "bottom-left":r.vec2.set(b,-e,-f);break;case "top-right":r.vec2.set(b,e,f);break;case "bottom-right":r.vec2.set(b,e,-f)}a.translateBy(c,d,b);return c}}();a.rotateBy=function(a,b,c){I(a,b);a.rotation+=c;return a};a.rotateTo=function(a,b,c){I(a,b);a.rotation=c;return a};a.scaleBy=function(){var b=w.vec2f64.create();return function(c,d,e,f,g){I(c,d);isNaN(e)||0===e||(a.toMap(b,
f,d,g),c.scale=d.scale*e,a.toScreen(b,b,c,g),a.translateBy(c,c,r.vec2.set(b,b[0]-f[0],f[1]-b[1])));return c}}();a.scaleTo=function(a,b,c){I(a,b);a.scale=c;return a};a.scaleAndRotateBy=function(){var b=w.vec2f64.create();return function(c,d,e,f,g,h){I(c,d);isNaN(e)||0===e||(a.toMap(b,g,d,h),c.scale=d.scale*e,c.rotation+=f,a.toScreen(b,b,c,h),a.translateBy(c,c,r.vec2.set(b,b[0]-g[0],g[1]-b[1])));return c}}();a.padAndScaleAndRotateBy=function(){var b=w.vec2f64.create(),c=w.vec2f64.create();return function(d,
e,f,g,h,l,k){a.getPaddingScreenTranslation(c,l,k);r.vec2.add(b,h,c);return g?a.scaleAndRotateBy(d,e,f,g,b,l):a.scaleBy(d,e,f,b,l)}}();a.toMap=function(){var a=q.mat2df64.create();return function(b,c,d,e){return r.vec2.transformMat2d(b,c,M(a,d,e,1))}}();a.toScreen=function(){var b=q.mat2df64.create();return function(c,d,e,f){return r.vec2.transformMat2d(c,d,a.getTransform(b,e,f,1))}}();a.translateBy=function(){var a=w.vec2f64.create(),b=q.mat2df64.create();return function(c,d,e){I(c,d);var f=R(d),
g=c.targetGeometry;p.mat2d.fromRotation(b,O(d));p.mat2d.scale(b,b,w.vec2f64.fromValues(f,f));r.vec2.transformMat2d(a,e,b);g.x+=a[0];g.y+=a[1];return c}}()})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=null,d=[];a.enabled=!1;a.begin=function(){a.enabled&&(h=[])};a.trace=function(d){a.enabled&&null!=h&&h.push(d)};a.end=function(){if(a.enabled){var g=
h;h=null;g&&(d.forEach(function(a){return a(g)}),d.length=0);return g}return null};a.instrumentContext=function(d){return a.enabled?k.default(d)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),d):m.makeDebugContext(d,void 0,function(d,f){a.enabled&&h&&h.push("gl."+d+"("+m.glFunctionArgsToString(d,f)+")")}):d};a.request=function(a){d.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function n(a){if(null==f){f={};c={};for(var b in a)"number"==
typeof a[b]&&(f[a[b]]=b,c[b]=a[b])}}function a(){if(null==f)throw"WebGLDebugUtils.init(ctx) not called";}function m(b){a();var c=f[b];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+b.toString(16)+""}function k(a,d,f,g){a=l[a];if(void 0!==a&&(a=a[d],void 0!==a&&a[f])){if("object"===typeof a[f]&&void 0!==a[f].enumBitwiseOr){d=a[f].enumBitwiseOr;f=0;a=[];for(var b=0;b<d.length;++b){var e=c[d[b]];0!==(g&e)&&(f|=e,a.push(m(e)))}return f===g?a.join(" | "):m(g)}return m(g)}return null===g?"null":
void 0===g?"undefined":g.toString()}function h(a,c,d){a.__defineGetter__(d,function(){return c[d]});a.__defineSetter__(d,function(a){c[d]=a})}function d(a,c,f,g){function b(a,b){return function(){f&&f(b,arguments);var d=a[b].apply(a,arguments),h=g.getError();0!=h&&(e[h]=!0,c(h,b,arguments));return d}}g=g||a;n(a);c=c||function(a,b,c){for(var d="",e=c.length,f=0;f<e;++f)d+=(0==f?"":", ")+k(b,e,f,c[f]);a="WebGL error "+m(a)+" in "+b+"("+d+")";window.console&&window.console.error?window.console.error(a):
window.console&&window.console.log&&window.console.log(a)};var e={},l={},p;for(p in a)if("function"==typeof a[p])if("getExtension"!=p)l[p]=b(a,p);else{var q=b(a,p);l[p]=function(){var b=q.apply(a,arguments);return d(b,c,f,g)}}else h(l,a,p);l.getError=function(){for(var b in e)if(e.hasOwnProperty(b)&&e[b])return e[b]=!1,b;return a.NO_ERROR};return l}function g(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),
a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);
a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var l={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},
drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,
2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,
1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},
frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},f=null,c=null;return{init:n,mightBeEnum:function(b){a();return void 0!==f[b]},glEnumToString:m,glFunctionArgToString:k,glFunctionArgsToString:function(a,c){for(var b="",d=c.length,e=0;e<d;++e)b+=(0==e?"":", ")+k(a,d,e,c[e]);return b},makeDebugContext:d,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=
Object.keys(H),b=0;b<a.length;++b)delete H[a]}function d(){++G;A||B==G&&a.loseContext()}function f(a,b){var c=a[b];return function(){d();if(!A)return c.apply(a,arguments)}}function l(a){return{statusMessage:a,preventDefault:function(){F=!0}}}function k(a){for(var b in a)"function"==typeof a[b]?n[b]=f(a,b):h(n,a,b);n.getError=function(){d();if(!A)for(var a;a=m.getError();)H[a]=!0;for(a in H)if(H[a])return delete H[a],a;return n.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");
for(b=0;b<c.length;++b){var e=c[b];n[e]=function(b){return function(){d();if(A)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=z;E.push(c);return c}}(a[e])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<c.length;++b)e=c[b],n[e]=function(b){return function(){d();return A?null:b.apply(a,arguments)}}(n[e]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)e=c[b],n[e]=function(b){return function(){d();return A?!1:b.apply(a,arguments)}}(n[e]);n.checkFramebufferStatus=function(b){return function(){d();return A?n.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(n.checkFramebufferStatus);n.getAttribLocation=function(b){return function(){d();
return A?-1:b.apply(a,arguments)}}(n.getAttribLocation);n.getVertexAttribOffset=function(b){return function(){d();return A?0:b.apply(a,arguments)}}(n.getVertexAttribOffset);n.isContextLost=function(){return A};return n}var m,n,t=[],x=[];n={};var z=1,A=!1,E=[],B=0,G=0,F=!1,K=0,H={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=m){if(m)throw"got different context";m=c;n=k(m)}return n}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":t.push(b(e));break;case "webglcontextrestored":x.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!A){A=!0;B=0;for(++z;m.getError(););c();H[m.CONTEXT_LOST_WEBGL]=!0;var b=l("context lost"),d=t.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=K&&setTimeout(function(){a.restoreContext()},K)},0)}};a.restoreContext=function(){A&&x.length&&setTimeout(function(){if(!F)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<E.length;++a){var b=E[a];b instanceof WebGLBuffer?m.deleteBuffer(b):b instanceof WebGLFramebuffer?m.deleteFramebuffer(b):b instanceof WebGLProgram?m.deleteProgram(b):b instanceof WebGLRenderbuffer?m.deleteRenderbuffer(b):b instanceof WebGLShader?m.deleteShader(b):b instanceof WebGLTexture&&m.deleteTexture(b)}g(m);A=!1;G=0;F=!1;for(var a=x.slice(),b=l("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(A)throw"You can not ask a lost contet to be lost";
B=G+a};a.getNumCalls=function(){return G};a.setRestoreTimeout=function(a){K=a};return a},resetToInitialState:g}})},"esri/views/3d/webgl-engine/shaders/TerrainRendererPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=function(a){return h.glslifyDefineMap({OVERLAY:a.overlay,ATMOSPHERE:a.atmosphere,TILE_BORDERS:a.tileBorders,RECEIVE_SHADOWS:a.receiveShadows,
SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,ALPHA_ZERO:a.alphaZero,BIAS_SHADOWMAP:a.shadowMap,SLICE:a.slice})};a.colorPass={name:"terrain-color",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("terrainRenderer/colorPass.vert"),fragmentShader:d(a)+k.resolveIncludes("terrainRenderer/colorPass.frag")}},attributes:m.Default3D};a.normalPass={name:"terrain-normal",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("terrainRenderer/normalPass.vert"),fragmentShader:d(a)+k.resolveIncludes("terrainRenderer/normalPass.frag")}},
attributes:m.Default3D};a.depthPass={name:"terrain-depth",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("terrainRenderer/depthPass.vert"),fragmentShader:d(a)+k.resolveIncludes("terrainRenderer/depthPass.frag")}},attributes:m.Default3D};a.highlightPass={name:"terrain-highlight",shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("terrainRenderer/highlightPass.vert"),fragmentShader:d(a)+k.resolveIncludes("terrainRenderer/highlightPass.frag")}},attributes:m.Default3D}})},
"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TilePerLayerInfo"],function(n,a,m){return function(){function a(a,d,g){this.lij=a;this._pool=d;this.layerInfo=Array(2);this.parent=null;for(a=0;2>a;a++)if(d=g[a],0<d){this.layerInfo[a]=[];for(var h=0;h<d;++h)this.layerInfo[a][h]=m.TilePerLayerInfo.makeEmptyLayerInfo(a,this._pool)}}a.prototype.hasDataAvailable=function(a,d,g){return(d=this.layerInfo[g][d].tilemap)?"unavailable"!==d.getAvailability(a.lij[1],a.lij[2]):
!0};a.prototype.modifyLayers=function(a,d,g){a=this.layerInfo[g];for(var h=d.length,f=Array(h),c=0;c<h;c++){var b=d[c];f[c]=-1<b?a[b]:m.TilePerLayerInfo.makeEmptyLayerInfo(g,this._pool)}this.layerInfo[g]=f};return a}()})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(n,a,m){return function(){function a(){this.offset=m.vec2f64.create();this.scale=0;this.tile=null}a.prototype.init=function(a,d,g,l){this.tile=a;this.offset[0]=
d;this.offset[1]=g;this.scale=l};a.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return a}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./lib/AutoDisposable ./lib/GeometryRecord ./lighting/Lightsources ./parts/Model ./parts/RenderView".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(a){return"function"===typeof a.addParentStage&&"function"===typeof a.removeParentStage}Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function h(){var b=null!==a&&a.apply(this,arguments)||this;b._viewContent=[];b._mainLightDirection=f.vec3f64.fromValues(0,1,0);return b}k(h,a);n=h;h.prototype.initialize=function(){this.model=new p;this._set("renderView",new q(this.container,this,this.model.getDirtySet(),this.options));this.setLighting({lights:[new e.MainLight(f.vec3f64.fromValues(.7,
.7,.7)),new e.AmbientLight(f.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})};h.prototype.destroy=function(){b.pool.prune(0);this.dispose()};Object.defineProperty(h.prototype,"dirty",{get:function(){var a=this.model.getDirtySet();return!(!a.hasDirtyGeometryRecords()&&!a.getDirtyMaterials())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"lighting",{get:function(){return this._lighting},enumerable:!0,configurable:!0});h.prototype.setLighting=function(a){l.vec3.set(this._mainLightDirection,0,0,0);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof e.MainLight){l.vec3.negate(this._mainLightDirection,d.direction);break}}this._lighting=a;this.renderView.setNeedsRender()};h.prototype.forceAllAnimations=function(a){this.getAll(3).forEach(function(b){d.applySome(b.animation,function(b){return b.forceTime(a)})});this.renderView.setNeedsRender()};
h.prototype.add=function(a,b){this.model.add(a,b);r(b)&&b.addParentStage(this);this.renderView.setNeedsRender()};h.prototype.remove=function(a,b){this.renderView.setNeedsRender();a=this.model.remove(a,b);r(a)&&a.removeParentStage(this);return a};h.prototype.notifyDirty=function(a,b,c,d){this.model.notifyDirty(a,b,c,d);this.renderView.setNeedsRender()};h.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){n.DebugSettings.logDirtySet&&
console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var c=a.commitLayers(this._viewContent);(0<c[0].length+c[1].length+c[2].length||b)&&this.renderView.modify(c[0],c[1],c[2],b);n.DebugSettings.logDirtySet&&(console.log("RGs add: "+c[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+c[1].map(function(a){return a.uniqueName})));a.commit();a.clearDirtyMaterials();this.renderView.setNeedsRender()}};h.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),
c=b.getDirtyMaterials();a=b.commitLayers([a]);(0<a[0].length+a[1].length+a[2].length||c)&&this.renderView.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();this.renderView.setNeedsRender()};h.prototype.getContent=function(a,b){return this.model.get(a,b)};h.prototype.getAll=function(a){return this.model.getAll(a)};h.prototype.getCount=function(a){return this.model.getAll(a).size};h.prototype.getCamera=function(){return this.renderView.getCamera()};h.prototype.setCamera=function(a){this.renderView.setCamera(a)};
h.prototype.getLayers=function(){return this.model.getAll(0)};h.prototype.getViewContent=function(){return this._viewContent.slice(0)};h.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};h.prototype.removeFromViewContent=function(a){this.processDirty();
for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);this.renderView.modify([],a,[])};h.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);return this.renderView.renderPlugins.add(a,b)};h.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);
return this.renderView.renderPlugins.remove(a)};h.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};var n;h.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};m([g.property({constructOnly:!0})],h.prototype,"options",void 0);m([g.property({constructOnly:!0})],h.prototype,"sceneIntersectionHelper",void 0);m([g.property({constructOnly:!0})],h.prototype,"viewingMode",void 0);m([g.property({constructOnly:!0})],h.prototype,"container",void 0);m([c.autoDispose()],
h.prototype,"model",void 0);m([c.autoDispose(),g.property()],h.prototype,"renderView",void 0);return h=n=m([g.subclass("esri.views.3d.webgl-engine.Stage")],h)}(g.declared(c.AutoDisposableMixin(h)));a.Stage=n})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(n,a,m,k,h,d,g,l,f){var c=f.assert,b=f.logWithBase;return function(){function a(){var a=
this;this.dirtySet=new g(this);this._uniqueIdx=0;this._id2origin={};this._content=new Map;d.allModelContentTypes.forEach(function(b){a._content.set(b,new Map)})}a.prototype.getAll=function(a){a=this._content.get(a);c(void 0!==a);return a};a.prototype.get=function(a,b){return this.getAll(a).get(b)};a.prototype.add=function(a,b){var d=this._content.get(a);c(void 0!==d);var e=b.id;c(!d.has(e),"Model/Stage already contains object to be added");d.set(e,b);0===a&&this.notifyDirty(a,b,"layerAdded")};a.prototype.remove=
function(a,b){var d=this._content.get(a);c(void 0!==d);var e=d.get(b);c(void 0!==e,"Model/Stage doesn't contain object to be removed");d.delete(b);4===a&&e.unload();0===a&&this.notifyDirty(a,e,"layerRemoved");return e};a.prototype.getDirtySet=function(){return this.dirtySet};a.prototype.notifyDirty=function(a,b,c,d){this.dirtySet.handleUpdate(b,c,d)};a.prototype.getOrigin=function(a,c,d){void 0===d&&(d=10);var e=0;c=c*d/1E4;1<c&&(e=Math.ceil(b(c,2)));c=1E4*Math.pow(2,e);d=Math.round(a[0]/c);var f=
Math.round(a[1]/c);a=Math.round(a[2]/c);var e=e+"_"+d+"_"+f+"_"+a,g=this._id2origin[e];null==g&&(g=h.fromValues(d*c,f*c,a*c,e),this._id2origin[e]=g);return g};a.prototype.getGeometryRenderGeometries=function(a,b,c){var d=a.id,e=b.geometry,f=a.getCombinedStaticTransformation(b),g=k.maxScale(f),h=b.origin,m=b.id,n=this._uniqueIdx++;a=new l(e.data,e.boundingInfo,b.material,f,b.shaderTransformation,g,a.castShadow,!!e.singleUse,d,m,n);a.origin=h||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=
b.instanceParameters;c.push(a)};a.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(c.transformation);a=this.getOrigin(c.center,c.bsRadius);return c.origin!==a};a.prototype.formatDebugInfo=function(a){var b=[];if(a){b[0]="\x3ctable\x3e";for(var c=0,e=d.allModelContentTypes;c<e.length;c++)a=e[c],b[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+this.getAll(a).size+"\x3c/td\x3e\x3c/tr\x3e";
b[0]+="\x3c/table\x3e";b[1]=this.dirtySet.formatDebugInfo(!0)}else{b[0]="";c=0;for(e=d.allModelContentTypes;c<e.length;c++)a=e[c],b[0]+=m.pad(String(this.getAll(a).size),6," ")+" "+a+", ";b[1]=this.dirtySet.formatDebugInfo(!1)}return b};a.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var d=a[b];c(null!=this.get(2,d.geometry.id));c(null!=this.get(3,d.material.id))}};a.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var d=this.get(1,
a[b].id);c(null!=d)}};return a}()})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.allModelContentTypes=[0,1,2,3,4];a.modelContentTypes={LAYER:0,OBJECT:1,GEOMETRY:2,MATERIAL:3,TEXTURE:4}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/iteratorUtils","./Util"],function(n,a,m,k,h){return function(){function a(a){this._residentGeomRecords=
new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=new Set;this._model=a}Object.defineProperty(a.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(d){a+=d.size});return a},enumerable:!0,configurable:!0});a.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:
null};a.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};a.prototype.hasDirtyGeometryRecords=function(){var a=!1;k.everyMap(this._dirtyGeomRecords,function(d){if(a)return!1;k.everyMap(d,function(d){if(!a&&d&&0<d.size)return a=!0,!1})});return a};a.prototype.handleUpdate=function(a,d,f){h.assert(this[d],"ModelDirtySet doesn't know how to process "+d);return this[d](a,f)};a.prototype.shaderTransformationChanged=function(a){var d=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,
c){(c=d._model.get(1,c))&&c.hasVolativeTransformation()&&a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};a.prototype.commit=function(){return this.commitLayers(m.keysOfMap(this._dirtyGeomRecords))};a.prototype.commitLayers=function(a){for(var d=this,f=[],c=[],b=[],e=function(e){var l=a[e];e=g._dirtyGeomRecords.get(l);if(!e)return"continue";e.forEach(function(a,e){var g=d._ensureGeomRecord(l,e);a.forEach(function(a,l){var k=a[0],m=a[1];a=a[2];var n=!1;
if(m&2){var p=g.get(l);if(p){p=p[1];if(a&4)for(var q=d._model.get(1,e),r=0;r<p.length;r++){var u=p[r];if(d._model.updateRenderGeometryTransformation(q,k,u)){n=!0;break}}if(!n)for(q=0;q<p.length;q++)u=p[q],b.push({renderGeometry:u,updateType:a})}else h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(m&4||n)(p=g.get(l))?c.push.apply(c,p[1]):4===m&&h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),p&&g.delete(l);if(m&1||n)m=[k,[]],q=d._model.get(1,
e),d._model.getGeometryRenderGeometries(q,k,m[1]),f.push.apply(f,m[1]),g.set(l,m)});0===g.size&&d._residentGeomRecords.get(l).delete(e)});0===g._residentGeomRecords.get(l).size&&g._residentGeomRecords.delete(l);g._dirtyGeomRecords.delete(l)},g=this,k=0;k<a.length;k++)e(k);return[f,c,b]};a.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(m.keysOfMap(this._residentGeomRecords))};a.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var d=
[],f=0;f<a.length;f++){var c=this._residentGeomRecords.get(a[f]);c&&c.forEach(function(a){a.forEach(function(a){d.push.apply(d,a[1])})})}return d};a.prototype.visibilityChanged=function(a,d,f){if(null!=d)this._componentPropertyChanged(a,d,f,1);else{d=0;for(var c=a.geometryRecords;d<c.length;d++)this._componentPropertyChanged(a,c[d],f,1)}};a.prototype.componentHighlightChanged=function(a,d,f){if(null!=d)this._componentPropertyChanged(a,d,f,16);else{d=0;for(var c=a.geometryRecords;d<c.length;d++)this._componentPropertyChanged(a,
c[d],f,16)}};a.prototype.vertexAttrsUpdated=function(a,d,f){this._updateOrCreateDirtyRecord(a,d,f,2,0,0,2,5,2)};a.prototype.matChanged=function(a){this._dirtyMaterials.add(a.id);if(this.onMaterialChanged)this.onMaterialChanged(a)};a.prototype.layerAdded=function(a){for(var d=a.getObjects(),f=0;f<d.length;f++)this.layerObjectAdded(a,d[f])};a.prototype.layerRemoved=function(a){for(var d=a.getObjects(),f=0;f<d.length;f++)this.layerObjectRemoved(a,d[f])};a.prototype.layerObjectAdded=function(a,d){a=a.id;
for(var f=d.geometryRecords,c=0;c<f.length;c++)this.objGeometryAdded(d,f[c],a)};a.prototype.layerObjectRemoved=function(a,d){a=a.id;for(var f=d.geometryRecords,c=0;c<f.length;c++)this.objGeometryRemoved(d,f[c],a)};a.prototype.layObjectReplaced=function(a,d){this.layerObjectRemoved(a,d[0]);this.layerObjectAdded(a,d[1])};a.prototype.objTransformation=function(a,d){var f=this;d=d||this._getParentLayerId(a);this._ensureGeomRecord(d,a.id).forEach(function(c){f._updateOrCreateDirtyRecord(a,c[0],d,2,0,0,
2,5,4)})};a.prototype.objGeometryAdded=function(a,d,f){this._updateOrCreateDirtyRecord(a,d,f,1,4,0,0,0)};a.prototype.objGeometryRemoved=function(a,d,f){this._updateOrCreateDirtyRecord(a,d,f,4,1,2,0,0)};a.prototype.objGeometryReplaced=function(a,d){this.objGeometryRemoved(a,d[0]);this.objGeometryAdded(a,d[1])};a.prototype.objGeometryTransformation=function(a,d){this.objGeometryReplaced(a,d)};a.prototype._componentPropertyChanged=function(a,d,f,c){this._updateOrCreateDirtyRecord(a,d,f,2,0,0,2,5,c)};
a.prototype._updateOrCreateDirtyRecord=function(a,d,f,c,b,e,k,m,n){f=f||this._getParentLayerId(a);var g=d.id;a=this._ensureDirtyRecord(f,a.id);(f=a.get(g))?(d=f[1],d&b?a.delete(g):d&e?(f[1]=c,f[2]=n):d&k?f[2]|=n:d&m||h.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(g,[d,c,n])};a.prototype._ensureGeomRecord=function(a,d){var f=this._residentGeomRecords.get(a);f||(f=new Map,this._residentGeomRecords.set(a,f));a=f.get(d);a||(a=new Map,f.set(d,a));return a};a.prototype._ensureDirtyRecord=
function(a,d){var f=this._dirtyGeomRecords.get(a);f||(f=new Map,this._dirtyGeomRecords.set(a,f));a=f.get(d);a||(a=new Map,f.set(d,a));return a};a.prototype._getParentLayerId=function(a){return a.parentLayer.id};a.prototype.formatDebugInfo=function(a){if(a)return"";var d=["ADD","UPD",void 0,"REM"],f="";this._dirtyGeomRecords.forEach(function(a,b){a.forEach(function(a,c){0<f.length&&(f+="\n");f+=b+"."+c;var e=[];a.forEach(function(a){var b=a[1];e[b]||(e[b]=[]);e[b].push(a[0].geometry.id)});for(a=0;a<
e.length;a++)if(e[a])for(f+=" "+d[a-1]+": ",c=0;c<e[a].length;c++)f+=e[a][c]+", "})});return f};return a}()})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/Logger ../../../../core/now ../../../../core/scheduling ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/animationUtils ../lib/AutoDisposable ../lib/Camera ../lib/DrapedRenderer ../lib/GLMaterialRep ../lib/ProgramRepository ../lib/Renderer ../lib/TextureRepository ../lib/tracer ./ScreenshotManager ../shaders/globalOptions ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B){var G=l.getLogger("esri.views.3d.webgl-engine.parts.View");return function(a){function d(b,c,d,f){var g=a.call(this)||this;g._stage=c;g._camera=new r.default(e.vec3f64.fromValues(0,100,-100));g._needsUpdate=!0;g._needsRender=!0;g._idleSuspend=!0;g._logicUpdateLast=0;g._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,frameCount:0};g._container=b;g._initializeContext(f);b=A.glslifyGlobalOptions({viewingMode:f.viewingMode});
g._programRepository=new v(g._rctx,b);g._textureRepository=new t(g._stage.getAll(4),g._programRepository,function(){return g._camera.viewport},g._rctx,function(){g._textureRepositoryHasNewLoadedTextures=!0});g._materialRepository=new u(g._textureRepository,g._programRepository);g._initializeViewportCamera();g._drapedRenderer=new w(g._rctx,g._canvas,g._programRepository,g._materialRepository,g._textureRepository,d);g._renderer=new y(g._programRepository,g._materialRepository,g._textureRepository,g._rctx,
"scene",function(a){void 0===a&&(a=1);return g.setNeedsRender(a)},g._stage);g._screenshotManager=new z.ScreenshotManager(g._rctx,g._render.bind(g),function(){return g.setNeedsRender()},f.screenshot.renderOverlay);g._registerFrameTask();return g}k(d,a);d.prototype.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this.inherited(arguments)};d.prototype.getCombinedStats=function(){var a=
this._rctx.gl,b={},c=this._renderer.getCombinedStats(),d;for(d in c)b[d]=c[d];b.renderGeometriesTotal=this._stats.renderGeometriesTotal;b.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==a.getUsedTextureMemory&&(b.textureMemory=a.getUsedTextureMemory());void 0!==a.getUsedRenderbufferMemory&&(b.renderbufferMemory=a.getUsedRenderbufferMemory());void 0!==a.getUsedVBOMemory&&(b.VBOMemory=a.getUsedVBOMemory());if(void 0!==a.getUsedTextureMemoryStats){var a=a.getUsedTextureMemoryStats(),
e;for(e in a)b["texMem type: "+e]=a[e]}return b};d.prototype.setNeedsRender=function(a){void 0===a&&(a=1);1===a?(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};Object.defineProperty(d.prototype,"canRender",{get:function(){var a=this._camera;return 0<a.fullWidth&&0<a.fullHeight&&this._renderer.canRender},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"needsUpdate",{get:function(){return this._needsUpdate||!this._idleSuspend||this._textureRepositoryHasNewLoadedTextures},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.getLoadingCount()||this._drapedRenderer.updating||this._stage.dirty},enumerable:!0,configurable:!0});d.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};Object.defineProperty(d.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0});d.prototype.setRenderParameters=
function(a){this.setNeedsRender();void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._renderer.setRenderParams(a)};d.prototype.getRenderParameters=function(){var a=this._renderer.getRenderParams();a.anisotropicFiltering=this._textureRepository.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(d.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});d.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:
"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};d.prototype.modify=function(a,b,c,d){this._renderer.modify(a,a.length,b,b.length,c,c.length,d)};d.prototype.setCamera=function(a){this._camera.copyFrom(a);this.setNeedsRender()};d.prototype.getCamera=function(){return this._camera};d.prototype.getCanvas=function(){return this._canvas};d.prototype.getDrapedRenderer=function(){return this._drapedRenderer};d.prototype.takeScreenshot=function(a){return this._screenshotManager.takeScreenshot(a)};
Object.defineProperty(d.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});d.prototype.getGpuMemoryUsage=function(){return m({},this._renderer.getGpuMemoryUsage(),{draped:this._drapedRenderer?this._drapedRenderer.getGpuMemoryUsage():0})};d.prototype._registerFrameTask=function(){var a=this,b={viewCamera:this._camera,frameHasSlicePlane:!1,
drapedRenderer:this._drapedRenderer};this._frameTask=c.addFrameTask({preRender:function(b){x.begin();var c=!1;a._stage.processDirty();a._drapedRenderer.commitChanges();var d=b.time-a._logicUpdateLast;d>p.DESIRED_ANIMATION_MS&&(c=a._renderer.updateLogic({dt:d,camera:a._stage.getCamera()})||c,a._logicUpdateLast=b.time);c&&a.setNeedsRender(0)},render:function(){(a.needsUpdate||a._needsRender)&&a.canRender&&(a._needsRender=!1,a._needsUpdate=!1,a._textureRepositoryHasNewLoadedTextures=!1,a._render(null,
a._camera,!1))},postRender:function(){a.notifyChange("updating");x.end()},update:function(){b.viewCamera=a._camera;b.frameHasSlicePlane=a._renderer.hasSlicePlane;b.drapedRenderer=a._drapedRenderer;a._screenshotManager.update(b)}})};d.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this.setCamera(b)};d.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=
document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var b=x.instrumentContext(E.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil},a.renderContext));this._rctx=new B(b,{disabledExtensions:a.deactivatedWebGLExtensions||{},debugWebGLExtensions:a.debugWebGLExtensions||{}});this._load3DExtensions(this._rctx);!a.alpha&&this._rctx.contextAttributes.alpha&&G.error("WebGL context has alpha channel even though no alpha channel was requested");
!this._rctx.contextAttributes.alpha&&11<=g("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};d.prototype._render=function(a,b,c){this._renderer.setLighting(this._stage.lighting);this._rctx.bindFramebuffer(a);b.setGLViewport(this._rctx);this._renderer.render({fbo:a,camera:b,disableSlice:c,lightDirection:this._stage.mainLightDirection})};d.prototype._load3DExtensions=function(a){a=a.capabilities;a.standardDerivatives&&a.shaderTextureLOD&&a.instancing&&
a.textureFilterAnisotropic||G.error("required WebGL extensions are not supported!")};h([b.property({type:Boolean,readOnly:!0})],d.prototype,"updating",null);h([q.autoDispose()],d.prototype,"_rctx",void 0);h([q.autoDispose()],d.prototype,"_container",void 0);h([q.autoDispose()],d.prototype,"_canvas",void 0);h([q.autoDispose()],d.prototype,"_programRepository",void 0);h([q.autoDispose()],d.prototype,"_renderer",void 0);h([q.autoDispose()],d.prototype,"_drapedRenderer",void 0);h([q.autoDispose()],d.prototype,
"_screenshotManager",void 0);return d=h([b.subclass("esri.views.3d.webgl-engine.parts.RenderView")],d)}(b.declared(q.AutoDisposableMixin(d)))})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ../../webgl-engine/lib/intersectorUtils ./Camera ./DefaultVertexBufferLayouts ./DrapedUpdates ./glUtil3D ./GridLocalOriginFactory ./Renderer ../lighting/Lightsources ../materials/ColorMaterial ../materials/HUDMaterial ../materials/RibbonLineMaterial ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z){n=function(){function a(a,b,d,f,g,l){var m=this;this._renderTargets={};this._clearColor=h.vec4f64.fromValues(0,0,0,0);this._uniqueIdx=0;this._localOrigins=new e;this._rctx=a;this._canvas=b;this._programRep=d;this._modelDirtySet=l;this._modelDirtySet.onMaterialChanged=function(){return m._emitContentChanged()};this._renderer=new p(d,f,g,this._rctx,"draped",function(){return m._emitContentChanged()});this._updates=new c.DrapedUpdates(this._renderer,
{emitContentChanged:function(){return m._emitContentChanged()},emitUpdatingChanged:function(){return m._emitUpdatingChanged()}});this._renderer.onHasHighlightsChanged=function(a){if(m.onHasHighlightsChanged)m.onHasHighlightsChanged(a)};this._renderer.setLighting({lights:[new q.AmbientLight(k.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}a.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();
this._renderer=null;this._updates.dispose();this._updates=null};a.prototype.disposeRenderTarget=function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};Object.defineProperty(a.prototype,"updating",{get:function(){return this._updates.updating},enumerable:!0,configurable:!0});a.prototype.commitChanges=function(){this._updates.commitChanges()};a.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};a.prototype.addRenderGeometries=
function(a){for(var b=0;b<a.length;b++){var c=a[b];null==c.origin&&(c.origin=this._localOrigins.getOrigin(c.center));c.idx=this._uniqueIdx++}this._updates.add(a)};a.prototype.removeRenderGeometries=function(a){this._updates.remove(a)};a.prototype.updateRenderGeometries=function(a,b){this._updates.modify(a,b)};a.prototype.updateRenderOrder=function(a){0<a.size&&(this._renderer.modifyRenderOrder(a),this._emitContentChanged())};a.prototype.setBackgroundColor=function(a){this._clearColor=a;this._emitContentChanged()};
a.prototype.updateHighlights=function(a){this._updates.modify(a,16)};a.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!d.OVERLAY_DRAW_TEST_TEXTURE};a.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify(null,0,null,0,null,0,a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"hasWater",{get:function(){return this._renderer.hasWater},enumerable:!0,configurable:!0});a.prototype.draw=function(a,b){return this.drawPass(0,a,b)};a.prototype.drawNormals=function(a,b){return this.drawPass(2,a,b)};a.prototype.drawHighlights=function(a,b){return this.drawPass(4,a,b)};a.prototype.drawPass=function(a,b,c){this._pixelRatio=c.pixelRatio*Math.abs(c.views[0].extent[2]-c.views[0].extent[0])/Math.abs(c.views[0].viewport[2]-c.views[0].viewport[0]);if(this.isEmpty()||4===a&&!this.hasHighlights||
2===a&&!this.hasWater)return!1;this.processDirtyMaterials();if(!c.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;b=this._renderTargets[b];if(!b)return!1;var e=this._rctx,f=c.width,g=c.height;b.width===f&&b.height===g||b.resize(f,g);var h=E.camera;E.fbo=b;h.near=1;h.far=1E4;h.pixelRatio=c.pixelRatio||1;e.bindFramebuffer(b);e.setClearColor.apply(e,this._clearColor);e.clearSafe(16384);for(var l=0;l<c.views.length;l++){var k=c.views[l];h.viewport=k.viewport;
m.mat4.ortho(h.projectionMatrix,0,k.extent[2]-k.extent[0],0,k.extent[3]-k.extent[1],h.near,h.far);m.mat4.identity(h.viewMatrix);m.mat4.translate(h.viewMatrix,h.viewMatrix,[-k.extent[0],-k.extent[1],0]);h.setGLViewport(this._rctx);d.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(f,g,A[c.index%A.length]);this._renderer.renderPass(a,E)}e.bindFramebuffer(null);e.setViewport(0,0,this._canvas.width,this._canvas.height);b.colorTexture.descriptor.hasMipmap&&b.colorTexture.generateMipmap();return!0};a.prototype._drawTestTexture=
function(a,c,d){var e=this._rctx;if(!this._testPatternTexture){for(var g=new Uint8Array(a*c*4),h=0,l=0;l<c;l++)for(var k=0;k<a;k++){var m=Math.floor(k/10),n=Math.floor(l/10);2>m||2>n||10*m>a-20||10*n>c-20?(g[h++]=255,g[h++]=255,g[h++]=255,g[h++]=255):(g[h++]=255,g[h++]=255,g[h++]=255,m&1&&n&1?g[h++]=k&1^l&1?0:255:g[h++]=m&1^n&1?0:128)}this._testPatternTexture=new x(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:c},g);this._testPatternProgram=this._programRep.getProgram(v.texOnly);
this._testPatternPipelineState=t.makePipelineState({blending:t.separateBlendingParams(770,1,771,771),colorWrite:t.defaultColorWriteParams});this._quadVAO=b.createQuadVAO(e,f.Pos3Tex)}a=this._testPatternProgram;e.bindProgram(a);e.setPipelineState(this._testPatternPipelineState);a.setUniform4f("color",d[0],d[1],d[2],1);a.setUniform1i("tex",0);e.bindTexture(this._testPatternTexture,0);e.bindVAO(this._quadVAO);e.drawArrays(5,0,z.vertexCount(this._quadVAO,"geometry"))};a.prototype.updateLogic=function(a){return this._renderer.updateLogic(a)};
a.prototype._emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};a.prototype._emitUpdatingChanged=function(){if(this.onUpdatingChanged)this.onUpdatingChanged()};a.prototype.createRenderTarget=function(a,b,c,d){for(var e=a,f=0;this._renderTargets[e];)e=a+"_"+ ++f;this._renderTargets[e]=y.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:d,hasMipmap:b,maxAnisotropy:c,width:0,height:0},{colorTarget:0,depthStencilTarget:0});
return e};a.prototype.getGpuMemoryUsage=function(){var a=0,b;for(b in this._renderTargets)a+=z.getGpuMemoryUsage(this._renderTargets[b]);return a};a.prototype.intersect=function(a,b,c){var d=this,e=0;this._renderer.forEachRenderGeometry(function(f){if(!c||c(f)){if(f.material instanceof r||f.material instanceof u||f.material instanceof w){var g=f.transformation[12],h=f.transformation[13];B[0]=b[0]-g;B[1]=b[1]-h;B[2]=1;G[0]=b[0]-g;G[1]=b[1]-h;G[2]=0;f.pixelRatio=d._pixelRatio;f.material.intersect(f,
null,f.getShaderTransformation(),a,B,G,function(b,c,g,h,l,k){d.addIntersectionResult(g,f.material.renderPriority,e,a,f.data.layerUid,f.data.graphicUid)},f.calculateShaderTransformation,!0)}e++}})};a.prototype.addIntersectionResult=function(a,b,c,d,e,f){var h={type:"external",metadata:{layerUid:e,graphicUid:f}};e=function(e){e.set(h,null,d.results.terrain.dist,d.results.terrain.normal,d.results.terrain.transformation,b,null,null,a,c);e.intersector="DrapedRenderer"};(null==d.results.min.drapedLayerOrder||
b>=d.results.min.drapedLayerOrder)&&(null==d.results.min.dist||d.results.terrain.dist<=d.results.min.dist)&&e(d.results.min);(null==d.results.max.drapedLayerOrder||b<d.results.max.drapedLayerOrder)&&(null==d.results.max.dist||d.results.terrain.dist>d.results.max.dist)&&e(d.results.max);d.enable.storeAll&&(f=new g.IntersectorResult(d.ray),e(f),d.results.all.push(f))};Object.defineProperty(a.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});return a}();
var A=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],E={fbo:null,camera:new l.default,lightDirection:k.vec3f64.fromValues(0,0,1)},B=k.vec3f64.create(),G=k.vec3f64.create();return n})},"esri/views/3d/webgl-engine/lib/DrapedUpdates":function(){define(["require","exports","../../../../core/PooledArray"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});var k=function(){return function(){}}();n=function(){function a(a,g){this.renderer=a;this.handlers=g;this._pendingAddsRemoves=new Map;this._adds=new m;
this._removes=new m;this._updates=new m({allocator:function(a){return a?a:new k},deallocator:function(a){a.renderGeometry=null;return a}})}a.prototype.dispose=function(){this._adds.prune();this._removes.prune();this._updates.prune()};Object.defineProperty(a.prototype,"updating",{get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length},enumerable:!0,configurable:!0});a.prototype.commitChanges=function(){var a=this;if(0!==this._pendingAddsRemoves.size||0!==this._updates.length){this._pendingAddsRemoves.forEach(function(d,
f){switch(d){case 0:a._adds.push(f);break;case 1:a._removes.push(f)}});for(var g=0;g<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[g].renderGeometry)?this._updates.removeUnorderedIndex(g):g++;this.renderer.modify(this._adds.data,this._adds.length,this._removes.data,this._removes.length,this._updates.data,this._updates.length);this._adds.clear();this._removes.clear();this._pendingAddsRemoves.clear();this._updates.clear();this.handlers.emitContentChanged();this.handlers.emitUpdatingChanged()}};
a.prototype.add=function(a){for(var d=0===this._pendingAddsRemoves.size,h=0;h<a.length;h++)this._pendingAddsRemoves.set(a[h],0);d&&0<this._pendingAddsRemoves.size&&this.handlers.emitUpdatingChanged()};a.prototype.remove=function(a){for(var d=0===this._pendingAddsRemoves.size,h=0;h<a.length;h++){var f=a[h],c=this._pendingAddsRemoves.get(f);0===c?this._pendingAddsRemoves.set(f,2):2!==c&&this._pendingAddsRemoves.set(f,1)}d&&0<this._pendingAddsRemoves.size&&this.handlers.emitUpdatingChanged()};a.prototype.modify=
function(a,g){for(var d=0===this._updates.length,f=0;f<a.length;f++){var c=a[f],b=this._updates.pushNew();b.renderGeometry=c;b.updateType=g}d&&0<this._updates.length&&this.handlers.emitUpdatingChanged()};return a}();a.DrapedUpdates=n})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){var w=0;n=function(){function a(){this.ROOT_ORIGIN_ID="rg_root_"+w++;this._origins=new Map;this._gridSize=42E5}a.prototype.getOrigin=function(b){var c=this._origins.get(this.ROOT_ORIGIN_ID);if(null==c){if(m.isSome(a.testOrigin)){var d=a.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,e.fromValues(d[0],d[1],d[2],this.ROOT_ORIGIN_ID));return this.getOrigin(b)}d=e.fromValues(b[0]+Math.random()-.5,b[1]+Math.random()-.5,b[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);
this._origins.set(this.ROOT_ORIGIN_ID,d);return d}h.vec3.subtract(v,b,c.vec3);v[0]=Math.abs(v[0]);v[1]=Math.abs(v[1]);v[2]=Math.abs(v[2]);d=this._gridSize;if(v[0]<d&&v[1]<d&&v[2]<d)return c;var c=Math.round(b[0]/d),f=Math.round(b[1]/d);b=Math.round(b[2]/d);var g="rg_"+c+"/"+f+"/"+b,l=this._origins.get(g);l||(l=e.fromValues(c*d,f*d,b*d,g),this._origins.set(g,l));return l};a.prototype._drawOriginBox=function(a){var d=window.view,e=d._stage;if(null==this._object){this._material=new r({width:2,color:[0,
1,0,1]},"GridLocalOriginMaterial");e.add(3,this._material);var h=new b("GridLocalOrigin",{isPickable:!1});e.add(0,h);this._object=new p({idHint:"GridLocalOrigin",castShadow:!1});e.add(1,this._object);h.addObject(this._object);e.addToViewContent([h.id])}for(var k=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],m=k.length,n=new Float32Array(3*m),h=new Uint32Array(2*(m-1)),w=.5*this._gridSize,t=0;t<m;t++)n[3*t+0]=a[0]+(k[t]&1?w:-w),n[3*t+1]=a[1]+(k[t]&2?w:-w),n[3*t+2]=a[2]+(k[t]&4?w:-w),0<t&&(h[2*t+0]=t-1,h[2*
t+1]=t);l.bufferToBuffer(n,g.WebMercator,0,n,d.spatialReference,0,m);d={};d[q.VertexAttrConstants.POSITION]={size:3,data:n};n={};n[q.VertexAttrConstants.POSITION]=h;h=new c.GeometryData(d,n,void 0,"line");h=new f(h,"GridLocalOriginBox");e.add(2,h);this._object.addGeometry(h,this._material,u);console.log(this._origins.size,a)};return a}();var u=k.mat4f64.create(),v=d.vec3f64.create();(n||(n={})).testOrigin=null;return n})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/Handles ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../support/debugFlags ./BoundingInfo ./depthRange ./depthRangeUtils ./FxaaRenderPass ./HighlightHelper ./OffscreenRenderingHelper ./RenderContext ./RenderPluginManager ./renderStats ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../materials/internal/waterMaterialUtils ../../../webgl/Profiling ../../../webgl/Texture".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K){function H(a,b){for(var c=new Map,d=null,e=null,f=function(a){if(a===d)return e;var b=c.get(a);b||(b={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},c.set(a,b));d=a;return e=b},g=0;g<a.numToAdd;g++){var h=a.toAdd[g];if(1<=N(h.data)){var l=f(h.material);l.toAdd.push(h)}}for(g=0;g<a.numToRemove;g++)h=a.toRemove[g],1<=N(h.data)&&(l=f(h.material),l.toRemove.push(h));for(g=h=0;g<a.numToUpdate;g++){var k=a.toUpdate[g];
1<=N(k.renderGeometry.data)&&(l=f(k.renderGeometry.material),l.toUpdate.push(k),h|=k.updateType)}b&&(b.updateTypes=h);return c}function N(a){return!1===a.preinterleaved?z.getFirstObjectValue(a.indices).length:a.indexCount}function I(a,b){return a.isVisible()&&a.isVisibleInPass(b.pass)&&0!==(a.renderOccluded&b.renderOccludedMask)}n=function(){function a(a,b,c,f,g,h,k){var n=this;this.requestRender=h;this._materialRenderers=new Map;this._orderedMaterialRenderers=[];this._hasHighlights=!1;this._lighting=
new E.SceneLighting;this._content=new Map;this._isRendering=!1;this._fallbackDepthStencilTexture=null;this._stats={scene:new u.RenderStatsAggregator,draped:new u.RenderStatsAggregator};this._edgeView=null;this._handles=new m;this.renderOptions={antialiasing:"smaa"};this.renderHiddenTransparentEdges=function(){};this._programRep=a;this._materialRep=b;this._rctx=f;this._mode=g;this._stage=k;this._fxaaPass=new e(f);this._smaaPass=new t(f);this._bindParameters={view:null,proj:null,viewInvTransp:null,
fovY:0,nearFar:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null};this._offscreenRendering=new q(a,this._rctx);this._sliceHelper=new y;"scene"===this._mode&&(this._shadowMap=new v(this._rctx),this._ssaoHelper=new x(a,this._rctx,function(){return n.requestRender()}),this._highlightHelper=new p(a,this._rctx));this._renderPlugins=new w.RenderPluginManager({rctx:f,programRep:a,textureRep:c,materialRep:b,requestRender:this.requestRender});this._renderContext=
new r(f,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._handles.add(d.init(l,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",function(a){n.renderHiddenTransparentEdges=a?function(){return n.renderEdges(1)}:function(){};n.requestRender()}))}a.prototype.dispose=function(){this._handles.destroy();this._materialRenderers.forEach(function(a){a.dispose()});this._orderedMaterialRenderers=this._materialRenderers=null;this._edgeView&&(this._edgeView.destroy(),this._edgeView=
null);this._offscreenRendering.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);f.tmpIndices.prune();this._content.clear();this._content=null};Object.defineProperty(a.prototype,"updating",{get:function(){return"smaa"===
this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources||G.waterTextureRepo.loading()},enumerable:!0,configurable:!0});a.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&(this._edgeView=new A.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){return a.requestRender()}}),this._edgeView.initialize());return this._edgeView};Object.defineProperty(a.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0});a.prototype.setLighting=
function(a){this._lighting.set(a)};a.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._ssaoHelper.attenuation=a.ssaoAttenuation);
void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._ssaoHelper.samples=a.ssaoSamples);a.background&&(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);
void 0!==a.slicePlane&&(this._sliceHelper.plane=a.slicePlane);this.requestRender()};Object.defineProperty(a.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0});a.prototype.getRenderParams=function(){var a={};this._shadowMap&&(a.shadowMap=this._shadowMap.enabled,a.shadowMapResolution=this._shadowMap.textureResolution,a.shadowMapMaxCascades=this._shadowMap.maxCascades);this._ssaoHelper&&this._ssaoHelper.isSupported&&(a.ssao=this._ssaoHelper.enabled,
a.ssaoAttenuation=this._ssaoHelper.attenuation,a.ssaoRadius=this._ssaoHelper.radius,a.ssaoFilterRadius=this._ssaoHelper.filterRadius,a.ssaoSamples=this._ssaoHelper.samples);return a};Object.defineProperty(a.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"canRender",{get:function(){return!0},enumerable:!0,configurable:!0});a.prototype.getCombinedStats=function(){return{draped:this._stats.draped.getAggregatedStats(),
scene:this._stats.scene.getAggregatedStats()}};a.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture}return null};
Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasWater",{get:function(){return this._orderedMaterialRenderers.some(function(a){return a.hasWater()})},enumerable:!0,configurable:!0});a.prototype.isEmpty=function(){return 0===this._materialRenderers.size};a.prototype.modify=function(a,b,c,d,e,f,g){var h=this;void 0===b&&(b=a?a.length:0);void 0===d&&(d=c?c.length:0);void 0===f&&(f=e?e.length:
0);this._isRendering&&console.warn("Renderer.modify called while rendering");for(var l=0;l<d;++l)this._content.delete(c[l].uniqueName);for(l=0;l<b;++l)this._content.set(a[l].uniqueName,a[l]);if(b||d||f){var k=!1;H({toAdd:a,numToAdd:b,toRemove:c,numToRemove:d,toUpdate:e,numToUpdate:f}).forEach(function(a,b){var c=h._materialRenderers.get(b);!c&&0<a.toAdd.length&&(c=b.createRenderer(h._rctx,h._materialRep),h._materialRenderers.set(b,c),h._orderedMaterialRenderers.push(c),h.sortOrderedMaterialRenderers());
c&&(c.modify(a),c.isEmpty&&(k=!0))});k&&this._materialRenderers.forEach(function(a,b){a.isEmpty&&(h._materialRenderers.delete(b),h._orderedMaterialRenderers.splice(h._orderedMaterialRenderers.indexOf(a),1),a.dispose())});var m=!1;this._materialRenderers.forEach(function(a){m=m||a.hasHighlights});if(m!==this._hasHighlights){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(m);this._hasHighlights=m}this.requestRender()}g&&(g.forEach(function(a){h._materialRep.updateMaterialParameters(a)}),
this.requestRender())};a.prototype.modifyRenderOrder=function(a){"draped"===this._mode&&(this.sortOrderedMaterialRenderers(),this.requestRender())};a.prototype.updateLogic=function(a){var b=!1;this._orderedMaterialRenderers.forEach(function(c){c.updateLogic&&(b=c.updateLogic(a)||b)});return b};a.prototype.render=function(a){switch(this._mode){case "scene":this.renderScene(a);break;case "draped":this.renderDraped(a)}if(this.onPostRender)this.onPostRender()};a.prototype.renderPass=function(a,b){this.renderGeometryPass(a,
b)};a.prototype.renderScene=function(a){var b=this;this._isRendering=!0;var c=this._rctx,d=this._offscreenRendering,e=a.camera,f=a.fbo,g=this._sliceHelper.plane;a.disableSlice&&(this._sliceHelper.plane=null);this._renderPlugins.prepareRender(e);this.renderShadowMap(a);d.enabled=!0;d.initializeFrame(e,f);this.renderLinearDepth(a);this.renderNormal(a);this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(e,d.linearDepthTexture,d.normalTexture);this._ssaoHelper.bindAll(this._programRep);this._stats.scene.reset();
this.updateGlobalUniforms(e.projectionMatrix);this._renderContext.pass=0;this._renderContext.camera=e;this._renderContext.options=this.renderOptions;d.bindTarget(d.mainColor,d.mainDepth);this._renderPlugins.render(0,this._renderContext);this.renderOpaqueGeometry(this._renderContext);this.renderEdges(2);this.renderHiddenTransparentEdges();this.renderTransparentGeometry(this._renderContext);this.renderEdges(1);var h=e=!1,e=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(18,this._renderContext);
(h=this.renderTransparentTerrain(this._renderContext))&&e&&(d.compositeTransparentTerrainOntoHUDVisibility(),d.renderToTargets(function(){return b.renderHUD("occluded")},d.mainColor,d.tmpDepth,void 0,!0));h&&d.compositeTransparentTerrainOntoMain();d.renderToTargets(function(){b.renderInternalSlot(10,b._renderContext);b._renderPlugins.render(14,b._renderContext);b._renderPlugins.render(15,b._renderContext)},d.mainColor,d.mainDepth);this.renderOccluded();this.renderAntiAliasing(f);c.bindFramebuffer(f);
c.clearSafe(256);this.renderHUD("notOccluded");this.renderHighlights(a,f);this._sliceHelper.plane=g;this._isRendering=!1};a.prototype.renderEdges=function(a){var b=this,c=this._edgeView;c&&c.shouldRender()&&this._offscreenRendering.renderAndComposite(function(){return c.render(b._bindParameters,a)},"alpha")};a.prototype.renderDraped=function(a){this._stats.draped.reset();this.renderGeometryPass(0,a)};a.prototype.renderShadowMap=function(a){var b=this._shadowMap,c=a.camera,d=a.fbo,e=a.lightDirection;
if(b.enabled){l.ENABLE_PROFILE_DEPTH_RANGE&&h.begin("depthRange");var f=this.computeDepthRange(c);l.ENABLE_PROFILE_DEPTH_RANGE&&h.end("depthRange");b.prepare(c,e,f);e=b.getCascades();for(f=0;f<e.length;++f){var g=e[f];g.camera.setGLViewport(this._rctx);a.camera=g.camera;this.renderGeometryPass(3,a)}a.camera=c;b.finish(d);c.setGLViewport(this._rctx)}b.bindAll(this._programRep)};a.prototype.renderLinearDepth=function(a){var b=this;this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth()?this._offscreenRendering.renderToTargets(function(){b.renderGeometryPass(1,
a)},this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};a.prototype.renderNormal=function(a){var b=this;this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets(function(){b.renderGeometryPass(2,a)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};a.prototype.computeDepthRange=
function(a){var d=b.depthRangeFromScene(a,this._content,this._stage.getLayers());c.union(d,this.renderPlugins.queryDepthRange(a));d.near=Math.max(a.near,d.near);d.far=Math.min(a.far,d.far);return d};a.prototype.renderGeometryPass=function(a,b){this._isRendering=!0;b=b.camera;this.updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;"draped"===this._mode?this.renderGeometryPassDraped(this._renderContext):this.renderGeometryPassScene(this._renderContext);
this._isRendering=!1};a.prototype.renderGeometryPassDraped=function(a){var b=this,c=a.camera;this._bindParameters.view=c.viewMatrix;this._bindParameters.proj=c.projectionMatrix;this._bindParameters.viewInvTransp=c.viewInverseTransposeMatrix;J[0]=c.near;J[1]=c.far;this._bindParameters.nearFar=J;this._bindParameters.viewport=c.fullViewport;this._bindParameters.pixelRatio=c.pixelRatio;this._bindParameters.slicePlane=a.sliceHelper&&a.sliceHelper.plane;this._bindParameters.highlightDepthTexture=this.getFallbackDepthTexture();
this._orderedMaterialRenderers.forEach(function(c){var d=b._stats.draped.getMaterialRenderStatsObject(c.type);c.render(null,a,b._bindParameters,d)})};a.prototype.renderGeometryPassScene=function(a){this.renderGeometry(a);this.renderTransparentTerrain(a)};a.prototype.renderGeometry=function(a){this.renderOpaqueGeometry(a);this.renderTransparentGeometry(a)};a.prototype.renderOpaqueGeometry=function(a){this._renderPlugins.render(1,a);this.renderInternalSlot(2,a);this.renderInternalSlot(3,a);this._renderPlugins.render(4,
a);this.renderInternalSlot(5,a);this._renderPlugins.render(6,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderPlugins.render(13,this._renderContext)};a.prototype.renderTransparentGeometry=function(a){this.renderInternalSlot(7,a);this._renderPlugins.render(8,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};a.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(9,a)};a.prototype.renderHUDVisibility=function(a){var b=this,c=B.shouldRenderVisibilityDuringRenderPass(a.pass),
d=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=b.renderInternalSlot(11,a)});return e};a.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(19,this._renderContext);this.renderInternalSlot(16,this._renderContext);this.renderInternalSlot(17,this._renderContext)};a.prototype.renderHighlights=function(a,b){var c=this,d=this._highlightHelper;if(d&&d.enabled&&
(this.hasHighlights||this._renderPlugins.needsHighlight())){var e=null;d.profilingCallback&&(e=F.startMeasurement(this._renderContext.rctx));var f=this._offscreenRendering;this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;f=f.renderToTargets(function(){c.renderGeometryPass(4,a);c._rctx.clearSafe(256);c.renderHUD("both")},f.highlight,f.tmpDepth,[0,0,0,0],!0);d.render(a.camera,f,b);null!==e&&d.profilingCallback&&e.stop(function(a){d.profilingCallback&&d.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};
a.prototype.renderOccluded=function(){var a=this;this._materialRenderers.forEach(function(a,b){b&&b.isVisible()&&1!==b.renderOccluded&&M.push(b)});if(0!==M.length){var b=this._offscreenRendering,c=this._renderContext,d=function(d,e){c.renderOccludedMask=e;b.renderToTargets(function(){a.renderInternalSlot(5,c,M);a.renderInternalSlot(7,c,M);a.renderInternalSlot(10,c,M)},b.tmpColor,b.tmpDepth,[0,0,0,0],!0);c.resetRenderOccludedMask();b.compositeOccludedOntoMain(d)};c.pass=0;d(.4,4);d(.5,2);d(1,8);M.length=
0}};a.prototype.renderAntiAliasing=function(a){var b=this;switch(this.renderOptions.antialiasing){case "smaa":this._smaaPass.loadResources(function(){return b.requestRender()});this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):this._offscreenRendering.composite();break;case "fxaa":this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):this._offscreenRendering.composite();
break;default:this._offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()}};a.prototype.renderInternalSlot=function(a,b,c){this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;J[0]=b.camera.near;J[1]=b.camera.far;var d=this._renderContext.offscreenRenderingHelper;
this._bindParameters.nearFar=J;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.camera.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=d?d.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=
d&&d.depthTexture||this.getFallbackDepthTexture();return this.renderInternalSlotMaterials(a,b,c)};a.prototype.renderInternalSlotMaterials=function(a,b,c){var d=this,e=0===b.pass?this._stats.scene:null,f=!1;k.isSome(c)?c.forEach(function(c){I(c,b)&&(f=d._materialRenderers.get(c).render(a,b,d._bindParameters)||f)}):this._materialRenderers.forEach(function(c,g){I(g,b)&&(g=e?e.getMaterialRenderStatsObject(c.type):null,f=c.render(a,b,d._bindParameters,g)||f)});return f};a.prototype.updateGlobalUniforms=
function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};a.prototype.sortOrderedMaterialRenderers=function(){"draped"===this._mode&&this._orderedMaterialRenderers.sort(function(a,
b){return b.renderPriority()-a.renderPriority()})};a.prototype.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new K(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};a.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?
this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};a.prototype.forEachRenderGeometry=function(a){this._content.forEach(function(b,c){a(b)})};Object.defineProperty(a.prototype,"test",{get:function(){return{orderedMaterialRenderers:this._orderedMaterialRenderers}},enumerable:!0,configurable:!0});return a}();var J=g.vec2f64.create(),M=[];return n})},"esri/core/TimeProfiler":function(){define(["require",
"exports"],function(n,a){n=function(){function a(a,h){void 0===h&&(h=.9);this._alpha=.9;this._name=a;this._alpha=h;this.reset()}a.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(a.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"average",{get:function(){return 0<
this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});a.prototype.begin=function(){this._startTime=performance.now()};a.prototype.end=function(){var a=performance.now()-
this._startTime;this._count+=1;this._sum+=a;this._smooth=this._alpha*a+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,a);this._max=Math.max(this._max,a)};a.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return a}();(function(a){function k(g){g in d||(d[g]=new a(g));return d[g]}function h(a){console.log(k(a).toJSON())}var d={},g={};a.get=k;a.begin=function(a){k(a).begin()};a.end=function(a,d){void 0===
d&&(d=!0);k(a).end();var c=performance.now();!d||a in g&&!(c>=g[a]+1E3)||(h(a),g[a]=c)};a.log=h;a.logAll=function(){for(var a in d)h(a)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(n,a){function m(a,d){return{near:a,far:d}}function k(a,d,g){a.near=d;a.far=g;return a}Object.defineProperty(a,"__esModule",{value:!0});a.create=m;a.empty=function(a){return a?k(a,Infinity,-Infinity):m(Infinity,-Infinity)};a.set=k;a.union=function(a,
d,g){void 0===g&&(g=a);g.near=Math.min(a.near,d.near);g.far=Math.max(a.far,d.far);return g}})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./ComponentUtils ./depthRange ./Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(a,b){if(b.isVisible){var c=p.empty(),d=b.getObjects();b.getSpatialQueryAccelerator()?w(c,a,b.getSpatialQueryAccelerator()):u(c,a,d);return c}}function w(a,b,c){var d=b.eye,e=b.viewForward,f=b.frustum,g=function(a){return!a.areAllComponentsHidden()},h=c.objectCount;500>h?(p.set(B,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(d,e,"front-to-back",B,function(c,d){v(a,b,c);B.far=a.near;d.setRange(B)},f,g),p.set(B,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(d,
e,"back-to-front",B,function(c,d){v(a,b,c);B.near=a.far;d.setRange(B)},f,g)):(h=Math.max(Math.min(h,500),Math.ceil(.1*h)),d=c.findClosest(e,"front-to-back",f,g,h),c=c.findClosest(e,"back-to-front",f,g,h),d&&c&&(t(a,b,d.getCenter(),d.getBSRadius()),t(a,b,c.getCenter(),c.getBSRadius())))}function u(a,b,c){G.clear();c.forEach(function(a){a.areAllComponentsHidden()||G.add(a)});G.empty||(G.sort(b),p.set(B,b.near,Math.min(a.near,b.far)),G.forEachInDepthRange(B,"front-to-back",function(c,d,e){d<a.near&&
v(a,b,c)}),p.set(B,Math.max(a.far,b.near),b.far),G.forEachInDepthRange(B,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function v(a,d,e){if(!e.areAllComponentsHidden()&&c.frustum.intersectsSphere(d.frustum.planes,c.sphere.wrap(e.getBSRadius(),e.getCenter()))){var f=e.objectTransformation,g=E;e.geometryRecords.forEach(function(c){k.mat4.multiply(g,f,c.getShaderTransformation());var e=b.maxScale(g);y(a,d,c.geometry.boundingInfo,g,e)})}}function y(a,b,e,f,g){var h=b.eye,l=b.viewForward;
d.vec3.transformMat4(A,e.center,f);h=l[0]*(A[0]-h[0])+l[1]*(A[1]-h[1])+l[2]*(A[2]-h[2]);l=e.bsRadius*g;if(!(h-l>a.near&&h+l<a.far)&&c.frustum.intersectsSphere(b.frustum.planes,c.sphere.wrap(l,A)))if(100<e.bsRadius&&e.getChildren())for(e=e.getChildren(),h=0;8>h;++h)e[h]&&y(a,b,e[h],f,g);else K.unionDepthRangeWithAABB(a,b.viewProjectionMatrix,f,e.bbMin,e.bbMax)}function t(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,
c+d)}Object.defineProperty(a,"__esModule",{value:!0});a.depthRangeFromScene=function(a,b,c){if(1E4>b.size)return F.compute(a,b);var d=p.empty();c.forEach(function(b){b.isVisible&&p.union(d,r(a,b))});return d};a.depthRangeFromLayer=r;n=function(){function a(){this._items=new m({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,
b){return a.distance-b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var x=function(){function a(){this.view=h.mat4f64.create();this.viewProj=h.mat4f64.create();this.frustum=c.frustum.create();this.geometries=[];this.near=[];this.far=
[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}a.prototype.compute=function(a,b){var d=this;this.reset();k.mat4.copy(this.view,a.viewMatrix);k.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);c.frustum.copy(a.frustum,this.frustum);a=this.view;var f=a[2],g=a[6],h=a[10],l=a[14];a=this.range;var m=0;b.forEach(function(a){if(!e.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var b,c;a.hasShaderTransformation?
(b=a.getBoundingSphere(a.getShaderTransformation(),1,A),c=A):(b=a.bsRadius,c=a.center);c=f*c[0]+g*c[1]+h*c[2]+l;d.geometries[m]=a;d.near[m]=-(c+b);d.far[m]=-(c-b);++m}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var n=this.looseRange;n.near=Math.max(.5*a.near,2);n.far=2*a.far;var p=0,q=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=n.near?
a.near=this.near[b]:this.nearCandidates[p++]=b),this.far[b]>a.far&&(this.far[b]<=n.far?a.far=this.far[b]:this.farCandidates[q++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return d.near[a]<d.near[b]?-1:d.near[a]>d.near[b]?1:0});this.farCandidates.sort(function(a,b){return d.far[a]<d.far[b]?1:d.far[a]>d.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)n=this.nearCandidates[b],this.near[n]<a.near&&(n=this.geometries[n],p=
n.boundingInfo,this.includeNearBoundingInfoRec(p,n.getShaderTransformation()));for(b=0;b<this.farCandidates.length;++b)n=this.farCandidates[b],this.far[n]>a.far&&(n=this.geometries[n],p=n.boundingInfo,this.includeFarBoundingInfoRec(p,n.getShaderTransformation()));return a};a.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};a.prototype.includeNearBoundingInfoRec=
function(a,c){var e=a.getBSRadius(),f=a.getCenter();d.vec3.transformMat4(A,f,c);var g=b.maxScale(c),f=A[0],h=A[1],l=A[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*l+g[0][3]>e||g[1][0]*f+g[1][1]*h+g[1][2]*l+g[1][3]>e||g[2][0]*f+g[2][1]*h+g[2][2]*l+g[2][3]>e||g[3][0]*f+g[3][1]*h+g[3][2]*l+g[3][3]>e||(f=this.view[2]*f+this.view[6]*h+this.view[10]*l+this.view[14],h=f+e,2>-(f-e)||-h>=this.range.near)))if(-h>this.looseRange.near)this.range.near=-h;else{if(100<e&&(e=a.getChildren(),void 0!==
e)){for(a=0;8>a;++a)void 0!==e[a]&&this.includeNearBoundingInfoRec(e[a],c);return}K.unionDepthRangeWithAABB(this.range,this.viewProj,c,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,c){var e=a.getBSRadius(),f=a.getCenter();d.vec3.transformMat4(A,f,c);var g=b.maxScale(c),f=A[0],h=A[1],l=A[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*l+g[0][3]>e||g[1][0]*f+g[1][1]*h+g[1][2]*l+g[1][3]>e||g[2][0]*f+g[2][1]*h+g[2][2]*l+g[2][3]>e||g[3][0]*f+g[3][1]*h+g[3][2]*
l+g[3][3]>e||(f=this.view[2]*f+this.view[6]*h+this.view[10]*l+this.view[14]-e,-f<=this.range.far)))if(-f<this.looseRange.far)this.range.far=-f;else{if(100<e&&(e=a.getChildren(),void 0!==e)){for(a=0;8>a;++a)void 0!==e[a]&&this.includeFarBoundingInfoRec(e[a],c);return}K.unionDepthRangeWithAABB(this.range,this.viewProj,c,a.getBBMin(),a.getBBMax())}};return a}();a.DepthRangeFromRenderGeometries=x;a=function(){function a(){this.modelViewProj=h.mat4f64.create();this.clipPosition=[f.vec4f64.create(),f.vec4f64.create(),
f.vec4f64.create(),f.vec4f64.create(),f.vec4f64.create(),f.vec4f64.create(),f.vec4f64.create(),f.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,e){var f=this.modelViewProj;k.mat4.multiply(f,b,c);b=!1;for(c=0;8>c;++c){var g=this.clipPosition[c],h=0===c||3===c||4===c||7===c?d[0]:e[0],l=0===c||1===c||4===c||5===c?d[1]:e[1],m=4>c?d[2]:e[2];g[0]=f[0]*h+f[4]*l+f[8]*m+f[12];g[1]=f[1]*h+f[5]*l+f[9]*m+f[13];g[2]=f[2]*h+f[6]*l+f[10]*m+f[14];g[3]=f[3]*h+f[7]*l+f[11]*m+f[15]}for(c=0;12>
c;++c){d=this.clipTriangle(this.clipPosition[z[c][0]],this.clipPosition[z[c][1]],this.clipPosition[z[c][2]]);e=!0;for(f=0;f<d.length;++f)if(g=d[f][3],2<=g){e=!1;break}if(!e)for(b=!0,f=0;f<d.length;++f)g=d[f][3],g<a.near&&(a.near=g),g>a.far&&(a.far=g)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];q.assert(!1)};a.prototype.intersect=function(a,b,c){var d=0;0===c?d=(-a[3]-a[0])/(b[0]-a[0]+b[3]-
a[3]):1===c?d=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?d=(a[3]-a[0])/(b[0]-a[0]-b[3]+a[3]):3===c&&(d=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return l.vec4.lerp(f.vec4f64.create(),a,b,d)};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this.inside(f,b)?(this.inside(e,b)||a.push(this.intersect(e,f,b)),a.push(f)):this.inside(e,b)&&a.push(this.intersect(e,f,b))}}return a};return a}();var z=[[0,1,3],[2,3,1],[1,5,2],[6,2,
5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],A=g.vec3f64.create(),E=h.mat4f64.create(),B=p.empty(),G=new n,F=new x,K=new a})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(n,a,m,k,h,d){return function(){function a(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",
count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}a.prototype.enable=function(){if(this.isEnabled)return!0;var a=this.rctx;this.program=new k(a,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=h.makePipelineState({colorWrite:h.defaultColorWriteParams});var f=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new d(a,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new m(a,34962,35044,f)});return this.isEnabled=!0};a.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};a.prototype.render=function(a,d){this.enable();var c=this.rctx;c.bindVAO(this.vao);
c.bindFramebuffer(d);var b=0,e=0;null!=d?(b=d.descriptor.width,e=d.descriptor.height):(b=c.gl.canvas.width,e=c.gl.canvas.height);c.bindProgram(this.program);c.setPipelineState(this.pipelineState);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/b,1/e);c.drawArrays(4,0,3)};return a}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){return function(){function a(a,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=h.vec4f64.create();this.defaultOptions={color:k.vec4f32.fromValues(1,0,1,1),haloColor:k.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};this.blurProgram=
a.getProgram(b.blurPass,{gaussianSamples:5});this.blurGridProgram=a.getProgram(b.blurPass,{gaussianSamples:5,gridOptimization:!0});this.applyProgram=a.getProgram(b.applyPass);this.applyGridProgram=a.getProgram(b.applyPass,{gridOptimization:!0});this.applyGridDebugProgram=a.getProgram(b.applyPass,{gridOptimization:!0,gridDebug:!0});this.downsampleProgram=a.getProgram(b.downsamplePass);this.preprocessPipelineState=q.makePipelineState({colorWrite:q.defaultColorWriteParams});this.applyPipelineState=q.makePipelineState({blending:q.separateBlendingParams(770,
1,771,771),colorWrite:q.defaultColorWriteParams})}Object.defineProperty(a.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"profilingCallback",{get:function(){return d.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});a.prototype.setDefaultOptions=function(a){this.defaultOptions=a};a.prototype.render=function(a,b,e){var f=
a.pixelRatio,g=!d.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=d.HIGHLIGHTS_VISUALIZE_BLOCKS,l=this._rctx;c.assert(this.enabled);m.vec4.copy(this.viewportToRestore,a.fullViewport);var k=Math.ceil(a.fullWidth/f);a=Math.ceil(a.fullHeight/f);this.blur0Fbo.resize(k,a);this.blur1Fbo.resize(k,a);l.bindVAO(this.quadVAO);l.setPipelineState(this.preprocessPipelineState);var n=null,p=f=n=null;if(g){var q=this._grid;this._gridUpdateResources(b,32);this._gridComputeMipmap();f=q.vao;p=4;n=this.blurGridProgram;l.bindProgram(n);
l.bindTexture(q.coverageMipmap[q.mipmapLevels].colorTexture,1);n.setUniform1i("coverageTex",1)}else f=this.quadVAO,p=5,n=this.blurProgram,l.bindProgram(n);l.bindVAO(f);l.bindFramebuffer(this.blur0Fbo);l.setViewport(0,0,k,a);l.setClearColor(0,0,0,0);l.clear(16384);n.setUniform1i("tex",0);l.bindTexture(b.colorTexture,0);n.setUniform2f("blurSize",1/k,0);l.drawArrays(p,0,r.vertexCount(f,"geometry"));l.bindFramebuffer(this.blur1Fbo);l.clear(16384);l.bindTexture(this.blur0Fbo.colorTexture,0);n.setUniform2f("blurSize",
0,1/a);l.drawArrays(p,0,r.vertexCount(f,"geometry"));l.bindFramebuffer(e);l.setPipelineState(this.applyPipelineState);l.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);g?(n=h?this.applyGridDebugProgram:this.applyGridProgram,l.bindProgram(n),n.setUniform1i("coverageTex",2),l.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(n=this.applyProgram,l.bindProgram(n));n.setUniform1i("tex",0);l.bindTexture(this.blur1Fbo.colorTexture,
0);n.setUniform1i("origin",1);l.bindTexture(b.colorTexture,1);n.setUniform4fv("color",this.defaultOptions.color);n.setUniform4fv("haloColor",this.defaultOptions.haloColor);n.setUniform1f("outlineSize",8.6);n.setUniform1f("blurSize",.4);n.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);l.drawArrays(p,0,r.vertexCount(f,"geometry"));l.bindVAO(null)};a.prototype.enable=function(){if(!this.enabled){this.quadVAO=
f.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=p.createWithAttachments(this._rctx,b,a);this.blur1Fbo=p.createWithAttachments(this._rctx,b,a)}};a.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};a.prototype._gridUpdateResources=function(a,
b){var c=this._rctx,d=this._grid,f=!1;null===d.coverageMipmap&&(d.coverageMipmap=[a],f=!0);if(d.viewportWidth!==a.width||d.viewportHeight!==a.height)f=!0,d.viewportWidth=a.width,d.viewportHeight=a.height;d.coverageMipmap[0]=a;d.cellPixelSize!==b&&(d.cellPixelSize=b,f=!0);if(f){for(b=1;b<d.coverageMipmap.length;b++)d.coverageMipmap[b].dispose();d.mipmapLevels=Math.ceil(Math.log(d.cellPixelSize)*Math.LOG2E);d.coverageMipmap.length=d.mipmapLevels+1;for(b=0;b<d.mipmapLevels;b++)f=d.coverageMipmap[b],
f=p.createWithAttachments(c,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(f.width/2),height:Math.ceil(f.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(f.width/2),height:Math.ceil(f.height/2)}),d.coverageMipmap[b+1]=f}var f=Math.ceil(a.height/d.cellPixelSize),h=Math.ceil(a.width/d.cellPixelSize);if(!d.vao||d.verticalCellCount!==f||d.horizontalCellCount!==h){d.verticalCellCount=f;d.horizontalCellCount=h;a=f+1;b=h+1;for(var f=1/f,h=1/h,
k=new Float32Array(24*a*b),m=0,n=0;n<a;n++)for(var q=0;q<b;q++)k[m+0]=(q-.5)*h*2-1,k[m+1]=(n-.5)*f*2-1,k[m+2]=q*h,k[m+3]=n*f,k[m+4]=(q+.5)*h*2-1,k[m+5]=(n-.5)*f*2-1,k[m+6]=q*h,k[m+7]=n*f,k[m+8]=(q-.5)*h*2-1,k[m+9]=(n+.5)*f*2-1,k[m+10]=q*h,k[m+11]=n*f,k[m+12]=(q-.5)*h*2-1,k[m+13]=(n+.5)*f*2-1,k[m+14]=q*h,k[m+15]=n*f,k[m+16]=(q+.5)*h*2-1,k[m+17]=(n-.5)*f*2-1,k[m+18]=q*h,k[m+19]=n*f,k[m+20]=(q+.5)*h*2-1,k[m+21]=(n+.5)*f*2-1,k[m+22]=q*h,k[m+23]=n*f,m+=24;d.vao&&d.vao.dispose(!0);d.vao=new w(c,g.Default3D,
{geometry:l.Pos2Tex},{geometry:e.createVertex(c,35044,k)})}};a.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.downsampleProgram;a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,f);a.drawArrays(5,0,r.vertexCount(this.quadVAO,
"geometry"))}};a.prototype.getGpuMemoryUsage=function(){var a=r.getGpuMemoryUsage(this.blur0Fbo)+r.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var b=0,c=this._grid.coverageMipmap;b<c.length;b++)a+=r.getGpuMemoryUsage(c[b]);return a};return a}()})},"esri/views/3d/webgl-engine/shaders/HighlightPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k,h){Object.defineProperty(a,
"__esModule",{value:!0});var d=function(a){return h.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GAUSSIAN_SAMPLES:a.gaussianSamples})},g=function(a){return h.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GRID_DEBUG:a.gridDebug})};a.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:k.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:k.resolveIncludes("renderer/highlight/downsample.frag")},attributes:m.Default3D};a.blurPass={name:"highlight-blur",
shaders:function(a){return{vertexShader:d(a)+k.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:d(a)+k.resolveIncludes("renderer/highlight/blur.frag")}},attributes:m.Default3D};a.applyPass={name:"highlight-apply",shaders:function(a){return{vertexShader:g(a)+k.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:g(a)+k.resolveIncludes("renderer/highlight/apply.frag")}},attributes:m.Default3D}})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/renderState ../../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g,l){var f=[0,0,0,0],c=[0,1,0,1];return function(){function a(a,b){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._compositePipelineState=new Map;this._rctx=b;b=this.renderTargetHelper=new k.RenderTargetHelper(b);this.mainColor=b.registerColorTarget({name:"mainColor"});this.mainDepth=b.registerDepthTarget({name:"mainDepth"});this.linearDepth=b.registerColorTarget({name:"linearDepth"});this.normal=b.registerColorTarget({name:"normal"});
this.highlight=b.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=b.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=b.registerColorTarget({name:"tmpColor"});this.tmpDepth=b.registerDepthTarget({name:"tmpDepth"});this._compositeProgram=a.getProgram(d.composite);this._compositePipelineState.set("none",g.makePipelineState({colorWrite:g.defaultColorWriteParams}));this._compositePipelineState.set("alpha",g.makePipelineState({blending:g.separateBlendingParams(770,
1,771,771),colorWrite:g.defaultColorWriteParams}));this._compositePipelineState.set("premultiplied-alpha",g.makePipelineState({blending:g.simpleBlendingParams(1,771),colorWrite:g.defaultColorWriteParams}));this._compositeTransparentToHUDVisibilityProgram=a.getProgram(d.compositeTransparentToHUDVisibility);this._compositeTransparentToHUDVisibilityPipelineState=g.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});this._compositeOccludedProgram=a.getProgram(d.compositeOccluded);this._compositeOccludedPipelineState=
g.makePipelineState({blending:g.simpleBlendingParams(1,771),colorWrite:g.defaultColorWriteParams})}Object.defineProperty(a.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"highlightTexture",
{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});a.prototype.initializeFrame=function(a,b){h.assert(this.enabled);var c=this._rctx;
this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.outputFramebuffer=b;this.bindTarget(this.mainColor,this.mainDepth);c.setClearStencil(0);a=this._background.color;c.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);c.clearSafe(17664)};a.prototype.renderAndComposite=function(a,b){this.renderToTargets(a,this.tmpColor,this.mainDepth,f);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,b)};a.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,
this.mainDepth,c)};a.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,b=this._rctx;this.renderToTargets(function(){var c=a._compositeTransparentToHUDVisibilityProgram;b.bindProgram(c);b.setPipelineState(a._compositeTransparentToHUDVisibilityPipelineState);c.setUniform1i("tex",1);b.bindTexture(a.getColorTexture(a.tmpColor),1);b.bindVAO(a.quadVAO);b.drawArrays(5,0,l.vertexCount(a.quadVAO,"geometry"))},this.hudVisibility,this.mainDepth)};a.prototype.compositeTransparentTerrainOntoMain=
function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};a.prototype.compositeOccludedOntoMain=function(a){var b=this._rctx,c=this._compositeOccludedProgram;this.bindFramebuffer();b.bindProgram(c);b.setPipelineState(this._compositeOccludedPipelineState);b.bindVAO(this.quadVAO);b.bindTexture(this.getColorTexture(this.tmpColor),0);c.setUniform1i("occludedColorMap",0);c.setUniform1f("opacity",a);b.drawArrays(5,0,l.vertexCount(this.quadVAO,"geometry"));b.bindVAO(null)};
a.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};a.prototype.renderDepthDetached=function(a){var b=this.bindTarget(this.mainColor);a(b);this.bindTarget(this.mainColor,this.mainDepth)};a.prototype.composite=function(a,b,c){void 0===a&&(a=this.framebuffer.colorTexture);void 0===b&&(b=this.outputFramebuffer);void 0===c&&(c="none");var d=this._rctx,e=this._compositeProgram;d.bindFramebuffer(b);d.bindProgram(e);d.setPipelineState(this._compositePipelineState.get(c));
e.setUniform1i("tex",1);d.bindTexture(a,1);d.bindVAO(this.quadVAO);d.drawArrays(5,0,l.vertexCount(this.quadVAO,"geometry"))};a.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};a.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=m.createQuadVAO(this._rctx))};a.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)};a.prototype.renderToTargets=function(a,
b,c,d,f){var e=this._rctx;b=this.bindTarget(b,c);c=0;d&&(e.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),c|=16384);f&&(c|=256);e.clearSafe(c);a(b);e.gl.flush();this.bindTarget(this.mainColor,this.mainDepth);return b};a.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a);return a};a.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};a.prototype.getGpuMemoryUsage=function(){var a=
0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());return a};return a}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(n,a,m,k,h,d,g){Object.defineProperty(a,"__esModule",{value:!0});var l={dataType:5121},f={};n=function(){function a(a){this.rctx=a;this.activeTargets=
new Set;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=new Map;this.framebuffers=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}a.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};a.prototype.disposeTargetResource=
function(a){a=a.id;this.activeTargets.has(a)&&(this.activeTargets.delete(a),this.depthTextures.has(a)&&(this.depthTextures.get(a).dispose(),this.depthTextures.delete(a)),this.depthBuffers.has(a)&&(this.depthBuffers.get(a).dispose(),this.depthBuffers.delete(a)),this.colorTextures.has(a)&&(this.colorTextures.get(a).dispose(),this.colorTextures.delete(a)))};a.prototype.getDepthTexture=function(a,c){if(this.depthTextureSupported){var b=this.depthTextures.get(a.id);!b||b.descriptor.width===c.width&&b.descriptor.height===
c.height||(b.dispose(),b=void 0);b||(b=new d(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height}),this.depthTextures.set(a.id,b),this.activeTargets.add(a.id));return b}};a.prototype.getDepthBuffer=function(a,c){if(!this.depthTextureSupported){var b=this.depthBuffers.get(a.id);b?b.descriptor.width===c.width&&b.descriptor.height===c.height||b.resize(c.width,c.height):(b=new h(this.rctx,m({internalFormat:34041},c)),this.depthBuffers.set(a.id,
b),this.activeTargets.add(a.id));return b}};a.prototype.getColorTexture=function(a,c){var b=this.colorTextures.get(a.id);!b||b.descriptor.width===c.width&&b.descriptor.height===c.height||(b.dispose(),b=void 0);b||(b=new d(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:9729,wrapMode:33071,width:c.width,height:c.height}),this.colorTextures.set(a.id,b),this.activeTargets.add(a.id));return b};a.prototype.getAllocatedColorTexture=function(a){return this.colorTextures.get(a.id)};
a.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return m({id:b},f,a)};a.prototype.registerColorTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return m({id:b},l,a)};a.prototype.getFramebuffer=function(a,c,d){var b=this.getKey(c,d),e=this.framebuffers.get(b);c=this.getColorTexture(c,a);if(this.depthTextureSupported){var f=d?this.getDepthTexture(d,a):void 0;if(!e)return e=d?k.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:4},f):k.createWithAttachments(this.rctx,
c,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(b,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==c||e.depthStencilTexture!==f)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(a.width,a.height),e.attachColorTexture(c),e.attachDepthStencilTexture(f);return e}f=d?this.getDepthBuffer(d,a):void 0;if(!e)return e=k.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:d?3:0},f),this.framebuffers.set(b,e),e;if(d=e.width!==a.width||e.height!==a.height||
e.colorTexture!==c)e.detachColorTexture(),e.detachDepthStencilBuffer(),e.resize(a.width,a.height),e.attachColorTexture(c),e.attachDepthStencilBuffer(f);return e};a.prototype.getKey=function(a,c){return a.id+"_"+(c?c.id:"X")+"_"+a.name+(c?"_"+c.name:"")};a.prototype.getGpuMemoryUsage=function(){var a=0,c=new Set,d=function(b){c.has(b)||(c.add(b),a+=g.getGpuMemoryUsage(b))};this.depthTextures.forEach(d);this.colorTextures.forEach(d);this.depthBuffers.forEach(d);this.framebuffers.forEach(d);return a};
return a}();a.RenderTargetHelper=n})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.composite={name:"offscreen-composite",shaders:{vertexShader:k.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:k.resolveIncludes("renderer/offscreen/composite.frag")},attributes:m.Default3D};a.compositeTransparentToHUDVisibility=
{name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:k.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:k.resolveIncludes("renderer/offscreen/compositeTransparentToHUDVisibility.frag")},attributes:m.Default3D};a.compositeOccluded={name:"offscreen-composite-occluded",shaders:{vertexShader:k.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:k.resolveIncludes("renderer/offscreen/compositeOccluded.frag")},attributes:m.Default3D}})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require",
"exports"],function(n,a){return function(){function a(a,h,d,g,l,f){this.camera=null;this.slot=this.pass=0;this.options=this.highlightDepthTexture=null;this.renderOccludedMask=5;this.rctx=a;this.offscreenRenderingHelper=h;this.scenelightingData=d;this.shadowMap=g;this.ssaoHelper=l;this.sliceHelper=f}a.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=5};Object.defineProperty(a.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0});return a}()})},
"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports","./depthRange"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.pluginContext=a;this.renderPlugins=[];this.slots=[];for(a=0;21>a;++a)this.slots[a]=[]}a.prototype.add=function(a,g){this.renderPlugins.push(g);for(var d=0;d<a.length;++d)this.slots[a[d]].push(g);g.initializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};a.prototype.remove=
function(a){this.renderPlugins=this.renderPlugins.filter(function(d){return d!==a});for(var d=0;d<this.slots.length;++d)this.slots[d]=this.slots[d].filter(function(d){return d!==a});a.uninitializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};a.prototype.prepareRender=function(a){for(var d=0,h=this.renderPlugins;d<h.length;d++){var f=h[d];f.prepareRender&&f.prepareRender(a)}};a.prototype.render=function(a,g){g.slot=a;var d=!1,f=0;for(a=this.slots[a];f<a.length;f++){var c=a[f];
c.canRender&&c.render(g)&&(d=!0)}return d};a.prototype.queryDepthRange=function(a){var d=k;d.near=Infinity;d.far=-Infinity;for(var h=0,f=this.renderPlugins;h<f.length;h++){var c=f[h];c.queryDepthRange&&(c=c.queryDepthRange(a))&&m.union(d,c,d)}return d};a.prototype.needsHighlight=function(){return this.renderPlugins.some(function(a){return a.needsHighlight})};a.prototype.needsLinearDepth=function(){for(var a=0,g=this.renderPlugins;a<g.length;a++)if(g[a].needsLinearDepth)return!0;return!1};return a}();
a.RenderPluginManager=n;var k={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/renderStats":function(){define(["require","exports"],function(n,a){function m(){return{triangles:0,drawCalls:0}}Object.defineProperty(a,"__esModule",{value:!0});a.makeNewRenderStats=m;n=function(){function a(){this.materialRenderStats=new Map;this.reset()}a.prototype.getMaterialRenderStatsObject=function(a){var d=this.materialRenderStats.get(a);d||(d=m(),this.materialRenderStats.set(a,d));return d};a.prototype.getAggregatedStats=
function(){var a={materialRenderers:{},total:m()};this.materialRenderStats.forEach(function(d,g){a.materialRenderers[g]=d;a.total.drawCalls+=d.drawCalls;a.total.triangles+=d.triangles});return a};a.prototype.reset=function(){this.materialRenderStats.forEach(function(a){a.drawCalls=0;a.triangles=0})};return a}();a.RenderStatsAggregator=n})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ./Camera ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v){function y(a,b){g.vec2.set(ca,a[b],a[b+3]);return ca}var t=function(){return function(){this.camera=new p.default;this.lightMat=d.mat4f64.create()}}();n=function(){function a(a){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.rctx=a;this.emptyTexture=q.createEmptyTexture(a);for(a=0;4>a;++a)this.cascades.push(new t)}a.prototype.dispose=function(){this.emptyTexture.dispose();
this.emptyTexture=null};Object.defineProperty(a.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=m.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},
enumerable:!0,configurable:!0});a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)R[a]=this.cascades[a];R.length=this.numCascades;return R};a.prototype.prepare=function(a,c,d){r.assert(this.enabled);h.mat4.multiply(z,a.projectionMatrix,a.viewMatrix);var e=d.near,l=d.far;2>e&&(e=2);2>l&&(l=2);e>=l&&(e=2,l=4);this.numCascades=Math.min(1+Math.floor(r.logWithBase(l/e,4)),this.maxNumCascades);var k=Math.pow(l/e,1/this.numCascades);
for(d=0;d<this.numCascades+1;++d)this.cascadeDistances[d]=e*Math.pow(k,d);h.mat4.invert(A,z);h.mat4.lookAt(M,[0,0,0],[-c[0],-c[1],-c[2]],[0,1,0]);k=a.viewMatrix;a=a.projectionMatrix;for(d=0;d<this.numCascades;++d){var n=this.cascades[d],l=-this.cascadeDistances[d],e=-this.cascadeDistances[d+1],l=(a[10]*l+a[14])/Math.abs(a[11]*l+a[15]),e=(a[10]*e+a[14])/Math.abs(a[11]*e+a[15]);r.assert(l<e);for(var p=0;8>p;++p){b.vec4.set(E,0===p%4||3===p%4?-1:1,0===p%4||1===p%4?-1:1,4>p?l:e,1);b.vec4.transformMat4(B[p],
E,A);for(var q=0;3>q;++q)B[p][q]/=B[p][3]}f.vec3.negate(L,B[0]);h.mat4.translate(x,M,L);n.camera.viewMatrix=x;for(p=0;8>p;++p)f.vec3.transformMat4(B[p],B[p],n.camera.viewMatrix);f.vec3.copy(G,B[0]);f.vec3.copy(F,B[0]);for(p=1;8>p;++p)for(q=0;3>q;++q)G[q]=Math.min(G[q],B[p][q]),F[q]=Math.max(F[q],B[p][q]);G[2]-=200;F[2]+=200;n.camera.near=-F[2];n.camera.far=-G[2];e=1/B[0][3];l=1/B[4][3];r.assert(e<l);var q=e+Math.sqrt(e*l),p=Math.sin(m.acosClamped(k[2]*c[0]+k[6]*c[1]+k[10]*c[2])),q=q/p,e=B,u=q,w=p,
p=K,t=H,v=N,O=I,q=J;g.vec2.set(U,0,0);for(var R=0;4>R;++R)g.vec2.add(U,U,e[R]);g.vec2.scale(U,U,.25);g.vec2.set(P,0,0);for(R=4;8>R;++R)g.vec2.add(P,P,e[R]);g.vec2.scale(P,P,.25);g.vec2.lerp(V[0],e[4],e[5],.5);g.vec2.lerp(V[1],e[5],e[6],.5);g.vec2.lerp(V[2],e[6],e[7],.5);g.vec2.lerp(V[3],e[7],e[4],.5);for(var T=0,ca=g.vec2.squaredDistance(V[0],U),R=1;4>R;++R){var ha=g.vec2.squaredDistance(V[R],U);ha<ca&&(ca=ha,T=R)}g.vec2.subtract(W,V[T],e[T+4]);R=W[0];W[0]=-W[1];W[1]=R;g.vec2.subtract(Q,P,U);g.vec2.lerp(W,
W,Q,w);g.vec2.normalize(W,W);T=w=void 0;w=T=g.vec2.dot(g.vec2.subtract(Z,e[0],U),W);for(R=1;8>R;++R)ca=g.vec2.dot(g.vec2.subtract(Z,e[R],U),W),ca<w?w=ca:ca>T&&(T=ca);g.vec2.copy(p,U);g.vec2.scale(Z,W,w-u);g.vec2.add(p,p,Z);for(var ha=-1,oa=1,R=u=ca=0;8>R;++R){g.vec2.subtract(X,e[R],p);g.vec2.normalize(X,X);var la=W[0]*X[1]-W[1]*X[0];0<la?la>ha&&(ha=la,ca=R):la<oa&&(oa=la,u=R)}r.verify(0<ha,"leftArea");r.verify(0>oa,"rightArea");g.vec2.scale(aa,W,w);g.vec2.add(aa,aa,U);g.vec2.scale(da,W,T);g.vec2.add(da,
da,U);ga[0]=-W[1];ga[1]=W[0];t=r.rayRay2D(p,e[u],da,g.vec2.add(Z,da,ga),1,t);v=r.rayRay2D(p,e[ca],da,Z,1,v);O=r.rayRay2D(p,e[ca],aa,g.vec2.add(Z,aa,ga),1,O);e=r.rayRay2D(p,e[u],aa,Z,1,q);r.verify(t,"rayRay");r.verify(v,"rayRay");r.verify(O,"rayRay");r.verify(e,"rayRay");v=K;e=H;p=I;O=J;q=n.camera.projectionMatrix;g.vec2.subtract(ia,p,O);g.vec2.scale(ia,ia,.5);ba[0]=ia[0];ba[1]=ia[1];ba[2]=0;ba[3]=ia[1];ba[4]=-ia[0];ba[5]=0;ba[6]=ia[0]*ia[0]+ia[1]*ia[1];ba[7]=ia[0]*ia[1]-ia[1]*ia[0];ba[8]=1;ba[6]=
-g.vec2.dot(y(ba,0),v);ba[7]=-g.vec2.dot(y(ba,1),v);v=g.vec2.dot(y(ba,0),p)+ba[6];t=g.vec2.dot(y(ba,1),p)+ba[7];R=g.vec2.dot(y(ba,0),O)+ba[6];O=g.vec2.dot(y(ba,1),O)+ba[7];v=-(v+R)/(t+O);ba[0]+=ba[1]*v;ba[3]+=ba[4]*v;ba[6]+=ba[7]*v;v=1/(g.vec2.dot(y(ba,0),p)+ba[6]);t=1/(g.vec2.dot(y(ba,1),p)+ba[7]);ba[0]*=v;ba[3]*=v;ba[6]*=v;ba[1]*=t;ba[4]*=t;ba[7]*=t;ba[2]=ba[1];ba[5]=ba[4];ba[8]=ba[7];ba[7]+=1;v=g.vec2.dot(y(ba,1),e)+ba[7];t=g.vec2.dot(y(ba,2),e)+ba[8];R=g.vec2.dot(y(ba,1),p)+ba[7];O=g.vec2.dot(y(ba,
2),p)+ba[8];v=-.5*(v/t+R/O);ba[1]+=ba[2]*v;ba[4]+=ba[5]*v;ba[7]+=ba[8]*v;v=g.vec2.dot(y(ba,1),e)+ba[7];t=g.vec2.dot(y(ba,2),e)+ba[8];R=-t/v;ba[1]*=R;ba[4]*=R;ba[7]*=R;q[0]=ba[0];q[1]=ba[1];q[2]=0;q[3]=ba[2];q[4]=ba[3];q[5]=ba[4];q[6]=0;q[7]=ba[5];q[8]=0;q[9]=0;q[10]=1;q[11]=0;q[12]=ba[6];q[13]=ba[7];q[14]=0;q[15]=ba[8];n.camera.projectionMatrix[10]=2/(G[2]-F[2]);n.camera.projectionMatrix[14]=-(G[2]+F[2])/(G[2]-F[2]);h.mat4.multiply(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);e=this.textureRes/
2;n.camera.viewport[0]=0===d%2?0:e;n.camera.viewport[1]=0===Math.floor(d/2)?0:e;n.camera.viewport[2]=e;n.camera.viewport[3]=e}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*l;c=this.rctx;c.bindFramebuffer(this.fbo);c.bindTexture(null,7);c.setClearColor(1,1,1,1);c.clearSafe(16640)};a.prototype.finish=function(a){r.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};a.prototype.bind=function(a){var b=this.rctx,c=this.enabled;
b.bindTexture(c?this.depthTexture:this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};a.prototype.bindView=function(a,
b){if(this.enabled){var d=this.lastOrigin;if(!d||d[0]!==b[0]||d[1]!==b[1]||d[2]!==b[2])for(this.lastOrigin=this.lastOrigin||c.vec3f64.create(),f.vec3.copy(this.lastOrigin,b),d=0;d<this.numCascades;++d){h.mat4.translate(O,this.cascades[d].lightMat,b);for(var e=0;16>e;++e)T[16*d+e]=O[e]}a.setUniformMatrix4fv("shadowMapMatrix",T)}};a.prototype.enable=function(){this.enabled||(this.depthTexture=new u(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureRes,
height:this.textureRes}),this.fbo=w.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes}))};a.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};a.prototype.getGpuMemoryUsage=function(){return v.getGpuMemoryUsage(this.fbo)};return a}();var x=d.mat4f64.create(),z=d.mat4f64.create(),A=d.mat4f64.create(),E=e.vec4f64.create(),B=[];for(a=0;8>a;++a)B.push(e.vec4f64.create());
var G=c.vec3f64.create(),F=c.vec3f64.create(),K=l.vec2f64.create(),H=l.vec2f64.create(),N=l.vec2f64.create(),I=l.vec2f64.create(),J=l.vec2f64.create(),M=d.mat4f64.create(),L=c.vec3f64.create(),R=[],O=d.mat4f64.create(),T=new Float32Array(64),U=l.vec2f64.create(),P=l.vec2f64.create(),V=[l.vec2f64.create(),l.vec2f64.create(),l.vec2f64.create(),l.vec2f64.create()],W=l.vec2f64.create(),Q=l.vec2f64.create(),Z=l.vec2f64.create(),X=l.vec2f64.create(),aa=l.vec2f64.create(),da=l.vec2f64.create(),ga=l.vec2f64.create(),
ca=l.vec2f64.create(),ia=l.vec2f64.create(),ba=k.mat3f64.create();return n})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(n,a,m){var k=m.boundedPlane.create();return function(){function a(){this._worldPlane=k}Object.defineProperty(a.prototype,"isEnabled",{get:function(){return this.plane!==k},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"plane",{get:function(){return this._worldPlane},set:function(a){this._worldPlane=
a?a:k},enumerable:!0,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../core/promiseUtils ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(n,a,m,k,h,d,g,l,f,c){return function(){function a(a){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations=
{vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}a.prototype.loadResources=function(a){var b=this;if(!this.data||!this.textureArea||!this.textureSearch){var c=this.resourceLoadingPromise||this.loadDataModule().then(function(){return b.loadTextures()});a&&c.then(a);this.resourceLoadingPromise||(this.resourceLoadingPromise=c,c.then(function(){return b.resourceLoadingPromise=null}));return!1}return!0};a.prototype.loadDataModule=
function(){var a=this;return this.data?m.resolve():m.create(function(b){return n(["./SmaaRenderPassData"],function(c){a.data=c;b()})})};a.prototype.loadTextures=function(){var a=this;return m.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(function(b){var c=b[1];a.textureArea=b[0];a.textureSearch=c})};Object.defineProperty(a.prototype,"isLoadingResources",{get:function(){return null!=this.resourceLoadingPromise},
enumerable:!0,configurable:!0});a.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var a=this.rctx;this.programEdgeDetect=new g(a,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new g(a,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new g(a,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);
this.pipelineState=l.makePipelineState({colorWrite:l.defaultColorWriteParams});var b=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new c(a,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new h(a,34962,35044,b)});this.tmpFramebufferEdges=d.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=d.createWithAttachments(this.rctx,{target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});return this.isEnabled=!0};a.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,
this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};a.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,e=0;null!=b?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindVAO(this.vao);c.setPipelineState(this.pipelineState);c.setViewport(0,0,d,e);this.tmpFramebufferEdges.resize(d,e);c.bindFramebuffer(this.tmpFramebufferEdges);c.setClearColor(0,0,0,
1);c.clear(16384);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/e,d,e);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,e);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(16384);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",
1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(16384);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",
1);c.drawArrays(4,0,3)};a.prototype.loadTextureFromBase64=function(a,b,c){var d=new f(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);return k.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a);return d})};return a}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./glUtil3D ./Util ../shaders/SSAOPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){var w=m.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");a=function(){function a(a,b,c){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=g.vec4f64.create();this._rctx=b;this._programRep=a;this._requestRender=c;this._emptyTexture=f.createEmptyTexture(b)}a.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(a.prototype,"isSupported",{get:function(){var a=
this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});a.prototype.computeSSAO=function(a,b,e){if(this._noiseTexture){c.assert(this.enabled);var g=this._rctx,
l=a.fullViewport,k=l[2],m=l[3],l=k/this._BLUR_F,n=m/this._BLUR_F;this._ssaoFBO.resize(k,m);this._blur0FBO.resize(l,n);this._blur1FBO.resize(l,n);l=1*k;n=1*m;g.bindFramebuffer(this._ssaoFBO);d.vec4.copy(this._viewportToRestore,a.fullViewport);g.setViewport(0,0,k,m);var p=this._ssaoProgram,q=this._blurProgram;p.setUniform2f("rnmScale",k/this._noiseTexture.descriptor.width,m/this._noiseTexture.descriptor.height);p.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:
32>=this._samples?this._data.random32:this._data.random64);g.bindProgram(p);g.setPipelineState(this._pipelineState);k=this._data.minDiscrepancy;p.setUniform1f("numSpiralTurns",this._samples<k.length?k[this._samples]:5779);k=v;m=u;c.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,k,m);p.setUniform4fv("projInfo",k);p.setUniform2fv("zScale",m);p.setUniform2f("nearFar",a.near,a.far);k=1/a.computeRenderPixelSizeAtDist(1);p.setUniform1f("projScale",1*k);p.setUniform2f("screenDimensions",
l,n);var w=2*this._radius,m=h.vec3.distance(a.eye,a.center),w=20*a.computeRenderPixelSizeAtDist(m),w=Math.max(.1,w);p.setUniform1f("radius",w);p.setUniform1f("intensity",4*this._attenuation/Math.pow(w,6));p.setUniform1i("rnm",0);p.setUniform1i("normalMap",1);p.setUniform1i("depthMap",2);g.bindTexture(this._noiseTexture,0);g.bindTexture(e,1);g.bindTexture(b,2);b=f.createQuadVAO(this._rctx);g.bindVAO(b);g.drawArrays(5,0,r.vertexCount(b,"geometry"));g.bindTexture(this._ssaoFBO.colorTexture,0);g.setViewport(0,
0,l/this._BLUR_F,n/this._BLUR_F);g.bindFramebuffer(this._blur0FBO);q.setUniform2f("screenDimensions",l,n);q.setUniform1i("tex",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);q.setUniform2f("blurSize",0,1*this._BLUR_F/n);q.setUniform1i("radius",4);q.setUniform1f("g_BlurFalloff",.08);q.setUniform2f("nearFar",a.near,a.far);5E4<m&&(k=Math.max(0,k-(m-5E4)));q.setUniform1f("projScale",k);q.setUniform2f("zScale",1,0);g.drawArrays(5,0,r.vertexCount(b,"geometry"));q.setUniform2f("blurSize",
1*this._BLUR_F/l,0);g.bindFramebuffer(this._blur1FBO);g.bindTexture(this._blur0FBO.colorTexture,0);g.drawArrays(5,0,r.vertexCount(b,"geometry"));g.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};a.prototype.setUniforms=function(a){var b=this.enabled&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",
this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};a.prototype.selectPrograms=function(){this._ssaoProgram=this._programRep.getProgram(b.ssaoPass,{samples:8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64});this._blurProgram=this._programRep.getProgram(b.blurPass,
{radius:4});this._pipelineState=p.makePipelineState({colorWrite:p.defaultColorWriteParams})};a.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):w.warn("SSAO is not supported for this browser or hardware"))};a.prototype.loadResources=function(a){var b=this;this._data?a():n(["./SSAOHelperData"],function(c){b._data=c;a()})};a.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,
samplingMode:9729,wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=e.createWithAttachments(this._rctx,b,c);this._blur0FBO=e.createWithAttachments(this._rctx,b,c);this._blur1FBO=e.createWithAttachments(this._rctx,b,c);l.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new q(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};a.prototype.disable=
function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};a.prototype.getGpuMemoryUsage=function(){return r.getGpuMemoryUsage(this._blur0FBO)+r.getGpuMemoryUsage(this._blur1FBO)+r.getGpuMemoryUsage(this._ssaoFBO)};return a}();var u=k.vec2f64.create(),v=
g.vec4f64.create();return a})},"esri/views/3d/webgl-engine/shaders/SSAOPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.ssaoPass={name:"ssao",shaders:function(a){return{vertexShader:k.resolveIncludes("util/quad.vert"),fragmentShader:"#define SAMPLES "+a.samples+"\n"+k.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:m.Default3D};a.blurPass={name:"ssao-blur",shaders:function(a){return{vertexShader:k.resolveIncludes("util/quad.vert"),
fragmentShader:"#define RADIUS "+a.radius+"\n"+k.resolveIncludes("renderer/ssao/blur.frag")}},attributes:m.Default3D}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/BufferView ../../../support/buffer/utils ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/renderState ../../../../webgl/VertexArrayObject module".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E,B,G,F,K,H,N,I){Object.defineProperty(a,"__esModule",{value:!0});m=function(){function a(a,b,c){this.rctx=a;this.programRepository=b;this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new y.LocalOriginManager(new u);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new E;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=q.vec3f64.create();this.tmpCameraPosition=
q.vec3f64.create();this.componentColorManager=new x.BufferManager(this.rctx,2)}a.prototype.initialize=function(){var a=this;b.open(f.getAbsMid("./EdgeProcessingWorker",n,I)).then(function(b){a.destroyed?b.close():a.workerThread=b});for(var c=z.VertexLayout.createBuffer(4),d=0;4>d;d++)c.sideness.set(d,0,0===d||3===d?0:1),c.sideness.set(d,1,0===d||1===d?0:1);this.verticesBufferObject=K.createVertex(this.rctx,35044,c.buffer);this.pipelineState=(c=this.rctx.capabilities.blendMinMax)?H.makePipelineState({blending:H.separateBlendingParams(1,
1,0,1,32774,c.MAX),depthTest:{func:515},colorWrite:H.defaultColorWriteParams}):H.makePipelineState({depthTest:{func:515},depthWrite:H.defaultDepthWriteParams,colorWrite:H.defaultColorWriteParams})};a.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};a.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};Object.defineProperty(a.prototype,
"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});a.prototype.shouldRender=function(){return 0<this.renderers.size};a.prototype.addObject=function(a,b,c,d,e){return k(this,void 0,void 0,function(){var f,g,k,m,n,p,q;return h(this,function(h){switch(h.label){case 0:if(this.hasObject(a))return[2];f=[];k={loaded:l.create(function(a){return g=a}),renderables:[]};this.perObjectData.set(a,k);if(e&&e.mergeGeometries&&1<a.geometries.length&&this.canMergeGeometries(a))f.push(this.addObjectMergedGeometries(a,
k,b,c));else for(m=0;m<a.geometries.length;m++)n=a.geometries[m],p=a.geometryRecords[m],q=p.material,q.supportsEdges&&(n.data instanceof t?f.push(this.addGeometryPreinterleaved(a,k,n.data,p,b,c,d)):f.push(this.addGeometryNonPreinterleaved(a,k,n.data,p,b[0],c,d)));return[4,l.all(f)];case 1:return h.sent(),this.callbacks.setNeedsRender(),g(),[2]}})})};a.prototype.hasObject=function(a){return this.perObjectData.has(a)};a.prototype.updateAllComponentOpacities=function(a,b){return k(this,void 0,void 0,
function(){var c,d,e=this;return h(this,function(f){switch(f.label){case 0:return c=b instanceof Array?function(a){return b[a]}:function(){return b},[4,this.getObjectEntry(a)];case 1:return d=f.sent(),d.renderables.forEach(function(a){for(var b=a.components.meta.length,d=0;d<b;d++){var f=c(d),g=a.components.meta[d],h=g.index;g.material.opacity=f;a.components.buffer.textureBuffer.setDataElement(h,1,3,255*f)}e.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};a.prototype.updateAllComponentMaterials=
function(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,g,l,k=this;return h(this,function(h){switch(h.label){case 0:return e=!!c.slicePlaneEnabled,f=F.determineRendererType(b),g=B.EdgeRenderer.getKey(f,e),[4,this.getObjectEntry(a)];case 1:return l=h.sent(),l.renderables.forEach(function(a){if(g!==a.rendererKey){var c=k.renderers.get(a.rendererKey),h=k.acquireRenderer(f,e);c.removeRenderable(a);c.refCount.decrement();a.rendererKey=g;h.addRenderable(a)}for(c=0;c<b.length;c++)a.components.meta[c].material=
b[c];d&&k.updateComponentBuffer(a.components);k.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};a.prototype.updateObjectVisibility=function(a,b){return k(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:return[4,this.getObjectEntry(a)];case 1:return c=d.sent(),c.renderables.forEach(function(a){a.visible=b}),this.callbacks.setNeedsRender(),[2]}})})};a.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),
c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};a.prototype.getObjectEntry=function(a){return k(this,void 0,void 0,function(){var b;return h(this,function(c){switch(c.label){case 0:b=this.perObjectData.get(a);if(!b)throw"no object";return[4,b.loaded];case 1:return c.sent(),[2,b]}})})};a.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};a.prototype.render=function(a,b){var c=this;
this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===a.refCount.value&&(c.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var d=0,e=0;this.renderers.forEach(function(a){return a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;e++},b)});if(0!==e){var f=a.view,g=40*d/e,h=F.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5*a.pixelRatio),l={distanceFalloffFactor:g,minimumEdgeLength:h,
transparency:b};this.rctx.setPipelineState(this.pipelineState);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(b){c.renderRegularEdges(b,a,l);c.renderSilhouetteEdges(b,a,l)});a.view=f}};a.prototype.updateTransparency=function(a){var b=F.determineEdgeTransparency(a.components.meta),c=F.determineObjectTransparency(a.components.meta);if(b!==a.edgeTransparency||c!==a.objectTransparency)a.edgeTransparency=b,a.objectTransparency=c,this.renderers.get(a.rendererKey).setRenderablesDirty()};
a.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=p.vec3.set(this.tmpModelPosition,c[12],c[13],c[14]),b.origin=this.localOrigins.acquire(a));v.applyToModelMatrix(b.origin.vec3,c);return c};a.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,f=g.clamp(Math.round(d.size*B.LINE_WIDTH_FRACTION_FACTOR),0,255),h=g.clamp(d.extensionLength,
-B.EXTENSION_LENGTH_OFFSET,255-B.EXTENSION_LENGTH_OFFSET)+B.EXTENSION_LENGTH_OFFSET,l="solid"===d.type?0:1,k=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,f,h,l,k)}};a.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],f=c.acquireIndex();b.push({index:f,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};a.prototype.extractEdges=
function(a,b,c,d,e){return this.worker.process({data:b,originalIndices:e,writerSettings:a,skipDeduplicate:c},d?null:this.workerThread)};a.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new N(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,instances:A.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:K.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<
a.silhouette.lodInfo.lengths.length&&(c=new N(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,instances:A.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:K.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};a.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),
a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};a.prototype.addGeometryNonPreinterleaved=function(a,b,c,d,f,g,l){return k(this,void 0,void 0,function(){var k,m,n,p;return h(this,function(h){k=c.getAttribute("position");m=this.computeModelTransformWithLocalOrigin(a,d,e.mat4f64.create());n=d.origin;p={position:k,indices:c.getIndices("position"),modelTransform:m,origin:n};return[2,this.addNonPreinterleaved(b,p,f,g,l)]})})};a.prototype.addNonPreinterleaved=function(a,b,c,d,e){void 0===e&&(e=!1);
return k(this,void 0,void 0,function(){var f,g,l,k,m,n,p,q,r,u,w,t,v,y,x;return h(this,function(h){switch(h.label){case 0:f=this.acquireRenderer(c.type,d.slicePlaneEnabled||!1);g=b.modelTransform;l=b.origin;k=b.indices;m=b.position;n=m.data.length/m.strideIdx;p=z.EdgeInputBufferLayout.createBuffer(n);for(q=0;q<n;q++)p.position.set(q,0,m.data[m.offsetIdx+q*m.strideIdx+0]),p.position.set(q,1,m.data[m.offsetIdx+q*m.strideIdx+1]),p.position.set(q,2,m.data[m.offsetIdx+q*m.strideIdx+2]);r=this.createComponentBuffers([c]);
F.fillComponenBufferIndices(r.meta,[0,p.componentIndex.count],p.componentIndex);return[4,this.extractEdges(f.writerSettings,p,!1,e,k)];case 1:return u=h.sent(),w=this.createEdgeResources(u),t=w.regular,v=w.silhouette,y=(t?t.vao.size:0)+(v?v.vao.size:0),x={regular:t,silhouette:v,transform:{modelMatrix:g,origin:l},statistics:{gpuMemoryUsage:y,averageEdgeLength:u.averageEdgeLength},components:r,visible:!0,edgeTransparency:F.determineEdgeTransparency(r.meta),objectTransparency:F.determineObjectTransparency(r.meta),
distanceToCamera:0,rendererKey:f.key},a.renderables.push(x),f.addRenderable(x),this.gpuMemoryUsage+=y,[2]}})})};a.prototype.addGeometryPreinterleaved=function(a,b,d,f,g,l,m){return k(this,void 0,void 0,function(){var k,n,p,q,u,t,v,y,x,A,B,E,G,H,K,I;return h(this,function(h){switch(h.label){case 0:k=d.getAttribute("position");if(!k||!c.isFloat32Array(k.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];n=F.determineRendererType(g);p=this.acquireRenderer(n,l.slicePlaneEnabled||
!1);q=this.computeModelTransformWithLocalOrigin(a,f,e.mat4f64.create());u=f.origin;t=d.getIndices("position");v=new r.BufferViewVec3f(k.data.buffer,4*k.offsetIdx,4*k.strideIdx);y=z.EdgeInputBufferLayout.createBuffer(v.count);w.vec3.copy(y.position,v);x=this.createComponentBuffers(g);F.fillComponenBufferIndices(x.meta,d.componentOffsets,y.componentIndex,t);A=d.hasPositionData;return[4,this.extractEdges(p.writerSettings,y,A,m,t)];case 1:return B=h.sent(),E=this.createEdgeResources(B),G=E.regular,H=
E.silhouette,K=(G?G.vao.size:0)+(H?H.vao.size:0),I={regular:G,silhouette:H,transform:{modelMatrix:q,origin:u},statistics:{gpuMemoryUsage:K,averageEdgeLength:B.averageEdgeLength},components:x,visible:!a.isHidden(f),edgeTransparency:F.determineEdgeTransparency(x.meta),objectTransparency:F.determineObjectTransparency(x.meta),distanceToCamera:0,rendererKey:p.key},b.renderables.push(I),p.addRenderable(I),this.gpuMemoryUsage+=K,[2]}})})};a.prototype.canMergeGeometries=function(a){for(var b=null,c=null,
e=0;e<a.geometries.length;e++){var f=a.geometryRecords[e];if(f.material.supportsEdges){if(a.geometries[e].data instanceof t)return!1;if(!b)b=f.transformation;else if(!d.equals(b,f.transformation))return!1;if(!c&&f.origin)c=f;else if(c&&f.origin&&c.origin.id!==f.origin.id)return!1}}return!0};a.prototype.addObjectMergedGeometries=function(a,b,d,f){return k(this,void 0,void 0,function(){var g,l,k,m,n,p,q,r,u,w,t,v,y,x,z,A,B,E,F,G,H;return h(this,function(h){switch(h.label){case 0:g=new Map;l=0;m=k=null;
for(n=0;n<a.geometries.length;n++)if(p=a.geometries[n],q=a.geometryRecords[n],r=q.material,r.supportsEdges&&(!m&&q.origin&&(m=q),u=p.data.getIndices("position"),l+=u?u.length:0,u&&null==k||k===Uint16Array))k=c.isUint16Array(u)?Uint16Array:Uint32Array;w=l?new k(l):null;t=[];for(n=v=0;n<a.geometries.length;n++)if(p=a.geometries[n],y=a.geometryRecords[n],r=y.material,r.supportsEdges){x=p.data.getAttribute("position");u=p.data.getIndices("position");z=g.get(x.data);if(null==z){z=t.length/3;for(A=x.offsetIdx;A<
x.data.length;A+=x.strideIdx)t.push(x.data[A+0]),t.push(x.data[A+1]),t.push(x.data[A+2]);g.set(x.data,z)}if(u)for(B=0;B<u.length;B++)w[v++]=z+u[B]}E=m||a.geometryRecords[0];F=this.computeModelTransformWithLocalOrigin(a,E,e.mat4f64.create());G=E.origin;for(n=0;n<a.geometryRecords.length;n++)a.geometryRecords[n].origin=G;H={position:{data:t,offsetIdx:0,strideIdx:3},indices:w,modelTransform:F,origin:G};return[4,this.addNonPreinterleaved(b,H,d[0],f)];case 1:return h.sent(),[2]}})})};a.prototype.acquireRenderer=
function(a,b){var c=B.EdgeRenderer.getKey(a,b),d=this.renderers.get(c);this.strokesTexture||(this.strokesTexture=G.generateStrokesTexture(this.rctx));d||(d=new B.EdgeRenderer(this.rctx,this.programRepository,{type:a,slicePlaneEnabled:b,strokesTexture:this.strokesTexture}),this.renderers.set(c,d));d.refCount.increment();return d};a.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);
this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};a.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;p.vec3.set(this.tmpCameraPosition,a[3],a[7],a[11]);this.perObjectData.forEach(function(a,c){var d=p.vec3.distance(c.getCenter(),b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};a.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,
c);a.forEachRenderable(function(e){if(e.visible&&e.regular){var f=F.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderRegularEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};a.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette){var f=F.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);
a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};return a}();a.EdgeView=m})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.applyToModelMatrix=function(a,k){var h=-a[0],d=-a[1];a=-a[2];var g=k[3],l=k[7],f=k[11],c=k[15];k[0]+=g*h;k[1]+=g*d;k[2]+=g*a;k[4]+=l*h;k[5]+=l*d;k[6]+=l*a;k[8]+=f*h;k[9]+=f*d;k[10]+=f*a;k[12]+=c*h;k[13]+=c*d;k[14]+=c*a};a.applyToViewMatrix=
function(a,k){var h=a[0],d=a[1];a=a[2];k[12]+=h*k[0]+d*k[4]+a*k[8];k[13]+=h*k[1]+d*k[5]+a*k[9];k[14]+=h*k[2]+d*k[6]+a*k[10];k[14]+=h*k[3]+d*k[7]+a*k[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a){this.factory=a;this.originData=new Map}a.prototype.acquire=
function(a){return this.register(this.factory.getOrigin(a))};a.prototype.register=function(a){var d=this.originData.get(a.id);if(d)return d.refCount++,d.origin;this.originData.set(a.id,{refCount:1,viewMatrix:k.mat4f64.create(),origin:a});return a};a.prototype.release=function(a){var d=this.originData.get(a.id);d&&(d.refCount--,0===d.refCount&&this.originData.delete(a.id))};a.prototype.updateViewMatrices=function(a){this.originData.forEach(function(d){m.mat4.copy(d.viewMatrix,a);h.applyToViewMatrix(d.origin.vec3,
d.viewMatrix)})};a.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return a}();a.LocalOriginManager=n})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define("require exports ../../../../core/compilerUtils ./ComponentUtils ./geometryDataUtils ../../../webgl/Util".split(" "),function(n,a,m,k,h,d){function g(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;
case 5125:return Uint32Array;case 5123:return Uint16Array;default:m.neverReached(a)}}return function(){function a(f,c,b,e,l){void 0===b&&(b=null);void 0===e&&(e=a.DefaultOffsets);void 0===l&&(l=a.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var m=d.getStride(c)/4,m=f.length/m;this._hasDefaultIndices=l===a.DefaultIndices;this.indexCount=l.length;this._hasDefaultIndices&&(l=h.generateDefaultIndexArray(m),this.indexCount=m);for(var m={},n=0;n<c.length;n++){var p=
c[n],u=new (g(p.type))(f.buffer),v=d.getBytesPerElement(p.type);m[p.name]={data:u,size:p.count,offsetIdx:p.offset/v,strideIdx:p.stride/v}}b&&(this._positionData=b,m.position={data:b.data,size:3,offsetIdx:0,strideIdx:3});this._id=h.getNewId();this._vertexData=f;this._vertexAttributes=m;this._layout=c;this._indexData=l;this._componentOffsets=k.createOffsets(e);this._gpuMemoryUsage=f.byteLength+(this._hasDefaultIndices?0:l.byteLength)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});a.prototype.toRenderData=function(){var a={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this.indexCount,vertexData:this._vertexData,layout:this._layout};this._indexData=
this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return a};a.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};a.prototype.getAttribute=function(a){return this._vertexAttributes[a]};a.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};Object.defineProperty(a.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});a.DefaultOffsets=
new Uint32Array(0);a.DefaultIndices=new Uint32Array(0);return a}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(n,a,m){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,d){void 0===d&&(d=1);this.rctx=a;this.fieldCount=d;this.buffers=[]}a.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===a.activeCount?(a.dispose(),!1):!0})};a.prototype.getBuffer=
function(a){for(var d=0,g=this.buffers;d<g.length;d++){var h=g[d];if(h.availableCount>=a)return h}if(a>m.MAX_INDEX_COUNT)return null;a=new m.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(a);return a};a.prototype.updateTextures=function(){for(var a=0,d=this.buffers;a<d.length;a++)d[a].textureBuffer.updateTexture()};return a}();a.BufferManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager",
"./TextureBackedBuffer"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});a.MAX_INDEX_COUNT=65536;n=function(){function h(d,g){void 0===g&&(g=1);this.textureBuffer=new k.TextureBackedBuffer(d,g);this.indexManager=new m.SimpleIndexManager(a.MAX_INDEX_COUNT)}h.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(h.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});h.prototype.acquireIndex=function(){var a=this.indexManager.acquire();this.textureBuffer.resizeToFit(a);return a};h.prototype.releaseIndex=function(a){this.indexManager.release(a)};return h}();a.ManagedTextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,
"__esModule",{value:!0});n=function(){function a(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(a.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});a.prototype.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};a.prototype.release=function(a){this.recycledIndices.push(a)};return a}();a.SimpleIndexManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});n=function(){function a(a,g){void 0===g&&(g=1);this.rctx=a;this.fieldCount=g;this.textureWidth=4096;this.dirty=
!0;this.texture=new k(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new m.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}a.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};a.prototype.setData=function(a,g,h,f,c,b){a=a*this.fieldCount+g;this.dirty=!0;this.data.set(a,0,h);this.data.set(a,1,f);this.data.set(a,2,c);this.data.set(a,3,b)};a.prototype.setDataElement=
function(a,g,h,f){a=a*this.fieldCount+g;this.dirty=!0;this.data.set(a,h,f)};a.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new m.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),this.data=a)};a.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};a.prototype.bind=function(a,g){this.rctx.bindTexture(this.texture,g.unit);a.setUniform1i(g.texName,g.unit);a.setUniform2f(g.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return a}();a.TextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});
a.EdgeInputBufferLayout=k.newLayout().vec3f("position").u16("componentIndex").u16("_padding");a.VertexLayout=k.newLayout().vec2u8("sideness");a.glVertexLayout=m.glLayout(a.VertexLayout,{prefixA:!0});a.CommonInstancesLayout=k.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});a.RegularEdgeInstancesLayout=a.CommonInstancesLayout.clone().vec3f("normal");
a.SilhouetteEdgeInstancesLayout=a.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");a.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(n,a,m,k,h,d,g,l,f){Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,c,d){var f=b;f[0]=d.position0[0];f[1]=d.position0[1];f[2]=d.position0[2];f[3]=d.position1[0];f[4]=d.position1[1];f[5]=d.position1[2];p[0]=5381;for(f=0;f<e.length;f++)p[0]=31*p[0]+e[f];q.seed=p[0];var f=q.getIntRange(0,255),g=q.getIntRange(0,this.settings.variants-1),h=q.getFloat(),h=-(1-Math.min(h/.7,1))+Math.max(0,
h-.7)/(1-.7),h=255*(Math.pow(Math.abs(h),1.2)*(0>h?-1:1)*.5+.5);a.position0.setVec(c,d.position0);a.position1.setVec(c,d.position1);a.componentIndex.set(c,d.componentIndex);a.variantOffset.set(c,f);a.variantStroke.set(c,g);a.variantExtension.set(c,h)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();a.CommonBufferWriter=c;var b=new Float32Array(6),e=new Uint32Array(b.buffer),p=new Uint32Array(1),q=new h;n=function(){function a(){this.commonWriter=new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};
a.prototype.allocate=function(a){return f.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);d.vec3.add(r,c.faceNormal0,c.faceNormal1);d.vec3.normalize(r,r);a.normal.setVec(b,r)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=f.RegularEdgeInstancesLayout;a.glLayout=l.glLayout(f.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();a.RegularEdgeBufferWriter=n;n=function(){function a(){this.commonWriter=
new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return f.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=f.SilhouetteEdgeInstancesLayout;a.glLayout=l.glLayout(f.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();
a.SilhouetteEdgeBufferWriter=n;var r=g.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(n,a,m,k,h,d,g,
l,f,c,b){return function(){function a(){this.regularWriter=new c.RegularEdgeBufferWriter;this.silhouetteWriter=new c.SilhouetteEdgeBufferWriter}a.prototype.process=function(a,b){return m(this,void 0,void 0,function(){var c,d,e;return k(this,function(f){switch(f.label){case 0:if(!b)return[3,2];c=[];d=this.packInput(a,c);this.wrappedWork;return[4,b.invoke("wrappedWork",d,{transferList:c})];case 1:return e=f.sent(),[2,this.unpackOutput(e)];case 2:return[2,this.work(a)]}})})};a.prototype.wrappedWork=
function(a){return m(this,void 0,void 0,function(){var b,c,d,e;return k(this,function(f){b=this.unpackInput(a);c=this.work(b);d=[];this.packInputTransferables(b,d);e=this.packOutput(c,d);return[2,{result:e,transferList:d}]})})};a.prototype.work=function(a){var c=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return b.extractEdges(c,this.regularWriter,this.silhouetteWriter)};
a.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};a.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=h.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return b};a.prototype.unpackInput=function(a){return{data:f.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};a.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:l.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:l.packInterleavedBuffer(a.silhouette.instancesData,
b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};a.prototype.unpackOutput=function(a){return{regular:{instancesData:l.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:l.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};a.prototype.extractEdgeInformation=function(a,
b,c){if(b&&c)return b=g.computeNeighbors(c,a.count),{faces:c,neighbors:b,vertices:a};a=d.default(a.buffer,a.stride/4,c);b=g.computeNeighbors(a.indices,a.uniqueCount);return{faces:a.indices,neighbors:b,vertices:f.EdgeInputBufferLayout.createView(a.buffer)}};return a}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.computeNeighbors=function(a,k){for(var h=a.length/3,d=new Uint32Array(k+1),g=new Uint32Array(k+
1),l=function(a,b){a<b?d[a+1]++:g[b+1]++},f=0;f<h;f++){var c=a[3*f],b=a[3*f+1],e=a[3*f+2];l(c,b);l(b,e);l(e,c)}for(f=b=c=0;f<k;f++)e=d[f+1],l=g[f+1],d[f+1]=c,g[f+1]=b,c+=e,b+=l;for(var m=new Uint32Array(6*h),n=d[k],l=function(a,b,c){if(a<b){var e=d[a+1]++;m[2*e]=b;m[2*e+1]=c}else e=g[b+1]++,m[2*n+2*e]=a,m[2*n+2*e+1]=c},f=0;f<h;f++)c=a[3*f],b=a[3*f+1],e=a[3*f+2],l(c,b,f),l(b,e,f),l(e,c,f);c=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=m[c+2*b],e=m[c+2*b+1],f=b-1;for(f;0<=f&&m[c+2*f]>d;f--)m[c+
2*f+2]=m[c+2*f],m[c+2*f+3]=m[c+2*f+1];m[c+2*f+2]=d;m[c+2*f+3]=e}};for(f=0;f<k;f++)c(d[f],d[f+1]),c(n+g[f],n+g[f+1]);for(var r=new Int32Array(3*h),w=function(b,c){return b===a[3*c]?0:b===a[3*c+1]?1:b===a[3*c+2]?2:-1},h=function(a,b){a=w(a,b);r[3*b+a]=-1},c=function(a,b,c,d){a=w(a,b);r[3*b+a]=d;c=w(c,d);r[3*d+c]=b},f=0;f<k;f++){for(var b=d[f],e=d[f+1],l=g[f],u=g[f+1];b<e&&l<u;){var v=m[2*b],y=m[2*n+2*l];v===y?(c(f,m[2*b+1],y,m[2*n+2*l+1]),b++,l++):v<y?(h(f,m[2*b+1]),b++):(h(y,m[2*n+2*l+1]),l++)}for(;b<
e;)h(f,m[2*b+1]),b++;for(;l<u;)y=m[2*n+2*l],h(y,m[2*n+2*l+1]),l++}return r}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(n,a,m,k,h){function d(a){var c=[];a.fields.forEach(function(a,d){var b=a.constructor;a=m({},a,{constructor:b.ElementType+"_"+b.ElementCount});c.push([d,a])});return{stride:a.stride,fields:c,fieldNames:a.fieldNames}}function g(a){var c=h.newLayout();c.stride=
a.stride;c.fieldNames=a.fieldNames;a.fields.forEach(function(a){return c.fields.set(a[0],m({},a[1],{constructor:l.get(a[1].constructor)}))});return c}Object.defineProperty(a,"__esModule",{value:!0});a.packInterleavedBuffer=function(a,c){c.push(a.buffer);return{buffer:a.buffer,layout:d(a.layout)}};a.unpackInterleavedBuffer=function(a){return g(a.layout).createView(a.buffer)};a.packLayout=d;a.unpackLayout=g;n=[k.BufferViewFloat,k.BufferViewVec2f,k.BufferViewVec3f,k.BufferViewVec4f,k.BufferViewMat3f,
k.BufferViewMat4f,k.BufferViewFloat64,k.BufferViewVec2f64,k.BufferViewVec3f64,k.BufferViewVec4f64,k.BufferViewMat3f64,k.BufferViewMat4f64,k.BufferViewUint8,k.BufferViewVec2u8,k.BufferViewVec3u8,k.BufferViewVec4u8,k.BufferViewUint16,k.BufferViewVec2u16,k.BufferViewVec3u16,k.BufferViewVec4u16,k.BufferViewUint32,k.BufferViewVec2u32,k.BufferViewVec3u32,k.BufferViewVec4u32,k.BufferViewInt8,k.BufferViewVec2i8,k.BufferViewVec3i8,k.BufferViewVec4i8,k.BufferViewInt16,k.BufferViewVec2i16,k.BufferViewVec3i16,
k.BufferViewVec4i16,k.BufferViewInt32,k.BufferViewVec2i32,k.BufferViewVec3i32,k.BufferViewVec4i32];var l=new Map;n.forEach(function(a){return l.set(a.ElementType+"_"+a.ElementCount,a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),
function(n,a,m,k,h,d,g,l){function f(a,b){var c=k.acosClamped(a.cosAngle),f=e.fwd,g=e.ortho;l.directionFromTo(f,a.position1,a.position0);a=0<d.vec3.dot(d.vec3.cross(g,a.faceNormal0,a.faceNormal1),f)?-1:1;return c*a>b}function c(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],g=a[3*e+1],h=a[3*e+2],l=c[3*e+0],k=c[3*e+1],m=c[3*e+2],d=d+(-1===f||l<k?1:0),d=d+(-1===g||k<m?1:0),d=d+(-1===h||m<l?1:0);for(var d=new Int32Array(4*d),n=0,e=0;e<b;e++){f=a[3*e+0];g=a[3*
e+1];h=a[3*e+2];l=c[3*e+0];k=c[3*e+1];m=c[3*e+2];if(-1===f||l<k)d[n++]=l,d[n++]=k,d[n++]=e,d[n++]=f;if(-1===g||k<m)d[n++]=k,d[n++]=m,d[n++]=e,d[n++]=g;if(-1===h||m<l)d[n++]=m,d[n++]=l,d[n++]=e,d[n++]=h}return d}function b(a){var b=a.faces.length/3,c=a.vertices.position;a=a.faces;for(var e=p.v0,f=p.v1,g=p.v2,h=new Float32Array(3*b),l=0;l<b;l++){var k=a[3*l+1],m=a[3*l+2];c.getVec(a[3*l+0],e);c.getVec(k,f);c.getVec(m,g);d.vec3.subtract(f,f,e);d.vec3.subtract(g,g,e);d.vec3.cross(e,f,g);d.vec3.normalize(e,
e);h[3*l+0]=e[0];h[3*l+1]=e[1];h[3*l+2]=e[2]}return h}Object.defineProperty(a,"__esModule",{value:!0});a.extractEdges=function(a,g,l,n){void 0===n&&(n=q);var p=a.vertices.position,r=a.vertices.componentIndex,u=k.deg2rad(n.anglePlanar);n=k.deg2rad(n.angleSignificantEdge);var w=Math.cos(n),v=Math.cos(u),E=e.edge,B=E.position0,G=E.position1,F=E.faceNormal0,K=E.faceNormal1,H=b(a),N=c(a),I=N.length/4;a=g.allocate(I);n=0;var J=l.allocate(I),M=0,L=0,R=0,O=m.range(0,I),T=new Float32Array(I);h.forEach(T,function(a,
b,c){p.getVec(N[4*b+0],B);p.getVec(N[4*b+1],G);c[b]=d.vec3.distance(B,G)});O.sort(function(a,b){return T[b]-T[a]});for(var U=[],P=[],V=0;V<I;V++){var W=O[V],Q=T[W],Z=N[4*W+0],X=N[4*W+1],aa=N[4*W+2],W=N[4*W+3],da=-1===W;p.getVec(Z,B);p.getVec(X,G);if(da)d.vec3.set(F,H[3*aa+0],H[3*aa+1],H[3*aa+2]),d.vec3.copy(K,F),E.componentIndex=r.get(Z),E.cosAngle=d.vec3.dot(F,K);else{d.vec3.set(F,H[3*aa+0],H[3*aa+1],H[3*aa+2]);d.vec3.set(K,H[3*W+0],H[3*W+1],H[3*W+2]);E.componentIndex=r.get(Z);E.cosAngle=d.vec3.dot(F,
K);if(E.cosAngle>v)continue;-.9999>E.cosAngle&&d.vec3.copy(K,F)}L+=Q;R++;da||E.cosAngle<w?(g.write(a,n++,E),U.push(Q)):f(E,u)&&(l.write(J,M++,E),P.push(Q))}r=new Float32Array(U.reverse());u=new Float32Array(P.reverse());return{regular:{instancesData:g.trim(a,n),lodInfo:{lengths:r}},silhouette:{instancesData:l.trim(J,M),lodInfo:{lengths:u}},averageEdgeLength:L/R}};var e={edge:{position0:g.vec3f64.create(),position1:g.vec3f64.create(),faceNormal0:g.vec3f64.create(),faceNormal1:g.vec3f64.create(),componentIndex:0,
cosAngle:0},ortho:g.vec3f64.create(),fwd:g.vec3f64.create()},p={v0:g.vec3f64.create(),v1:g.vec3f64.create(),v2:g.vec3f64.create()},q={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../materials/internal/MaterialUtil ../../shaders/EdgeRendererPrograms".split(" "),
function(n,a,m,k,h,d,g,l,f,c){Object.defineProperty(a,"__esModule",{value:!0});a.LINE_WIDTH_FRACTION_FACTOR=8;a.EXTENSION_LENGTH_OFFSET=128;var b={type:"uber",slicePlaneEnabled:!1,strokesTexture:null},e=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();n=function(){function k(a,c,f){var g,h,n;this.rctx=
a;this.programRepository=c;this.refCount=new e;this.renderables=new Set;this.sortedRenderables=(g={},g[1]=(h={},h[1]=new d,h[2]=new d,h),g[2]=(n={},n[1]=new d,n[2]=new d,n),g);this.renderablesDirty=!1;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=l.mat3f64.create();this.settings=m({},b,f);this.key=k.getKey(this.settings.type,this.settings.slicePlaneEnabled);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}k.prototype.dispose=function(){for(var a in this.programs){var b=
this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}};k.prototype.addRenderable=function(a){this.renderables.add(a);this.renderablesDirty=!0};k.prototype.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=!0};k.prototype.setRenderablesDirty=function(){this.renderablesDirty=!0};k.prototype.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forEach(a);this.sortedRenderables[b][2].forEach(a)};
k.prototype.bindRegularEdges=function(a,b){this.bind(this.programs.regular,a,b)};k.prototype.bindSilhouetteEdges=function(a,b){this.bind(this.programs.silhouette,a,b)};k.prototype.bind=function(a,b,c){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);
a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3]);a.setUniform1f("uPixelRatio",b.pixelRatio||1)};k.prototype.renderRegularEdges=function(a,b,c){this.render(this.programs.regular,a,a.regular.vao,b,c)};k.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.programs.silhouette,a,a.silhouette.vao,b,c)};k.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);this.rctx.bindVAO(c);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,e)};k.prototype.setUniforms=function(b,
c,d){c.components.buffer.textureBuffer.bind(b,a.componentDataBindParameters);b.setUniformMatrix4fv("uView",d.view);b.setUniformMatrix4fv("uModel",c.transform.modelMatrix);var e=d.viewInvTransp,h=g.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,e);b.setUniform3f("uCameraPosition",e[3],e[7],e[11]);b.setUniformMatrix3fv("uViewToWorldNormalMatrix",h);"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(b);b.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(d.fovY/2)/(d.viewport[3]/
2));b.setUniform3fv("uLocalOrigin",c.transform.origin.vec3);this.settings.slicePlaneEnabled&&f.bindSlicePlane(c.transform.origin.vec3,d.slicePlane,b)};k.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;this.rctx.bindTexture(c,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",h.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);
a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};k.prototype.getOptions=function(a){return m({},a,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.type,slice:this.settings.slicePlaneEnabled})};k.prototype.createPrograms=function(){var a=this.programRepository.getProgram(c.program,this.getOptions({silhouette:!1})),b=this.programRepository.getProgram(c.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(a);
this.programRepository.increaseRefCount(b);this.programs={regular:a,silhouette:b}};k.prototype.sortRenderables=function(){var a=this;this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(function(b){switch(b.objectTransparency){case 1:case 2:switch(b.edgeTransparency){case 1:case 2:a.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)}}});
var b=function(a,b){return a.transform.origin.id<b.transform.origin.id?-1:a.transform.origin.id>b.transform.origin.id?1:0};this.sortedRenderables[1][1].sort(b);this.sortedRenderables[1][2].sort(b);this.sortedRenderables[2][1].sort(b);this.sortedRenderables[2][2].sort(b)};k.getKey=function(a,b){return"edges-t:"+a+":"+b};return k}();a.EdgeRenderer=n;a.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":function(){define(["require",
"exports","./sources/resolver","../../../webgl/programUtils"],function(n,a,m,k){Object.defineProperty(a,"__esModule",{value:!0});var h=function(a){return k.glslifyDefineMap({MODE:{value:a.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:a.silhouette,ANTIALIASING:a.antialiasing,SLICE:a.slice})};a.program={name:"edges",shaders:function(a){return{vertexShader:h(a)+m.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:h(a)+m.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},
attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(n,a,m,k,h,d){function g(a,b){if(!a)return null;var c=a.length/2,d=l*c,c=Array(c),g=0;b=1===b;for(var h=0;h<
a.length;h+=2){var k=(a[h]+a[h+1])/2;b?c[g++]=Math.min(d,1-(1-k)*f):c[g++]=Math.min(d,k*f)}return c}Object.defineProperty(a,"__esModule",{value:!0});a.generateStrokesTexture=function(c){for(var b=a.strokesDefinition.resolution,e=b/2,f=new Uint8Array(4*b*b),l=4*b*e,e=a.strokesDefinition.amplitude,m=2*e,n=4*b,u=k.log2(b)+1,v=a.strokesDefinition.strokes.length,y=(u-1)*v*n,t=0,x=a.strokesDefinition.strokes;t<x.length;t++){for(var z=x[t],A=z.distance,z=z.pressure,E=y,B=0;B<u;B++){0!==B&&(A=g(A,0),z=g(z,
1));for(var G=0;G<a.strokesDefinition.resolution;G++){var F=z?z[G%z.length]:1;h.packFloatRGBA((A?A[G%A.length]/m:0)+.5,f,E);h.packFloatRGBA(F,f,E+l);E+=4}E-=n*(v+1)}y+=n}c=new d(c,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:b,height:b,wrapMode:10497},f);return{resolution:b,texture:c,normalizationScale:m,amplitude:e,variants:v}};var l=.1,f=.5;a.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,
-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,
.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,
.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,
-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,
.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,
.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,
.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,
-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,
-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,
1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,
.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,
-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,
.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,
.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,
.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,
.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,
4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,
3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,
.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,
.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,
.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,
.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,
.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,
1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,
-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,
.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,
2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,
.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,
.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,
.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,
-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,
1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,
.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,
-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,
.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,
.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,
.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,
.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,
4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,
.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,
-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe","../../../../../core/typedArrayUtil"],function(n,a,m,k,h){function d(a){return 0<
a.size*a.color[3]*a.opacity}function g(a,d){var c=m.binaryIndexOf(a,d,!0);return-1===c?d<a[0]?0:a.length:c}Object.defineProperty(a,"__esModule",{value:!0});a.determineRendererType=function(a){for(var f=null,c=0;c<a.length;c++){var b=a[c],e=b.type;if(d(b))if(k.isNone(f))f=e;else if(f!==e)return"uber"}return k.isSome(f)?f:"solid"};a.determineEdgeTransparency=function(a){for(var f=0,c=0;c<a.length;c++){var b=a[c].material;if(d(b)){if(1>b.color[3]*b.opacity)return 1;f=2}}return f};a.determineObjectTransparency=
function(a){for(var f=0,c=0;c<a.length;c++){var b=a[c].material;if(d(b)){switch(b.objectTransparency){case 1:case 0:return 1}f=2}}return f};a.cloneIndices=function(a){if(Uint16Array.from)return h.isUint16Array(a)?Uint16Array.from(a):Uint32Array.from(a);for(var d=h.isUint16Array(a)?new Uint16Array(a.length):new Uint32Array(a.length),c=0;c<a.length;c++)d[c]=a[c];return d};a.estimateLengthAtDistance=function(a,d,c,b){return b/a*c*2*Math.tan(.5*d)};a.findLowerBoundIndex=g;a.computeEdgeCount=function(a,
d,c){return a.length-g(a,d*c.minimumEdgeLength)};a.fillComponenBufferIndices=function(a,d,c,b){for(var e=0;e<a.length;e++){var f=a[e].index,g=d[e],h=d[e+1];if(b)for(;g<h;g++)c.set(b[g],f);else for(;g<h;g++)c.set(g,f)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","./SphericalHarmonics"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d=k.vec3f64.create();
n=function(){function a(){this._renderLighting={main:{intensity:k.vec3f64.create(),direction:k.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight={direction:k.vec3f64.create(),ambient:{color:k.vec3f64.create(),intensity:0},diffuse:{color:k.vec3f64.create(),intensity:0}}}a.prototype.setLightDirectionUniform=function(a){a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)};a.prototype.setUniforms=function(a,
d){void 0===d&&(d=!1);d||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(a);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);d=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",
d.r[0],d.g[0],d.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",d.r[0],d.r[1],d.r[2],d.r[3]),a.setUniform4f("lightingAmbientSH_G",d.g[0],d.g[1],d.g[2],d.g[3]),a.setUniform4f("lightingAmbientSH_B",d.b[0],d.b[1],d.b[2],d.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",d.r[0],d.g[0],d.b[0]),a.setUniform4f("lightingAmbientSH_R1",d.r[1],d.r[2],d.r[3],d.r[4]),a.setUniform4f("lightingAmbientSH_G1",d.g[1],d.g[2],d.g[3],d.g[4]),a.setUniform4f("lightingAmbientSH_B1",d.b[1],d.b[2],
d.b[3],d.b[4]),a.setUniform4f("lightingAmbientSH_R2",d.r[5],d.r[6],d.r[7],d.r[8]),a.setUniform4f("lightingAmbientSH_G2",d.g[5],d.g[6],d.g[7],d.g[8]),a.setUniform4f("lightingAmbientSH_B2",d.b[5],d.b[6],d.b[7],d.b[8]))};a.prototype.set=function(a){this._info=a;h.combineLights(a.lights,this._shOrder,this._renderLighting);m.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);a=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*
a;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*a;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*a;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*a;this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*a;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*a;this._oldSunlight.diffuse.intensity=1;a=m.vec3.copy(d,
this._oldSunlight.diffuse.color);m.vec3.scale(a,a,.4*this._info.globalFactor);m.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,a)};Object.defineProperty(a.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0});return a}();a.SceneLighting=n})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(n,a,m,k,h,d,g){function l(a){return(a+1)*(a+1)}function f(a){return m.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function c(a,b,c){var d=a[0],e=a[1];a=a[2];c=c||[];c.length=l(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*e);2<=b&&(c[4]=1.09254843059*d*e,c[5]=1.09254843059*e*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-e*e));return c}function b(a,b){a=l(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=
0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function e(a,b){for(var e=f(b.r.length),g=0;g<a.length;g++){var h=a[g];k.vec3.negate(y,h.direction);c(y,e,u);d.elementwiseProduct(u,t);d.scalarProduct(u,h.intensity[0],v);d.add(b.r,v);d.scalarProduct(u,h.intensity[1],v);d.add(b.g,v);d.scalarProduct(u,h.intensity[2],v);d.add(b.b,v)}return b}function p(a,b){c(y,0,u);for(var d=0;d<a.length;d++){var e=a[d];b.r[0]+=u[0]*t[0]*e.intensity[0]*4*Math.PI;b.g[0]+=u[0]*t[0]*e.intensity[1]*4*Math.PI;b.b[0]+=u[0]*t[0]*
e.intensity[2]*4*Math.PI}return b}Object.defineProperty(a,"__esModule",{value:!0});a.numberOfCoefficients=l;a.numberOfCoefficientsInBand=function(a){return 2*a+1};a.orderFromNumberOfCoefficients=f;a.computeCoefficients=c;a.initSHCoefficients=b;a.projectFillLights=e;a.projectAmbientLights=p;a.combineLights=function(a,c,f){b(c,f.sphericalHarmonics.sh);k.vec3.set(f.main.intensity,0,0,0);var h=!1,l=q,m=r;c=w;l.length=0;m.length=0;for(var n=c.length=0;n<a.length;n++){var u=a[n];u instanceof g.MainLight&&
!h?(k.vec3.copy(f.main.direction,u.direction),f.main.intensity[0]=u.intensity[0],f.main.intensity[1]=u.intensity[1],f.main.intensity[2]=u.intensity[2],f.main.castShadows=u.castShadows,h=!0):u instanceof g.MainLight||u instanceof g.FillLight?l.push(u):u instanceof g.AmbientLight?m.push(u):u instanceof g.SphericalHarmonicsLight&&c.push(u)}e(l,f.sphericalHarmonics.sh);p(m,f.sphericalHarmonics.sh);for(a=0;a<c.length;a++)u=c[a],d.add(f.sphericalHarmonics.sh.r,u.sh.r),d.add(f.sphericalHarmonics.sh.g,u.sh.g),
d.add(f.sphericalHarmonics.sh.b,u.sh.b)};var q=[],r=[],w=[],u=[0],v=[0],y=h.vec3f64.create(),t=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.dotProduct=function(a,k){for(var h=0,d=0;d<a.length;d++)h+=a[d]*k[d];return h};a.elementwiseProduct=function(a,k,h){h=h||a;h.length=a.length;for(var d=0;d<a.length;d++)h[d]=
a[d]*k[d];return h};a.scalarProduct=function(a,k,h){h=h||a;h.length=a.length;for(var d=0;d<a.length;d++)h[d]=a[d]*k;return h};a.add=function(a,k,h){h=h||a;h.length=a.length;for(var d=0;d<a.length;d++)h[d]=a[d]+k[d];return h}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(n,a){Object.defineProperty(a,"__esModule",{value:!0});a.startMeasurement=function(a){return(a=a.capabilities.disjointTimerQuery)?new m(a):null};a.getTimestamp=function(a,h,d){void 0===d&&(d=50);var g=
a.capabilities.disjointTimerQuery;if(!g||0>=g.timestampBits())return!1;var l=g.createQuery();g.createTimestamp(l);var f=function(){var a=g.resultAvailable(l),b=g.disjoint();a&&!b?(a=g.getResult(l),h(a/1E6)):b?h():setTimeout(f,d)};f();return!0};a.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;if(!a)return!1;a=a.timestampBits();console.log({bits:a});return 0<a};var m=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=
function(a,d){void 0===d&&(d=50);this.cb=a;this.checkInterval=d;this.timer.endTimeElapsed();this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=this.timer.resultAvailable(this.query),d=this.timer.disjoint();a&&!d?(a=this.timer.getResult(this.query),this.cb(a/1E6)):d?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return a}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","../../../../core/compilerUtils","./Util"],
function(n,a,m,k){var h=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;k.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();n=function(){function a(a,d){this._textureRep=a;this._programRep=d;this._id2glMaterialRef=new Map}a.prototype.acquire=function(a,d){var c=a.id+"_"+d,b=this._id2glMaterialRef.get(c);
null==b?(a=(b=a.getGLMaterials()[d])?new b({material:a,programRep:this._programRep,textureRep:this._textureRep}):void 0,b=new h(a),this._id2glMaterialRef.set(c,b)):a=b.getGLMaterial();b.incRefCnt();a&&this.increaseProgramReferences(a);return a};a.prototype.release=function(a,d){a=a+"_"+d;d=this._id2glMaterialRef.get(a);d.decRefCnt();if(0===d.getRefCnt()){if(d=d.getGLMaterial())this.decreaseProgramReferences(d),d.dispose();this._id2glMaterialRef.delete(a)}};a.prototype.updateMaterialParameters=function(a){for(var f=
0,c=d;f<c.length;f++){var b=this._id2glMaterialRef.get(a+"_"+c[f]);b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial())}};a.prototype.updateParamsForMat=function(a){a.updateParameters&&(this.decreaseProgramReferences(a),a.updateParameters(),this.increaseProgramReferences(a))};a.prototype.increaseProgramReferences=function(a){a=a.getPrograms();for(var d=this._programRep,c=0;c<a.length;c++)d.increaseRefCount(a[c])};a.prototype.decreaseProgramReferences=function(a){a=a.getPrograms();for(var d=
this._programRep,c=0;c<a.length;c++)d.decreaseRefCount(a[c])};return a}();var d=m.tuple("color","depth","depthShadowMap","normal","highlight");return n})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util","../../../webgl/programUtils"],function(n,a,m,k){return function(){function a(a,g){void 0===g&&(g="");this._rctx=a;this._shaderPrefix=g;this._programCacheByTemplate=new Map;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],
proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}a.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._rctx=this._commonUniforms=this._programRefCount=this._programCacheByTemplate=null};a.prototype.getProgram=function(a,g){var d=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(f){return k.createProgram(d._rctx,a,f,d._shaderPrefix)});return this.getProgramTemplateInstance(a,
g)};a.prototype.addProgramTemplate=function(a,g){this._programCacheByTemplate.set(a,{constructor:g,programs:new Map})};a.prototype.getProgramTemplateInstance=function(a,g){if(a=this._programCacheByTemplate.get(a)){var d=g?JSON.stringify(g):"default";a.programs.has(d)||(g=a.constructor(g),a.programs.set(d,g));return a.programs.get(d)}return null};a.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};a.prototype.increaseRefCount=function(a){var d=a.id;this._programRefCount[d]?
this._programRefCount[d]++:(this._programRefCount[d]=1,this._findCommonUniforms(a))};a.prototype.decreaseRefCount=function(a){var d=a.id;1<this._programRefCount[d]?this._programRefCount[d]--:(this._forgetCommonUniforms(a),this._programRefCount[d]=0)};a.prototype._findCommonUniforms=function(a){for(var d in this._commonUniforms)a.hasUniform(d)&&(m.assert(-1===this._commonUniforms[d].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[d].push(a))};a.prototype._forgetCommonUniforms=
function(a){for(var d in this._commonUniforms){var h=this._commonUniforms[d],f=h.indexOf(a);-1<f&&(h[f]=h[h.length-1],h.pop())}};return a}()})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define(["require","exports","../../../../core/Logger","./Util","../../../webgl/Texture"],function(n,a,m,k,h){var d=m.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");n=function(){function a(a,d,c,b,e){this.NUM_PARALLEL=8;this._fallbackTextureTransparent=this._fallbackTexture=null;this.textures=
a;this._programRepository=d;this.getViewportToRestore=c;this.onNewlyTexturesLoaded=e;this._rctx=b;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=b.capabilities.textureFilterAnisotropic)?b.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=
255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8};this.onNewlyTexturesLoaded()}a.prototype.acquire=function(g,f,c){var b=this,e=this.id2textureRef[g];if(null==e){var h=this.textures.get(g);k.assert(void 0!==h);h.setUnloadFunc(this._unload.bind(this));f=!0===f;var l=this._createGLTextureDescription(h),e=new a.TextureRef(null);k.assert(null==this.id2textureRef[g]);this.id2textureRef[g]=
e;if(h.initializeThroughRender)g=h.initializeThroughRender(this._rctx,l),e.setGLTexture(g),c&&c(e);else if(h.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(g,l,c):this._queue.push([g,l,c]);else try{h.initializeThroughUpload(this._rctx,l,this._programRepository,this.getViewportToRestore(),function(a){e.setGLTexture(a);b.onNewlyTexturesLoaded();c&&c(e)})}catch(r){d.error("#acquire","Error loading texture: "+r.toString())}null==e.getGLTexture()&&e.setGLTexture(f?this.fallbackTextureTransparent:
this.fallbackTexture);this.onNewlyTexturesLoaded()}e.incRefCnt();return e};a.prototype.release=function(a){a=this.id2textureRef[a];void 0!==a&&(a.decRefCnt(),k.assert(0<=a.getRefCnt()))};a.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};a.prototype.getTexture=function(a){return this.textures.get(a)};a.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};a.prototype._unload=function(a){var d=this.id2textureRef[a];void 0!==d&&((d=d.getGLTexture())&&d!==this.fallbackTextureTransparent&&
d!==this.fallbackTexture&&d.dispose(),delete this.id2textureRef[a]);this.next(a)};a.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrap}};a.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var d=Object.keys(this.id2textureRef),c=Object.keys(this.loading);this.listeners.forEach(function(b){b(a,
d,c)});this.processQueue()}};a.prototype._loadImage=function(a,d,c){var b=this;k.assert(null==this.loading[a]);this.loading[a]=!0;var e=this.textures.get(a);k.assert(void 0!==e);setTimeout(function(){var f=b.id2textureRef[a];f&&f.getRefCnt()&&e.initializeThroughUpload(b._rctx,d,b._programRepository,b.getViewportToRestore(),function(d){b.next(a);b.onNewlyTexturesLoaded();f&&f.getRefCnt()&&(f.setGLTexture(d),c&&c(f))})},0)};a.prototype.processQueue=function(){for(var a=[],d=0;d<this._queue.length;++d){var c=
this._queue[d][0],b=this.id2textureRef[c];void 0!==b&&(0===b.getRefCnt()?(b.getGLTexture().dispose(),delete this.id2textureRef[c]):a.push(this._queue[d]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(d=0;d<a;++d)this._loadImage(this._queue[d][0],this._queue[d][1],this._queue[d][2]);this._queue.splice(0,a)};Object.defineProperty(a.prototype,"fallbackTexture",{get:function(){this._fallbackTexture||(this._fallbackTexture=new h(this._rctx,this._fallbackTextureDesc,
this._fallbackTextureData));return this._fallbackTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fallbackTextureTransparent",{get:function(){this._fallbackTextureTransparent||(this._fallbackTextureTransparent=new h(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return a}();(function(a){var d=function(){function a(a){this._glTexture=null;this._refCount=0;this._glTexture=
a}a.prototype.incRefCnt=function(){++this._refCount};a.prototype.decRefCnt=function(){--this._refCount;k.assert(0<=this._refCount)};a.prototype.getRefCnt=function(){return this._refCount};a.prototype.setGLTexture=function(a){this._glTexture=a};a.prototype.getGLTexture=function(){return this._glTexture};return a}();a.TextureRef=d})(n||(n={}));return n})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){Object.defineProperty(a,"__esModule",{value:!0});n=function(a){function e(b,c,d,e,f){void 0===e&&(e=null);void 0===f&&(f=!0);var g=a.call(this)||this;g._rctx=b;g._renderScene=c;g._requestRenderScene=d;g._renderOverlay=e;g.supersample=f;g._screenshotQueue=[];return g}k(e,a);e.prototype.dispose=function(){this._rctx=null};e.prototype.takeScreenshot=function(a){var b=this;this._requestRenderScene();var c=g.createResolver(function(){b._screenshotQueue=b._screenshotQueue.filter(function(a){return a.resolver!==
c})});this._screenshotQueue.push({settings:a,resolver:c});return c.promise};e.prototype.update=function(a){if(0!==this._screenshotQueue.length){for(var b=0,d=this._screenshotQueue;b<d.length;b++){var e=d[b];if(this.isDisposed)e.resolver.reject();else{var f=m({},e.settings,{pixelRatio:e.settings.pixelRatio*a.viewCamera.pixelRatio}),g=this._ensureScreenshotEncodeCanvas(),h=this._renderScreenshot(a,f),f=c.encodeResult(h,f,g,{flipY:!0,premultipliedAlpha:!0});e.resolver(f)}}this._screenshotQueue=[]}};
e.prototype._renderScreenshotOverlay=function(a,b,c){if(!d.isNone(this._renderOverlay)){a.width=b.width;a.height=b.height;var e=a.getContext("2d"),f=c.pixelRatio;e.save();e.translate(0,b.height);e.scale(1,-1);c.region&&e.translate(-c.region.x,-c.region.y);e.scale(f,f);this._renderOverlay(a,b);e.restore()}};e.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};e.prototype._readbackScreenshotResampled=function(a){var b=
a.framebufferWidth,d=a.framebufferHeight,e=a.region,f=a.resample,g=this._ensureScreenshotEncodeCanvas(),h=c.createEmptyImageData(b,d,g);this._rctx.gl.readPixels(0,0,b,d,6408,5121,new Uint8Array(h.data.buffer));this._renderScreenshotOverlay(g,h,m({},a,{region:null}));a=c.createEmptyImageData(e.width,e.height,g);return c.resampleHermite(h,a,!0,f.region.x,d-(f.region.y+f.region.height),f.region.width,f.region.height)};e.prototype._readbackScreenshotImmediate=function(a){var b=a.framebufferHeight,d=a.region,
e=this._ensureScreenshotEncodeCanvas(),f=c.createEmptyImageData(d.width,d.height,e);this._rctx.gl.readPixels(d.x,b-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(f.data.buffer));this._renderScreenshotOverlay(e,f,a);return f};e.prototype._renderScreenshot=function(a,c){var d=null,e=a.viewCamera,f=c.framebufferWidth,g=c.framebufferHeight,h=!1,k=a.frameHasSlicePlane&&c.disableSlice;if(k=f!==e.fullWidth||g!==e.fullHeight||k){var l=e.clone();l.fullWidth=f;l.fullHeight=g;l.pixelRatio=c.pixelRatio;
d=e.fovX-l.fovX;h=e.fovY-l.fovY;0>d&&d<h?l.fovX=e.fovX:0>h&&h<d&&(l.fovY=e.fovY);a.drapedRenderer.forceUpdate&&a.drapedRenderer.forceUpdate(l);h=!0;d=new b(this._rctx,{width:l.fullWidth,height:l.fullHeight,colorTarget:0,depthStencilTarget:3});this._renderScene(d,l,c.disableSlice)}c=this._readbackScreenshot(c);if(k&&!this._rctx.contextAttributes.alpha)for(k=3;k<c.data.length;k+=4)c.data[k]=255;d&&d.dispose();this._rctx.bindFramebuffer(null);h&&a.drapedRenderer.forceUpdate&&a.drapedRenderer.forceUpdate(e);
return c};e.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return e=h([l.subclass("esri.views.3d.webgl-engine.parts.ScreenshotManager")],e)}(l.declared(f.AutoDisposable));a.ScreenshotManager=n})},"esri/views/3d/webgl-engine/shaders/globalOptions":function(){define(["require","exports","../../../webgl/programUtils"],function(n,a,m){Object.defineProperty(a,"__esModule",
{value:!0});a.glslifyGlobalOptions=function(a){return m.glslifyDefineMap({VIEWING_MODE:{value:a.viewingMode,options:{global:"VIEWING_MODE_GLOBAL",local:"VIEWING_MODE_LOCAL"}}})}})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error","../../core/has"],function(n,a,m,k,h){Object.defineProperty(a,"__esModule",{value:!0});var d={supportsMajorWebPerformanceCaveat:!1};a.check=function(a){a=m({},d,a);return h("esri-webgl")?
!a.supportsMajorWebPerformanceCaveat&&h("esri-webgl-major-performance-caveat")?new k("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):h("esri-webgl-high-precision-fragment")?h("esri-webgl-vertex-shader-samplers")?h("esri-webgl-element-index-uint")?h("esri-webgl-standard-derivatives")?h("esri-webgl-instanced-arrays")?null:new k("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):
new k("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new k("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new k("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new k("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new k("webgl:required",
"WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(n,a,m,k,h,d){return function(a){function d(d){d=a.call(this)||this;d.components=["attribution","zoom","navigation-toggle","compass"];return d}m(d,a);k([h.property()],d.prototype,"components",void 0);return d=k([h.subclass("esri.views.ui.3d.DefaultUI3D")],
d)}(h.declared(d))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){return function(a){function l(b){b=a.call(this)||this;b._defaultPositionLookup={attribution:"manual",compass:"top-leading",
"navigation-toggle":"top-leading",zoom:"top-leading"};b.components=[];return b}m(l,a);l.prototype.initialize=function(){this._handles.add([h.init(this,"components",this._componentsWatcher.bind(this)),h.init(this,"view",this._updateViewAwareWidgets.bind(this))])};l.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};l.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&
void 0!==c.view&&c.set("view",a)})};l.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};l.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};l.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._defaultPositionLookup[a])})};l.prototype._createComponent=function(a){var b=this._createWidget(a);
if(b)return new g({id:a,node:b})};l.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};l.prototype._createAttribution=function(){return new f({view:this.view})};l.prototype._createCompass=function(){return new c({view:this.view})};l.prototype._createNavigationToggle=function(){return new b({view:this.view})};
l.prototype._createZoom=function(){return new e({view:this.view})};k([d.property()],l.prototype,"components",void 0);return l=k([d.subclass("esri.views.ui.DefaultUI")],l)}(d.declared(l))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d,g){return function(a){function f(){var c=null!==a&&a.apply(this,
arguments)||this;c.widget=null;return c}m(f,a);f.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(f.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&a.classList.add("esri-component"),b&&b.classList.remove("esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});
f.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),d.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};k([g.property()],f.prototype,"id",null);k([g.property()],f.prototype,"node",null);k([g.cast("node")],f.prototype,"castNode",null);k([g.property({readOnly:!0})],f.prototype,"widget",void 0);return f=k([g.subclass("esri.views.ui.Component")],
f)}(g.declared(h))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){function p(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(b)||"declaredClass"in a||!("component"in
a||"index"in a||"position"in a)?null:a}function q(a,b){var c=b.bottom,d=b.left,e=b.right;a.style.top=b.top;a.style.bottom=c;a.style.left=d;a.style.right=e}var r={left:0,top:0,bottom:0,right:0},w={bottom:30,top:15,right:15,left:15};return function(a){function g(b){b=a.call(this)||this;b._cornerNameToContainerLookup={};b._positionNameToContainerLookup={};b._components=[];b._handles=new l;b._componentToKey=new Map;b.view=null;b._initContainers();return b}k(g,a);g.prototype.initialize=function(){this._handles.add([f.init(this,
"view.padding, container",this._applyViewPadding.bind(this)),f.init(this,"padding",this._applyUIPadding.bind(this))])};g.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(g.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(a.classList.add("esri-ui"),this._attachContainers(a)),b&&(b.classList.remove("esri-ui"),
q(b,{top:"",bottom:"",left:"",right:""}),d.empty(b)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},enumerable:!0,
configurable:!0});g.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:m({},w,a)};Object.defineProperty(g.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});g.prototype.add=function(a,c){var d=this,e,f;if(Array.isArray(a))a.forEach(function(a){return d.add(a,c)});else{var g=p(a);g&&(e=g.index,c=g.position,a=g.component,f=g.key);
c&&"object"===typeof c&&(e=c.index,f=c.key,c=c.position);!a||c&&!this._isValidPosition(c)||(a&&a.isInstanceOf&&a.isInstanceOf(b)||(a=new b({node:a})),this._place({component:a,position:c,index:e}),this._components.push(a),f&&this._componentToKey.set(a,f))}};g.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};g.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!a.classList.contains("esri-ui-corner")}).map(function(a){return b.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};g.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=p(a)||p(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};g.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(b)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};g.prototype._getViewPadding=function(){return this.get("view.padding")||
r};g.prototype._attachContainers=function(a){a.appendChild(this._innerContainer);a.appendChild(this._manualContainer)};g.prototype._initContainers=function(){var a=document.createElement("div");a.classList.add("esri-ui-inner-container");a.classList.add("esri-ui-corner-container");var b=document.createElement("div");b.classList.add("esri-ui-inner-container");b.classList.add("esri-ui-manual-container");var c=document.createElement("div");c.classList.add("esri-ui-top-left");c.classList.add("esri-ui-corner");
a.appendChild(c);var d=document.createElement("div");d.classList.add("esri-ui-top-right");d.classList.add("esri-ui-corner");a.appendChild(d);var f=document.createElement("div");f.classList.add("esri-ui-bottom-left");f.classList.add("esri-ui-corner");a.appendChild(f);var g=document.createElement("div");g.classList.add("esri-ui-bottom-right");g.classList.add("esri-ui-corner");a.appendChild(g);this._innerContainer=a;this._manualContainer=b;a=e.isRTL();this._cornerNameToContainerLookup={"top-left":c,
"top-right":d,"bottom-left":f,"bottom-right":g,"top-leading":a?d:c,"top-trailing":a?c:d,"bottom-leading":a?g:f,"bottom-trailing":a?f:g};this._positionNameToContainerLookup=m({manual:b},this._cornerNameToContainerLookup)};g.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};g.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];var e=-1<c,f=b.widget;f&&!f._started&&"function"===typeof f.postMixInProperties&&
"function"===typeof f.buildRendering&&"function"===typeof f.postCreate&&"function"===typeof f.startup&&b.widget.startup();e?(e=Array.prototype.slice.call(a.children),0===c?a.firstChild?d.insertBefore(b.node,a.firstChild):a.appendChild(b.node):c>=e.length?a.appendChild(b.node):d.insertBefore(b.node,e[c])):a.appendChild(b.node)};g.prototype._applyViewPadding=function(){var a=this.container;a&&q(a,this._toPxPosition(this._getViewPadding()))};g.prototype._applyUIPadding=function(){var a=this._innerContainer;
a&&q(a,this._toPxPosition(this.padding))};g.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};g.prototype._toPxUnit=function(a){return 0===a?"0":a+"px"};g.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=d===a)&&(b=d);return c});return b};g.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});
return b};g.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};h([c.property()],g.prototype,"container",null);h([c.property({dependsOn:["view.height"]})],g.prototype,"height",null);h([c.property({value:w})],g.prototype,"padding",null);h([c.cast("padding")],g.prototype,"castPadding",null);h([c.property()],g.prototype,"view",void 0);h([c.property({dependsOn:["view.width"]})],g.prototype,"width",null);return g=h([c.subclass("esri.views.ui.UI")],
g)}(c.declared(g.EventedAccessor))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(n,a,m,k,h,d,g,l,f,c){return function(a){function b(b){b=a.call(this)||this;b._isOpen=!1;b._attributionTextOverflowed=!1;b._prevSourceNodeHeight=0;b.iconClass=
"esri-icon-description";b.itemDelimiter=" | ";b.label=h.widgetLabel;b.view=null;b.viewModel=new f;return b}m(b,a);b.prototype.postInitialize=function(){var a=this;this.own(d.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(b.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});b.prototype.render=function(){var a,
b=(a={},a["esri-attribution--open"]=this._isOpen,a);return c.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),c.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",c.tsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri")))};b.prototype._renderSourcesNode=function(){var a,b=this._isOpen,d=this._isInteractive(),
e=d?0:-1,f=this.attributionText,g=d?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=d,a);return c.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:f,role:g,tabIndex:e})};b.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};b.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=
a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};b.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};b.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};k([g.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),c.renderable()],
b.prototype,"attributionText",null);k([g.property()],b.prototype,"iconClass",void 0);k([g.property(),c.renderable()],b.prototype,"itemDelimiter",void 0);k([g.property()],b.prototype,"label",void 0);k([g.aliasOf("viewModel.view")],b.prototype,"view",void 0);k([g.property({type:f}),c.renderable(["state","view.size"])],b.prototype,"viewModel",void 0);k([c.accessibleHandler()],b.prototype,"_toggleState",null);return b=k([g.subclass("esri.widgets.Attribution")],b)}(g.declared(l))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/generatorHelper ../../geometry ../../core/arrayUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){function r(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})}function w(a,b,c){c&&b&&(l.find(a,function(a){return a.layerView===b&&a.text===c})||a.push({text:c,layerView:b}))}var u=[];return function(a){function c(c){var d=a.call(this,c)||this;d.clear=function(){d._fetchedAttributionData.clear();d._pendingAttributions.clear();d.handles.remove("suspension");d.notifyChange("state")};d._pendingAttributions=new Set;d._fetchedAttributionData=
new Map;d.items=new f;d.view=null;d._allLayerViewsChange=function(a){d.handles.remove("suspension");var b=d.get("view.allLayerViews");b&&d.handles.add(b.map(function(a){return a.watch(["suspended","attributionVisible"],d._updateAttributionItems)}),"suspension");a&&a.removed&&a.removed.forEach(function(a){d._pendingAttributions.delete(a);d._fetchedAttributionData.delete(a)});d._updateAttributionItems()};d._updateAttributionItems=function(){var a=d.get("view.allLayerViews");u.length=0;a?(a.forEach(function(a){if(!a.suspended&&
a.get("layer.attributionVisible")){var b=a.layer;if(b&&"function"===typeof b.originOf&&"user"===b.originOf("copyright"))w(u,a,b.copyright);else if(b.hasAttributionData)if(d._fetchedAttributionData.has(a)){var c=d._fetchedAttributionData.get(a);c&&w(u,a,d._getDynamicAttribution(c,d.view,b))}else d._fetchAttributionData(a);else(c=b.get("portalItem.accessInformation"))?w(u,a,c):w(u,a,b.copyright)}}),r(d.items,u)&&(d.items.removeAll(),d.items.addMany(u)),d.notifyChange("state")):d.clear()};d.handles.add([b.on(d,
"view.allLayerViews","change",d._allLayerViewsChange,d._allLayerViewsChange,d.clear),b.whenTrue(d,"view.stationary",function(){return d._updateAttributionItems()})]);return d}m(c,a);c.prototype.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear()};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"},enumerable:!0,configurable:!0});c.prototype._fetchAttributionData=
function(a){return h(this,void 0,void 0,function(){var b,c;return d(this,function(d){switch(d.label){case 0:if(this._pendingAttributions.has(a))return[2];this._pendingAttributions.add(a);b=null;d.label=1;case 1:return d.trys.push([1,3,,4]),[4,a.layer.fetchAttributionData()];case 2:return c=d.sent(),b=this._createContributionIndex(c,"bing-maps"===a.layer.type),[3,4];case 3:return d.sent(),[3,4];case 4:return this._pendingAttributions.has(a)&&(this._pendingAttributions.delete(a),this._fetchedAttributionData.set(a,
b)),this._updateAttributionItems(),[2]}})})};c.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var d=0;d<a.length;d++){var e=a[d],f=e.coverageAreas;if(!f)return;for(var h=0;h<f.length;h++)for(var k=f[h],l=k.bbox,m=k.zoomMin-(b&&k.zoomMin?1:0),n=k.zoomMax-(b&&k.zoomMax?1:0),k={extent:q.geographicToWebMercator({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:g.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=k.score?k.score:100,
id:d};m<=n;m++)c[m]=c[m]||[],c[m].push(k)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};c.prototype._getDynamicAttribution=function(a,b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=q.project(d.center.clone().normalize(),b.spatialReference),f={};return a?a.filter(function(a){var b=!f[a.id]&&e&&p.extentContainsPoint(a.extent,e);b&&(f[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-
b.objectId}).map(function(a){return a.attribution}).join(", "):""};k([e.property({readOnly:!0,type:f})],c.prototype,"items",void 0);k([e.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);k([e.property()],c.prototype,"view",void 0);return c=k([e.subclass("esri.widgets.Attribution.AttributionViewModel")],c)}(e.declared(c.HandleOwner))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(n,a,m,k,h,d,g,l,f){return function(a){function b(b){b=a.call(this)||this;b.goToOverride=null;b.iconClass="esri-icon-locate-circled";b.label=h.widgetLabel;b.view=null;b.viewModel=new l;return b}m(b,a);b.prototype.reset=function(){};b.prototype.render=function(){var a,b,c=this.viewModel,d=c.orientation,c=c.state,g="disabled"===c,k="compass"===("rotation"===c?"rotation":"compass"),c=g?-1:0,g=(a={},a["esri-disabled"]=g,a["esri-interactive"]=!g,a);a=(b={},b["esri-icon-compass"]=k,b["esri-icon-dial"]=
!k,b);return f.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",g),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:c,"aria-label":h.reset,title:h.reset},f.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(d)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},h.reset))};b.prototype._reset=function(){this.viewModel.reset()};b.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+
a.z+"deg)"}};k([d.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);k([d.property()],b.prototype,"iconClass",void 0);k([d.property()],b.prototype,"label",void 0);k([d.aliasOf("viewModel.view")],b.prototype,"view",void 0);k([d.property({type:l}),f.renderable(["viewModel.orientation","viewModel.state"])],b.prototype,"viewModel",void 0);k([d.aliasOf("viewModel.reset")],b.prototype,"reset",null);k([f.accessibleHandler()],b.prototype,"_reset",null);return b=k([d.subclass("esri.widgets.Compass")],
b)}(d.declared(g))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),function(n,a,m,k,h,d,g,l,f){return function(a){function b(b){b=a.call(this,b)||this;b._handles=new d;b.orientation={x:0,y:0,z:0};b.view=null;b._updateForCamera=b._updateForCamera.bind(b);b._updateForRotation=
b._updateForRotation.bind(b);b._updateRotationWatcher=b._updateRotationWatcher.bind(b);b.view;return b}m(b,a);b.prototype.initialize=function(){this._handles.add(g.init(this,"view",this._updateRotationWatcher))};b.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(b.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return!(!a||!a.isWebMercator&&!a.isGeographic)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});b.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};b.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};b.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};b.prototype._updateRotationWatcher=function(a){this._handles.removeAll();
a&&("2d"===a.type?this._handles.add(g.init(this,"view.rotation",this._updateForRotation)):this._handles.add(g.init(this,"view.camera",this._updateForCamera)))};k([l.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],b.prototype,"canShowNorth",null);k([l.property()],b.prototype,"orientation",void 0);k([l.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],b.prototype,"state",null);k([l.property()],b.prototype,"view",void 0);k([l.property()],
b.prototype,"reset",null);return b=k([l.subclass("esri.widgets.CompassViewModel")],b)}(l.declared(f.GoToMixin(h)))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),function(n,a,m,k,h,d,g,l,f){return function(a){function b(b){b=a.call(this)||
this;b.iconClass="esri-icon-pan2";b.label=h.widgetLabel;b.view=null;b.viewModel=new l;return b}m(b,a);Object.defineProperty(b.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});b.prototype.toggle=function(){};b.prototype.render=function(){var a,b,c,d="disabled"===this.get("viewModel.state"),g="pan"===this.get("viewModel.navigationMode"),k=(a={},a["esri-disabled"]=d,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,
a);a=(b={},b["esri-navigation-toggle__button--active"]=g,b);b=(c={},c["esri-navigation-toggle__button--active"]=!g,c);c=d?-1:0;return f.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",k),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":h.toggle,title:h.toggle},f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",a)},f.tsx("span",{class:"esri-icon-pan"})),f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",b)},f.tsx("span",{class:"esri-icon-rotate"})))};b.prototype._toggle=function(){this.toggle()};k([d.property()],b.prototype,"iconClass",void 0);k([d.property()],b.prototype,"label",void 0);k([d.property({value:"vertical"}),f.renderable()],b.prototype,"layout",null);k([d.aliasOf("viewModel.view"),f.renderable()],b.prototype,"view",void 0);k([d.property({type:l}),f.renderable(["viewModel.state","viewModel.navigationMode"])],b.prototype,"viewModel",void 0);k([d.aliasOf("viewModel.toggle")],
b.prototype,"toggle",null);k([f.accessibleHandler()],b.prototype,"_toggle",null);return b=k([d.subclass("esri.widgets.NavigationToggle")],b)}(d.declared(g))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d,g,l){return function(a){function c(b){b=
a.call(this,b)||this;b._handles=new d;b.navigationMode="pan";b.view=null;b.toggle=b.toggle.bind(b);return b}m(c,a);c.prototype.initialize=function(){this._handles.add(g.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};c.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0});c.prototype.toggle=
function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};c.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};k([l.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);k([l.property()],c.prototype,"navigationMode",void 0);k([l.property()],c.prototype,"view",void 0);k([l.property()],c.prototype,"toggle",null);return c=k([l.subclass("esri.widgets.NavigationToggleViewModel")],
c)}(l.declared(h))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(n,a,m,k,h,d,g,l,f,c){return function(a){function b(b){b=a.call(this)||this;b.iconClass="esri-icon-zoom-in-magnifying-glass";b.label=h.widgetLabel;b.view=null;b.viewModel=new f;return b}m(b,a);b.prototype.postInitialize=
function(){this._zoomInButton=new l({action:this.zoomIn,iconClass:"esri-icon-plus",title:h.zoomIn});this._zoomOutButton=new l({action:this.zoomOut,iconClass:"esri-icon-minus",title:h.zoomOut})};Object.defineProperty(b.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});b.prototype.render=function(){var a,b=this.viewModel,d=(a={},a["esri-zoom--horizontal"]="horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&
b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return c.tsx("div",{class:this.classes("esri-zoom esri-widget",d)},this._zoomInButton.render(),this._zoomOutButton.render())};b.prototype.zoomIn=function(){};b.prototype.zoomOut=function(){};k([d.property()],b.prototype,"iconClass",void 0);k([d.property()],b.prototype,"label",void 0);k([d.property({value:"vertical"}),c.renderable()],b.prototype,"layout",null);k([d.aliasOf("viewModel.view"),c.renderable()],b.prototype,"view",void 0);
k([d.property({type:f}),c.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],b.prototype,"viewModel",void 0);k([d.aliasOf("viewModel.zoomIn")],b.prototype,"zoomIn",null);k([d.aliasOf("viewModel.zoomOut")],b.prototype,"zoomOut",null);return b=k([d.subclass("esri.widgets.Zoom")],b)}(d.declared(g))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(n,a,m,k,h,d,g){return function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;c.enabled=!0;c.iconClass="";c.title="";return c}m(d,a);d.prototype.render=function(){var a,b,d=this.enabled?0:-1,f=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return g.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",f),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:d,
title:this.title},g.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),g.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};d.prototype._triggerAction=function(){this.action.call(this)};k([h.property()],d.prototype,"action",void 0);k([h.property(),g.renderable()],d.prototype,"enabled",void 0);k([h.property(),g.renderable()],d.prototype,"iconClass",void 0);k([h.property(),g.renderable()],d.prototype,"title",void 0);k([g.accessibleHandler()],d.prototype,
"_triggerAction",null);return d=k([h.subclass("esri.widgets.IconButton")],d)}(h.declared(d))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(n,a,m,k,h,d,g,l){return function(a){function c(b){b=a.call(this,b)||this;b.canZoomIn=!1;b.canZoomOut=!1;b.zoomIn=b.zoomIn.bind(b);b.zoomOut=b.zoomOut.bind(b);
return b}m(c,a);c.prototype.destroy=function(){this.view=null};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new g({view:a}):"3d"===a.type&&(this._zoomConditions=new l({view:a})):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});c.prototype.zoomIn=function(){if(this.canZoomIn){var a=
this.view;"2d"===a.type?a.mapViewNavigation.zoomIn():a.goTo({zoomFactor:2})}};c.prototype.zoomOut=function(){if(this.canZoomOut){var a=this.view;"2d"===a.type?a.mapViewNavigation.zoomOut():a.goTo({zoomFactor:.5})}};k([d.property()],c.prototype,"_zoomConditions",void 0);k([d.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],c.prototype,"canZoomIn",void 0);k([d.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],c.prototype,"canZoomOut",void 0);k([d.property({dependsOn:["view.ready"],
readOnly:!0})],c.prototype,"state",null);k([d.property()],c.prototype,"view",null);k([d.property()],c.prototype,"zoomIn",null);k([d.property()],c.prototype,"zoomOut",null);return c=k([d.subclass("esri.widgets.Zoom.ZoomViewModel")],c)}(d.declared(h))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d){return function(a){function g(){return null!==
a&&a.apply(this,arguments)||this}m(g,a);Object.defineProperty(g.prototype,"canZoomIn",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMaxScale");return 0===c||a>c},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"canZoomOut",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMinScale");
return 0===c||a<c},enumerable:!0,configurable:!0});k([d.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],g.prototype,"canZoomIn",null);k([d.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],g.prototype,"canZoomOut",null);k([d.property()],g.prototype,"view",void 0);return g=k([d.subclass("esri.widgets.Zoom.ZoomConditions2D")],g)}(d.declared(h))})},
"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(n,a,m,k,h,d){return function(a){function g(){return null!==a&&a.apply(this,arguments)||this}m(g,a);Object.defineProperty(g.prototype,"canZoomIn",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"canZoomOut",
{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});k([d.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"canZoomIn",null);k([d.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"canZoomOut",null);k([d.property()],g.prototype,"view",void 0);return g=k([d.subclass("esri.widgets.Zoom.ZoomConditions3D")],g)}(d.declared(h))})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(n,a,
m,k){var h=null,d;d=n(null,{constructor:function(){m.subscribe("publishData",a.hitch(this,this.onDataPublished));m.subscribe("fetchData",a.hitch(this,this.onFetchData));m.subscribe("clearAllData",a.hitch(this,this.onClearAllData));m.subscribe("removeData",a.hitch(this,this.onRemoveData));m.subscribe("clearDataHistory",a.hitch(this,this.onClearDataHistory));this.widgetManager=k.getInstance()},_dataStore:{},onDataPublished:function(a,d,f,c){"undefined"===typeof c&&(c=!1);this._dataStore[d]?(this._dataStore[d].current=
f,c&&(this._dataStore[d].history?this._dataStore[d].history.push(f):this._dataStore[d].history=[f])):(this._dataStore[d]={current:f},c&&(this._dataStore[d].history=[f]))},onFetchData:function(a){var d;if(a)"framework"===a?this._dataStore[a]?m.publish("dataFetched","framework","framework",this._dataStore[a].current,this._dataStore[a].history):m.publish("noData","framework","framework"):(d=this.widgetManager.getWidgetById(a))?this._dataStore[a]?m.publish("dataFetched",d.name,a,this._dataStore[a].current,
this._dataStore[a].history):m.publish("noData",d.name,a):m.publish("noData",void 0,a);else for(var f in this._dataStore)(d=this.widgetManager.getWidgetById(f))&&m.publish("dataFetched",d.name,f,this._dataStore[f].current,this._dataStore[f].history)},onClearAllData:function(){this._dataStore={};m.publish("allDataCleared")},onRemoveData:function(a){delete this._dataStore[a];m.publish("dataRemoved",a)},onClearDataHistory:function(a){this._dataStore[a]&&(this._dataStore[a].history=[]);m.publish("dataHistoryCleared",
a)}});d.getInstance=function(){null===h&&(h=new d);return h};return d})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(n,a,m,k,h,d,g,l,f){return n([d,g],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,
name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(h.subscribe("publishData",a.hitch(this,this._onReceiveData)));this.own(h.subscribe("dataFetched",a.hitch(this,this._onReceiveData)));this.own(h.subscribe("noData",a.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},
onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(a,b){this.position=a;var c=l.getPositionStyle(this.position);c.position="absolute";b||(b="map"===a.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);k.place(this.domNode,b);k.setStyle(this.domNode,c);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return k.getMarginBox(this.domNode)},
setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,b,d){},onAction:function(a,b){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return f.getInstance().getPanelById(this.id+"_panel");var a=f.getInstance().getPanelById(this.gid+"_panel");return a?a:f.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,b){"undefined"===
typeof b&&(b=!1);h.publish("publishData",this.name,this.id,a,b)},fetchData:function(a){a?h.publish("fetchData",a):0!==this.listenWidgetIds.length?m.forEach(this.listenWidgetIds,function(a){h.publish("fetchData",a)},this):h.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);m.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},_onReceiveData:function(a,b,d,f){if(b!==this.id&&!(0!==this.listenWidgetIds.length&&
0>this.listenWidgetIds.indexOf(b)))this.onReceiveData(a,b,d,f)},onReceiveData:function(a,b,d,f){},_onNoData:function(a,b){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onNoData(a,b)},onNoData:function(a,b){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,
e,p){var q,r=null;q=n(null,{constructor:function(){this.panels=[];this.widgetManager=p.getInstance();l(window,"resize",a.hitch(this,this.onWindowResize));this.activePanel=null;f.subscribe("/dnd/move/start",a.hitch(this,this._onMoveStart));f.subscribe("widgetActived",a.hitch(this,this._onWidgetActived))},showPanel:function(b){var c=new d,f=this.getPanelById(b.id+"_panel");f?("closed"===f.state&&this.openPanel(f),c.resolve(f)):g({Panel:this._loadPanelClass(b.panel.uri),nls:this._loadThemeI18N(b.panel.uri)}).then(a.hitch(this,
function(d){var f=b.id+"_panel",g=this.getPanelById(f),h={label:b.label,config:b,uri:b.panel.uri,position:b.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:f,gid:b.gid,nls:d.nls};a.mixin(h,b.panel.options);try{g=new d.Panel(h),console.log("panel ["+f+"] created.")}catch(A){console.log("create panel error: "+A+", panelId: "+f);c.reject(A);return}g.setPosition(b.panel.position);e.setVerticalCenter(g.domNode);this.openPanel(g);this.panels.push(g);l(g.domNode,
"click",a.hitch(this,this._onPanelClick,g));c.resolve(g)}));return c},setSceneView:function(b){this.sceneView=b;l(this.sceneView,"resize",a.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},
openPanel:function(b){var c=new d;if("string"===typeof b&&(b=this.getPanelById(b),!b))return c.reject(),c;if(!b.started)try{b.started=!0,b.startup()}catch(v){console.error("fail to startup panel "+b.id+". "+v.stack)}if("opened"===b.state)return c.resolve(b),c;b.setState("opened");return this.playOpenPanelAnimation(b).then(a.hitch(this,function(){k.setStyle(b.domNode,"display","");b.onOpen();this._activePanel(b);return b}))},closePanel:function(a){var b=new d;return"string"===typeof a&&(a=this.getPanelById(a),
!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&k.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(u){console.log(console.error("fail to minimize panel "+
a.id+". "+u.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(u){console.log(console.error("fail to maximize panel "+a.id+". "+u.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(u){console.log(console.error("fail to noralize panel "+
a.id+". "+u.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(u){console.log(console.error("fail to destroy panel "+a.id+". "+u.stack))}}},destroyAllPanels:function(){var a=m.map(this.panels,function(a){return a.id});
m.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return c();var b=new d;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(k.setStyle(a.domNode,{opacity:0,display:""}),h.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return c();var b=new d;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?h.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=k.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/
2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&
k.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),!1===b.inPanel&&k.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:
"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&k.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){m.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var c=new d;b([a],function(a){c.resolve(a)});return c},_loadThemeI18N:function(a){var c=new d;a.startWith("themes")?(a=a.split("/"),
b(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){c.resolve(a)})):c.resolve({});return c}});q.getInstance=function(){null===r&&(r=new q,window._panelManager=r);return r};return q})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,a,m,k){return n([k],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);
this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&a.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(a){this.loading=a;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(a){this.widget=a;this.loading&&this.loading.destroy();m.place(a.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&
this.widget.domNode)try{this.widget.destroy()}catch(h){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+h.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(n,a,m,k,h,d,g,l,f){return n([h,d],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",
windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var c=this.getAllWidgetConfigs(),c=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];m.forEach(c,function(b){var c,d;!1!==b.visible&&(d=new g,c=this.createFrame(b),this.addChild(c),c.setLoading(d),this.widgetManager.loadWidget(b).then(a.hitch(this,function(a){c.setWidget(a);
a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var b=this.getChildren(),c=0;c<b.length;c++)if(b[c].getWidget()&&b[c].getWidget().id===a)return b[c].getWidget()},createFrame:function(a){return new l},setPosition:function(a,b){this.position=a;var c=f.getPositionStyle(this.position);c.position="absolute";b||(b="map"===a.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);
this.started?this.resize():this.openAnimation&&(c.display="none");k.place(this.domNode,b);k.setStyle(this.domNode,c)},getPosition:function(){return this.position},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){m.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){m.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){m.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){m.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){m.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},
onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(c){this.isWidgetInPanel(c)&&(this._updateConfig(c),this.getChildren().forEach(function(b){b.getWidget()&&b.getWidget().id===c.id&&(b.getWidget().destroy(),b.setLoading(new g),this.widgetManager.loadWidget(c).then(a.hitch(this,function(a){b.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},this))},isWidgetInPanel:function(a){return m.some(this.getAllWidgetConfigs(),function(b){if(a.id===
b.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var b=-1,c=0;c<this.config.widgets.length;c++)this.config.widgets[c].id===a.id&&(b=c);0<b&&(this.config.widgets[b]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(b){console.error("destroy widget frame error."+b.stack)}});this.inherited(arguments)}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase",
"dojo/dom-style","dojo/dom-construct"],function(n,a,m,k){return n(a,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&m.set(this.domNode,{display:"none"});m.set(this.domNode,{width:"100%",height:"100%"});k.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&
m.set(this.domNode,"display","block")},hide:function(){this.domNode&&m.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,a,m,k,h){return n([k,h],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(m(window,"resize",a.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},
"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(n,a,m){return n(null,{constructor:function(){this.panelManager=m.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(a){},getConfigById:function(a){for(var h=this.getAllConfigs(),d=0;d<h.length;d++)if(h[d].id===a)return h[d]},getAllConfigs:function(){var k=
[],k=k.concat(this.getWidgetConfigs(),this.getGroupConfigs()),k=a.filter(k,function(a){return a.visible});return k.sort(function(a,d){return a.index-d.index})},getAllConfigsIncludeInvisible:function(){var a=[],a=a.concat(this.getWidgetConfigs(),this.getGroupConfigs());return a.sort(function(a,d){return a.index-d.index})},isControlled:function(k){return a.some(this.getAllConfigsIncludeInvisible(),function(a){return a.id===k})},widgetIsControlled:function(k){return a.some(this.getAllConfigsIncludeInvisible(),
function(h){return h.id===k?!0:a.some(h.widgets,function(a){return a.id===k})})},getGroupConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.groups&&a.forEach(this.appConfig.widgetPool.groups,function(a){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(a.id)&&k.push(a):"all"===this.controlledGroups&&k.push(a))},this);return k},getWidgetConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.widgets&&
a.forEach(this.appConfig.widgetPool.widgets,function(a){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(a.id)&&k.push(a):"all"===this.controlledWidgets&&k.push(a))},this);return k}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),function(n,a,m,k,h,d,g,l){var f=null,c=null,b=!1;n=n(null,function(){});
var e=require.toUrl("jimu"),p=d(e+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),q=d(e+"/SpatialReference/transform.json",{handleAs:"json"});n.loadResource=function(){var a=new k;if(f&&c)return a.resolve(),a;h([p,q]).then(function(d){f=d[0];c=d[1];b=!0;a.resolve()},function(c){console.error(c);b=!1;a.reject(c)});return a};n.getAllCSUnits=function(){if(b){var c=[];m.forEach(f.wkids,a.hitch(this,function(a){a=this.getCSUnit(a);-1===m.indexOf(c,a)&&c.push(a)}));return c}};n.convertUnit=function(a,
c,d){if(b)return l.convertUnit(a,c,d)};n.getUnitRate=function(a,c){if(b)return l.getUnitRate(a,c)};n.isProjectUnit=function(a){if(b)return l.isProjectUnit(a)};n.isGeographicUnit=function(a){if(b)return l.isGeographicUnit(a)};n.getGeographicUnits=function(){if(b)return l.getGeographicUnits()};n.getProjectUnits=function(){if(b)return l.getProjectUnits()};n.getCSUnit=function(a){if(b){a=this.getCSStr(a);var c=0,d=0,c=a.lastIndexOf("UNIT"),d=a.indexOf(",",c);return a.slice(c+6,d-1)}};n.isSameSR=function(a,
c){if(b)return a=this.indexOfWkid(a),c=this.indexOfWkid(c),f.labels[a]===f.labels[c]};n.isValidWkid=function(a){if(b)return-1<this.indexOfWkid(a)};n.getSRLabel=function(a){if(b&&this.isValidWkid(a))return a=this.indexOfWkid(a),f.labels[a]};n.indexOfWkid=function(a){if(b)return m.indexOf(f.wkids,a)};n.isWebMercator=function(a){return g.prototype._isWebMercator?g.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new g(parseInt(a,10))).isWebMercator};n.standardizeWkid=function(a){return this.isWebMercator(a)?
3857:parseInt(a,10)};n.isValidTfWkid=function(a){if(b)return-1<this.indexOfTfWkid(a)};n.getTransformationLabel=function(a){if(b)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),c.labels[a]):""};n.indexOfTfWkid=function(a){if(b)return m.indexOf(c.tfWkids,a)};n.isGeographicCS=function(a){if(b)return this.isValidWkid(a)?f.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};n.isProjectedCS=function(a){if(b)return this.isValidWkid(a)?f.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};n.getGeoCSByProj=
function(a){if(b&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=m.indexOf(f.details,a),f.wkids[a]};n.getSpheroidStr=function(a){if(b){if(this.isGeographicCS(a))return f.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=f.details[this.indexOfWkid(a)];var c=a.indexOf("GEOGCS"),d=a.indexOf("PROJECTION")-1;return a.slice(c,d)}return null}};n.getCSStr=function(a){if(b)return f.details[this.indexOfWkid(a)]};n.isSameSpheroid=function(a,c){if(b)return a=this.getSpheroidStr(a),c=this.getSpheroidStr(c),
a&&c&&a===c?!0:!1};return n})},"dojo/request":function(){define(["./request/default!"],function(n){return n})},"dojo/request/default":function(){define(["exports","require","../has"],function(n,a,m){var k=m("config-requestProvider"),h;if(m("host-browser")||m("host-webworker"))h="./xhr";k||(k=h);n.getPlatformDefaultId=function(){return h};n.load=function(d,g,l,f){a(["platform"==d?h:k],function(a){l(a)})}})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],
function(n,a){var m="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),k="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),h={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,
CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,
DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};n=n(null,function(){});n.convertUnit=function(a,g,k){return h[a.toUpperCase()]/h[g.toUpperCase()]*k};n.getUnitRate=function(a,g){return h[a.toUpperCase()]/h[g.toUpperCase()]};n.isProjectUnit=function(d){return-1<a.indexOf(m,d.toUpperCase())};n.isGeographicUnit=function(d){return-1<a.indexOf(k,d.toUpperCase())};n.getGeographicUnits=function(){return k};n.getProjectUnits=function(){return m};return n})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),
function(n,a,m,k,h,d,g,l,f){return n([g,d],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(m.removeClass(this.foldableNode,"fold-up"),m.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(m.removeClass(this.foldableNode,"fold-down"),m.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation()},_normalizePositionObj:function(c){var b=this._getLayoutBox();c.left=
isFinite(c.left)?c.left:b.w-c.right;c.top=isFinite(c.top)?c.top:b.h-c.bottom;delete c.right;delete c.bottom;this.position=a.mixin(a.clone(this.position),c)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new f({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(c,b){this.disableMoveable();var d=m.getMarginBox(jimuConfig.layoutId);d.l=d.l-c+b;d.w+=2*(c-b);this.moveable=new h.boxConstrainedMoveable(this.domNode,{box:d,handle:this.titleNode,within:!0});this.own(k(this.moveable,
"Moving",a.hitch(this,this.onMoving)));this.own(k(this.moveable,"MoveStop",a.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){m.removeClass(this.titleNode,"title-normal");m.addClass(this.titleNode,"title-full");m.setStyle(this.foldableNode,"display",
"block");m.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(m.removeClass(this.foldableNode,"fold-up"),m.addClass(this.foldableNode,"fold-down")):(m.removeClass(this.foldableNode,"fold-down"),m.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){m.removeClass(this.titleNode,"title-full");m.addClass(this.titleNode,"title-normal");m.setStyle(this.foldableNode,"display","none");m.setStyle(this.maxNode,"display","none")},resize:function(c){var b=this._getPositionInfo(),
d={left:b.position.left,top:b.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};c&&(c.t=this.domNode.offsetTop,d.left=isFinite(c.l)?c.l:d.left,d.top=isFinite(c.t)?c.t:d.top,d.width=isFinite(c.w)?c.w:d.width,d.height=isFinite(c.h)?c.h:d.height,this._normalizePositionObj(a.clone(d)),this.makePositionInfoBox(),d.width=this._positionInfoBox.w,d.height=this._positionInfoBox.h);b.position=d;this._onResponsible(b);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return m.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},b=this._getLayoutBox(),d=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?b.w-d:d;var d=this._positionInfoBox.t,f=b.h-d;d>=f?d>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):f>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>b.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){m.place(this.domNode,jimuConfig.layoutId);var c=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(c.zIndex=this.position.zIndex);var b=l.getPositionStyle(c);a.mixin(b,c.borderRadiusStyle);m.setStyle(this.domNode,b)},_setDesktopPosition:function(a){m.place(this.domNode,jimuConfig.mapId);m.setStyle(this.domNode,
{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){m.setStyle(a.node,"opacity",.9)},onMoveStop:function(c){m.setStyle(c.node,"opacity",1);c=m.getMarginBox(c.node);this._normalizePositionObj(a.clone({left:c.l,top:c.t,width:c.w,height:c.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u){n.experimental("dojox.layout.ResizeHandle");var v=p("dojox.layout._ResizeHelper",w,{show:function(){e.set(this.domNode,"display","")},hide:function(){e.set(this.domNode,"display","none")},resize:function(a){b.setMarginBox(this.domNode,a)}});return p("dojox.layout.ResizeHandle",[w,u],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,q.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=r.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(g.body()),
c.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var b=a.partial(c.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;b("dojoxResizeNW");break;case "x":this._resizeX=!0;b("dojoxResizeW");break;case "y":this._resizeY=!0,b("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(m.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=r.byId(this.targetId))?this.targetWidget.domNode:f.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var c=b.position(this.targetDomNode,!0);this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:c.x,t:c.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var c=e.getComputedStyle(this.targetDomNode),d="border-model"===b.boxModel?{w:0,h:0}:b.getPadBorderExtents(this.targetDomNode,c),k=b.getMarginExtents(this.targetDomNode,c);this.startSize={w:e.get(this.targetDomNode,"width",c),h:e.get(this.targetDomNode,"height",c),pbw:d.w,pbh:d.h,mw:k.w,mh:k.h};this.isLeftToRight()||"absolute"!=e.get(this.targetDomNode,"position")||(c=b.position(this.targetDomNode,!0),this.startPosition={l:c.x,t:c.y});this._pconnects=[m.connect(g.doc,q.move,this,"_updateSizing"),
m.connect(g.doc,q.release,this,"_endSizing")];h.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(E){return!1}this._activeResizeLastEvent=a;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
d:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(c=c||this.startPosition)&&this._resizeX&&(e.l=c.l+d,e.w!=a&&(e.l+=a-e.w),e.t=c.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(b){var c=this.targetWidget&&a.isFunction(this.targetWidget.resize),f=this._getNewCoords(b,c&&"margin");if(!1!==f&&(c?this.targetWidget.resize(f):this.animateSizing?l[this.animateMethod]([d.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:f.w}},duration:this.animateDuration}),d.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:f.h}},
duration:this.animateDuration})]).play():e.set(this.targetDomNode,{width:f.w+"px",height:f.h+"px"}),this.intermediateChanges))this.onResize(b)},_endSizing:function(b){k.forEach(this._pconnects,m.disconnect);var c=a.partial(m.publish,this.endTopic,[this]);this.activeResize?c():(this._resizeHelper.hide(),this._changeSizing(b),setTimeout(c,this.animateDuration+15));this._isSizing=!1;this.onResize(b)},onResize:function(a){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){m.isAsync||c(0,function(){b(["./fx/Toggler"])});m=m.fx={};c={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var e=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;k.forEach(this._animations,function(a){a&&("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};e.prototype=new a;n.extend(e,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=h.after(this._current,"onAnimate",n.hitch(this,"_onAnimate"),!0),this._onEndCtx=h.after(this._current,"onEnd",n.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==
this._current.status())return this;var c=h.after(this._current,"beforeBegin",n.hitch(this,function(){this._fire("beforeBegin")}),!0),d=h.after(this._current,"onBegin",n.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),e=h.after(this._current,"onPlay",n.hitch(this,function(a){this._fire("onPlay",arguments);c.remove();d.remove();e.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=h.after(this._current,"onAnimate",n.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=h.after(this._current,"onEnd",n.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=h.after(this._current,"onPause",n.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},gotoPercent:function(a,b){this.pause();var c=this.duration*a;this._current=null;k.some(this._animations,function(a,b){if(c<=a.duration)return this._current=a,this._index=
b,!0;c-=a.duration;return!1},this);this._current&&this._current.gotoPercent(c/this._current.duration);b&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=h.after(this._current,"onStop",n.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});n.extend(e,c);m.chain=function(a){return new e(n.isArray(a)?a:Array.prototype.slice.call(a,0))};var p=function(a){this._animations=a||[];this._connects=[];this.duration=this._finished=0;k.forEach(a,function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(h.after(a,"onEnd",n.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new d.Animation({curve:[0,1],duration:this.duration});var b=this;k.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){b._connects.push(h.after(b._pseudoAnimation,a,function(){b._fire(a,arguments)},!0))})};n.extend(p,{_doAction:function(a,b){k.forEach(this._animations,function(c){c[a].apply(c,b)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var c=this._pseudoAnimation;c[a].apply(c,b)},play:function(a,
b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(a,b){var c=this.duration*a;k.forEach(this._animations,function(a){a.gotoPercent(a.duration<c?1:c/a.duration,b)});this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();k.forEach(this._connects,function(a){a.remove()})}});n.extend(p,c);m.combine=function(a){return new p(n.isArray(a)?a:Array.prototype.slice.call(a,0))};m.wipeIn=function(a){var b=a.node=g.byId(a.node),c=b.style,e;a=d.animateProperty(n.mixin({properties:{height:{start:function(){e=c.overflow;c.overflow="hidden";if("hidden"==c.visibility||"none"==c.display)return c.height="1px",c.display="",c.visibility="",1;var a=l.get(b,"height");return Math.max(a,1)},end:function(){return b.scrollHeight}}}},
a));var f=function(){c.height="auto";c.overflow=e};h.after(a,"onStop",f,!0);h.after(a,"onEnd",f,!0);return a};m.wipeOut=function(a){var b=(a.node=g.byId(a.node)).style,c;a=d.animateProperty(n.mixin({properties:{height:{end:1}}},a));h.after(a,"beforeBegin",function(){c=b.overflow;b.overflow="hidden";b.display=""},!0);var e=function(){b.overflow=c;b.height="auto";b.display="none"};h.after(a,"onStop",e,!0);h.after(a,"onEnd",e,!0);return a};m.slideTo=function(a){var b=null,c=null,e=function(a){return function(){var d=
l.getComputedStyle(a),e=d.position;b="absolute"==e?a.offsetTop:parseInt(d.top)||0;c="absolute"==e?a.offsetLeft:parseInt(d.left)||0;"absolute"!=e&&"relative"!=e&&(d=f.position(a,!0),b=d.y,c=d.x,a.style.position="absolute",a.style.top=b+"px",a.style.left=c+"px")}}(a.node=g.byId(a.node));e();a=d.animateProperty(n.mixin({properties:{top:a.top||0,left:a.left||0}},a));h.after(a,"beforeBegin",e,!0);return a};return m})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(n,a,m,k,h,d,g,l,f){return d("dijit.layout._LayoutWidget",[a,m,k],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);g.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();a&&a.isLayoutContainer||(this.resize(),this.own(h.on("resize",n.hitch(this,"resize"))))}},resize:function(a,b){var c=this.domNode;a&&l.setMarginBox(c,a);b=b||{};
n.mixin(b,a||{});"h"in b&&"w"in b||(b=n.mixin(l.getMarginBox(c),b));a=f.getComputedStyle(c);var d=l.getMarginExtents(c,a),g=l.getBorderExtents(c,a);b=this._borderBox={w:b.w-(d.w+g.w),h:b.h-(d.h+g.h)};d=l.getPadExtents(c,a);this._contentBox={l:f.toPixelValue(c,a.paddingLeft),t:f.toPixelValue(c,a.paddingTop),w:b.w-d.w,h:b.h-d.h};this.layout()},layout:function(){},_setupChild:function(a){g.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,b){this.inherited(arguments);
this._started&&this._setupChild(a)},removeChild:function(a){g.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(n,a){return n("dijit._Contained",null,{_getSibling:function(a){var k=this.getParent();return k&&k._getSiblingOfChild&&k._getSiblingOfChild(this,"previous"==a?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var a=this.getParent();return a&&a.getIndexOfChild?a.getIndexOfChild(this):-1}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){b("dijit-legacy-requires")&&w(0,function(){n(["dijit/MenuItem",
"dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return m("dijit.Menu",r,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):a.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return p.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||
a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=k.byId(a,this.ownerDocument);var b;if("iframe"==a.tagName.toLowerCase()){var d=a;b=this._iframeContentWindow(d);b=e.body(b.document)}else b=a==e.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var g={node:a,iframe:d};h.set(a,"_dijitMenu"+this.id,
this._bindings.push(g));var m=f.hitch(this,function(a){var b=this.selector,e=b?function(a){return c.selector(b,a)}:function(a){return a},f=this;return[c(a,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<f._lastKeyDown+500||f._scheduleOpen(this,d,{x:a.pageX,y:a.pageY},a.target)}),c(a,e("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==l.F10||f.leftClickToOpen&&a.keyCode==l.SPACE)a.stopPropagation(),a.preventDefault(),
f._scheduleOpen(this,d,null,a.target),f._lastKeyDown=(new Date).getTime()})]});g.connects=b?m(b):[];d&&(g.onloadHandler=f.hitch(this,function(){var a=this._iframeContentWindow(d),a=e.body(a.document);g.connects=m(a)}),d.addEventListener?d.addEventListener("load",g.onloadHandler,!1):d.attachEvent("onload",g.onloadHandler))},unBindDomNode:function(a){var b;try{b=k.byId(a,this.ownerDocument)}catch(z){return}a="_dijitMenu"+this.id;if(b&&h.has(b,a)){for(var c=h.get(b,a)-1,d=this._bindings[c],e;e=d.connects.pop();)e.remove();
(e=d.iframe)&&(e.removeEventListener?e.removeEventListener("load",d.onloadHandler,!1):e.detachEvent("onload",d.onloadHandler));h.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function c(){r.refocus&&u&&u.focus();q.close(r)}var e=a.target,f=a.iframe,h=a.coords,l=!h;this.currentTarget=a.delegatedTarget;
if(h){if(f){a=d.position(f,!0);var e=this._iframeContentWindow(f),e=d.docScroll(e.document),m=g.getComputedStyle(f),n=g.toPixelValue,p=(b("ie"),n(f,m.paddingLeft))+(b("ie"),0),f=(b("ie"),n(f,m.paddingTop))+(b("ie"),0);h.x+=a.x+p-e.x;h.y+=a.y+f-e.y}}else h=d.position(e,!0),h.x+=10,h.y+=10;var r=this,f=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var u=!a||k.isDescendant(a,this.domNode)?f:a;q.open({popup:this,x:h.x,y:h.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?"L":
"R"});this.focus();l||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);q.close(this)}},destroy:function(){a.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){function u(){this._popupWrapper&&(d.destroy(this._popupWrapper),delete this._popupWrapper)}m=m(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var a=this._firstAroundPosition,c=g.position(this._firstAroundNode,!0),d=c.x-a.x,a=c.y-a.y;if(d||a)for(this._firstAroundPosition=c,c=0;c<this._stack.length;c++){var e=this._stack[c].wrapper.style;e.top=parseFloat(e.top)+a+"px";"auto"==e.right?e.left=parseFloat(e.left)+d+
"px":e.right=parseFloat(e.right)-d+"px"}this._aroundMoveListener=setTimeout(b.hitch(this,"_repositionAll"),d||a?10:50)}},_createWrapper:function(b){var c=b._popupWrapper,f=b.domNode;c||(c=d.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":b["aria-label"]||b.label||b.name||b.id},b.ownerDocumentBody),c.appendChild(f),f=f.style,f.display="",f.visibility="",f.position="",f.top="0px",b._popupWrapper=c,a.after(b,"destroy",u,!0),"ontouchend"in document&&e(c,"touchend",
function(a){/^(input|button|textarea)$/i.test(a.target.tagName)||a.preventDefault()}),c.dojoClick=!0);return c},moveOffScreen:function(a){var b=this._createWrapper(a);a=g.isBodyLtr(a.ownerDocument);var c={visibility:"hidden",top:"-9999px",display:""};c[a?"left":"right"]="-9999px";c[a?"right":"left"]="auto";l.set(b,c);return b},hide:function(a){var b=this._createWrapper(a);l.set(b,{display:"none",height:"auto",overflowY:"visible",border:""});a=a.domNode;"_originalStyle"in a&&(a.style.cssText=a._originalStyle)},
getTopPopup:function(){for(var a=this._stack,b=a.length-1;0<b&&a[b].parent===a[b-1].widget;b--);return a[b]},open:function(a){for(var d=this._stack,m=a.popup,n=m.domNode,u=a.orient||["below","below-alt","above","above-alt"],w=a.parent?a.parent.isLeftToRight():g.isBodyLtr(m.ownerDocument),v=a.around,B=a.around&&a.around.id?a.around.id+"_dropdown":"popup_"+this._idGen++;d.length&&(!a.parent||!k.isDescendant(a.parent.domNode,d[d.length-1].widget.domNode));)this.close(d[d.length-1].widget);var G=this.moveOffScreen(m);
m.startup&&!m._started&&m.startup();var F,K=g.position(n);if("maxHeight"in a&&-1!=a.maxHeight)F=a.maxHeight||Infinity;else{F=r.getEffectiveBox(this.ownerDocument);var H=v?g.position(v,!1):{y:a.y-(a.padding||0),h:2*(a.padding||0)};F=Math.floor(Math.max(H.y,F.h-(H.y+H.h)))}K.h>F&&(K=l.getComputedStyle(n),l.set(G,{overflowY:"scroll",height:F+"px",border:K.borderLeftWidth+" "+K.borderLeftStyle+" "+K.borderLeftColor}),n._originalStyle=n.style.cssText,n.style.border="none");h.set(G,{id:B,style:{zIndex:this._beginZIndex+
d.length},"class":"dijitPopup "+(m.baseClass||m["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:a.parent?a.parent.id:""});0==d.length&&v&&(this._firstAroundNode=v,this._firstAroundPosition=g.position(v,!0),this._aroundMoveListener=setTimeout(b.hitch(this,"_repositionAll"),50));f("config-bgIframe")&&!m.bgIframe&&(m.bgIframe=new q(G));B=m.orient?b.hitch(m,"orient"):null;u=v?p.around(G,v,u,w,B):p.at(G,a,"R"==u?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],a.padding,B);G.style.visibility="visible";
n.style.visibility="visible";n=[];n.push(e(G,"keydown",b.hitch(this,function(b){if(b.keyCode==c.ESCAPE&&a.onCancel)b.stopPropagation(),b.preventDefault(),a.onCancel();else if(b.keyCode==c.TAB&&(b.stopPropagation(),b.preventDefault(),(b=this.getTopPopup())&&b.onCancel))b.onCancel()})));m.onCancel&&a.onCancel&&n.push(m.on("cancel",a.onCancel));n.push(m.on(m.onExecute?"execute":"change",b.hitch(this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()})));d.push({widget:m,wrapper:G,parent:a.parent,
onExecute:a.onExecute,onCancel:a.onCancel,onClose:a.onClose,handlers:n});if(m.onOpen)m.onOpen(u);return u},close:function(a){for(var b=this._stack;a&&n.some(b,function(b){return b.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,e=c.onClose;d.bgIframe&&(d.bgIframe.destroy(),delete d.bgIframe);if(d.onClose)d.onClose();for(var f;f=c.handlers.pop();)f.remove();d&&d.domNode&&this.hide(d);e&&e()}0==b.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return w.popup=new m})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(n,a,m,k){return n("dijit.DropDownMenu",k,{templateString:m,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(a){this._moveToPopup(a);a.stopPropagation();a.preventDefault()},_onLeftArrow:function(a){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();
else this.onCancel(!1);else a.stopPropagation(),a.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r){return a("dijit._MenuBase",[e,r,q,p],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),
this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){h.toggle(this.domNode,"dijitMenuActive",a);h.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var c=b.byNode(a);return a.parentNode==this.containerNode&&c&&c.focus},postCreate:function(){var a=this,e="string"==typeof this.childSelector?this.childSelector:
d.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(e,g.enter),function(){a.onItemHover(b.byNode(this))}),l(this.containerNode,l.selector(e,g.leave),function(){a.onItemUnhover(b.byNode(this))}),l(this.containerNode,l.selector(e,c),function(c){a.onItemClick(b.byNode(this),c);c.stopPropagation()}),l(this.containerNode,l.selector(e,"focusin"),function(){a._onItemFocus(b.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==
d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},
onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==
a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&
(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=
this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=l.once(c.domNode,"mouseover",d.hitch(this,"_onPopupHover")));var e=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&e.focusChild(a);e._cleanUp()},onExecute:d.hitch(this,"_cleanUp",!0),onClose:function(){e._mouseoverHandle&&(e._mouseoverHandle.remove(),delete e._mouseoverHandle)}},
b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(k.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=
a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(n,a,m,k,h,d,g,l,f,c){return a("dijit._KeyNavContainer",
[f,c,l],{connectKeyNavHandlers:function(a,c){var b=this._keyNavCodes={},e=d.hitch(this,"focusPrev"),f=d.hitch(this,"focusNext");n.forEach(a,function(a){b[a]=e});n.forEach(c,function(a){b[a]=f});b[h.HOME]=d.hitch(this,"focusFirstChild");b[h.END]=d.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){k.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);n.forEach(this.getChildren(),d.hitch(this,"_startupChild"))},addChild:function(a,
c){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=g.byNode(a))&&a.getParent()==this}})})},
"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(n,a,m,k,h,d,g,l){return a("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);m.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[k.HOME]=h.hitch(this,"focusFirstChild");a[k.END]=h.hitch(this,"focusLastChild");a[this.isLeftToRight()?
k.LEFT_ARROW:k.RIGHT_ARROW]=h.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?k.RIGHT_ARROW:k.LEFT_ARROW]=h.hitch(this,"_onRightArrow");a[k.UP_ARROW]=h.hitch(this,"_onUpArrow");a[k.DOWN_ARROW]=h.hitch(this,"_onDownArrow")}var c=this,a="string"==typeof this.childSelector?this.childSelector:h.hitch(this,"childSelector");this.own(d(this.domNode,"keypress",h.hitch(this,"_onContainerKeypress")),d(this.domNode,"keydown",h.hitch(this,"_onContainerKeydown")),d(this.domNode,"focus",h.hitch(this,"_onContainerFocus")),
d(this.containerNode,d.selector(a,"focusin"),function(a){c._onChildFocus(g.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},
focusChild:function(a,c){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(c?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){m.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){m.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,
this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,c,b,d){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,c){var b=a.domNode;a=(a.label||(b.focusNode?b.focusNode.label:"")||b.innerText||b.textContent||
"").replace(/^\s+/,"").substr(0,c.length).toLowerCase();return c.length&&a==c?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(a){if(!this._isFormElement(document.activeElement)){var c=this._keyNavCodes[a.keyCode];c?(c(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode!=k.SPACE||!this._searchTimer||a.ctrlKey||a.altKey||a.metaKey||(a.stopImmediatePropagation(),
a.preventDefault(),this._keyboardSearch(a," "))}},_onContainerKeypress:function(a){this._isFormElement(document.activeElement)||a.charCode<=k.SPACE||a.ctrlKey||a.altKey||a.metaKey||(a.preventDefault(),a.stopPropagation(),this._keyboardSearch(a,String.fromCharCode(a.charCode).toLowerCase()))},_keyboardSearch:function(a,c){var b=null,d,f=0;h.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=c;var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;
d=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var e=this.focusedChild||null;if(1==a||!e)if(e=this._getNextFocusableChild(e,1),!e)return;a=e;do{var g=this._keyboardSearchCompare(e,d);g&&0==f++&&(b=e);if(-1==g){f=-1;break}e=this._getNextFocusableChild(e,1)}while(e&&e!=a)})();this.onKeyboardSearch(b,a,d,f)},_onChildBlur:function(){},_getNextFocusableChild:function(a,c){var b=a;do{if(a)a=this._getNext(a,
c);else if(a=this[0<c?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=b&&a.isFocusable())return a}while(a!=b);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,c){if(a)for(a=a.domNode;a;)if((a=a[0>c?"previousSibling":"nextSibling"])&&"getAttribute"in a){var b=g.byNode(a);if(b)return b}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(n,a,m){return n([a,
m],{})})},"dgrid/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(n,a,m,k,h,d,g,l){function f(a,b){b&&b.nodeType&&a.appendChild(b)}n=n(g,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!==typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&
(a=a.target);var c;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var d=a.columnId;if(d){b=d;c=a;break}a=a.parentNode}while(a&&a!==this.domNode)}if(!c&&"undefined"!==typeof b){var f=this.row(a);if(d=f&&f.element)for(var d=d.getElementsByTagName("td"),g=0;g<d.length;g++)if(d[g].columnId===b){c=d[g];break}}if(null!=a)return{row:f||this.row(a),column:b&&this.column(b),element:c}},createRowCells:function(a,b,e,f,g){var c=m.create("table",{className:"dgrid-row-table",role:"presentation"}),h=9>d("ie")?
m.create("tbody",null,c):c,k,n,p,q,x,z,A,E,B,G;e=e||this.subRows;n=0;for(p=e.length;n<p;n++)for(z=e[n],k=m.create("tr",null,h),z.className&&(k.className=z.className),q=0,x=z.length;q<x;q++){A=z[q];E=A.id;B=A.field?" field-"+l.escapeCssIdentifier(A.field,"-"):"";(G="function"===typeof A.className?A.className(f):A.className)&&(B+=" "+G);B=m.create(a,{className:"dgrid-cell"+(E?" dgrid-column-"+l.escapeCssIdentifier(E,"-"):"")+B,role:"th"===a?"columnheader":"gridcell"});B.columnId=E;if(E=A.colSpan)B.colSpan=
E;if(E=A.rowSpan)B.rowSpan=E;b(B,A,f,g);k.appendChild(B)}return c},_createBodyRowCell:function(a,b,d,g){var c=d;b.get?c=b.get(d):"field"in b&&"_item"!==b.field&&(c=d[b.field]);b.renderCell?f(a,b.renderCell(d,c,a,g)):this._defaultRenderCell.call(b,d,c,a,g)},_createHeaderRowCell:function(a,b){var c=b.headerNode=a,d=b.field;d&&(a.field=d);b.renderHeaderCell?f(c,b.renderHeaderCell(c)):("label"in b||b.field)&&c.appendChild(document.createTextNode("label"in b?b.label:b.field));!1!==b.sortable&&d&&"_item"!==
d&&(a.sortable=!0,a.className+=" dgrid-sortable")},left:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,-(b||1),"dgrid-cell"))},right:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,b||1,"dgrid-cell"))},_defaultRenderCell:function(a,b,d){if(this.formatter){var c=this.formatter,e=this.grid.formatterScope;d.innerHTML="string"===typeof c&&e?e[c](b,a):this.formatter(b,a)}else null!=b&&d.appendChild(document.createTextNode(b))},renderRow:function(c,b){c=
this.createRowCells("td",a.hitch(this,"_createBodyRowCell"),b&&b.subRows,c,b);b=m.create("div",{role:"row"});b.appendChild(c);return b},renderHeader:function(){var c=this,b=this.headerNode;b.setAttribute("role","row");m.empty(b);var e=this.createRowCells("th",a.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[e.id=this.id+"-header"]=this.columns;b.appendChild(e);this._sortListener&&this._sortListener.remove();this._sortListener=h(e,"click,keydown",function(a){if("click"===
a.type||32===a.keyCode||!d("opera")&&13===a.keyCode){var e=a.target,f,g;do if(e.sortable){f=e.field||e.columnId;g=c.sort[0];f=c.hasNeutralSort&&g&&g.property===f&&g.descending?[]:[{property:f,descending:g&&g.property===f&&!g.descending}];g={bubbles:!0,cancelable:!0,grid:c,parentType:a.type,sort:f};h.emit(a.target,"dgrid-sort",g)&&(c._sortNode=e,c.set("sort",f));break}while((e=e.parentNode)&&e!==b)}})},resize:function(){var a=this.headerNode.firstChild,b=this.contentNode,d;this.inherited(arguments);
b.style.width="";b&&a&&(d=a.offsetWidth)>b.offsetWidth&&(b.style.width=d+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(a){var b=this.columns,c;for(c in b){var d=b[c];if(d.field===a)return d.headerNode}},updateSortArrow:function(a,b){this._lastSortedArrow&&(k.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),
m.destroy(this._lastSortedArrow),delete this._lastSortedArrow);b&&(this.sort=a);a[0]&&(b=a[0].property,a=a[0].descending,b=this._sortNode||this._findSortArrowParent(b),delete this._sortNode,b&&(b=b.contents||b,this._lastSortedArrow=m.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},b,"first"),k.add(b,"dgrid-sort-"+(a?"down":"up")),this.resize()))},styleColumn:function(a,b){return this.addCssRule("#"+l.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+
l.escapeCssIdentifier(a,"-"),b)},_configColumns:function(a,b){var c=[],d=b instanceof Array;l.each(b,function(e,f){"string"===typeof e&&(b[f]=e={label:e});d||e.field||(e.field=f);f=e.id=e.id||(isNaN(f)?f:a+f);this._configColumn&&(this._configColumn(e,b,a),f=e.id);d&&(this.columns[f]=e);e.grid=this;c.push(e)},this);return d?b:c},_destroyColumns:function(){this.cleanup()},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(a)for(b=0;b<
a.length;b++)a[b]=this._configColumns(b+"-",a[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&
(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});n.appendIfNode=f;return n})},"dgrid/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./util/misc dojo/_base/sniff".split(" "),function(n,a,m,k,h,d,g){function l(a,b){a.className="dgrid-scrollbar-measure";document.body.appendChild(a);b=a["offset"+b]-a["client"+b];a.className="";a.parentNode&&document.body.removeChild(a);return b}function f(a){k.replace(this.domNode,
a,this._class||"");this._class=a}function c(){return this._class}var b=[];b.push("has-mozilla");d("touch")&&b.push("has-touch");k.add(document.documentElement,b);d.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});var e,p;d.add("dom-scrollbar-width",function(a,b,c){return l(c,"Width")});d.add("dom-scrollbar-height",function(a,b,c){return l(c,"Height")});d.add("dom-rtl-scrollbar-left",function(a,b,c){a=document.createElement("div");c.className="dgrid-scrollbar-measure";
c.setAttribute("dir","rtl");c.appendChild(a);document.body.appendChild(c);b=!!d("ie")||!1||/\bEdge\//.test(navigator.userAgent)||a.offsetLeft>=d("dom-scrollbar-width");c.className="";c.parentNode&&document.body.removeChild(c);m.destroy(a);c.removeAttribute("dir");return b});var q=0,r=function(){this._started&&this.resize()},w=n(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:g.defaultDelay,resizeThrottleMethod:"throttleDelayed",
postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||document.createElement("div");var c;a&&(this.params=a,n.safeMixin(this,a),c=a["class"]||a.className||b.className);this.sort=this.sort||[];this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();
this.id=b.id=b.id||this.id||w.autoIdPrefix+q++;this.buildRendering();c&&f.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var b=this.domNode,c=this.addUiClasses,e=this,f,l,n;n=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();b.className="";b.setAttribute("role","grid");k.add(b,"dgrid dgrid-"+this.listType+(c?" ui-widget":""));f=this.headerNode=m.create("div",
{className:"dgrid-header dgrid-header-row"+(c?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},b);l=this.bodyNode=m.create("div",{className:"dgrid-scroller"},b);l.tabIndex=-1;this.headerScrollNode=m.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(c?" ui-widget-header":"")},b);this.footerNode=m.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},b);n&&(b.className+=" dgrid-rtl"+(d("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":
""));h(l,"scroll",function(a){e.showHeader&&(f.scrollLeft=a.scrollLeft||l.scrollLeft);a.stopPropagation();h.emit(b,"scroll",{scrollTarget:l})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=m.create("div",{className:"dgrid-content"+(c?" ui-widget-content":"")},this.bodyNode);"string"===typeof this.resizeThrottleMethod&&g[this.resizeThrottleMethod]?c=g[this.resizeThrottleMethod](r,this,this.resizeThrottleDelay):"function"===typeof this.resizeThrottleMethod?c=this.resizeThrottleMethod(a.hitch(this,
r),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),c=g.throttleDelayed(r,this,this.resizeThrottleDelay));this._resizeHandle=h(window,"resize",c);this._listeners.push(this._resizeHandle)},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.footerNode,b=this.showFooter?
b.offsetHeight:0;this.headerScrollNode.style.height=a.style.marginTop=this.headerNode.offsetHeight+"px";a.style.marginBottom=b+"px";e||(e=d("dom-scrollbar-width"),p=d("dom-scrollbar-height"),d("ie")&&(e++,p++),g.addCssRule(".dgrid-scrollbar-width","width: "+e+"px"),g.addCssRule(".dgrid-scrollbar-height","height: "+p+"px"),17!==e&&(g.addCssRule(".dgrid-header-row","right: "+e+"px"),g.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+e+"px")))},addCssRule:function(a,b){a=g.addCssRule(a,b);this.cleanAddedRules&&
this._listeners.push(a);return a},on:function(a,b){return h(this.domNode,a,b)},cleanup:function(){for(var a in this._rowIdToObject)if(this._rowIdToObject[a]!==this.columns){var b=document.getElementById(a);b&&this.removeRow(b,!0)}},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();this._listeners=null}this._started=!1;this.cleanup();m.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML=
"";this.scrollTo({x:0,y:0})},highlightRow:function(a,b){var c="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");a=a.element||a;k.add(a,c);setTimeout(function(){k.remove(a,c)},b||this.highlightDuration)},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&k.contains(a,"dgrid-row")&&k.replace(a,1===b%2?"dgrid-row-odd":"dgrid-row-even",0===b%2?"dgrid-row-odd":"dgrid-row-even"),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!==b)}},renderArray:function(a,
b,c){c=c||{};var d=c.start||0,e=document.createDocumentFragment(),f=[],g=0,h=a.length;b||(this._lastCollection=a);for(;g<h;)f[g]=this.insertRow(a[g],e,null,d++,c),g++;(a=b?b.parentNode:this.contentNode)&&a.parentNode&&(a!==this.contentNode||h)&&(a.insertBefore(e,b||null),h&&this.adjustRowIndices(f[h-1]));return f},renderHeader:function(){},_autoRowId:0,insertRow:function(a,b,c,d,e){var f=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(a):this._autoRowId++),
g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g,!1,e));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1===d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);g.rowIndex=d;h&&h.rowIndex!==g.rowIndex-1&&this.adjustRowIndices(h);return g},renderRow:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));
return b},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||m.destroy(a)},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!==this.domNode)}else return"object"===typeof a?b=this.collection.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+
"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:function(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,
a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:c,_setClass:f,_getClassName:c,_setClassName:f,_setSort:function(a,b){this.sort="string"!==typeof a?a:[{property:a,descending:b}];this._applySort()},_applySort:function(){this.refresh();if(this._lastCollection){var a=this.sort;if(a&&0<a.length){var b=a[0].property,c=!!a[0].descending;this._lastCollection.sort(function(a,d){a=a[b];d=d[b];
void 0===a&&(a="");void 0===d&&(d="");return a===d?0:a>d!==c?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;k.toggle(b,"dgrid-header-hidden",!a);this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(a){this.showFooter=a;k.toggle(this.footerNode,"dgrid-footer-hidden",!a);this.resize()}});w.autoIdPrefix="dgrid_";return w})},"dgrid/util/misc":function(){define(["dojo/has"],function(n){var a=
[],m,k,h,d=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,g=setTimeout,l=clearTimeout;n.add("requestidlecallback",function(a){return"function"===typeof a.requestIdleCallback});var f={defaultDelay:15,throttle:function(a,b,d){var c=!1;d=d||f.defaultDelay;return function(){c||(c=!0,a.apply(b,arguments),g(function(){c=!1},d))}},throttleDelayed:function(a,b,d){var c=!1;d=d||f.defaultDelay;return function(){if(!c){c=!0;var e=arguments;g(function(){c=!1;a.apply(b,e)},d)}}},debounce:function(a,b,d){var c;d=d||f.defaultDelay;
return function(){c&&(l(c),c=null);var e=arguments;c=g(function(){c=null;a.apply(b,e)},d)}},each:function(a,b,d){var c,e;if(a)if("number"===typeof a.length)for(c=0,e=a.length;c<e;c++)b.call(d,a[c],c,a);else for(c in a)b.call(d,a[c],c,a)},addCssRule:function(c,b){m||(m=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(m),m=m.sheet||m.styleSheet,k=m.deleteRule?"deleteRule":"removeRule",h=m.cssRules?"cssRules":"rules");var d=a.length;a[d]=(m.cssRules||m.rules).length;
m.addRule?m.addRule(c,b):m.insertRule(c+"{"+b+"}",a[d]);return{get:function(b){return m[h][a[d]].style[b]},set:function(b,c){"undefined"!==typeof a[d]&&(m[h][a[d]].style[b]=c)},remove:function(){var b=a[d],c,e;if(void 0!==b)for(m[k](b),a[d]=void 0,c=d+1,e=a.length;c<e;c++)a[c]>b&&a[c]--}}},escapeCssIdentifier:function(a,b){return"string"===typeof a?a.replace(d,b||"\\$1"):a}};return f})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),
function(n,a,m,k,h,d,g,l,f){function c(a){return a&&(0<=a.className.indexOf("dgrid-row")||0<=a.className.indexOf("dgrid-loading"))}function b(a){return a&&0<=a.className.indexOf("dgrid-preload")}var e=0;return m([n,a],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:f.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var a=this;d(this.bodyNode,
"scroll",f[this.pagingMethod](function(b){a._processScroll(b)},null,this.pagingDelay))},renderQuery:function(a,b){var c=this,d=b&&b.container||this.contentNode,f,l,m,n,p=0,q=b&&b.start||0;"level"in a&&(p=n=a.level);f={query:a,count:0,level:p,top:!1};var A={node:h.create("div",{className:"dgrid-preload",style:{height:"0"}},d),count:0,query:a,next:f,level:p,top:!0};l=A.node;l.rowIndex=0;f.previous=A;m=f.node=h.create("div",{className:"dgrid-preload",style:{height:"0"}},d);A.id=e++;l.setAttribute("data-preloadid",
A.id);f.id=e++;m.setAttribute("data-preloadid",f.id);m.rowIndex=this.minRowsPerPage;c._insertPreload(A);var E=h.create("div",{className:"dgrid-loading"},m,"before");h.create("div",{className:"dgrid-below"},E).innerHTML=this.loadingMessage;b=k.mixin({start:0,count:this.minRowsPerPage},b);null!=n&&(b.queryLevel=n);return this._trackError(function(){var d=a(b);return c.renderQueryResults(d,m,b).then(function(a){return d.totalLength.then(function(d){var e=a.length,k=m.parentNode;!c._rows||"queryLevel"in
b||(c._rows.min=0,c._rows.max=e===d?Infinity:e-1);h.destroy(E);"queryLevel"in b||(c._total=d);0===d&&k&&(c.noDataNode&&h.destroy(c.noDataNode),c._insertNoDataNode(k));A.count=q;f.count=d-e-q;m.rowIndex=q+e;d?c._updatePreloadRowHeights(A):(m.style.display="none",l.style.display="none");c._previousScrollPosition&&k.offsetHeight&&(c.scrollTo(c._previousScrollPosition),delete c._previousScrollPosition);return g(c._processScroll()).then(function(){return a})})}).otherwise(function(a){h.destroy(E);throw a;
})})},_insertPreload:function(a){var b=this.preload;if(b){for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(b=b.previous,null==b)return;for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_FOLLOWING&&b.next;)b=b.next;b.previous.next=a;a.previous=b.previous;a=a.next;a.next=b;b.previous=a}else this.preload=a},refresh:function(a){var b=this,c=a&&a.keepScrollPosition;"undefined"===typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());
this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(a){return b._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){b._emitRefreshComplete()})},resize:function(){this.inherited(arguments);this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(a){var b=this.inherited(arguments),c=this._getRenderedCollection(this.preload);c&&c.releaseRange&&b.then(function(b){b[0]&&!b[0].parentNode.tagName&&
a.totalLength.then(function(){c.releaseRange(b[0].rowIndex,b[b.length-1].rowIndex+1)})});return b},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},_calcAverageRowHeight:function(a){for(var b=a.length,c=0,d=0;d<b;d++)c+=this._calcRowHeight(a[d]);return b&&c?c/b:0},_updatePreloadRowHeights:function(){var a=this.preload;if(a){for(;a.previous;)a=a.previous;for(;a;)a.rowHeight||
(a.rowHeight=this.rowHeight||this._calcAverageRowHeight(a.node.parentNode.querySelectorAll(".dgrid-row")),this._adjustPreloadHeight(a)),a=a.next}},lastScrollTop:0,_processScroll:function(a){function d(a,b){b=b?"next":"previous";for(var c;c=a[b];)a=c;return a}function e(a,e){function f(){var c;a:{c=!e;for(var d=a;d=d[e?"previous":"next"];)if(c===d.top){c=d;break a}c=void 0}if(c&&k!==c&&!b(c.top?c.node.nextSibling:c.node.previousSibling))return h(),a=c,r=a.node,m=e?a.node.offsetTop-p:n-(a.node.offsetTop+
a.node.offsetHeight),v=(c=g(r))&&c.rowIndex,y=void 0,c}function g(a){var d=b(a);(a=a[u])&&!c(a)&&(a=d&&b(a)?null:(d=f())?d:g(a));return a}function h(){a.count+=t;e&&(r.rowIndex-=t);l._adjustPreloadHeight(a);t=0;l._releaseRange(a,e,v,y)}var k=a;a=d(a,e);var m=e?a.node.offsetTop-p:n-(a.node.offsetTop+a.node.offsetHeight),q=l.farOffRemoval,r=a.node,u=e?"previousSibling":"nextSibling",t=0,w=0,v,y;if(m>2*q){var x;v=(x=g(r))&&x.rowIndex;for(y=void 0;x&&k!==a;){var z=l._calcRowHeight(x);w+z+q>m||!c(x)?x=
f():(w+=z,t+=x.count||1,l._pruneRow(x,e),"rowIndex"in x&&(y=x.rowIndex),x=g(x))}h();l._deleteNodeQueue()}}function f(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var g=this.preload,k;this._updatePreloadRowHeights();if(k=g&&g.rowHeight){var l=this,m=l.bodyNode,n=a&&a.scrollTop||this.getScrollPosition().y,p=m.offsetHeight+n,A;a=l.lastScrollTop;var m=l.bufferRows*k,E=m-k,B,G=!0;for(l.lastScrollTop=n;g&&!g.node.offsetWidth;)g=g.previous;for(;g&&g!==A;){A=l.preload;l.preload=g;
k=g.node;var F=k.offsetTop;if(p+1+E<F)g=f(g,G=!1);else if(n-1-E>F+k.offsetHeight)g=f(g,G=!0);else{var F=((k.top?n-m:p)-F)/g.rowHeight,K=(p-n+2*m)/g.rowHeight,K=K+Math.min(Math.abs(Math.max(Math.min((n-a)*g.rowHeight,l.maxRowsPerPage/2),l.maxRowsPerPage/-2)),10);k.top&&(F-=K);F=Math.max(F,0);10>F&&0<F&&K+F<l.maxRowsPerPage&&(K+=Math.max(0,F),F=0);K=Math.min(Math.max(K,l.minRowsPerPage),l.maxRowsPerPage,g.count);if(0===K)g=f(g,G);else{var K=Math.ceil(K),F=Math.min(Math.floor(F),g.count-K),H={};g.count-=
K;var N=k,I,J=l.queryRowsOverlap,M=!g.top&&g;M?(g.previous&&(e(g),0<F&&b(k.previousSibling)?(F=Math.min(g.count,F),g.previous.count+=F,l._adjustPreloadHeight(g.previous,!0),k.rowIndex+=F,J=0):K+=F,g.count-=F),H.start=k.rowIndex-J,H.count=Math.min(K+J,l.maxRowsPerPage),k.rowIndex=H.start+H.count):(g.next&&(N=k.nextSibling,e(g,!0),b(k.nextSibling)?(g.next.count+=g.count-F,g.next.node.rowIndex=F+K,l._adjustPreloadHeight(g.next),g.count=F,J=0,N=g.next.node):I=!0),H.start=g.count,H.count=Math.min(K+J,
l.maxRowsPerPage),H.scrollingUp=!0);I&&N&&N.offsetWidth&&(I=N.offsetTop);l._adjustPreloadHeight(g);"level"in g.query&&(H.queryLevel=g.query.level);if("queryLevel"in H||!(H.start>l._total||0>H.count)){var L=h.create("div",{className:"dgrid-loading",style:{height:K*g.rowHeight+"px"}},N,"before");h.create("div",{className:"dgrid-"+(M?"below":"above"),innerHTML:l.loadingMessage},L);L.count=K;l._trackError(function(){(function(a,b,c){var d=g.query(H);B=l.renderQueryResults(d,a,H).then(function(e){var f=
l._rows;!f||"queryLevel"in H||!e.length||(b?(f.max<=f.min&&(f.min=e[0].rowIndex),f.max=e[e.length-1].rowIndex):(f.max<=f.min&&(f.max=e[e.length-1].rowIndex),f.min=e[0].rowIndex));N=a.nextSibling;h.destroy(a);c&&N&&N.offsetWidth&&l.scrollTo({y:l.bodyNode.scrollTop+N.offsetTop-c});d.totalLength.then(function(a){"queryLevel"in H||(l._total=a,l._rows&&l._rows.max>=l._total-1&&(l._rows.max=Infinity));b&&(b.count=a-b.node.rowIndex,l._adjustPreloadHeight(b))});l._processScroll();return e},function(b){h.destroy(a);
throw b;})})(L,M,I)});g=g.previous}}}}return B}},_adjustPreloadHeight:function(a,b){a.node.style.height=this._calculatePreloadHeight(a,b)+"px"},_calculatePreloadHeight:function(a,b){return Math.min(a.count*a.rowHeight,b?Infinity:this.maxEmptySpace)},_pruneRow:function(a,b,c){this.removeRow(a,!0,c);this._queueNodeForDeletion(a)},_queueNodeForDeletion:function(a){this._deleteQueue.push(a)},_deleteNodeQueue:function(){for(var a=document.createElement("div"),b=this._deleteQueue,c=b.length;c--;)a.appendChild(b[c]);
this._deleteQueue=[];setTimeout(function(){h.destroy(a)},1)},_removePreloads:function(a){if(a&&a.length){var b=this,c=this._getHeadPreload();a.forEach(function(a){if(a=b._findPreload(a,c))a.previous&&(a.previous.next=a.next),a.next&&(a.next.previous=a.previous)})}},_getHeadPreload:function(){var a=this.preload;if(a)for(;a.previous;)a=a.previous;return a},_findPreload:function(a,b){for(b||(b=this._getHeadPreload());b;){if(b.node===a)return b;b=b.next}},_getRenderedCollection:function(){return this._renderedCollection},
_releaseRange:function(a,b,c,d){if(a){var e=a.level;a=this._getRenderedCollection(a);null!=d&&a.releaseRange&&"number"===typeof c&&"number"===typeof d&&(b?a.releaseRange(d,c+1):a.releaseRange(c,d+1),this._rows&&!e&&(this._rows[b?"max":"min"]=d,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(n,a,m,k,h,d,g,l){function f(a){if("object"!==
typeof a)a=Error(a);else if("cancel"===a.dojoType)return;g.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return n(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};k.before(this,"configStructure",a.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);
this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_setCollection:function(a){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!a||a.storage!==this._renderedCollection.storage}));this.collection=a;if(this._started){if(a){var b=a;this.sort&&0<this.sort.length&&(b=a.sort(this.sort));b.track&&this.shouldTrackCollection&&
(b=b.track(),this._rows=[],this._observerHandle=this._observeCollection(b,this.contentNode,{rows:this._rows}));this._renderedCollection=b}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(a){a=a||{};this._renderedCollection.tracking&&this._renderedCollection.tracking.remove();this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=
this._rows=null);!1!==a.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var a=this;this._refreshTimeout=setTimeout(function(){g.emit(a.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:a});a._refreshTimeout=
null},0)},_insertNoDataNode:function(a){this._removeNoDataNode();a=a||this.contentNode;var b=this.noDataNode=h.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});a.insertBefore(b,this._getFirstRowSibling?this._getFirstRowSibling(a):null);return b},_removeNoDataNode:function(){return this.noDataNode?(h.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var a=this.inherited(arguments);a&&a.data&&"undefined"!==typeof a.id&&(a.id=this.collection.getIdentity(a.data));
return a},refresh:function(){var a=this.inherited(arguments);this.collection||this._insertNoDataNode();return a},refreshCell:function(c){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(c.row.id).then(a.hitch(this,"_refreshCellFromItem",c))},_refreshCellFromItem:function(c,b,d){var e=c.element;h.empty(e);var f=this.dirty&&this.dirty[c.row.id];f&&(b=a.delegate(b,f));this._createBodyRowCell(e,
c.column,b,d)},renderArray:function(){var a=this.inherited(arguments);this.collection||a.length&&this.noDataNode&&h.destroy(this.noDataNode);return a},insertRow:function(c,b,d,f,g){var e=this.collection,k=this.dirty,e=e&&e.getIdentity(c),l;e in k&&!(e in this._updating)&&(l=k[e]);l&&(c=a.delegate(c,l));k=this.inherited(arguments);g&&g.rows&&(g.rows[f]=k);this.noDataNode&&(h.destroy(this.noDataNode),this.noDataNode=null);return k},updateDirty:function(a,b,d){var c=this.dirty,e=c[a];e||(e=c[a]={});
e[b]=d},save:function(){function a(a,c){return function(e){var g=b._columnsWithSet,k=b._updating,l,m;if("function"===typeof e.set)e.set(c);else for(l in c)e[l]=c[l];for(l in g)m=g[l].set(e),void 0!==m&&(e[l]=m);k[a]=!0;return d.put(e).then(function(b){delete f[a];delete k[a];h[a]=b;return h})}}var b=this,d=this.collection,f=this.dirty,g=new m,h={},k=function(a){var c;return b.getBeforePut||!(c=b.row(a).data)?function(){return d.get(a)}:function(){return c}},l=g.then(function(){return h}),n;for(n in f)var y=
a(n,f[n]),l=l.then(k(n)).then(y);g.resolve();return l},revert:function(){this.dirty={};this.refresh()},_trackError:function(c){"string"===typeof c&&(c=a.hitch(this,c));var b=this,d;try{d=l(c())}catch(p){c=new m,c.reject(p),d=c.promise}d.otherwise(function(a){f.call(b,a)});return d},removeRow:function(a,b,d){var c={element:a};b||this.up(c).element!==a||this.down(c).element!==a||this._insertNoDataNode();(c=d&&d.rows||this._rows)&&delete c[a.rowIndex];return this.inherited(arguments)},renderQueryResults:function(c,
b,d){d=a.mixin({rows:this._rows},d);var e=this;return c.then(function(a){a=e.renderArray(a,b,d);delete e._lastCollection;return a})},_observeCollection:function(a,b,d){var c=this,e=d.rows,f,g=[a.on("delete, update",function(a){var g=a.previousIndex,h=a.index;void 0!==g&&e[g]&&("max"in e&&(void 0===h||h<e.min||h>e.max)&&e.max--,f=e[g],f.parentNode===b&&c.removeRow(f,!1,d),e.splice(g,1),("delete"===a.type||"update"===a.type&&(g<h||void 0===h))&&e[g]&&e[g].rowIndex--);"delete"===a.type&&(f=null)}),a.on("add, update",
function(a){var g=a.previousIndex,h=a.index;if(void 0!==h&&(!("max"in e)||h>=e.min&&h<=e.max)){"max"in e&&(void 0===g||g<e.min||g>e.max)&&e.max++;if(e.length){if(g=e[h],!g&&(g=e[h-1]))g=(g.connected||g).nextSibling}else g=c._getFirstRowSibling&&c._getFirstRowSibling(b);f&&g&&f.id===g.id&&(g=(g.connected||g).nextSibling);g&&!g.parentNode&&(g=document.getElementById(g.id));e.splice(h,0,void 0);f=c.insertRow(a.target,b,g,h,d);c.highlightRow(f)}f=null}),a.on("add, delete, update",function(b){var d="undefined"!==
typeof b.previousIndex?b.previousIndex:Infinity,f="undefined"!==typeof b.index?b.index:Infinity,g=Math.min(d,f);d!==f&&e[g]&&c.adjustRowIndices(e[g]);Infinity!==d&&c._processScroll&&(e[d]||e[d-1])&&c._processScroll();c._onNotification(e,b,a);a===c._renderedCollection&&"totalLength"in b&&(c._total=b.totalLength)})];return{remove:function(){for(;0<g.length;)g.pop().remove()}}},_onNotification:function(){}})})},"dgrid/Selection":function(){define("dojo/_base/declare dojo/dom-class dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch dojo/query dojo/_base/sniff dojo/dom".split(" "),
function(n,a,m,k,h,d,g){function l(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function f(a,b){var d=a.bodyNode,e=b?"text":"-moz-none";c&&"msUserSelect"!==c?d.style[c]=e:k("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=m(d,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==
b&&"TEXTAREA"!==b&&a.preventDefault()}):(l(d,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=h.after(a,"renderRow",function(a){l(a,!0);return a})}k.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});k.add("dom-selectstart","undefined"!==typeof document.onselectstart);var c=k("css-user-select"),b=(d=k("pointer"))&&"MS"===d.slice(0,2),e=d?d+(b?"Down":"down"):"mousedown",p=d?
d+(b?"Up":"up"):"mouseup";"WebkitUserSelect"===c&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(c=!1);return n(null,{selectionDelegate:".dgrid-row",selectionEvents:e+","+p+",dgrid-cellfocusin",selectionTouchEvents:k("touch")?g.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!==this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},
_setAllowTextSelection:function(a){"undefined"!==typeof a?f(this,a):f(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==p||b===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32===a.keyCode)if(!a.shiftKey&&a.type===e&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,
b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a.metaKey;this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,d=a.keyCode?a.ctrlKey:a.metaKey,e;a.shiftKey||(e=d?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:
a.metaKey)||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,c=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};k("touch")&&!k("pointer")&&this.selectionTouchEvents?(m(b,g.selector(c,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),m(b,m.selector(c,this.selectionEvents),function(b){a._ignoreMouseSelect!==
this?a._handleSelect(b,this):b.type===p&&(a._ignoreMouseSelect=null)})):m(b,m.selector(c,this.selectionEvents),function(b){a._handleSelect(b,this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(b){b.metaKey&&65===b.keyCode&&!/\bdgrid-input\b/.test(b.target.className)&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setCollection&&h.before(this,"_setCollection",function(b){a._updateDeselectionAspect(b)});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(a){function b(a,b){if((a=c.row(a))&&c.selection[a.id])c[b](a)}var c=this,d;this._removeDeselectSignals&&this._removeDeselectSignals();d=a&&a.track&&this._observeCollection?[h.before(this,"_observeCollection",function(a){d.push(a.on("delete",function(a){"undefined"===typeof a.index&&b(a.id,"deselect")}))}),h.after(this,"_observeCollection",function(a){d.push(a.on("update",function(c){"undefined"!==typeof c.index&&b(a.getIdentity(c.target),
"select")}))},!0)]:[h.before(this,"removeRow",function(a,b){b||(a=this.row(a))&&a.id in this.selection&&this.deselect(a)})];this._removeDeselectSignals=function(){for(var a=d.length;a--;)d[a].remove();d=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];m.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=
this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(b,c,d){var e,f,g;"undefined"===typeof d&&(d=!0);b.element||(b=this.row(b));if(!1===d||this.allowSelect(b))if(e=this.selection,f=!!e[b.id],null===d&&(d=!f),g=b.element,d||this.allSelected?e[b.id]=d:delete this.selection[b.id],g&&(d?a.add(g,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):a.remove(g,"dgrid-selected ui-state-active")),d!==f&&g&&this._selectionEventQueues[(d?"":"de")+"select"].push(b),
c)if(c.element||(c=this.row(c)),c){if(c=c.element)for(e=this._determineSelectionDirection(g,c),e||(c=document.getElementById(c.id),e=this._determineSelectionDirection(g,c));b.element!==c&&(b=this[e](b));)this._select(b,null,d)}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:k("dom-comparedocumentposition")?function(a,b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this.inherited(arguments),b=this.selection,c,d,e;for(c=0;c<a.length;c++)d=this.row(a[c]),(e=d.id in b?b[d.id]:this.allSelected)&&this.select(d,null,e);this._fireSelectionEvents();return a}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(n,a,m){return n("dojo.store.Memory",null,{constructor:function(a){for(var h in a)this[h]=a[h];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:m,
get:function(a){return this.data[this.index[a]]},getIdentity:function(a){return a[this.idProperty]},put:function(a,h){var d=this.data,g=this.index,k=this.idProperty,k=a[k]=h&&"id"in h?h.id:k in a?a[k]:Math.random();if(k in g){if(h&&!1===h.overwrite)throw Error("Object already exists");d[g[k]]=a}else g[k]=d.push(a)-1;return k},add:function(a,h){(h=h||{}).overwrite=!1;return this.put(a,h)},remove:function(a){var h=this.index,d=this.data;if(a in h)return d.splice(h[a],1),this.setData(d),!0},query:function(k,
h){return a(this.queryEngine(k,h)(this.data))},setData:function(a){a.items?(this.idProperty=a.identifier||this.idProperty,a=this.data=a.items):this.data=a;this.index={};for(var h=0,d=a.length;h<d;h++)this.index[a[h][this.idProperty]]=h}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(n,a,m){var k=function(h){function d(a){h[a]=function(){var d=arguments,c=m(h,function(b){Array.prototype.unshift.call(d,b);return k(n[a].apply(n,d))});
if("forEach"!==a||g)return c}}if(!h)return h;var g=!!h.then;g&&(h=a.delegate(h));d("forEach");d("filter");d("map");null==h.total&&(h.total=m(h,function(a){return a.length}));return h};a.setObject("dojo.store.util.QueryResults",k);return k})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(n){return function(a,m){function k(d){d=n.filter(d,a);var g=m&&m.sort;g&&d.sort("function"==typeof g?g:function(a,c){for(var b,d=0;b=g[d];d++){var f=a[b.attribute],h=c[b.attribute],
f=null!=f?f.valueOf():f,h=null!=h?h.valueOf():h;if(f!=h)return!!b.descending==(null==f||f>h)?-1:1}return 0});if(m&&(m.start||m.count)){var h=d.length;d=d.slice(m.start||0,(m.start||0)+(m.count||Infinity));d.total=h}return d}switch(typeof a){default:throw Error("Can not query with a "+typeof a);case "object":case "undefined":var h=a;a=function(a){for(var d in h){var k=h[d];if(k&&k.test){if(!k.test(a[d],a))return!1}else if(k!=a[d])return!1}return!0};break;case "string":if(!this[a])throw Error("No filter function "+
a+" was found in store");a=this[a];case "function":}k.matches=a;return k}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){m.isAsync||l(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var p=a("dojo.dnd.Source",b,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){k.mixin(this,k.mixin({},b));a=this.accept;if(a.length)for(this.accept={},b=0;b<a.length;++b)this.accept[a[b]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&h.add(this.node,"dojoDndSource");this.targetState="";this.accept&&h.add(this.node,"dojoDndTarget");this.horizontal&&h.add(this.node,"dojoDndHorizontal");this.topics=
[f.subscribe("/dnd/source/over",k.hitch(this,"onDndSourceOver")),f.subscribe("/dnd/start",k.hitch(this,"onDndStart")),f.subscribe("/dnd/drop",k.hitch(this,"onDndDrop")),f.subscribe("/dnd/cancel",k.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&
(b=this==e.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){p.superclass.destroy.call(this);n.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){p.superclass.onMouseMove.call(this,a);var b=e.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var f=
this.getSelectedNodes();f.length&&b.startDrag(this,f,this.copyState(c.getCopyKeyState(a),!0))}this.isDragging&&(f=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=d.position(this.current,!0)),f=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==d.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||f!=this.before)&&(this._markTargetAnchor(f),b.canDrop(!this.current||b.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&c.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,p.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,p.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=e.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||
a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?c?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&e.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,d){var e=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return e.call(this,a.getItem(b.id).data,c)}:d?function(b){var d=a.getItem(b.id);b=b.cloneNode(!0);b.id=c.getUniqueId();return{node:b,data:d.data,type:d.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);
return{node:b,data:c.data,type:c.type}};this.selectNone();d||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=e},onDropInternal:function(a,b){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=c.getUniqueId();return{node:a,
data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){p.superclass.onOverEvent.call(this);e.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){p.superclass.onOutEvent.call(this);
e.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!g.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(h.contains(a,"dojoDndHandle"))return!0;if(h.contains(a,"dojoDndItem")||h.contains(a,"dojoDndIgnore"))break}return!1}});return p})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e){var p=a("dojo.dnd.Selector",e,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(f(this.node,c.press,k.hitch(this,"onMouseDown")),f(this.node,c.release,k.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new l,c=b._empty,d;for(d in this.selection)d in c||a.push(h.byId(d));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(a,b){this._addItemClass(h.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=b._empty,c;for(c in this.selection)if(!(c in a)){var e=h.byId(c);this.delItem(c);d.destroy(e)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,c){c=c||m.global;var d=this.selection,e=b._empty,f;for(f in d)f in e||a.call(c,this.getItem(f),f,this)},sync:function(){p.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],c=b._empty,d;for(d in this.selection)d in c||this.getItem(d)||a.push(d);n.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,b,c,d){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){b=e.call(this,b,c);a?(this.anchor?this.anchor!=b.node&&(this._removeItemClass(b.node,"Anchor"),this._addItemClass(b.node,"Selected")):(this.anchor=b.node,this._removeItemClass(b.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[b.node.id]=1):(this._removeItemClass(b.node,"Selected"),this._removeItemClass(b.node,"Anchor"));return b};p.superclass.insertNodes.call(this,b,c,d);this._normalizedCreator=e;return this},destroy:function(){p.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!b.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,g.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){b.getCopyKeyState(a)||this._removeSelection();var c=this.getAllNodes();if(c.length&&(this.anchor||(this.anchor=c[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,e;d<c.length&&(e=c[d],e!=this.anchor&&e!=this.current);++d);for(++d;d<c.length;++d){e=c[d];if(e==this.anchor||e==this.current)break;this._addItemClass(e,"Selected");this.selection[e.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?b.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):b.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=f(this.node,c.move,k.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=b._empty,c;for(c in this.selection)if(!(c in a)){var d=h.byId(c);d&&this._removeItemClass(d,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return p})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],function(n,a,m){a=a.NodeList;var k=a.prototype;k.connect=a._adaptAsForEach(function(){return n.connect.apply(this,arguments)});k.coords=a._adaptAsMap(n.coords);a.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");
m.forEach(a.events,function(a){var d="on"+a;k[d]=function(a,h){return this.connect(d,a,h)}});return n.NodeList=a})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){a=a("dojo.dnd.Container",f,{skipForm:!1,allowNested:!1,constructor:function(a,c){this.node=d.byId(a);c||(c={});this.creator=c.creator||
null;this.skipForm=c.skipForm;this.parent=c.dropParent&&d.byId(c.dropParent);this.map={};this.current=null;this.containerState="";g.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[b(this.node,p.over,k.hitch(this,"onMouseOver")),b(this.node,p.out,k.hitch(this,"onMouseOut")),b(this.node,"dragstart",k.hitch(this,"onSelectStart")),b(this.node,"selectstart",k.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,
b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||m.global;var c=this.map,d=q._empty,e;for(e in c)e in d||a.call(b,c[e],e,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return e((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=q.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");
a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);
return this},destroy:function(){n.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=q._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&
b!=this.node;)try{b=b.parentNode}catch(u){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(w){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.withHandles||
this.skipForm&&q.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a;a=a.toLowerCase()+"State";g.replace(this.node,c+b,c+this[a]);this[a]=b},_addItemClass:function(a,b){g.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){g.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&g.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(a,b){a=(this.creator||this.defaultCreator).call(this,a,b);k.isArray(a.type)||(a.type=["text"]);a.node.id||(a.node.id=q.getUniqueId());g.add(a.node,"dojoDndItem");return a}});q._createNode=function(a){return a?function(b){return l.create(a,{innerHTML:b})}:q._createSpan};q._createTrTd=function(a){var b=l.create("tr");l.create("td",{innerHTML:a},b);return b};q._createSpan=function(a){return l.create("span",{innerHTML:a})};q._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};q._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?q._createTrTd:q._createNode(q._defaultCreatorNodes[a]);return function(a,c){var d=a&&k.isObject(a),e;d&&a.tagName&&a.nodeType&&a.getAttribute?(e=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"]):(e=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],a=("avatar"==c?q._createSpan:b)(String(e)));a.id||(a.id=q.getUniqueId());return{node:a,data:e,type:d}}};
return a})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q){var r=a("dojo.dnd.Manager",[d],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:g("touch")?4:16,OFFSET_Y:g("touch")?4:16,overSource:function(a){this.avatar&&
(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());c.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),c.publish("/dnd/source/over",null)):c.publish("/dnd/source/over",null)},startDrag:function(a,d,e){function g(a){a.preventDefault();a.stopPropagation()}p.autoScrollStart(k.doc);this.source=a;this.nodes=d;this.copy=!!e;this.avatar=this.makeAvatar();k.body().appendChild(this.avatar.node);
c.publish("/dnd/start",a,d,this.copy);this.events=[f(k.doc,b.move,m.hitch(this,"onMouseMove")),f(k.doc,b.release,m.hitch(this,"onMouseUp")),f(k.doc,"keydown",m.hitch(this,"onKeyDown")),f(k.doc,"keyup",m.hitch(this,"onKeyUp")),f(k.doc,"dragstart",g),f(k.body(),"selectstart",g)];a="dojoDnd"+(e?"Copy":"Move");h.add(k.body(),a)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){h.remove(k.body(),["dojoDndCopy","dojoDndMove"]);
n.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new q(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(p.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(e.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));g("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&
this.canDropFlag){var b=!!this.source.copyState(e.getCopyKeyState(a));c.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);c.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else c.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case l.CTRL:a=!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case l.ESCAPE:c.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==l.CTRL&&(a=
!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();h.replace(k.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});e._manager=null;r.manager=e.manager=function(){e._manager||(e._manager=new r);return e._manager};return r})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(n,a,m,k,h,d,g,l){return n("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var a=d.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),c=this.manager.source,b,e=d.create("tbody",null,a),h=d.create("tr",null,e),l=d.create("td",null,h),m=Math.min(5,this.manager.nodes.length),n=0;g("highcontrast")&&d.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},l);d.create("span",{innerHTML:c.generateText?
this._generateText():""},l);for(k.set(h,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});n<m;++n)c.creator?b=c._normalizedCreator(c.getItem(this.manager.nodes[n].id).data,"avatar").node:(b=this.manager.nodes[n].cloneNode(!0),"tr"==b.tagName.toLowerCase()&&(h=d.create("table"),d.create("tbody",null,h).appendChild(b),b=h)),b.id="",h=d.create("tr",null,e),l=d.create("td",null,h),l.appendChild(b),k.set(h,{"class":"dojoDndAvatarItem",style:{opacity:(9-n)/10}});this.node=a},destroy:function(){d.destroy(this.node);
this.node=!1},update:function(){h.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(g("highcontrast")){var a=m.byId("a11yIcon"),c="+";this.manager.canDropFlag&&!this.manager.copy?c="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(c="x"):c="o";a.innerHTML=c}l("tr.dojoDndAvatarHeader td span"+(g("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(n,a,m,k){return n("dijit.CheckedMenuItem",m,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:k,checked:!1,_setCheckedAttr:function(a){this.domNode.setAttribute("aria-checked",a?"true":"false");this._set("checked",a)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(a){this.disabled||
(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(a)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e){g=n("dijit.MenuItem"+(d("dojo-bidi")?"_NoBidi":""),[l,f,c,b],{templateString:e,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",
a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c);a=a.substr(c+3);c=d+b+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);
m.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&m.set(this.accelKeyNode,"id",this.id+"_accel");a.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==d("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(p){}},_setSelected:function(a){k.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){h.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){h.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.",
"","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,m.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});d("dojo-bidi")&&(g=n("dijit.MenuItem",g,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));
return g})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y){function t(a){return function(b){this._isLoaded?this.inherited(a,arguments):
this.loadDropDown(l.hitch(this,a,b))}}var x=a("dijit.form._SelectMenu",p,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(f(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;l.isArray(b)&&(b=b[b.length-1]);b&&n.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,
this.focusChild(c,!1))},this);a||this.inherited(arguments)}});h=a("dijit.form.Select"+(c("dojo-bidi")?"_NoBidi":""),[b,e,u],{baseClass:"dijitSelect dijitValidationTextBox",templateString:y,_buttonInputDisabled:c("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",
this.options[0<=a?a:0].value)}this.dropDown=new x({id:this.id+"_menu",parentWidget:this});k.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var b=l.hitch(this,"_setValueAttr",a);a=new q({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,onClick:b,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||
!1});a.focusNode.setAttribute("role","option");return a}return new r({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(z){}},focusChild:function(a){a&&this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},
_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=v.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{n.forEach(this._getChildren(),function(a){a.destroyRecursive()});var b=new q({ownerDocument:this.ownerDocument,label:this.emptyLabel});
this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);m.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},
_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},
validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?w.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):w.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);w.hide(this.domNode);
this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=d.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(f(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[g.LEFT_ARROW];delete a[g.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);k.toggle(this.domNode,
this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);w.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){w.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});c("dojo-bidi")&&(h=
a("dijit.form.Select",h,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));h._Menu=x;h.prototype._onContainerKeydown=t("_onContainerKeydown");h.prototype._onContainerKeypress=t("_onContainerKeypress");return h})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p){return h("dijit.form._FormSelectWidget",p,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(f.isArrayLike(a))return n.map(a,"return this.getOptions(item);",this);f.isString(a)&&(a={value:a});f.isObject(a)&&(n.some(b,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){n.forEach(f.isArrayLike(a)?a:[a],function(a){a&&f.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(f.isArrayLike(a)?
a:[a]);n.forEach(a,function(a){a&&(this.options=n.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){n.forEach(f.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,b,c){l.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,c)},_deprecatedSetStore:function(c,d,g){var h=this.store;g=g||{};if(h!==c){for(var l;l=this._notifyConnections.pop();)l.remove();c.get||(f.mixin(c,{_oldAPI:!0,get:function(b){var c=new a;this.fetchItemByIdentity({identity:b,onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(b,c){var d=new a(function(){g.abort&&g.abort()});d.total=new a;var g=this.fetch(f.mixin({query:b,onBegin:function(a){d.total.resolve(a)},
onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},c));return new e(d)}}),c.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[m.after(c,"onNew",f.hitch(this,"_onNewItem"),!0),m.after(c,"onDelete",f.hitch(this,"_onDeleteItem"),!0),m.after(c,"onSet",f.hitch(this,"_onSetItem"),!0)]));this._set("store",c)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);g.query&&this._set("query",g.query);g.queryOptions&&this._set("queryOptions",g.queryOptions);c&&c.query&&(this._loadingStore=!0,this.onLoadDeferred=new a,this._queryRes=c.query(this.query,this.queryOptions),b(this._queryRes,f.hitch(this,function(a){if(this.sortByLabel&&!g.sort&&a.length)if(c.getValue)a.sort(k.createSortFunction([{attribute:c.getLabelAttributes(a[0])[0]}],c));else{var b=this.labelAttr;a.sort(function(a,c){return a[b]>c[b]?1:c[b]>
a[b]?-1:0})}g.onFetch&&(a=g.onFetch.call(this,a,g));n.forEach(a,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(f.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:d);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(a):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),f.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return h},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=f.isArrayLike(a)?n.map(a,function(a){return f.isObject(a)?a:{value:a}}):f.isObject(a)?[a]:[{value:a}];a=n.filter(this.getOptions(a),function(a){return a&&a.value});var c=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!c.length||(a[0]=
c[0]);n.forEach(c,function(b){b.selected=n.some(a,function(a){return a.value===b.value})});c=n.map(a,function(a){return a.value});if("undefined"!=typeof c&&"undefined"!=typeof c[0]){var d=n.map(a,function(a){return a.label});this._setDisplay(this.multiple?d:d[0]);this.inherited(arguments,[this.multiple?c:c[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=n.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(n.forEach(this._getChildren(),function(a){a.destroyRecursive()}),n.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;n.forEach(this._getChildren(),function(c){var d=n.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);g.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=n.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?n.map(n.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);d.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?c("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+l._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);m.after(this,"onChange",f.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(n){var a={};n.setObject("dojo.data.util.sorter",a);a.basicComparator=function(a,k){var h=-1;null===a&&(a=void 0);null===k&&(k=void 0);if(a==k)h=0;else if(a>k||null==a)h=1;return h};a.createSortFunction=function(m,k){function h(a,b,c,d){return function(e,f){e=d.getValue(e,a);f=d.getValue(f,a);
return b*c(e,f)}}for(var d=[],g,l=k.comparatorMap,f=a.basicComparator,c=0;c<m.length;c++){g=m[c];var b=g.attribute;if(b){g=g.descending?-1:1;var e=f;l&&("string"!==typeof b&&"toString"in b&&(b=b.toString()),e=l[b]||f);d.push(h(b,g,e,k))}}return function(a,b){for(var c=0;c<d.length;){var e=d[c++](a,b);if(0!==e)return e}return 0}};return a})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w){return n("dijit._HasDropDown",w,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(a){this.disabled||this.readOnly||("MSPointerDown"!=a.type&&a.preventDefault(),this.own(b.once(this.ownerDocument,e.release,c.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(a){var b=
this.dropDown,c=!1;if(a&&this._opened){var e=d.position(this._buttonNode,!0);if(!(a.pageX>=e.x&&a.pageX<=e.x+e.w&&a.pageY>=e.y&&a.pageY<=e.y+e.h)){for(e=a.target;e&&!c;)h.contains(e,"dijitPopup")?c=!0:e=e.parentNode;if(c){e=a.target;if(b.onItemClick){for(var f;e&&!(f=p.byNode(e));)e=e.parentNode;if(f&&f.onClick&&f.getParent)f.getParent().onItemClick(f,a)}return}}}this._opened?b.focus&&(!1!==b.autoFocus||"mouseup"==a.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){b.focus();
delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(a){this._stopClickEvents&&(a.stopPropagation(),a.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";h.add(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);var a=this.focusNode||this.domNode;this.own(b(this._buttonNode,e.press,c.hitch(this,"_onDropDownMouseDown")),b(this._buttonNode,"click",c.hitch(this,"_onDropDownClick")),b(a,"keydown",c.hitch(this,"_onKey")),b(a,"keyup",c.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),
delete this.dropDown);this.inherited(arguments)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var b=this.dropDown,c=a.target;b&&this._opened&&b.handleKey&&!1===b.handleKey(a)?(a.stopPropagation(),a.preventDefault()):b&&this._opened&&a.keyCode==f.ESCAPE?(this.closeDropDown(),a.stopPropagation(),a.preventDefault()):!this._opened&&(a.keyCode==f.DOWN_ARROW||(a.keyCode==f.ENTER||a.keyCode==f.SPACE&&(!this._searchTimer||a.ctrlKey||a.altKey||a.metaKey))&&("input"!==(c.tagName||"").toLowerCase()||
c.type&&"text"!==c.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,a.stopPropagation(),a.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var a=this.dropDown;a&&a.focus&&this.defer(c.hitch(a,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(a){a()},loadAndOpenDropDown:function(){var b=new a,d=c.hitch(this,function(){this.openDropDown();b.resolve(this.dropDown)});
this.isLoaded()?d():this.loadDropDown(d);return b},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var a=this.dropDown,b=a.domNode,e=this._aroundNode||this.domNode,f=this,g=r.open({parent:this,popup:a,around:e,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){f.closeDropDown(!0)},onCancel:function(){f.closeDropDown(!0)},onClose:function(){k.set(f._popupStateNode,"popupActive",
!1);h.remove(f._popupStateNode,"dijitHasDropDownOpen");f._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&e.offsetWidth>a._popupWrapper.offsetWidth){var e=e.offsetWidth-a._popupWrapper.offsetWidth,l={w:a.domNode.offsetWidth+e};this._origStyle=b.style.cssText;c.isFunction(a.resize)?a.resize(l):d.setMarginBox(b,l);"R"==g.corner[1]&&(a._popupWrapper.style.left=a._popupWrapper.style.left.replace("px","")-e+"px")}k.set(this._popupStateNode,"popupActive","true");h.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",a.id);"presentation"===b.getAttribute("role")||b.getAttribute("aria-labelledby")||b.setAttribute("aria-labelledby",this.id);return g},closeDropDown:function(a){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),a&&this.focus&&this.focus(),r.close(this.dropDown),
this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(n,a,m,k,h,d){return n("dijit.MenuSeparator",[m,k,h],{templateString:d,buildRendering:function(){this.inherited(arguments);a.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare",
"dojo/keys","./_Spinner","./NumberTextBox"],function(n,a,m,k){return n("dijit.form.NumberSpinner",[m,k.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(a,d){var g=this.constraints,h=isNaN(a),f=!isNaN(g.max),c=!isNaN(g.min);h&&0!=d&&(a=0<d?c?g.min:f?g.max:0:f?this.constraints.max:c?g.min:0);d=a+d;if(h||isNaN(d))return a;f&&d>g.max&&(d=g.max);c&&d<g.min&&(d=g.min);return d},_onKeyDown:function(h){if(!(this.disabled||this.readOnly||h.keyCode!=a.HOME&&h.keyCode!=a.END||
h.ctrlKey||h.altKey||h.metaKey||"undefined"==typeof this.get("value"))){var d=this.constraints[h.keyCode==a.HOME?"min":"max"];"number"==typeof d&&this._setValueAttr(d,!1);h.stopPropagation();h.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(n,a,m,k,h,d,g,l,f,c){return n("dijit.form._Spinner",l,{defaultTimeout:500,
minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:f,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,d,f){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),d*f),!1),c.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(b,c,d){var e=
this.smallDelta;c==this.textbox&&(c=d.keyCode,e=c==a.PAGE_UP||c==a.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==a.UP_ARROW||c==a.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==b?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,e)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:b;if(0!==a){var c=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(c,
a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(c)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,
c){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(d(this.domNode,h.wheel,m.hitch(this,"_mouseWheeled")),g.addListener(this.upArrowNode,this.textbox,{keyCode:a.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),g.addListener(this.downArrowNode,this.textbox,{keyCode:a.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,
"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),g.addListener(this.upArrowNode,this.textbox,{keyCode:a.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),g.addListener(this.downArrowNode,this.textbox,{keyCode:a.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),
function(n,a,m,k,h,d){var g=d.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(m.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(a,d,c,b,e,g,h,k){if(e!=this._obj){this.stop();this._initialDelay=h||500;this._subsequentDelay=
g||.9;this._minDelay=k||10;this._obj=e;this._node=c;this._count=this._currentTimeout=-1;this._callback=m.hitch(d,b);this._evt={faux:!0};for(var f in a)"layerX"!=f&&"layerY"!=f&&(d=a[f],"function"!=typeof d&&"undefined"!=typeof d&&(this._evt[f]=d));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(d,f,c,b,e,h,q){var l="keyCode"in f?"keyCode":"charCode"in
f?"charCode":"charOrCode",p=[k(d,"keyCode"in f?"keydown":"charCode"in f?"keypress":a._keypress,m.hitch(this,function(a){a[l]!=f[l]||void 0!==f.ctrlKey&&f.ctrlKey!=a.ctrlKey||void 0!==f.altKey&&f.altKey!=a.altKey||void 0!==f.metaKey&&f.metaKey!=(a.metaKey||!1)||void 0!==f.shiftKey&&f.shiftKey!=a.shiftKey?g._obj==f&&g.stop():(a.stopPropagation(),a.preventDefault(),g.trigger(a,c,d,b,f,e,h,q))})),k(d,"keyup",m.hitch(this,function(){g._obj==f&&g.stop()}))];return{remove:function(){n.forEach(p,function(a){a.remove()})}}},
addMouseListener:function(a,d,c,b,e,p){var f=[k(a,"mousedown",m.hitch(this,function(f){f.preventDefault();g.trigger(f,d,a,c,a,b,e,p)})),k(a,"mouseup",m.hitch(this,function(a){this._obj&&a.preventDefault();g.stop()})),k(a,"mouseout",m.hitch(this,function(a){this._obj&&a.preventDefault();g.stop()})),k(a,"dblclick",m.hitch(this,function(f){f.preventDefault();9>h("ie")&&(g.trigger(f,d,a,c,a,b,e,p),setTimeout(m.hitch(this,g.stop),50))}))];return{remove:function(){n.forEach(f,function(a){a.remove()})}}},
addListener:function(a,d,c,b,e,g,h,k){var f=[this.addKeyListener(d,c,b,e,g,h,k),this.addMouseListener(a,b,e,g,h,k)];return{remove:function(){n.forEach(f,function(a){a.remove()})}}}};return g})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(n,a,m){return n("dijit.form.RangeBoundTextBox",m,{rangeMessage:"",rangeCheck:function(a,h){return("min"in h?0<=this.compare(a,h.min):!0)&&("max"in h?0>=this.compare(a,h.max):
!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var a=this.get("value");if(null==a)return!1;var h=!1;"min"in this.constraints&&(h=this.constraints.min,h=0>this.compare(a,"number"==typeof h&&0<=h&&0!=a?0:h));!h&&"max"in this.constraints&&(h=this.constraints.max,h=0<this.compare(a,"number"!=typeof h||0<h?h:0));return h},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(a){return this.inherited(arguments)&&
(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(a))},getErrorMessage:function(a){var h=this.get("value");return null==h||""===h||"number"==typeof h&&isNaN(h)||this.isInRange(a)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=a.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare",
"dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(n,a,m,k){return n("dijit.form.MappedTextBox",k,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(a){return a.toString?a.toString():""},toString:function(){var a=this.filter(this.get("value"));return null!=a?"string"==typeof a?a:this.serialize(a,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},
buildRendering:function(){this.inherited(arguments);this.valueNode=m.place("\x3cinput type\x3d'hidden'"+(this.name?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(n,a,m,k,h,d){var g=function(a){a=a||{};var c=m.getLocalization("dojo.cldr",
"number",m.normalizeLocale(a.locale)),b=a.pattern?a.pattern:c[(a.type||"decimal")+"Format"];a="number"==typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,""):-1!=b.indexOf(".")?b.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:c.decimal,places:a}},l=n("dijit.form.NumberTextBoxMixin",null,{pattern:function(d){return"("+(this.focused&&this.editOptions?this._regExpGenerator(a.delegate(d,this.editOptions))+"|":"")+this._regExpGenerator(d)+")"},value:NaN,
editOptions:{pattern:"#.######"},_formatter:h.format,_regExpGenerator:h.regexp,_decimalInfo:g(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(a){var c="number"==typeof a.places?a.places:0;c&&c++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-c));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-c));this.inherited(arguments,[a]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=
g(a)},_onFocus:function(a){if(!this.disabled&&!this.readOnly){var c=this.get("value");"number"!=typeof c||isNaN(c)||(c=this.format(c,this.constraints),void 0!==c&&(this.textbox.value=c,"mouse"!==a&&this.textbox.select()));this.inherited(arguments)}},format:function(d,c){var b=String(d);if("number"!=typeof d)return b;if(isNaN(d))return"";if(!("rangeCheck"in this&&this.rangeCheck(d,c))&&!1!==c.exponent&&/\de[-+]?\d/i.test(b))return b;this.editOptions&&this.focused&&(c=a.mixin({},c,this.editOptions));
return this._formatter(d,c)},_parser:h.parse,parse:function(d,c){var b=a.mixin({},c,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=b.places){var e=b.places,e="number"===typeof e?e:Number(e.split(",").pop());b.places="0,"+e}b=this._parser(d,b);this.editOptions&&this.focused&&isNaN(b)&&(b=this._parser(d,c));return b},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==a||"string"==typeof a&&""==
a)return NaN;"number"!=typeof a||isNaN(a)||0==a||(a=h.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,c){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var d=a.hitch(a.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(d,!0)},_setValueAttr:function(a,c,b){if(void 0!==a&&void 0===b)if(b=String(a),"number"==typeof a)if(isNaN(a))b="";else{if("rangeCheck"in this&&this.rangeCheck(a,this.constraints)||!1===
this.constraints.exponent||!/\de[-+]?\d/i.test(b))b=void 0}else a?a=void 0:(b="",a=NaN);this.inherited(arguments,[a,c,b])},_getValueAttr:function(){var d=this.inherited(arguments);if(isNaN(d)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+h._realNumberRegexp(a.delegate(this.constraints))+"$")).test(this.textbox.value))return d=Number(this.textbox.value),isNaN(d)?void 0:d}else return d},isValid:function(a){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);
var c=this.get("value");return!isNaN(c)&&this.rangeCheck(c,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var a="number"==typeof this.constraints.min,c="number"==typeof this.constraints.max,b=this.get("value");if(isNaN(b)||!a&&!c)return this.inherited(arguments);var d=b|0,g=0>b,h=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),l=(this.maxLength||20)-this.textbox.value.length,m=h?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,
""):"",d=h?d+"."+m:d+"",l=k.rep("9",l),h=b;g?h=Number(d+l):b=Number(d+l);return!(a&&b<this.constraints.min||c&&h>this.constraints.max)}});n=n("dijit.form.NumberTextBox",[d,l],{baseClass:"dijitTextBox dijitNumberTextBox"});n.Mixin=l;return n})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b){var e=f("dijit.ColorPalette",[m,k,h],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:a,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,c,d){return new this._dyeClass(a,
b,c,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=f(e._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],g.getLocalization("dojo","colors",this.lang))}});e._Color=f("dijit._Color",l,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":n.toUrl("./themes/a11y/colors7x10.png"),"3x4":n.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,b,c,d){this._title=d;this._row=b;this._col=c;this.setColor(l.named[a])},getValue:function(){return this.toHex()},fillCell:function(a,e){e=b.substitute(d("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:e,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});c.place(e,a)}});return e})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(n,a,m,k,h,d,g,l,f,c,b){return n("dijit._PaletteMixin",l,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?d.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,c){this._cells=[];var e=this._blankGif;this.own(g(this.gridNode,f,d.hitch(this,"_onCellClick")));for(var l=0;l<a.length;l++)for(var m=k.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),n=0;n<a[l].length;n++){var p=a[l][n];if(p){var y=this._dyeFactory(p,l,n,c[p]),p=k.create("td",{"class":this.cellClass,tabIndex:"-1",title:c[p],role:"gridcell"},m);y.fillCell(p,e);p.idx=this._cells.length;this._cells.push({node:p,
dye:y})}}this._xDim=a[0].length;this._yDim=a.length;var t={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},x;for(x in t)this.own(b.addKeyListener(this.domNode,{keyCode:h[x],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=t[x];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){c.focus(this._currentFocus)},
_onCellClick:function(a){for(var b=a.target;"TD"!=b.tagName;){if(!b.parentNode||b==this.gridNode)return;b=b.parentNode}var d=this._getDye(b).getValue();this._setCurrent(b);c.focus(b);this._setValueAttr(d,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(b){"_currentFocus"in this&&a.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=b)&&a.set(b,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&m.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;m.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,b){-1!=b&&(a=this._currentFocus.idx+a,a<this._cells.length&&-1<a&&(a=this._cells[a].node,this._setCurrent(a),this.defer(d.hitch(c,"focus",a))))},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(n,a,m,k){var h={};a.setObject("dojo.colors",h);var d=function(a,d,c){0>c&&++c;1<c&&--c;var b=6*c;return 1>b?a+(d-a)*b:1>2*c?d:2>3*c?a+(d-a)*(2/3-c)*6:a};n.colorFromRgb=m.fromRgb=function(a,f){var c=a.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(c){a=c[2].split(/\s*,\s*/);var b=a.length,c=c[1];if("rgb"==c&&3==b||"rgba"==c&&4==b)return c=a[0],"%"==c.charAt(c.length-1)?(c=k.map(a,
function(a){return 2.56*parseFloat(a)}),4==b&&(c[3]=a[3]),m.fromArray(c,f)):m.fromArray(a,f);if("hsl"==c&&3==b||"hsla"==c&&4==b){var c=(parseFloat(a[0])%360+360)%360/360,e=parseFloat(a[1])/100,g=parseFloat(a[2])/100,e=.5>=g?g*(e+1):g+e-g*e,g=2*g-e,c=[256*d(g,e,c+1/3),256*d(g,e,c),256*d(g,e,c-1/3),1];4==b&&(c[3]=a[3]);return m.fromArray(c,f)}}return null};var g=function(a,d,c){a=Number(a);return isNaN(a)?c:a<d?d:a>c?c:a};m.prototype.sanitize=function(){this.r=Math.round(g(this.r,0,255));this.g=Math.round(g(this.g,
0,255));this.b=Math.round(g(this.b,0,255));this.a=g(this.a,0,1);return this};h.makeGrey=m.makeGrey=function(a,d){return m.fromArray([a,a,a,d])};a.mixin(m.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,
149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,
0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],
lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,
232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,
250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return m})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x){var z=a("dijit.form._SliderMover",b,{onMouseMove:function(a){var b=this.widget,c=b._abspos;c||(c=b._abspos=h.position(b.sliderBarContainer,!0),b._setPixelValue_=l.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(a){b.prototype.destroy.apply(this,arguments);var c=this.widget;c._abspos=null;c._setValueAttr(c.value,
!0)}});m=a("dijit.form.HorizontalSlider",[y,t],{templateString:x,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:r.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case g.HOME:this._setValueAttr(this.minimum,!1);break;case g.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?g.RIGHT_ARROW:g.LEFT_ARROW:case !1===this._descending?g.DOWN_ARROW:g.UP_ARROW:case !1===this._descending?g.PAGE_DOWN:g.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?g.LEFT_ARROW:g.RIGHT_ARROW:case !1===this._descending?g.UP_ARROW:g.DOWN_ARROW:case !1===this._descending?g.PAGE_UP:g.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(f("ie")||w.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&
this.clickSelect){w.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=h.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
d.style[this._progressPixelSize]){var f=this,g={},h=parseFloat(d.style[this._progressPixelSize]),l=this.slideDuration*(c-h/100);0!=l&&(0>l&&(l=0-l),g[this._progressPixelSize]={start:h,end:100*c,units:"%"},this._inProgressAnim=k.animateProperty({node:d,duration:l,onAnimate:function(a){e.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:g}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=
100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var c=d.getComputedStyle(this.sliderBarContainer),e=h.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=e[this._pixelCount];c--;a=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>a&&(a=0);a>c&&(a=c);a=a*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==g.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==g.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(n.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var a=e('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(u.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),u.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(q(this.domNode,
p.wheel,l.hitch(this,"_mouseWheeled")));var b=a(z,{widget:this});this._movable=new c(this.sliderHandle,{mover:b});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});m._Mover=z;return m})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(n,a,m){return n("dijit.form.HorizontalRule",[a,m],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',
count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(a){return this._positionPrefix+a+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var a;if(1==this.count)a=this._genHTML(50,0);else{var h,d=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){a=this._genHTML(0,0);for(h=1;h<
this.count-1;h++)a+=this._genHTML(d*h,h);a+=this._genHTML(100,this.count-1)}else{a=this._genHTML(100,0);for(h=1;h<this.count-1;h++)a+=this._genHTML(100-d*h,h);a+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=a}})})},"dojo/_base/query":function(){define(["../query","./NodeList"],function(n){return n})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),
function(n,a,m,k,h,d,g,l,f){k("dijit-legacy-requires")&&d(0,function(){n(["dijit/form/RadioButton"])});return a("dijit.form.CheckBox",[g,l],{templateString:f,baseClass:"dijitCheckBox",_setValueAttr:function(a,b){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,b)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},
_fillContent:function(){},_onFocus:function(){this.id&&h("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&h("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(n,a,m,k){return n("dijit.form.ToggleButton",[m,k],{baseClass:"dijitToggleButton",setChecked:function(h){a.deprecated("setChecked("+
h+") is deprecated. Use set('checked',"+h+") instead.","","2.0");this.set("checked",h)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(n,a){return n("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(a){var k=this.checked;this._set("checked",!k);var h=this.inherited(arguments);this.set("checked",h?this.checked:k);return h},_setCheckedAttr:function(m,k){this._set("checked",m);var h=this.focusNode||this.domNode;
this._created&&a.get(h,"checked")!=!!m&&a.set(h,"checked",!!m);h.setAttribute(this._aria_attr,String(m));this._handleOnChange(m,k)},postCreate:function(){this.inherited(arguments);var a=this.focusNode||this.domNode;this.checked&&a.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare",
"dojo/dom-attr"],function(n,a){return n("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(m){this._set("readOnly",m);a.set(this.focusNode,"readOnly",m)},_setLabelAttr:void 0,_getSubmitValue:function(a){return null==a||""===a?"on":a},_setValueAttr:function(m){m=this._getSubmitValue(m);this._set("value",m);a.set(this.focusNode,"value",m)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));
a.set(this.focusNode,"value",this.value)},_onClick:function(a){return this.readOnly?(a.stopPropagation(),a.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(n,a,m){return n("dijit.form.ComboBox",[a,m],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(n,a,m,k,h,d,g,l,f){return n("dijit.form.ComboBoxMixin",[l,d],{dropDownClass:g,hasDownArrow:!0,templateString:f,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(c){c.get||k.mixin(c,{_oldAPI:!0,get:function(b){var c=new a;this.fetchItemByIdentity({identity:b,
onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(b,c){var d=new a(function(){e.abort&&e.abort()});d.total=new a;var e=this.fetch(k.mixin({query:b,onBegin:function(a){d.total.resolve(a)},onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},c));return h(d)}});this._set("store",c)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var b=this.declaredClass;k.mixin(this.store,{getValue:function(a,c){m.deprecated(b+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[c]},getLabel:function(a){m.deprecated(b+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){m.deprecated(b+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
k.hitch(this,function(b){(new b({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(n,a,m,k,h,d,g,l,f,c,b){a=a("dijit.form._AutoCompleterMixin",b,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var b=0;if("number"==typeof a.selectionStart)b=a.selectionStart;else if(l("ie")){var c=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();c.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",c),b=String(a.text).replace(/\r/g,"").length}catch(r){}}return b},_setCaretPos:function(a,b){b=parseInt(b);c.selectInputText(a,b,b)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(b!=k.ALT&&b!=k.CTRL&&b!=k.META&&b!=k.SHIFT){var c=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!(a.altKey||a.ctrlKey||a.metaKey))switch(this._opened&&(d=c.getHighlightedOption()),b){case k.PAGE_DOWN:case k.DOWN_ARROW:case k.PAGE_UP:case k.UP_ARROW:this._opened&&this._announceOption(d);a.stopPropagation();a.preventDefault();break;case k.ENTER:if(d){if(d==
c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(d==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case k.TAB:b=this.get("displayedValue");if(c&&(b==c._messages.previousMessage||b==c._messages.nextMessage))break;d&&this._selectOption(d);case k.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(a){var b=this.focusNode;c.selectInputText(b,b.value.length);var d=this.ignoreCase?"toLowerCase":"substr";0==a[d](0).indexOf(this.focusNode.value[d](0))?(d=this.autoComplete?this._getCaretPos(b):b.value.length,d+1>b.value.length&&(b.value=a,c.selectInputText(b,d))):(b.value=a,c.selectInputText(b))},_openResultList:function(a,b,c){var d=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();a.length||0!=c.start?(this._nextSearch=this.dropDown.onPage=h.hitch(this,
function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,c,h.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in c?(c.direction?this.dropDown.highlightFirstOption():c.direction||this.dropDown.highlightLastOption(),d&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(b[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;!b||a!=b._messages.previousMessage&&a!=b._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,c){var d="";a&&(c||(c=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),d=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):c);this.set("value",d,b,c,a)},_announceOption:function(a){if(a){var b;
if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();this.set("item",c,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",m.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&
this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (h.isString(this.dropDownClass)?h.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:h.hitch(this,
this._selectOption),id:b,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new f({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=d('label[for\x3d"'+
this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);n.after(this,"onSearch",h.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var c=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),d=this.queryExpr.indexOf("${0}");b=g.escapeString(b);return this._escapeHtml(a.replace(new RegExp((0==d?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(a,b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,c,d){this._set("item",d||null);null==a&&(a="");this.inherited(arguments)}});l("dojo-bidi")&&a.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return a})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(n,a,m,k,h,d){function g(a){return{id:a.value,value:a.value,name:m.trim(a.innerText||a.textContent||"")}}return n("dijit.form.DataList",h,{constructor:function(h,f){this.domNode=a.byId(f);m.mixin(this,h);this.id&&d.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:k("option",this.domNode).map(g)}])},destroy:function(){d.remove(this.id)},fetchSelectedItem:function(){var a=k("\x3e option[selected]",this.domNode)[0]||k("\x3e option",this.domNode)[0];return a&&g(a)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(n,a,m,k,h,d,g){return n("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return new RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,c,b,d){return b?".*":
d?".":c?c:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(d){if(!this.disabled&&
!this.readOnly){d=d.charOrCode;this._prev_key_backspace=!1;if(d==a.DELETE||d==a.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var f=this,c=m.clone(this.query),b={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},e=h.substitute(this.queryExpr,
[a.replace(/([\\\*\?])/g,"\\$1")]),g,k=function(){var a=f._fetchHandle=f.store.query(c,b);f.disabled||f.readOnly||g!==f._lastQuery||d(a,function(e){f._fetchHandle=null;f.disabled||f.readOnly||g!==f._lastQuery||d(a.total,function(a){e.total=a;var d=f.pageSize;if(isNaN(d)||d>e.total)d=e.total;e.nextPage=function(a){b.direction=a=!1!==a;b.count=d;a?(b.start+=e.length,b.start>=e.total&&(b.count=0)):(b.start-=d,0>b.start&&(b.count=Math.max(d+b.start,0),b.start=0));0>=b.count?(e.length=0,f.onSearch(e,c,
b)):k()};f.onSearch(e,c,b)})},function(a){f._fetchHandle=null;f._cancelingQuery||console.error(f.declaredClass+" "+a.toString())})};m.mixin(b,this.fetchProperties);this.store._oldAPI?g=e:(g=this._patternToRegExp(e),g.toString=function(){return e});this._lastQuery=c[this.searchAttr]=g;this._queryDeferHandle=this.defer(k,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&(this.store=g.byId(a))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(n,a,m,k,h,d,g,l){return n("dijit.form._ComboBoxMenu",[h,d,l,g],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(a.add(this.previousButton,"dijitMenuItemRtl"),a.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(d){a.add(d,"dijitMenuItemHover")},onUnhover:function(d){a.remove(d,
"dijitMenuItemHover")},onSelect:function(d){a.add(d,"dijitMenuItemSelected")},onDeselect:function(d){a.remove(d,"dijitMenuItemSelected")},_page:function(a){var c=0,b=this.domNode.scrollTop,d=m.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();c<d;){var f=this.getHighlightedOption();if(a){if(!f.previousSibling||"none"==f.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!f.nextSibling||"none"==f.nextSibling.style.display)break;this.selectNextNode()}f=
this.domNode.scrollTop;c+=(f-b)*(a?-1:1);b=f}},handleKey:function(a){switch(a.keyCode){case k.DOWN_ARROW:return this.selectNextNode(),!1;case k.PAGE_DOWN:return this._page(!1),!1;case k.UP_ARROW:return this.selectPreviousNode(),!1;case k.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(n,a,m,k,h){var d=a("dijit.form._ComboBoxMenuMixin"+
(k("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=h.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(a){this._set("value",a);this.onChange(a)},onClick:function(a){if(a==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(a==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(a)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(a,d){var f=this._createMenuItem();a=d(a);a.html?f.innerHTML=a.label:f.appendChild(f.ownerDocument.createTextNode(a.label));""==f.innerHTML&&(f.innerHTML="\x26#160;");return f},createOptions:function(a,d,f){this.items=a;this.previousButton.style.display=0==d.start?"none":"";m.set(this.previousButton,"id",this.id+
"_prev");n.forEach(a,function(a,c){a=this._createOption(a,f);a.setAttribute("item",c);m.set(a,"id",this.id+c);this.nextButton.parentNode.insertBefore(a,this.nextButton)},this);var c=!1;a.total&&!a.total.then&&-1!=a.total?d.start+d.count<a.total?c=!0:d.start+d.count>a.total&&d.count==a.length&&(c=!0):d.count==a.length&&(c=!0);this.nextButton.style.display=c?"":"none";m.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var a=this.containerNode;2<a.childNodes.length;)a.removeChild(a.childNodes[a.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});k("dojo-bidi")&&(d=a("dijit.form._ComboBoxMenuMixin",
d,{_createOption:function(){var a=this.inherited(arguments);this.applyTextDir(a);return a}}));return d})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(n,a,m,k){return n("dijit.form._ListMouseMixin",k,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(a,d){this._setSelectedAttr(d,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(d)})},_onMouseDown:function(a,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(d,!1)},_onMouseUp:function(a,d){this._isDragging=!1;var g=this.selected,h=this._hoveredNode;g&&d==g?this.defer(function(){this._onClick(a,
g)}):h&&this.defer(function(){this._onClick(a,h)})},_onMouseOut:function(a,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(a,d){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=d;this.onHover(d);this._isDragging&&this._setSelectedAttr(d,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(n,a,m){return n("dijit.form._ListBase",null,{selected:null,_listConnect:function(k,h){var d=this;return d.own(a(d.containerNode,a.selector(function(a,d,f){return a.parentNode==f},k),function(a){d[h](a,this)}))},selectFirstNode:function(){for(var a=this.containerNode.firstChild;a&&"none"==a.style.display;)a=a.nextSibling;this._setSelectedAttr(a,!0)},selectLastNode:function(){for(var a=this.containerNode.lastChild;a&&"none"==a.style.display;)a=a.previousSibling;this._setSelectedAttr(a,
!0)},selectNextNode:function(){var a=this.selected;if(a){for(a=a.nextSibling;a&&"none"==a.style.display;)a=a.nextSibling;a?this._setSelectedAttr(a,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var a=this.selected;if(a){for(a=a.previousSibling;a&&"none"==a.style.display;)a=a.previousSibling;a?this._setSelectedAttr(a,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(a,h){if(this.selected!=a){var d=this.selected;if(d)this.onDeselect(d);
a&&(h&&m.scrollIntoView(a),this.onSelect(a));this._set("selected",a)}else if(a)this.onSelect(a)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(n){n(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main dojo/ready".split(" "),function(n,a,m,k,h,d,g,l,f,c,b,e,p,q,r,w,u,v,y,t,x,z,A,E){function B(){var a=window.location.search;if(""===a)return{};var a=p.queryToObject(a.substr(1)),
b;for(b in a)a[b]=t.sanitizeHTML(a[b]);return a}d={};f=t.getEsriConfigRequestObject();f.timeout=18E4;"function"!==typeof c.getAll&&(c.getAll=function(a){var b=[];(a=c(a))&&b.push(a);return b});window.jimuNls=A;v.setProtocolErrorHandler(function(){return!0});v=t.getAncestorWindow();var G=!1;try{G=0===v.location.href.indexOf("https://")}catch(K){}var F=/\/SceneServer\/layers\/\d+\/?$/;f.interceptors=[{before:function(a){a&&"object"===typeof a.requestOptions&&!a.requestOptions.content&&F.test(a.url)&&
(a.content={f:"json"});a.requestOptions.query&&a.requestOptions.query.printFlag&&(a.timeout=3E5);G&&(a.url=a.url.replace(/^http(s?):\/\//gi,"https://"));-1===a.url.indexOf("/queryRelatedRecords?")||t.isHostedService(a.url)||(a.url=a.url.replace("FeatureServer","MapServer"))}}];g(window,"mousedown",function(a){if(l.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-
a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=h.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.14";window.productVersion="Online 7.3";d.initApp=function(){var b,c;console.log("jimu.js init...");b=B();m.getInstance();k.setStyle(jimuConfig.loadingId,"display","none");k.setStyle(jimuConfig.mainPageId,
"display","block");c=a.getInstance({mapId:jimuConfig.mapId,urlParams:b},jimuConfig.layoutId);b=n.getInstance(b);c.startup();b.loadConfig();E(function(){setTimeout(function(){k.removeClass(document.body,"dj_a11y")},50)})};return d});