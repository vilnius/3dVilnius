// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Legend/nls/Legend ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/decorators/cast ./Widget ./Legend/LegendViewModel ./Legend/styles/Card ./Legend/styles/Classic ./support/widget".split(" "),function(A,m,f,g,a,e,v,r,l,x,d,n,y,p,h){return function(b){function c(a){a=b.call(this)||
this;a._handles=new v;a.activeLayerInfos=null;a.basemapLegendVisible=!1;a.groundLegendVisible=!1;a.iconClass="esri-icon-layer-list";a.label=e.widgetLabel;a.layerInfos=null;a.style=new p;a.view=null;a.viewModel=new n;return a}g(c,b);c.prototype.postInitialize=function(){var b=this;this.own(r.on(this,"activeLayerInfos","change",function(){return b._refreshActiveLayerInfos(b.activeLayerInfos)}),r.init(this,"style",function(a,c){c&&a!==c&&c.destroy();a&&(a.activeLayerInfos=b.activeLayerInfos,"card"===
a.type&&(a.view=b.view))}))};c.prototype.destroy=function(){this._handles.destroy();this._handles=null};c.prototype.castStyle=function(b){if(b instanceof y||b instanceof p)return b;if("string"===typeof b)return"card"===b?new y:new p;if(b&&"string"===typeof b.type){var a=f({},b);delete a.type;return new ("card"===b.type?y:p)(a)}return new p};c.prototype.render=function(){return this.style.render()};c.prototype._refreshActiveLayerInfos=function(b){var a=this;this._handles.removeAll();b.forEach(function(b){return a._renderOnActiveLayerInfoChange(b)});
this.scheduleRender()};c.prototype._renderOnActiveLayerInfoChange=function(b){var a=this,c=r.init(b,"version",function(){return a.scheduleRender()});this._handles.add(c,"version_"+b.layer.uid);b.children.forEach(function(b){return a._renderOnActiveLayerInfoChange(b)})};a([l.aliasOf("viewModel.activeLayerInfos"),h.renderable()],c.prototype,"activeLayerInfos",void 0);a([l.aliasOf("viewModel.basemapLegendVisible"),h.renderable()],c.prototype,"basemapLegendVisible",void 0);a([l.aliasOf("viewModel.groundLegendVisible"),
h.renderable()],c.prototype,"groundLegendVisible",void 0);a([l.property()],c.prototype,"iconClass",void 0);a([l.property()],c.prototype,"label",void 0);a([l.aliasOf("viewModel.layerInfos"),h.renderable()],c.prototype,"layerInfos",void 0);a([l.property(),h.renderable()],c.prototype,"style",void 0);a([x.cast("style")],c.prototype,"castStyle",null);a([l.aliasOf("viewModel.view"),h.renderable()],c.prototype,"view",void 0);a([l.property(),h.renderable(["view.size"])],c.prototype,"viewModel",void 0);return c=
a([l.subclass("esri.widgets.Legend")],c)}(l.declared(d))})},"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(A,m,f,g,a,e,v,r,l,x){var d=e.ofType(x),n="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.HeatmapLayer esri.layers.MapImageLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GeoJSONLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),
y=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(a){function h(b){b=a.call(this,b)||this;b._handles=new v;b._layerViewByLayerId={};b._layerInfosByLayerViewId={};b._activeLayerInfosByLayerViewId={};b.activeLayerInfos=new d;b.basemapLegendVisible=!1;b.groundLegendVisible=!1;b.layerInfos=[];b.view=null;return b}f(h,a);h.prototype.initialize=function(){this._handles.add(r.init(this,"view",this._viewHandles),"view")};
h.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});h.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(r.init(this,"state",this._stateHandles),"state")};h.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
h.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};h.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};h.prototype._destroyViewActiveLayerInfo=function(b){this._handles.remove(b);delete this._activeLayerInfosByLayerViewId[b]};h.prototype._watchPropertiesAndAllLayerViews=function(){var b=this.view.allLayerViews;
b.length&&this._refresh();this._handles.add(b.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(r.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};h.prototype._allLayerViewsChangeHandle=function(b){var a=this;b.removed.forEach(function(b){return a._destroyViewActiveLayerInfo(b.uid)});this._refresh()};h.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};h.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};h.prototype._sortActiveLayerInfos=function(b){var a={};this.view.allLayerViews.forEach(function(b,c){return a[b.layer.uid]=c});b.sort(function(b,c){return(a[c.layer.uid]||0)-(a[b.layer.uid]||
0)})};h.prototype._generateLayerViews=function(){var b=[];y.filter(this._filterLayerViews,this).map(this.get,this).filter(function(b){return null!=b}).forEach(this._collectLayerViews("layerViews",b));return b};h.prototype._filterLayerViews=function(b){var a=!this.groundLegendVisible&&"view.groundView.layerViews"===b;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===b||"view.basemapView.referenceLayerViews"===b))&&!a};h.prototype._collectLayerViews=function(b,a){var c=function(k){k&&
k.forEach(function(k){a.push(k);c(k[b])});return a};return c};h.prototype._filterLayerViewsByLayerInfos=function(b){var a=this,k=this.layerInfos;return k&&k.length?k.some(function(c){return a._hasLayerInfo(c,b)}):!0};h.prototype._hasLayerInfo=function(b,a){var c=this._isLayerUIDMatching(b.layer,a.layer.uid);c&&(this._layerInfosByLayerViewId[a.uid]=b);return c};h.prototype._isLayerUIDMatching=function(b,a){return b&&(b.uid===a||this._hasLayerUID(b.layers,a))};h.prototype._hasLayerUID=function(b,a){var c=
this;return b&&b.some(function(b){return c._isLayerUIDMatching(b,a)})};h.prototype._isLayerViewSupported=function(b){return-1<n.indexOf(b.layer.declaredClass)?(this._layerViewByLayerId[b.layer.uid]=b,!0):!1};h.prototype._generateActiveLayerInfo=function(b){var a=this;this._isLayerActive(b)?this._buildActiveLayerInfo(b):(this._handles.remove(b.uid),this._handles.add(r.watch(b,"suspended, layer.legendEnabled",function(){return a._layerActiveHandle(b)}),b.uid))};h.prototype._layerActiveHandle=function(b){this._isLayerActive(b)&&
(this._handles.remove(b.uid),this._buildActiveLayerInfo(b))};h.prototype._isLayerActive=function(b){return!b.suspended&&b.get("layer.legendEnabled")};h.prototype._buildActiveLayerInfo=function(b){var a=this,k=b.layer,d=b.uid,h=this._layerInfosByLayerViewId[d],q=this._activeLayerInfosByLayerViewId[d];q||(q=new x({layer:k,title:h&&void 0!==h.title?h.title:k.title,view:this.view}),this._activeLayerInfosByLayerViewId[d]=q);q.parent||(h=(h=k.parent)&&this._layerViewByLayerId[h.uid],q.parent=h&&this._activeLayerInfosByLayerViewId[h.uid]);
if(!this._handles.has(d)){var h=r.watch(k,"title",function(c){return a._titleHandle(c,q,b)}),p=r.watch(k,"legendEnabled",function(c){return a._legendEnabledHandle(c,q,b)}),k=r.watch(k,"renderer?, opacity",function(){return a._constructLegendElements(q,b)}),e=r.watch(b,"suspended",function(c){return a._suspendedHandle(c,q,b)}),n=r.whenTrue(this.view,"stationary",function(){return a._scaleHandle(q,b)});this._handles.add([h,p,k,e,n],d);this._constructLegendElements(q,b)}this._addActiveLayerInfo(q,b)};
h.prototype._titleHandle=function(b,a,k){a.title=b;this._constructLegendElements(a,k)};h.prototype._legendEnabledHandle=function(b,a,k){b?this._addActiveLayerInfo(a,k):this._removeActiveLayerInfo(a)};h.prototype._suspendedHandle=function(b,a,k){b?this._removeActiveLayerInfo(a):this._addActiveLayerInfo(a,k)};h.prototype._scaleHandle=function(b,a){b.scale!==this.view.scale&&b.isScaleDriven&&this._constructLegendElements(b,a)};h.prototype._addActiveLayerInfo=function(b,a){this._isLayerActive(a)&&-1===
this.activeLayerInfos.indexOf(b)&&((a=b.parent,a)?-1===a.children.indexOf(b)&&(a.children.push(b),this._sortActiveLayerInfos(a.children)):(this.activeLayerInfos.add(b),this._sortActiveLayerInfos(this.activeLayerInfos)))};h.prototype._removeActiveLayerInfo=function(b){var a=b.parent;a?a.children.remove(b):this.activeLayerInfos.remove(b)};h.prototype._constructLegendElements=function(b,a){a=a.layer;b.scale=this.view.scale;a.featureCollections?b.buildLegendElementsForFeatureCollections(a.featureCollections):
a.renderer?b.buildLegendElementsForRenderer():a.url&&b.buildLegendElementsForTools()};g([l.property({type:d})],h.prototype,"activeLayerInfos",void 0);g([l.property()],h.prototype,"basemapLegendVisible",void 0);g([l.property()],h.prototype,"groundLegendVisible",void 0);g([l.property()],h.prototype,"layerInfos",void 0);g([l.property({dependsOn:["view.ready"],readOnly:!0})],h.prototype,"state",null);g([l.property()],h.prototype,"view",void 0);return h=g([l.subclass("esri.widgets.Legend.LegendViewModel")],
h)}(l.declared(a))})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/io-query ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/urlUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../renderers/support/jsonUtils ../../../symbols/support/gfxUtils ../../../symbols/support/symbolUtils ../../../symbols/support/utils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils".split(" "),
function(A,m,f,g,a,e,v,r,l,x,d,n,y,p,h,b,c,k,u,C,q,t,D,B,L,K,F){function E(a){return"esri.renderers.SimpleRenderer"===a.declaredClass}function z(a){return"esri.renderers.ClassBreaksRenderer"===a.declaredClass}function G(a){return"esri.renderers.UniqueValueRenderer"===a.declaredClass}function O(a){return"esri.renderers.HeatmapRenderer"===a.declaredClass}function I(a){return"esri.renderers.PointCloudClassBreaksRenderer"===a.declaredClass}function M(a){return"esri.renderers.PointCloudStretchRenderer"===
a.declaredClass}function N(a){return"esri.renderers.PointCloudUniqueValueRenderer"===a.declaredClass}var H=p.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),P=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,J=new l.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),Q=new l.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",outline:{width:1,color:[85,85,85,1]}});return function(p){function l(a){a=p.call(this,a)||this;a._handles=new y;a._hasColorRamp=!1;a._hasOpacityRamp=
!1;a._hasSizeRamp=!1;a._legendResponse={};a._webStyleSymbolCache=new Map;a._dotDensityUrlCache=new Map;a._dotDensityPoints=null;a.children=new n;a.layer=null;a.legendElements=[];a.parent=null;a.scale=null;a.title=null;a.view=null;return a}g(l,p);l.prototype.initialize=function(){var a=this,b=function(){return a.notifyChange("ready")};this._handles.add([c.on(this,"children","change",function(w){var k=w.removed,d=a._handles;w.added.map(function(a){var w="activeLayerInfo-ready-watcher-"+a.layer.uid;
d.add(c.init(a,"ready",b),w)});k.forEach(function(a){return d.remove(a.layer.uid)});b()})])};l.prototype.destroy=function(){this._handles.destroy();this._dotDensityPoints=this._dotDensityUrlCache=this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(l.prototype,"ready",{get:function(){return null===this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"isScaleDriven",
{get:function(){var a=this,b=this.layer;if(null===b)return!1;if(b.renderer){if("dot-density"===b.renderer.type)return!0;var c=b.get("renderer.valueExpression");return P.test(c)?!0:(b=b.get("renderer.visualVariables"))&&b.some(function(b){return a._isScaleDrivenSizeVariable(b)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});l.prototype.buildLegendElementsForFeatureCollections=function(a){var b=
this;this.legendElements=[];a.forEach(function(a){if("esri.layers.FeatureLayer"===a.declaredClass)b._buildRendererLegendElements(a.renderer,a.title,"append");else if(a.featureSet&&a.featureSet.features.length){var w=a.layerDefinition;(w=(w=w&&w.drawingInfo)&&C.fromJSON(w.renderer))?b._buildRendererLegendElements(w,a.name,"append"):H.warn("drawingInfo not available!")}})};l.prototype.buildLegendElementsForRenderer=function(){this._buildRendererLegendElements(this.layer.renderer,null,"replace")};l.prototype.buildLegendElementsForTools=
function(){var a=this,b=this.layer;"esri.layers.WMTSLayer"===b.declaredClass?this._constructLegendElementsForWMTSlayer():"esri.layers.WMSLayer"===b.declaredClass?this._constructLegendElementsForWMSSublayers():"esri.layers.MapImageLayer"===b.declaredClass?this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),this._getLegendLayers().then(function(w){a.legendElements=[];w.forEach(function(w){if("esri.layers.ImageryLayer"===a.layer.declaredClass){var c=b.watch("renderingRule, bandIds",
function(){a._legendResponse["default"]=null;a.buildLegendElementsForTools()});a._handles.add(c,"imageryLayers-watcher")}(w=a._generateSymbolTableElementForLegendLayer(w))&&w.infos.length&&a.legendElements.push(w);a.notifyChange("ready")});a.notifyChange("ready")}).catch(function(a){H.warn("Request to server for legend has failed!",a)}))};l.prototype._isGroupActive=function(){var a=this.children;return a.length?a.some(function(a){return a.ready}):!1};l.prototype._isScaleDrivenSizeVariable=function(a){if(a&&
"size"!==a.type)return!1;var b=a.minSize,w=a.maxSize;return"object"===typeof b&&b?this._isScaleDrivenSizeVariable(b):"object"===typeof w&&w?this._isScaleDrivenSizeVariable(w):!!a.expression||P.test(a.valueExpression)};l.prototype._buildRendererLegendElements=function(a,b,c){var w=this;this._getRendererLegendElements(a,b).then(function(a){"append"===c?Array.prototype.push.apply(w.legendElements,a):w.legendElements=a;w.notifyChange("ready")}).catch(function(a){H.warn("error while building legend for layer!",
a)})};l.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");var a=this.layer,b=a.activeLayer;this._handles.add(c.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(b.styleId&&b.styles){var k=null;b.styles.some(function(a){if(b.styleId===a.id)return k=a.legendUrl,!0});k&&(this.legendElements=[{type:"symbol-table",title:b.title,infos:[{src:k,opacity:a.opacity}]}])}this.notifyChange("ready")};
l.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");var a=this.layer,b=null;if(a.customParameters||a.customLayerParameters)b=f({},a.customParameters,a.customLayerParameters);this._handles.add(c.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(a.sublayers,b);this.notifyChange("ready")};l.prototype._generateLegendElementsForWMSSublayers=
function(a,b){var w=this,c=[];this._handles.add(a.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");a.forEach(function(a){var k=a.watch("title, visible, legendEnabled",function(){return w._constructLegendElementsForWMSSublayers()});w._handles.add(k,"wms-sublayers-watcher");a.visible&&a.legendEnabled&&(a=w._generateSymbolTableElementForWMSSublayer(a,b))&&a.infos.length&&c.unshift(a)});return c};l.prototype._generateSymbolTableElementForWMSSublayer=function(a,
b){return!a.legendUrl&&a.sublayers?(b=this._generateLegendElementsForWMSSublayers(a.sublayers,b).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:b}):this._generateSymbolTableElementForLegendUrl(a,b)};l.prototype._generateSymbolTableElementForLegendUrl=function(a,b){var w=a.legendUrl;if(w){var c={type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};b&&(w+="?"+e.objectToQuery(b));c.infos.push({src:w,opacity:a.layer&&a.layer.opacity});return c}};l.prototype._getLegendLayers=
function(a){var b=this,w=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",c=this._legendResponse&&this._legendResponse[w];return c?h.resolve(c):this._legendRequest(a).then(function(a){a=a.layers;return b._legendResponse[w]=a})};l.prototype._legendRequest=function(a){var b=this.layer;a={f:"json",dynamicLayers:a};"esri.layers.ImageryLayer"===b.declaredClass&&(b.renderingRule&&(a.renderingRule=JSON.stringify(b.renderingRule.toJSON())),b.bandIds&&(a.bandIds=b.bandIds.join()));var c=b.url.replace(/(\/)+$/,
"");10.01<=b.version?(b=c.indexOf("?"),c=-1<b?c.substring(0,b)+"/legend"+c.substring(b):c+"/legend"):(b=c.toLowerCase().indexOf("/rest/"),c=c.substring(0,b)+c.substring(b+5,c.length),c="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(c)+"\x26returnbytes\x3dtrue");return r(c,{query:a}).then(function(a){return a.data})};l.prototype._constructLegendElementsForSublayers=function(){var a=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var b=this.layer,k=new u.ExportImageParameters({layer:b});
this._getLegendLayers(k).then(function(k){var w={};k.forEach(function(a){w[a.layerId]=a});a._handles.add(c.watch(b,"sublayers",a._constructLegendElementsForSublayers.bind(a)),"sublayers-watcher");a.legendElements=a._generateLegendElementsForSublayers(b.sublayers,w,b.opacity);a.notifyChange("ready")}).catch(function(a){H.warn("Request to server for legend has failed!",a)}).then(function(){return k.destroy()});this.notifyChange("ready")};l.prototype._generateLegendElementsForSublayers=function(a,b,
c){var k=this,w=[];this._handles.add(a.on("change",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");a.forEach(function(a){var d=a.watch("renderer, opacity, title, visible",function(){return k._constructLegendElementsForSublayers()});k._handles.add(d,"sublayers-watcher");a.visible&&a.legendEnabled&&(d=a&&null!=a.opacity?a.opacity:null,(a=k._generateSymbolTableElementForSublayer(a,b,null!=d?d*c:c))&&a.infos.length&&w.unshift(a))});return w};l.prototype._generateSymbolTableElementForSublayer=
function(a,b,c){var k=b[a.id];return!k&&a.sublayers?(b=this._generateLegendElementsForSublayers(a.sublayers,b,c).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:b}):this._generateSymbolTableElementForLegendLayer(k,a,c)};l.prototype._generateSymbolTableElementForLegendLayer=function(a,c,k){var w=this;if(a){var d=c&&c.renderer,h=c&&c.title||a.layerName;d&&(d=c&&c.title||this._getRendererTitle(d,c))&&(h&&(d.title=h),h=d);h={type:"symbol-table",title:h,infos:[]};a.legendType&&(h.legendType=
a.legendType);a.legend&&this._isLegendLayerInScale(a,c)&&(c=c?this._sanitizeLegendForSublayer(a.legend.slice(),c):a.legend,h.infos=c.map(function(c){var d=c.url;if(c.imageData&&0<c.imageData.length)d="data:image/png;base64,"+c.imageData;else if(0!==d.indexOf("http"))d=b.addTokenParameter(w.layer.url+"/"+a.layerId+"/images/"+d);else return null;return{label:c.label,src:d,opacity:k,width:c.width,height:c.height}}).filter(function(a){return!!a}));return h.infos.length?h:null}};l.prototype._isLegendLayerInScale=
function(a,b){b=b||this.layer;var c=null,k=null,d=!0;!b.minScale&&0!==b.minScale||!b.maxScale&&0!==b.maxScale?(0===a.minScale&&b.tileInfo&&(c=b.tileInfo.lods[0].scale),0===a.maxScale&&b.tileInfo&&(k=b.tileInfo.lods[b.tileInfo.lods.length-1].scale)):(c=Math.min(b.minScale,a.minScale)||b.minScale||a.minScale,k=Math.max(b.maxScale,a.maxScale));if(0<c&&c<this.scale||k>this.scale)d=!1;return d};l.prototype._sanitizeLegendForSublayer=function(a,b){if(10.1>this.layer.version||0===a.length)return a;b=b.renderer;
var c=null,k=null;a.some(function(a){return a.values})&&a.some(function(a,b){a.values||(c=b,k=a,k.label||(k.label="others"));return null!=k});b?"unique-value"===b.type?k&&(a.splice(c,1),a.push(k)):"class-breaks"===b.type&&(k&&a.splice(c,1),a.reverse(),k&&a.push(k)):k&&(a.splice(c,1),a.push(k));return a};l.prototype._getRendererLegendElements=function(a,b){return E(a)||z(a)||G(a)||O(a)||I(a)||M(a)||N(a)||"esri.renderers.DotDensityRenderer"===a.declaredClass?I(a)||M(a)||N(a)||"esri.renderers.PointCloudRGBRenderer"===
a.declaredClass?this._constructPointCloudRendererLegendElements(a,b):"dot-density"===a.type?this._constructDotDensityRendererLegendElements(a):this._constructRendererLegendElements(a,b):(H.warn("Renderer not supported!"),h.resolve([]))};l.prototype._getPointCloudRendererTitle=function(a){return a.legendOptions&&a.legendOptions.title||a.field};l.prototype._constructPointCloudRendererLegendElements=function(a,b){var c=this,k=this.layer.opacity,d=[],w=null,p=null;if(I(a))w={type:"symbol-table",title:b||
this._getPointCloudRendererTitle(a),infos:[]},a.colorClassBreakInfos.forEach(function(a){w.infos.unshift({label:a.label||a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:c._getAppliedCloneSymbol(J,a.color,k)})});else if(M(a)){var p=a.stops,e=null;if(p.length&&(1===p.length&&(e=p[0].color),!e)){var n=p[0].value,z=p[p.length-1].value;null!=n&&null!=z&&(e=B.getColorFromPointCloudStops(n+(z-n)/2,p))}w={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(J,
e||J.color,k)}]};p={type:"color-ramp",title:b||this._getPointCloudRendererTitle(a),borderColor:q.getStroke(J).color,overlayColor:B.getRampOverlayColor(k),infos:B.getRampStopsForPointCloud(a.stops)}}else N(a)&&(w={type:"symbol-table",title:b||this._getPointCloudRendererTitle(a),infos:[]},a.colorUniqueValueInfos.forEach(function(a){w.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:c._getAppliedCloneSymbol(J,a.color,k)})}));w&&w.infos.length&&d.push(w);p&&p.infos.length&&
d.push(p);a=d.reduce(function(a,b){return a.concat(b.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return c._getSymbolPreview(a)});return h.eachAlways(a).then(function(){return d})};l.prototype._getElementInfoForDotDensity=function(a,b,c,k){var d={opacity:1,src:null,width:22,height:22},h=a+"-"+b+"-"+c+"-"+(k&&JSON.stringify(k.toJSON())),p=this._dotDensityUrlCache;if(p.has(h))return d.src=p.get(h),d;var q=Math.round(484/Math.pow(a,2)*.8),w=window.devicePixelRatio,e=document.createElement("canvas"),
n=22*w;e.width=n;e.height=n;e.style.width=e.width/w+"px";e.style.height=e.height/w+"px";var z=e.getContext("2d");c&&(z.fillStyle=c.toCss(!0),z.fillRect(0,0,n,n),z.fill());z.fillStyle=b.toCss(!0);if(this._dotDensityPoints&&this._dotDensityPoints.length/2===q)for(b=0;b<2*q;b+=2){c=this._dotDensityPoints[b];var f=this._dotDensityPoints[b+1];z.fillRect(c,f,a*w,a*w);z.fill()}else for(this._dotDensityPoints=[],b=0;b<2*q;b+=2)c=Math.floor(Math.random()*(n-0+1)+0),f=Math.floor(Math.random()*(n-0+1)+0),this._dotDensityPoints.push(c,
f),z.fillRect(c,f,a*w,a*w),z.fill();k&&(k.color&&(z.strokeStyle=k.color.toCss(!0)),z.lineWidth=k.width,z.strokeRect(0,0,n,n));d.src=e.toDataURL();p.set(h,d.src);return d};l.prototype._constructDotDensityRendererLegendElements=function(a){var b=this,c=a.calculateDotValue(this.view.scale),k={type:"symbol-table",title:{value:c&&Math.round(c),unit:a.legendOptions&&a.legendOptions.unit||""},infos:[]};a.attributes.forEach(function(c){var d=b._getElementInfoForDotDensity(a.dotSize,c.color,a.backgroundColor,
a.outline);d.label=c.label||c.valueExpressionTitle||c.field;k.infos.push(d)});return h.resolve([k])};l.prototype._constructRendererLegendElements=function(a,b){var c=this;return this._loadRenderer(a).then(function(a){c._hasColorRamp=!1;c._hasOpacityRamp=!1;c._hasSizeRamp=!1;var k=c._getVisualVariableLegendElements(a)||[],d={type:"symbol-table",title:b||c._getRendererTitle(a),infos:[]},p=null,q=!1;if(O(a))k.push({type:"heatmap-ramp",title:b,infos:L.getHeatmapRampStops(a)});else if(G(a)){var w=a&&a.authoringInfo;
if(w&&"relationship"===w.type){var e=w.focus,n=w.numClasses,f=w.field1,l=w.field2;if(n&&f&&l){for(var w=c.layer,f=[f,l],l=K.getRotationAngleForFocus(e)||0,C=0;C<f.length;C++){var t=f[C],g=t.normalizationField,t={field:c._getFieldAlias(t.field,w),normField:g&&c._getFieldAlias(g,w)},g=Q.clone();g.angle=l;d.infos.push({label:t,symbol:g});l+=90}e=K.getRelationshipRampElement({focus:e,numClasses:n,infos:a.uniqueValueInfos});k.unshift(e)}}else{var u=a.field;a.uniqueValueInfos.forEach(function(a){a.symbol&&
d.infos.push({label:a.label||c._getDomainName(u,a.value)||a.value,value:a.value,symbol:a.symbol})})}a.defaultSymbol&&(d.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),q=!0)}else z(a)?(p=c._isUnclassedRenderer(a),p&&c._hasSizeRamp||(a.classBreakInfos.forEach(function(a){a.symbol&&d.infos.unshift({label:a.label||(p?null:a.minValue+" - "+a.maxValue),value:[a.minValue,a.maxValue],symbol:a.symbol})}),p&&(d.title=null),c._updateInfosforClassedSizeRenderer(a,d.infos)),a.defaultSymbol&&
!p&&(d.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),q=!0)):E(a)&&a.symbol&&!c._hasSizeRamp&&d.infos.push({label:a.label,symbol:a.symbol});e=a.defaultSymbol;!e||q||E(a)||p&&!c._hasColorRamp&&!c._hasSizeRamp&&!c._hasOpacityRamp||k.push({type:"symbol-table",infos:[{label:a.defaultLabel||"others",symbol:e}]});d.infos.length&&k.unshift(d);var v=c._getSymbolConfig("visualVariables"in a&&a.visualVariables),q=k.reduce(function(a,b){return a.concat(b.infos)},[]).filter(function(a){return!(!a||
!a.symbol)}).map(function(a){return c._getSymbolPreview(a,v)});a=null;return h.eachAlways(q).then(function(){return k})})};l.prototype._updateInfosforClassedSizeRenderer=function(a,b){var c=a.authoringInfo&&"class-breaks-size"===a.authoringInfo.type,k=a.classBreakInfos.some(function(a){return D.isVolumetricSymbol(a.symbol)});if(c&&k){var d=F.REAL_WORLD_MAX_SIZE;a=a.classBreakInfos.length;var h=(d-F.REAL_WORLD_MIN_SIZE)/(1<a?a-1:a);b.forEach(function(a,b){a.size=d-h*b})}};l.prototype._getSymbolConfig=
function(a){var b=!1,c=!1;if(a)for(var k=0;k<a.length&&(!b||!c);k++){var d=a[k];"size"===d.type&&("height"===d.axis&&(b=!0),"width-and-depth"===d.axis&&(c=!0))}return b&&c?"tall":null};l.prototype._getSymbolPreview=function(a,b){return t.renderPreviewHTML(a.symbol,{size:a.size,opacity:this.layer.opacity,symbolConfig:b,rotation:a.symbol.angle}).then(function(b){a.preview=b;return a}).catch(function(){a.preview=null;return a})};l.prototype._loadRenderer=function(a){var b=this,c=[];a=a.clone();var k=
this._getMedianColor(a),d=this.layer.opacity;if(z(a)||G(a)){var p=(a.classBreakInfos||a.uniqueValueInfos).map(function(a){return b._fetchSymbol(a.symbol,k,d).then(function(b){a.symbol=b}).catch(function(){a.symbol=null})});Array.prototype.push.apply(c,p)}c.push(this._fetchSymbol(a.symbol||a.defaultSymbol,a.defaultSymbol?null:k,d).then(function(c){b._applySymbolToRenderer(a,c,E(a))}).catch(function(){b._applySymbolToRenderer(a,null,E(a))}));return h.eachAlways(c).then(function(){return a})};l.prototype._applySymbolToRenderer=
function(a,b,c){c?a.symbol=b:a.defaultSymbol=b};l.prototype._getMedianColor=function(a){if(!("visualVariables"in a&&a.visualVariables))return null;var b=d.find(a.visualVariables,function(a){return"color"===a.type});if(!b)return null;var c=null,k=null;if(b.stops){if(1===b.stops.length)return b.stops[0].color;c=b.stops[0].value;k=b.stops[b.stops.length-1].value}return a.getColor(c+(k-c)/2,{colorInfo:b})};l.prototype._fetchSymbol=function(a,b,c){var k=this;if(!a)return h.reject();if("web-style"===a.type){var d=
a.portal,d=a.name+"-"+a.styleName+"-"+a.styleUrl+"-"+(d&&d.url)+"-"+(d&&d.user&&d.user.username),p=this._webStyleSymbolCache;p.has(d)||p.set(d,a.fetchSymbol());return p.get(d).then(function(a){return k._getAppliedCloneSymbol(a,b,c)}).catch(function(){H.warn("Fetching web-style failed!");return h.reject()})}return h.resolve(this._getAppliedCloneSymbol(a,b,c))};l.prototype._getAppliedCloneSymbol=function(a,b,c){if(!a)return a;a=a.clone();var k=-1<a.type.indexOf("3d");b=b&&b.toRgba();k?this._applyColorTo3dSymbol(a,
b,c):(a.color&&(a.color=this._getOpacityAppliedColor(b||a.color.toRgba(),c)),(b=a.outline)&&b.color&&(b.color=this._getOpacityAppliedColor(b.color.toRgba(),c)));return a};l.prototype._applyColorTo3dSymbol=function(a,b,c){var k=this;a.symbolLayers.forEach(function(a){a&&(b&&(a.material||(a.material={}),a.material.color=new v(b)),null!=c&&(a.material&&a.material.color&&(a.material.color=k._getOpacityAppliedColor(a.material.color.toRgba(),c)),a.outline&&a.outline.color&&(a.outline.color=k._getOpacityAppliedColor(a.outline.color.toRgba(),
c))))})};l.prototype._getOpacityAppliedColor=function(a,b){a[3]*=b;return a};l.prototype._getVisualVariableLegendElements=function(a){var b=this;if(!("visualVariables"in a&&a.visualVariables))return null;var c=[],k=[],d=[],h=this.layer.opacity;a.visualVariables.forEach(function(a){"color"===a.type?c.push(a):"size"===a.type?k.push(a):"opacity"===a.type&&d.push(a)});var p=c.concat(k,d),q,e;0===c.length&&z(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&(q=(q=a.classBreakInfos[0])&&q.symbol);0===
c.length&&E(a)&&(q=a.symbol);q&&(-1<q.type.indexOf("3d")?(q=q.symbolLayers.getItemAt(0),q.get("material.color")&&(e=q.material.color)):q.url||(e=q.color),e&&(e=e.toRgba()));return p.map(function(c){if(!c.legendOptions||!1!==c.legendOptions.showLegend){var k=b._getRampTitle(c,b.layer),d=B.getRampBorderColor(a),q=B.getRampOverlayColor(h),p=null;"color"===c.type?(p={type:"color-ramp",title:k,borderColor:d,overlayColor:q,infos:B.getRampStops(a,c)},b._hasColorRamp||(b._hasColorRamp=!(null==p.infos||!p.infos.length))):
"size"===c.type?(p={type:"size-ramp",title:k,infos:F.getRampStops(a,c,b._getMedianColor(a),b.scale,b.view)},b._hasSizeRamp||(b._hasSizeRamp=!(null==p.infos||!p.infos.length))):"opacity"===c.type&&(p={type:"opacity-ramp",title:k,borderColor:d,overlayColor:q,infos:B.getRampStops(a,c,e)},b._hasOpacityRamp||(b._hasOpacityRamp=!(null==p.infos||!p.infos.length)));return p.infos&&p}}).filter(function(a){return!!a})};l.prototype._getDomainName=function(a,b){if(a&&"function"!==typeof a){var c=this.layer;return(c=
(a=c.getField&&c.getField(a))&&c.getFieldDomain?c.getFieldDomain(a.name):null)&&c.codedValues?c.getName(b):null}return null};l.prototype._getRampTitle=function(a,b){var c=a.field,k=a.normalizationField,d=!1,h=!1,p=!1,q=null,c="function"===typeof c?null:c,k="function"===typeof k?null:k;if(null!=(a.legendOptions&&a.legendOptions.title))q=a.legendOptions.title;else if(a.valueExpressionTitle)q=a.valueExpressionTitle;else{if(b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables)for(a=b.renderer.authoringInfo.visualVariables,
q=0;q<a.length;q++){var e=a[q];if("color"===e.type){if("ratio"===e.style){d=!0;break}if("percent"===e.style){h=!0;break}if("percentTotal"===e.style){p=!0;break}}}q={field:c&&this._getFieldAlias(c,b),normField:k&&this._getFieldAlias(k,b),ratio:d,ratioPercent:h,ratioPercentTotal:p}}return q};l.prototype._getRendererTitle=function(a,b){if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;var c=this.layer,k=a.field,d=null,h=null;
z(a)&&(d=a.normalizationField,h="percent-of-total"===a.normalizationType);k="function"===typeof k?null:k;d="function"===typeof d?null:d;a=null;if(k||d)a={field:b?k:k&&this._getFieldAlias(k,c),normField:b?d:d&&this._getFieldAlias(d,c),normByPct:h};return a};l.prototype._getFieldAlias=function(a,b){var c=b.popupTemplate,c=c&&c.fieldInfos;b="function"===typeof a?null:b.getField&&b.getField(a);var k=null;c&&c.some(function(b){if(a===b.fieldName)return k=b,!0});var c=k||b,d=null;c&&(d=k&&k.label||b&&b.alias||
c.name||c.fieldName);return d};l.prototype._isUnclassedRenderer=function(a){var b=a.visualVariables,c=!1;z(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&b&&(c=a.field?b.some(function(b){return!(!b||a.field!==b.field||(a.normalizationField||b.normalizationField)&&a.normalizationField!==b.normalizationField)}):!!b.length);return c};a([k.property()],l.prototype,"children",void 0);a([k.property()],l.prototype,"layer",void 0);a([k.property()],l.prototype,"legendElements",void 0);a([k.property()],
l.prototype,"parent",void 0);a([k.property({readOnly:!0})],l.prototype,"ready",null);a([k.property()],l.prototype,"scale",void 0);a([k.property({dependsOn:["layer.renderer?.valueExpression?","layer.renderer?.visualVariables"],readOnly:!0})],l.prototype,"isScaleDriven",null);a([k.property()],l.prototype,"title",void 0);a([k.property({dependsOn:["ready"],readOnly:!0,value:0})],l.prototype,"version",null);a([k.property()],l.prototype,"view",void 0);return l=a([k.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],
l)}(k.declared(x))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils".split(" "),function(A,m,f,g,a,e,v,r){Object.defineProperty(m,"__esModule",{value:!0});var l={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",
opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};A=function(e){function d(){var a=null!==e&&e.apply(this,arguments)||this;a.scale=0;return a}g(d,e);Object.defineProperty(d.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"hasDynamicLayers",{get:function(){return r.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layer",{set:function(a){var d=this;this._get("layer")!==a&&(this._set("layer",a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),a&&(this._layerHandles=[a.allSublayers.on("change",function(){return d.notifyChange("visibleSublayers")}),a.on("sublayer-update",
function(a){return d.notifyChange(l[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,d){a[d.id]=
d.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"visibleSublayers",{get:function(){var a=this,d=this.layer.sublayers,p=[],h=function(b){var c=a.scale,k=0===b.minScale||c<=b.minScale,d=0===b.maxScale||c>=b.maxScale;b.visible&&(0===c||k&&d)&&(b.sublayers?b.sublayers.forEach(h):
p.unshift(b))};d&&d.forEach(h);return p},enumerable:!0,configurable:!0});d.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:a=f({},a,{layers:this.layers,layerDefs:this.layerDefs});return a};a([v.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],d.prototype,"dynamicLayers",null);a([v.property({readOnly:!0,
dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],d.prototype,"hasDynamicLayers",null);a([v.property()],d.prototype,"layer",null);a([v.property({readOnly:!0,dependsOn:["visibleSublayers"]})],d.prototype,"layers",null);a([v.property({readOnly:!0,dependsOn:["visibleSublayers"]})],d.prototype,"layerDefs",null);a([v.property({type:Number})],d.prototype,"scale",void 0);a([v.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],
d.prototype,"version",null);a([v.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],d.prototype,"visibleSublayers",null);return d=a([v.subclass("esri.layers.mixins.ExportImageParameters")],d)}(v.declared(e));m.ExportImageParameters=A})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/compilerUtils ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils".split(" "),function(A,
m,f,g,a,e,v,r,l){function x(d,f){switch(d.type){case "web-style":return r.previewWebStyleSymbol(d,x,f);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return v.previewSymbol3D(d,f);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":case "cim":return e.previewSymbol2D(d,f);default:a.neverReached(d)}}Object.defineProperty(m,"__esModule",{value:!0});m.renderPreviewHTML=x;m.getDisplayedSymbol=function(a,e){return g(this,
void 0,void 0,function(){var d,p,h;return f(this,function(b){if(!a)return[2];d=a.get("layer.opacity")||a.get("sourceLayer.opacity");return a.symbol?(p=a.symbol.clone(),l.applyColorToSymbol(p,null,d),[2,p]):(h=a.get("layer.renderer")||a.get("sourceLayer.renderer"))&&"getDisplayedSymbol"in h?[2,h.getDisplayedSymbol(a,e)]:[2]})})}})},"esri/symbols/support/previewSymbol2D":function(){define("require exports ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),
function(A,m,f,g,a,e,v,r){function l(a,h){var b=d.getContext("2d"),c=[];h&&(h.weight&&c.push(h.weight),h.size&&c.push(h.size+"px"),h.family&&c.push(h.family));b.font=c.join(" ");return b.measureText(a).width}function x(d){if(0===d.length)return 0;if(2<d.length){var h=a.px2pt(1),b=parseFloat(d);switch(d.slice(-2)){case "px":return b;case "pt":return b*h;case "in":return 72*b*h;case "pc":return 12*b*h;case "mm":return b*n*h;case "cm":return b*y*h}}return parseFloat(d)}Object.defineProperty(m,"__esModule",
{value:!0});var d=document.createElement("canvas"),n=7.2/2.54,y=72/2.54;m.previewSymbol2D=function(d,h){var b=h&&h.size?a.pt2px(h.size):null,c=h&&h.maxSize?a.pt2px(h.maxSize):null,k=h&&null!=h.opacity?h.opacity:null,p=h&&null!=h.rotation?h.rotation:null,n=e.getStroke(d),q={shape:null,fill:null,stroke:n};n&&n.width&&(n.width=Math.min(n.width,80));var t=0,D=0,B=n&&n.width||0,y=!1,m=null;switch(d.type){case "simple-marker":k=d.style;D=t=b=Math.min(b||a.pt2px(d.size),c||120);switch(k){case "circle":q.shape=
{type:"circle",cx:0,cy:0,r:.5*b};break;case "cross":q.shape={type:"path",path:[{command:"M",values:[0,.5*D]},{command:"L",values:[t,.5*D]},{command:"M",values:[.5*t,0]},{command:"L",values:[.5*t,D]},{command:"E",values:[]}]};break;case "diamond":q.shape={type:"path",path:[{command:"M",values:[0,.5*D]},{command:"L",values:[.5*t,0]},{command:"L",values:[t,.5*D]},{command:"L",values:[.5*t,D]},{command:"Z",values:[]}]};break;case "square":q.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",
values:[t,0]},{command:"L",values:[t,D]},{command:"L",values:[0,D]},{command:"Z",values:[]}]};break;case "triangle":q.shape={type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,D]},{command:"L",values:[0,D]},{command:"Z",values:[]}]};break;case "x":q.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,D]},{command:"M",values:[t,0]},{command:"L",values:[0,D]},{command:"E",values:[]}]};break;case "path":y=!0,q.shape={type:"path",path:d.path||""}}break;case "simple-line":B=
Math.min(b||B,c||80);t=22<B?2*B:40;D=B;n.width=B;B=0;q.shape={type:"path",path:[{command:"M",values:[0,.5*D]},{command:"L",values:[t,.5*D]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":D=t=b=Math.min(b,c||120);y=!0;q.shape=v.shapes.fill[0];break;case "picture-marker":var F=c||120,n=a.pt2px(d.width),c=a.pt2px(d.height),b=Math.min(b||Math.max(n,c),F),c=n/c,n=1>=c?Math.ceil(b*c):b,c=1>=c?b:Math.ceil(b/c),t=n,D=c,m=k;q.shape={type:"image",x:-Math.round(n/2),y:-Math.round(c/2),
width:n,height:c,src:d.url||""};break;case "text":k=d.text||"Aa",n=d.font,b=Math.min(b||a.pt2px(n.size),c||120),F=l(k,{weight:n.weight,size:b,family:n.family}),t=(c=/[\uE600-\uE6FF]/.test(k))?b:F,D=b,F=.25*x((n?b:0).toString()),c&&(F+=5),q.shape={type:"text",text:k,x:0,y:F,align:"middle",decoration:n&&n.decoration,rotated:d.rotated,kerning:d.kerning},q.font=n&&{size:b,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family}}if(!q.shape)return g.reject(new f("symbolPreview: renderPreviewHTML2D",
"symbol not supported."));var t=(t||22)+B+1,D=(D||22)+B+1,E=e.getFill(d),B=d.color,b=null;E&&"pattern"===E.type&&B&&"picture-fill"!==d.type?b=e.getPatternUrlWithColor(E.src,B.toCss(!0)).then(function(a){E.src=a;q.fill=E;return q}):(q.fill=E,b=g.resolve(q));return b.then(function(a){return r.renderSymbol([[a]],[t,D],{node:h&&h.node,scale:y,opacity:m,rotation:p})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(A,m){Object.defineProperty(m,"__esModule",{value:!0});
m.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",
path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",
path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},
{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};m.getExtrudeSymbolShapes=function(f){f*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+f]},{command:"L",values:[0,22*.7+f-.7*11]},{command:"Z",values:[]}]},
{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+f]},{command:"L",values:[22,f]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};m.getCubeShapes=function(f,g){var a=g?20:f,e=g?4:6,e=a=22>=a?a-.5*e:a-e;g=g?.35*a:.5*a;return[{type:"path",path:[{command:"M",values:[.5*e,0]},{command:"L",values:[e,
.5*g]},{command:"L",values:[.5*e,g]},{command:"L",values:[0,.5*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*g]},{command:"L",values:[.5*e,g]},{command:"L",values:[.5*e,f]},{command:"L",values:[0,f-.5*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*e,g]},{command:"L",values:[.5*e,f]},{command:"L",values:[e,f-.5*g]},{command:"L",values:[e,.5*g]},{command:"Z",values:[]}]}]};m.getCylinderShapes=function(f,g){var a=g?20:f;g=g?4:6;a=22>=a?a-.5*g:a-
g;g=.5*a;var e=.15*a;f-=e;return[{type:"ellipse",cx:.5*a,cy:f,rx:g,ry:e},{type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[0,f]},{command:"L",values:[a,f]},{command:"L",values:[a,e]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*a,cy:e,rx:g,ry:e}]};m.getConeShapes=function(f,g){var a=g?20:f;g=g?4:6;a=22>=a?a-.5*g:a-g;g=.15*a;var e=a;f-=g;return[{type:"ellipse",cx:.5*a,cy:f,rx:.5*a,ry:g},{type:"path",path:[{command:"M",values:[.5*e,0]},{command:"L",values:[e,f]},{command:"L",values:[0,
f]},{command:"Z",values:[]}]}]};m.getInvertedConeShapes=function(f){var g=f,g=22>g?g-3:g-6,a=.15*g,e=g;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[.5*e,f-a]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*g,cy:0,rx:.5*g,ry:a}]};m.getDiamondShapes=function(f){var g=f,g=22>g?g-2:g-4,a=Math.floor(f/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[g,.5*f-a]},{command:"L",values:[.45*g-a,.5*f+a]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[.45*g-a,.5*f+a]},{command:"L",values:[0,.5*f-a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*f-a]},{command:"L",values:[.45*g-a,.5*f+a]},{command:"L",values:[.45*g,f]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,f]},{command:"L",values:[g,.5*f-a]},{command:"L",values:[.45*g-a,.5*f+a]},{command:"Z",values:[]}]}]};m.getTetrahedronShapes=function(f){var g=f,g=22>
g?g-1:g-2;return[{type:"path",path:[{command:"M",values:[.45*f,0]},{command:"L",values:[f,g]},{command:"L",values:[.45*f,.6*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*f,0]},{command:"L",values:[.45*f,.6*g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,g]},{command:"L",values:[.45*f,.6*g]},{command:"L",values:[f,g]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../core/promiseUtils".split(" "),
function(A,m,f,g,a,e,v,r,l,x){function d(a){return a.map(function(a){return a.command+" "+a.values.join(",")}).join(" ").trim()}function n(a,h,b,c){var k=c&&c.node||document.createElement("div"),e=f.createSurface(k,h,b);null!=c.opacity&&(k.style.opacity=c.opacity.toString());try{a.forEach(function(a){var k=e.createGroup(),p=0;a.forEach(function(a){var b=a.shape,c=a.fill,h=a.stroke;p+=h&&h.width||0;var q=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=d(b.path)),q=k.createShape(b).setFill(c).setStroke(h?
h:{width:0}),"text"===b.type&&q.setFont(a.font))});a=h/2;var n=b/2,f=k.getBoundingBox(),l=f.width,v=f.height,u=!1;if(c.scale&&0!==f.width&&0!==f.height){var C=f.width/f.height,u=(h>b?h:b)-2*p,z=1,G=1;isNaN(u)||(1<C?(z=u/f.width,G=u/C/f.height):(G=u/f.height,z=u*C/f.width));k.applyTransform(g.scaleAt(z,G,a,n));u=!0}C=f.x+l/2;f=f.y+v/2;k.applyTransform(g.translate(a-C,n-f));!u&&(l>h||v>b)&&(u=l/h>v/b,l=((u?h:b)-5)/(u?l:v),k.applyTransform(g.scaleAt(l,l,a,n)));c.rotation&&k.applyTransform(g.rotategAt(c.rotation,
C,f))})}catch(C){return e.clear(),e.destroy(),null}return k}function y(a,d,b){return a?e(a,{responseType:"image"}).then(function(a){a=a.data;var c=a.width,h=a.height,e=c/h,q=d;b&&(q=Math.min(q,Math.max(c,h)));return{image:a,width:1>=e?Math.ceil(q*e):q,height:1>=e?q:Math.ceil(q/e)}}):x.reject(new r("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(m,"__esModule",{value:!0});m.renderSymbol=function(a,d,b){var c=Math.ceil(d[0]);d=Math.ceil(d[1]);return a.some(function(a){return!!a.length})?
n(a,c,d,b):null};m.tintImageWithColor=function(d,h,b,c,k){return y(d,h,k).then(function(k){var e=k.width?k.width:h,q=k.height?k.height:h,f;if(f=k.image)f=b&&"ignore"!==c?"multiply"===c&&255===b.r&&255===b.g&&255===b.b&&1===b.a?!1:!0:!1;if(f){var p=k.image.width,n=k.image.height;/\.svg$/i.test(d)&&(--p,--n);var l,g;l=Math.ceil(e);g=Math.ceil(q);f=document.createElement("canvas");f.width=l;f.height=g;f.style.width=l+"px";f.style.height=g+"px";f=f.getContext("2d");f.clearRect(0,0,l,g);f.drawImage(k.image,
0,0,p,n,0,0,e,q);k=f.getImageData(0,0,e,q);p=[b.r/255,b.g/255,b.b/255,b.a];n=v.toHSV(b);for(l=0;l<k.data.length;l+=4){g=k.data;var u=l,y=p,z=n;switch(c){case "multiply":g[u+0]*=y[0];g[u+1]*=y[1];g[u+2]*=y[2];g[u+3]*=y[3];break;default:var G=v.toHSV({r:g[u+0],g:g[u+1],b:g[u+2]});G.h=z.h;G.s=z.s;G.v=G.v/100*z.v;z=v.toRGB(G);g[u+0]=z.r;g[u+1]=z.g;g[u+2]=z.b;g[u+3]*=y[3]}}f.putImageData(k,0,0);d=f.canvas.toDataURL("image/png")}else(f=a.id&&a.id.findCredential(d))&&f.token&&(k=-1===d.indexOf("?")?"?":
"\x26",d=""+d+k+"token\x3d"+f.token);return{url:d,width:e,height:q}}).catch(function(){return{url:d,width:h,height:h}})}})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(A,m,f){m.switchTo(f);return m})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),function(A,m,f,g,a,e,v,r,l){var x=m.getObject("dojox.gfx",
!0),d=x._base={};x._hasClass=function(a,c){return(a=a.getAttribute("className"))&&0<=(" "+a+" ").indexOf(" "+c+" ")};x._addClass=function(a,c){var b=a.getAttribute("className")||"";(!b||0>(" "+b+" ").indexOf(" "+c+" "))&&a.setAttribute("className",b+(b?" ":"")+c)};x._removeClass=function(a,c){var b=a.getAttribute("className");b&&a.setAttribute("className",b.replace(new RegExp("(^|\\s+)"+c+"(\\s+|$)"),"$1$2"))};d._getFontMeasurements=function(){var b={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,
"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},c,d;g("ie")&&(d=a.doc.documentElement.style.fontSize||"",d||(a.doc.documentElement.style.fontSize="100%"));var h=r.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},a.body());for(c in b)h.style.fontSize=c,b[c]=16*Math.round(12*h.offsetHeight/16)/12/1E3;g("ie")&&(a.doc.documentElement.style.fontSize=d);a.body().removeChild(h);
return b};var n=null;d._getCachedFontMeasurements=function(a){if(a||!n)n=d._getFontMeasurements();return n};var y=null,p={};d._getTextBox=function(b,c,d){var k,h,q=arguments.length,e;y||(y=r.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},a.body()));k=y;k.className="";h=k.style;h.borderWidth="0";h.margin="0";h.padding="0";h.outline="0";if(1<q&&c)for(e in c)e in p||(h[e]=c[e]);2<q&&d&&(k.className=d);k.innerHTML=b;k.getBoundingClientRect?(h=k.getBoundingClientRect(),
h={l:h.left,t:h.top,w:h.width||h.right-h.left,h:h.height||h.bottom-h.top}):h=l.getMarginBox(k);k.innerHTML="";return h};d._computeTextLocation=function(a,c,d,h){var b={};switch(a.align){case "end":b.x=a.x-c;break;case "middle":b.x=a.x-c/2;break;default:b.x=a.x}b.y=a.y-d*(h?.75:1);return b};d._computeTextBoundingBox=function(a){if(!x._base._isRendered(a))return{x:0,y:0,width:0,height:0};var b;b=a.getShape();var k=a.getFont()||x.defaultFont;a=a.getTextWidth();k=x.normalizedLength(k.size);b=d._computeTextLocation(b,
a,k,!0);return{x:b.x,y:b.y,width:a,height:k}};d._isRendered=function(a){for(a=a.parent;a&&a.getParent;)a=a.parent;return null!==a};var h=0;d._getUniqueId=function(){var a;do a=A._scopeName+"xUnique"+ ++h;while(v.byId(a));return a};d._fixMsTouchAction=function(a){a.rawNode.style.touchAction="none"};m.mixin(x,{defaultPath:{type:"path",path:""},defaultPolyline:{type:"polyline",points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},
defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultStroke:{type:"stroke",color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,
color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var a={};return function(b){var c=a[b];if(c)return new c;c=a[b]=new Function;c.prototype=x["default"+b];return new c}}(),normalizeColor:function(a){return a instanceof
f?a:new f(a)},normalizeParameters:function(a,c){var b;if(c){var d={};for(b in a)b in c&&!(b in d)&&(a[b]=c[b])}return a},makeParameters:function(a,c){var b=null;if(!c)return m.delegate(a);var d={};for(b in a)b in d||(d[b]=m.clone(b in c?c[b]:a[b]));return d},formatNumber:function(a,c){var b=a.toString();if(0<=b.indexOf("e"))b=a.toFixed(4);else{var d=b.indexOf(".");0<=d&&5<b.length-d&&(b=a.toFixed(4))}return 0>a?b:c?" "+b:b},makeFontString:function(a){return a.style+" "+a.variant+" "+a.weight+" "+
a.size+" "+a.family},splitFontString:function(a){var b=x.getDefault("Font");a=a.split(/\s+/);if(!(5>a.length)){b.style=a[0];b.variant=a[1];b.weight=a[2];var d=a[3].indexOf("/");b.size=0>d?a[3]:a[3].substring(0,d);var h=4;0>d&&("/"==a[4]?h=6:"/"==a[4].charAt(0)&&(h=5));h<a.length&&(b.family=a.slice(h).join(" "))}return b},cm_in_pt:72/2.54,mm_in_pt:7.2/2.54,px_in_pt:function(){return x._base._getCachedFontMeasurements()["12pt"]/12},pt2px:function(a){return a*x.px_in_pt()},px2pt:function(a){return a/
x.px_in_pt()},normalizedLength:function(a){if(0===a.length)return 0;if(2<a.length){var b=x.px_in_pt(),d=parseFloat(a);switch(a.slice(-2)){case "px":return d;case "pt":return d*b;case "in":return 72*d*b;case "pc":return 12*d*b;case "mm":return d*x.mm_in_pt*b;case "cm":return d*x.cm_in_pt*b}}return parseFloat(a)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,equalSources:function(a,c){return a&&c&&a===
c},switchTo:function(a){var b="string"==typeof a?x[a]:a;b&&(e.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath Surface createSurface fixTarget".split(" "),function(a){x[a]=b[a]}),"string"==typeof a?x.renderer=a:e.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(a){return x.renderer=x[a]&&x[a].Surface===x.Surface?a:null}))}});return x})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],
function(A,m,f,g,a){var e=null;f.add("vml",function(a,e,f){f.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';a="adj"in f.firstChild;f.innerHTML="";return a});return{load:function(v,r,l){function x(){r(["dojox/gfx/"+d],function(a){A.renderer=d;e=a;l(a)})}if(e&&"force"!=v)l(e);else{var d=a.forceGfxRenderer;v=!d&&(m.isString(a.gfxRenderer)?a.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var n,y;!d&&v.length;)switch(v.shift()){case "svg":"SVGAngle"in g.global&&(d="svg");break;case "vml":f("vml")&&
(d="vml");break;case "silverlight":try{f("ie")?(n=new ActiveXObject("AgControl.AgControl"),n.IsVersionSupported("1.0"))&&(y=!0):navigator.plugins["Silverlight Plug-In"]&&(y=!0)}catch(p){y=!1}finally{n=null}y&&(d="silverlight");break;case "canvas":g.global.CanvasRenderingContext2D&&(d="canvas")}"canvas"===d&&!1!==a.canvasEvents&&(d="canvasWithEvents");a.isDebug&&console.log("gfx renderer \x3d "+d);"svg"==d&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(x):x()}}}})},"dojox/gfx/matrix":function(){define(["./_base",
"dojo/_base/lang"],function(A,m){var f=A.matrix={},g={};f._degToRad=function(a){return g[a]||(g[a]=Math.PI*a/180)};f._radToDeg=function(a){return a/Math.PI*180};f.Matrix2D=function(a){if(a)if("number"==typeof a)this.xx=this.yy=a;else if(a instanceof Array){if(0<a.length){for(var e=f.normalize(a[0]),g=1;g<a.length;++g){var r=e,l=f.normalize(a[g]),e=new f.Matrix2D;e.xx=r.xx*l.xx+r.xy*l.yx;e.xy=r.xx*l.xy+r.xy*l.yy;e.yx=r.yx*l.xx+r.yy*l.yx;e.yy=r.yx*l.xy+r.yy*l.yy;e.dx=r.xx*l.dx+r.xy*l.dy+r.dx;e.dy=r.yx*
l.dx+r.yy*l.dy+r.dy}m.mixin(this,e)}}else m.mixin(this,a)};m.extend(f.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});m.mixin(f,{identity:new f.Matrix2D,flipX:new f.Matrix2D({xx:-1}),flipY:new f.Matrix2D({yy:-1}),flipXY:new f.Matrix2D({xx:-1,yy:-1}),translate:function(a,e){return 1<arguments.length?new f.Matrix2D({dx:a,dy:e}):new f.Matrix2D({dx:a.x,dy:a.y})},scale:function(a,e){return 1<arguments.length?new f.Matrix2D({xx:a,yy:e}):"number"==typeof a?new f.Matrix2D({xx:a,yy:a}):new f.Matrix2D({xx:a.x,yy:a.y})},
rotate:function(a){var e=Math.cos(a);a=Math.sin(a);return new f.Matrix2D({xx:e,xy:-a,yx:a,yy:e})},rotateg:function(a){return f.rotate(f._degToRad(a))},skewX:function(a){return new f.Matrix2D({xy:Math.tan(a)})},skewXg:function(a){return f.skewX(f._degToRad(a))},skewY:function(a){return new f.Matrix2D({yx:Math.tan(a)})},skewYg:function(a){return f.skewY(f._degToRad(a))},reflect:function(a,e){1==arguments.length&&(e=a.y,a=a.x);var g=a*a,r=e*e,l=g+r,m=2*a*e/l;return new f.Matrix2D({xx:2*g/l-1,xy:m,yx:m,
yy:2*r/l-1})},project:function(a,e){1==arguments.length&&(e=a.y,a=a.x);var g=a*a,r=e*e,l=g+r,m=a*e/l;return new f.Matrix2D({xx:g/l,xy:m,yx:m,yy:r/l})},normalize:function(a){return a instanceof f.Matrix2D?a:new f.Matrix2D(a)},isIdentity:function(a){return 1==a.xx&&0==a.xy&&0==a.yx&&1==a.yy&&0==a.dx&&0==a.dy},clone:function(a){var e=new f.Matrix2D,g;for(g in a)"number"==typeof a[g]&&"number"==typeof e[g]&&e[g]!=a[g]&&(e[g]=a[g]);return e},invert:function(a){a=f.normalize(a);var e=a.xx*a.yy-a.xy*a.yx;
return a=new f.Matrix2D({xx:a.yy/e,xy:-a.xy/e,yx:-a.yx/e,yy:a.xx/e,dx:(a.xy*a.dy-a.yy*a.dx)/e,dy:(a.yx*a.dx-a.xx*a.dy)/e})},_multiplyPoint:function(a,e,f){return{x:a.xx*e+a.xy*f+a.dx,y:a.yx*e+a.yy*f+a.dy}},multiplyPoint:function(a,e,g){a=f.normalize(a);return"number"==typeof e&&"number"==typeof g?f._multiplyPoint(a,e,g):f._multiplyPoint(a,e.x,e.y)},multiplyRectangle:function(a,e){var g=f.normalize(a);e=e||{x:0,y:0,width:0,height:0};if(f.isIdentity(g))return{x:e.x,y:e.y,width:e.width,height:e.height};
a=f.multiplyPoint(g,e.x,e.y);var r=f.multiplyPoint(g,e.x,e.y+e.height),l=f.multiplyPoint(g,e.x+e.width,e.y);e=f.multiplyPoint(g,e.x+e.width,e.y+e.height);var g=Math.min(a.x,r.x,l.x,e.x),m=Math.min(a.y,r.y,l.y,e.y);return{x:g,y:m,width:Math.max(a.x,r.x,l.x,e.x)-g,height:Math.max(a.y,r.y,l.y,e.y)-m}},multiply:function(a){for(var e=f.normalize(a),g=1;g<arguments.length;++g){var m=e,l=f.normalize(arguments[g]),e=new f.Matrix2D;e.xx=m.xx*l.xx+m.xy*l.yx;e.xy=m.xx*l.xy+m.xy*l.yy;e.yx=m.yx*l.xx+m.yy*l.yx;
e.yy=m.yx*l.xy+m.yy*l.yy;e.dx=m.xx*l.dx+m.xy*l.dy+m.dx;e.dy=m.yx*l.dx+m.yy*l.dy+m.dy}return e},_sandwich:function(a,e,g){return f.multiply(f.translate(e,g),a,f.translate(-e,-g))},scaleAt:function(a,e,g,m){switch(arguments.length){case 4:return f._sandwich(f.scale(a,e),g,m);case 3:return"number"==typeof g?f._sandwich(f.scale(a),e,g):f._sandwich(f.scale(a,e),g.x,g.y)}return f._sandwich(f.scale(a),e.x,e.y)},rotateAt:function(a,e,g){return 2<arguments.length?f._sandwich(f.rotate(a),e,g):f._sandwich(f.rotate(a),
e.x,e.y)},rotategAt:function(a,e,g){return 2<arguments.length?f._sandwich(f.rotateg(a),e,g):f._sandwich(f.rotateg(a),e.x,e.y)},skewXAt:function(a,e,g){return 2<arguments.length?f._sandwich(f.skewX(a),e,g):f._sandwich(f.skewX(a),e.x,e.y)},skewXgAt:function(a,e,g){return 2<arguments.length?f._sandwich(f.skewXg(a),e,g):f._sandwich(f.skewXg(a),e.x,e.y)},skewYAt:function(a,e,g){return 2<arguments.length?f._sandwich(f.skewY(a),e,g):f._sandwich(f.skewY(a),e.x,e.y)},skewYgAt:function(a,e,g){return 2<arguments.length?
f._sandwich(f.skewYg(a),e,g):f._sandwich(f.skewYg(a),e.x,e.y)}});A.Matrix2D=f.Matrix2D;return f})},"esri/core/colorUtils":function(){define(["require","exports"],function(A,m){function f(a,e){var d=[],f,h;if(a[0].length!==e.length)throw"dimensions do not match";var b=a.length,c=a[0].length,k=0;for(f=0;f<b;f++){for(h=k=0;h<c;h++)k+=a[f][h]*e[h];d.push(k)}return d}function g(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=f(l,a);return{x:100*a[0],
y:100*a[1],z:100*a[2]}}function a(a){a=f(x,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function e(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function v(a){var d=a.l;a=[(d+16)/116+a.a/500,(d+16)/116,(d+16)/
116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function r(d){if("r"in d&&"g"in d&&"b"in d)return d;if("l"in d&&"c"in d&&"h"in d){var e=d.c,f=d.h;return a(v({l:d.l,a:e*Math.cos(f),b:e*Math.sin(f)}))}if("l"in d&&"a"in d&&"b"in d)return a(v(d));if("x"in d&&"y"in d&&"z"in d)return a(d);if("h"in d&&"s"in d&&"v"in d){f=(d.h+360)%360/60;e=d.v/100*255;d=d.s/100*e;var g=d*(1-Math.abs(f%2-1));switch(Math.floor(f)){case 0:f=
{r:d,g:g,b:0};break;case 1:f={r:g,g:d,b:0};break;case 2:f={r:0,g:d,b:g};break;case 3:f={r:0,g:g,b:d};break;case 4:f={r:g,g:0,b:d};break;case 5:case 6:f={r:d,g:0,b:g};break;default:f={r:0,g:0,b:0}}f.r=Math.round(f.r+e-d);f.g=Math.round(f.g+e-d);f.b=Math.round(f.b+e-d);return f}}Object.defineProperty(m,"__esModule",{value:!0});var l=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],x=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];m.toRGB=r;m.toHSV=function(a){if("h"in
a&&"s"in a&&"v"in a)return a;var d=r(a);a=d.r;var e=d.g,d=d.b,f=Math.max(a,e,d),h=f-Math.min(a,e,d),b;0===h?b=0:f===a?b=(e-d)/h%6:f===e?b=(d-a)/h+2:f===d&&(b=(a-e)/h+4);0>b&&(b+=6);return{h:60*b,s:100*(0===h?0:h/f),v:100/255*f}};m.toLAB=function(a){return"l"in a&&"a"in a&&"b"in a?a:e(g(r(a)))};m.toLCH=function(a){if(!("l"in a&&"c"in a&&"h"in a)){var d=e(g(r(a)));a=d.l;var f=d.a,p=d.b,d=Math.sqrt(f*f+p*p),f=Math.atan2(p,f),f=0<f?f:f+2*Math.PI;a={l:a,c:d,h:f}}return a};m.toXYZ=function(a){return"x"in
a&&"y"in a&&"z"in a?a:g(r(a))}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/compilerUtils ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(A,m,f,g,a,e,v,r,l,x,d,n,y,p,h){function b(a){var b=a.outline,c=a.material&&a.material.color,c=c&&c.toRgba().toString();
if(!b)return"fill"===a.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:null;a=r.pt2px(b.size)||0;return{color:"rgba("+(null!=b.color?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function c(a,b){var c=b&&b.resource,c=c&&c.href;return a.thumbnail&&a.thumbnail.url?v.resolve(a.thumbnail.url):c&&"object"!==b.type?v.resolve(h.getIconHref(a,b)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?p.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).catch(function(a){return a}).then(function(a){return a&&
a.thumbnail&&a.thumbnail.url||F}):v.resolve(F)}function k(a,b){void 0===b&&(b=0);if(!a.material||!a.material.color)return a=Math.min(Math.max(l.defaultThematicColor.r+191.25*b,0),255),[a,a,a,100];for(var c=a.material.color.toRgb(),d=0;3>d;d++)c[d]=Math.min(Math.max(c[d]+191.25*b,0),255);c.push(a.material.color.a);return c}function u(a){return a.outline?b(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function C(a,b){if(!a.material)return null;for(var c=a.material.color.toRgb(),d="rgba(",k=0;3>k;k++)d+=Math.min(Math.max(c[k]+
191.25*b,0),255)+",";return d+a.material.color.a+");"}function q(a,b){b=C(a,b);if(!b)return{};a=Math.min(a.size?r.pt2px(a.size):.75,80);return{color:b,width:a}}function t(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function D(a){var b=a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function B(a,c,h){var f=[];if(!a)return f;switch(a.type){case "icon":var e=a.resource&&a.resource.primitive||x.defaultPrimitive;
switch(e){case "circle":f.push({shape:{type:"circle",cx:0,cy:0,r:.5*c},fill:k(a,0),stroke:b(a)});break;case "square":f.push({shape:{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[0,0]},{command:"L",values:[c,0]},{command:"L",values:[c,c]},{command:"Z",values:[]}]},fill:k(a,0),stroke:b(a)});break;case "triangle":f.push({shape:{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[.5*c,0]},{command:"L",values:[c,c]},{command:"Z",values:[]}]},fill:k(a,0),stroke:b(a)});
break;case "cross":f.push({shape:{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[.5*c,c]},{command:"M",values:[0,.5*c]},{command:"L",values:[c,.5*c]},{command:"E",values:[]}]},stroke:u(a)});break;case "x":f.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[c,c]},{command:"M",values:[c,0]},{command:"L",values:[0,c]},{command:"E",values:[]}]},stroke:u(a)});break;case "kite":f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",
values:[.5*c,0]},{command:"L",values:[c,.5*c]},{command:"L",values:[.5*c,c]},{command:"Z",values:[]}]},fill:k(a,0),stroke:b(a)});break;default:g.neverReached(e)}break;case "object":switch(e=a.resource&&a.resource.primitive||d.defaultPrimitive,e){case "cone":e=k(a,0);a=k(a,-.6);a=t(e,a,h?20:c);c=n.getConeShapes(c,h);f.push({shape:c[0],fill:a});f.push({shape:c[1],fill:a});break;case "inverted-cone":h=k(a,0);a=k(a,-.6);a=t(h,a,c);c=n.getInvertedConeShapes(c);f.push({shape:c[0],fill:a});f.push({shape:c[1],
fill:h});break;case "cube":c=n.getCubeShapes(c,h);f.push({shape:c[0],fill:k(a,0)});f.push({shape:c[1],fill:k(a,-.3)});f.push({shape:c[2],fill:k(a,-.5)});break;case "cylinder":var e=k(a,0),q=k(a,-.6),e=t(e,q,h?20:c);c=n.getCylinderShapes(c,h);f.push({shape:c[0],fill:e});f.push({shape:c[1],fill:e});f.push({shape:c[2],fill:k(a,0)});break;case "diamond":c=n.getDiamondShapes(c);f.push({shape:c[0],fill:k(a,-.3)});f.push({shape:c[1],fill:k(a,0)});f.push({shape:c[2],fill:k(a,-.3)});f.push({shape:c[3],fill:k(a,
-.7)});break;case "sphere":h=k(a,0);a=k(a,-.6);a=t(h,a);a.x1=0;a.y1=0;a.x2=.25*c;a.y2=.25*c;f.push({shape:{type:"circle",cx:0,cy:0,r:.5*c},fill:a});break;case "tetrahedron":c=n.getTetrahedronShapes(c);f.push({shape:c[0],fill:k(a,-.3)});f.push({shape:c[1],fill:k(a,0)});f.push({shape:c[2],fill:k(a,-.6)});break;default:g.neverReached(e)}}return f}function L(a,d){var k=d&&d.size?r.pt2px(d.size):null,f=d&&d.maxSize?r.pt2px(d.maxSize):null,h=d&&d.disableUpsampling,e=a.symbolLayers,q=[],g=0,p=0,l=e.getItemAt(e.length-
1),n;l&&"icon"===l.type&&(n=l.size&&r.pt2px(l.size));e.forEach(function(e,l){if("icon"===e.type||"object"===e.type){l="icon"===e.type?e.size&&r.pt2px(e.size):0;var t=k||l?Math.ceil(Math.min(k||l,f||120)):22,m="icon"===e.type?b(e):null,u=m?m.width:0;e&&e.resource&&e.resource.href?(l=c(a,e).then(function(a){var b=e.get("material.color"),c;c="icon"===e.type?"multiply":"tint";return y.tintImageWithColor(a,t,b,c,h)}).then(function(a){var b=a.width,c=a.height;g=Math.max(g,b+u+1);p=Math.max(p,c+u+1);return[{shape:{type:"image",
x:0,y:0,width:b,height:c,src:a.url},fill:null,stroke:null}]}),q.unshift(l)):(m=t,"icon"===e.type&&n&&k&&(m=l/n*t),l=d&&"tall"===d.symbolConfig||("object"===e.type?D(e):!1),g=Math.max(g,l?20:m+u+1),p=Math.max(p,m+u+1),q.unshift(v.resolve(B(e,m,l))))}});return v.eachAlways(q).then(function(a){var b=[];a.forEach(function(a){a.value?b.push(a.value):a.error&&E.warn("error while building swatchInfo!",a.error)});return y.renderSymbol(b,[g,p],{node:d&&d.node,scale:!1})})}function K(a,b){var c=a.symbolLayers,
d=[];a=h.isVolumetricSymbol(a);var f=b&&b.size?r.pt2px(b.size):null,e=(b&&b.maxSize?r.pt2px(b.maxSize):null)||80,g=0,l=0,p;c.forEach(function(a,b){if(a&&("line"===a.type||"path"===a.type)){var c=[];switch(a.type){case "line":var h=(a=q(a,0))&&a.width||0;0===b&&(p=h);var t=Math.min(f||h,e);b=0===b?t:f?h/p*t:t;l=Math.max(l,b);g=Math.max(g,22<b?b+1:40);a.width=b;c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[g,.5*l]},{command:"E",values:[]}]},stroke:a});break;case "path":b=
Math.min(f||22,e),h=k(a,0),t=k(a,-.2),a=(a=C(a,-.4))?{color:a,width:1}:{},c.push({shape:n.shapes.pathSymbol3DLayer[0],fill:t,stroke:a}),c.push({shape:n.shapes.pathSymbol3DLayer[1],fill:h,stroke:a}),g=l=Math.max(l,b+(a.width||0)+1)}d.push(c)}});return v.resolve(y.renderSymbol(d,[g,l],{node:b&&b.node,scale:a}))}Object.defineProperty(m,"__esModule",{value:!0});var F=A.toUrl("../../images/Legend/legend3dsymboldefault.png"),E=e.getLogger("esri.symbols.support.previewSymbol3D");m.getSymbolLayerFill=k;m.previewSymbol3D=
function(c,d){if(0===c.symbolLayers.length)return v.reject(new a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var e=null;switch(c.type){case "point-3d":e=L(c,d);break;case "line-3d":e=K(c,d);break;case "polygon-3d":case "mesh-3d":e="mesh-3d"===c.type;c=c.symbolLayers;for(var h=d&&d.size?r.pt2px(d.size):null,g=d&&d.maxSize?r.pt2px(d.maxSize):null,h=h||22,l=[],p=0,t=0,m=!1,D=0;D<c.length;D++){var u=c.getItemAt(D),B=[];if(!e||"fill"===u.type){var C=n.shapes.fill[0];switch(u.type){case "fill":var z=
b(u),m=z&&z.width||0,p=Math.max(p,h+m),t=Math.max(t,h+m),m=!0;B.push({shape:C,fill:k(u,0),stroke:z});break;case "line":u=(z=q(u,0))&&z.width||0;C={stroke:z,shape:C};p=Math.max(p,22+u);t=Math.max(t,22+u);B.push(C);break;case "extrude":var C=f({join:"round"},q(u,-.4)),z=k(u,0),u=k(u,-.2),E=Math.min(h,g||120),F=n.getExtrudeSymbolShapes(E);C.width=1;B.push({shape:F[0],fill:u,stroke:C});B.push({shape:F[1],fill:u,stroke:C});B.push({shape:F[2],fill:z,stroke:C});u=22*.7+.5*E;p=Math.max(p,22+C.width+1);t=
Math.max(t,u+C.width+1)}l.push(B)}}e=v.resolve(y.renderSymbol(l,[p,t],{node:d&&d.node,scale:m}))}return e?e:v.reject(new a("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require","exports","../../request","../../core/screenUtils"],function(A,m,f,g){Object.defineProperty(m,"__esModule",{value:!0});m.previewWebStyleSymbol=function(a,e,m){var r=a.thumbnail&&a.thumbnail.url;return r?f(r,{responseType:"image"}).then(function(a){a=
a.data;var e=!/\\.svg$/i.test(a.src)&&m&&m.disableUpsampling,d=Math.max(a.width,a.height),f=m&&null!=m.maxSize?g.pt2px(m.maxSize):120;e&&(f=Math.min(d,f));e=Math.min(f,m&&null!=m.size?g.pt2px(m.size):d);e!==d&&(d=0!==a.width&&0!==a.height?a.width/a.height:1,1<=d?(a.width=e,a.height=e/d):(a.width=e*d,a.height=e));return m&&m.node?(m.node.appendChild(a),m.node):a}):a.fetchSymbol().then(function(a){return e(a,m)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../Color ../../../core/numberUtils ../../../symbols/support/gfxUtils ./utils".split(" "),
function(A,m,f,g,a,e){function v(a,e){a=r(a,e);var d=a.startIndex,g=a.endIndex;if(d===g)return e[d].color;e=f.blendColors(e[d].color,e[g].color,a.weight);return new f(e)}function r(a,e){var d=0,f=e.length-1;e.some(function(e,b){if(a<e.value)return f=b,!0;d=b;return!1});return{startIndex:d,endIndex:f,weight:(a-e[d].value)/(e[f].value-e[d].value)}}Object.defineProperty(m,"__esModule",{value:!0});var l=[64,64,64],x=[255,255,255];m.getRampBorderColor=function(d){var e=null;if("simple"===d.type)e=d.symbol;
else if("unique-value"===d.type||"class-breaks"===d.type)e=(d=(d=d.classBreakInfos||d.uniqueValueInfos)&&d[0])&&d.symbol;return(d=(d=e&&-1===e.type.indexOf("line-symbol")?a.getStroke(e):null)&&d.color)&&0<d.a&&!(240<=d.r&&240<=d.g&&240<=d.b)?d:null};m.getRampOverlayColor=function(a){var d=new f(x);d.a=1-a;return d};m.getRampStops=function(a,m,r){var d=!1,h=[],b=[];if(m.stops){var c=m.stops,h=c.map(function(a){return a.value});(d=c.some(function(a){return!!a.label}))&&(b=c.map(function(a){return a.label}))}var k=
h[0],c=h[h.length-1];if(null==k&&null==c)return null;var u=c-k;return h.map(function(c,q){var p;if("opacity"===m.type){p=r;void 0===p&&(p=l);p=new f(p);var n=a.getOpacity(c,{opacityInfo:m});null!=n&&(p.a=n)}else p=a.getColor(c,{colorInfo:m});q=d?b[q]:e.getLabelPrefix(q,h.length-1)+g.format(c);return{value:c,color:p,label:q,offset:u?1-(c-k)/u:1}}).reverse()};m.getRampStopsForPointCloud=function(a){var d=!1,f=[],p=[],f=a.map(function(a){return a.value});(d=a.some(function(a){return!!a.label}))&&(p=
a.map(function(a){return a.label}));var h=f[0],b=f[f.length-1];if(null==h&&null==b)return null;var c=b-h;return f.map(function(b,l){var k=v(b,a);l=d?p[l]:e.getLabelPrefix(l,f.length-1)+g.format(b);return{value:b,color:k,label:l,offset:c?1-(b-h)/c:1}}).reverse()};m.getColorFromPointCloudStops=v})},"esri/widgets/Legend/support/utils":function(){define(["require","exports"],function(A,m){Object.defineProperty(m,"__esModule",{value:!0});m.getLabelPrefix=function(f,g){return 0===f?"\x3c ":f===g?"\x3e ":
""}})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["require","exports","../../../renderers/support/HeatmapColorStop"],function(A,m,f){Object.defineProperty(m,"__esModule",{value:!0});m.getHeatmapRampStops=function(g){g=g.colorStops;var a=g.length-1;if(g&&g[0]){var e=g[a];e&&1!==e.ratio&&(g=g.slice(0),g.push(new f.HeatmapColorStop({ratio:1,color:e.color})),a++)}return g.map(function(e,f){var g="";0===f?g="low":f===a&&(g="high");return{color:e.color,label:g,ratio:e.ratio,offset:1-
e.ratio}}).reverse()}})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../../symbols/support/gfxUtils ../../../symbols/support/previewSymbol3D".split(" "),function(A,m,f,g,a,e){function v(d){if(d){var f=d.type;return-1<f.indexOf("3d")?e.getSymbolLayerFill(d.symbolLayers.getItemAt(0)):"simple-line"===f||"simple-marker"===d.type&&("x"===d.style||"cross"===d.style)?(d=a.getStroke(d))&&d.color:a.getFill(d)}}function r(a,d){var b=d.HH.label,
c=d.LL.label,e=d.HL.label;d=d.LH.label;switch(a){case "HH":return{top:b,bottom:c,left:e,right:d};case "HL":return{top:e,bottom:d,left:c,right:b};case "LL":return{top:c,bottom:b,left:d,right:e};case "LH":return{top:d,bottom:e,left:b,right:c};default:return{top:b,bottom:c,left:e,right:d}}}function l(a){var d=n[a];a&&null==d&&(d=n.HH);return d||0}function x(a,d,b,c){var e=c+"_arrowStart";c+="_arrowEnd";d="left"===d;switch(b){case "HL":a.setAttribute(d?"marker-start":"marker-end","url(#"+(d?c:e)+")");
break;case "LL":a.setAttribute("marker-start","url(#"+c+")");break;case "LH":a.setAttribute(d?"marker-end":"marker-start","url(#"+(d?e:c)+")");break;default:a.setAttribute("marker-end","url(#"+e+")")}}function d(a,d,b){var c="start"===d;d=c?b+"_arrowStart":b+"_arrowEnd";b=c?"0,0 5,5 0,10":"5,0 0,5 5,10";var e=c?"5":"0",c=document.createElementNS("http://www.w3.org/2000/svg","marker");c.setAttribute("id",d);c.setAttribute("markerWidth","10");c.setAttribute("markerHeight","10");c.setAttribute("refX",
e);c.setAttribute("refY","5");c.setAttribute("markerUnits","strokeWidth");c.setAttribute("orient","auto");d=document.createElementNS("http://www.w3.org/2000/svg","polyline");d.setAttribute("points",b);d.setAttribute("fill","none");d.setAttribute("stroke","#555555");d.setAttribute("stroke-width","1");c.appendChild(d);a.appendChild(c)}Object.defineProperty(m,"__esModule",{value:!0});var n={HH:315,HL:45,LL:135,LH:225},y={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],
4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};m.getRelationshipRampElement=function(a){var d=a.focus,b=a.numClasses,c=y[b],e={};a.infos.forEach(function(a){e[a.value]={label:a.label,fill:v(a.symbol)}});a=[];for(var f=0;f<b;f++){for(var g=[],q=0;q<b;q++)g.push(e[c[f][q]].fill);a.push(g)}c=r(d,e);return{type:"relationship-ramp",numClasses:b,focus:d,colors:a,labels:c,rotation:l(d)}};m.getRotationAngleForFocus=l;m.renderRamp=function(e,h,
b){void 0===b&&(b=60);var c=e.focus,k=e.numClasses,l=e.colors,p=e.rotation;e=!!c;var q=Math.sqrt(Math.pow(b,2)+Math.pow(b,2))+(e?0:5),m=document.createElement("div"),n=f.createSurface(m,q,q),B=a.create2DColorRamp({surface:n,colors:l,numClasses:k,size:b}),k=(q-b)/2,q=(q-b)/2;B.applyTransform(g.translate(k,q));var l=b/2,r=b/2;B.applyTransform(g.rotategAt(p,l,r));var p=n.createGroup(),B={width:1,color:"#555555"},y=n.defNode;d(y,"start",h);d(y,"end",h);y=p.createLine({x1:-10,y1:b-15,x2:-10,y2:15}).setStroke(B);
b=p.createLine({x1:15,y1:b+10,x2:b-15,y2:b+10}).setStroke(B);x(y.rawNode,"left",c,h);x(b.rawNode,"right",c,h);p.applyTransform(g.translate(k,q));e?p.applyTransform(g.rotategAt(-45,l,r)):n.rawNode.style.margin="-15px -15px -18px -15px";return m}})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../symbols ../../../core/numberUtils ../../../symbols/support/utils ./utils".split(" "),function(A,m,f,g,a,e){function v(a,b){var d=null,e=null;if("simple"===a.type)d=a.symbol;
else if("unique-value"===a.type||"class-breaks"===a.type)d=(d=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&d.symbol,e=1<a.length;if(!d||r(d))return null;d=d.clone();if(b||e)-1<d.type.indexOf("3d")?l(d):(b=d,-1!==b.type.indexOf("line")?b.color=c:(b.color=h,"simple-marker"===b.type&&(b.outline={color:c,width:1.5})));return d}function r(a){if(a)return f.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function l(d){a.isVolumetricSymbol(d)||
("line-3d"===d.type?d.symbolLayers.forEach(function(a){a.material={color:c}}):d.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:b}:(a.material={color:h},a.outline={color:c,size:1.5})}))}function x(a,b,c,e,f){var k=a.getSizeRangeAtScale(b,e,f),h=k&&d(k);if(k||h){for(var q=h.map(function(a){var c=k.minSize,d=k.maxSize,e=b.minDataValue,f=b.maxDataValue;return a<=c?e:a>=d?f:(a-c)/(d-c)*(f-e)+e}),q=g.round(q),l=1;l<q.length-1;l++){var p=n(a,b,c,q[l],q[l-
1],e,f);p&&(q[l]=p[0],h[l]=p[1])}return q}}function d(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);return c}function n(a,b,c,d,e,f,h){var k,q=y(a,b,c,d,f,h);e=y(a,b,c,e,f,h);var l=g.numDigits(d),p=l.fractional,m=l.integer,n=l=null;0<d&&1>d&&(l=Math.pow(10,p),d*=l,m=g.numDigits(d).integer);for(p=m-1;0<=p;p--){var t=Math.pow(10,p),m=Math.floor(d/t)*t,t=Math.ceil(d/t)*t;null!=l&&(m/=l,t/=l);k=(m+t)/2;k=g.round([m,k,t],{indexes:[1]});k=k[1];var D=y(a,b,c,m,f,h),B=y(a,b,
c,t,f,h),u=y(a,b,c,k,f,h),r=g.percentChange(q,D,e,null),C=g.percentChange(q,B,e,null),v=g.percentChange(q,u,e,null),x=20>=r.previous,A=20>=C.previous;x&&A&&(r.previous<=C.previous?(x=!0,A=!1):(A=!0,x=!1));x?n=[m,D]:A?n=[t,B]:20>=v.previous&&(n=[k,u]);if(n)break}return n}function y(a,b,c,d,e,f){return a.getSize(d,{sizeInfo:b,scale:e,view:f,shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})}function p(b,c){b=b.clone();if(f.isSymbol3D(b))a.isVolumetricSymbol(b)||b.symbolLayers.forEach(function(a){"fill"!==
a.type&&(a.size=c)});else if("esri.symbols.SimpleMarkerSymbol"===b.declaredClass)b.size=c;else if("esri.symbols.PictureMarkerSymbol"===b.declaredClass){var d=b.width,e=b.height;b.height=c;b.width=d/e*c}else"esri.symbols.SimpleLineSymbol"===b.declaredClass?b.width=c:"esri.symbols.TextSymbol"===b.declaredClass&&b.font&&(b.font.size=c);return b}Object.defineProperty(m,"__esModule",{value:!0});m.REAL_WORLD_MAX_SIZE=30;m.REAL_WORLD_MIN_SIZE=12;var h=[255,255,255],b=[200,200,200],c=[128,128,128];m.getRampStops=
function(b,c,d,f,h){var k=c.legendOptions,k=k&&k.customValues,q=v(b,d);d=null!=c.minSize&&null!=c.maxSize;var l=c.stops&&1<c.stops.length,n=!!c.target;if(q&&(k||d||l&&!n)){var t=a.isVolumetricSymbol(q),r=null,u=null,C=null,u=t&&!l?g.round([c.minDataValue,c.maxDataValue]):k||x(b,c,q,f,h);!u&&l&&(u=c.stops.map(function(a){return a.value}),(r=c.stops.some(function(a){return!!a.label}))&&(C=c.stops.map(function(a){return a.label})));k=!t||u&&2===u.length;if(!u||!k)return null;var A=[m.REAL_WORLD_MIN_SIZE,
m.REAL_WORLD_MAX_SIZE],I=a.getSymbolOutlineSize(q);return u.map(function(a,d){var k=t?A[d]:y(b,c,q,a,f,h),l=p(q,k);d=r?C[d]:e.getLabelPrefix(d,u.length-1)+g.format(a);return{value:a,symbol:l,label:d,size:k,outlineSize:I}}).reverse()}}})},"esri/widgets/Legend/styles/Card":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/Handles ../../../core/lang ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),
function(A,m,f,g,a,e,v,r,l,x,d,n,y,p,h,b,c){var k=window.devicePixelRatio;return function(a){function m(b){b=a.call(this)||this;b._handles=new l;b._hasIndicators=!1;b._selectedSectionName=null;b._sectionNames=[];b._sectionMap=new Map;b.activeLayerInfos=null;b.layout="stack";b.type="card";b.view=null;return b}f(m,a);m.prototype.postInitialize=function(){var a=this;this.own([this.watch("activeLayerInfos",function(b){a._handles.removeAll();a._watchForSectionChanges(b)})])};m.prototype.destroy=function(){this._handles.destroy();
this._handles=null};m.prototype.render=function(){var a=this,b;this._hasIndicators="auto"===this.layout&&768>=this.view.container.clientWidth||"stack"===this.layout;var d=this.activeLayerInfos,f=d&&d.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;
var h=this._sectionNames.length,d=this._sectionNames.map(function(b,d){var f;d=x.substitute({index:d+1,total:h},e.pagination.pageText);return c.tsx("div",{key:b,"aria-label":d,title:d,tabIndex:0,onclick:a._selectSection,onkeydown:a._selectSection,bind:a,class:a.classes("esri-legend--card__carousel-indicator",(f={},f["esri-legend--card__carousel-indicator--activated"]=a._selectedSectionName===b,f)),"data-section-name":b})}),d=this._hasIndicators&&1<h?c.tsx("div",{class:"esri-legend--card__carousel-indicator-container",
key:"carousel-navigation"},d):null,f=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):f&&f.length?f:null,k=(b={},b["esri-legend--stacked"]=this._hasIndicators,b);return c.tsx("div",{class:this.classes("esri-legend--card esri-widget",k)},d,f?f:c.tsx("div",{class:"esri-legend--card__message"},v.noLegend))};m.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};m.prototype._watchForSectionChanges=function(a){var b=this;this._generateSectionNames();
a&&(a.forEach(function(a){var c="activeLayerInfo-"+a.layer.uid+"-version-change";b._handles.remove(c);b._watchForSectionChanges(a.children);b._handles.add(a.watch("version",function(){return b._generateSectionNames()}),c)}),this._handles.add(a.on("change",function(){return b._watchForSectionChanges(a)})))};m.prototype._generateSectionNames=function(){this._sectionNames.length=0;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)};m.prototype._generateSectionNamesForActiveLayerInfo=
function(a){var b=this;a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach(function(c,d){b._sectionNames.push("esri-legend--card__"+a.layer.uid+"-type-"+c.type+"-"+d)})};m.prototype._renderLegendForLayer=function(a){var b=this,d;if(!a.ready)return null;if(a.children.length)return d=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),c.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},
c.tsx("div",{class:"esri-legend--card__service-caption-container"},a.title),d);var e=a.legendElements;if(e&&!e.length)return null;var f=e.some(function(a){return"relationship-ramp"===a.type}),e=e.map(function(c,d){return b._renderLegendForElement(c,a,d,f)}).filter(function(a){return!!a});if(!e.length)return null;var h=(d={},d["esri-legend--card__group-layer-child"]=!!a.parent,d);return c.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",h)},c.tsx("div",{class:"esri-legend--card__service-caption-container"},
c.tsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),c.tsx("div",{class:"esri-legend--card__service-content"},e))};m.prototype._renderLegendForElement=function(a,b,d,e){var f=this;void 0===e&&(e=!1);var k,g="color-ramp"===a.type,l="opacity-ramp"===a.type,m="size-ramp"===a.type,q=b.layer,n=a.title,t=null;"string"===typeof n?t=n:n&&(t=h.getTitle(n,g||l),t=n.title?n.title+" ("+t+")":t);d="esri-legend--card__"+q.uid+"-type-"+a.type+"-"+d;q=this._hasIndicators?c.tsx("div",null,c.tsx("h3",
{class:this.classes("esri-widget__heading","esri-legend--card__carousel-title")},b.title),c.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},t)):t?c.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},t):null;n=null;"symbol-table"===a.type?(m=a.infos.map(function(c,d){return f._renderLegendForElementInfo(c,b,a.legendType,d)}).filter(function(a){return!!a}),m.length&&(n=m[0].properties.classes&&m[0].properties.classes["esri-legend--card__symbol-row"],
e=(k={},k["esri-legend--card__label-container"]=!n&&!e,k["esri-legend--card__relationship-label-container"]=e,k),n=c.tsx("div",{key:d,class:"esri-legend--card__section"},q,c.tsx("div",{class:this.classes(e)},m)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?n=c.tsx("div",{key:d,class:"esri-legend--card__section"},q,this._renderLegendForRamp(a)):m?n=c.tsx("div",{key:d,class:"esri-legend--card__section"},q,this._renderSizeRamps(a)):"relationship-ramp"===a.type&&(n=c.tsx("div",
{key:d,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},q,p.renderRelationshipRamp(a,this.id)));if(!n)return null;this._sectionMap.set(d,n);return n};m.prototype._renderLegendForElementInfo=function(a,d,e,f){var k,g,l,m=d.layer;if(a.type)return this._renderLegendForElement(a,d,f);d=h.isImageryStretchedLegend(m,e);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return c.tsx("div",{key:f,bind:a.preview,afterCreate:h.attachToNode});
m=(k={},k["esri-legend--card__symbol-cell"]=this._hasIndicators,k);return c.tsx("div",{key:f,class:this.classes("esri-legend--card__layer-row",(g={},g["esri-legend--card__symbol-row"]=this._hasIndicators,g))},c.tsx("div",{class:this.classes(m),bind:a.preview,afterCreate:h.attachToNode}),c.tsx("div",{class:this.classes("esri-legend--card__image-label",(l={},l["esri-legend--card__label-cell"]=this._hasIndicators,l))},h.getTitle(a.label,!1)||""))}l=g=k=255;var m=0,p=e=d=255,n=0,q=a.symbol.color&&a.symbol.color.a,
t=a.symbol.outline&&a.symbol.outline.color.a;q&&(k=a.symbol.color.r,g=a.symbol.color.g,l=a.symbol.color.b,m=a.symbol.color.a);t&&(d=a.symbol.outline.color.r,e=a.symbol.outline.color.g,p=a.symbol.outline.color.b,n=a.symbol.outline.color.a);var r=a.symbol.color?b.isBright(a.symbol.color):!0,u=r?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return c.tsx("div",{key:f,class:"esri-legend--card__layer-row"},c.tsx("div",{class:"esri-legend--card__label-element",styles:{background:q?"rgba("+k+", "+g+", "+
l+", "+m+")":"none",color:r?"black":"white",textShadow:"-1px -1px 0 "+u+",\n                                              1px -1px 0 "+u+",\n                                              -1px 1px 0 "+u+",\n                                              1px 1px 0 "+u,border:t?"1px solid rgba("+d+", "+e+", "+p+", "+n+")":"none"}}," ",a.label," "))}if(a.src)return k=this._renderImage(a,m,d),c.tsx("div",{key:f,class:"esri-legend--card__layer-row"},k,c.tsx("div",{class:"esri-legend--card__image-label"},
a.label||""))};m.prototype._renderImage=function(a,b,d){var e,f=a.label,k=a.src,h=a.opacity;d=(e={},e["esri-legend--card__imagery-layer-image--stretched"]=d,e["esri-legend--card__symbol"]=!d,e);b={opacity:""+(null!=h?h:b.opacity)};return c.tsx("img",{alt:f,src:k,border:0,width:a.width,height:a.height,class:this.classes(d),styles:b})};m.prototype._drawImageOnSizeRamp=function(a,b,c){var d=c.x,e=c.y,f=c.width,k=c.height,h=new Image;h.src=b;h.onload=function(){a.drawImage(h,d,e,f,k);URL.revokeObjectURL(b)}};
m.prototype._attachSizeRampToNode=function(a){var b=a["data-legend-element"].infos,c=b[0],e=b[b.length-1],f=c.symbol,h=e.symbol,g="picture-marker"===f.type;f?-1<f.type.indexOf("3d")?(b=f.symbolLayers&&f.symbolLayers.length)?(b=f.symbolLayers.getItemAt(b-1).get("resource.primitive"),b="triangle"===b||"cone"===b||"tetrahedron"===b):b=void 0:b="triangle"===f.style:b=void 0;var l;f?-1<f.type.indexOf("3d")?(l=f.symbolLayers&&f.symbolLayers.length)?(l=f.symbolLayers.getItemAt(l-1),l=l.resource&&l.resource.primitive,
l="circle"===l||"cross"===l||"kite"===l||"sphere"===l||"cube"===l||"diamond"===l):l=void 0:(l=f.style,l="circle"===l||"diamond"===l||"cross"===l):l=void 0;var m,p;g?(m=f.url,p=h.url):(c.preview&&(c.preview.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),m=new Blob([c.preview.innerHTML],{type:"image/svg+xml"}),m=URL.createObjectURL(m)),e.preview&&(e.preview.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),
p=new Blob([e.preview.innerHTML],{type:"image/svg+xml"}),p=URL.createObjectURL(p)));var n=d.pt2px(c.size+c.outlineSize)*k,f=d.pt2px(e.size+e.outlineSize)*k,h=this._hasIndicators?n:n+100*k,g=this._hasIndicators?h+50*k:n,c=document.createElement("canvas");c.width=h;c.height=g;c.style.width=c.width/k+"px";c.style.height=c.height/k+"px";e=c.getContext("2d");this._hasIndicators?(this._drawImageOnSizeRamp(e,m,{x:0,y:0,width:n,height:n}),this._drawImageOnSizeRamp(e,p,{x:h/2-f/2,y:g-f,width:f,height:f}),
e.beginPath(),m=h/2-f/2,p=g-(b?0:l?f/2:f),e.moveTo(0,l?h/2:h),e.lineTo(m,p),m=h/2+f/2,b=g-(b?0:l?f/2:f),e.moveTo(h,l?h/2:h),e.lineTo(m,b)):(this._drawImageOnSizeRamp(e,m,{x:h-n,y:0,width:n,height:n}),this._drawImageOnSizeRamp(e,p,{x:0,y:g/2-f/2,width:f,height:f}),e.beginPath(),m=h-(l||b?n/2:n),e.moveTo(f-(l||b?f/2:0),g/2-f/2),e.lineTo(m,0),b=h-(l?n/2:n),e.moveTo(f-(l?f/2:0),g/2+f/2),e.lineTo(b,g));e.strokeStyle="#ddd";e.stroke();a.appendChild(c)};m.prototype._renderSizeRamps=function(a){var b,d=a.infos,
e=d[0].label,d=d[d.length-1].label;return c.tsx("div",{class:this.classes("esri-legend--card__layer-row",(b={},b["esri-legend--card__size-ramp-row"]=this._hasIndicators,b))},c.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?e:d),c.tsx("div",{class:"esri-legend--card__size-ramp-container"},c.tsx("div",{bind:this,"data-legend-element":a,afterCreate:this._attachSizeRampToNode})),c.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?d:e))};m.prototype._renderLegendForRamp=
function(a){var b=a.infos,d="heatmap-ramp"===a.type,e=b.length-1,f=2<e&&!d?25*e:100,k=f+20;a=document.createElement("div");a.style.width=k+"px";var g=r.createSurface(a,k,25),l=b.slice(0).reverse();try{l.forEach(function(a,b){a.offset=d?a.ratio:b/e}),d||g.createPath("M0 12.5 L10 0 L10 25 Z").setFill(l[0].color).setStroke(null),g.createRect({x:10,y:0,width:f,height:25}).setFill({type:"linear",x1:10,y1:0,x2:f+10,y2:0,colors:l}).setStroke(null),d||g.createPath("M"+(f+10)+" 0 L"+k+" 12.5 L"+(f+10)+" 25 Z").setFill(l[l.length-
1].color).setStroke(null)}catch(z){g.clear(),g.destroy()}if(!g)return null;f=l.filter(function(a,b){return!!a.label&&0!==b&&b!==l.length-1}).map(function(a){return c.tsx("div",{class:"esri-legend--card__interval-separators-container"},c.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),c.tsx("div",{class:"esri-legend--card__ramp-label"},a.label))});k=b[b.length-1].label;b=b[0].label;return c.tsx("div",{class:"esri-legend--card__layer-row"},c.tsx("div",{class:"esri-legend--card__ramp-label"},
d?v[k]:k),c.tsx("div",{class:"esri-legend--card__symbol-container"},c.tsx("div",{bind:a,afterCreate:h.attachToNode}),f),c.tsx("div",{class:"esri-legend--card__ramp-label"},d?v[b]:b))};g([c.renderable(),n.property()],m.prototype,"activeLayerInfos",void 0);g([n.property()],m.prototype,"layout",void 0);g([n.property({readOnly:!0})],m.prototype,"type",void 0);g([n.property()],m.prototype,"view",void 0);g([c.accessibleHandler()],m.prototype,"_selectSection",null);return m=g([n.subclass("esri.widgets.Legend.styles.Card")],
m)}(n.declared(y))})},"esri/widgets/Legend/styles/support/utils":function(){define(["require","exports","../../support/relationshipRampUtils","../../support/styleUtils","../../../support/widget"],function(A,m,f,g,a){Object.defineProperty(m,"__esModule",{value:!0});m.renderRelationshipRamp=function(e,m){var r=e.labels,l=!!e.focus;e=f.renderRamp(e,m);return l?a.tsx("div",{class:"esri-relationship-ramp--diamond__container"},a.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},r.left),a.tsx("div",
{class:"esri-relationship-ramp--diamond__middle-column"},a.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},r.top),a.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--ramp",bind:e,afterCreate:g.attachToNode}),a.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},r.bottom)),a.tsx("div",{class:"esri-relationship-ramp--diamond__right-column"},r.right)):a.tsx("div",{class:"esri-relationship-ramp--square__table"},a.tsx("div",{class:"esri-relationship-ramp--square__table-row"},
a.tsx("div",{class:a.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-bottom")},r.left),a.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),a.tsx("div",{class:a.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-bottom")},r.top)),a.tsx("div",{class:"esri-relationship-ramp--square__table-row"},
a.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),a.tsx("div",{class:"esri-relationship-ramp--square__table-cell",bind:e,afterCreate:g.attachToNode}),a.tsx("div",{class:"esri-relationship-ramp--square__table-cell"})),a.tsx("div",{class:"esri-relationship-ramp--square__table-row"},a.tsx("div",{class:a.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-top")},r.bottom),a.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),
a.tsx("div",{class:a.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-top")},r.right)))}})},"esri/widgets/Legend/support/styleUtils":function(){define(["require","exports","dojo/i18n!../../Legend/nls/Legend","../../../core/lang"],function(A,m,f,g){Object.defineProperty(m,"__esModule",{value:!0});m.attachToNode=function(a){a.appendChild(this)};m.getTitle=function(a,e){if(a){if("string"===typeof a)return a;
if("value"in a||"unit"in a)return g.substitute(a,f.dotValue);var m=null;e?m=a.ratioPercentTotal?"showRatioPercentTotal":a.ratioPercent?"showRatioPercent":a.ratio?"showRatio":a.normField?"showNormField":a.field?"showField":null:e||(m=a.normField?"showNormField":a.normByPct?"showNormPct":a.field?"showField":null);return m?g.substitute({field:a.field,normField:a.normField},"showField"===m?"{field}":f[m]):null}};m.isRendererTitle=function(a,e){return!e};m.isImageryStretchedLegend=function(a,e){return!!(e&&
"Stretched"===e&&10.3<=a.version&&"esri.layers.ImageryLayer"===a.declaredClass)}})},"esri/widgets/support/colorUtils":function(){define(["require","exports","../../Color"],function(A,m,f){function g(a){return new f(a)}function a(a){return!!a&&4===a.length&&x.test(a)}function e(a){return!!a&&7===a.length&&d.test(a)}function v(a){return 127<=.299*a.r+.587*a.g+.114*a.b}function r(a,d){void 0===d&&(d=1);d=Math.pow(.7,d);return new f([Math.round(a.r*d),Math.round(a.g*d),Math.round(a.b*d),a.a])}function l(a,
d){void 0===d&&(d=1);d=Math.pow(.7,d);var e=a.r,h=a.g,b=a.b;30>e&&(e=30);30>h&&(h=30);30>b&&(b=30);return new f([Math.min(255,Math.round(e/d)),Math.min(255,Math.round(h/d)),Math.min(255,Math.round(b/d)),a.a])}Object.defineProperty(m,"__esModule",{value:!0});var x=/^#[0-9A-F]{3}$/i,d=/^#[0-9A-F]{6}$/i;m.equal=function(a,d){return a&&d&&a.r===d.r&&a.g===d.g&&a.b===d.b&&a.a===d.a};m.normalizeHex=function(a){return a?"#"+a.trim().replace(/#/g,"").substr(0,6):""};m.normalizeColor=g;m.isValidHex=function(d){return a(d)||
e(d)};m.isShorthandHex=a;m.isLonghandHex=e;m.toHex=function(a){return g(a).toHex()};m.getContrastingColor=function(a){return v(a)?r(a):l(a,3)};m.isBright=v;m.darker=r;m.brighter=l})},"esri/widgets/Legend/styles/Classic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/widget".split(" "),
function(A,m,f,g,a,e,v,r,l,x,d){return function(m){function n(a){a=m.call(this)||this;a.activeLayerInfos=null;a.type="classic";return a}f(n,m);n.prototype.render=function(){var e=this,f=this.activeLayerInfos,b=this.classes("esri-legend esri-widget--panel","esri-widget"),f=f&&f.toArray().map(function(a){return e._renderLegendForLayer(a)}).filter(function(a){return!!a});return d.tsx("div",{class:b},f&&f.length?f:d.tsx("div",{class:"esri-legend__message"},a.noLegend))};n.prototype._renderLegendForLayer=
function(a){var e=this,b;if(!a.ready)return null;var c=!!a.children.length,f="esri-legend__"+a.layer.uid+"-version-"+a.version,g=a.title?d.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend__service-label")},a.title):null;if(c)return b=a.children.map(function(a){return e._renderLegendForLayer(a)}).toArray(),d.tsx("div",{key:f,class:this.classes("esri-legend__service","esri-legend__group-layer")},g,b);if((c=a.legendElements)&&!c.length)return null;c=c.map(function(b){return e._renderLegendForElement(b,
a.layer)}).filter(function(a){return!!a});if(!c.length)return null;var l=(b={},b["esri-legend__group-layer-child"]=!!a.parent,b);return d.tsx("div",{key:f,class:this.classes("esri-legend__service",l)},g,d.tsx("div",{class:"esri-legend__layer"},c))};n.prototype._renderLegendForElement=function(a,e,b){var c=this,f,h="color-ramp"===a.type,g="opacity-ramp"===a.type,m="size-ramp"===a.type,p=null;if("symbol-table"===a.type||m){var n=a.infos.map(function(b){return c._renderLegendForElementInfo(b,e,m,a.legendType)}).filter(function(a){return!!a});
n.length&&(p=d.tsx("div",{class:"esri-legend__layer-body"},n))}else"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?p=this._renderLegendForRamp(a):"relationship-ramp"===a.type&&(p=l.renderRelationshipRamp(a,this.id));if(!p)return null;var n=a.title,r=null;"string"===typeof n?r=n:n&&(r=x.getTitle(n,h||g),r=x.isRendererTitle(n,h||g)&&n.title?n.title+" ("+r+")":r);h=b?"esri-legend__layer-child-table":"esri-legend__layer-table";g=r?d.tsx("div",{class:"esri-legend__layer-caption"},
r):null;b=(f={},f["esri-legend__layer-table--size-ramp"]=m||!b,f);return d.tsx("div",{class:this.classes(h,b)},g,p)};n.prototype._renderLegendForRamp=function(f){var h=f.infos,b="opacity-ramp"===f.type,c="heatmap-ramp"===f.type,k=h.length-1,g=document.createElement("div");g.className="esri-legend__color-ramp "+(b?"esri-legend__opacity-ramp":"");g.style.height="75px";b=e.createSurface(g,"100%",75);try{if(c||h.forEach(function(a,b){a.offset=b/k}),b.createRect({x:0,y:0,width:"100%",height:75}).setFill({type:"linear",
x1:0,y1:0,x2:0,y2:75,colors:h}).setStroke(null),"color-ramp"===f.type||"opacity-ramp"===f.type){var l=f.overlayColor;l&&0<l.a&&b.createRect({x:0,y:0,width:"100%",height:75}).setFill(l).setStroke(null)}}catch(q){b.clear(),b.destroy()}if(!b)return null;f=h.filter(function(a){return!!a.label}).map(function(b){return d.tsx("div",{class:"esri-legend__ramp-label"},c?a[b.label]:b.label)});return d.tsx("div",{class:"esri-legend__layer-row"},d.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",
styles:{width:"24px"}},d.tsx("div",{class:"esri-legend__ramps",bind:g,afterCreate:x.attachToNode})),d.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},d.tsx("div",{class:"esri-legend__ramp-labels",styles:{height:"75px"}},f)))};n.prototype._renderLegendForElementInfo=function(a,e,b,c){var f,g;if(a.type)return this._renderLegendForElement(a,e,!0);var h=null;c=x.isImageryStretchedLegend(e,c);a.symbol&&a.preview?h=d.tsx("div",{class:"esri-legend__symbol",bind:a.preview,afterCreate:x.attachToNode}):
a.src&&(h=this._renderImage(a,e,c));if(!h)return null;e=(f={},f["esri-legend__imagery-layer-info--stretched"]=c,f);b=(g={},g["esri-legend__imagery-layer-info--stretched"]=c,g["esri-legend__size-ramp"]=!c&&b,g);return d.tsx("div",{class:"esri-legend__layer-row"},d.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",b)},h),d.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--info",e)},x.getTitle(a.label,!1)||""))};n.prototype._renderImage=
function(a,e,b){var c,f=a.label,g=a.src,h=a.opacity;b=(c={},c["esri-legend__imagery-layer-image--stretched"]=b,c["esri-legend__symbol"]=!b,c);e={opacity:""+(null!=h?h:e.opacity)};return d.tsx("img",{alt:f,src:g,border:0,width:a.width,height:a.height,class:this.classes(b),styles:e})};g([d.renderable(),v.property()],n.prototype,"activeLayerInfos",void 0);g([v.property({readOnly:!0})],n.prototype,"type",void 0);return n=g([v.subclass("esri.widgets.Legend.styles.Classic")],n)}(v.declared(r))})},"widgets/Legend/_build-generate_module":function(){define(["dojo/i18n!./nls/strings"],
function(){})},"*now":function(A){A(['dojo/i18n!*preload*widgets/Legend/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/Legend"],function(A,m,f){return A([m],{name:"Legend",baseClass:"jimu-widget-legend",templateString:"\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d'legendDiv'\x3e\x3c/div\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);this.legend=new f({container:this.legendDiv,view:this.sceneView})},destroy:function(){this.legend&&this.legend.destroy();this.inherited(arguments)}})});