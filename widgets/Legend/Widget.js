// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Widget ../core/HandleRegistry ../core/watchUtils ./Legend/LegendViewModel dojo/i18n!./Legend/nls/Legend ../core/lang ./support/widgetUtils dojox/gfx ../core/accessorSupport/decorators ./support/widget".split(" "),function(y,n,g,e,b,d,l,u,p,t,q,r,x,h){return function(b){function a(c){c=b.call(this)||this;c._handleRegistry=new d;c.activeLayerInfos=null;c.basemapLegendVisible=
!1;c.groundLegendVisible=!1;c.layerInfos=null;c.view=null;c.viewModel=new u;return c}g(a,b);a.prototype.postInitialize=function(){var c=this;this.own(l.on(this,"activeLayerInfos","change",function(){return c._refreshActiveLayerInfos(c.activeLayerInfos)}))};a.prototype.destroy=function(){this._handleRegistry.destroy();this._handleRegistry=null};a.prototype.render=function(){var c=this,a=this.activeLayerInfos,f=q.join("esri-legend","esri-widget"),a=a&&a.toArray().map(function(a){return c._renderLegendForLayer(a)}).filter(function(c){return!!c});
return h.tsx("div",{class:f},a&&a.length?a:h.tsx("div",{class:"esri-legend__message"},p.noLegend))};a.prototype._refreshActiveLayerInfos=function(c){var a=this;this._handleRegistry.removeAll();c.forEach(function(c){return a._renderOnActiveLayerInfoChange(c)});this.scheduleRender()};a.prototype._renderOnActiveLayerInfoChange=function(c){var a=this,f=l.init(c,"version",function(){return a.scheduleRender()});this._handleRegistry.add(f,"version_"+c.layer.uid);c.children.forEach(function(c){return a._renderOnActiveLayerInfoChange(c)})};
a.prototype._renderLegendForLayer=function(c){var a=this;if(!c.ready)return null;var f=!!c.children.length,b="esri-legend__"+c.layer.uid+"-version-"+c.version;if(f){var e=c.children.map(function(c){return a._renderLegendForLayer(c)}).toArray(),f=(d={},d["esri-legend__group-layer"]=f,d);return h.tsx("div",{key:b,class:"esri-legend__service",classes:f},h.tsx("p",{class:"esri-legend__service-label"},c.title),e)}if((f=c.legendElements)&&!f.length)return null;d=f.map(function(f){return a._renderLegendForElement(f,
c.layer)}).filter(function(c){return!!c});if(!d.length)return null;f=(e={},e["esri-legend__group-layer-child"]=!!c.parent,e);return h.tsx("div",{key:b,class:"esri-legend__service",classes:f},h.tsx("p",{class:"esri-legend__service-label"},c.title),h.tsx("div",{class:"esri-legend__layer"},d));var d};a.prototype._renderLegendForElement=function(c,a,f){var b=this,m="color-ramp"===c.type,e="opacity-ramp"===c.type,d="size-ramp"===c.type,v=null;if("symbol-table"===c.type||d){var k=c.infos.map(function(f){return b._renderLegendForElementInfo(f,
a,d,c.legendType)}).filter(function(c){return!!c});k.length&&(v=h.tsx("div",{class:"esri-legend__layer-body"},k))}else if(m||e)v=this._renderLegendForRamp(c.infos,c.overlayColor,e);if(!v)return null;var k=c.title,g=null;"string"===typeof k?g=k:k&&(m=this._getTitle(k,m||e),g=k.title?k.title+" ("+m+")":m);f=f?"esri-legend__layer-child-table":"esri-legend__layer-table";m=g?h.tsx("div",{class:"esri-legend__layer-caption"},g):null;return h.tsx("div",{class:f},m,v)};a.prototype._renderLegendForRamp=function(c,
a,f){var b=c.length-1,m=null,m=2<b?25*b:50,e=document.createElement("div");e.className="esri-legend__color-ramp "+(f?"esri-legend__opacity-ramp":"");e.style.height=m+"px";f=r.createSurface(e,"100%",m);try{c.forEach(function(c,a){c.offset=a/b}),f.createRect({x:0,y:0,width:"100%",height:m}).setFill({type:"linear",x1:0,y1:0,x2:0,y2:m,colors:c}).setStroke(null),a&&0<a.a&&f.createRect({x:0,y:0,width:"100%",height:m}).setFill(a).setStroke(null)}catch(E){f.clear(),f.destroy()}if(!f)return null;c=c.filter(function(c){return!!c.label}).map(function(c){return h.tsx("div",
{class:"esri-legend__ramp-label"},c.label)});m={height:m+"px"};return h.tsx("div",{class:"esri-legend__layer-row"},h.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",styles:{width:"24px"}},h.tsx("div",{class:"esri-legend__ramps",bind:e,afterCreate:this._attachToNode})),h.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},h.tsx("div",{class:"esri-legend__ramp-labels",styles:m},c)))};a.prototype._renderLegendForElementInfo=function(c,a,f,b){if(c.type)return this._renderLegendForElement(c,
a,!0);var m=null;b=this._isImageryStretchedLegend(a,b);c.symbol&&c.preview?m=h.tsx("div",{class:"esri-legend__symbol",bind:c.preview,afterCreate:this._attachToNode}):c.src&&(m=this._renderImage(c,a,b));if(!m)return null;a=(e={},e["esri-legend__imagery-layer-info--stretched"]=b,e);f=(d={},d["esri-legend__imagery-layer-info--stretched"]=b,d["esri-legend__size-ramp"]=!b&&f,d);return h.tsx("div",{class:"esri-legend__layer-row"},h.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",
classes:f},m),h.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info",classes:a},c.label||""));var e,d};a.prototype._attachToNode=function(c){c.appendChild(this)};a.prototype._renderImage=function(c,a,b){var f=c.src,m=c.opacity;b=(e={},e["esri-legend__imagery-layer-image--stretched"]=b,e["esri-legend__symbol"]=!b,e);return h.tsx("img",{src:f,border:0,width:c.width,height:c.height,classes:b,styles:{opacity:""+(null!=m?m:a.opacity)}});var e};a.prototype._isImageryStretchedLegend=
function(c,a){return!!(a&&"Stretched"===a&&10.3<=c.version&&"esri.layers.ImageryLayer"===c.declaredClass)};a.prototype._getTitle=function(a,b){var c=null;b?c=a.ratioPercentTotal?"showRatioPercentTotal":a.ratioPercent?"showRatioPercent":a.ratio?"showRatio":a.normField?"showNormField":a.field?"showField":null:b||(c=a.normField?"showNormField":a.normByPct?"showNormPct":a.field?"showField":null);return c?t.substitute({field:a.field,normField:a.normField},p[c]):null};e([x.aliasOf("viewModel.activeLayerInfos"),
h.renderable()],a.prototype,"activeLayerInfos",void 0);e([x.aliasOf("viewModel.basemapLegendVisible"),h.renderable()],a.prototype,"basemapLegendVisible",void 0);e([x.aliasOf("viewModel.groundLegendVisible"),h.renderable()],a.prototype,"groundLegendVisible",void 0);e([x.aliasOf("viewModel.layerInfos"),h.renderable()],a.prototype,"layerInfos",void 0);e([x.aliasOf("viewModel.view"),h.renderable()],a.prototype,"view",void 0);e([x.property(),h.renderable()],a.prototype,"viewModel",void 0);return a=e([x.subclass("esri.widgets.Legend")],
a)}(x.declared(b))})},"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/HandleRegistry ./support/ActiveLayerInfo ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(y,n,g,e,b,d,l,u,p,t){var q=d.ofType(u);(function(){return function(){}})();var r="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.MapImageLayer esri.layers.MapNotesLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),
x=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(b){function d(a){a=b.call(this,a)||this;a._handles=new l;a._layerViewByLayerId={};a._layerInfosByLayerViewId={};a._activeLayerInfosByLayerViewId={};a.activeLayerInfos=new q;a.basemapLegendVisible=!1;a.groundLegendVisible=!1;a.layerInfos=[];a.view=null;return a}g(d,b);d.prototype.initialize=function(){this._handles.add(p.init(this,"view",this._viewHandles),"view")};
d.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(p.init(this,"state",this._stateHandles),"state")};d.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
d.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};d.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};d.prototype._destroyViewActiveLayerInfo=function(a){this._handles.remove(a);delete this._activeLayerInfosByLayerViewId[a]};d.prototype._watchPropertiesAndAllLayerViews=function(){var a=this.view.allLayerViews;
a.length&&this._refresh();this._handles.add(a.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(p.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};d.prototype._allLayerViewsChangeHandle=function(a){var c=this;a.removed.forEach(function(a){return c._destroyViewActiveLayerInfo(a.uid)});this._refresh()};d.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};d.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};d.prototype._sortActiveLayerInfos=function(a){var c={};this.view.allLayerViews.forEach(function(a,b){return c[a.layer.uid]=b});a.sort(function(a,b){return(c[b.layer.uid]||0)-(c[a.layer.uid]||
0)})};d.prototype._generateLayerViews=function(){var a=[];x.filter(this._filterLayerViews,this).map(this.get,this).filter(function(a){return null!=a}).forEach(this._collectLayerViews("layerViews",a));return a};d.prototype._filterLayerViews=function(a){var c=!this.groundLegendVisible&&"view.groundView.layerViews"===a;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===a||"view.basemapView.referenceLayerViews"===a))&&!c};d.prototype._collectLayerViews=function(a,c){var b=function(d){d&&
d.forEach(function(d){c.push(d);b(d[a])});return c};return b};d.prototype._filterLayerViewsByLayerInfos=function(a){var c=this,b=this.layerInfos;return b&&b.length?b.some(function(b){return c._hasLayerInfo(b,a)}):!0};d.prototype._hasLayerInfo=function(a,c){var b=this._isLayerUIDMatching(a.layer,c.layer.uid);b&&(this._layerInfosByLayerViewId[c.uid]=a);return b};d.prototype._isLayerUIDMatching=function(a,c){return a&&(a.uid===c||this._hasLayerUID(a.layers,c))};d.prototype._hasLayerUID=function(a,c){var b=
this;return a&&a.some(function(a){return b._isLayerUIDMatching(a,c)})};d.prototype._isLayerViewSupported=function(a){return-1<r.indexOf(a.layer.declaredClass)?(this._layerViewByLayerId[a.layer.uid]=a,!0):!1};d.prototype._generateActiveLayerInfo=function(a){var c=this;this._isLayerActive(a)?this._buildActiveLayerInfo(a):(this._handles.remove(a.uid),this._handles.add(p.watch(a,"suspended, layer.legendEnabled",function(){return c._layerActiveHandle(a)}),a.uid))};d.prototype._layerActiveHandle=function(a){this._isLayerActive(a)&&
(this._handles.remove(a.uid),this._buildActiveLayerInfo(a))};d.prototype._isLayerActive=function(a){return!a.suspended&&a.get("layer.legendEnabled")};d.prototype._buildActiveLayerInfo=function(a){var c=this,b=a.layer,d=a.uid,e=this._layerInfosByLayerViewId[d],h=this._activeLayerInfosByLayerViewId[d];h||(h=new u({layer:b,title:e&&void 0!==e.title?e.title:b.title}),this._activeLayerInfosByLayerViewId[d]=h);h.parent||(e=(e=b.parent)&&this._layerViewByLayerId[e.uid],h.parent=e&&this._activeLayerInfosByLayerViewId[e.uid]);
if(!this._handles.has(d)){var e=p.watch(b,"title",function(b){return c._titleHandle(b,h,a)}),w=p.watch(b,"legendEnabled",function(b){return c._legendEnabledHandle(b,h,a)}),b=p.watch(b,"renderer, opacity",function(){return c._constructLegendElements(h,a)}),g=p.watch(a,"suspended",function(b){return c._suspendedHandle(b,h,a)}),v=p.whenTrue(this.view,"stationary",function(){return c._scaleHandle(h,a)});this._handles.add([e,w,b,g,v],d)}this._addActiveLayerInfo(h,a)};d.prototype._titleHandle=function(a,
c,b){c.title=a;this._constructLegendElements(c,b)};d.prototype._legendEnabledHandle=function(a,c,b){a?this._addActiveLayerInfo(c,b):this._removeActiveLayerInfo(c)};d.prototype._suspendedHandle=function(a,c,b){a?this._removeActiveLayerInfo(c):this._addActiveLayerInfo(c,b)};d.prototype._scaleHandle=function(a,c){a.scale!==this.view.scale&&this._constructLegendElements(a,c)};d.prototype._addActiveLayerInfo=function(a,c){this._isLayerActive(c)&&-1===this.activeLayerInfos.indexOf(a)&&((c=a.parent,c)?-1===
c.children.indexOf(a)&&(c.children.push(a),this._sortActiveLayerInfos(c.children)):(this.activeLayerInfos.add(a),this._sortActiveLayerInfos(this.activeLayerInfos)))};d.prototype._removeActiveLayerInfo=function(a){var c=a.parent;c?(a=c.children.indexOf(a),-1!==a&&c.children.splice(a,1)):this.activeLayerInfos.remove(a)};d.prototype._constructLegendElements=function(a,c){c=c.layer;a.scale=this.view.scale;c.featureCollections?a.buildLegendElementsForFeatureCollections(c.featureCollections):c.renderer?
a.buildLegendElementsForRenderer():c.url&&a.buildLegendElementsForTools()};e([t.property({type:q})],d.prototype,"activeLayerInfos",void 0);e([t.property()],d.prototype,"basemapLegendVisible",void 0);e([t.property()],d.prototype,"groundLegendVisible",void 0);e([t.property()],d.prototype,"layerInfos",void 0);e([t.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);e([t.property()],d.prototype,"view",void 0);return d=e([t.subclass("esri.widgets.Legend.LegendViewModel")],d)}(t.declared(b))})},
"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/lang dojo/io-query ../../../core/Accessor ../../../core/Collection ../../../core/HandleRegistry ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../layers/FeatureLayer ../../../layers/WMSLayer ../../../layers/WMTSLayer ../../../layers/MapImageLayer ../../../layers/support/ExportImageParameters ../../../renderers/SimpleRenderer ../../../renderers/ClassBreaksRenderer ../../../renderers/UniqueValueRenderer ../../../renderers/PointCloudClassBreaksRenderer ../../../renderers/PointCloudRenderer ../../../renderers/PointCloudStretchRenderer ../../../renderers/PointCloudUniqueValueRenderer ../../../symbols/SimpleMarkerSymbol ../../../Color ../../../request ./colorRampUtils ./sizeRampUtils ../../../core/arrayUtils ../../../core/accessorSupport/decorators ../../../renderers/support/jsonUtils ../../../symbols/support/symbolPreview ../../../symbols/support/gfxUtils".split(" "),
function(y,n,g,e,b,d,l,u,p,t,q,r,x,h,v,a,c,m,f,B,C,w,E,H,k,A,z,G,N,K,D,L,O,I){var J=t.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),F=new k({size:6,outline:{color:[128,128,128,.5],width:.5}});return function(k){function l(a){a=k.call(this,a)||this;a._handles=new p;a._hasColorRamp=!1;a._hasOpacityRamp=!1;a._hasSizeRamp=!1;a._legendResponse={};a._webStyleSymbolCache=new Map;a.children=new u;a.layer=null;a.legendElements=[];a.parent=null;a.scale=null;a.title=null;return a}g(l,k);l.prototype.initialize=
function(){var a=this,c=function(){return a.notifyChange("ready")};this._handles.add([r.on(this,"children","change",function(b){var d=b.removed,e=a._handles;b.added.map(function(a){var b="activeLayerInfo-ready-watcher-"+a.layer.uid;e.add(r.init(a,"ready",c),b)});d.forEach(function(a){return e.remove(a.layer.uid)});c()})])};l.prototype.destroy=function(){this._handles.destroy();this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(l.prototype,"ready",{get:function(){return null===
this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});l.prototype.buildLegendElementsForFeatureCollections=function(a){var c=this;this.legendElements=[];a.forEach(function(a){if(a.isInstanceOf&&a.isInstanceOf(x))c._buildRendererLegendElements(a.renderer,a.title,"append");else if(a.featureSet&&a.featureSet.features.length){var b=
a.layerDefinition;(b=(b=b&&b.drawingInfo)&&L.fromJSON(b.renderer))?c._buildRendererLegendElements(b,a.name,"append"):J.warn("drawingInfo not available!")}})};l.prototype.buildLegendElementsForRenderer=function(){this._buildRendererLegendElements(this.layer.renderer,null,"replace")};l.prototype.buildLegendElementsForTools=function(){var c=this,b=this.layer;b.isInstanceOf(v)?this._constructLegendElementsForWMTSlayer():b.isInstanceOf(h)?this._constructLegendElementsForWMSSublayers():b.isInstanceOf(a)?
this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),this._getLegendLayers().then(function(a){c.legendElements=[];a.forEach(function(a){if("esri.layers.ImageryLayer"===c.layer.declaredClass){var d=b.watch("renderingRule, bandIds",function(){c._legendResponse["default"]=null;c.buildLegendElementsForTools()});c._handles.add(d,"imageryLayers-watcher")}(a=c._generateSymbolTableElementForLegendLayer(a))&&a.infos.length&&c.legendElements.push(a);c.notifyChange("ready")});
c.notifyChange("ready")}).otherwise(function(a){J.warn("Request to server for legend has failed!",a)}))};l.prototype._isGroupActive=function(){var a=this.children;return a.length?a.some(function(a){return a.ready}):!1};l.prototype._buildRendererLegendElements=function(a,c,b){var d=this;this._getRendererLegendElements(a,c).then(function(a){"append"===b?Array.prototype.push.apply(d.legendElements,a):d.legendElements=a;d.notifyChange("ready")}).otherwise(function(a){J.warn("error while building legend for layer!",
a)})};l.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");var a=this.layer,c=a.activeLayer;this._handles.add(r.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(c.styleId&&c.styles){var b=null;c.styles.some(function(a){if(c.styleId===a.id)return b=a.legendUrl,!0});b&&(this.legendElements=[{type:"symbol-table",title:c.title,infos:[{src:b,opacity:a.opacity}]}])}this.notifyChange("ready")};
l.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");var a=this.layer,c=null;if(a.customParameters||a.customLayerParameters)c=b.clone(a.customParameters||{}),b.mixin(c,a.customLayerParameters||{});this._handles.add(r.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(a.sublayers,c);this.notifyChange("ready")};
l.prototype._generateLegendElementsForWMSSublayers=function(a,c){var b=this,d=[];this._handles.add(a.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");a.forEach(function(a){var e=a.watch("title, visible, legendEnabled",function(){return b._constructLegendElementsForWMSSublayers()});b._handles.add(e,"wms-sublayers-watcher");a.visible&&a.legendEnabled&&(a=b._generateSymbolTableElementForWMSSublayer(a,c))&&a.infos.length&&d.unshift(a)});return d};l.prototype._generateSymbolTableElementForWMSSublayer=
function(a,c){return!a.legendUrl&&a.sublayers?(c=this._generateLegendElementsForWMSSublayers(a.sublayers,c).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:c}):this._generateSymbolTableElementForLegendUrl(a,c)};l.prototype._generateSymbolTableElementForLegendUrl=function(a,c){var b=a.legendUrl;if(b){var e={type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};c&&(b+="?"+d.objectToQuery(c));e.infos.push({src:b,opacity:a.layer&&a.layer.opacity});return e}};l.prototype._getLegendLayers=
function(a){var c=this,b=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",d=this._legendResponse&&this._legendResponse[b];return d?q.resolve(d):this._legendRequest(a).then(function(a){a=a.layers;return c._legendResponse[b]=a})};l.prototype._legendRequest=function(a){var c=this.layer;a={f:"json",dynamicLayers:a};"esri.layers.ImageryLayer"===c.declaredClass&&(c.renderingRule&&(a.renderingRule=JSON.stringify(c.renderingRule.toJSON())),c.bandIds&&(a.bandIds=c.bandIds.join()));var b=c.url.replace(/(\/)+$/,
"");if(10.01<=c.version){var d=b.indexOf("?"),b=-1<d?b.substring(0,d)+"/legend"+b.substring(d):b+"/legend";c.token&&(b+="?token\x3d"+c.token)}else c=b.toLowerCase().indexOf("/rest/"),c=b.substring(0,c)+b.substring(c+5,b.length),b="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(c)+"\x26returnbytes\x3dtrue";return z(b,{query:a,callbackParamName:"callback"}).then(function(a){return a.data})};l.prototype._constructLegendElementsForSublayers=function(){var a=this;this.legendElements=
[];this._handles.remove("sublayers-watcher");var b=this.layer,d=new c({layer:b});this._getLegendLayers(d).then(function(c){var d={};c.forEach(function(a){d[a.layerId]=a});a._handles.add(r.watch(b,"sublayers",a._constructLegendElementsForSublayers.bind(a)),"sublayers-watcher");a.legendElements=a._generateLegendElementsForSublayers(b.sublayers,d,b.opacity);a.notifyChange("ready")}).otherwise(function(a){J.warn("Request to server for legend has failed!",a)}).then(function(){return d.destroy()});this.notifyChange("ready")};
l.prototype._generateLegendElementsForSublayers=function(a,c,b){var d=this,e=[];this._handles.add(a.on("change",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");a.forEach(function(a){var f=a.watch("renderer, opacity, title, visible",function(){return d._constructLegendElementsForSublayers()});d._handles.add(f,"sublayers-watcher");a.visible&&a.legendEnabled&&(f=a&&null!=a.opacity?a.opacity:null,(a=d._generateSymbolTableElementForSublayer(a,c,null!=f?f*b:b))&&a.infos.length&&
e.unshift(a))});return e};l.prototype._generateSymbolTableElementForSublayer=function(a,c,b){var d=c[a.id];return!d&&a.sublayers?(c=this._generateLegendElementsForSublayers(a.sublayers,c,b).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:c}):this._generateSymbolTableElementForLegendLayer(d,a,b)};l.prototype._generateSymbolTableElementForLegendLayer=function(a,c,b){var d=this;if(a){var e=c&&c.renderer,f=c&&c.title||a.layerName;e&&(e=c&&c.title||this._getRendererTitle(e,c))&&
(f&&(e.title=f),f=e);f={type:"symbol-table",title:f,infos:[]};a.legendType&&(f.legendType=a.legendType);a.legend&&this._isLegendLayerInScale(a,c)&&(c=c?this._sanitizeLegendForSublayer(a.legend.slice(),c):a.legend,f.infos=c.map(function(c){var e=c.url;if(c.imageData&&0<c.imageData.length)e="data:image/png;base64,"+c.imageData;else if(0!==e.indexOf("http")){var e=d.layer.url+"/"+a.layerId+"/images/"+e,f=d.layer.token;f&&(e+="?token\x3d"+f)}else return null;return{label:c.label,src:e,opacity:b,width:c.width,
height:c.height}}).filter(function(a){return!!a}));return f.infos.length?f:null}};l.prototype._isLegendLayerInScale=function(a,c){c=c||this.layer;var b=null,d=null,e=!0;!c.minScale&&0!==c.minScale||!c.maxScale&&0!==c.maxScale?(0===a.minScale&&c.tileInfo&&(b=c.tileInfo.lods[0].scale),0===a.maxScale&&c.tileInfo&&(d=c.tileInfo.lods[c.tileInfo.lods.length-1].scale)):(b=Math.min(c.minScale,a.minScale)||c.minScale||a.minScale,d=Math.max(c.maxScale,a.maxScale));if(0<b&&b<this.scale||d>this.scale)e=!1;return e};
l.prototype._sanitizeLegendForSublayer=function(a,c){if(10.1>this.layer.version||0===a.length)return a;c=c.renderer;var b=null,d=null;a.some(function(a){return a.values})&&a.some(function(a,c){a.values||(b=c,d=a,d.label||(d.label="others"));return null!=d});c?"unique-value"===c.type?d&&(a.splice(b,1),a.push(d)):"class-breaks"===c.type&&(d&&a.splice(b,1),a.reverse(),d&&a.push(d)):d&&(a.splice(b,1),a.push(d));return a};l.prototype._getRendererLegendElements=function(a,c){return a.isInstanceOf(m)||a.isInstanceOf(f)||
a.isInstanceOf(B)||a.isInstanceOf(C)||a.isInstanceOf(E)||a.isInstanceOf(H)?a.isInstanceOf(w)?this._constructPointCloudRendererLegendElements(a,c):this._constructRendererLegendElements(a,c):(J.warn("Renderer not supported!"),q.resolve([]))};l.prototype._constructPointCloudRendererLegendElements=function(a,c){var b=this,d=this.layer.opacity,e=[],f=null,m=null;if(a.isInstanceOf(C))f={type:"symbol-table",title:c||a.field,infos:[]},a.colorClassBreakInfos.forEach(function(a){f.infos.unshift({label:a.label||
a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:b._getAppliedCloneSymbol(F,a.color,d)})});else if(a.isInstanceOf(E)){var m=a.stops,h=null;if(m.length&&(1===m.length&&(h=m[0].color),!h)){var k=m[0].value,z=m[m.length-1].value;null!=k&&null!=z&&(h=G.getColorFromPointCloudStops(k+(z-k)/2,m))}f={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(F,h||F.color,d)}]};m={type:"color-ramp",title:c||a.field,borderColor:I.getStroke(F).color,overlayColor:G.getRampOverlayColor(d),
infos:G.getRampStopsForPointCloud(a.stops)}}else a.isInstanceOf(H)&&(f={type:"symbol-table",title:c||a.field,infos:[]},a.colorUniqueValueInfos.forEach(function(a){f.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:b._getAppliedCloneSymbol(F,a.color,d)})}));f&&f.infos.length&&e.push(f);m&&m.infos.length&&e.push(m);a=e.reduce(function(a,c){return a.concat(c.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return b._getSymbolPreview(a)});return q.eachAlways(a).then(function(){return e})};
l.prototype._constructRendererLegendElements=function(a,c){var b=this;return this._loadRenderer(a).then(function(a){b._hasColorRamp=!1;b._hasOpacityRamp=!1;b._hasSizeRamp=!1;var d=b._getVisualVariableLegendElements(a)||[],e={type:"symbol-table",title:c||b._getRendererTitle(a),infos:[]},h=null;if(a.isInstanceOf(B)){var k=a.field;a.uniqueValueInfos.forEach(function(a){a.symbol&&e.infos.push({label:a.label||b._getDomainName(k,a.value)||a.value,value:a.value,symbol:a.symbol})})}else a.isInstanceOf(f)?
(h=b._isUnclassedRenderer(a),h&&b._hasSizeRamp||(a.classBreakInfos.forEach(function(a){a.symbol&&e.infos.unshift({label:a.label||(h?null:a.minValue+" - "+a.maxValue),value:[a.minValue,a.maxValue],symbol:a.symbol})}),h&&(e.title=null))):a.isInstanceOf(m)&&a.symbol&&!b._hasSizeRamp&&e.infos.push({label:a.label,symbol:a.symbol});var z=!1,w=a.defaultLabel,G=a.defaultSymbol;G&&!h&&(e.infos.push({label:w||"others",symbol:G}),z=!0);z||a.isInstanceOf(m)||h&&!b._hasColorRamp&&!b._hasSizeRamp&&!b._hasOpacityRamp||
d.push({type:"symbol-table",infos:[{label:a.defaultLabel,symbol:a.defaultSymbol}]});e.infos.length&&d.unshift(e);var g=b._getSymbolConfig(a.visualVariables),z=d.reduce(function(a,c){return a.concat(c.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return b._getSymbolPreview(a,g)});a=null;return q.eachAlways(z).then(function(){return d})})};l.prototype._getSymbolConfig=function(a){var c=!1,b=!1;if(a)for(var d=0;d<a.length&&(!c||!b);d++){var e=a[d];"size"===e.type&&("height"===e.axis&&
(c=!0),"width-and-depth"===e.axis&&(b=!0))}return c&&b?"tall":null};l.prototype._getSymbolPreview=function(a,c){return O.renderPreviewHTML(a.symbol,{size:a.size,opacity:this.layer.opacity,symbolConfig:c}).then(function(c){a.preview=c;return a}).otherwise(function(){a.preview=null;return a})};l.prototype._loadRenderer=function(a){var c=this,b=[];a=a.clone();var d=this._getMedianColor(a),e=this.layer.opacity;if(a.isInstanceOf(f)||a.isInstanceOf(B)){var h=(a.classBreakInfos||a.uniqueValueInfos).map(function(a){return c._fetchSymbol(a.symbol,
d,e).then(function(c){a.symbol=c}).otherwise(function(){a.symbol=null})});Array.prototype.push.apply(b,h)}b.push(this._fetchSymbol(a.symbol||a.defaultSymbol,a.defaultSymbol?null:d,e).then(function(b){c._applySymbolToRenderer(a,b,a.isInstanceOf(m))}).otherwise(function(){c._applySymbolToRenderer(a,null,a.isInstanceOf(m))}));return q.eachAlways(b).then(function(){return a})};l.prototype._applySymbolToRenderer=function(a,c,b){b?a.symbol=c:a.defaultSymbol=c};l.prototype._getMedianColor=function(a){if(!a.visualVariables)return null;
var c=K.find(a.visualVariables,function(a){return"color"===a.type});if(!c)return null;var b=null,d=null;if(c.colors)b=c.minDataValue,d=c.maxDataValue;else if(c.stops){if(1===c.stops.length)return c.stops[0].color;b=c.stops[0].value;d=c.stops[c.stops.length-1].value}if(null!=b&&null!=d)return a.getColor(b+(d-b)/2,{colorInfo:c})};l.prototype._fetchSymbol=function(a,c,b){var d=this;if(!a)return q.reject();if("web-style"===a.type){var e=a.portal,e=a.name+"-"+a.styleName+"-"+a.styleUrl+"-"+(e&&e.url)+
"-"+(e&&e.user&&e.user.username),f=this._webStyleSymbolCache;f.has(e)||f.set(e,a.fetchSymbol());return f.get(e).then(function(a){return d._getAppliedCloneSymbol(a,c,b)}).otherwise(function(){J.warn("Fetching web-style failed!");return q.reject()})}return q.resolve(this._getAppliedCloneSymbol(a,c,b))};l.prototype._getAppliedCloneSymbol=function(a,c,b){if(!a)return a;a=a.clone();var d=-1<a.type.indexOf("3d");c=c&&c.toRgba();d?this._applyColorTo3dSymbol(a,c,b):(a.color&&(a.color=this._getOpacityAppliedColor(c||
a.color.toRgba(),b)),(c=a.outline)&&c.color&&(c.color=this._getOpacityAppliedColor(c.color.toRgba(),b)));return a};l.prototype._applyColorTo3dSymbol=function(a,c,b){var d=this;a.symbolLayers.forEach(function(a){a&&(c&&(a.material||(a.material={}),a.material.color=new A(c)),null!=b&&(a.material&&a.material.color&&(a.material.color=d._getOpacityAppliedColor(a.material.color.toRgba(),b)),a.outline&&a.outline.color&&(a.outline.color=d._getOpacityAppliedColor(a.outline.color.toRgba(),b))))})};l.prototype._getOpacityAppliedColor=
function(a,c){a[3]*=c;return a};l.prototype._getVisualVariableLegendElements=function(a){var c=this,b=a.visualVariables,d=[],e=[],h=[],k=this.layer.opacity;if(!b)return null;b.forEach(function(a){"color"===a.type?d.push(a):"size"===a.type?e.push(a):"opacity"===a.type&&h.push(a)});var b=d.concat(e,h),z,w;0===d.length&&a.isInstanceOf(f)&&a.classBreakInfos&&1===a.classBreakInfos.length&&(z=(z=a.classBreakInfos[0])&&z.symbol);0===d.length&&a.isInstanceOf(m)&&(z=a.symbol);z&&(-1<z.type.indexOf("3d")?(z=
z.symbolLayers.getItemAt(0),z.get("material.color")&&(w=z.material.color)):z.url||(w=z.color),w&&(w=w.toRgba()));return b.map(function(b){if(!b.legendOptions||!1!==b.legendOptions.showLegend){var d=c._getRampTitle(b,c.layer),e=G.getRampBorderColor(a),f=G.getRampOverlayColor(k),h=null;"color"===b.type?(h={type:"color-ramp",title:d,borderColor:e,overlayColor:f,infos:G.getRampStops(a,b)},c._hasColorRamp||(c._hasColorRamp=!(null==h.infos||!h.infos.length))):"size"===b.type?(h={type:"size-ramp",title:d,
infos:N.getRampStops(a,b,c._getMedianColor(a),c.scale)},c._hasSizeRamp||(c._hasSizeRamp=!(null==h.infos||!h.infos.length))):"opacity"===b.type&&(h={type:"opacity-ramp",title:d,borderColor:e,overlayColor:f,infos:G.getRampStops(a,b,w)},c._hasOpacityRamp||(c._hasOpacityRamp=!(null==h.infos||!h.infos.length)));return h.infos&&h}}).filter(function(a){return!!a})};l.prototype._getDomainName=function(a,c){if(!b.isFunction(a)){var d=this.layer;return(d=(a=d.getField&&d.getField(a))&&d.getFieldDomain?d.getFieldDomain(a.name):
null)&&d.codedValues?d.getName(c):null}return null};l.prototype._getRampTitle=function(a,c){var d=a.field,e=a.normalizationField,f=!1,h=!1,m=!1,z=null,d=b.isFunction(d)?null:d,e=b.isFunction(e)?null:e;if(void 0!==(a.legendOptions&&a.legendOptions.title))z=a.legendOptions.title;else if(a.valueExpressionTitle)z=a.valueExpressionTitle;else{if(c.renderer.authoringInfo&&c.renderer.authoringInfo.visualVariables)for(a=c.renderer.authoringInfo.visualVariables,z=0;z<a.length;z++){var k=a[z];if("colorInfo"===
k.type)if("ratio"===k.style){f=!0;break}else if("percent"===k.style){h=!0;break}else if("percentTotal"===k.style){m=!0;break}}z={field:d&&this._getFieldAlias(d,c),normField:e&&this._getFieldAlias(e,c),ratio:f,ratioPercent:h,ratioPercentTotal:m}}return z};l.prototype._getRendererTitle=function(a,c){if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;var d=this.layer,e=a.field,h=null,z=null;a instanceof f&&(h=a.normalizationField,
z="percent-of-total"===a.normalizationType);e=b.isFunction(e)?null:e;h=b.isFunction(h)?null:h;a=null;if(e||h)a={field:c?e:e&&this._getFieldAlias(e,d),normField:c?h:h&&this._getFieldAlias(h,d),normByPct:z};return a};l.prototype._getFieldAlias=function(a,c){var d=c.popupTemplate,d=d&&d.fieldInfos;c=b.isFunction(a)?null:c.getField&&c.getField(a);var e=null;d&&d.some(function(c){if(a===c.fieldName)return e=c,!0});var d=e||c,f=null;d&&(f=e&&e.label||c&&c.alias||d.name||d.fieldName);return f};l.prototype._isUnclassedRenderer=
function(a){var c=a.visualVariables,b=!1;a.isInstanceOf(f)&&a.classBreakInfos&&1===a.classBreakInfos.length&&c&&(b=a.field?c.some(function(c){return!(!c||a.field!==c.field||(a.normalizationField||c.normalizationField)&&a.normalizationField!==c.normalizationField)}):!!c.length);return b};e([D.property()],l.prototype,"children",void 0);e([D.property()],l.prototype,"layer",void 0);e([D.property()],l.prototype,"legendElements",void 0);e([D.property()],l.prototype,"parent",void 0);e([D.property({readOnly:!0})],
l.prototype,"ready",null);e([D.property()],l.prototype,"scale",void 0);e([D.property()],l.prototype,"title",void 0);e([D.property({dependsOn:["ready"],readOnly:!0,value:0})],l.prototype,"version",null);return l=e([D.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],l)}(D.declared(l))})},"esri/layers/WMSLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/_base/lang ../core/Collection ../core/HandleRegistry ../core/promiseUtils ../core/CollectionFlattener ../core/accessorSupport/write ../geometry/Extent ../geometry/SpatialReference ../request ../Graphic ../PopupTemplate ./Layer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/wmsUtils ./support/WMSSublayer ./support/ExportWMSImageParameters".split(" "),
function(y,n,g,e,b,d,l,u,p,t,q,r,x,h,v,a,c,m,f,B,C,w,E,H){function k(a,c){return a.some(function(a){for(var b in a)if(q.willPropertyWrite(a,b,null,c))return!0;return!1})}function A(a,c,b){var d=[],e=new Map;a.forEach(function(a){var f=new E;f.read(a,c);b&&-1===b.indexOf(f.name)&&(f.visible=!1);e[f.id]=f;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=e[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(f)):d.unshift(f)});return d}return function(c){function f(a,b){var d=c.call(this)||
this;d._sublayersHandles=new u;d.allSublayers=new t({root:d,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});d.customParameters=null;d.customLayerParameters=null;d.copyright=null;d.description=null;d.fullExtent=null;d.fullExtents=null;d.featureInfoFormat=null;d.featureInfoUrl=null;d.imageFormat=null;d.imageMaxHeight=2048;d.imageMaxWidth=2048;d.imageTransparency=!0;d.legendEnabled=!0;d.mapUrl=null;d.operationalLayerType="WMS";d.spatialReference=null;d.spatialReferences=
null;d.sublayers=null;d.type="wms";d.version=null;d.watch("sublayers",function(a,c){c&&(c.forEach(function(a){a.layer=null}),d._sublayersHandles.removeAll(),d._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=d;a.layer=d}),d._sublayersHandles||(d._sublayersHandles=new u),d._sublayersHandles.add([a.on("after-add",function(a){a=a.item;a.parent=d;a.layer=d}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})]))},!0);return d}g(f,c);f.prototype.normalizeCtorArgs=function(a,
c){return"string"===typeof a?d.mixin({url:a},c):a};f.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]}).then(function(){return a._fetchService()}));return this};f.prototype.readFullExtentFromItemOrMap=function(a,c,b){a=c.extent;return(c=c.spatialReferences)&&0<c.length?new r({xmin:a[0][0],ymin:a[0][1],xmax:a[1][0],ymax:a[1][1],spatialReference:c[0]}):new r({xmin:a[0][0],ymin:a[0][1],xmax:a[1][0],ymax:a[1][1]})};f.prototype.writeFullExtent=function(a,
c,b,d){c.extent=[[a.xmin,a.ymin],[a.xmax,a.ymax]]};f.prototype.readImageFormat=function(a,c){return(a=c.supportedImageFormatTypes)&&-1<a.indexOf("image/png")?"image/png":a&&a[0]};f.prototype.readSpatialReferenceFromItemOrDocument=function(a,c,b){return new x(c.spatialReferences[0])};f.prototype.writeSpatialReferences=function(a,c,b,d){var e=this.spatialReference&&this.spatialReference.wkid;a&&e?(c.spatialReferences=a.filter(function(a){return a!==e}),c.spatialReferences.unshift(e)):c.spatialReferences=
a};f.prototype.readSublayersFromItemOrMap=function(a,c,b){return A(c.layers,b,c.visibleLayers)};f.prototype.readSublayers=function(a,c,b){return A(c.layers,b)};f.prototype.writeSublayers=function(a,c,b,e){c.layers=[];var f=new Map;a=a.flatten(function(a){return(a=a.sublayers)&&a.toArray()}).toArray();a.forEach(function(a){"number"===typeof a.parent.id&&(f.has(a.parent.id)?f.get(a.parent.id).push(a.id):f.set(a.parent.id,[a.id]))});a.forEach(function(a){var b=d.mixin({sublayer:a},e),h=a.write({parentLayerId:"number"===
typeof a.parent.id?a.parent.id:-1},b);f.has(a.id)&&(h.sublayerIds=f.get(a.id));!a.sublayers&&a.name&&(a=a.write({},b),delete a.id,c.layers.push(a))});c.visibleLayers=a.filter(function(a){return a.visible&&!a.sublayers}).map(function(a){return a.name})};f.prototype.createExportImageParameters=function(a){this._exportWMSImageParameters=new H({layer:this,extent:a});return this._exportWMSImageParameters.toJSON()};f.prototype.fetchImage=function(a,c,b,e){var f=this.parsedUrl.path;a=d.mixin({width:c,height:b},
this.createExportImageParameters(a));a=this._mixCustomParameters(a);return h(f,{query:a,responseType:"image",allowImageDataAccess:e&&e.allowImageDataAccess||!1}).then(function(a){return a.data})};f.prototype.fetchFeatureInfo=function(c,b,e,f,m){var z=this,k=w.getPopupLayers(this._exportWMSImageParameters.visibleSublayers);if(!this.featureInfoUrl||!k)return null;b=d.mixin({query_layers:k,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:b,height:e},"1.3.0"===this.version?
{I:f,J:m}:{x:f,y:m});var g=d.mixin(this.createExportImageParameters(c),b),g=this._mixCustomParameters(g);return h(this.featureInfoUrl,{query:g,responseType:"text/html"}).then(function(c){var b=z.featureInfoUrl,b=b+(-1===b.indexOf("?")?"?":""),d;for(d in g)b+="?"===b.substring(b.length-1,b.length)?"":"\x26",b+=d+"\x3d"+g[d];return new v({popupTemplate:new a({title:z.title,content:'\x3ciframe src\x3d"'+b+'" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0"\x3e'+c.data+"\x3cframe\x3e"})})})};
f.prototype.findSublayerById=function(a){return this.allSublayers.find(function(c){return c.id===a})};f.prototype._fetchService=function(){var a=this;return p.resolve().then(function(){if(a.resourceInfo)return{ssl:!1,data:a.resourceInfo};a.parsedUrl.query&&a.parsedUrl.query.service&&(a.parsedUrl.query.SERVICE=a.parsedUrl.query.service,delete a.parsedUrl.query);a.parsedUrl.query&&a.parsedUrl.query.request&&(a.parsedUrl.query.REQUEST=a.parsedUrl.query.service,delete a.parsedUrl.query.request);return h(a.parsedUrl.path,
{query:d.mixin({SERVICE:"WMS",REQUEST:"GetCapabilities"},a.parsedUrl.query,a.customParameters),responseType:"xml"})}).then(function(c){c.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.resourceInfo||(c.data=w.parseCapabilities(c.data));c.data&&a.read(c.data,{origin:"service"})})};f.prototype._mixCustomParameters=function(a){if(!this.customLayerParameters&&!this.customParameters)return a;var c=d.mixin({},this.customParameters,this.customLayerParameters),b;for(b in c)a[b.toLowerCase()]=c[b];return a};
e([b.shared({"2d":"../views/2d/layers/WMSLayerView2D","3d":"../views/3d/layers/WMSLayerView3D"})],f.prototype,"viewModulePaths",void 0);e([b.property({readOnly:!0})],f.prototype,"allSublayers",void 0);e([b.property({json:{write:!0}})],f.prototype,"customParameters",void 0);e([b.property({json:{write:!0}})],f.prototype,"customLayerParameters",void 0);e([b.property({json:{write:!0}})],f.prototype,"copyright",void 0);e([b.property()],f.prototype,"description",void 0);e([b.property({json:{origins:{service:{read:{source:"extent"}}}}})],
f.prototype,"fullExtent",void 0);e([b.reader(["web-document","portal-item"],"fullExtent",["extent"])],f.prototype,"readFullExtentFromItemOrMap",null);e([b.writer(["web-document","portal-item"],"fullExtent")],f.prototype,"writeFullExtent",null);e([b.property()],f.prototype,"fullExtents",void 0);e([b.property({json:{write:{ignoreOrigin:!0}}})],f.prototype,"featureInfoFormat",void 0);e([b.property({json:{write:{ignoreOrigin:!0}}})],f.prototype,"featureInfoUrl",void 0);e([b.property({json:{origins:{webDocument:{read:{source:"format"},
write:{target:"format"}}}}})],f.prototype,"imageFormat",void 0);e([b.reader("imageFormat",["supportedImageFormatTypes"])],f.prototype,"readImageFormat",null);e([b.property({json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],f.prototype,"imageMaxHeight",void 0);e([b.property({json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],f.prototype,"imageMaxWidth",void 0);e([b.property()],f.prototype,"imageTransparency",void 0);e([b.property({type:Boolean,json:{read:{source:"showLegend"},
write:{target:"showLegend"}}})],f.prototype,"legendEnabled",void 0);e([b.property({json:{write:{ignoreOrigin:!0}}})],f.prototype,"mapUrl",void 0);e([b.property()],f.prototype,"operationalLayerType",void 0);e([b.property({json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],f.prototype,"spatialReference",void 0);e([b.reader(["web-document","portal-item"],"spatialReference",["spatialReferences"])],f.prototype,"readSpatialReferenceFromItemOrDocument",null);e([b.property({json:{read:{source:"spatialReferences"},
write:{ignoreOrigin:!0}}})],f.prototype,"spatialReferences",void 0);e([b.writer(["web-document","portal-item"],"spatialReferences")],f.prototype,"writeSpatialReferences",null);e([b.property({type:l.ofType(E),json:{write:{overridePolicy:function(a,c,b){if(k(this.allSublayers,b))return{ignoreOrigin:!0}}}}})],f.prototype,"sublayers",void 0);e([b.reader(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],f.prototype,"readSublayersFromItemOrMap",null);e([b.reader("service","sublayers",
["layers"])],f.prototype,"readSublayers",null);e([b.writer("sublayers")],f.prototype,"writeSublayers",null);e([b.property({json:{read:!1},readOnly:!0,value:"wms"})],f.prototype,"type",void 0);e([b.property({json:{write:{ignoreOrigin:!0}}})],f.prototype,"version",void 0);return f=e([b.subclass("esri.layers.WMSLayer")],f)}(b.declared(c,m,f,B,C))})},"esri/layers/support/wmsUtils":function(){define(["require","exports","../../geometry/Extent","../../geometry/SpatialReference","../../core/urlUtils"],function(y,
n,g,e,b){function d(a){return v.some(function(c){var b=c[1];return a>=c[0]&&a<=b})}function l(a){var c=[];a.forEach(function(a){c.push(a);a.sublayers&&a.sublayers.length&&(c=c.concat(l(a.sublayers)),delete a.sublayers)});return c}function u(a,c,b,d){return(a=p(a,b))?a.getAttribute(c):d}function p(a,c){return(a=c&&c.getElementsByTagName(a))&&0<a.length?a[0]:null}function t(a,c,b){return(a=p(a,c))?a.textContent:b}function q(a,c,b){if(!a)return null;var d=parseFloat(a.getAttribute("minx")),f=parseFloat(a.getAttribute("miny")),
h=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));b?(b=isNaN(f)?-Number.MAX_VALUE:f,d=isNaN(d)?-Number.MAX_VALUE:d,f=isNaN(a)?Number.MAX_VALUE:a,h=isNaN(h)?Number.MAX_VALUE:h):(b=isNaN(d)?-Number.MAX_VALUE:d,d=isNaN(f)?-Number.MAX_VALUE:f,f=isNaN(h)?Number.MAX_VALUE:h,h=isNaN(a)?Number.MAX_VALUE:a);c=new e({wkid:c});return new g({xmin:b,ymin:d,xmax:f,ymax:h,spatialReference:c})}function r(a,c){a=p(c,a);if(a=p("DCPType",a))if(a=p("HTTP",a))if(a=p("Get",a)){var d=u("OnlineResource",
"xlink:href",a,null);if(d){d.indexOf("\x26")===d.length-1&&(d=d.substring(0,d.length-1));a=["service","request"];c=[];var d=b.urlToObject(d),e;for(e in d.query)d.query.hasOwnProperty(e)&&-1===a.indexOf(e.toLowerCase())&&c.push(e+"\x3d"+d.query[e]);return d.path+(c.length?"?"+c.join("\x26"):"")}}return null}function x(a,c){var b=a.getElementsByTagName("Operation");if(b&&b.length){var d=[];Array.prototype.slice.call(b).forEach(function(a){a.getAttribute("name")===c&&(a=a.getElementsByTagName("Format"),
Array.prototype.slice.call(a).forEach(function(a){d.push(a.textContent)}))});return d}a=p(c,a).getElementsByTagName("Format");return Array.prototype.slice.call(a).map(function(a){return a.textContent})}function h(b,f){if(!b)return null;var m={id:c++,fullExtents:[],parentLayerId:null,queryable:"1"===b.getAttribute("queryable"),spatialReferences:[],sublayers:null},l=p("LatLonBoundingBox",b),w=p("EX_GeographicBoundingBox",b),v=null;l&&(v=q(l,4326));w&&(v=new g(0,0,0,0,new e({wkid:4326})),v.xmin=parseFloat(t("westBoundLongitude",
w,0)),v.ymin=parseFloat(t("southBoundLatitude",w,0)),v.xmax=parseFloat(t("eastBoundLongitude",w,0)),v.ymax=parseFloat(t("northBoundLatitude",w,0)));l||w||(v=new g(-180,-90,180,90,new e({wkid:4326})));var r=-1<["1.0.0","1.1.0","1.1.1"].indexOf(f)?"SRS":"CRS";Array.prototype.slice.call(b.childNodes).forEach(function(c){if("Name"===c.nodeName)m.name=c.textContent||"";else if("Title"===c.nodeName)m.title=c.textContent||"";else if("Abstract"===c.nodeName)m.description=c.textContent||"";else if("BoundingBox"===
c.nodeName){var b=c.getAttribute(r);if(b&&0===b.indexOf("EPSG:")){var e=parseInt(b.substring(5),10);0===e||isNaN(e)||v||(v="1.3.0"===f?q(c,e,d(e)):q(c,e))}(e=b&&b.indexOf(":"))&&-1<e&&(e=parseInt(b.substring(e+1,b.length),10),0===e||isNaN(e)||(e=a[e]?a[e]:e),c="1.3.0"===f?q(c,e,d(e)):q(c,e),m.fullExtents.push(c))}else if(c.nodeName===r)c.textContent.split(" ").forEach(function(c){c=-1<c.indexOf(":")?parseInt(c.split(":")[1],10):parseInt(c,10);0===c||isNaN(c)||(a[c]&&(c=a[c]),-1===m.spatialReferences.indexOf(c)&&
m.spatialReferences.push(c))});else if("Style"!==c.nodeName||m.legendURL)"Layer"===c.nodeName&&(c=h(c,f))&&(c.parentLayerId=m.id,m.sublayers||(m.sublayers=[]),m.sublayers.push(c));else if(c=p("LegendURL",c))if(c=p("OnlineResource",c))m.legendURL=c.getAttribute("xlink:href")});m.extent=v&&v.toJSON();return m}Object.defineProperty(n,"__esModule",{value:!0});var v=[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,
2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,
31700]],a={84:4326,83:4269,27:4267},c;n.parseCapabilities=function(a){if(a){c=-1;"string"===typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"));var b=a.documentElement,d=p("Layer",b);if(d){var e=u("WMS_Capabilities","version",b,null)||u("WMT_MS_Capabilities","version",b,"1.3.0"),m=p("Service",b);a=t("Title",m,"")||t("Name",m,"");var v=t("AccessConstraints",m,""),q=t("Abstract",m,""),k=parseInt(t("MaxWidth",m,5E3),10),m=parseInt(t("MaxHeight",m,5E3),10),A=h(d,e),z=0,G,d=p("Capability",b);Array.prototype.slice.call(d.childNodes).forEach(function(a){"Layer"===
a.nodeName&&(0===z?G=a:(1===z&&A.name&&(A.name="",A.sublayers.push(h(G,e))),A.sublayers.push(h(a,e))),z++)});if(!A)return null;var n=[],K,D,d=A.fullExtents;(n=A.sublayers)&&0!==n.length||n.push(A);K=A.extent;K||(K=new g(n[0].extent),A.extent=K.toJSON(),K=A.extent);D=A.spatialReferences;if(!D.length&&0<n.length){var L=function(a){var c=[];a.sublayers.forEach(function(a){!c.length&&a.spatialReferences.length&&(c=a.spatialReferences||L(a))});return c};n.forEach(function(a){D.length||(D=a.spatialReferences||
L(a))})}var y=r(b,"GetMap"),I=x(b,"GetMap"),J=r(b,"GetFeatureInfo"),F;J&&(b=x(b,"GetFeatureInfo"),-1<b.indexOf("text/html")?F="text/html":-1<b.indexOf("text/plain")&&(F="text/plain"));if(!F){var M=function(a){a&&(a.queryable=!1,a.sublayers&&a.sublayers.forEach(function(a){M(a)}))};M(A)}b=l(n);return{copyright:v,description:q,extent:K,fullExtents:d,featureInfoFormat:F,featureInfoUrl:J,mapUrl:y,maxImageWidth:k,maxImageHeight:m,layers:b,spatialReferences:D,supportedImageFormatTypes:I,title:a,version:e}}}};
n.coordsReversed=d;n.getPopupLayers=function(a){return a.length?a.filter(function(a){return a.popupEnabled&&a.name&&a.queryable}).map(function(a){return a.name}).join(","):""}})},"esri/layers/support/WMSSublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators ../../core/MultiOriginJSONSupport ../../core/Collection ../../core/accessorSupport/ensureType ../../core/HandleRegistry ../../geometry/Extent".split(" "),
function(y,n,g,e,b,d,l,u,p,t,q){var r=0;return function(b){function h(a){a=b.call(this)||this;a._sublayersHandles=new t;a.fullExtents=null;a.featureInfoFormat=null;a.featureInfoUrl=null;a.legendUrl=null;a.legendEnabled=!0;a.popupEnabled=!1;a.queryable=!1;a.spatialReferences=null;return a}g(h,b);v=h;Object.defineProperty(h.prototype,"description",{get:function(){return this._get("description")},set:function(a){this._set("description",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"fullExtent",{get:function(){return this._get("fullExtent")},set:function(a){this._set("fullExtent",a)},enumerable:!0,configurable:!0});h.prototype.readExtent=function(a,c,b){return(a=c.extent)?q.fromJSON(a):null};Object.defineProperty(h.prototype,"id",{get:function(){var a=this._get("id");return null==a?r++:a},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(c){return c.layer=
a})},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"name",{get:function(){return this._get("name")},set:function(a){this._set("name",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"sublayers",{set:function(a){var c=this,b=this._get("sublayers");b&&(b.forEach(function(a){a.layer=null}),this._sublayersHandles.removeAll(),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=c;a.layer=c.layer}),this._sublayersHandles.add([a.on("after-add",function(a){a=
a.item;a.parent=c;a.layer=c.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})]));this._set("sublayers",a)},enumerable:!0,configurable:!0});h.prototype.castSublayers=function(a){return p.default(u.ofType(v),a)};Object.defineProperty(h.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._setAndNotifyLayer("visible",
a)},enumerable:!0,configurable:!0});h.prototype.clone=function(){var a=new v;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent.clone());this.hasOwnProperty("fullExtents")&&(a.fullExtents=this.fullExtents.map(function(a){return a.clone()}));this.hasOwnProperty("featureInfoFormat")&&(a.featureInfoFormat=this.featureInfoFormat);this.hasOwnProperty("featureInfoUrl")&&(a.featureInfoUrl=this.featureInfoUrl);this.hasOwnProperty("legendUrl")&&
(a.legendUrl=this.legendUrl);this.hasOwnProperty("legendEnabled")&&(a.legendEnabled=this.legendEnabled);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("name")&&(a.name=this.name);this.hasOwnProperty("parent")&&(a.parent=this.parent);this.hasOwnProperty("queryable")&&(a.queryable=this.queryable);this.hasOwnProperty("sublayers")&&(a.sublayers=this.sublayers&&this.sublayers.map(function(a){return a.clone()}));this.hasOwnProperty("spatialReferences")&&(a.spatialReferences=this.spatialReferences.map(function(a){return a}));
this.hasOwnProperty("visible")&&(a.visible=this.visible);this.hasOwnProperty("title")&&(a.title=this.title);return a};h.prototype._setAndNotifyLayer=function(a,c){var b=this.layer;this._get(a)!==c&&(this._set(a,c),b&&b.emit("wms-sublayer-update",{propertyName:a,id:this.id}))};e([d.property()],h.prototype,"description",null);e([d.property({value:null})],h.prototype,"fullExtent",null);e([d.reader("fullExtent",["extent"])],h.prototype,"readExtent",null);e([d.property()],h.prototype,"fullExtents",void 0);
e([d.property()],h.prototype,"featureInfoFormat",void 0);e([d.property()],h.prototype,"featureInfoUrl",void 0);e([d.property({json:{write:{ignoreOrigin:!0}}})],h.prototype,"id",null);e([d.property({type:String,json:{origins:{webDocument:{read:{source:"legendUrl"},write:{target:"legendUrl"}}},read:{source:"legendURL"},write:{ignoreOrigin:!0}}})],h.prototype,"legendUrl",void 0);e([d.property({value:!0,type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"},origins:{webMap:{read:!1,
write:!1},webScene:{read:!1,write:!1}}}})],h.prototype,"legendEnabled",void 0);e([d.property({value:null})],h.prototype,"layer",null);e([d.property({value:null,json:{read:{source:"name"},write:{ignoreOrigin:!0}}})],h.prototype,"name",null);e([d.property()],h.prototype,"parent",void 0);e([d.property({json:{read:{source:"showPopup"},write:{ignoreOrigin:!0,target:"showPopup"}}})],h.prototype,"popupEnabled",void 0);e([d.property({json:{write:{ignoreOrigin:!0}}})],h.prototype,"queryable",void 0);e([d.property()],
h.prototype,"sublayers",null);e([d.cast("sublayers")],h.prototype,"castSublayers",null);e([d.property({json:{read:{source:"spatialReferences"}}})],h.prototype,"spatialReferences",void 0);e([d.property({value:null,json:{write:{ignoreOrigin:!0}}})],h.prototype,"title",null);e([d.property({value:!0,json:{read:{source:"defaultVisibility"}}})],h.prototype,"visible",null);return h=v=e([d.subclass("esri.layers.support.WMSSublayer")],h);var v}(d.declared(l))})},"esri/layers/support/ExportWMSImageParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators dojo/_base/lang ../../core/Accessor ../../core/HandleRegistry ./wmsUtils".split(" "),
function(y,n,g,e,b,d,l,u,p){var t={visible:"visibleSublayers"},q=[102100,3857,102113,900913],r=[3395,54004];return function(l){function h(){var b=null!==l&&l.apply(this,arguments)||this;b._layerHandles=new u;b.extent=null;return b}g(h,l);Object.defineProperty(h.prototype,"layer",{set:function(b){var a=this;this._get("layer")!==b&&(this._set("layer",b),this._layerHandles&&(this._layerHandles.removeAll(),this._layerHandles=null),b&&(this._layerHandles||(this._layerHandles=new u),this._layerHandles.add([b.sublayers.on("change",
function(){return a.notifyChange("visibleSublayers")}),b.on("wms-sublayer-update",function(c){return a.notifyChange(t[c.propertyName])})])))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"layers",{get:function(){return this.visibleSublayers.map(function(b){return b.name}).join(",")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(b){this._set("version",b)},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"visibleSublayers",{get:function(){var b=this.layer.sublayers,a=[],c=function(b){b.visible&&(b.sublayers?b.sublayers.forEach(c):a.unshift(b))};b&&b.forEach(c);return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"wkid",{get:function(){var b=this.extent,a=this.layer.spatialReferences,c=b.spatialReference&&b.spatialReference.wkid;a&&-1===a.indexOf(c)&&b.spatialReference.latestWkid&&(c=b.spatialReference.latestWkid);b=q.some(function(a){return a===
c});if(!a)return c;if(b){var d=[];a.forEach(function(a){-1<q.indexOf(a)&&d.push(a)});d.length||a.forEach(function(a){-1<r.indexOf(a)&&d.push(a)});c=0<d.length?d[0]:q[0]}return c},enumerable:!0,configurable:!0});h.prototype.toJSON=function(){var b=this.layer,a=this.extent,c=this.wkid;b.spatialReferences&&-1===b.spatialReferences.indexOf(c)&&a.spatialReference.latestWkid&&(c=a.spatialReference.latestWkid);a={bbox:"1.3.0"===b.version&&p.coordsReversed(c)?a.ymin+","+a.xmin+","+a.ymax+","+a.xmax:a.xmin+
","+a.ymin+","+a.xmax+","+a.ymax,format:b.imageFormat,request:"GetMap",service:"WMS",styles:"",transparent:b.imageTransparency,version:b.version};isNaN(c)||("1.3.0"===b.version?a.crs="EPSG:"+c:a.srs="EPSG:"+c);d.mixin(a,{layers:this.layers});return a};e([b.property()],h.prototype,"extent",void 0);e([b.property()],h.prototype,"layer",null);e([b.property({readOnly:!0,dependsOn:["visibleSublayers"]})],h.prototype,"layers",null);e([b.property({dependsOn:["layers","layer.imageTransparency"]})],h.prototype,
"version",null);e([b.property({readOnly:!0,dependsOn:["layer.sublayers"]})],h.prototype,"visibleSublayers",null);e([b.property()],h.prototype,"wkid",null);return h=e([b.subclass("esri.layers.support.ExportWMSImageParameters")],h)}(b.declared(l))})},"esri/layers/MapImageLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/accessorSupport/decorators dojo/_base/lang dojo/io-query ../core/Error ../core/promiseUtils ../geometry/Extent ../config ../request ./DynamicLayer ./mixins/ScaleRangeLayer ./mixins/ArcGISDynamicMapService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer".split(" "),
function(y,n,g,e,b,d,l,u,p,t,q,r,x,h,v,a,c,m,f){return function(a){function c(c,b){c=a.call(this)||this;c.alwaysRefetch=!1;c.legendEnabled=!0;c.operationalLayerType="ArcGISMapServiceLayer";c.type="map-image";return c}g(c,a);c.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?l.mixin({url:a},c):a};c.prototype.load=function(){var a=this;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]}).then(function(){return a._fetchService()}));return this};c.prototype.readLegendEnabled=
function(a,c){return null!=c.showLegend?c.showLegend:!0};c.prototype.writeLegendEnabled=function(a,c){c.showLegend=!!a};c.prototype.getImageUrl=function(a,c,b,d){var e=this,f=this.parsedUrl.path+"/export";a=l.mixin({},this.parsedUrl.query,this.createExportImageParameters(a,c,b,d),{f:"image",token:this.token,_ts:this.alwaysRefetch?(new Date).getTime():null});if(null!=a.dynamicLayers&&-1===this.capabilities.indexOf("DynamicLayers"))return t.reject(new p("mapimagelayer:dynamiclayer-not-supported","service "+
this.url+" doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.",{query:a}));c=f+"?"+u.objectToQuery(a);return c.length>r.request.maxUrlLength?(a.f="json",x(f,{query:a,responseType:"json",callbackParamName:"callback"}).then(function(a){return a.data.href+(e.token?"?token\x3d"+e.token:"")})):c};c.prototype._fetchService=function(){var a=this;return t.resolve().then(function(){return a.resourceInfo?{ssl:!1,data:a.resourceInfo}:x(a.parsedUrl.path,
{query:l.mixin({f:"json"},a.parsedUrl.query),responseType:"json",callbackParamName:"callback"})}).then(function(c){c.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.read(c.data,{origin:"service",url:a.parsedUrl})})};e([d.property()],c.prototype,"alwaysRefetch",void 0);e([d.property({type:Boolean})],c.prototype,"legendEnabled",void 0);e([d.reader("legendEnabled",["showLegend"])],c.prototype,"readLegendEnabled",null);e([d.writer("legendEnabled")],c.prototype,"writeLegendEnabled",null);e([d.property()],
c.prototype,"operationalLayerType",void 0);e([d.property({json:{read:!1},readOnly:!0,value:"map-image"})],c.prototype,"type",void 0);e([b(0,d.cast(q))],c.prototype,"getImageUrl",null);return c=e([d.subclass("esri.layers.MapImageLayer")],c)}(d.declared(h,a,c,m,f,v))})},"esri/layers/DynamicLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/accessorSupport/decorators ../core/promiseUtils ../core/Error ./Layer".split(" "),
function(y,n,g,e,b,d,l,u,p){return function(p){function q(){return null!==p&&p.apply(this,arguments)||this}g(q,p);q.prototype.getImageUrl=function(b,d,e,g){throw new u("dynamiclayer:getImageUrl-not-implemented","getImageUrl() is not implemented");};q.prototype.fetchImage=function(d,e,h,g){d=this.getImageUrl(d,e,h,g);var a={responseType:"image",allowImageDataAccess:g&&g.allowImageDataAccess||!1},c;"string"===typeof d?(c=d,g=b(d,a)):g=d.then(function(d){c=d;return b(c,a)});return g.then(function(a){return a.data}).otherwise(function(a){return a&&
"cancel"===a.dojoType?l.reject(a):c?l.reject(new u("dynamiclayer:image-fetch-error","Unable to load image: "+c,{error:a})):l.reject(new u("dynamiclayer:getImageUrl-error","Unable to create image url",{error:a}))})};e([d.shared({"2d":"../views/2d/layers/MapImageLayerView2D","3d":"../views/3d/layers/MapImageLayerView3D"})],q.prototype,"viewModulePaths",void 0);return q=e([d.subclass("esri.layers.DynamicLayer")],q)}(d.declared(p))})},"esri/layers/mixins/ArcGISDynamicMapService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/_base/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/PropertyOrigin ./ArcGISMapService ../support/Sublayer ../support/sublayerUtils ../../core/Collection ../../core/CollectionFlattener ../support/ExportImageParameters ../../geometry/support/scaleUtils".split(" "),
function(y,n,g,e,b,d,l,u,p,t,q,r,x,h){function v(a,b,d){var c=[],e={};a.forEach(function(a){var f=new p;f.read(a,b);d&&(-1===d.indexOf(f.id)?f.visible=!1:f.visible=!0);e[f.id]=f;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=e[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(f)):c.unshift(f)});return c}function a(c,d){var e=d.get(c.id);e?(b.mixin(c.__accessor__.store._values,e.__accessor__.store._values),e.sublayers&&(c.sublayers=e.sublayers.map(function(c){return a(c,d)}))):c.sublayers&&
c.sublayers.forEach(function(c){return a(c,d)});return c}return function(c){function m(){var a=c.call(this)||this;a.allSublayers=new r({root:a,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});a.dpi=96;a.gdbVersion=null;a.imageFormat="png24";a.imageMaxHeight=2048;a.imageMaxWidth=2048;a.imageTransparency=!0;a.loaded=!1;a.sublayers=null;a.watch("sublayers",function(c,b){b&&(b.forEach(function(a){a.parent=null;a.layer=null}),a._sublayersHandles.forEach(function(a){return a.remove()}),
a._sublayersHandles=null);c&&(c.forEach(function(c){c.parent=a;c.layer=a}),a._sublayersHandles=[c.on("after-add",function(c){c=c.item;c.parent=a;c.layer=a}),c.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})])},!0);return a}g(m,c);m.prototype.readCapabilities=function(a,c){a=(a=a&&a.split(",").map(function(a){return a.trim()}))||[];c.supportsDynamicLayers&&a.push("DynamicLayers");c.tileInfo&&!c.supportsDynamicLayers||a.push("supportsSublayerVisibility","supportsSublayerDefinitionExpression");
return a};m.prototype.readImageFormat=function(a,c){return(a=c.supportedImageFormatTypes)&&-1<a.indexOf("PNG32")?"png32":"png24"};m.prototype.readServiceSublayers=function(a,c,b){return v(c.layers,b)};m.prototype.readSublayersFromItemOrWebMap=function(a,c,b){return!c.layers&&c.visibleLayers?c.visibleLayers.map(function(a){return{id:a}}):v(c.layers,b,c.visibleLayers)};m.prototype.readSublayers=function(a,c,b){a=v(c.layers,b);this._updateSublayersForOrigin(l.OriginId.PORTAL_ITEM,a);this._updateSublayersForOrigin(l.OriginId.WEB_MAP,
a);this._updateSublayersForOrigin(l.OriginId.WEB_SCENE,a);return a};m.prototype.writeSublayers=function(a,c,d,e){a=a.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reverse();var h=this.serviceSublayers.flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray().reduce(function(a,c){a.set(c.id,c);return a},new Map),f=!1,k=!0;this.capabilities&&-1!==this.capabilities.indexOf("DynamicLayers")?(f=t.isExportDynamic(a,this.serviceSublayers,this),k=!f&&t.sameStructureAsService(a,
this.serviceSublayers)):k=t.sameStructureAsService(a,this.serviceSublayers);c.layers=[];a.forEach(function(a){var d=h.get(a.id),d=b.mixin({writeAsDynamic:f,writeOverridesOnly:k,serviceSublayer:d},e);a=a.write({},d);(!k||k&&1<Object.keys(a).length)&&c.layers.push(a)});c.visibleLayers=a.filter(function(a){return a.visible}).map(function(a){return a.id})};m.prototype.findSublayerById=function(a){return this.allSublayers.find(function(c){return c.id===a})};m.prototype.createServiceSublayers=function(){return this.serviceSublayers.map(function(a){return a.clone()})};
m.prototype.createExportImageParameters=function(a,c,d,e){a&&10<=this.version&&(a=a.clone().shiftCentralMeridian());var f=new x({layer:this,scale:h.getScale({extent:a,width:c})}),m=f.toJSON();f.layer=null;f.destroy();var f=!e||!e.rotation||10.3>this.version?{}:{rotation:-e.rotation},k=a&&a.spatialReference,k=k.wkid||JSON.stringify(k.toJSON());e&&null!=e.pixelRatio&&(m.dpi*=e.pixelRatio);return b.mixin({bbox:a&&a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,bboxSR:k,imageSR:k,size:c+","+d},m,f)};m.prototype._updateSublayersForOrigin=
function(c,b){var d=this.__accessor__.store;if(d.has("sublayers",c)){var e=d.get("sublayers",c).flatten(function(a){return a.sublayers});if(e.every(function(a){return!a.__accessor__.store._values.hasOwnProperty("minScale")})){var h=e.reduce(function(a,c){a.set(c.id,c);return a},new Map);b=b.map(function(c){return a(c.clone(),h)});d.set("sublayers",new (q.ofType(p))(b),c)}}};e([d.property({readOnly:!0})],m.prototype,"allSublayers",void 0);e([d.property({readOnly:!0})],m.prototype,"capabilities",void 0);
e([d.reader("service","capabilities",["supportsDynamicLayers","tileInfo"])],m.prototype,"readCapabilities",null);e([d.property()],m.prototype,"dpi",void 0);e([d.property()],m.prototype,"gdbVersion",void 0);e([d.property()],m.prototype,"imageFormat",void 0);e([d.reader("imageFormat",["supportedImageFormatTypes"])],m.prototype,"readImageFormat",null);e([d.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],m.prototype,"imageMaxHeight",void 0);e([d.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],
m.prototype,"imageMaxWidth",void 0);e([d.property()],m.prototype,"imageTransparency",void 0);e([d.property()],m.prototype,"loaded",void 0);e([d.property({readOnly:!0,type:q.ofType(p)})],m.prototype,"serviceSublayers",void 0);e([d.reader("service","serviceSublayers",["layers"])],m.prototype,"readServiceSublayers",null);e([d.property({type:q.ofType(p)})],m.prototype,"sublayers",void 0);e([d.reader(["web-map","web-scene","portal-item"],"sublayers",["layers","visibleLayers"])],m.prototype,"readSublayersFromItemOrWebMap",
null);e([d.reader("service","sublayers",["layers"])],m.prototype,"readSublayers",null);e([d.writer(["web-map","web-scene","portal-item"],"sublayers")],m.prototype,"writeSublayers",null);return m=e([d.subclass("esri.layers.mixins.ArcGISDynamicMapService")],m)}(d.declared(u))})},"esri/layers/support/Sublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators dojo/io-query ../../core/Collection ../../core/JSONSupport ../../core/Logger ../../core/lang ../../core/accessorSupport/ensureType ../../core/accessorSupport/write ../../symbols/Symbol3D ../../renderers/support/jsonUtils ../../renderers/support/typeUtils ../../tasks/QueryTask ../../tasks/support/Query ../../PopupTemplate ./LabelClass ./layerSourceUtils".split(" "),
function(y,n,g,e,b,d,l,u,p,t,q,r,x,h,v,a,c,m,f,B,C){var w=t.getLogger("esri.layers.support.Sublayer"),E=0;return function(p){function k(){var a=null!==p&&p.apply(this,arguments)||this;a._sublayersHandles=null;return a}g(k,p);t=k;Object.defineProperty(k.prototype,"definitionExpression",{get:function(){return this._get("definitionExpression")},set:function(a){this._setAndNotifyLayer("definitionExpression",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"id",{get:function(){var a=
this._get("id");return null==a?E++:a},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"labelingInfo",{get:function(){return this._get("labelingInfo")},set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!0,configurable:!0});k.prototype.writeLabelingInfo=function(a,c,b,d){(!d||d.writeAsDynamic)&&a&&a.length&&(c.layerDefinition={drawingInfo:{labelingInfo:a.map(function(a){return a.write({},d)})}})};Object.defineProperty(k.prototype,
"labelsVisible",{get:function(){return this._get("labelsVisible")},set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!0,configurable:!0});k.prototype.writeLabelsVisible=function(a,c,b,d){if(!d||d.writeAsDynamic)c.showLabels=a};Object.defineProperty(k.prototype,"legendEnabled",{get:function(){return this._get("legendEnabled")},set:function(a){this._set("legendEnabled",a)},enumerable:!0,configurable:!0});k.prototype.writeLegendEnabled=function(a,c,b,d){c.showLegend=!!a};Object.defineProperty(k.prototype,
"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(c){return c.layer=a})},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"minScale",{get:function(){return this._get("minScale")},set:function(a){this._set("minScale",a)},enumerable:!0,configurable:!0});k.prototype.readMinScale=function(a,c){return c.minScale||c.layerDefinition&&c.layerDefinition.minScale||0};k.prototype.writeMinScale=function(a,c,b,d){if(d&&d.writeOverridesOnly&&(b=d&&d.serviceSublayer)&&
b.minScale===a&&b.maxScale===this.maxScale)return;c.minScale=a};Object.defineProperty(k.prototype,"maxScale",{get:function(){return this._get("maxScale")},set:function(a){this._set("maxScale",a)},enumerable:!0,configurable:!0});k.prototype.readMaxScale=function(a,c){return c.maxScale||c.layerDefinition&&c.layerDefinition.maxScale||0};k.prototype.writeMaxScale=function(a,c,b,d){if(d&&d.writeOverridesOnly&&(b=d&&d.serviceSublayer)&&b.maxScale===a&&b.minScale===this.minScale)return;c.maxScale=a};Object.defineProperty(k.prototype,
"opacity",{get:function(){return this._get("opacity")},set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!0,configurable:!0});k.prototype.readOpacity=function(a,c){a=c.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};k.prototype.writeOpacity=function(a,c,b,d){if(!d||d.writeAsDynamic)c.layerDefinition={drawingInfo:{transparency:100-100*a}}};k.prototype.writeParent=function(a,c,b,d){d&&d.writeOverridesOnly||(c.parentLayerId=this.parent&&this.parent!==
this.layer?this.parent.id:-1)};Object.defineProperty(k.prototype,"popupTemplate",{get:function(){return this._get("popupTemplate")},set:function(a){this._set("popupTemplate",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderer",{get:function(){return this._get("renderer")},set:function(a){if(a)for(var c=0,b=a.getSymbols();c<b.length;c++)if(b[c].isInstanceOf(h)){w.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)},enumerable:!0,configurable:!0});
k.prototype.readRenderer=function(a,c,b){if(a=c.layerDefinition.drawingInfo.renderer||void 0)(a=v.read(a,c,b)||void 0)||w.error("Failed to create renderer",{rendererDefinition:c.drawingInfo.renderer,layer:this,context:b});return a};k.prototype.writeRenderer=function(a,c,b,d){if(!d||d.writeAsDynamic)c.layerDefinition={drawingInfo:{renderer:a.toJSON()}}};Object.defineProperty(k.prototype,"source",{get:function(){return this._get("source")||{mapLayerId:this.id,type:C.MAPLAYER}},set:function(a){this._setAndNotifyLayer("source",
a)},enumerable:!0,configurable:!0});k.prototype.writeSource=function(a,c,b,d){d&&!d.writeAsDynamic&&d.writeOverridesOnly||(c.layerDefinition={source:C.sourceToJSON(a)})};Object.defineProperty(k.prototype,"sublayers",{set:function(a){var c=this,b=this._get("sublayers");b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this._sublayersHandles.forEach(function(a){return a.remove()}),this._sublayersHandles=null);a&&(a.forEach(function(a){a.parent=c;a.layer=c.layer}),this._sublayersHandles=[a.on("after-add",
function(a){a=a.item;a.parent=c;a.layer=c.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})]);this._set("sublayers",a)},enumerable:!0,configurable:!0});k.prototype.castSublayers=function(a){return r.default(u.ofType(t),a)};k.prototype.writeSublayers=function(a,c,b,d){d&&d.writeOverridesOnly||(c.subLayerIds=this.get("sublayers.length")?this.sublayers.map(function(a){return a.id}).toArray().reverse():null)};Object.defineProperty(k.prototype,"title",{get:function(){return this._get("title")},
set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});k.prototype.writeTitle=function(a,c,b,d){if(d&&d.writeOverridesOnly&&(b=d&&d.serviceSublayer)&&b.title===a)return;c.name=a};Object.defineProperty(k.prototype,"url",{get:function(){var a=this.layer,c=this.source;if(!a)return null;if(C.isMapLayerSource(c))return a.parsedUrl.path+"/"+c.mapLayerId;c={layer:JSON.stringify({source:C.sourceToJSON(this.source)})};return a.parsedUrl.path+"/dynamicLayer?"+l.objectToQuery(c)},enumerable:!0,
configurable:!0});Object.defineProperty(k.prototype,"visible",{get:function(){return this._get("visible")},set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!0,configurable:!0});k.prototype.writeVisible=function(a,c,b,d){if(d&&d.writeOverridesOnly&&(b=d&&d.serviceSublayer)&&b.visible===a)return;c.defaultVisibility=a};k.prototype.clone=function(){var a=new t;this.hasOwnProperty("definitionExpression")&&(a.definitionExpression=this.definitionExpression);this.hasOwnProperty("id")&&(a.id=
this.id);this.hasOwnProperty("labelingInfo")&&(a.labelingInfo=q.clone(this.labelingInfo));this.hasOwnProperty("labelsVisible")&&(a.labelsVisible=this.labelsVisible);this.hasOwnProperty("legendEnabled")&&(a.legendEnabled=this.legendEnabled);this.hasOwnProperty("visible")&&(a.visible=this.visible);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("minScale")&&(a.minScale=this.minScale);this.hasOwnProperty("maxScale")&&(a.maxScale=this.maxScale);this.hasOwnProperty("opacity")&&(a.opacity=
this.opacity);this.hasOwnProperty("parent")&&(a.parent=this.parent);this.hasOwnProperty("popupTemplate")&&(a.popupTemplate=this.popupTemplate.clone());this.hasOwnProperty("renderer")&&(a.renderer=this.renderer.clone());this.hasOwnProperty("source")&&(a.source=q.clone(this.source));this.hasOwnProperty("sublayers")&&(a.sublayers=this.sublayers.clone());this.hasOwnProperty("title")&&(a.title=this.title);return a};k.prototype.createQuery=function(){return new m({returnGeometry:!0,where:this.definitionExpression||
"1\x3d1"})};k.prototype.queryFeatures=function(a){var b=this;void 0===a&&(a=this.createQuery());return(new c({url:this.url})).execute(a).then(function(a){a&&a.features&&a.features.forEach(function(a){a.popupTemplate=b.popupTemplate});return a})};k.prototype.toExportImageJSON=function(){var a={id:this.id,source:C.sourceToJSON(this.source)};this.definitionExpression&&(a.definitionExpression=this.definitionExpression);if(this.renderer||this.labelingInfo||null!=this.opacity||null!=this.labelsVisible){var c=
a.drawingInfo={};this.renderer&&(c.renderer=this.renderer.toJSON());null!=this.labelsVisible&&(c.showLabels=this.labelsVisible);!1!==this.labelsVisible&&this.labelingInfo&&(c.labelingInfo=this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}));null!=this.opacity&&(c.transparency=100-100*this.opacity)}return a};k.prototype._setAndNotifyLayer=function(a,c){var b=this.layer;this._get(a)!==c&&(this._set(a,c),b&&b.emit("sublayer-update",{propertyName:a}))};e([d.property({value:null,
json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],k.prototype,"definitionExpression",null);e([d.property({json:{write:{ignoreOrigin:!0}}})],k.prototype,"id",null);e([d.property({value:null,type:[B],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"}}})],k.prototype,"labelingInfo",null);e([d.writer("labelingInfo")],k.prototype,"writeLabelingInfo",null);e([d.property({json:{read:{source:"showLabels"}}})],k.prototype,"labelsVisible",
null);e([d.writer("labelsVisible")],k.prototype,"writeLabelsVisible",null);e([d.property({value:!0,type:Boolean,json:{read:{source:"showLegend"}}})],k.prototype,"legendEnabled",null);e([d.writer("showLegend")],k.prototype,"writeLegendEnabled",null);e([d.property({value:null})],k.prototype,"layer",null);e([d.property({value:0,json:{write:{overridePolicy:function(a,c,b){if(x.willPropertyWrite(this,"maxScale",{},b))return{ignoreOrigin:!0}}}}})],k.prototype,"minScale",null);e([d.reader("portal-item",
"minScale",["minScale","layerDefinition.minScale"])],k.prototype,"readMinScale",null);e([d.writer("minScale")],k.prototype,"writeMinScale",null);e([d.property({value:0,json:{write:{overridePolicy:function(a,c,b){if(x.willPropertyWrite(this,"minScale",{},b))return{ignoreOrigin:!0}}}}})],k.prototype,"maxScale",null);e([d.reader("portal-item","maxScale",["maxScale","layerDefinition.maxScale"])],k.prototype,"readMaxScale",null);e([d.writer("maxScale")],k.prototype,"writeMaxScale",null);e([d.property()],
k.prototype,"opacity",null);e([d.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],k.prototype,"readOpacity",null);e([d.writer("opacity")],k.prototype,"writeOpacity",null);e([d.property({json:{write:{allowNull:!0}}})],k.prototype,"parent",void 0);e([d.writer("parent")],k.prototype,"writeParent",null);e([d.property({value:null,type:f,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],k.prototype,"popupTemplate",null);e([d.property({types:a.types,
value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],k.prototype,"renderer",null);e([d.reader("renderer",["layerDefinition.drawingInfo.renderer"])],k.prototype,"readRenderer",null);e([d.writer("renderer")],k.prototype,"writeRenderer",null);e([d.property({cast:C.castSource,json:{read:{source:"layerDefinition.source",reader:C.sourceFromJSON}}})],k.prototype,"source",null);e([d.writer("source")],k.prototype,"writeSource",null);e([d.property({value:null,json:{write:{allowNull:!0}}})],
k.prototype,"sublayers",null);e([d.cast("sublayers")],k.prototype,"castSublayers",null);e([d.writer("sublayers")],k.prototype,"writeSublayers",null);e([d.property({value:null,json:{read:{source:"name"},write:{allowNull:!0,ignoreOrigin:!0}}})],k.prototype,"title",null);e([d.writer("title")],k.prototype,"writeTitle",null);e([d.property({readOnly:!0,dependsOn:["layer","source"]})],k.prototype,"url",null);e([d.property({value:!0,json:{read:{source:"defaultVisibility"}}})],k.prototype,"visible",null);
e([d.writer("visible")],k.prototype,"writeVisible",null);e([b(0,d.cast(m))],k.prototype,"queryFeatures",null);return k=t=e([d.subclass("esri.layers.support.Sublayer")],k);var t}(d.declared(p))})},"esri/layers/support/layerSourceUtils":function(){define(["require","exports","../../core/lang","../../core/kebabDictionary"],function(y,n,g,e){function b(b){return null!=b&&b.hasOwnProperty("mapLayerId")}function d(b){return null!=b&&b.hasOwnProperty("dataSource")}function l(e){if(!e)return e;b(e)&&(e.type=
n.MAPLAYER);if(d(e)&&(e.type=n.DATALAYER,!e.dataSource.type)){var h=e.dataSource;h.workspaceId?h.type=h.gdbVersion?"table":h.query||h.oidFields?"query-table":"raster":h.leftTableKey&&h.rightTableKey&&h.leftTableSource&&h.rightTableSource&&(h.type="join-table",h.leftTableSource=l(h.leftTableSource),h.rightTableSource=l(h.rightTableSource))}return e}function u(b){var d={};if(b.type===n.MAPLAYER)d.mapLayerId=b.mapLayerId,b.gdbVersion&&(d.gdbVersion=b.gdbVersion);else if(b.type===n.DATALAYER){b.fields&&
(d.fields=b.fields);var a;a=b.dataSource;var c;switch(a.type){case "table":c={dataSourceName:a.dataSourceName,workspaceId:a.workspaceId,gdbVersion:a.gdbVersion};break;case "query-table":c={geometryType:t.toJSON(a.geometryType),workspaceId:a.workspaceId,query:a.query,oidFields:a.oidFields,spatialReference:a.spatialReference};break;case "join-table":c={leftTableSource:u(a.leftTableSource),rightTableSource:u(a.rightTableSource),leftTableKey:a.leftTableKey,rightTableKey:a.rightTableKey,joinType:x.toJSON(a.joinType)};
break;case "raster":c={workspaceId:a.workspaceId,dataSourceName:a.dataSourceName}}c.type=r.toJSON(a.type);a=g.fixJson(c);d.dataSource=a}d.type=q.toJSON(b.type);return g.fixJson(d)}function p(b){var d={};if(q.fromJSON(b.type)===n.MAPLAYER)d.mapLayerId=b.mapLayerId,b.gdbVersion&&(d.gdbVersion=b.gdbVersion);else if(q.fromJSON(b.type)===n.DATALAYER){b.fields&&(d.fields=b.fields);var a;a=b.dataSource;var c;switch(a.type){case "table":c={dataSourceName:a.dataSourceName,workspaceId:a.workspaceId,gdbVersion:a.gdbVersion};
break;case "queryTable":c={geometryType:t.fromJSON(a.geometryType),workspaceId:a.workspaceId,query:a.query,oidFields:a.oidFields,spatialReference:a.spatialReference};break;case "joinTable":c={leftTableSource:p(a.leftTableSource),rightTableSource:p(a.rightTableSource),leftTableKey:a.leftTableKey,rightTableKey:a.rightTableKey,joinType:x.fromJSON(a.joinType)};break;case "raster":c={workspaceId:a.workspaceId,dataSourceName:a.dataSourceName}}c.type=r.fromJSON(a.type);a=g.fixJson(c);d.dataSource=a}d.type=
q.fromJSON(b.type);return g.fixJson(d)}Object.defineProperty(n,"__esModule",{value:!0});n.MAPLAYER="map-layer";n.DATALAYER="data-layer";var t=e({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),q=e({mapLayer:n.MAPLAYER,dataLayer:n.DATALAYER}),r=e({joinTable:"join-table",queryTable:"query-table"}),x=e({esriLeftOuterJoin:"left-outer-join",esriLeftInnerJoin:"left-inner-join"});n.isMapLayerSource=
b;n.isDataLayerSource=d;n.castSource=l;n.sourceToJSON=u;n.sourceFromJSON=p})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(y,n,g){function e(b,d){function e(b){var d=b.sublayers;g.unshift(b.id);d&&d.forEach(e)}if(!b||!b.length)return!0;var g=[];d.forEach(e);if(b.length>g.length)return!1;d=0;for(var p=g.length,t=0;t<b.length;t++){for(var q=b[t].id;d<p&&g[d]!==q;)d++;if(d>=p)return!1}return!0}Object.defineProperty(n,"__esModule",{value:!0});
n.isExportDynamic=function(b,d,l){return b.some(function(b){var d=b.source;return!(!d||d.type===g.MAPLAYER&&d.mapLayerId===b.id&&(!d.gdbVersion||d.gdbVersion===l.gdbVersion))||null!=b.renderer||null!=b.labelingInfo||b.hasOwnProperty("opacity")&&null!=b.opacity||b.hasOwnProperty("labelsVisible")&&null!=b.labelsVisible})?!0:!e(b,d)};n.sameStructureAsService=function(b,d){return d.flatten(function(b){return(b=b.sublayers)&&b.toArray().reverse()}).toArray().reverse().every(function(d,e){return(e=b[e])&&
d.id===e.id&&(null==d.sublayers&&null==e.sublayers||null!=d.sublayers&&null!=e.sublayers&&d.sublayers.map(function(b){return b.id}).join(",")===e.sublayers.map(function(b){return b.id}).join(","))})}})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators dojo/_base/lang ../../core/Accessor ./sublayerUtils".split(" "),function(y,n,g,e,b,d,l,u){var p={visible:"visibleSublayers",
definitionExpression:"layerDefs",labelsVisible:"hasDynamicLayers",labelingInfo:"hasDynamicLayers",opacity:"hasDynamicLayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};return function(l){function q(){var b=null!==l&&l.apply(this,arguments)||this;b.scale=0;return b}g(q,l);Object.defineProperty(q.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var b=this.visibleSublayers.map(function(b){return b.toExportImageJSON()});return b.length?JSON.stringify(b):null},
enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"hasDynamicLayers",{get:function(){return u.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"layer",{set:function(b){var d=this;this._get("layer")!==b&&(this._set("layer",b),this._layerHandles&&(this._layerHandles.forEach(function(b){return b.remove()}),this._layerHandles.length=0),b&&(this._layerHandles=[b.allSublayers.on("change",function(){return d.notifyChange("visibleSublayers")}),
b.on("sublayer-update",function(b){return d.notifyChange(p[b.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"layers",{get:function(){var b=this.visibleSublayers;return b?b.length?"show:"+b.map(function(b){return b.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"layerDefs",{get:function(){var b=this.visibleSublayers.filter(function(b){return null!=b.definitionExpression});return b.length?JSON.stringify(b.reduce(function(b,
d){b[d.id]=d.definitionExpression;return b},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(b){this._set("version",b)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"visibleSublayers",{get:function(){var b=this,d=this.layer.sublayers,e=[],g=function(a){var c=b.scale,d=0===a.minScale||c<=a.minScale,h=0===a.maxScale||c>=a.maxScale;a.visible&&(0===c||d&&h)&&(a.sublayers?a.sublayers.forEach(g):
e.unshift(a))};d&&d.forEach(g);return e},enumerable:!0,configurable:!0});q.prototype.toJSON=function(){var b=this.layer,b={dpi:b.dpi,format:b.imageFormat,transparent:b.imageTransparency,gdbVersion:b.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?b.dynamicLayers=this.dynamicLayers:d.mixin(b,{layers:this.layers,layerDefs:this.layerDefs});return b};e([b.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],q.prototype,"dynamicLayers",null);e([b.property({readOnly:!0,
dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],q.prototype,"hasDynamicLayers",null);e([b.property()],q.prototype,"layer",null);e([b.property({readOnly:!0,dependsOn:["visibleSublayers"]})],q.prototype,"layers",null);e([b.property({readOnly:!0,dependsOn:["visibleSublayers"]})],q.prototype,"layerDefs",null);e([b.property({type:Number})],q.prototype,"scale",void 0);e([b.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],
q.prototype,"version",null);e([b.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],q.prototype,"visibleSublayers",null);return q=e([b.subclass("esri.layers.mixins.ExportImageParameters")],q)}(b.declared(l))})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/_base/lang ../core/lang ../core/accessorSupport/ensureType ../Color ./PointCloudRenderer".split(" "),
function(y,n,g,e,b,d,l,u,p,t){return function(q){function r(b){b=q.call(this)||this;b.type="point-cloud-class-breaks";b.field=null;b.fieldTransformType=null;b.colorClassBreakInfos=null;return b}g(r,q);x=r;r.prototype.writeType=function(b,d,a,c){d.type="pointCloudClassBreaksRenderer"};r.prototype.readColorClassBreakInfos=function(b,d,a){if(!Array.isArray(b))return null;d=[];for(a=0;a<b.length;a++){var c=b[a];c&&"object"===typeof c&&d.push({minValue:c.classMinValue,maxValue:c.classMaxValue,label:c.label,
description:c.description,color:p.fromJSON(c.color)})}return d};r.prototype.castColorClassBreakInfos=function(b,d,a){if(!Array.isArray(b))return null;d=[];for(a=0;a<b.length;a++){var c=b[a];c&&"object"===typeof c&&d.push({minValue:u.ensureNumber(c.minValue)||0,maxValue:u.ensureNumber(c.maxValue)||0,label:u.ensureString(c.label),description:u.ensureString(c.description),color:u.ensureType(p,c.color)})}return d};r.prototype.writeColorClassBreakInfos=function(b,d,a,c){this.colorClassBreakInfos&&(d.colorClassBreakInfos=
this.colorClassBreakInfos.map(function(a){return{classMinValue:a.minValue,classMaxValue:a.maxValue,color:a.color&&a.color.toJSON(),label:a.label,description:a.description}}))};r.prototype.clone=function(){return new x(d.mixin(this.cloneProperties(),{field:l.clone(this.field),fieldTransformType:l.clone(this.fieldTransformType),colorClassBreakInfos:l.clone(this.colorClassBreakInfos)}))};e([b.property()],r.prototype,"type",void 0);e([b.writer("type")],r.prototype,"writeType",null);e([b.property({json:{write:!0},
type:String})],r.prototype,"field",void 0);e([b.property({json:{read:t.fieldTransformTypeKebabDict.read,write:t.fieldTransformTypeKebabDict.write},type:String})],r.prototype,"fieldTransformType",void 0);e([b.property({json:{write:!0}})],r.prototype,"colorClassBreakInfos",void 0);e([b.reader("colorClassBreakInfos")],r.prototype,"readColorClassBreakInfos",null);e([b.cast("colorClassBreakInfos")],r.prototype,"castColorClassBreakInfos",null);e([b.writer("colorClassBreakInfos")],r.prototype,"writeColorClassBreakInfos",
null);return r=x=e([b.subclass("esri.renderers.PointCloudClassBreaksRenderer")],r);var x}(b.declared(t))})},"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/lang ../core/accessorSupport/decorators".split(" "),function(y,n,g,e,b,d,l,u){y=function(b){function d(d){d=b.call(this)||this;d.pointSizeAlgorithm=null;d.colorModulation=null;d.pointsPerInch=10;return d}
g(d,b);d.prototype.readPointSizeAlgorithm=function(b,d,e){return null==b||"object"!==typeof b?null:"pointCloudFixedSizeAlgorithm"===b.type?{type:"fixed-size",useRealWorldSymbolSizes:!!b.useRealWorldSymbolSizes,size:null!=b.size?parseFloat(b.size):0}:"pointCloudSplatAlgorithm"===b.type?{type:"splat",scaleFactor:null!=b.scaleFactor?parseFloat(b.scaleFactor):1,minSize:null!=b.minSize?parseFloat(b.minSize):null}:null};d.prototype.writePointSizeAlgorithm=function(b,d,e,h){b&&"fixed-size"===b.type?(d.pointSizeAlgorithm=
{type:"pointCloudFixedSizeAlgorithm",size:null!=b.size?b.size:0},null!=b.useRealWorldSymbolSizes&&(d.pointSizeAlgorithm.useRealWorldSymbolSizes=b.useRealWorldSymbolSizes)):b&&"splat"===b.type&&(d.pointSizeAlgorithm={type:"pointCloudSplatAlgorithm",scaleFactor:null!=b.scaleFactor?b.scaleFactor:1},null!=b.minSize&&(d.pointSizeAlgorithm.minSize=b.minSize))};d.prototype.readColorModulation=function(b,d,e){return null==b||"object"!==typeof b?null:{field:String(b.field),minValue:null!=b.minValue?parseFloat(b.minValue):
0,maxValue:null!=b.maxValue?parseFloat(b.maxValue):255}};d.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};d.prototype.cloneProperties=function(){return{pointSizeAlgorithm:l.clone(this.pointSizeAlgorithm),colorModulation:l.clone(this.colorModulation),pointsPerInch:l.clone(this.pointsPerInch)}};e([u.property({readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],d.prototype,"type",void 0);e([u.property({json:{write:!0}})],d.prototype,"pointSizeAlgorithm",
void 0);e([u.reader("pointSizeAlgorithm")],d.prototype,"readPointSizeAlgorithm",null);e([u.writer("pointSizeAlgorithm")],d.prototype,"writePointSizeAlgorithm",null);e([u.property({json:{write:!0}})],d.prototype,"colorModulation",void 0);e([u.reader("colorModulation")],d.prototype,"readColorModulation",null);e([u.property({json:{write:!0},type:Number})],d.prototype,"pointsPerInch",void 0);return d=e([u.subclass("esri.renderers.PointCloudRenderer")],d)}(u.declared(b));(function(b){b.pointSizeKebabDict=
d({pointCloudSplatAlgorithm:"fixed-size",pointCloudFixedSizeAlgorithm:"splat"});b.fieldTransformTypeKebabDict=d({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});b.defaultMinSize=1.1})(y||(y={}));return y})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/_base/lang ../core/lang ../core/accessorSupport/ensureType ./PointCloudRenderer ../Color".split(" "),
function(y,n,g,e,b,d,l,u,p,t){return function(q){function r(b){b=q.call(this)||this;b.type="point-cloud-stretch";b.field=null;b.fieldTransformType=null;b.stops=null;return b}g(r,q);x=r;r.prototype.writeType=function(b,d,a,c){d.type="pointCloudStretchRenderer"};r.prototype.readStops=function(b,d,a){if(!Array.isArray(b))return null;d=[];for(a=0;a<b.length;a++){var c=b[a];c&&"object"===typeof c&&d.push({label:c.label,value:c.value,color:t.fromJSON(c.color)})}return d};r.prototype.castStops=function(b,
d,a){if(!Array.isArray(b))return null;d=[];for(a=0;a<b.length;a++){var c=b[a];c&&"object"===typeof c&&d.push({label:u.ensureString(c.label),value:u.ensureNumber(c.value),color:u.ensureType(t,c.color)})}return d};r.prototype.writeStops=function(b,d,a,c){if(this.stops)for(d.stops=[],b=0;b<this.stops.length;b++)a=this.stops[b],d.stops.push({}),d.stops[b].value=a.value,d.stops[b].color=a.color&&a.color.toJSON(),null!=a.label&&(d.stops[b].label=a.label)};r.prototype.clone=function(){return new x(d.mixin(this.cloneProperties(),
{field:l.clone(this.field),fieldTransformType:l.clone(this.fieldTransformType),stops:l.clone(this.stops)}))};e([b.property()],r.prototype,"type",void 0);e([b.writer("type")],r.prototype,"writeType",null);e([b.property({json:{write:!0},type:String})],r.prototype,"field",void 0);e([b.property({json:{read:p.fieldTransformTypeKebabDict.read,write:p.fieldTransformTypeKebabDict.write},type:String})],r.prototype,"fieldTransformType",void 0);e([b.property({json:{write:!0}})],r.prototype,"stops",void 0);e([b.reader("stops")],
r.prototype,"readStops",null);e([b.cast("stops")],r.prototype,"castStops",null);e([b.writer("stops")],r.prototype,"writeStops",null);return r=x=e([b.subclass("esri.renderers.PointCloudStretchRenderer")],r);var x}(b.declared(p))})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/_base/lang ../core/lang ../core/accessorSupport/ensureType ./PointCloudRenderer ../Color".split(" "),
function(y,n,g,e,b,d,l,u,p,t){return function(q){function r(b){b=q.call(this)||this;b.type="point-cloud-unique-value";b.field=null;b.fieldTransformType=null;b.colorUniqueValueInfos=null;return b}g(r,q);x=r;r.prototype.writeType=function(b,d,a,c){d.type="pointCloudUniqueValueRenderer"};r.prototype.readColorUniqueValueInfos=function(b,d,a){if(!Array.isArray(b))return null;d=[];for(a=0;a<b.length;a++){var c=b[a];c&&"object"===typeof c&&d.push({values:c.values,label:c.label,description:c.description,
color:t.fromJSON(c.color)})}return d};r.prototype.castColorUniqueValueInfos=function(b,d,a){if(!Array.isArray(b))return null;d=[];for(a=0;a<b.length;a++){var c=b[a];c&&"object"===typeof c&&d.push({values:Array.isArray(c.values)?c.values.map(function(a){return u.ensureString(a)}):null,label:u.ensureString(c.label),description:u.ensureString(c.description),color:u.ensureType(t,c.color)})}return d};r.prototype.writeColorUniqueValueInfos=function(b,d,a,c){this.colorUniqueValueInfos&&(d.colorUniqueValueInfos=
this.colorUniqueValueInfos.map(function(a){return{values:a.values,color:a.color&&a.color.toJSON(),label:a.label,description:a.description}}))};r.prototype.clone=function(){return new x(d.mixin(this.cloneProperties(),{field:l.clone(this.field),fieldTransformType:l.clone(this.fieldTransformType),colorUniqueValueInfos:l.clone(this.colorUniqueValueInfos)}))};e([b.property()],r.prototype,"type",void 0);e([b.writer("type")],r.prototype,"writeType",null);e([b.property({json:{write:!0},type:String})],r.prototype,
"field",void 0);e([b.property({json:{read:p.fieldTransformTypeKebabDict.read,write:p.fieldTransformTypeKebabDict.write},type:String})],r.prototype,"fieldTransformType",void 0);e([b.property({json:{write:!0}})],r.prototype,"colorUniqueValueInfos",void 0);e([b.reader("colorUniqueValueInfos")],r.prototype,"readColorUniqueValueInfos",null);e([b.cast("colorUniqueValueInfos")],r.prototype,"castColorUniqueValueInfos",null);e([b.writer("colorUniqueValueInfos")],r.prototype,"writeColorUniqueValueInfos",null);
return r=x=e([b.subclass("esri.renderers.PointCloudUniqueValueRenderer")],r);var x}(b.declared(p))})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../Color ./utils ../../../core/numberUtils ../../../symbols/support/gfxUtils".split(" "),function(y,n,g,e,b,d){function l(b,d){var e=d-b;d=[0,.25,.5,.75,1].map(function(a){return Number((b+a*e).toFixed(6))});u(0,4,d);return d}function u(b,d,e){var a=b+(d-b)/2,c=e[0],h=e[1],f=e[2],g=Math.floor(c),l=Math.floor(h),
w=Math.floor(f);g===c&&w===f&&l!==h&&g!==l&&w!==l&&(e[a]=l);b+1!==a&&u(b,a,e);a+1!==d&&u(a,d,e)}function p(b,d){b=t(b,d);var e=b.startIndex,a=b.endIndex;if(e===a)return d[e].color;d=g.blendColors(d[e].color,d[a].color,b.weight);return new g(d)}function t(b,d){var e=0,a=d.length-1;d.some(function(c,d){if(b<c.value)return a=d,!0;e=d;return!1});return{startIndex:e,endIndex:a,weight:(b-d[e].value)/(d[a].value-d[e].value)}}Object.defineProperty(n,"__esModule",{value:!0});var q=[64,64,64],r=[255,255,255];
n.getRampBorderColor=function(b){var e=null;if("simple"===b.type)e=b.symbol;else if("unique-value"===b.type||"class-breaks"===b.type)e=(b=(b=b.classBreakInfos||b.uniqueValueInfos)&&b[0])&&b.symbol;return(b=(b=e&&-1===e.type.indexOf("line-symbol")?d.getStroke(e):null)&&b.color)&&0<b.a&&!(240<=b.r&&240<=b.g&&240<=b.b)?b:null};n.getRampOverlayColor=function(b){var d=new g(r);d.a=1-b;return d};n.getRampStops=function(d,h,p){var a=!1,c=[],m=[];if(h.colors||h.opacityValues)c=l(h.minDataValue,h.maxDataValue);
else if(h.stops){var f=h.stops,c=f.map(function(a){return a.value});(a=f.some(function(a){return!!a.label}))&&(m=f.map(function(a){return a.label}))}var u=c[0],f=c[c.length-1];if(null==u&&null==f)return null;var C=f-u;return c.map(function(f,l){var w;if("opacity"===h.type){w=p;void 0===w&&(w=q);w=new g(w);var k=d.getOpacity(f,{opacityInfo:h});null!=k&&(w.a=k)}else w=d.getColor(f,{colorInfo:h});l=a?m[l]:e.getLabelPrefix(l,c.length-1)+b.format(f);return{value:f,color:w,label:l,offset:C?1-(f-u)/C:1}}).reverse()};
n.getRampStopsForPointCloud=function(d){var h=!1,g=[],a=[],g=d.map(function(a){return a.value});(h=d.some(function(a){return!!a.label}))&&(a=d.map(function(a){return a.label}));var c=g[0],m=g[g.length-1];if(null==c&&null==m)return null;var f=m-c;return g.map(function(m,l){var w=p(m,d);l=h?a[l]:e.getLabelPrefix(l,g.length-1)+b.format(m);return{value:m,color:w,label:l,offset:f?1-(m-c)/f:1}}).reverse()};n.getColorFromPointCloudStops=p})},"esri/widgets/Legend/support/utils":function(){define(["require",
"exports"],function(y,n){Object.defineProperty(n,"__esModule",{value:!0});n.getLabelPrefix=function(g,e){return 0===g?"\x3c ":g===e?"\x3e ":""}})},"esri/symbols/support/gfxUtils":function(){define("require exports dojo/_base/lang dojox/gfx/_base ../../Color ../../core/screenUtils ../../request ../../core/promiseUtils ../../core/LRUMap".split(" "),function(y,n,g,e,b,d,l,u,p){function t(a){if(!a)return null;var b,e=a.constructor,f=d.pt2px(a.width);switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":b=
t(a.outline);break;case "simple-line":a.style!==e.STYLE_NULL&&0!==f&&(b={color:a.color,style:v(a.style),width:f,cap:a.cap,join:a.join===e.JOIN_MITER?d.pt2px(a.miterLimit):a.join});break;default:b=null}return b}Object.defineProperty(n,"__esModule",{value:!0});var q=y.toUrl("../../symbols/patterns/"),r={left:"start",center:"middle",right:"end",justify:"start"},x={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},h=new p(1E3);n.getSVGAlign=function(a){return a=(a=
a.horizontalAlignment)&&r[a.toLowerCase()]||"middle"};n.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&x[a.toLowerCase()]||"alphabetic"};n.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};n.getFill=function(a){var b=a.style,h=null;if(a){var f=a.constructor;switch(a.type){case "simple-marker":b!==f.STYLE_CROSS&&b!==f.STYLE_X&&(h=a.color);break;case "simple-fill":b===f.STYLE_SOLID?h=a.color:b!==f.STYLE_NULL&&(h=g.mixin({},e.defaultPattern,{src:q+b+".png",
width:8,height:8}));break;case "picture-fill":h=g.mixin({},e.defaultPattern,{src:a.url,width:d.pt2px(a.width)*a.xscale,height:d.pt2px(a.height)*a.yscale,x:d.pt2px(a.xoffset),y:d.pt2px(a.yoffset)});break;case "text":h=a.color}}return h};n.getPatternUrlWithColor=function(a,b){var c=a+"-"+b;return h.has(c)?u.resolve(h.get(c)):l(a,{responseType:"image",allowImageDataAccess:!0}).then(function(a){a=a.data;var d=a.naturalWidth,e=a.naturalHeight,f=document.createElement("canvas");f.width=d;f.height=e;var g=
f.getContext("2d");g.fillStyle=b;g.fillRect(0,0,d,e);g.globalCompositeOperation="destination-in";g.drawImage(a,0,0);a=f.toDataURL();h.set(c,a);return a})};n.getStroke=t;var v=function(){var a={};return function(b){if(a[b])return a[b];var c=b.replace(/-/g,"");return a[b]=c}}();n.defaultThematicColor=new b([128,128,128])})},"dojox/gfx/_base":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/Color dojo/_base/sniff dojo/_base/window dojo/_base/array dojo/dom dojo/dom-construct dojo/dom-geometry".split(" "),
function(y,n,g,e,b,d,l,u,p){var t=n.getObject("dojox.gfx",!0),q=t._base={};t._hasClass=function(a,b){return(a=a.getAttribute("className"))&&0<=(" "+a+" ").indexOf(" "+b+" ")};t._addClass=function(a,b){var c=a.getAttribute("className")||"";(!c||0>(" "+c+" ").indexOf(" "+b+" "))&&a.setAttribute("className",c+(c?" ":"")+b)};t._removeClass=function(a,b){var c=a.getAttribute("className");c&&a.setAttribute("className",c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)"),"$1$2"))};q._getFontMeasurements=function(){var a=
{"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0},d,f;e("ie")&&(f=b.doc.documentElement.style.fontSize||"",f||(b.doc.documentElement.style.fontSize="100%"));var h=u.create("div",{style:{position:"absolute",left:"0",top:"-100px",width:"30px",height:"1000em",borderWidth:"0",margin:"0",padding:"0",outline:"none",lineHeight:"1",overflow:"hidden"}},b.body());for(d in a)h.style.fontSize=d,a[d]=16*Math.round(12*h.offsetHeight/16)/12/1E3;
e("ie")&&(b.doc.documentElement.style.fontSize=f);b.body().removeChild(h);return a};var r=null;q._getCachedFontMeasurements=function(a){if(a||!r)r=q._getFontMeasurements();return r};var x=null,h={};q._getTextBox=function(a,d,e){var c,f,g=arguments.length,l;x||(x=u.create("div",{style:{position:"absolute",top:"-10000px",left:"0",visibility:"hidden"}},b.body()));c=x;c.className="";f=c.style;f.borderWidth="0";f.margin="0";f.padding="0";f.outline="0";if(1<g&&d)for(l in d)l in h||(f[l]=d[l]);2<g&&e&&(c.className=
e);c.innerHTML=a;c.getBoundingClientRect?(f=c.getBoundingClientRect(),f={l:f.left,t:f.top,w:f.width||f.right-f.left,h:f.height||f.bottom-f.top}):f=p.getMarginBox(c);c.innerHTML="";return f};q._computeTextLocation=function(a,b,d,e){var c={};switch(a.align){case "end":c.x=a.x-b;break;case "middle":c.x=a.x-b/2;break;default:c.x=a.x}c.y=a.y-d*(e?.75:1);return c};q._computeTextBoundingBox=function(a){if(!t._base._isRendered(a))return{x:0,y:0,width:0,height:0};var b;b=a.getShape();var c=a.getFont()||t.defaultFont;
a=a.getTextWidth();c=t.normalizedLength(c.size);b=q._computeTextLocation(b,a,c,!0);return{x:b.x,y:b.y,width:a,height:c}};q._isRendered=function(a){for(a=a.parent;a&&a.getParent;)a=a.parent;return null!==a};var v=0;q._getUniqueId=function(){var a;do a=y._scopeName+"xUnique"+ ++v;while(l.byId(a));return a};var a=e("pointer-events")?"touchAction":e("MSPointer")?"msTouchAction":null;q._fixMsTouchAction=a?function(b){b.rawNode.style[a]="none"}:function(){};n.mixin(t,{defaultPath:{type:"path",path:""},
defaultPolyline:{type:"polyline",points:[]},defaultRect:{type:"rect",x:0,y:0,width:100,height:100,r:0},defaultEllipse:{type:"ellipse",cx:0,cy:0,rx:200,ry:100},defaultCircle:{type:"circle",cx:0,cy:0,r:100},defaultLine:{type:"line",x1:0,y1:0,x2:100,y2:100},defaultImage:{type:"image",x:0,y:0,width:0,height:0,src:""},defaultText:{type:"text",x:0,y:0,text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},defaultTextPath:{type:"textpath",text:"",align:"start",decoration:"none",rotated:!1,kerning:!0},
defaultStroke:{type:"stroke",color:"black",style:"solid",width:1,cap:"butt",join:4},defaultLinearGradient:{type:"linear",x1:0,y1:0,x2:100,y2:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultRadialGradient:{type:"radial",cx:0,cy:0,r:100,colors:[{offset:0,color:"black"},{offset:1,color:"white"}]},defaultPattern:{type:"pattern",x:0,y:0,width:0,height:0,src:""},defaultFont:{type:"font",style:"normal",variant:"normal",weight:"normal",size:"10pt",family:"serif"},getDefault:function(){var a=
{};return function(b){var c=a[b];if(c)return new c;c=a[b]=new Function;c.prototype=t["default"+b];return new c}}(),normalizeColor:function(a){return a instanceof g?a:new g(a)},normalizeParameters:function(a,b){var c;if(b){var d={};for(c in a)c in b&&!(c in d)&&(a[c]=b[c])}return a},makeParameters:function(a,b){var c=null;if(!b)return n.delegate(a);var d={};for(c in a)c in d||(d[c]=n.clone(c in b?b[c]:a[c]));return d},formatNumber:function(a,b){var c=a.toString();if(0<=c.indexOf("e"))c=a.toFixed(4);
else{var d=c.indexOf(".");0<=d&&5<c.length-d&&(c=a.toFixed(4))}return 0>a?c:b?" "+c:c},makeFontString:function(a){return a.style+" "+a.variant+" "+a.weight+" "+a.size+" "+a.family},splitFontString:function(a){var b=t.getDefault("Font");a=a.split(/\s+/);if(!(5>a.length)){b.style=a[0];b.variant=a[1];b.weight=a[2];var c=a[3].indexOf("/");b.size=0>c?a[3]:a[3].substring(0,c);var d=4;0>c&&("/"==a[4]?d=6:"/"==a[4].charAt(0)&&(d=5));d<a.length&&(b.family=a.slice(d).join(" "))}return b},cm_in_pt:72/2.54,mm_in_pt:7.2/
2.54,px_in_pt:function(){return t._base._getCachedFontMeasurements()["12pt"]/12},pt2px:function(a){return a*t.px_in_pt()},px2pt:function(a){return a/t.px_in_pt()},normalizedLength:function(a){if(0===a.length)return 0;if(2<a.length){var b=t.px_in_pt(),c=parseFloat(a);switch(a.slice(-2)){case "px":return c;case "pt":return c*b;case "in":return 72*c*b;case "pc":return 12*c*b;case "mm":return c*t.mm_in_pt*b;case "cm":return c*t.cm_in_pt*b}}return parseFloat(a)},pathVmlRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g,
pathSvgRegExp:/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,equalSources:function(a,b){return a&&b&&a===b},switchTo:function(a){var b="string"==typeof a?t[a]:a;b&&(d.forEach("Group Rect Ellipse Circle Line Polyline Image Text Path TextPath EsriPath Surface createSurface fixTarget".split(" "),function(a){t[a]=b[a]}),"string"==typeof a?t.renderer=a:d.some(["svg","vml","canvas","canvasWithEvents","silverlight"],function(a){return t.renderer=t[a]&&t[a].Surface===t.Surface?a:null}))}});return t})},
"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../symbols/Symbol3D ../../../symbols/SimpleMarkerSymbol ../../../symbols/PictureMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/support/symbolUtils ../../../core/numberUtils ./utils".split(" "),function(y,n,g,e,b,d,l,u,p){function t(a,b){var c=null,d=null;if("simple"===a.type)c=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)c=(c=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&
c.symbol,d=1<a.length;if(!c||q(c))return null;c=c.clone();if(b||d)-1<c.type.indexOf("3d")?r(c):(b=c,-1!==b.type.indexOf("line")?b.color=B:(b.color=m,"simple-marker"===b.type&&(b.outline={color:B,width:1.5})));return c}function q(a){if(a)return-1<a.type.indexOf("3d")?(a=a.symbolLayers)?a.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function r(a){l.isVolumetricSymbol(a)||(-1!==a.type.indexOf("line-3d")?a.symbolLayers.forEach(function(a){a.material={color:B}}):a.symbolLayers.forEach(function(a){"icon"!==
a.type||a.resource&&a.resource.href?a.material={color:f}:(a.material={color:m},a.outline={color:B,size:1.5})}))}function x(a,b,c,d){var e=a.getSizeRangeAtScale(b,d),f=e&&h(e);if(e||f){for(var g=f.map(function(a){var c=e.minSize,d=e.maxSize,k=b.minDataValue,f=b.maxDataValue;return a<=c?k:a>=d?f:(a-c)/(d-c)*(f-k)+k}),g=u.round(g),l=1;l<g.length-1;l++){var m=v(a,b,c,g[l],g[l-1],d);m&&(g[l]=m[0],f[l]=m[1])}return g}}function h(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);
return c}function v(b,c,d,e,k,f){var h=a(b,c,d,e,f);k=a(b,c,d,k,f);var g=u.numDigits(e),l=g.fractional,m=g.integer,q=g=null;0<e&&1>e&&(g=Math.pow(10,l),e*=g,m=u.numDigits(e).integer);for(l=m-1;0<=l;l--){var p=Math.pow(10,l),m=Math.floor(e/p)*p,p=Math.ceil(e/p)*p;null!=g&&(m/=g,p/=g);var r=(m+p)/2,r=u.round([m,r,p],{indexes:[1]}),r=r[1],t=a(b,c,d,m,f),n=a(b,c,d,p,f),A=a(b,c,d,r,f),w=u.percentChange(h,t,k,null),x=u.percentChange(h,n,k,null),v=u.percentChange(h,A,k,null),C=20>=w.previous,B=20>=x.previous;
C&&B&&(w.previous<=x.previous?(C=!0,B=!1):(B=!0,C=!1));C?q=[m,t]:B?q=[p,n]:20>=v.previous&&(q=[r,A]);if(q)break}return q}function a(a,b,c,d,e){return a.getSize(d,{sizeInfo:b,scale:e,shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})}function c(a,c){a=a.clone();if(a.isInstanceOf(g))l.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=c)});else if(a.isInstanceOf(e))a.size=c;else if(a.isInstanceOf(b)){var f=a.width,h=a.height;a.height=c;a.width=f/h*c}else a.isInstanceOf(d)?
a.width=c:a.isInstanceOf(d)&&a.font&&(a.font.size=c);return a}Object.defineProperty(n,"__esModule",{value:!0});var m=[255,255,255],f=[200,200,200],B=[128,128,128];n.getRampStops=function(b,d,e,f){var k=d.legendOptions,k=k&&k.customValues,g=t(b,e);e=null!=d.minSize&&null!=d.maxSize;var h=d.stops&&1<d.stops.length,m=!!d.target;if(g&&(k||e||h&&!m)){var q=l.isVolumetricSymbol(g),r=null,n=null,w=null,n=q&&!h?[d.minDataValue,d.maxDataValue]:k||x(b,d,g,f);!n&&h&&(n=d.stops.map(function(a){return a.value}),
(r=d.stops.some(function(a){return!!a.label}))&&(w=d.stops.map(function(a){return a.label})));k=!q||n&&2===n.length;if(!n||!k)return null;var v=[12,30];return n.map(function(e,k){var h=q?v[k]:a(b,d,g,e,f),l=c(g,h);k=r?w[k]:p.getLabelPrefix(k,n.length-1)+u.format(e);return{value:e,symbol:l,label:k,size:h}}).reverse()}}})},"esri/symbols/support/symbolPreview":function(){define(["require","exports","./previewSymbol2D","./previewSymbol3D"],function(y,n,g,e){Object.defineProperty(n,"__esModule",{value:!0});
n.renderPreviewHTML=function(b,d){return-1===b.type.indexOf("3d")?g.previewSymbol2D(b,d):e.previewSymbol3D(b,d)}})},"esri/symbols/support/previewSymbol2D":function(){define("require exports dojox/gfx/_base ../SimpleMarkerSymbol ../../core/promiseUtils ../../core/Error ../../core/screenUtils ./renderUtils ./previewUtils ./gfxUtils".split(" "),function(y,n,g,e,b,d,l,u,p,t){Object.defineProperty(n,"__esModule",{value:!0});n.previewSymbol2D=function(q,r){var n=r&&r.size?l.pt2px(r.size):null,h=r&&r.maxSize?
l.pt2px(r.maxSize):null,v=t.getStroke(q),a={shape:null,fill:null,stroke:v};v&&v.width&&(v.width=Math.min(v.width,80));var c=0,m=0,f=v&&v.width||0,B=!1,y=null;switch(q.type){case "simple-marker":var w=e.defaultProps,v=q.style,m=c=n=Math.min(n||l.pt2px(q.size||w.size),h||120);switch(v){case e.STYLE_CIRCLE:a.shape={type:"circle",cx:0,cy:0,r:.5*n};break;case e.STYLE_CROSS:a.shape={type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[c,.5*m]},{command:"M",values:[.5*c,0]},{command:"L",
values:[.5*c,m]},{command:"E",values:[]}]};break;case e.STYLE_DIAMOND:a.shape={type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[.5*c,0]},{command:"L",values:[c,.5*m]},{command:"L",values:[.5*c,m]},{command:"Z",values:[]}]};break;case e.STYLE_SQUARE:a.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[c,0]},{command:"L",values:[c,m]},{command:"L",values:[0,m]},{command:"Z",values:[]}]};break;case e.STYLE_X:a.shape={type:"path",path:[{command:"M",values:[0,
0]},{command:"L",values:[c,m]},{command:"M",values:[c,0]},{command:"L",values:[0,m]},{command:"E",values:[]}]};break;case e.STYLE_PATH:B=!0,a.shape={type:"path",path:q.path||""}}break;case "simple-line":f=Math.min(n||f,h||80);c=22<f?2*f:40;m=f;v.width=f;f=0;a.shape={type:"path",path:[{command:"M",values:[0,.5*m]},{command:"L",values:[c,.5*m]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":a.shape=p.shapes.fill[0];break;case "picture-marker":h=h||120;v=l.pt2px(q.width);w=l.pt2px(q.height);
n=Math.min(n||Math.max(v,w),h);w=v/w;v=1>=w?Math.ceil(n*w):n;w=1>=w?n:Math.ceil(n/w);c=v;m=w;y=r.opacity;a.shape={type:"image",x:-Math.round(v/2),y:-Math.round(w/2),width:v,height:w,src:q.url||""};break;case "text":for(var v=q.text||"Aa",w=q.font,n=Math.min(n||l.pt2px(w.size),h||120),E=h=0;E<v.length;E++)var H=v.charAt(E),H=H===H.toUpperCase()?.7:.5,h=h+n*H;c=h;m=n;a.shape={type:"text",text:v,x:0,y:.25*g.normalizedLength((w?n:0).toString()),align:"middle",decoration:q.decoration||w&&w.decoration,
rotated:q.rotated,kerning:q.kerning};a.font=w&&{size:n,style:w.style,variant:w.variant,decoration:w.decoration,weight:w.weight,family:w.family}}if(!a.shape)return b.reject(new d("symbolPreview: renderPreviewHTML2D","symbol not supported."));var c=(c||22)+2*f,m=(m||22)+2*f,k=t.getFill(q);q=q.color;f=null;k&&"pattern"===k.type&&q?f=t.getPatternUrlWithColor(k.src,q.toCss(!0)).then(function(b){k.src=b;a.fill=k;return a}):(a.fill=k,f=b.resolve(a));return f.then(function(a){return u.renderSymbol([[a]],
[c,m],{node:r&&r.node,scale:B,opacity:y})})}})},"esri/symbols/support/renderUtils":function(){define("require exports dojo/_base/lang dojo/Deferred dojox/gfx/matrix dojox/gfx ../../request ../../core/sniff ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../kernel".split(" "),function(y,n,g,e,b,d,l,u,p,t,q,r){function x(a){return a.map(function(a){return a.command+" "+a.values.join(",")}).join(" ").trim()}function h(a,c,e,f){var h=f&&f.node||document.createElement("div"),l=d.createSurface(h,
c,e);null!=f.opacity&&(h.style.opacity=f.opacity.toString());try{a.forEach(function(a){var d=l.createGroup(),h=0;a.forEach(function(a){var b=a.shape,c=a.fill,e=a.stroke;h+=e&&e.width||0;var f=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=x(b.path)),f=d.createShape(b).setFill(c).setStroke(e?e:{width:0}),"text"===b.type&&f.setFont(a.font))});var k=d.getBoundingBox();a=k.width;var m=k.height,z=-(k.x+a/2),q=-(k.y+m/2),p=l.getDimensions(),z={dx:z+p.width/2,dy:q+p.height/2},q=!1;if(f.scale&&
0!==k.width&&0!==k.height){var q=k.width/k.height,n=(c>e?c:e)-2*h,u=1,r=1;isNaN(n)||(1<q?(u=n/k.width,r=n/q/k.height):(r=n/k.height,u=n*q/k.width));d.applyTransform(b.scaleAt(u,r,p.width/2,p.height/2));q=!0}!q&&(a>c||m>e)&&(k=a/c>m/e,a=((k?c:e)-5)/(k?a:m),g.mixin(z,{xx:a,yy:a}));d.applyTransform(z)})}catch(w){return l.clear(),l.destroy(),null}return h}function v(a,b,d,f){if(!a)return t.reject(new p("renderUtils: imageDataSize","href not provided."));var c;if(q.isDataProtocol(a)){var h=new Image;h.src=
a;if(h.complete)c=t.resolve({data:h});else{var g=new e;c=g.promise;h.onload=function(){g.resolve({data:h})};h.onerror=g.reject}}else c=l(a,{responseType:"image",allowImageDataAccess:d});return c.then(function(a){a=a.data;var c=a.width,e=a.height,h=c/e,g=b;f&&(g=Math.min(g,Math.max(c,e)));return{image:d?a:null,width:1>=h?Math.ceil(g*h):g,height:1>=h?g:Math.ceil(g/h)}}).otherwise(function(c){if(d)return v(a,b,!1,f);throw c;})}Object.defineProperty(n,"__esModule",{value:!0});n.renderSymbol=function(a,
b,d){var c=Math.ceil(b[0]);b=Math.ceil(b[1]);return a.some(function(a){return!!a.length})?h(a,c,b,d):null};n.tintImageWithColor=function(a,b,d,e){return v(a,b,!!d,e).then(function(c){var e=c.width?c.width:b,h=c.height?c.height:b;if(c.image&&d){var f=c.image.width,g=c.image.height;(u("edge")||u("ie"))&&/\.svg$/i.test(a)&&(--f,--g);var k,l;k=Math.ceil(e);l=Math.ceil(h);var m=document.createElement("canvas");m.width=k;m.height=l;m.style.width=k+"px";m.style.height=l+"px";m=m.getContext("2d");m.clearRect(0,
0,k,l);m.drawImage(c.image,0,0,f,g,0,0,e,h);c=m.getImageData(0,0,e,h);f=d.r/255;g=d.g/255;k=d.b/255;l=d.a;for(var q=0;q<c.data.length;q+=4)c.data[q+0]*=f,c.data[q+1]*=g,c.data[q+2]*=k,c.data[q+3]*=l;m.putImageData(c,0,0);a=m.canvas.toDataURL("image/png")}else(m=r.id&&r.id.findCredential(a))&&m.token&&(c=-1===a.indexOf("?")?"?":"\x26",a=""+a+c+"token\x3d"+m.token);return{url:a,width:e,height:h}}).otherwise(function(){return{url:a,width:b,height:b}})}})},"dojox/gfx/matrix":function(){define(["./_base",
"dojo/_base/lang"],function(y,n){var g=y.matrix={},e={};g._degToRad=function(b){return e[b]||(e[b]=Math.PI*b/180)};g._radToDeg=function(b){return b/Math.PI*180};g.Matrix2D=function(b){if(b)if("number"==typeof b)this.xx=this.yy=b;else if(b instanceof Array){if(0<b.length){for(var d=g.normalize(b[0]),e=1;e<b.length;++e){var u=d,p=g.normalize(b[e]),d=new g.Matrix2D;d.xx=u.xx*p.xx+u.xy*p.yx;d.xy=u.xx*p.xy+u.xy*p.yy;d.yx=u.yx*p.xx+u.yy*p.yx;d.yy=u.yx*p.xy+u.yy*p.yy;d.dx=u.xx*p.dx+u.xy*p.dy+u.dx;d.dy=u.yx*
p.dx+u.yy*p.dy+u.dy}n.mixin(this,d)}}else n.mixin(this,b)};n.extend(g.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});n.mixin(g,{identity:new g.Matrix2D,flipX:new g.Matrix2D({xx:-1}),flipY:new g.Matrix2D({yy:-1}),flipXY:new g.Matrix2D({xx:-1,yy:-1}),translate:function(b,d){return 1<arguments.length?new g.Matrix2D({dx:b,dy:d}):new g.Matrix2D({dx:b.x,dy:b.y})},scale:function(b,d){return 1<arguments.length?new g.Matrix2D({xx:b,yy:d}):"number"==typeof b?new g.Matrix2D({xx:b,yy:b}):new g.Matrix2D({xx:b.x,yy:b.y})},
rotate:function(b){var d=Math.cos(b);b=Math.sin(b);return new g.Matrix2D({xx:d,xy:-b,yx:b,yy:d})},rotateg:function(b){return g.rotate(g._degToRad(b))},skewX:function(b){return new g.Matrix2D({xy:Math.tan(b)})},skewXg:function(b){return g.skewX(g._degToRad(b))},skewY:function(b){return new g.Matrix2D({yx:Math.tan(b)})},skewYg:function(b){return g.skewY(g._degToRad(b))},reflect:function(b,d){1==arguments.length&&(d=b.y,b=b.x);var e=b*b,n=d*d,p=e+n,t=2*b*d/p;return new g.Matrix2D({xx:2*e/p-1,xy:t,yx:t,
yy:2*n/p-1})},project:function(b,d){1==arguments.length&&(d=b.y,b=b.x);var e=b*b,n=d*d,p=e+n,t=b*d/p;return new g.Matrix2D({xx:e/p,xy:t,yx:t,yy:n/p})},normalize:function(b){return b instanceof g.Matrix2D?b:new g.Matrix2D(b)},isIdentity:function(b){return 1==b.xx&&0==b.xy&&0==b.yx&&1==b.yy&&0==b.dx&&0==b.dy},clone:function(b){var d=new g.Matrix2D,e;for(e in b)"number"==typeof b[e]&&"number"==typeof d[e]&&d[e]!=b[e]&&(d[e]=b[e]);return d},invert:function(b){b=g.normalize(b);var d=b.xx*b.yy-b.xy*b.yx;
return b=new g.Matrix2D({xx:b.yy/d,xy:-b.xy/d,yx:-b.yx/d,yy:b.xx/d,dx:(b.xy*b.dy-b.yy*b.dx)/d,dy:(b.yx*b.dx-b.xx*b.dy)/d})},_multiplyPoint:function(b,d,e){return{x:b.xx*d+b.xy*e+b.dx,y:b.yx*d+b.yy*e+b.dy}},multiplyPoint:function(b,d,e){b=g.normalize(b);return"number"==typeof d&&"number"==typeof e?g._multiplyPoint(b,d,e):g._multiplyPoint(b,d.x,d.y)},multiplyRectangle:function(b,d){var e=g.normalize(b);d=d||{x:0,y:0,width:0,height:0};if(g.isIdentity(e))return{x:d.x,y:d.y,width:d.width,height:d.height};
b=g.multiplyPoint(e,d.x,d.y);var n=g.multiplyPoint(e,d.x,d.y+d.height),p=g.multiplyPoint(e,d.x+d.width,d.y);d=g.multiplyPoint(e,d.x+d.width,d.y+d.height);var e=Math.min(b.x,n.x,p.x,d.x),t=Math.min(b.y,n.y,p.y,d.y);return{x:e,y:t,width:Math.max(b.x,n.x,p.x,d.x)-e,height:Math.max(b.y,n.y,p.y,d.y)-t}},multiply:function(b){for(var d=g.normalize(b),e=1;e<arguments.length;++e){var n=d,p=g.normalize(arguments[e]),d=new g.Matrix2D;d.xx=n.xx*p.xx+n.xy*p.yx;d.xy=n.xx*p.xy+n.xy*p.yy;d.yx=n.yx*p.xx+n.yy*p.yx;
d.yy=n.yx*p.xy+n.yy*p.yy;d.dx=n.xx*p.dx+n.xy*p.dy+n.dx;d.dy=n.yx*p.dx+n.yy*p.dy+n.dy}return d},_sandwich:function(b,d,e){return g.multiply(g.translate(d,e),b,g.translate(-d,-e))},scaleAt:function(b,d,e,n){switch(arguments.length){case 4:return g._sandwich(g.scale(b,d),e,n);case 3:return"number"==typeof e?g._sandwich(g.scale(b),d,e):g._sandwich(g.scale(b,d),e.x,e.y)}return g._sandwich(g.scale(b),d.x,d.y)},rotateAt:function(b,d,e){return 2<arguments.length?g._sandwich(g.rotate(b),d,e):g._sandwich(g.rotate(b),
d.x,d.y)},rotategAt:function(b,d,e){return 2<arguments.length?g._sandwich(g.rotateg(b),d,e):g._sandwich(g.rotateg(b),d.x,d.y)},skewXAt:function(b,d,e){return 2<arguments.length?g._sandwich(g.skewX(b),d,e):g._sandwich(g.skewX(b),d.x,d.y)},skewXgAt:function(b,d,e){return 2<arguments.length?g._sandwich(g.skewXg(b),d,e):g._sandwich(g.skewXg(b),d.x,d.y)},skewYAt:function(b,d,e){return 2<arguments.length?g._sandwich(g.skewY(b),d,e):g._sandwich(g.skewY(b),d.x,d.y)},skewYgAt:function(b,d,e){return 2<arguments.length?
g._sandwich(g.skewYg(b),d,e):g._sandwich(g.skewYg(b),d.x,d.y)}});y.Matrix2D=g.Matrix2D;return g})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(y,n,g){n.switchTo(g);return n})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(y,n,g,e,b){var d=null;g.add("vml",function(b,d,e){e.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';b="adj"in e.firstChild;e.innerHTML="";return b});
return{load:function(l,u,p){function t(){u(["dojox/gfx/"+q],function(b){y.renderer=q;d=b;p(b)})}if(d&&"force"!=l)p(d);else{var q=b.forceGfxRenderer;l=!q&&(n.isString(b.gfxRenderer)?b.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var r,x;!q&&l.length;)switch(l.shift()){case "svg":"SVGAngle"in e.global&&(q="svg");break;case "vml":g("vml")&&(q="vml");break;case "silverlight":try{g("ie")?(r=new ActiveXObject("AgControl.AgControl"),r.IsVersionSupported("1.0"))&&(x=!0):navigator.plugins["Silverlight Plug-In"]&&
(x=!0)}catch(h){x=!1}finally{r=null}x&&(q="silverlight");break;case "canvas":e.global.CanvasRenderingContext2D&&(q="canvas")}"canvas"===q&&!1!==b.canvasEvents&&(q="canvasWithEvents");b.isDebug&&console.log("gfx renderer \x3d "+q);"svg"==q&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(t):t()}}}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(y,n){Object.defineProperty(n,"__esModule",{value:!0});n.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],
pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],
invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",
path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],
tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};n.getExtrudeSymbolShapes=function(g){g*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+g]},{command:"L",values:[0,22*.7+g-.7*11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+g]},{command:"L",
values:[22,g]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};n.getCubeShapes=function(g,e){var b=e?20:g,d=e?4:6,d=b=22>=b?b-.5*d:b-d;e=e?.35*b:.5*b;return[{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[d,.5*e]},{command:"L",values:[.5*d,e]},{command:"L",values:[0,.5*e]},{command:"Z",values:[]}]},{type:"path",
path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*d,e]},{command:"L",values:[.5*d,g]},{command:"L",values:[0,g-.5*e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*d,e]},{command:"L",values:[.5*d,g]},{command:"L",values:[d,g-.5*e]},{command:"L",values:[d,.5*e]},{command:"Z",values:[]}]}]};n.getCylinderShapes=function(g,e){var b=e?20:g;e=e?4:6;b=22>=b?b-.5*e:b-e;e=.5*b;var d=.15*b;g-=d;return[{type:"ellipse",cx:.5*b,cy:g,rx:e,ry:d},{type:"path",path:[{command:"M",values:[0,
d]},{command:"L",values:[0,g]},{command:"L",values:[b,g]},{command:"L",values:[b,d]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*b,cy:d,rx:e,ry:d}]};n.getConeShapes=function(g,e){var b=e?20:g;e=e?4:6;b=22>=b?b-.5*e:b-e;e=.15*b;var d=b;g-=e;return[{type:"ellipse",cx:.5*b,cy:g,rx:.5*b,ry:e},{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[d,g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]}]};n.getInvertedConeShapes=function(g){var e=g,e=22>e?e-3:e-6,b=.15*e,d=e;return[{type:"path",
path:[{command:"M",values:[0,0]},{command:"L",values:[d,0]},{command:"L",values:[.5*d,g-b]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*e,cy:0,rx:.5*e,ry:b}]};n.getDiamondShapes=function(g){var e=g,e=22>e?e-2:e-4,b=Math.floor(g/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,.5*g-b]},{command:"L",values:[.45*e-b,.5*g+b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e-b,.5*g+b]},{command:"L",values:[0,
.5*g-b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*g-b]},{command:"L",values:[.45*e-b,.5*g+b]},{command:"L",values:[.45*e,g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,g]},{command:"L",values:[e,.5*g-b]},{command:"L",values:[.45*e-b,.5*g+b]},{command:"Z",values:[]}]}]};n.getTetrahedronShapes=function(g){var e=g,e=22>e?e-1:e-2;return[{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[g,e]},{command:"L",values:[.45*g,.6*
e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[.45*g,.6*e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[.45*g,.6*e]},{command:"L",values:[g,e]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/Logger ../../core/promiseUtils ../../core/Error ../../core/screenUtils ./styleUtils ./symbolUtils ./gfxUtils ./renderUtils ./previewUtils".split(" "),
function(y,n,g,e,b,d,l,u,p,t,q){function r(a){var b=a.outline,c=a.get("material.color"),c=c&&c.toRgba().toString();if(!b)return"fill"===a.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:null;a=d.pt2px(b.size)||0;return{color:"rgba("+(null!=b.color?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function x(a,b){var c=b&&b.resource;return c&&c.href&&"object"!==b.type?e.resolve(u.getIconHref(a,b)):a.thumbnail&&a.thumbnail.url?e.resolve(a.thumbnail.url):a.styleOrigin&&(a.styleOrigin.styleName||
a.styleOrigin.styleUrl)?l.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||E}):e.resolve(E)}function h(a,b){if(!a.material||!a.material.color)return a=Math.min(Math.max(p.defaultThematicColor.r+191.25*b,0),255),[a,a,a,100];for(var c=a.material.color.toRgb(),d=0;3>d;d++)c[d]=Math.min(Math.max(c[d]+191.25*b,0),255);c.push(a.material.color.a);return c}function v(a){return a.outline?r(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}
function a(a,b){if(!a.material)return{};for(var c=a.material.color.toRgb(),e="rgba(",f=0;3>f;f++)e+=Math.min(Math.max(c[f]+191.25*b,0),255)+",";e+=a.material.color.a+");";a=a.size?d.pt2px(a.size):.75;return{color:e,width:Math.min(a,80)}}function c(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function m(a){var b=a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function f(a,b,d,e){var f=a&&a.type,g="object"===f,
k=[];if("icon"===f)switch(b){case "circle":k.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:h(a,0),stroke:r(a)});break;case "square":k.push({shape:{type:"path",path:[{command:"M",values:[0,d]},{command:"L",values:[0,0]},{command:"L",values:[d,0]},{command:"L",values:[d,d]},{command:"Z",values:[]}]},fill:h(a,0),stroke:r(a)});break;case "cross":k.push({shape:{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[.5*d,d]},{command:"M",values:[0,.5*d]},{command:"L",values:[d,.5*d]},
{command:"E",values:[]}]},stroke:v(a)});break;case "x":k.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[d,d]},{command:"M",values:[d,0]},{command:"L",values:[0,d]},{command:"E",values:[]}]},stroke:v(a)});break;case "kite":k.push({shape:{type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*d,0]},{command:"L",values:[d,.5*d]},{command:"L",values:[.5*d,d]},{command:"Z",values:[]}]},fill:h(a,0),stroke:r(a)})}else if(g)switch(b){case "cone":b=h(a,0);a=
h(a,-.6);a=c(b,a,e?20:d);d=q.getConeShapes(d,e);k.push({shape:d[0],fill:a});k.push({shape:d[1],fill:a});break;case "inverted-cone":e=h(a,0);a=h(a,-.6);a=c(e,a,d);d=q.getInvertedConeShapes(d);k.push({shape:d[0],fill:a});k.push({shape:d[1],fill:e});break;case "cube":d=q.getCubeShapes(d,e);k.push({shape:d[0],fill:h(a,0)});k.push({shape:d[1],fill:h(a,-.3)});k.push({shape:d[2],fill:h(a,-.5)});break;case "cylinder":b=h(a,0);f=h(a,-.6);b=c(b,f,e?20:d);d=q.getCylinderShapes(d,e);k.push({shape:d[0],fill:b});
k.push({shape:d[1],fill:b});k.push({shape:d[2],fill:h(a,0)});break;case "diamond":d=q.getDiamondShapes(d);k.push({shape:d[0],fill:h(a,-.3)});k.push({shape:d[1],fill:h(a,0)});k.push({shape:d[2],fill:h(a,-.3)});k.push({shape:d[3],fill:h(a,-.7)});break;case "sphere":e=h(a,0);a=h(a,-.6);a=c(e,a);a.x1=0;a.y1=0;a.x2=.25*d;a.y2=.25*d;k.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:a});break;case "tetrahedron":d=q.getTetrahedronShapes(d),k.push({shape:d[0],fill:h(a,-.3)}),k.push({shape:d[1],fill:h(a,
0)}),k.push({shape:d[2],fill:h(a,-.6)})}return k}function B(a,b){var c=b&&b.size?d.pt2px(b.size):null,h=b&&b.maxSize?d.pt2px(b.maxSize):null,g=b&&b.disableUpsampling,k=a.symbolLayers,l=[],n=0,q=0,p=k.getItemAt(k.length-1),u;p&&"icon"===p.type&&(u=p.size&&d.pt2px(p.size));k.forEach(function(p,v){var w=p&&p.type,z="icon"===w,w="object"===w,y=z?p.size&&d.pt2px(p.size):0,A=c||y?Math.ceil(Math.min(c||y,h||120)):22;if(z||w){var I=r(p),F=I?I.width:0;if(p&&p.resource&&p.resource.href)v=x(a,p).then(function(a){return t.tintImageWithColor(a,
A,p.get("material.color"),g)}).then(function(a){var b=a.width,c=a.height;n=Math.max(n,b+2*F);q=Math.max(q,c+2*F);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),l.unshift(v);else{var I=(I=p.get("resource.primitive"))?I:z?"circle":"sphere",D=A;z&&(D=v<k.length-1?c?y/u*A:A:A);v=b&&"tall"===b.symbolConfig||(w?m(p):!1);n=Math.max(n,v?20:D+2*F);q=Math.max(q,D+2*F);l.unshift(e.resolve(f(p,I,D,v)))}}});return e.eachAlways(l).then(function(a){var c=[];a.forEach(function(a){a.value?
c.push(a.value):a.error&&H.warn("error while building swatchInfo!",a.error)});return t.renderSymbol(c,[n,q],{node:b&&b.node,scale:!1})})}function C(b,c){var f=b.symbolLayers,g=[];b=u.isVolumetricSymbol(b);var k=c&&c.size?d.pt2px(c.size):null,l=(c&&c.maxSize?d.pt2px(c.maxSize):null)||80,m=0,n=0,p;f.forEach(function(b,c){var d=b&&b.type,e="line"===d;if(e||"path"===d){var f=a(b,0),r=f&&f.width||0,d=[];e?(0===c&&(p=r),b=Math.min(k||r,l),b=0===c?b:k?r/p*b:b,n=Math.max(n,b),m=Math.max(m,22<b?2*b:40),f.width=
b,d.push({shape:{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[m,.5*n]},{command:"E",values:[]}]},stroke:f})):(c=Math.min(k||22,l),f=h(b,0),e=h(b,-.2),b=a(b,-.4),b.width=1,d.push({shape:q.shapes.pathSymbol3DLayer[0],fill:e,stroke:b}),d.push({shape:q.shapes.pathSymbol3DLayer[1],fill:f,stroke:b}),m=n=Math.max(n,c+2));g.push(d)}});return e.resolve(t.renderSymbol(g,[m,n],{node:c&&c.node,scale:b}))}function w(b,c){var f="mesh-3d"===b.type;b=b.symbolLayers;var g=c&&c.size?d.pt2px(c.size):
null,k=c&&c.maxSize?d.pt2px(c.maxSize):null,l=g||22,m=[],n=0,p=0;b.forEach(function(b){var c=b.type,d="fill"===c,e="line"===c,g="extrude"===b.type,c=[];if(!f||d){var t=q.shapes.fill[0];d?(e=(d=r(b))&&d.width||0,n=Math.max(n,22+e),p=Math.max(p,22+e),c.push({shape:t,fill:h(b,0),stroke:d})):e?(b=(d=a(b,0))&&d.width||0,t={stroke:d,shape:t},n=Math.max(n,22+b),p=Math.max(p,22+b),c.push(t)):g&&(t=a(b,-.4),d=h(b,0),b=h(b,-.2),e=Math.min(l,k||120),g=q.getExtrudeSymbolShapes(e),t.width=1,c.push({shape:g[0],
fill:b,stroke:t}),c.push({shape:g[1],fill:b,stroke:t}),c.push({shape:g[2],fill:d,stroke:t}),n=Math.max(n,22+2*t.width),p=Math.max(p,22*.7+.5*e+2*t.width));m.push(c)}});return e.resolve(t.renderSymbol(m,[n,p],{node:c&&c.node,scale:!1}))}Object.defineProperty(n,"__esModule",{value:!0});var E=y.toUrl("../../images/Legend/legend3dsymboldefault.png"),H=g.getLogger("esri.symbols.support.previewSymbol3D");n.previewSymbol3D=function(a,c){if(0===a.symbolLayers.length)return e.reject(new b("symbolPreview: renderPreviewHTML3D",
"No symbolLayers in the symbol."));var d=null;switch(a.type){case "point-3d":d=B(a,c);break;case "line-3d":d=C(a,c);break;case "polygon-3d":case "mesh-3d":d=w(a,c)}return d?d:e.reject(new b("symbolPreview: swatchInfo3D","symbol not supported."))}})},"widgets/Legend/_build-generate_module":function(){define(["dojo/i18n!./nls/strings"],function(){})},"*now":function(y){y(['dojo/i18n!*preload*widgets/Legend/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/Legend"],function(y,n,g){return y([n],{name:"Legend",baseClass:"jimu-widget-legend",templateString:"\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d'legendDiv'\x3e\x3c/div\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);this.legend=new g({container:this.legendDiv,view:this.sceneView})},destroy:function(){this.legend&&this.legend.destroy();this.inherited(arguments)}})});