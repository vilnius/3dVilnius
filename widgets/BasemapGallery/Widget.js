// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/BasemapGallery":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./BasemapGallery/nls/BasemapGallery ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./BasemapGallery/BasemapGalleryViewModel ./support/widget".split(" "),function(q,r,l,b,k,m,n,c,t,e,a){var f=q.toUrl("../themes/base/images/basemap-toggle-64.svg");return function(p){function d(a){a=p.call(this)||this;a._handles=
new m;a.activeBasemap=null;a.iconClass="esri-icon-basemap";a.label=k.widgetLabel;a.source=null;a.view=null;a.viewModel=new e;return a}l(d,p);d.prototype.postInitialize=function(){var a=this,b=this._handles;this.own([n.on(this,"viewModel.items","change",function(g){var f=g.added;g=g.moved;b.remove("basemap-gallery-item-changes");b.add(f.concat(g).map(function(h){return h.watch("state",function(){return a.scheduleRender()})}),"basemap-gallery-item-changes");a.scheduleRender()}),b,n.whenOnce(this,"source",
function(){return a.viewModel.load()})])};d.prototype.render=function(){var g,b="loading"===this.get("source.state"),f="disabled"===this.get("viewModel.state"),d=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this),f=(g={},g["esri-basemap-gallery--source-loading"]=b,g["esri-disabled"]=f,g);g=b?a.tsx("div",{class:"esri-basemap-gallery__loader",key:"esri-basemap-gallery__loader"}):null;b=b?null:0<d.length?a.tsx("ul",{class:"esri-basemap-gallery__item-container",key:"esri-basemap-gallery__item-container",
role:"menu"},d):a.tsx("div",{class:"esri-widget__content--empty",key:"esri-basemap-gallery__empty-message"},a.tsx("h2",{class:"esri-widget__heading"},k.noBasemaps));return a.tsx("div",{class:this.classes("esri-basemap-gallery esri-widget esri-widget--panel-height-only",f)},g,b)};d.prototype._handleClick=function(a){a=a.currentTarget["data-item"];"ready"===a.state&&(this.activeBasemap=a.basemap)};d.prototype._renderBasemapGalleryItem=function(b){var d,g=b.get("basemap.thumbnailUrl")||f,p=b.get("basemap.title"),
h=b.get("basemap.portalItem.snippet"),h=b.get("error.message")||h||p,w="ready"===b.state?0:-1,c=this.viewModel.basemapEquals(b.basemap,this.activeBasemap),e=(d={},d["esri-basemap-gallery__item--selected"]=c,d["esri-basemap-gallery__item--loading"]="loading"===b.state,d["esri-basemap-gallery__item--error"]="error"===b.state,d);d="loading"===b.state?a.tsx("div",{class:"esri-basemap-gallery__loader",key:"esri-basemap-gallery__loader"}):null;return a.tsx("li",{"aria-selected":c,bind:this,class:this.classes("esri-basemap-gallery__item",
e),"data-item":b,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:w,title:h},d,a.tsx("img",{alt:"",class:"esri-basemap-gallery__item-thumbnail",src:g}),a.tsx("div",{class:"esri-basemap-gallery__item-title"},p))};b([c.aliasOf("viewModel.activeBasemap"),a.renderable()],d.prototype,"activeBasemap",void 0);b([c.property()],d.prototype,"iconClass",void 0);b([c.property()],d.prototype,"label",void 0);b([c.aliasOf("viewModel.source"),a.renderable("source.state")],d.prototype,
"source",void 0);b([c.aliasOf("viewModel.view"),a.renderable()],d.prototype,"view",void 0);b([c.property(),a.renderable(["viewModel.state"])],d.prototype,"viewModel",void 0);b([a.accessibleHandler()],d.prototype,"_handleClick",null);return d=b([c.subclass("esri.widgets.BasemapGallery")],d)}(c.declared(t))})},"esri/widgets/BasemapGallery/BasemapGalleryViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/Loadable ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(q,r,l,b,k,m,n,c,t,e,a,f,p,d,g,u){var v=m.ofType(d);return function(c){function h(a){a=c.call(this)||this;a._handles=new n;a.activeBasemap=null;a.items=new v;a.source=new u;a.view=null;return a}l(h,c);h.prototype.initialize=function(){var a=this;this._handles.add([e.init(this,["compatibilityFunction","state"],function(){return a._updateItems()}),e.on(this,"source.basemaps","change",function(){return a._updateItems()})])};h.prototype.destroy=function(){this._handles.destroy();this._handles=
null};Object.defineProperty(h.prototype,"compatibilityFunction",{get:function(){return void 0===this._get("compatibilityFunction")?"3d"===this.get("view.type")?p.default3DCompatibility:p.default2DCompatibility:this._get("compatibilityFunction")},set:function(a){this._set("compatibilityFunction",a)},enumerable:!0,configurable:!0});h.prototype.castSource=function(a){return Array.isArray(a)||m.isCollection(a)?new g({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new u({portal:a}):!a||a instanceof
u||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new u(a)};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")&&this.source?"ready":"disabled"},enumerable:!0,configurable:!0});h.prototype.load=function(){this.addResolvingPromise("function"===typeof this.source.load?this.source.load():t.resolve());return this.when()};h.prototype.basemapEquals=function(a,b){return f.contentEquals(a,b)};h.prototype.refresh=function(){this._updateItems()};
h.prototype._updateItems=function(){if("disabled"!==this.state){var a=this.get("source.basemaps"),b=this.view,h=this.compatibilityFunction;this.items.removeAll().forEach(function(a){return a.destroy()});this.items.addMany(a.map(function(a){return new d({basemap:a,compatibilityFunction:h,view:b})}))}};b([a.property({aliasOf:"view.map.basemap"})],h.prototype,"activeBasemap",void 0);b([a.property({dependsOn:["view.type"]})],h.prototype,"compatibilityFunction",null);b([a.property({readOnly:!0,type:v})],
h.prototype,"items",void 0);b([a.property()],h.prototype,"source",void 0);b([a.cast("source")],h.prototype,"castSource",null);b([a.property({readOnly:!0,dependsOn:["view.ready"]})],h.prototype,"state",null);b([a.property()],h.prototype,"view",void 0);return h=b([a.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],h)}(a.declared(k,c))})},"esri/widgets/BasemapGallery/support/basemapCompatibilityUtils":function(){define("require exports ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme".split(" "),
function(q,r,l,b,k,m,n){function c(a){var f=a.basemap,c=a.view;return f.load().then(function(){if(0!==f.baseLayers.length){var a=f.baseLayers.concat(f.referenceLayers),a=t(a);return a.length?k.reject(a[0]):l.typeCast(f.baseLayers.getItemAt(0))().load().then(function(a){return e(a,c)})}}).catch(function(a){var f=a.name,d=a.message;return k.reject(new b(void 0===f?"basemap-compatibility:unknown-error":f,void 0===d?"Unknown basemap compatibility error":d,a.details))})}function t(a){var f=["ArcGISTiledImageServiceLayer",
"ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return a.toArray().filter(function(a){return-1===f.indexOf(a.operationalLayerType)}).map(function(a){return new b("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:a,operationalLayerType:a.operationalLayerType||"unknown"})})}function e(a,f){var c=a.tileInfo;if(c){var d=f.get("viewingMode");if(d){var g;g=c.spatialReference;g=null==g?!1:"global"===d?g.isWebMercator||
g.isWGS84:!g.isGeographic;if(!g)return k.reject(new b("basemapgalleryitem:spatial-reference-unsupported-"+d,"Basemap spatial reference is unsupported in "+d+" mode"));if("global"===d){if((g=m.checkIfTileInfoSupportedForView(c,a.fullExtent,null,d))&&a.compatibleTileInfo256&&!m.checkIfTileInfoSupportedForView(a.compatibleTileInfo256,a.fullExtent,null,d)&&(g=null),g)return k.reject(new b("basemapgalleryitem:tiling-scheme-unsupported-"+(c.spatialReference.isWebMercator?"web-mercator":"wgs84")+"-global",
"Basemap tiling scheme is unsupported in global mode",{error:g}))}else if(n.checkUnsupported(c))return k.reject(new b("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode"));f=f.get("basemapTerrain.tilingScheme");if(!(!f||f.compatibleWith(c)||a.compatibleTileInfo256&&f.compatibleWith(a.compatibleTileInfo256)))return k.reject(new b("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view"))}}}Object.defineProperty(r,
"__esModule",{value:!0});r.default3DCompatibility=function(a){return c(a).then(function(){})};r.default2DCompatibility=function(a){var f=a.basemap,c=a.view;return f.load().then(function(){if(0!==f.baseLayers.length){var a=f.baseLayers.getItemAt(0);return a.load().then(function(){var f=(a.get("supportedSpatialReferences")||[a.get("tileInfo.spatialReference")]).filter(Boolean);if(0!==f.length&&f.every(function(a){return!c.spatialReference.equals(a)}))return k.reject(new b("basemap-compatibility:incompatible-spatial-reference",
"Basemap spatial reference is not compatible with the view"))})}})}})},"esri/widgets/BasemapGallery/support/BasemapGalleryItem":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators".split(" "),function(q,r,l,b,k,m,n,c){return function(k){function e(a){a=k.call(this)||this;a._handles=new m;a.compatibilityFunction=null;a.error=
null;a.state="loading";a.view=null;return a}l(e,k);e.prototype.initialize=function(){var a=this;this._handles.add(n.init(this,["basemap.loadStatus","compatibilityFunction","view.basemapTerrain.tilingScheme","view.ready","view.spatialReference"],function(){return a.refresh()}))};e.prototype.destroy=function(){this._cancelCompatibilityCheck();this._handles.destroy();this.view=this.compatibilityFunction=this.basemap=this._handles=null};Object.defineProperty(e.prototype,"basemap",{set:function(a){var b=
this._get("basemap");b&&b.cancelLoad();a&&a.load();this._set("basemap",a)},enumerable:!0,configurable:!0});e.prototype.refresh=function(){var a=this;this._cancelCompatibilityCheck();this._set("state","loading");var b=this.get("basemap.loadStatus");if("loaded"===b||"failed"===b)if(this.compatibilityFunction){var c=!1,d=this.compatibilityFunction(this).then(function(){c||(a._set("state","ready"),a._set("error",null))}).catch(function(b){c||(a._set("state","error"),a._set("error",b))});this._lastCompatibilityCheck=
{cancel:function(){c=!0;d.cancel()}}}else"loaded"===b?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError))};e.prototype._cancelCompatibilityCheck=function(){this._lastCompatibilityCheck&&(this._lastCompatibilityCheck.cancel(),this._lastCompatibilityCheck=null)};b([c.property()],e.prototype,"basemap",null);b([c.property()],e.prototype,"compatibilityFunction",void 0);b([c.property({readOnly:!0})],e.prototype,"error",void 0);b([c.property({readOnly:!0})],
e.prototype,"state",void 0);b([c.property()],e.prototype,"view",void 0);return e=b([c.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],e)}(c.declared(k))})},"esri/widgets/BasemapGallery/support/LocalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Basemap ../../../core/Accessor ../../../core/Collection ../../../core/accessorSupport/decorators".split(" "),function(q,r,l,b,k,m,n,c){var t=
n.ofType(k);return function(e){function a(a){a=e.call(this)||this;a.basemaps=new t;return a}l(a,e);Object.defineProperty(a.prototype,"state",{get:function(){return"ready"},enumerable:!0,configurable:!0});a.prototype.refresh=function(){};b([c.property({type:t})],a.prototype,"basemaps",void 0);b([c.property({readOnly:!0})],a.prototype,"state",null);return a=b([c.subclass("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],a)}(c.declared(m))})},"esri/widgets/BasemapGallery/support/PortalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Basemap ../../../core/Collection ../../../core/Error ../../../core/Handles ../../../core/Loadable ../../../core/Logger ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../portal/Portal ./LocalBasemapsSource".split(" "),
function(q,r,l,b,k,m,n,c,t,e,a,f,p,d){var g=m.ofType(k),u=e.getLogger("esri.widgets.BasemapGallery.support.PortalBasemapsSource");return function(d){function e(a){a=d.call(this)||this;a._handles=new c;a.basemaps=new g;a.filterFunction=null;a.portal=p.getDefault();a.query=null;a.updateBasemapsCallback=null;return a}l(e,d);e.prototype.initialize=function(){var b=this;this._handles.add([a.init(this,"filterFunction loadStatus portal.basemapGalleryGroupQuery portal.user query updateBasemapsCallback".split(" "),
function(){return b.refresh()})])};e.prototype.destroy=function(){this._handles.destroy();this.portal=this.filterFunction=this._handles=null};Object.defineProperty(e.prototype,"state",{get:function(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetch?"loading":"ready"},enumerable:!0,configurable:!0});e.prototype.load=function(){this.addResolvingPromise(this.portal.load());this.notifyChange("state");return this.when()};e.prototype.refresh=function(){var a=
this;if("ready"===this.state){this._lastPortalBasemapFetch&&(this._lastPortalBasemapFetch.cancel(),this._lastPortalBasemapFetch=null);var b=this.portal,c=!1;this._lastPortalBasemapFetch={cancel:function(){c=!0}};b.fetchBasemaps(this._toQueryString(this.query)).then(function(b){c||a._updateBasemaps(b)}).catch(function(b){c||(u.warn(new n("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:b})),a._updateBasemaps())}).then(function(){c||(a._lastPortalBasemapFetch=null,
a.notifyChange("state"))});this.notifyChange("state")}};e.prototype._toQueryString=function(a){return a&&"string"!==typeof a?Object.keys(a).map(function(b){return b+":"+a[b]}).join(" AND "):a};e.prototype._updateBasemaps=function(a){void 0===a&&(a=[]);a=this.filterFunction?a.filter(this.filterFunction):a;a=this.updateBasemapsCallback?this.updateBasemapsCallback(a):a;this.basemaps.removeAll();this.basemaps.addMany(a)};b([f.property({readOnly:!0,type:g})],e.prototype,"basemaps",void 0);b([f.property()],
e.prototype,"filterFunction",void 0);b([f.property({type:p})],e.prototype,"portal",void 0);b([f.property()],e.prototype,"query",void 0);b([f.property({dependsOn:["loadStatus"],readOnly:!0})],e.prototype,"state",null);b([f.property()],e.prototype,"updateBasemapsCallback",void 0);return e=b([f.subclass("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],e)}(f.declared(d,t))})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css",
"dojo/i18n!./nls/strings"],function(){})},"url:widgets/BasemapGallery/Widget.html":"\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'basemapGalleryNode'\x3e\x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemap-gallery{width: 100%; height: 100%;}.jimu-widget-basemap-gallery .esri-basemap-gallery.esri-widget{width: 100%; height: 100%; max-height: 100%; background-color: transparent;}.jimu-widget-basemap-gallery .esri-basemap-gallery {max-width: none;}","*now":function(q){q(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel"],function(q,r,l,b){return q([r],{name:"BasemapGallery",baseClass:"jimu-widget-basemap-gallery",postCreate:function(){this.inherited(arguments)},startup:function(){this.basemapGallery=new l({container:this.basemapGalleryNode,viewModel:new b({view:this.sceneView})});this.basemapGallery.render()},destroy:function(){this.basemapGallery&&this.basemapGallery.destroy();this.inherited(arguments)}})});