// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/BasemapGallery":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./support/widget ../core/accessorSupport/decorators ../core/watchUtils ./BasemapGallery/BasemapGalleryViewModel ./Widget ../core/HandleRegistry dojo/i18n!./BasemapGallery/nls/BasemapGallery".split(" "),function(r,t,g,c,d,h,p,q,n,a,f){var m=r.toUrl("../themes/base/images/basemap-toggle-64.svg");return function(k){function b(e){e=k.call(this)||this;
e._handleRegistry=new a;e.activeBasemap=null;e.source=null;e.view=null;e.viewModel=new q;return e}g(b,k);b.prototype.postInitialize=function(){var e=this;this.own([p.on(this,"viewModel.items","change",function(b){e._handleRegistry.remove("basemap-gallery-item-changes");e._handleRegistry.add(b.added.map(function(b){return b.watch("state",function(){return e.scheduleRender()})}),"basemap-gallery-item-changes")}),this._handleRegistry])};b.prototype.render=function(){var e="loading"===this.get("source.state"),
b="disabled"===this.get("viewModel.state"),c=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this),b=(a={},a["esri-basemap-gallery--source-loading"]=e,a["esri-disabled"]=b,a),a=e?d.tsx("div",{class:"esri-basemap-gallery_loading-indicator",key:"esri-basemap-gallery_loading-indicator"}):null,e=e?null:0<c.length?d.tsx("ul",{class:"esri-basemap-gallery__item-container",key:"esri-basemap-gallery__item-container",role:"menu"},c):d.tsx("div",{class:"esri-basemap-gallery__empty-message",
key:"esri-basemap-gallery__empty-message"},f.noBasemaps);return d.tsx("div",{class:"esri-basemap-gallery esri-widget esri-widget--panel",classes:b},a,e);var a};b.prototype._handleClick=function(e){e=e.currentTarget["data-item"];"ready"===e.state&&(this.activeBasemap=e.basemap)};b.prototype._renderBasemapGalleryItem=function(e){var b=e.get("basemap.thumbnailUrl")||m,f=e.get("basemap.title"),a=e.get("error.message")||f,c="ready"===e.state?0:-1,k=this.viewModel.basemapEquals(e.basemap,this.activeBasemap),
h=(g={},g["esri-basemap-gallery__item--selected"]=k,g["esri-basemap-gallery__item--loading"]="loading"===e.state,g["esri-basemap-gallery__item--error"]="error"===e.state,g),g="loading"===e.state?d.tsx("div",{class:"esri-basemap-gallery_loading-indicator",key:"esri-basemap-gallery_loading-indicator"}):null;return d.tsx("li",{"aria-selected":k,bind:this,class:"esri-basemap-gallery__item",classes:h,"data-item":e,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:c,title:a},
g,d.tsx("img",{alt:"",class:"esri-basemap-gallery__item-thumbnail",src:b}),d.tsx("div",{class:"esri-basemap-gallery__item-title"},f));var g};c([h.aliasOf("viewModel.activeBasemap"),d.renderable()],b.prototype,"activeBasemap",void 0);c([h.aliasOf("viewModel.source"),d.renderable("source.state")],b.prototype,"source",void 0);c([h.aliasOf("viewModel.view"),d.renderable()],b.prototype,"view",void 0);c([h.property(),d.renderable(["viewModel.state"])],b.prototype,"viewModel",void 0);c([d.accessibleHandler()],
b.prototype,"_handleClick",null);return b=c([h.subclass("esri.widgets.BasemapGallery")],b)}(h.declared(n))})},"esri/widgets/BasemapGallery/BasemapGalleryViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ./support/basemapCompatibilityUtils ../../core/accessorSupport/decorators ../../core/watchUtils ../../support/basemapUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource ../../core/Accessor ../../core/Collection ../../core/HandleRegistry ../../portal/Portal".split(" "),
function(r,t,g,c,d,h,p,q,n,a,f,m,k,b,e){var u=k.ofType(n);return function(m){function l(a){a=m.call(this)||this;a._handles=new b;a.activeBasemap=null;a.items=new u;a.source=new f({portal:e.getDefault()});a.view=null;return a}g(l,m);l.prototype.initialize=function(){var e=this;this._handles.add([p.init(this,["compatibilityFunction","state"],function(){return e._updateItems()}),p.on(this,"source.basemaps","change",function(){return e._updateItems()})])};l.prototype.destroy=function(){this._handles.destroy();
this._handles=null};Object.defineProperty(l.prototype,"compatibilityFunction",{get:function(){return void 0===this._get("compatibilityFunction")?"3d"===this.get("view.type")?d.default3DCompatibility:void 0:this._get("compatibilityFunction")},set:function(e){this._set("compatibilityFunction",e)},enumerable:!0,configurable:!0});l.prototype.castSource=function(b){return Array.isArray(b)||k.isCollection(b)?new a({basemaps:b}):b&&b.isInstanceOf&&b.isInstanceOf(e)?new f({portal:b}):b&&"basemaps"in b&&"state"in
b&&"refresh"in b?b:null};Object.defineProperty(l.prototype,"state",{get:function(){return this.get("view.ready")&&this.source?"ready":"disabled"},enumerable:!0,configurable:!0});l.prototype.basemapEquals=function(b,e){return q.contentEquals(b,e)};l.prototype.refresh=function(){this._updateItems()};l.prototype._updateItems=function(){if("disabled"!==this.state){var b=this.get("source.basemaps"),e=this.view,a=this.compatibilityFunction;this.items.removeAll().forEach(function(b){return b.destroy()});
this.items.addMany(b.map(function(b){return new n({basemap:b,compatibilityFunction:a,view:e})}))}};c([h.property({aliasOf:"view.map.basemap"})],l.prototype,"activeBasemap",void 0);c([h.property({dependsOn:["view.type"]})],l.prototype,"compatibilityFunction",null);c([h.property({readOnly:!0,type:u})],l.prototype,"items",void 0);c([h.property()],l.prototype,"source",void 0);c([h.cast("source")],l.prototype,"castSource",null);c([h.property({readOnly:!0,dependsOn:["view.ready"]})],l.prototype,"state",
null);c([h.property()],l.prototype,"view",void 0);return l=c([h.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],l)}(h.declared(m))})},"esri/widgets/BasemapGallery/support/basemapCompatibilityUtils":function(){define("require exports ../../../core/promiseUtils ../../../views/3d/terrain/terrainUtils ../../../core/Error ../../../views/3d/terrain/TilingScheme".split(" "),function(r,t,g,c,d,h){function p(a){var f=a.basemap,c=a.view;return f.load().then(function(){if(0!==f.baseLayers.length){var a=
f.baseLayers.concat(f.referenceLayers),a=q(a);return a.length?g.reject(a[0]):f.baseLayers.getItemAt(0).load().then(function(b){return n(b,c)})}}).otherwise(function(a){var b=a.name,e=a.message;return g.reject(new d(void 0===b?"basemap-compatibility:unknown-error":b,void 0===e?"Unknown basemap compatibility error":e,a.details))})}function q(a){var f=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return a.toArray().filter(function(a){return-1===
f.indexOf(a.operationalLayerType)}).map(function(a){return new d("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:a,operationalLayerType:a.operationalLayerType||"unknown"})})}function n(a,f){var m=a.tileInfo;if(m){var k=f.get("viewingMode");if(k){var b;b=m.spatialReference;b=null==b?!1:"global"===k?b.isWebMercator||b.isWGS84:!b.isGeographic;if(!b)return g.reject(new d("basemapgalleryitem:spatial-reference-unsupported-"+k,"Basemap spatial reference is unsupported in "+
k+" mode"));if("global"===k){if((b=c.checkIfTileInfoSupportedForView(m,a.fullExtent,null,k))&&a.compatibleTileInfo256&&!c.checkIfTileInfoSupportedForView(a.compatibleTileInfo256,a.fullExtent,null,k)&&(b=null),b)return g.reject(new d("basemapgalleryitem:tiling-scheme-unsupported-"+(m.spatialReference.isWebMercator?"web-mercator":"wgs84")+"-global","Basemap tiling scheme is unsupported in global mode",{error:b}))}else if(h.checkUnsupported(m))return g.reject(new d("basemapgalleryitem:tiling-scheme-unsupported-local",
"Basemap tiling scheme is unsupported in local mode"));f=f.get("basemapTerrain.tilingScheme");if(!(!f||f.compatibleWith(m)||a.compatibleTileInfo256&&f.compatibleWith(a.compatibleTileInfo256)))return g.reject(new d("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view"))}}}Object.defineProperty(t,"__esModule",{value:!0});t.default3DCompatibility=function(a){return p(a).then(function(){})}})},"esri/widgets/BasemapGallery/support/BasemapGalleryItem":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/watchUtils ../../../core/Accessor ../../../core/HandleRegistry".split(" "),
function(r,t,g,c,d,h,p,q){return function(n){function a(){var a=null!==n&&n.apply(this,arguments)||this;a._handles=new q;a.compatibilityFunction=null;a.error=null;a.state="loading";a.view=null;return a}g(a,n);a.prototype.initialize=function(){var a=this;this._handles.add(h.init(this,["basemap.loadStatus","compatibilityFunction","view.basemapTerrain.tilingScheme","view.ready","view.spatialReference"],function(){return a.refresh()}))};a.prototype.destroy=function(){this._cancelCompatibilityCheck();
this._handles.destroy();this.view=this.compatibilityFunction=this.basemap=this._handles=null};Object.defineProperty(a.prototype,"basemap",{set:function(a){var c=this._get("basemap");c&&c.cancelLoad();a&&a.load();this._set("basemap",a)},enumerable:!0,configurable:!0});a.prototype.refresh=function(){var a=this;this._cancelCompatibilityCheck();this._set("state","loading");var c=this.get("basemap.loadStatus");if("loaded"===c||"failed"===c)if(this.compatibilityFunction){var d=!1,b=this.compatibilityFunction(this).then(function(){d||
(a._set("state","ready"),a._set("error",null))}).otherwise(function(b){d||(a._set("state","error"),a._set("error",b))});this._lastCompatibilityCheck={cancel:function(){d=!0;b.cancel()}}}else"loaded"===c?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError))};a.prototype._cancelCompatibilityCheck=function(){this._lastCompatibilityCheck&&(this._lastCompatibilityCheck.cancel(),this._lastCompatibilityCheck=null)};c([d.property()],a.prototype,
"basemap",null);c([d.property()],a.prototype,"compatibilityFunction",void 0);c([d.property({readOnly:!0})],a.prototype,"error",void 0);c([d.property({readOnly:!0})],a.prototype,"state",void 0);c([d.property()],a.prototype,"view",void 0);return a=c([d.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],a)}(d.declared(p))})},"esri/widgets/BasemapGallery/support/LocalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../Basemap ../../../core/Accessor ../../../core/Collection".split(" "),
function(r,t,g,c,d,h,p,q){var n=q.ofType(h);return function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c.basemaps=new n;c.state="ready";return c}g(f,a);f.prototype.refresh=function(){};c([d.property({type:n})],f.prototype,"basemaps",void 0);c([d.property({readOnly:!0})],f.prototype,"state",void 0);return f=c([d.subclass("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],f)}(d.declared(p))})},"esri/widgets/BasemapGallery/support/PortalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/watchUtils ./LocalBasemapsSource ../../../Basemap ../../../core/Collection ../../../core/HandleRegistry ../../../portal/Portal".split(" "),
function(r,t,g,c,d,h,p,q,n,a,f){var m=n.ofType(q);return function(k){function b(){var b=null!==k&&k.apply(this,arguments)||this;b._handles=new a;b.basemaps=new m;b.filterFunction=null;b.portal=null;b.query=null;return b}g(b,k);b.prototype.initialize=function(){var a=this;this._handles.add([h.init(this,["filterFunction","portal.basemapGalleryGroupQuery","portal.user","query"],function(){return a.refresh()})])};b.prototype.destroy=function(){this._handles.destroy();this.portal=this.filterFunction=this._handles=
null};Object.defineProperty(b.prototype,"state",{get:function(){return this._get("state")},enumerable:!0,configurable:!0});b.prototype.refresh=function(){var a=this;this._set("state","loading");this._lastPortalBasemapFetch&&(this._lastPortalBasemapFetch.cancel(),this._lastPortalBasemapFetch=null);var b=this.portal;if(b){var c=!1;this._lastPortalBasemapFetch={cancel:function(){c=!0}};b.load().then(function(){if(!c)return b.fetchBasemaps(a._toQueryString(a.query))}).then(function(b){c||(b=a.filterFunction?
b.filter(a.filterFunction):b,a.basemaps.removeAll(),a.basemaps.addMany(b))}).otherwise(function(){c||a.basemaps.removeAll()}).then(function(){c||a._set("state","ready")})}else this.basemaps.removeAll(),this._set("state","ready")};b.prototype._toQueryString=function(a){return a&&"string"!==typeof a?Object.keys(a).map(function(b){return b+":"+a[b]}).join(" AND "):a};c([d.property({readOnly:!0,type:m})],b.prototype,"basemaps",void 0);c([d.property()],b.prototype,"filterFunction",void 0);c([d.property({type:f})],
b.prototype,"portal",void 0);c([d.property()],b.prototype,"query",void 0);c([d.property({readOnly:!0,value:"loading"})],b.prototype,"state",null);return b=c([d.subclass("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],b)}(d.declared(p))})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/BasemapGallery/Widget.html":"\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'basemapGalleryNode'\x3e\x3c/div\x3e\r\n\x3c/div\x3e",
"url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemap-gallery{width: 100%; height: 100%;}.jimu-widget-basemap-gallery .esri-basemap-gallery.esri-widget{width: 100%; height: 100%; max-height: 100%; background-color: transparent;}","*now":function(r){r(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel"],function(r,t,g,c){return r([t],{name:"BasemapGallery",baseClass:"jimu-widget-basemap-gallery",postCreate:function(){this.inherited(arguments)},startup:function(){this.basemapGallery=new g({container:this.basemapGalleryNode,viewModel:new c({view:this.sceneView})});this.basemapGallery.render()},destroy:function(){this.basemapGallery&&this.basemapGallery.destroy();this.inherited(arguments)}})});