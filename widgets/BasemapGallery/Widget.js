// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/BasemapGallery":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./BasemapGallery/nls/BasemapGallery ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./BasemapGallery/BasemapGalleryViewModel ./support/widget".split(" "),function(t,u,m,a,l,n,p,e,q,k,b){var d=t.toUrl("../themes/base/images/basemap-toggle-64.svg");return function(c){function g(f){f=c.call(this)||this;f._handles=
new n;f.activeBasemap=null;f.iconClass="esri-icon-basemap";f.label=l.widgetLabel;f.source=null;f.view=null;f.viewModel=new k;return f}m(g,c);g.prototype.postInitialize=function(){var f=this,a=this._handles;this.own([p.on(this,"viewModel.items","change",function(b){var c=b.added;b=b.moved;a.remove("basemap-gallery-item-changes");a.add(c.concat(b).map(function(b){return b.watch("state",function(){return f.scheduleRender()})}),"basemap-gallery-item-changes");f.scheduleRender()}),a,p.whenOnce(this,"source",
function(){return f.viewModel.load()})])};g.prototype.render=function(){var f,a="loading"===this.get("source.state"),c="disabled"===this.get("viewModel.state"),d=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this),c=(f={},f["esri-basemap-gallery--source-loading"]=a,f["esri-disabled"]=c,f);f=a?b.tsx("div",{class:"esri-basemap-gallery__loader",key:"esri-basemap-gallery__loader"}):null;a=a?null:0<d.length?b.tsx("ul",{class:"esri-basemap-gallery__item-container",key:"esri-basemap-gallery__item-container",
role:"menu"},d):b.tsx("div",{class:"esri-widget__content--empty",key:"esri-basemap-gallery__empty-message"},b.tsx("h2",{class:"esri-widget__heading"},l.noBasemaps));return b.tsx("div",{class:this.classes("esri-basemap-gallery esri-widget esri-widget--panel-height-only",c)},f,a)};g.prototype._handleClick=function(a){a=a.currentTarget["data-item"];"ready"===a.state&&(this.activeBasemap=a.basemap)};g.prototype._renderBasemapGalleryItem=function(a){var c,f=a.get("basemap.thumbnailUrl")||d,g=a.get("basemap.title"),
h=a.get("basemap.portalItem.snippet"),h=a.get("error.message")||h||g,w="ready"===a.state?0:-1,e=this.viewModel.basemapEquals(a.basemap,this.activeBasemap),k=(c={},c["esri-basemap-gallery__item--selected"]=e,c["esri-basemap-gallery__item--loading"]="loading"===a.state,c["esri-basemap-gallery__item--error"]="error"===a.state,c);return b.tsx("li",{"aria-selected":e,bind:this,class:this.classes("esri-basemap-gallery__item",k),"data-item":a,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",
tabIndex:w,title:h},b.tsx("img",{alt:"",class:"esri-basemap-gallery__item-thumbnail",src:f}),b.tsx("div",{class:"esri-basemap-gallery__item-title"},g))};a([e.aliasOf("viewModel.activeBasemap"),b.renderable()],g.prototype,"activeBasemap",void 0);a([e.property()],g.prototype,"iconClass",void 0);a([e.property()],g.prototype,"label",void 0);a([e.aliasOf("viewModel.source"),b.renderable("source.state")],g.prototype,"source",void 0);a([e.aliasOf("viewModel.view"),b.renderable()],g.prototype,"view",void 0);
a([e.property(),b.renderable(["viewModel.state"])],g.prototype,"viewModel",void 0);a([b.accessibleHandler()],g.prototype,"_handleClick",null);return g=a([e.subclass("esri.widgets.BasemapGallery")],g)}(e.declared(q))})},"esri/widgets/BasemapGallery/BasemapGalleryViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/Handles ../../core/Loadable ../../core/Loadable ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(t,u,m,a,l,n,p,e,q,k,b,d,c,g,f,v){var r=l.ofType(g);return function(e){function h(a){a=e.call(this)||this;a._handles=new n;a.activeBasemap=null;a.items=new r;a.source=new v;a.view=null;return a}m(h,e);h.prototype.initialize=function(){var a=this;this._handles.add([k.init(this,["compatibilityFunction","state"],function(){return a._updateItems()}),k.on(this,"source.basemaps","change",function(){return a._updateItems()})])};h.prototype.destroy=function(){this._handles.destroy();this._handles=
null};Object.defineProperty(h.prototype,"compatibilityFunction",{get:function(){return void 0===this._get("compatibilityFunction")?"3d"===this.get("view.type")?c.default3DCompatibility:c.default2DCompatibility:this._get("compatibilityFunction")},set:function(a){this._set("compatibilityFunction",a)},enumerable:!0,configurable:!0});h.prototype.castSource=function(a){return Array.isArray(a)||l.isCollection(a)?new f({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new v({portal:a}):!a||a instanceof
v||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new v(a)};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")&&this.source?"ready":"disabled"},enumerable:!0,configurable:!0});h.prototype.basemapEquals=function(a,b){return d.contentEquals(a,b)};h.prototype.refresh=function(){this._updateItems()};h.prototype.load=function(a){this.addResolvingPromise(p.isLoadable(this.source)?this.source.load(a):q.resolve());return this.when()};h.prototype._updateItems=
function(){if("disabled"!==this.state){var a=this.get("source.basemaps"),b=this.view,c=this.compatibilityFunction;this.items.removeAll().forEach(function(a){return a.destroy()});this.items.addMany(a.map(function(a){return new g({basemap:a,compatibilityFunction:c,view:b})}))}};a([b.property({aliasOf:"view.map.basemap"})],h.prototype,"activeBasemap",void 0);a([b.property({dependsOn:["view.type"]})],h.prototype,"compatibilityFunction",null);a([b.property({readOnly:!0,type:r})],h.prototype,"items",void 0);
a([b.property()],h.prototype,"source",void 0);a([b.cast("source")],h.prototype,"castSource",null);a([b.property({readOnly:!0,dependsOn:["view.ready"]})],h.prototype,"state",null);a([b.property()],h.prototype,"view",void 0);return h=a([b.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],h)}(b.declared(e))})},"esri/widgets/BasemapGallery/support/basemapCompatibilityUtils":function(){define("require exports ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),
function(t,u,m,a,l,n,p,e){function q(b,d){var c=b.basemap,g=b.view;return c.load(d).then(function(){if(0!==c.baseLayers.length){var b=c.baseLayers.concat(c.referenceLayers),b=k(b);if(b.length)throw b[0];return m.typeCast(c.baseLayers.getItemAt(0))().load(d).then(function(b){var c=b.tileInfo;if(c){var d=g.get("viewingMode");if(d){if(!e.isSpatialReferenceSupported(c.spatialReference,d))throw new a("basemapgalleryitem:spatial-reference-unsupported-"+d,"Basemap spatial reference is unsupported in "+d+
" mode");if("global"===d){var f=n.checkIfTileInfoSupportedForView(c,b.fullExtent,null,d);f&&b.compatibleTileInfo256&&!n.checkIfTileInfoSupportedForView(b.compatibleTileInfo256,b.fullExtent,null,d)&&(f=null);if(f)throw new a("basemapgalleryitem:tiling-scheme-unsupported-"+(c.spatialReference.isWebMercator?"web-mercator":"wgs84")+"-global","Basemap tiling scheme is unsupported in global mode",{error:f});}else if(p.checkUnsupported(c))throw new a("basemapgalleryitem:tiling-scheme-unsupported-local",
"Basemap tiling scheme is unsupported in local mode");d=g.get("basemapTerrain.tilingScheme");if(!(!d||d.compatibleWith(c)||b.compatibleTileInfo256&&d.compatibleWith(b.compatibleTileInfo256)))throw new a("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");}}})}}).catch(function(b){var c=b.name,d=b.message;throw new a(void 0===c?"basemap-compatibility:unknown-error":c,void 0===d?"Unknown basemap compatibility error":d,b.details);})}function k(b){var d=
["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return b.toArray().filter(function(a){return-1===d.indexOf(a.operationalLayerType)}).map(function(b){return new a("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:b,operationalLayerType:b.operationalLayerType||"unknown"})})}Object.defineProperty(u,"__esModule",{value:!0});u.default3DCompatibility=function(a,d){void 0===
d&&(d={});return q(a,d).then(function(){return l.throwIfAborted(d)})};u.default2DCompatibility=function(b,d){void 0===d&&(d={});var c=b.basemap,g=b.view;return c.load(d).then(function(){l.throwIfAborted(d);if(0!==c.baseLayers.length){var b=c.baseLayers.getItemAt(0);return b.load(d).then(function(){l.throwIfAborted(d);var c=(b.get("supportedSpatialReferences")||[b.get("tileInfo.spatialReference")]).filter(Boolean);if(0!==c.length&&c.every(function(a){return!g.spatialReference.equals(a)}))return l.reject(new a("basemap-compatibility:incompatible-spatial-reference",
"Basemap spatial reference is not compatible with the view"))})}})}})},"esri/widgets/BasemapGallery/support/BasemapGalleryItem":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper @dojo/framework/shim/AbortController ../../../core/Accessor ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators".split(" "),function(t,u,m,a,l,n,p,e,q,k){return function(b){function d(a){a=b.call(this)||
this;a._handles=new p;a.compatibilityFunction=null;a.error=null;a.state="loading";a.view=null;return a}m(d,b);d.prototype.initialize=function(){var a=this;this._handles.add(q.init(this,["basemap.loadStatus","compatibilityFunction","view.basemapTerrain?.tilingScheme","view.ready","view.spatialReference"],function(){return a.refresh()}))};d.prototype.destroy=function(){this._cancelCompatibilityCheck();this._handles.destroy();this.view=this.compatibilityFunction=this.basemap=this._handles=null};Object.defineProperty(d.prototype,
"basemap",{set:function(a){var b=this._get("basemap");b&&b.cancelLoad();a&&a.load();this._set("basemap",a)},enumerable:!0,configurable:!0});d.prototype.refresh=function(){var a=this;this._cancelCompatibilityCheck();this._set("state","loading");var b=this.get("basemap.loadStatus");if("loaded"===b||"failed"===b)this.compatibilityFunction?(b=new l.default,this.compatibilityFunction(this,{signal:b.signal}).then(function(){a._set("state","ready");a._set("error",null)}).catch(function(b){e.isAbortError(b)||
(a._set("state","error"),a._set("error",b))}),this._lastCompatibilityCheckController=b):"loaded"===b?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError))};d.prototype._cancelCompatibilityCheck=function(){this._lastCompatibilityCheckController&&(this._lastCompatibilityCheckController.abort(),this._lastCompatibilityCheckController=null)};a([k.property()],d.prototype,"basemap",null);a([k.property()],d.prototype,"compatibilityFunction",
void 0);a([k.property({readOnly:!0})],d.prototype,"error",void 0);a([k.property({readOnly:!0})],d.prototype,"state",void 0);a([k.property()],d.prototype,"view",void 0);return d=a([k.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],d)}(k.declared(n))})},"esri/widgets/BasemapGallery/support/LocalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Basemap ../../../core/Accessor ../../../core/Collection ../../../core/accessorSupport/decorators".split(" "),
function(t,u,m,a,l,n,p,e){var q=p.ofType(l);return function(k){function b(a){a=k.call(this)||this;a.basemaps=new q;return a}m(b,k);Object.defineProperty(b.prototype,"state",{get:function(){return"ready"},enumerable:!0,configurable:!0});b.prototype.refresh=function(){};a([e.property({type:q})],b.prototype,"basemaps",void 0);a([e.property({readOnly:!0})],b.prototype,"state",null);return b=a([e.subclass("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],b)}(e.declared(n))})},"esri/widgets/BasemapGallery/support/PortalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/AbortController ../../../Basemap ../../../core/Collection ../../../core/Error ../../../core/Handles ../../../core/Loadable ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../portal/Portal ./LocalBasemapsSource".split(" "),
function(t,u,m,a,l,n,p,e,q,k,b,d,c,g,f,v,r,x,h){var w=q.ofType(e),y=c.getLogger("esri.widgets.BasemapGallery.support.PortalBasemapsSource");return function(d){function c(a){a=d.call(this)||this;a._handles=new b;a.basemaps=new w;a.filterFunction=null;a.portal=x.getDefault();a.query=null;a.updateBasemapsCallback=null;return a}m(c,d);c.prototype.initialize=function(){var a=this;this._handles.add([v.init(this,"filterFunction loadStatus portal.basemapGalleryGroupQuery portal.user query updateBasemapsCallback".split(" "),
function(){return a.refresh()})])};c.prototype.destroy=function(){this._handles.destroy();this.portal=this.filterFunction=this._handles=null};Object.defineProperty(c.prototype,"state",{get:function(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"},enumerable:!0,configurable:!0});c.prototype.load=function(a){this.addResolvingPromise(this.portal.load(a));this.notifyChange("state");return this.when()};c.prototype.refresh=
function(){return n(this,void 0,void 0,function(){var a,b,c,d;return l(this,function(e){switch(e.label){case 0:if("ready"!==this.state)return[2];this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);a=this.portal;this._lastPortalBasemapFetchController=b=new p.default;this.notifyChange("state");e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.fetchBasemaps(this._toQueryString(this.query),b)];case 2:return c=e.sent(),this._updateBasemaps(c),
[3,4];case 3:d=e.sent();if(f.isAbortError(d))throw d;y.warn(new k("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:d}));this._updateBasemaps();return[3,4];case 4:return this._lastPortalBasemapFetchController=null,this.notifyChange("state"),[2]}})})};c.prototype._toQueryString=function(a){return a&&"string"!==typeof a?Object.keys(a).map(function(b){return b+":"+a[b]}).join(" AND "):a};c.prototype._updateBasemaps=function(a){void 0===a&&(a=[]);a=this.filterFunction?
a.filter(this.filterFunction):a;a=this.updateBasemapsCallback?this.updateBasemapsCallback(a):a;this.basemaps.removeAll();this.basemaps.addMany(a)};a([r.property({readOnly:!0,type:w})],c.prototype,"basemaps",void 0);a([r.property()],c.prototype,"filterFunction",void 0);a([r.property({type:x})],c.prototype,"portal",void 0);a([r.property()],c.prototype,"query",void 0);a([r.property({dependsOn:["loadStatus"],readOnly:!0})],c.prototype,"state",null);a([r.property()],c.prototype,"updateBasemapsCallback",
void 0);return c=a([r.subclass("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],c)}(r.declared(d.LoadableMixin(g.EsriPromiseMixin(h))))})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/BasemapGallery/Widget.html":"\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'basemapGalleryNode'\x3e\x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemap-gallery{width: 100%; height: 100%;}.jimu-widget-basemap-gallery .esri-basemap-gallery.esri-widget{width: 100%; height: 100%; max-height: 100%; background-color: transparent;}.jimu-widget-basemap-gallery .esri-basemap-gallery {max-width: none;}",
"*now":function(t){t(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel"],function(t,u,m,a){return t([u],{name:"BasemapGallery",baseClass:"jimu-widget-basemap-gallery",postCreate:function(){this.inherited(arguments)},startup:function(){this.basemapGallery=new m({container:this.basemapGalleryNode,viewModel:new a({view:this.sceneView})});this.basemapGallery.render()},destroy:function(){this.basemapGallery&&this.basemapGallery.destroy();this.inherited(arguments)}})});