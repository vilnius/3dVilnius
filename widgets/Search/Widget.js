// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Search":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper @dojo/framework/shim/array dojo/i18n!../nls/common dojo/i18n!./Search/nls/Search dojo/keys dojo/regexp ../core/Handles ../core/lang ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Search/SearchResultRenderer ./Search/SearchViewModel ./support/widget".split(" "),function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u){var w=/<[a-z/][\s\S]*>/i;return function(k){function n(a){var c=
k.call(this)||this;c._handles=new q;c._inputNode=null;c._sourceMenuButtonNode=null;c._sourceListNode=null;c._suggestionListNode=null;c._searchResultRenderer=new v({container:document.createElement("div")});c._suggestPromise=null;c._relatedTarget=null;c.activeMenu="none";c.activeSource=null;c.activeSourceIndex=null;c.allPlaceholder=null;c.allSources=null;c.autoNavigate=null;c.autoSelect=null;c.defaultSources=null;c.goToOverride=null;c.iconClass="esri-icon-search";c.includeDefaultSources=null;c.label=
f.widgetLabel;c.locationEnabled=null;c.locationToAddressDistance=null;c.maxResults=null;c.maxSuggestions=null;c.minSuggestCharacters=null;c.popupEnabled=null;c.popupTemplate=null;c.portal=null;c.resultGraphic=null;c.resultGraphicEnabled=null;c.results=null;c.searchAllEnabled=null;c.searchTerm=null;c.selectedResult=null;c.sources=null;c.suggestions=null;c.suggestionsEnabled=null;c.view=null;c.viewModel=new t;c.own(b.watch(c,"searchTerm",function(a){if(a&&"warning"===c.activeMenu||!a&&!c.get("viewModel.selectedSuggestion.location"))c.activeMenu=
"none"}),b.on(c,"viewModel.allSources","change",function(){return c._watchSourceChanges()}),b.init(c,["viewModel.popupTemplate","viewModel.popupTemplate.content"],function(){"{Match_addr}"===c.get("viewModel.popupTemplate.content")&&(c.viewModel.popupTemplate.content=c._renderSearchResultsContent.bind(c))}));return c}p(n,k);n.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._cancelSuggest();this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),
this._searchResultRenderer=null)};n.prototype.clear=function(){};n.prototype.focus=function(){this._inputNode&&(this.activeMenu="suggestion",this._inputNode.focus(),this.emit("search-focus"))};n.prototype.blur=function(a){this._inputNode&&(this._inputNode.blur(),this._inputBlur(a),this.emit("search-blur"))};n.prototype.search=function(a){var b=this;this.activeMenu="none";this._cancelSuggest();return this.viewModel.search(a).catch(function(a){b.activeMenu="none";return a}).then(function(a){b.activeMenu=
a.numResults?"none":"warning";return a})};n.prototype.suggest=function(a){var b=this;this._cancelSuggest();return this._suggestPromise=a=this.viewModel.suggest(a).then(function(a){a.numResults&&(b.activeMenu="suggestion");b._scrollToTopSuggestion();return a}).catch(function(){return null})};n.prototype.render=function(){var a=this,b,d,k=this.viewModel,g=k.activeSourceIndex,e=k.suggestions,q=k.maxInputLength,v=k.placeholder,n=k.searchTerm,h=k.searchAllEnabled,w=k.allSources,p=this._getSourceName(g),
A=(""+n).trim(),l=this.activeMenu,r=this.id,F=this.viewModel.state,D=this.id+"-suggest-menu",q=u.tsx("input",{bind:this,placeholder:v,"aria-label":f.searchButtonTitle,maxlength:q,autocomplete:"off",type:"text",tabindex:"0",class:this.classes("esri-input","esri-search__input"),"aria-autocomplete":"list",value:n,"aria-haspopup":"true","aria-owns":D,role:"textbox",onkeydown:this._handleInputKeydown,onkeyup:this._handleInputKeyup,onclick:this._handleInputClick,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,
afterCreate:u.storeNode,"data-node-ref":"_inputNode",onfocusout:this._storeRelatedTarget,onfocus:this.focus,onblur:this.blur,title:n?"":v}),q=u.tsx("form",{key:"esri-search__form",bind:this,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},q),v=n?u.tsx("div",{key:"esri-search__clear-button",bind:this,role:"button",class:this.classes("esri-search__clear-button","esri-widget--button"),tabindex:"0",title:f.clearButtonTitle,onfocus:this._clearButtonFocus,onclick:this._handleClearButtonClick,
onkeydown:this._handleClearButtonClick},u.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})):null,H=this.locationEnabled&&!A?u.tsx("ul",{key:"esri-search__suggestion-list-current-location",class:this.classes("esri-search__suggestions-list","esri-search__suggestions-list--current-location")},u.tsx("li",{bind:this,onclick:this._handleUseCurrentLocationClick,onkeydown:this._handleUseCurrentLocationClick,onkeyup:this._handleSuggestionKeyup,role:"menuitem",tabindex:"-1"},u.tsx("span",{"aria-hidden":"true",
role:"presentation",class:"esri-icon-locate-circled"})," ",f.useCurrentLocation)):null,M=1<w.length&&g===t.ALL_INDEX,g=e?e.map(function(b,c){var d=b.sourceIndex,k=b.results.length;c=k&&M?a._getSuggestionHeaderNode(d):null;b=b.results.map(function(b,c){return a._getSuggestionNode(b,c,d)});b=k?u.tsx("ul",{key:"esri-search__suggestion-list-"+d,class:"esri-search__suggestions-list"},b):null;return[c,b]}):null,D=u.tsx("div",{id:D,"aria-expanded":"suggestion"===l,key:"esri-search__suggestions-menu",class:this.classes("esri-menu",
"esri-search__suggestions-menu"),role:"menu",bind:this,afterCreate:u.storeNode,"data-node-ref":"_suggestionListNode"},H,g),D=u.tsx("div",{key:"esri-search__input-container",class:"esri-search__input-container"},q,D,v),g=u.tsx("div",{key:"esri-search__submit-button",bind:this,role:"button",title:f.searchButtonTitle,class:this.classes("esri-search__submit-button","esri-widget--button"),tabindex:"0",onclick:this._handleSearchButtonClick,onkeydown:this._handleSearchButtonClick},u.tsx("span",{"aria-hidden":"true",
role:"presentation",class:"esri-icon-search"}),u.tsx("span",{class:"esri-icon-font-fallback-text"},f.searchButtonTitle)),n=A?c.substitute({value:'"'+n+'"'},f.noResultsFoundForValue):f.noResultsFound,n=k.get("selectedSuggestion.location")||A?u.tsx("div",{key:"esri-search__no_results"},u.tsx("div",{class:"esri-search__warning-header"},f.noResults),u.tsx("div",{class:"esri-search__warning-text"},n)):null,k=k.get("selectedSuggestion.location")||A?null:u.tsx("div",{key:"esri-search__empty-search"},u.tsx("span",
{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),u.tsx("span",{class:"esri-search__no-value-text"},f.emptyValue)),k=u.tsx("div",{key:"esri-search__error-menu",class:this.classes("esri-menu","esri-search__warning-menu")},u.tsx("div",{class:"esri-search__warning-body"},n,k)),A=1<w.length,w=w&&w.toArray(),h=h?this._getSourceNode(t.ALL_INDEX):null,r=r+"-source-menu",p=A?u.tsx("div",{key:"esri-search__source-menu-button",bind:this,role:"button",title:f.searchIn,"aria-haspopup":"true","aria-expanded":"source"===
l,"aria-controls":r,class:this.classes("esri-search__sources-button","esri-widget--button"),tabindex:"0",onkeydown:this._handleSourceMenuButtonKeydown,onclick:this._handleSourcesMenuToggleClick,onkeyup:this._handleSourceMenuButtonKeyup,onblur:this._sourcesButtonBlur,afterCreate:u.storeNode,"data-node-ref":"_sourceMenuButtonNode"},u.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-down-arrow esri-search__sources-button--down"}),u.tsx("span",{"aria-hidden":"true",role:"presentation",
class:"esri-icon-up-arrow esri-search__sources-button--up"}),u.tsx("span",{class:"esri-search__source-name"},p)):null,h=A?u.tsx("ul",{bind:this,afterCreate:u.storeNode,"data-node-ref":"_sourceListNode"},h,w.map(function(b,c){return a._getSourceNode(c)})):null,r=u.tsx("div",{id:r,key:"esri-search__source-menu",class:this.classes("esri-menu","esri-search__sources-menu"),role:"menu"},h),l=(b={},b["esri-search--multiple-sources"]=A,b["esri-search--loading"]="loading"===F,b["esri-search--searching"]="searching"===
F,b["esri-search--warning"]="warning"===l,b["esri-search--sources"]="source"===l,b["esri-search--show-suggestions"]="suggestion"===l,b);b=(d={},d["esri-disabled"]="disabled"===F,d);d="loading"===F?u.tsx("div",{role:"presentation",class:"esri-widget__loader",key:"base-loader"},u.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-widget__loader-animation"}),u.tsx("span",{class:"esri-icon-font-fallback-text"},f.searchButtonTitle),u.tsx("span",{class:"esri-widget__loader-text"},m.loading)):
u.tsx("div",{role:"presentation",class:this.classes(l,"esri-search__container"),key:"base-container"},p,r,D,g,k);return u.tsx("div",{class:this.classes("esri-search esri-widget",b)},d)};n.prototype._watchSourceChanges=function(){var a=this,c=this._handles,d=this.viewModel.allSources;c.remove("sources");d.forEach(function(d){return c.add(b.watch(d,"name",function(){return a.scheduleRender()}),"sources")})};n.prototype._handleSourceMenuButtonKeydown=function(b){var a=b.keyCode;a===d.UP_ARROW||a===d.DOWN_ARROW||
a===d.END||a===d.HOME?(b.preventDefault(),b.stopPropagation(),this.activeMenu="source"):this._handleSourcesMenuToggleClick(b)};n.prototype._handleSourcesMenuToggleClick=function(b){var a="source"===this.activeMenu;this.activeMenu=a?"none":"source";this.renderNow();a?this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus():(a=this._sourceListNode?this._sourceListNode.getElementsByTagName("li"):null)&&(b=b.keyCode===d.END?a[a.length-1]:a[0])&&b.focus()};n.prototype._handleClearButtonClick=function(){this.viewModel.clear();
this._focus()};n.prototype._handleSearchButtonClick=function(){this.search()};n.prototype._handleSuggestionClick=function(a){if(a=a.currentTarget["data-suggestion"])this._focus(),this.search(a)};n.prototype._handleUseCurrentLocationClick=function(){this._focus("none");this.viewModel.searchNearby()};n.prototype._handleSourceClick=function(a){this.viewModel.activeSourceIndex=a.currentTarget["data-source-index"];this._focus("none")};n.prototype._sourcesButtonBlur=function(a){this._removeActiveMenu(a&&
a.relatedTarget,this._sourceListNode)};n.prototype._inputBlur=function(a){a=a&&a.relatedTarget;this._removeActiveMenu(a?a:this._relatedTarget,this._suggestionListNode)};n.prototype._storeRelatedTarget=function(a){this._relatedTarget=a.relatedTarget};n.prototype._clearButtonFocus=function(){this.activeMenu="none"};n.prototype._removeActiveMenu=function(a,b){a&&b&&b.contains(a)||(this.activeMenu="none")};n.prototype._cancelSuggest=function(){var a=this._suggestPromise;a&&a.cancel();this._suggestPromise=
null};n.prototype._handleInputKeydown=function(a){var b=a.keyCode;(b===d.TAB||b===d.ESCAPE||a.shiftKey&&b===d.TAB)&&this._cancelSuggest()};n.prototype._handleInputKeyup=function(a){var b=a.keyCode,c=a.ctrlKey||a.metaKey||b===d.copyKey||b===d.LEFT_ARROW||b===d.RIGHT_ARROW||b===d.ENTER||b===d.SHIFT,k=this._suggestionListNode?this._suggestionListNode.getElementsByTagName("li"):null;c||(b===d.TAB||b===d.ESCAPE||a.shiftKey&&b===d.TAB?(this._cancelSuggest(),b===d.ESCAPE&&(this.activeMenu="none")):b!==d.UP_ARROW&&
b!==d.DOWN_ARROW||!k?this.viewModel.searchTerm&&this.suggest():(this.activeMenu="suggestion",a.stopPropagation(),a.preventDefault(),this._cancelSuggest(),(a=k[b===d.UP_ARROW?k.length-1:0])&&a.focus()))};n.prototype._scrollToTopSuggestion=function(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)};n.prototype._handleInputClick=function(a){this.activeMenu="suggestion"};n.prototype._handleInputPaste=function(a){var b=this.get("viewModel.searchTerm");a=a.target;b!==a.value&&(this.viewModel.searchTerm=
a.value);b&&this.suggest()};n.prototype._handleSourceMenuButtonKeyup=function(a){var b=a.keyCode;if(b===d.UP_ARROW||b===d.DOWN_ARROW||b===d.HOME||b===d.END)a.stopPropagation(),a.preventDefault(),(a=this._sourceListNode?this._sourceListNode.getElementsByTagName("li"):null)&&(b=a[b===d.UP_ARROW||b===d.END?a.length-1:0])&&b.focus()};n.prototype._handleSourceKeyup=function(a){var b=a.target,c=this._sourceListNode?h.from(this._sourceListNode.getElementsByTagName("li")):null,k=a.keyCode;if(k===d.ESCAPE)this._focus("none"),
this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus();else if(c){b=c.indexOf(b);if(k===d.HOME||k===d.END||k===d.UP_ARROW||k===d.DOWN_ARROW)a.stopPropagation(),a.preventDefault();k===d.HOME?(c=c[0])&&c.focus():k===d.END?(c=c[c.length-1])&&c.focus():k===d.UP_ARROW?(a=b-1,(c=0>a?this._sourceMenuButtonNode:c[a])&&c.focus()):k===d.DOWN_ARROW&&(a=b+1,(c=a>=c.length?this._sourceMenuButtonNode:c[a])&&c.focus())}};n.prototype._handleSuggestionKeyup=function(a){var b=a.target,c=this._suggestionListNode?
h.from(this._suggestionListNode.getElementsByTagName("li")):null,b=c.indexOf(b),k=a.keyCode;this._cancelSuggest();if(k===d.BACKSPACE||k===d.DELETE)this._focus();else if(k===d.ESCAPE)this._focus("none");else if(c){if(k===d.HOME||k===d.END||k===d.UP_ARROW||k===d.DOWN_ARROW)a.stopPropagation(),a.preventDefault();k===d.HOME&&(a=c[0])&&a.focus();k===d.END&&(a=c[c.length-1])&&a.focus();k===d.UP_ARROW?(--b,(c=0>b?c[c.length-1]:c[b])&&c.focus()):k===d.DOWN_ARROW&&(b+=1,(c=b>=c.length?c[0]:c[b])&&c.focus())}};
n.prototype._focus=function(a){this.focus();a&&(this.activeMenu=a)};n.prototype._formSubmit=function(a){a.preventDefault();this.search()};n.prototype._getSourceName=function(a){var b=this.viewModel.allSources.getItemAt(a);return a===t.ALL_INDEX?f.all:b?b.name||f.untitledSource:f.untitledSource};n.prototype._getSuggestionHeaderNode=function(a){var b=this._getSourceName(a);return u.tsx("div",{key:"esri-search__suggestion-header-"+a,class:"esri-menu__header"},b)};n.prototype._splitResult=function(a,
b){b=g.escapeString(b);return a.replace(new RegExp("(^|)("+b+")(|$)","ig"),"$1|$2|$3").split("|")};n.prototype._getSuggestionNode=function(a,b,c){if(c=this.viewModel.searchTerm){var k=a.text||f.untitledResult,d=[];if(w.test(k))d.push(u.tsx("div",{innerHTML:k}));else{var k=this._splitResult(k,c),g=c.toLowerCase();k.forEach(function(a,b){a&&a.length&&(a.toLowerCase()===g?d.push(u.tsx("strong",{key:b},a)):d.push(a))})}return u.tsx("li",{bind:this,onclick:this._handleSuggestionClick,onkeydown:this._handleSuggestionClick,
onkeyup:this._handleSuggestionKeyup,key:"esri-search__suggestion$-{sourceIndex}_"+b,"data-suggestion":a,role:"menuitem",tabindex:"-1"},d)}};n.prototype._getSourceNode=function(a){var b,c=(b={},b["esri-search__source--active"]=a===this.viewModel.activeSourceIndex,b);return u.tsx("li",{bind:this,key:"esri-search__source-"+a,onclick:this._handleSourceClick,onkeydown:this._handleSourceClick,onkeyup:this._handleSourceKeyup,"data-source-index":a,role:"menuitem",class:this.classes("esri-search__source",
c),tabindex:"-1"},this._getSourceName(a))};n.prototype._renderSearchResultsContent=function(){this._searchResultRenderer.showMoreResultsOpen=!1;this._searchResultRenderer.viewModel=this.viewModel;return this._searchResultRenderer};e([a.property(),u.renderable()],n.prototype,"activeMenu",void 0);e([a.aliasOf("viewModel.activeSource"),u.renderable()],n.prototype,"activeSource",void 0);e([a.aliasOf("viewModel.activeSourceIndex"),u.renderable()],n.prototype,"activeSourceIndex",void 0);e([a.aliasOf("viewModel.allPlaceholder"),
u.renderable()],n.prototype,"allPlaceholder",void 0);e([a.aliasOf("viewModel.allSources")],n.prototype,"allSources",void 0);e([a.aliasOf("viewModel.autoNavigate")],n.prototype,"autoNavigate",void 0);e([a.aliasOf("viewModel.autoSelect")],n.prototype,"autoSelect",void 0);e([a.aliasOf("viewModel.defaultSources")],n.prototype,"defaultSources",void 0);e([a.aliasOf("viewModel.goToOverride")],n.prototype,"goToOverride",void 0);e([a.property()],n.prototype,"iconClass",void 0);e([a.aliasOf("viewModel.includeDefaultSources")],
n.prototype,"includeDefaultSources",void 0);e([a.property()],n.prototype,"label",void 0);e([u.renderable(),a.aliasOf("viewModel.locationEnabled")],n.prototype,"locationEnabled",void 0);e([a.aliasOf("viewModel.locationToAddressDistance")],n.prototype,"locationToAddressDistance",void 0);e([a.aliasOf("viewModel.maxResults")],n.prototype,"maxResults",void 0);e([a.aliasOf("viewModel.maxSuggestions")],n.prototype,"maxSuggestions",void 0);e([a.aliasOf("viewModel.minSuggestCharacters")],n.prototype,"minSuggestCharacters",
void 0);e([a.aliasOf("viewModel.popupEnabled")],n.prototype,"popupEnabled",void 0);e([a.aliasOf("viewModel.popupTemplate")],n.prototype,"popupTemplate",void 0);e([a.aliasOf("viewModel.portal")],n.prototype,"portal",void 0);e([a.aliasOf("viewModel.resultGraphic")],n.prototype,"resultGraphic",void 0);e([a.aliasOf("viewModel.resultGraphicEnabled")],n.prototype,"resultGraphicEnabled",void 0);e([a.aliasOf("viewModel.results"),u.renderable()],n.prototype,"results",void 0);e([a.aliasOf("viewModel.searchAllEnabled"),
u.renderable()],n.prototype,"searchAllEnabled",void 0);e([a.aliasOf("viewModel.searchTerm"),u.renderable()],n.prototype,"searchTerm",void 0);e([a.aliasOf("viewModel.selectedResult")],n.prototype,"selectedResult",void 0);e([a.aliasOf("viewModel.sources")],n.prototype,"sources",void 0);e([a.aliasOf("viewModel.suggestions"),u.renderable()],n.prototype,"suggestions",void 0);e([a.aliasOf("viewModel.suggestionsEnabled")],n.prototype,"suggestionsEnabled",void 0);e([a.aliasOf("viewModel.view"),u.renderable()],
n.prototype,"view",void 0);e([u.vmEvent("search-complete search-clear search-start select-result suggest-start suggest-complete".split(" ")),a.property({type:t}),u.renderable(["viewModel.allSources","viewModel.activeSource.placeholder","viewModel.activeSource.name","viewModel.state"])],n.prototype,"viewModel",void 0);e([a.aliasOf("viewModel.clear")],n.prototype,"clear",null);e([u.accessibleHandler()],n.prototype,"_handleSourcesMenuToggleClick",null);e([u.accessibleHandler()],n.prototype,"_handleClearButtonClick",
null);e([u.accessibleHandler()],n.prototype,"_handleSearchButtonClick",null);e([u.accessibleHandler()],n.prototype,"_handleSuggestionClick",null);e([u.accessibleHandler()],n.prototype,"_handleUseCurrentLocationClick",null);e([u.accessibleHandler()],n.prototype,"_handleSourceClick",null);return n=e([a.subclass("esri.widgets.Search")],n)}(a.declared(k))})},"esri/widgets/Search/SearchResultRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../core/accessorSupport/decorators ../Widget ./SearchViewModel ../support/widget".split(" "),
function(r,l,p,e,h,m,f,d,g){return function(f){function c(b){b=f.call(this)||this;b.showMoreResultsOpen=!1;b.viewModel=null;return b}p(c,f);c.prototype.render=function(){var b=this,a,c=this.get("viewModel.selectedResult"),d=this.get("viewModel.results"),c=c&&c.name||"",e=1<this._countResults(d),f=e&&d.map(function(a){return b._moreResultsList(a)}),d=e?g.tsx("div",{key:"esri-search-renderer__more-results-button",class:"esri-search-result-renderer__more-results-item"},g.tsx("a",{class:"esri-widget__anchor",
href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?h.hideMoreResults:h.showMoreResults)):null,e=e?g.tsx("div",{key:"esri-search-renderer__more-results-container",class:"esri-search-result-renderer__more-results-list"},f):null,f=(a={},a["esri-search-result-renderer__more-results--show-more-results"]=this.showMoreResultsOpen,a);return g.tsx("div",{class:"esri-search-result-renderer esri-widget"},g.tsx("div",{key:"esri-search-renderer__container",
class:this.classes("esri-search-result-renderer__more-results",f)},g.tsx("div",{key:"esri-search-renderer__result-name",class:"esri-search-result-renderer__more-results-item"},c),g.tsx("div",{key:"esri-search-renderer__more-results"},d,e)))};c.prototype._showMoreResultsClick=function(b){b.preventDefault();this.showMoreResultsOpen=!this.showMoreResultsOpen;(b=this.get("viewModel.view.popup"))&&b.reposition()};c.prototype._selectResultClick=function(b){b.preventDefault();b=b.currentTarget["data-result"];
this.viewModel&&this.viewModel.select(b)};c.prototype._moreResultsList=function(b){var a=this,c=b.results,d=c.length,e=!!d,f=this.get("viewModel.selectedResult"),d=1===d&&c[0]===f,f=this._getSourceName(b.source,b.sourceIndex),f=1<this.get("viewModel.results").length&&!d?g.tsx("div",{key:"esri-search-result-renderer__header-"+b.sourceIndex,class:"esri-search-result-renderer__more-results-list-header"},f):null,c=e&&c.map(function(b,c){return a._moreResultsListItem(b,c)}),c=e&&!d?g.tsx("ul",{key:"esri-search-result-renderer__list-"+
b.sourceIndex},c):null;return e?g.tsx("div",{key:"esri-search-result-renderer__results-"+b.sourceIndex},f,c):null};c.prototype._moreResultsListItem=function(b,a){var c=this.get("viewModel.selectedResult");return b!==c?g.tsx("li",{key:"esri-search-result-renderer__list-item-"+a},g.tsx("a",{class:"esri-widget__anchor",href:"#",tabindex:"0",bind:this,"data-result":b,onclick:this._selectResultClick,onkeydown:this._selectResultClick},b.name)):null};c.prototype._getSourceName=function(b,a){return a===d.ALL_INDEX?
h.all:b.name};c.prototype._countResults=function(b){return b?b.reduce(function(a,b){return a+b.results.length},0):0};e([g.renderable(),m.property()],c.prototype,"showMoreResultsOpen",void 0);e([m.property(),g.renderable(["viewModel.results","viewModel.selectedResult"])],c.prototype,"viewModel",void 0);e([g.accessibleHandler()],c.prototype,"_showMoreResultsClick",null);e([g.accessibleHandler()],c.prototype,"_selectResultClick",null);return c=e([m.subclass("esri.widgets.Search.SearchResultRenderer")],
c)}(m.declared(f))})},"esri/widgets/Search/SearchViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../Graphic ../../PopupTemplate ../../core/Accessor ../../core/asyncUtils ../../core/Collection ../../core/compilerUtils ../../core/Error ../../core/Evented ../../core/geolocationUtils ../../core/Handles ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/SpatialReference ../../portal/Portal ../../styles/basic ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/TextSymbol ../../views/support/layerViewUtils ./LayerSearchSource ./LocatorSearchSource ./SearchSource ./support/geometryUtils ./support/locatorUtils ../support/GoTo".split(" "),
function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u,w,A,n,E,z,x,y,C,I,J,B,P,Q,K,N,R,L,S,F){function D(a,b){return a.hasOwnProperty(b)&&null!=a[b]&&""!==a[b]}var H=u.getLogger("esri.widgets.Search.SearchViewModel"),M=q.ofType({key:function(a){return a.layer?"layer":"locator"},base:R,typeMap:{layer:K,locator:N}}),O=z.WGS84,G=/<(?:.|\s)*?>/g;return function(a){function d(b){b=a.call(this)||this;b._handles=new v;b._gotoPromise=null;b._searching=null;b._loadingDefaultSources=null;b.allPlaceholder=h.allPlaceholder;
b.autoNavigate=!0;b.autoSelect=!0;b.defaultSources=new M;b.defaultSymbol=new C({url:r.toUrl("../../images/search/search-symbol-32.svg"),size:24,width:24,height:24});b.includeDefaultSources=!0;b.locationToAddressDistance=1500;b.maxInputLength=128;b.maxResults=6;b.maxSuggestions=6;b.minSuggestCharacters=1;b.popupEnabled=!0;b.popupTemplate=new f({title:h.searchResult,content:"{Match_addr}"});b.portal=x.getDefault();b.resultGraphicEnabled=!0;b.resultGraphic=null;b.results=null;b.selectedSuggestion=null;
b.searchAllEnabled=!0;b.selectedResult=null;b.sources=new M;b.suggestionDelay=150;b.suggestions=null;b.suggestionsEnabled=!0;b.view=null;return b}p(d,a);d.prototype.initialize=function(){var a=this;this._handles.add([A.init(this,"portal",function(a){a&&!a.loaded&&a.load()}),A.init(this,["view","portal","includeDefaultSources"],function(){return a._loadDefaultSources()}),A.on(this,["defaultSources","sources"],"change",function(){return a.notifyChange("allSources")})])};d.prototype.destroy=function(){this.clearGraphics();
this._cancelLoadingDefaultSources();this._clearLoadingDefaultSources();this._handles.destroy();this._handles=null};Object.defineProperty(d.prototype,"activeSource",{get:function(){return this.allSources.getItemAt(this.activeSourceIndex)||null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"activeSourceIndex",{get:function(){return 1!==this.allSources.length&&this.searchAllEnabled?-1:0},set:function(a){void 0===a?this._clearOverride("activeSourceIndex"):this._override("activeSourceIndex",
a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"allSources",{get:function(){var a=this.sources,b=this.defaultSources,c=this.includeDefaultSources,a="function"===typeof c?c.call(null,{sources:a,defaultSources:b}):c?b.concat(a):a,b=this._get("allSources")||new M;b.removeAll();b.addMany(a.filter(Boolean));return b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"locationEnabled",{get:function(){return this._get("locationEnabled")||k.supported()},set:function(a){if(void 0===
a)this._clearOverride("locationEnabled");else{var c=k.supported();if(a&&!c){var d=new b("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});H.error(d)}this._override("locationEnabled",a&&c)}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"placeholder",{get:function(){var a=this.activeSourceIndex,b=this.allPlaceholder,b=void 0===b?h.allPlaceholder:b;return-1===a?b:(a=this.allSources.getItemAt(a))?a.placeholder:""},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"searchTerm",{get:function(){return this._get("searchTerm")||""},set:function(a){this._set("searchTerm",a||"");this.clearGraphics();this.selectedSuggestion&&this.selectedSuggestion.text!==a&&this._set("selectedSuggestion",null);""===a&&this._clear()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return this._searching?"searching":this._loadingDefaultSources?"loading":0===this.allSources.length?"disabled":
"ready"},enumerable:!0,configurable:!0});d.prototype.clear=function(){this.searchTerm=""};d.prototype.clearGraphics=function(){this._removeHighlight();this._closePopup();this.view&&this.view.graphics.remove(this.resultGraphic);this._set("resultGraphic",null)};d.prototype.search=function(a){var b=this;this.emit("search-start");this.clearGraphics();var c=this._createSuggestionForSearch(a);this._searching=a=this._whenViewAndPortalLoaded().then(function(){return b._getResultsFromSources(c).then(function(a){var d=
{activeSourceIndex:b.activeSourceIndex,searchTerm:c.text,numResults:0,numErrors:0,errors:[],results:[]};b._formatResponse(d,a,c);a=b._getFirstResult(d.results);var k=(c.location&&a?a.name:c.text).replace(G,"");b._set("searchTerm",k);(c.key&&"number"===typeof c.sourceIndex||c.location)&&b._set("selectedSuggestion",c);b._set("results",d.results);b.emit("search-complete",d);return b._selectFirstResult(a).then(function(){return d})})});this.notifyChange("state");a.then(function(){return b._clearSearching()}).catch(function(){return b._clearSearching()});
return a};d.prototype.searchNearby=function(){var a=this;if(!this.locationEnabled){var c=new b("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});H.error(c);return w.reject(c)}this._searching=c=k.getCurrentPosition().then(function(b){return k.positionToPoint({position:b,view:a.view})}).then(function(b){return a.search(b)});this.notifyChange("state");c.then(function(){return a._clearSearching()}).catch(function(){return a._clearSearching()});
return c};d.prototype.select=function(a){var c=this;this.clearGraphics();if(!a){var d=new b("select:missing-parameter","Cannot select without a searchResult.",{searchResult:a});H.error(d);return w.reject(d)}var k=this.view,g=D(a,"sourceIndex")?a.sourceIndex:this._getSourceIndexOfResult(a),e=this.allSources.getItemAt(g);if(!e)return d=new b("select:missing-source","Cannot select without a source.",{source:e}),H.error(d),w.reject(d);var d=e instanceof K?this._getSourcePopupTemplate(e):null,f=e.resultSymbol||
this._getDefaultSymbol(a),q=D(e,"resultGraphicEnabled")?e.resultGraphicEnabled:this.resultGraphicEnabled,v=D(e,"autoNavigate")?e.autoNavigate:this.autoNavigate,t=D(e,"popupEnabled")?e.popupEnabled:this.popupEnabled,u=t?d||this.popupTemplate:null,n=a.feature;if(!n)return d=new b("select:missing-feature","Cannot select without a feature.",{feature:n}),H.error(d),w.reject(d);var B=n.attributes,h=n.geometry,T=n.layer,J=n.sourceLayer,G=L.getPointFromGeometry(h),d={layerViewQuery:this._getLayerView(n),
elevationQuery:k&&G?L.getPointWithElevation(G,k).catch(function(){return G}):w.resolve(G)};return w.eachAlways(d).then(function(b){var d=b.layerViewQuery.value,G=b.elevationQuery.value;f instanceof P&&(f.text=a.name);b=k&&v?c._getGoToTarget(a,e):null;return(b?c._goToSearchResult(b):w.resolve()).then(function(){c._gotoPromise=null;var b=d?n:new m({geometry:h,symbol:f,attributes:B,layer:T,sourceLayer:J,popupTemplate:u}),v=t&&c.get("view.popup");(v=v&&b.getEffectivePopupTemplate(v.defaultPopupTemplateEnabled))&&
k.popup.open({features:[b],location:G});d&&Q.hasHighlight(d)&&!v&&c._highlightFeature({graphic:b,layerView:d});!d&&q&&k&&k.graphics.push(b);c._set("selectedResult",a);c._set("resultGraphic",b);c.emit("select-result",{result:a,source:e,sourceIndex:g});return a})})};d.prototype.suggest=function(a,b){var c=this,d=a||this.searchTerm;this.emit("suggest-start",{searchTerm:d});return this._suggestTimer(b).then(function(){return c._suggestImmediate(d).then(function(a){c._set("suggestions",a.results);c.emit("suggest-complete",
a);return a})})};d.prototype._cancelLoadingDefaultSources=function(){var a=this._loadingDefaultSources;a&&a.cancel()};d.prototype._clearLoadingDefaultSources=function(){this._loadingDefaultSources=null;this.notifyChange("state")};d.prototype._clearSearching=function(){this._searching=null;this.notifyChange("state")};d.prototype._convertHelperServices=function(){var a=this.get("portal.helperServices.geocode");return a?a.map(function(a){if(!1!==a.placefinding&&(a=N.fromJSON(a),S.isArcGISWorldGeocoder(a.get("locator.url"))&&
a.set({singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr","City"],localSearchOptions:{minScale:3E5,distance:5E4},placeholder:h.placeholder}),a.singleLineFieldName))return a}).filter(Boolean):[]};d.prototype._convertApplicationProperties=function(){var a=this,b=this.get("view.map.applicationProperties.viewing.search"),c=this.get("view.map");if(!c||!b)return[];var d=b.hintText;return b.enabled?b.layers.map(function(b){var k=c.findLayerById(b.id);if(k){b=a._getLayerJSON(b);
var e=K.fromJSON(b);e.placeholder=d;a._getLayer(k,b).then(function(a){e.layer=a});return e}}).filter(Boolean):[]};d.prototype._getSubLayer=function(a,b){return a&&a.allSublayers?(a=a.allSublayers.find(function(a){return a.id===b.subLayer}))?g.safeCast(a.createFeatureLayer()):w.reject():w.reject()};d.prototype._getLayer=function(a,c){var d=this;if("feature"===a.type||"scene"===a.type)return w.resolve(a);if("map-image"===a.type)return a.load().then(function(){return d._getSubLayer(a,c).catch(function(){var c=
new b("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:a});H.error(c);return null})})};d.prototype._getLayerJSON=function(a){return"function"===typeof a.toJSON?a.toJSON():a};d.prototype._updateDefaultSources=function(){var a=this.defaultSources,b=this.includeDefaultSources;a.removeAll();b&&a.addMany(this._convertApplicationProperties().concat(this._convertHelperServices()));this.notifyChange("allSources")};d.prototype._clear=function(){this._gotoPromise&&
(this._gotoPromise.cancel(),this._gotoPromise=null);this._set("results",null);this._set("suggestions",null);this._set("selectedResult",null);this._set("selectedSuggestion",null);this.emit("search-clear")};d.prototype._closePopup=function(){var a=this.get("view.popup"),b=this.resultGraphic;if(a&&b){var c=a.selectedFeature;c&&c===b&&a.close()}};d.prototype._suggestTimer=function(a){return w.after(null!=a?a:this.suggestionDelay)};d.prototype._createLocationForSearch=function(a){if(a instanceof m)return L.getPointFromGeometry(a.geometry);
if(a instanceof E)return a;if(Array.isArray(a)&&2===a.length)return new E({longitude:a[0],latitude:a[1]})};d.prototype._createSuggestionForSearch=function(a){if(a&&D(a,"key")&&D(a,"text")&&D(a,"sourceIndex"))return a;var b=this._createLocationForSearch(a)||null,c="string"===typeof a?a:this.searchTerm,d=this.selectedSuggestion,k=this.selectedResult,e=(a=!a&&d&&k)&&d.location;return a&&d.key===k.key&&d.sourceIndex===k.sourceIndex||e?d:{location:b,text:b?"":c,sourceIndex:null,key:null}};d.prototype._getFirstResult=
function(a){var b=null;a&&a.some(function(a){a=a.results[0];var c=!!a;c&&(b=a);return c});return b};d.prototype._selectFirstResult=function(a){return this.autoSelect&&a?this.select(a):w.resolve()};d.prototype._suggestImmediate=function(a){var b=this;return this._whenViewAndPortalLoaded().then(function(){return b._getSuggestionsFromSources(a)}).then(function(c){var d={activeSourceIndex:b.activeSourceIndex,searchTerm:a,numResults:0,numErrors:0,errors:[],results:[]};b._formatResponse(d,c);return d})};
d.prototype._formatSourceResponse=function(a,b,c){var d=b&&b.value||[];b=b&&b.error;var k=this.allSources.getItemAt(c);b?(a.errors.push({sourceIndex:c,source:k,error:b}),a.numErrors++):(a.results.push({sourceIndex:c,source:k,results:d}),a.numResults+=d.length)};d.prototype._formatResponse=function(a,b,c){var d=this;if(b)if(-1===a.activeSourceIndex){var k=c&&D(c,"sourceIndex")&&-1!==c.sourceIndex?c.sourceIndex:void 0;b.forEach(function(b,c){d._formatSourceResponse(a,b,void 0!==k?k:c)})}else this._formatSourceResponse(a,
b[0],a.activeSourceIndex)};d.prototype._getResultsFromSources=function(a){var c=this,d=this.allSources,k=!a.location&&D(a,"sourceIndex")?a.sourceIndex:this.activeSourceIndex,e=[];if(!d.length)return d=new b("search:no-sources-defined","At least one source is required.",{allSources:d}),H.error(d),w.reject(d);-1===k?d.forEach(function(b,d){e.push(c._getResultsFromSource(a,d))}):e.push(this._getResultsFromSource(a,k));return w.eachAlways(e)};d.prototype._getSuggestionsFromSources=function(a){var c=this,
d=this.allSources,k=this.activeSourceIndex,e=[];if(!d.length)return d=new b("suggest:no-sources-defined","At least one source is required.",{allSources:d}),H.error(d),w.reject(d);-1===k?d.forEach(function(b,d){e.push(c._getSuggestionsFromSource(a,d))}):e.push(this._getSuggestionsFromSource(a,k));return w.eachAlways(e)};d.prototype._getResultsFromSource=function(a,b){var c=this.allSources.getItemAt(b),d=a.location,d=void 0===d?null:d,k=this.get("view.spatialReference")||O,e=D(c,"maxResults")?c.maxResults:
this.maxResults,g=c instanceof K&&D(c,"exactMatch")?c.exactMatch:!1,f=c instanceof N&&D(c,"locationToAddressDistance")?c.locationToAddressDistance:this.locationToAddressDistance;return c.getResults({view:this.view,sourceIndex:b,location:d,suggestResult:a,spatialReference:k,exactMatch:g,maxResults:e,distance:f})};d.prototype._getSuggestionsFromSource=function(a,b){var c=this.allSources.getItemAt(b),d=D(c,"suggestionsEnabled")?c.suggestionsEnabled:this.suggestionsEnabled,k=a.trim().length,e=D(c,"minSuggestCharacters")?
c.minSuggestCharacters:this.minSuggestCharacters;return d&&k>=e?(d=this.get("view.spatialReference")||O,k=D(c,"maxSuggestions")?c.maxSuggestions:this.maxSuggestions,c.getSuggestions({view:this.view,sourceIndex:b,suggestTerm:a,spatialReference:d,maxSuggestions:k})):w.resolve()};d.prototype.createDefaultSymbol=function(a,b){if("point"===b)return new B({color:a.color,size:a.size,outline:{color:a.outline.color,width:a.outline.width}});if("polyline"===b)return new J({color:a.color,width:a.width});if("polygon"===
b)return new I({color:a.color,outline:{color:a.outline.color,width:a.outline.width}})};d.prototype._getSourcePopupTemplate=function(a){var b=a.layer;if(b)return D(a,"popupTemplate")?a.popupTemplate:b.popupTemplate};d.prototype._getSourceIndexOfResult=function(a){var b=null;this.results.some(function(c){return c.results.some(function(d){if(d===a)return b=c.sourceIndex,!0})});return b};d.prototype._getGoToTarget=function(a,b){var c=a.extent;a=a.feature;return b instanceof K?a||c:c||a};d.prototype._goToSearchResult=
function(a){var b=!!a;a=this.callGoTo({target:{target:a},options:{animate:b}});b&&(this._gotoPromise=a);return a};d.prototype._whenViewAndPortalLoaded=function(){var a=this.portal,b=this.view,b=b?b.when():w.resolve(),a=a?a.when():w.resolve();return w.eachAlways([b,a]).then(function(){})};d.prototype._loadDefaultSources=function(){var a=this,b=this.includeDefaultSources;this._cancelLoadingDefaultSources();this._clearLoadingDefaultSources();var b=b?this._whenViewAndPortalLoaded():w.resolve(),c=!1;b.catch(function(){}).then(function(){c=
!0;a._clearLoadingDefaultSources();a._updateDefaultSources()});c||(this._loadingDefaultSources=b,this.notifyChange("state"));return b};d.prototype._getDefaultSymbol=function(a){var b=this.get("view.map.basemap.id");if(a=a&&a.feature&&a.feature.geometry&&a.feature.geometry.type)if(b=(b=y.getSchemes({theme:"default",basemap:b,geometryType:a})||y.getSchemes({theme:"default",basemap:"topo",geometryType:a}))&&b.primaryScheme)return b.color&&D(b,"opacity")&&(b.color.a=b.opacity),this.createDefaultSymbol(b,
a);return this.defaultSymbol};d.prototype._removeHighlight=function(){this._handles.remove("highlight")};d.prototype._getLayerView=function(a){var b=this.view;if(!a||!b)return w.resolve(null);var d=a.layer;return b.when().then(function(){return c.typeCast(b)().whenLayerView(d)})};d.prototype._highlightFeature=function(a){var b=a.graphic,c=b.attributes,d=b.layer.objectIdField;a=a.layerView.highlight(c&&c[d]||b);this._handles.add(a,"highlight")};d.ALL_INDEX=-1;e([n.property({readOnly:!0,dependsOn:["activeSourceIndex",
"allSources.length"],value:null})],d.prototype,"activeSource",null);e([n.property({dependsOn:["allSources.length","searchAllEnabled"]})],d.prototype,"activeSourceIndex",null);e([n.property()],d.prototype,"allPlaceholder",void 0);e([n.property({dependsOn:["defaultSources.length","sources.length","includeDefaultSources"],readOnly:!0})],d.prototype,"allSources",null);e([n.property()],d.prototype,"autoNavigate",void 0);e([n.property()],d.prototype,"autoSelect",void 0);e([n.property({readOnly:!0})],d.prototype,
"defaultSources",void 0);e([n.property()],d.prototype,"defaultSymbol",void 0);e([n.property()],d.prototype,"includeDefaultSources",void 0);e([n.property()],d.prototype,"locationEnabled",null);e([n.property()],d.prototype,"locationToAddressDistance",void 0);e([n.property()],d.prototype,"maxInputLength",void 0);e([n.property()],d.prototype,"maxResults",void 0);e([n.property()],d.prototype,"maxSuggestions",void 0);e([n.property()],d.prototype,"minSuggestCharacters",void 0);e([n.property({readOnly:!0,
dependsOn:["activeSourceIndex","activeSource.placeholder","allPlaceholder","allSources"]})],d.prototype,"placeholder",null);e([n.property()],d.prototype,"popupEnabled",void 0);e([n.property({type:f})],d.prototype,"popupTemplate",void 0);e([n.property({type:x})],d.prototype,"portal",void 0);e([n.property()],d.prototype,"resultGraphicEnabled",void 0);e([n.property({readOnly:!0})],d.prototype,"resultGraphic",void 0);e([n.property({readOnly:!0})],d.prototype,"results",void 0);e([n.property({readOnly:!0})],
d.prototype,"selectedSuggestion",void 0);e([n.property()],d.prototype,"searchAllEnabled",void 0);e([n.property({readOnly:!0})],d.prototype,"selectedResult",void 0);e([n.property()],d.prototype,"searchTerm",null);e([n.property({type:M})],d.prototype,"sources",void 0);e([n.property({readOnly:!0,dependsOn:["allSources.length"]})],d.prototype,"state",null);e([n.property()],d.prototype,"suggestionDelay",void 0);e([n.property({readOnly:!0})],d.prototype,"suggestions",void 0);e([n.property()],d.prototype,
"suggestionsEnabled",void 0);e([n.property()],d.prototype,"view",void 0);e([n.property()],d.prototype,"clear",null);return d=e([n.subclass("esri.widgets.Search.SearchViewModel")],d)}(n.declared(d,a,F))})},"esri/core/geolocationUtils":function(){define("require exports ./tsSupport/assignHelper ../config ./Error ./has ./Logger ./promiseUtils ../geometry/Point ../geometry/support/webMercatorUtils ../portal/Portal ../tasks/GeometryService ../tasks/support/ProjectParameters".split(" "),function(r,l,p,
e,h,m,f,d,g,q,c,b,a){function k(c,k){if(!k)return d.resolve(c);var e=k.spatialReference;return e.isWGS84?d.resolve(c):e.isWebMercator?d.resolve(q.geographicToWebMercator(c)):v().then(function(k){if(!k)return d.reject(new h("geometry-service:missing-url","Geometry service URL is missing"));k=new b({url:k});var g=new a({geometries:[c],outSR:e});return k.project(g).then(function(a){return a[0]})})}function v(){if(e.geometryServiceUrl)return d.resolve(e.geometryServiceUrl);var a=c.getDefault();return a.load().catch(function(a){}).then(function(){return a.get("helperServices.geometry.url")})}
Object.defineProperty(l,"__esModule",{value:!0});var t=f.getLogger("esri.core.geolocationUtils"),u={maximumAge:0,timeout:15E3,enableHighAccuracy:!0};l.supported=function(){var a=m("esri-geolocation");a||t.warn("geolocation-unsupported","Geolocation unsupported.");a&&((a=m("esri-secure-context"))||t.warn("insecure-context","Geolocation requires a secure origin."));return a};l.getCurrentPosition=function(a){a||(a=u);var b=d.create(function(b,c){navigator.geolocation.getCurrentPosition(b,c,a)});return d.timeout(b,
15E3,void 0)};l.positionToPoint=function(a){var b=a.position;a=a.view;var c=b&&b.coords||{},c={accuracy:c.accuracy,altitude:c.altitude,altitudeAccuracy:c.altitudeAccuracy,heading:c.heading,latitude:c.latitude,longitude:c.longitude,speed:c.speed},b=b?{coords:c,timestamp:b.timestamp}:b;b=(b=b&&b.coords)?new g({longitude:b.longitude,latitude:b.latitude,z:b.altitude||null,spatialReference:{wkid:4326}}):null;return k(b,a)}})},"esri/styles/basic":function(){define(["../core/lang","../Color"],function(r,
l){function p(e,f){var d;if(e)switch(d={},d.color=new l(e.color),f){case "point":d.outline={color:new l(e.outline.color),width:e.outline.width};d.size=e.size;break;case "polyline":d.width=e.width;break;case "polygon":d.outline={color:new l(e.outline.color),width:e.outline.width}}return d}var e={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,1],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[26,26,26,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[26,
26,26,1],outline:{color:[178,178,178,1],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,.8],outline:{color:[255,255,255,1],width:1}},secondary:[{color:[128,128,128,.8],outline:{color:[255,255,255,1],width:1}},{color:[255,255,255,
.8],outline:{color:[128,128,128,1],width:1}}]},dark:{primary:{color:[227,139,79,.8],outline:{color:[51,51,51,1],width:1}},secondary:[{color:[178,178,178,.8],outline:{color:[51,51,51,1],width:1}},{color:[26,26,26,.8],outline:{color:[128,128,128,1],width:1}}]}}}},h={};(function(){var m,f,d,g,q,c,b,a;for(m in e)for(g in f=e[m],d=f.basemapGroups,q=h[m]={basemaps:[].concat(d.light).concat(d.dark),point:{},polyline:{},polygon:{}},d)for(c=d[g],b=0;b<c.length;b++)a=c[b],f.pointSchemes&&(q.point[a]=f.pointSchemes[g]),
f.lineSchemes&&(q.polyline[a]=f.lineSchemes[g]),f.polygonSchemes&&(q.polygon[a]=f.polygonSchemes[g])})();return{getAvailableThemes:function(m){var f=[],d,g,q;for(d in e)g=e[d],q=h[d],m&&q.basemaps&&-1===q.basemaps.indexOf(m)||f.push({name:g.name,label:g.label,description:g.description,basemaps:q.basemaps.slice(0)});return f},getSchemes:function(e){var f=e.basemap,d=e.geometryType;e=h[e.theme];var g;(e=(e=e&&e[d])&&e[f])&&(g={primaryScheme:p(e.primary,d),secondarySchemes:e.secondary.map(function(e){return p(e,
d)})});return g},cloneScheme:function(e){var f;e&&(f=r.mixin({},e),f.color&&(f.color=new l(f.color)),f.outline&&(f.outline={color:f.outline.color&&new l(f.outline.color),width:f.outline.width}));return f}}})},"esri/widgets/Search/LayerSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ./SearchSource ./support/layerSearchUtils".split(" "),
function(r,l,p,e,h,m,f,d,g){return function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.displayField=null;a.exactMatch=null;a.searchFields=null;a.searchQueryParams=null;a.searchTemplate=null;a.suggestionTemplate=null;a.suggestQueryParams=null;a.getResults=function(b){return g.getResults(h({source:a},b))};a.getSuggestions=function(b){return g.getSuggestions(h({source:a},b))};return a}p(c,d);b=c;Object.defineProperty(c.prototype,"layer",{set:function(a){this._set("layer",a);a&&a.load()},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"name",{get:function(){return this._getLayerTitle()||""},set:function(a){void 0===a?this._clearOverride("name"):this._override("name",a)},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new b({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?m.clone(this.outFields):null,placeholder:this.placeholder,
popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?m.clone(this.searchFields):null,searchQueryParams:this.searchQueryParams?
m.clone(this.searchQueryParams):null,suggestionTemplate:this.suggestionTemplate,suggestQueryParams:this.suggestQueryParams?m.clone(this.suggestQueryParams):null,zoomScale:this.zoomScale})};c.prototype._getFirstStringField=function(){var a=this.layer,b="";a&&a.fields&&a.fields.some(function(a){if("string"===a.type)return b=a.name,!0});return b};c.prototype._getDisplayField=function(){return this.displayField||this.layer.displayField||this._getFirstStringField()};c.prototype._getLayerTitle=function(){var a=
this.layer;if(a){var b=a.title;if(b){var c="";(this.searchFields||[this._getDisplayField()]).forEach(function(b,d){c+=0===d?": ":", ";d=a.getField(b);c+=d&&d.alias||b});return""+b+c}}};var b;e([f.property({json:{read:{source:"field.name"},write:{target:"field.name"}}})],c.prototype,"displayField",void 0);e([f.property({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],c.prototype,"exactMatch",void 0);e([f.property({value:null})],c.prototype,"layer",null);e([f.property({dependsOn:["layer.title"]})],
c.prototype,"name",null);e([f.property()],c.prototype,"searchFields",void 0);e([f.property()],c.prototype,"searchQueryParams",void 0);e([f.property()],c.prototype,"searchTemplate",void 0);e([f.property()],c.prototype,"suggestionTemplate",void 0);e([f.property()],c.prototype,"suggestQueryParams",void 0);return c=b=e([f.subclass("esri.widgets.Search.LayerSearchSource")],c)}(f.declared(d))})},"esri/widgets/Search/SearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Identifiable ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(r,l,p,e,h,m,f){return function(d){function g(e){e=d.call(this)||this;e.autoNavigate=null;e.filter=null;e.getResults=null;e.getSuggestions=null;e.maxResults=null;e.maxSuggestions=null;e.minSuggestCharacters=null;e.outFields=null;e.placeholder="";e.popupEnabled=null;e.popupTemplate=null;e.prefix="";e.resultGraphicEnabled=null;e.resultSymbol=null;e.searchExtent=null;e.suggestionsEnabled=null;e.suffix="";e.withinViewEnabled=!1;e.zoomScale=null;return e}p(g,d);e([f.property()],g.prototype,"autoNavigate",
void 0);e([f.property()],g.prototype,"filter",void 0);e([f.property()],g.prototype,"getResults",void 0);e([f.property()],g.prototype,"getSuggestions",void 0);e([f.property()],g.prototype,"maxResults",void 0);e([f.property()],g.prototype,"maxSuggestions",void 0);e([f.property()],g.prototype,"minSuggestCharacters",void 0);e([f.property()],g.prototype,"outFields",void 0);e([f.property()],g.prototype,"placeholder",void 0);e([f.property()],g.prototype,"popupEnabled",void 0);e([f.property()],g.prototype,
"popupTemplate",void 0);e([f.property()],g.prototype,"prefix",void 0);e([f.property()],g.prototype,"resultGraphicEnabled",void 0);e([f.property()],g.prototype,"resultSymbol",void 0);e([f.property()],g.prototype,"searchExtent",void 0);e([f.property()],g.prototype,"suggestionsEnabled",void 0);e([f.property()],g.prototype,"suffix",void 0);e([f.property()],g.prototype,"withinViewEnabled",void 0);e([f.property()],g.prototype,"zoomScale",void 0);return g=e([f.subclass("esri.widgets.Search.SearchSource")],
g)}(f.declared(m,h.Identifiable))})},"esri/widgets/Search/support/layerSearchUtils":function(){define("require exports dojo/date/locale ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/unitUtils ./geometryUtils".split(" "),function(r,l,p,e,h,m,f,d,g){function q(a,b){var c=a.filter,d=a.searchExtent;b=b&&b.extent;a=a.withinViewEnabled&&b?b:void 0;return c&&c.geometry||d||a}function c(a){return a?a.load().then(f.resolve).catch(f.reject):f.resolve()}
function b(a){return a&&!!a.get("capabilities.query.supportsPagination")}function a(a){var b="";a&&(a=a.fields)&&a.some(function(a){if("string"===a.type)return b=a.name,!0});return b}function k(a,b){return a&&b?b.every(function(b){return!!a.getField(b)}):!1}function v(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1}function t(a,b,c){var d=null;(a=a.codedValues)&&a.some(function(a){var e=a.name,e=c?e:e.toLowerCase();if((c?b:b.toLowerCase())===e)return d=a.code.toString(),!0});
return d}function u(a,b){return(b=b&&b.where)?"("+a+") AND ("+b+")":a}function w(a,b,c,d,e){var k=b.definitionExpression,g="";if(a){var f=x.test(b.url)&&v(a)?"N":"";c&&c.forEach(function(c){var k=b.getField(c);c=((c="function"===typeof b.getFieldDomain&&b.getFieldDomain(c))&&"coded-value"===c.type?t(c,a,e):null)||a||null;if(null!==c){var q=k.type,k=k.name;"string"===q||"date"===q?e?k=u(k+" \x3d "+f+"'"+c+"'",d):(c=c.toUpperCase(),k=u("UPPER("+k+") LIKE "+f+"'%"+c+"%'",d)):"oid"===q||"small-integer"===
q||"integer"===q||"single"===q||"double"===q?(c=parseFloat(c),k=isNaN(c)?null:u(k+" \x3d "+c,d)):k=u(k+" \x3d "+c,d);k&&(g+=g?" OR ("+k+")":"("+k+")")}})}return k?"("+k+") AND ("+g+")":g}function A(a,b){var c=null;(a=a.codedValues)&&a.length&&a.some(function(a){if(a.code===b)return c=a.name,!0});return c}function n(a,b,c){var d=a.layer,e=a.attributes,k="function"===typeof d.getFieldDomain&&d.getFieldDomain(c);return b?h.substitute(e,b):c&&a.hasOwnProperty("attributes")&&e.hasOwnProperty(c)?(a=e[c],
c=d.getField(c),k&&"coded-value"===k.type?A(k,a):c&&"date"===c.type?p.format(new Date(a)):"number"===typeof a?a.toString():"string"!==typeof a?"":a.trim()):""}function E(a,b,c,d){return a.features.map(function(a){var e=a.attributes[a.layer.objectIdField];return{text:n(a,b.suggestionTemplate,d),key:e,sourceIndex:c}})}function z(a,b,c,d,e,k,f){return a.features.map(function(a){var q=a.clone(),v=a.layer,v=(v=v&&v.objectIdField)&&a.attributes[v];a=n(a,c.searchTemplate,e);var t=g.createExtentFromGeometry(q.geometry,
b,k);return{extent:f?g.scaleExtent(t.clone(),b,f):t,feature:q,key:v,name:a,sourceIndex:d}})}Object.defineProperty(l,"__esModule",{value:!0});var x=/https?:\/\/services.*\.arcgis\.com/i,y=/(?:\{([^}]+)\})/g,C=m.getLogger("esri.widgets.Search.support.layerSearchUtils");l.getResults=function(g){var v=g.exactMatch,t=void 0===v?!1:v,u=g.location,m=g.maxResults,n=g.spatialReference,h=g.source,y=g.sourceIndex,x=g.suggestResult,p=g.view,l=h.layer,A=h.filter,r=h.zoomScale,I=p&&p.scale,O=q(h,p);return c(l).then(function(){return f.create(function(a,
b){var c=l.popupTemplate;if(c)return c.getRequiredFields(l.fields).then(function(b){return a(b)},b);a(null)})}).then(function(c){var g=l.objectIdField,q=l.returnZ,v=h.displayField||h.layer.displayField||a(h.layer);if(!l.getField(v))return C.error("invalid-field: displayField is invalid."),f.reject(new e("getResults():invalid-field","displayField is invalid."));c=c&&c.length?c:[v];var B=(c=h.outFields||c)&&-1!==c.indexOf("*");-1!==c.indexOf(g)||B||c.push(g);if(!B&&!k(l,c))return C.error("invalid-field: outField is invalid."),
f.reject(new e("getResults():invalid-field","outField is invalid."));g=l.createQuery();(B=h.searchQueryParams)&&g.set(B);n&&(g.outSpatialReference=n,B=d.getMetersPerUnitForSR(n))&&(g.maxAllowableOffset=B);B=!!l.get("capabilities.data.supportsZ");g.returnZ=B&&!1!==q;g.returnGeometry=!0;c&&(g.outFields=c);if(u)g.geometry=u;else if(x.key)g.objectIds=[parseInt(x.key,10)];else{q=h.searchFields||[v];if(!k(l,q))return C.error("invalid-field: search field is invalid."),f.reject(new e("getResults():invalid-field",
"search field is invalid."));b(l)&&(g.num=m);O&&(g.geometry=O);c=x.text.trim();if(!c)return f.resolve();var B=h.prefix,G=h.suffix;c=(""+(void 0===B?"":B)+c+(void 0===G?"":G)).replace(/\'/g,"''");q=w(c,l,q,A,t);if(!q)return f.resolve();g.where=q}return l.queryFeatures(g).then(function(a){return z(a,p,h,y,v,I,r)})})};l.getSuggestions=function(d){var g=d.source,v=d.spatialReference,t=d.suggestTerm,u=d.maxSuggestions,m=d.sourceIndex,h=g.layer,n=g.filter,x=q(g,d.view);return c(h).then(function(){if(!b(h))return f.resolve();
var c=g.displayField||g.layer.displayField||a(g.layer),d=g.searchFields||[c],q=[];g.suggestionTemplate?g.suggestionTemplate.replace(y,function(a,b){q.push(b);return a}):q.push(c);var B=q&&-1!==q.indexOf("*");-1!==q.indexOf(h.objectIdField)||B||q.push(h.objectIdField);var p=!!h.getField(c),B=B||k(h,q),l=k(h,d);if(!p)return C.error("invalid-field: displayField is invalid."),f.reject(new e("getSuggestions():invalid-field","displayField is invalid."));if(!B)return C.error("invalid-field: outField is invalid."),
f.reject(new e("getSuggestions():invalid-field","outField is invalid."));if(!l)return C.error("invalid-field: search field is invalid."),f.reject(new e("getSuggestions():invalid-field","search field is invalid."));p=h.createQuery();(B=g.suggestQueryParams)&&p.set(B);p.outSpatialReference=v;p.returnGeometry=!1;p.num=u;p.outFields=q;x&&(p.geometry=x);B=t.trim();if(!B)return f.resolve();var l=g.prefix,G=g.suffix,B=(""+(void 0===l?"":l)+B+(void 0===G?"":G)).replace(/\'/g,"''"),d=w(B,h,d,n,!1);if(!d)return f.resolve();
p.where=d;return h.queryFeatures(p).then(function(a){return E(a,g,m,c)})})}})},"esri/widgets/Search/support/geometryUtils":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../views/MapView".split(" "),function(r,l,p,e,h,m,f,d){function g(c,b,a){var d=c.hasZ?c.z:void 0;return b&&b.map?(a?f.getExtentForScale(b,a):b.extent).clone().centerAt(c).set({zmax:d,zmin:d}):new p.Extent({xmin:c.x-
.25,ymin:c.y-.25,xmax:c.x+.25,ymax:c.y+.25,spatialReference:c.spatialReference,zmin:d,zmax:d})}Object.defineProperty(l,"__esModule",{value:!0});var q=h.getLogger("esri.widgets.Search.support.geometryUtils");l.getPointWithElevation=function(c,b){return b?c?c.hasZ||b instanceof d?m.resolve(c):(b=b.get("map.ground"))&&b.layers.length?b.queryElevation(c).then(function(a){return a.geometry}):m.resolve(c):(q.error("missing-parameter: point is missing."),m.reject(new e("searchgeometryutils:missing-parameter",
"point is missing."))):(q.error("missing-parameter: view is missing."),m.reject(new e("searchgeometryutils:missing-parameter","view is missing.")))};l.getPointFromGeometry=function(c){if(c instanceof p.Point)return c;if(c instanceof p.Extent)return c.center;if(c instanceof p.Polygon)return c.centroid;if(c instanceof p.Multipoint)return c.getPoint(0);if(c instanceof p.Polyline)return c.getPoint(0,0)};l.createExtentFromGeometry=function(c,b,a){if(c){if(c instanceof p.Extent)return c;if(c instanceof
p.Multipoint||c instanceof p.Polygon||c instanceof p.Polyline)return c.extent;if(c instanceof p.Point)return g(c,b,a)}};l.scaleExtent=function(c,b,a){if(c&&b)return g(c.center,b,a)}})},"esri/views/MapView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/Handles ../core/has ../core/Logger ../core/promiseUtils ../core/screenUtils ../core/watchUtils ../core/workers ../core/accessorSupport/decorators ./BreakpointsOwner ./Magnifier ./MapViewBase ./2d/input/MapViewInputManager ./2d/support/HighlightOptions ./support/screenshotUtils ./support/WebGLRequirements ./ui/2d/DefaultUI2D".split(" "),
function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u,w,A,n,E){function z(){return g.create(function(a){r(["./2d/RenderingCore2D"],function(b){y=b.Stage;C=b.GraphicsView2D;I=b.LabelManager;J=b.MapViewNavigation;B=b.MagnifierView2D;a()})})}var x=d.getLogger("esri.views.MapView"),y,C,I,J,B;return function(d){function k(a){a=d.call(this,a)||this;a._graphicsView=null;a._magnifierView=null;a._mapViewHandles=new m;a._stage=null;a._resolveWhenReady=[];a.highlightOptions=new w;a.magnifier=new v;a.inputManager=new u({view:a});
a.mapViewNavigation=null;a.supersampleScreenhotsEnabled=!0;a.ui=new E;a.rendering=!1;b.initialize();return a}p(k,d);Object.defineProperty(k.prototype,"background",{get:function(){return this.get("map.initialViewProperties.background")||null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"interacting",{get:function(){return this.mapViewNavigation&&this.mapViewNavigation.interacting||!1},enumerable:!0,configurable:!0});k.prototype.toMap=function(a){if(q.isSupportedScreenPointEvent(a)){var b=
q.createScreenPointFromSupportedEvent(this,a);return this.inherited(arguments,[b])}return this.inherited(arguments)};k.prototype.hitTest=function(a){var b=q.isSupportedScreenPointEvent(a)?q.createScreenPointFromSupportedEvent(this,a):a;if(!this._setup||isNaN(b.x)||isNaN(b.y))return g.resolve({screenPoint:b,results:[]});var c=this.toMap(b);a=[this._graphicsView];a.push.apply(a,this.allLayerViews.toArray().reverse());return g.all(a.map(function(a){return a&&a.hitTest?a.hitTest(b.x,b.y):null})).then(function(a){return{screenPoint:b,
results:a.filter(function(a){return null!=a}).map(function(a){return{mapPoint:c,graphic:a}})}})};k.prototype.takeScreenshot=function(a){return this._setup?this._stage.takeScreenshot(A.toRenderSettings(a,this),this.allLayerViews):g.reject("Map view cannot be used before it is ready")};k.prototype.on=function(a,b,c){var d=this.inputManager&&this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};k.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&
this.inputManager.viewEvents.hasHandler(a)};k.prototype.graphicChanged=function(a){this._graphicsView&&this._graphicsView.graphicUpdateHandler(a)};k.prototype.whenReady=function(){var a=this;return g.create(function(b){a._setup?b(a):a._resolveWhenReady.push(b)})};k.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};k.prototype.validate=function(){var a=n.check({supportsMajorWebPerformanceCaveat:!0});f("safari")&&9>f("safari")&&(a=new h("mapview:browser-not-supported","This browser is not supported by MapView (Safari \x3c 9)",
{type:"safari",requiredVersion:9,detectedVersion:f("safari")}));return a?(x.warn("#validate()",a.message),g.reject(a)):z()};k.prototype._startup=function(){var a=this;if(!this._setup){this.inherited(arguments);this.graphics.owner=this;var b=new y(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenhotsEnabled}),d=new C({view:this,graphics:this.graphics}),k=new J({view:this,animationManager:this.animationManager}),e=new I({view:this});this._magnifierView=new B;this._magnifierView.magnifier=
this.magnifier;this._stage=b;this._graphicsView=this._frameTask.graphicsView=d;this._set("mapViewNavigation",k);this._set("labelManager",e);this._mapViewHandles.add([this.allLayerViews.on("change",function(){return a._updateStageChildren()}),b.on("post-render",function(){return a._set("rendering",a.allLayerViews.some(function(a){return!0===a.rendering}))}),this.watch("stationary",function(a){return b.stationary=a},!0),this.watch("state.viewpoint",function(c){return b.state=a.state},!0),this.watch("background",
function(a){return b.background=a},!0),this.watch("magnifier",function(b){return a._magnifierView.magnifier=b},!0),c.init(this,"highlightOptions.color,highlightOptions.haloOpacity,highlightOptions.fillOpacity",function(){a._stage.setHighlightOptions(a.highlightOptions);a._stage.requestRender()})]);b.state=this.state;b.background=this.background;this._updateStageChildren();d=this._resolveWhenReady;this._resolveWhenReady=[];d.forEach(function(b){return b(a)})}};k.prototype._tearDown=function(){this._setup&&
(this._mapViewHandles.removeAll(),this.layerViewManager.clear(),this.labelManager.destroy(),this._graphicsView.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this.mapViewNavigation.destroy(),this._magnifierView=this._graphicsView=this._stage=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.inherited(arguments))};k.prototype._updateStageChildren=function(){var a=this;this._stage.removeAllChildren();this.allLayerViews.filter(function(a){return null!=
a.container}).forEach(function(b,c){a._stage.addChildAt(b.container,c)});this._stage.addChild(this._graphicsView.container);this._stage.addChild(this._magnifierView)};e([a.property({readOnly:!0,dependsOn:["map.initialViewProperties?.background"]})],k.prototype,"background",null);e([a.property({type:w})],k.prototype,"highlightOptions",void 0);e([a.property({type:v})],k.prototype,"magnifier",void 0);e([a.property({readOnly:!0})],k.prototype,"inputManager",void 0);e([a.property({readOnly:!0})],k.prototype,
"mapViewNavigation",void 0);e([a.property({dependsOn:["mapViewNavigation.interacting"],type:Boolean})],k.prototype,"interacting",null);e([a.property({type:Boolean,constructOnly:!0})],k.prototype,"supersampleScreenhotsEnabled",void 0);e([a.property({type:E})],k.prototype,"ui",void 0);e([a.property({readOnly:!0})],k.prototype,"rendering",void 0);e([a.property({constructOnly:!0})],k.prototype,"renderCanvas",void 0);return k=e([a.subclass("esri.views.MapView")],k)}(a.declared(t,k))})},"esri/views/Magnifier":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators".split(" "),
function(r,l,p,e,h,m){return function(f){function d(d){d=f.call(this)||this;d.factor=1.5;d.offsetX=0;d.offsetY=0;d.position=null;d.visible=!1;return d}p(d,f);Object.defineProperty(d.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});e([m.property({type:Number})],d.prototype,"factor",void 0);e([m.property({type:Number})],d.prototype,"offsetX",void 0);e([m.property({type:Number})],d.prototype,"offsetY",void 0);e([m.property()],d.prototype,"position",
void 0);e([m.property({readOnly:!0,dependsOn:["factor","offsetX","offsetY","position","visible"]})],d.prototype,"version",null);e([m.property({type:Boolean})],d.prototype,"visible",void 0);return d=e([m.subclass("esri.views.Magnifier")],d)}(m.declared(h))})},"esri/views/MapViewBase":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../geometry ../Viewpoint ../core/Error ../core/Handles ../core/Logger ../core/promiseUtils ../core/screenUtils ../core/accessorSupport/decorators ../geometry/support/webMercatorUtils ../layers/support/TileInfo ./PopupView ./View ./ViewAnimation ./2d/AnimationManager ./2d/FrameTask ./2d/MapViewConstraints ./2d/PaddedViewState ./2d/tiling ./2d/viewpointUtils".split(" "),
function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u,w,A,n,E,z,x,y){var C=q.getLogger("esri.views.MapView");return function(q){function t(a){var b=q.call(this,a)||this;b._frameTask=new n.default(b);b._mapViewBaseHandles=new g;b._setup=!1;b.featuresTilingScheme=null;b.fullOpacity=1;b.interacting=!1;b.initialExtent=null;b.labelManager=null;b.resizeAlign="center";b.type="2d";b.constraints=new E;b.padding={top:0,right:0,bottom:0,left:0};var c=function(){this._set("updating",!this.layerViewManager||this.layerViewManager.factory.working||
this.allLayerViews.some(function(a){return!0===a.updating})||this.labelManager&&!0===this.labelManager.updating)}.bind(b),d=b._mapViewBaseHandles;d.add([b.watch("viewpoint",function(a){return b._flipStationary()},!0),b.on("resize",function(a){return b._resizeHandler(a)}),b.watch("animationManager.animation",function(a){b.animation=a}),b.watch("labelManager.updating",c),b.allLayerViews.on("change",function(){c();d.remove("layerViewsUpdating");d.add(b.allLayerViews.map(function(a){return a.watch("updating",
c)}).toArray(),"layerViewsUpdating")})]);c();b.watch("ready",function(a){a?(b._startup(),b._frameTask&&b._frameTask.start()):(b._frameTask&&b._frameTask.stop(),b._tearDown())},!0);return b}e(t,q);t.prototype.destroy=function(){this.destroyed||(this._set("ready",!1),this._mapViewBaseHandles.removeAll(),this.layerViewManager.clear(),this._frameTask.destroy(),this._tearDown(),this._gotoTask=this._mapViewBaseHandles=this._frameTask=null)};Object.defineProperty(t.prototype,"animation",{set:function(a){var b=
this,c=this._get("animation");a!==c&&(c&&c.stop(),!a||a.isFulfilled()?this._set("animation",null):(this._set("animation",a),c=function(){a===b._get("animation")&&(b._set("animation",null),b._frameTask.requestFrame())},a.when(c,c)))},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"center",{get:function(){if(!this._setup)return this._get("center");var a=this.content.center;return new m.Point({x:a[0],y:a[1],spatialReference:this.content.spatialReference})},set:function(a){if(null!=
a)if(this._normalizeInput(a))if(this._setup){var b=this.viewpoint;y.centerAt(b,b,a);this.viewpoint=b}else this._set("center",a),this.notifyChange("initialExtentRequired");else C.error("#center","incompatible spatialReference "+JSON.stringify(a.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"constraints",{set:function(a){var b=this,c=this._get("constraints");c&&(this._mapViewBaseHandles.remove("constraints"),
c.destroy());this._set("constraints",a);a&&(a.view=this,this._setup&&(this.state.viewpoint=a.fit(this.content.viewpoint)),this._mapViewBaseHandles.add(a.on("update",function(){b._setup&&b.state&&(b.state.viewpoint=a.fit(b.content.viewpoint))}),"constraints"))},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"extent",{get:function(){return this._setup?this.content.extent.clone():this._get("extent")},set:function(a){if(null!=a){var b=this._normalizeInput(a);b?b.width&&b.height?this._setup?
(a=this.viewpoint,y.setExtent(a,a,b,this.size,{constraints:this.constraints}),this.viewpoint=a):(this._set("extent",b),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),this.notifyChange("initialExtentRequired")):C.error("#extent","invalid extent size"):C.error("#center","incompatible spatialReference "+JSON.stringify(a.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,
"initialExtentRequired",{get:function(){var a=this.extent,b=this.center,c=this.scale,d=this.viewpoint,k=this.zoom;return this.get("map.initialViewProperties.viewpoint")||a||b&&(0!==c||-1!==k)||d?!1:!0},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"padding",{get:function(){return this._setup?this.state.padding:this._get("padding")},set:function(a){this._setup?(this.state.padding=a,this._set("padding",this.state.padding)):this._set("padding",a)},enumerable:!0,configurable:!0});
Object.defineProperty(t.prototype,"resolution",{get:function(){return this.state?this.state.resolution:0},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"rotation",{get:function(){return this._setup?this.content.rotation:this._get("rotation")},set:function(a){if(!isNaN(a))if(this._setup){var b=this.viewpoint;y.rotateTo(b,b,a);this.viewpoint=b}else this._set("rotation",a)},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"scale",{get:function(){return this._setup?
this.content.scale:this._get("scale")},set:function(a){if(a&&!isNaN(a))if(this._setup){var b=this.viewpoint;y.scaleTo(b,b,a);this.viewpoint=b}else{this._set("scale",a);this._set("zoom",-1);if(a=this._get("extent"))this._set("extent",null),this._set("center",a.center);this.notifyChange("initialExtentRequired")}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"stationary",{get:function(){return!this.animation&&!this.interacting&&!this._get("resizing")&&!this._stationaryTimer},enumerable:!0,
configurable:!0});Object.defineProperty(t.prototype,"viewpoint",{get:function(){if(!this._setup)return this._get("viewpoint");var a=this.content;return a&&a.viewpoint.clone()},set:function(a){if(null!=a){var b=this._normalizeInput(a);b?this._setup?(a=new f({targetGeometry:new m.Point,scale:0,rotation:0}),y.copy(a,b),this.constraints.constrain(a,this.content.viewpoint),this.state.viewpoint=a,this._frameTask.requestFrame(),this._set("viewpoint",a)):(this._set("viewpoint",b),this._set("extent",null),
this._set("center",null),this._set("zoom",-1),this._set("scale",0),this.notifyChange("initialExtentRequired")):!a.scale||isNaN(a.scale)?C.error("#viewpoint","invalid scale value of "+a.scale):a.targetGeometry?C.error("#viewpoint","incompatible spatialReference "+JSON.stringify(a.targetGeometry.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference)):C.error("#viewpoint","geometry not defined")}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"zoom",
{get:function(){return this._setup?this.constraints.scaleToZoom(this.scale):this._get("zoom")},set:function(a){if(null!=a){if(!this._setup){this.notifyChange("initialExtentRequired");this._set("zoom",a);this._set("scale",0);var b=this._get("extent");b&&(this._set("extent",null),this._set("center",b.center))}this.constraints.effectiveLODs&&(b=this.viewpoint,y.scaleTo(b,b,this.constraints.zoomToScale(a)),this.viewpoint=b,this._set("zoom",this.constraints.scaleToZoom(this.scale)))}},enumerable:!0,configurable:!0});
t.prototype.goTo=function(a,b){if(a){this.animation&&(this.animation=null);if(this._setup)return b=p({animate:!0},b),a=y.createAsync(a,this),this._gotoTask={},b.animate?this._gotoAnimated(a,b):this._gotoImmediate(a,b);C.error("#goTo()","MapView cannot be used before it is ready")}else C.error("#goTo()","target cannot be null or undefined")};t.prototype.hitTest=function(a){return c.reject("Should be implemented by subclasses")};t.prototype.popupHitTest=function(a){var b=this;return this.hitTest(a).then(function(c){return p({},
c,{mapPoint:b.toMap(a)})})};t.prototype.toMap=function(a){if(!this._setup)return null;a=this.state.toMap([0,0],[a.x,a.y]);return new m.Point({x:a[0],y:a[1],spatialReference:this.spatialReference})};t.prototype.isTileInfoRequired=function(){return!0};t.prototype.toScreen=function(a){if(!this._setup)return null;a=this._normalizeInput(a);a=[a.x,a.y];a=this.state.toScreen(a,a);return b.createScreenPoint(a[0],a[1])};t.prototype.pixelSizeAt=function(a,b){if(!this._setup)return NaN;a&&null!=a.x&&(b=a.y,
a=a.x);return this.content.pixelSizeAt([a,b])};t.prototype.requestLayerViewUpdate=function(a){this._setup&&this._frameTask.requestLayerViewUpdate(a)};t.prototype.requestUpdate=function(a){this._setup&&this._frameTask.requestUpdate(a)};t.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||null};t.prototype.isSpatialReferenceSupported=function(a,b){return b||this._get("ready")?!0:null!==this._getDefaultViewpoint()};
t.prototype._createOrReplaceAnimation=function(a){if(!this.animation||this.animation.done)this.animation=new w;this.animation.update(a);return this.animation};t.prototype._cancellableGoTo=function(a,b,d){var k=this,e=d.then(function(){a===k._gotoTask&&(k.animation=null)}).catch(function(c){a===k._gotoTask&&(k.animation=null,b.done||b.stop());throw c;}),g=c.create(function(a){return a(e)},function(){a!==k._gotoTask||b.done||b.stop()});b.when().catch(function(){a===k._gotoTask&&g.cancel()});return g};
t.prototype._gotoImmediate=function(a,b){var c=this,k=this._gotoTask,e=this._createOrReplaceAnimation(a);a=a.then(function(a){if(k!==c._gotoTask)throw new d("view:goto-interrupted","Goto was interrupted");c.viewpoint=e.target=a;e.finish()});return this._cancellableGoTo(k,e,a)};t.prototype._gotoAnimated=function(a,b){var c=this,k=this._gotoTask,e=this._createOrReplaceAnimation(a);a=a.then(function(a){if(k!==c._gotoTask)throw new d("view:goto-interrupted","Goto was interrupted");e.update(a);c.animationManager.animate(e,
c.viewpoint,b);return e.when().then(function(){})});return this._cancellableGoTo(k,e,a)};t.prototype._resizeHandler=function(a){var b=this.state;if(b){var c=this.content.viewpoint,d=this.content.size.concat();b.size=[a.width,a.height];y.resize(c,c,d,this.content.size,this.resizeAlign);c=this.constraints.constrain(c,null);this.state.viewpoint=c}};t.prototype._startup=function(){if(!this._setup){var a=this._getDefaultViewpoint();this.constraints.view=this;this.constraints.fit(a);this._set("animationManager",
new A({view:this}));this._set("state",new z({padding:this._get("padding"),size:this.size,viewpoint:a}));this._set("content",this.state.content);this._set("featuresTilingScheme",new x.TileInfoView(v.create({spatialReference:this.spatialReference,size:512})));this._setup=!0}};t.prototype._tearDown=function(){if(this._setup){this._setup=!1;this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null,this.notifyChange("stationary"));var a=this._get("content"),b=a.center,c=a.spatialReference,
b=new m.Point({x:b[0],y:b[1],spatialReference:c});this._set("viewpoint",null);this._set("extent",null);this._set("center",b);this._set("zoom",-1);this._set("rotation",a.rotation);this._set("scale",a.scale);this._set("spatialReference",c);this.constraints.view=null;this.animationManager.destroy();this._set("animationManager",null);this._set("state",null);this._set("content",null);this.animation=null}};t.prototype._flipStationary=function(){var a=this;this._stationaryTimer&&clearTimeout(this._stationaryTimer);
this._stationaryTimer=setTimeout(function(){a._stationaryTimer=null;a.notifyChange("stationary")},160);this.notifyChange("stationary")};t.prototype._normalizeInput=function(a,b){void 0===b&&(b=this.spatialReference);var c=a&&a.targetGeometry||a;return b?c?b.equals(c.spatialReference)?a:k.canProject(c,b)?a&&"esri.Viewpoint"===a.declaredClass?(a.targetGeometry=k.project(c,b),a):k.project(c,b):null:null:a};t.prototype._getDefaultViewpoint=function(){var a=this.constraints,b=this._get("zoom"),c=this._get("scale"),
d=this._normalizeInput(this._get("center")),k=this._normalizeInput(this._get("extent")),e=this._get("rotation"),g=this._normalizeInput(this._get("viewpoint"));a.effectiveLODs?-1!==b&&(c=a.zoomToScale(b)):b=-1;var q=null,t=null,b=0,a=g&&g.rotation,v=g&&g.targetGeometry;v&&("extent"===v.type?q=v:"point"===v.type&&(t=v,b=g.scale));g=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent"));v=this._normalizeInput(this.initialExtent);k=k||q||g||v;d=d||t||k&&k.center;c=
c||b||k&&y.extentToScale(k,this.size);return d&&c?new f({targetGeometry:d,scale:c,rotation:e||a||0}):null};h([a.property()],t.prototype,"animation",null);h([a.property({readOnly:!0})],t.prototype,"animationManager",void 0);h([a.property({value:null,type:m.Point,dependsOn:["content.viewpoint"]})],t.prototype,"center",null);h([a.property({type:E})],t.prototype,"constraints",null);h([a.property({readOnly:!0})],t.prototype,"content",void 0);h([a.property({value:null,type:m.Extent,dependsOn:["content.viewpoint"]})],
t.prototype,"extent",null);h([a.property({readOnly:!0})],t.prototype,"featuresTilingScheme",void 0);h([a.property()],t.prototype,"fullOpacity",void 0);h([a.property({readOnly:!0})],t.prototype,"interacting",void 0);h([a.property({type:m.Extent})],t.prototype,"initialExtent",void 0);h([a.property({dependsOn:["map.initialViewProperties?.viewpoint"]})],t.prototype,"initialExtentRequired",null);h([a.property()],t.prototype,"labelManager",void 0);h([a.property({value:{top:0,right:0,bottom:0,left:0},cast:function(a){return p({top:0,
right:0,bottom:0,left:0},a)}})],t.prototype,"padding",null);h([a.property()],t.prototype,"resizeAlign",void 0);h([a.property({readOnly:!0,dependsOn:["content.viewpoint"]})],t.prototype,"resolution",null);h([a.property({value:0,type:Number,dependsOn:["content.viewpoint"]})],t.prototype,"rotation",null);h([a.property({value:0,type:Number,dependsOn:["content.viewpoint"]})],t.prototype,"scale",null);h([a.property({type:m.SpatialReference,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],
t.prototype,"spatialReference",void 0);h([a.property({readOnly:!0})],t.prototype,"state",void 0);h([a.property()],t.prototype,"stationary",null);h([a.property({readOnly:!0})],t.prototype,"type",void 0);h([a.property({value:null,type:f,dependsOn:["content.viewpoint"]})],t.prototype,"viewpoint",null);h([a.property({value:-1,dependsOn:["scale"]})],t.prototype,"zoom",null);return t=h([a.subclass("esri.views.MapViewBase")],t)}(a.declared(u,t))})},"esri/views/2d/AnimationManager":function(){define("../../Viewpoint ../../core/Accessor ../../core/scheduling ../../core/now ../../geometry/Point ../ViewAnimation ./unitBezier ./viewpointUtils".split(" "),
function(r,l,p,e,h,m,f,d){var g=function(d,c,b,a){var k=d.targetGeometry,e=c.targetGeometry;a?"string"===typeof a&&(a=f.parse(a)||f.ease):a=f.ease;this.easing=a;this.duration=b;this.sCenterX=k.x;this.sCenterY=k.y;this.sScale=d.scale;this.sRotation=d.rotation;this.tCenterX=e.x;this.tCenterY=e.y;this.tScale=c.scale;this.tRotation=c.rotation;this.dCenterX=this.tCenterX-this.sCenterX;this.dCenterY=this.tCenterY-this.sCenterY;this.dScale=this.tScale-this.sScale;this.dRotation=this.tRotation-this.sRotation;
180<this.dRotation?this.dRotation-=360:-180>this.dRotation&&(this.dRotation+=360)};g.prototype.applyRatio=function(d,c){var b=this.easing(c),a,k;1<=c?(c=this.tCenterX,a=this.tCenterY,k=this.tRotation,b=this.tScale):(c=this.sCenterX+b*this.dCenterX,a=this.sCenterY+b*this.dCenterY,k=this.sRotation+b*this.dRotation,b=this.sScale+b*this.dScale);d.targetGeometry.x=c;d.targetGeometry.y=a;d.scale=b;d.rotation=k};return l.createSubclass({constructor:function(){this.viewpoint=new r({targetGeometry:new h,scale:0,
rotation:0});this._updateTask=p.addFrameTask({postRender:this._postRender.bind(this)});this._updateTask.pause()},properties:{animation:null,duration:{value:200},transition:{value:null},easing:{value:f.ease},view:null,viewpoint:null},animate:function(f,c,b){this.stop();d.copy(this.viewpoint,c);this.transition=new g(this.viewpoint,f.target,b&&b.duration||this.duration,b&&b.easing||this.easing);c=function(){this.animation===f&&this._updateTask&&("finished"===f.state&&(this.transition.applyRatio(this.viewpoint,
1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this._updateTask.pause(),this.updateFunction=this.animation=null)}.bind(this);f.when(c,c);this._startTime=e();this._updateTask.resume();return this.animation=f},animateContinous:function(d,c){this.stop();this.updateFunction=c;this.viewpoint=d;var b=new m({target:d.clone()});d=function(){this.animation===b&&this._updateTask&&(this._updateTask.pause(),this.updateFunction=this.animation=null)}.bind(this);b.when(d,d);this._startTime=
e();this._updateTask.resume();return this.animation=b},stop:function(){this.animation&&(this.animation.stop(),this.updateFunction=this.animation=null)},_postRender:function(d){var c=this.animation;c&&c.state!==m.STOPPED?(this.updateFunction?this.updateFunction(this.viewpoint,d.deltaTime):(d=(e()-this._startTime)/this.transition.duration,c=1<=d,this.transition.applyRatio(this.viewpoint,d),c&&this.animation.finish()),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())):this._updateTask.pause()}})})},
"esri/views/2d/unitBezier":function(){define([],function(){var r=function(p,e,h,m){function f(a,b){var c,k,e,f;b=null==b?1E-6:b;e=a;for(k=0;8>k;k++){f=((q*e+g)*e+d)*e-a;if(Math.abs(f)<b)return e;c=(3*q*e+2*g)*e+d;if(1E-6>Math.abs(c))break;e-=f/c}c=0;k=1;e=a;if(e<c)return c;if(e>k)return k;for(;c<k;){f=((q*e+g)*e+d)*e;if(Math.abs(f-a)<b)break;a>f?c=e:k=e;e=.5*(k-c)+c}return e}var d=3*p,g=3*(h-p)-d,q=1-d-g,c=3*e,b=3*(m-e)-c,a=1-c-b;return function(d,e){d=f(d,e);return((a*d+b)*d+c)*d}},l=/^cubic-bezier\((.*)\)/;
r.parse=function(p){var e=r[p]||null;!e&&(p=l.exec(p))&&(p=p[1].split(",").map(function(e){return parseFloat(e.trim())}),4!==p.length||p.some(function(e){return isNaN(e)})||(e=r.apply(r,p)));return e};r.ease=r(.25,.1,.25,1);r.linear=r(0,0,1,1);r.easeIn=r["ease-in"]=r(.42,0,1,1);r.easeOut=r["ease-out"]=r(0,0,.58,1);r.easeInOut=r["ease-in-out"]=r(.42,0,.58,1);return r})},"esri/views/2d/FrameTask":function(){define(["require","exports","../../core/scheduling"],function(r,l,p){Object.defineProperty(l,
"__esModule",{value:!0});r=function(){function e(e){var h=this;this.view=e;this._frameTaskHandle=null;this.updateEnabled=this.stationary=!0;this.prepare=function(){h._updateParameters.state=h.view.state;h._updateParameters.stationary=h.view.stationary;h._updateParameters.pixelRatio=window.devicePixelRatio};this.update=function(){if(h.updateEnabled){for(var e=h.view,d=e.labelManager,g=h.graphicsView,q=e.allLayerViews.toArray().filter(function(a){return a.isFulfilled()&&null==a.layerViews}),c=q.length,
b=e.state,a=0;a<q.length;a++)if(e=q[a],e.attached){var k=e.lastUpdateId;if(null==k||!h.stationary&&!e.moving)e.moving=!0,e.moveStart();k!==b.id&&e.viewChange();h.stationary&&e.moving&&(e.moving=!1,e.moveEnd());e.lastUpdateId=b.id}d&&d.lastUpdateId!==b.id&&(d.viewChange(),d.lastUpdateId=b.id);g&&g.lastUpdateId!==b.id&&(g.viewChange(),g.lastUpdateId=b.id);d=h._layerViewsTrash;for(g=0;g<d.length;g++)e=d[g],h._detachLayerView(e);for(g=d.length=0;g<c;g++)e=q[g],e.isFulfilled()&&!e.attached&&h._attachLayerView(e);
q=h._updateParameters;c=h._layerViewsToUpdate;e=c.slice();g=c.length=0;for(b=e;g<b.length;g++)e=b[g],!("attached"in e)||"attached"in e&&e.attached?e.processUpdate(q):c.push(e);c=h._updatablesToUpdate;e=c.slice();for(c=c.length=0;c<e.length;c++)e[c].processUpdate(q);0===h._layerViewsToUpdate.length&&0===h._updatablesToUpdate.length&&0===d.length&&h._frameTaskHandle.pause()}}}e.prototype.destroy=function(){this.stop()};e.prototype.start=function(){var e=this;this._updateParameters={state:this.view.state,
pixelRatio:window.devicePixelRatio,stationary:!0};this._layerViewsTrash=[];this._layerViewsToUpdate=[];this._updatablesToUpdate=[];this._allLayerViewsChangeHandle=this.view.allLayerViews.on("change",function(h){Array.prototype.push.apply(e._layerViewsTrash,h.removed);e.requestFrame()});this._stationaryHandle=this.view.watch("stationary",function(h){e.stationary=h;e.requestFrame()});this._frameTaskHandle=p.addFrameTask(this)};e.prototype.stop=function(){var e=this;this._frameTaskHandle&&(this.view.allLayerViews.forEach(function(h){return e._detachLayerView(h)}),
this._stationaryHandle.remove(),this._allLayerViewsChangeHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._allLayerViewsChangeHandle=this._frameTaskHandle=this._layerViewsTrash=this._layerViewsToUpdate=null,this.stationary=!0)};e.prototype.requestLayerViewUpdate=function(e){this._layerViewsToUpdate.push(e);this.requestFrame()};e.prototype.requestUpdate=function(e){this._updatablesToUpdate.push(e);this.requestFrame()};e.prototype.requestFrame=function(){this._frameTaskHandle&&
this._frameTaskHandle.resume()};e.prototype._attachLayerView=function(e){e.attached||(e.attached=!0,e.attach(),this._updateParameters.stationary?e.moving=!1:(e.moving=!0,e.moveStart()))};e.prototype._detachLayerView=function(e){e.attached&&(e.detach(),e.attached=!1,e.moving=!1)};return e}();l.default=r})},"esri/views/2d/MapViewConstraints":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/accessorSupport/decorators ../../layers/support/LOD ./constraints/RotationConstraint ./constraints/ZoomConstraint".split(" "),
function(r,l,p,e,h,m,f,d,g,q){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.enabled=!0;a.lods=null;a.minScale=0;a.maxScale=0;a.minZoom=-1;a.maxZoom=-1;a.rotationEnabled=!0;a.snapToZoom=!0;return a}p(b,c);b.prototype.initialize=function(){this.watch("_zoom, _rotation",this.emit.bind(this,"update"),!0)};b.prototype.destroy=function(){this.view=null;this._set("_zoom",null);this._set("_rotation",null)};Object.defineProperty(b.prototype,"_rotation",{get:function(){return new g({rotationEnabled:this.rotationEnabled})},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_defaultLODs",{get:function(){var a=this.get("view.defaultsFromMap.tileInfo"),b=this.get("view.spatialReference");return a&&b&&a.spatialReference.equals(b)?a.lods:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_zoom",{get:function(){return new q({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})},enumerable:!0,
configurable:!0});b.prototype.canZoomInTo=function(a){var b=this.effectiveMaxScale;return 0===b||a>=b};b.prototype.canZoomOutTo=function(a){var b=this.effectiveMinScale;return 0===b||a<=b};b.prototype.constrain=function(a,b){if(!this.enabled)return a;this._zoom.constrain(a,b);this._rotation.constrain(a,b);return a};b.prototype.fit=function(a){if(!this.enabled||!this.snapToZoom)return a;this._zoom.fit(a);return a};b.prototype.zoomToScale=function(a){return this._zoom.zoomToScale(a)};b.prototype.scaleToZoom=
function(a){return this._zoom.scaleToZoom(a)};b.prototype.snapScale=function(a){return this._zoom.snapToClosestScale(a)};b.prototype.snapToNextScale=function(a){return this._zoom.snapToNextScale(a)};b.prototype.snapToPreviousScale=function(a){return this._zoom.snapToPreviousScale(a)};e([f.property({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],b.prototype,"effectiveLODs",void 0);e([f.property({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],b.prototype,"effectiveMinScale",void 0);e([f.property({readOnly:!0,
aliasOf:"_zoom.effectiveMaxScale"})],b.prototype,"effectiveMaxScale",void 0);e([f.property({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],b.prototype,"effectiveMinZoom",void 0);e([f.property({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],b.prototype,"effectiveMaxZoom",void 0);e([f.property()],b.prototype,"enabled",void 0);e([f.property({type:[d]})],b.prototype,"lods",void 0);e([f.property()],b.prototype,"minScale",void 0);e([f.property()],b.prototype,"maxScale",void 0);e([f.property()],b.prototype,
"minZoom",void 0);e([f.property()],b.prototype,"maxZoom",void 0);e([f.property()],b.prototype,"rotationEnabled",void 0);e([f.property()],b.prototype,"snapToZoom",void 0);e([f.property()],b.prototype,"view",void 0);e([f.property({type:g,dependsOn:["rotationEnabled"]})],b.prototype,"_rotation",null);e([f.property({dependsOn:["view.spatialReference","view.defaultsFromMap.tileInfo"]})],b.prototype,"_defaultLODs",null);e([f.property({readOnly:!0,type:q,dependsOn:"lods minZoom maxZoom minScale maxScale snapToZoom _defaultLODs".split(" ")})],
b.prototype,"_zoom",null);return b=e([f.subclass("esri.views.2d.MapViewConstraints")],b)}(f.declared(h,m))})},"esri/views/2d/constraints/RotationConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(r,l,p,e,h,m){return function(f){function d(){var d=null!==f&&f.apply(this,arguments)||this;d.enabled=!0;d.rotationEnabled=!0;return d}p(d,f);
g=d;d.prototype.constrain=function(d,c){if(!this.enabled||!c)return d;this.rotationEnabled||(d.rotation=c.rotation);return d};d.prototype.clone=function(){return new g({enabled:this.enabled,rotationEnabled:this.rotationEnabled})};var g;e([m.property()],d.prototype,"enabled",void 0);e([m.property()],d.prototype,"rotationEnabled",void 0);return d=g=e([m.subclass("esri.views.2d.constraints.RotationConstraint")],d)}(m.declared(h))})},"esri/views/2d/constraints/ZoomConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../layers/support/LOD".split(" "),
function(r,l,p,e,h,m,f){return function(d){function g(){var c=null!==d&&d.apply(this,arguments)||this;c._lodByScale={};c._scales=[];c.effectiveLODs=null;c.effectiveMinZoom=-1;c.effectiveMaxZoom=-1;c.effectiveMinScale=0;c.effectiveMaxScale=0;c.enabled=!0;c.lods=null;c.minZoom=-1;c.maxZoom=-1;c.minScale=0;c.maxScale=0;c.snapToZoom=!0;return c}p(g,d);q=g;g.prototype.initialize=function(){var c=this,b,a,d=this.lods;a=this.minScale;b=this.maxScale;var e=this.minZoom,g=this.maxZoom,f=-1,q=-1,h=!1,n=!1;
0!==a&&0!==b&&a<b&&(b=[b,a],a=b[0],b=b[1]);if(d&&d.length){d=d.map(function(a){return a.clone()});d.sort(function(a,b){return b.scale-a.scale});d.forEach(function(a,b){return a.level=b});for(var m,p=0,x=d;p<x.length;p++){var y=x[p];!h&&0<a&&a>=y.scale&&(f=y.level,h=!0);!n&&0<b&&b>=y.scale&&(q=m?m.level:-1,n=!0);m=y}-1===e&&(e=0===a?0:f);-1===g&&(g=0===b?d.length-1:q);e=Math.max(e,0);e=Math.min(e,d.length-1);g=Math.max(g,0);g=Math.min(g,d.length-1);e>g&&(a=[g,e],e=a[0],g=a[1]);a=d[e].scale;b=d[g].scale;
d.splice(0,e);d.splice(g-e+1,d.length);d.forEach(function(a,b){c._lodByScale[a.scale]=a;c._scales[b]=a.scale});this._set("effectiveLODs",d);this._set("effectiveMinZoom",e);this._set("effectiveMaxZoom",g)}this._set("effectiveMinScale",a);this._set("effectiveMaxScale",b)};g.prototype.constrain=function(c,b){if(!this.enabled||b&&c.scale===b.scale)return c;var a=this.effectiveMinScale,d=this.effectiveMaxScale,e=c.targetGeometry,g=b&&b.targetGeometry,f=0!==a&&c.scale>a;if(0!==d&&c.scale<d||f)a=f?a:d,g&&
(b=(a-b.scale)/(c.scale-b.scale),e.x=g.x+(e.x-g.x)*b,e.y=g.y+(e.y-g.y)*b),c.scale=a;this.snapToZoom&&this.effectiveLODs&&(c.scale=this._getClosestScale(c.scale));return c};g.prototype.fit=function(c){if(!this.effectiveLODs)return this.constrain(c,null);var b=this.scaleToZoom(c.scale);c.scale=this.zoomToScale(.99<Math.abs(b-Math.floor(b))?Math.round(b):Math.floor(b));return c};g.prototype.zoomToScale=function(c){if(!this.effectiveLODs)return 0;c-=this.effectiveMinZoom;c=Math.max(0,c);var b=this._scales;
if(0>=c)return b[0];if(c>=b.length)return b[b.length-1];var a=Math.round(c);return b[a]+(a-c)*(b[Math.round(c-.5)]-b[a])};g.prototype.scaleToZoom=function(c){if(!this.effectiveLODs)return-1;var b=this._scales,a=0,d=b.length-1,e,g;for(a;a<d;a++){e=b[a];g=b[a+1];if(e<=c)return a+this.effectiveMinZoom;if(g===c)return a+1+this.effectiveMinZoom;if(e>c&&g<c)return a+1-(c-g)/(e-g)+this.effectiveMinZoom}return a};g.prototype.snapToClosestScale=function(c){if(!this.effectiveLODs)return c;c=this.scaleToZoom(c);
return this.zoomToScale(Math.round(c))};g.prototype.snapToNextScale=function(c,b){void 0===b&&(b=.5);if(!this.effectiveLODs)return c*b;c=Math.round(this.scaleToZoom(c));return this.zoomToScale(c+1)};g.prototype.snapToPreviousScale=function(c,b){void 0===b&&(b=2);if(!this.effectiveLODs)return c*b;c=Math.round(this.scaleToZoom(c));return this.zoomToScale(c-1)};g.prototype.clone=function(){return new q({enabled:this.enabled,lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,
maxScale:this.maxScale})};g.prototype._getClosestScale=function(c){if(this._lodByScale[c])return this._lodByScale[c].scale;c=this._scales.reduce(function(b,a,d,e){return Math.abs(a-c)<=Math.abs(b-c)?a:b},this._scales[0]);return this._lodByScale[c].scale};var q;e([m.property({readOnly:!0})],g.prototype,"effectiveLODs",void 0);e([m.property({readOnly:!0})],g.prototype,"effectiveMinZoom",void 0);e([m.property({readOnly:!0})],g.prototype,"effectiveMaxZoom",void 0);e([m.property({readOnly:!0})],g.prototype,
"effectiveMinScale",void 0);e([m.property({readOnly:!0})],g.prototype,"effectiveMaxScale",void 0);e([m.property()],g.prototype,"enabled",void 0);e([m.property({type:[f]})],g.prototype,"lods",void 0);e([m.property()],g.prototype,"minZoom",void 0);e([m.property()],g.prototype,"maxZoom",void 0);e([m.property()],g.prototype,"minScale",void 0);e([m.property()],g.prototype,"maxScale",void 0);e([m.property()],g.prototype,"snapToZoom",void 0);return g=q=e([m.subclass("esri.views.2d.constraints.ZoomConstraint")],
g)}(m.declared(h))})},"esri/views/2d/PaddedViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ./viewpointUtils ./ViewState".split(" "),function(r,l,p,e,h,m,f,d,g,q){var c=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.left=0;a.top=0;a.right=0;a.bottom=0;return a}p(a,b);e([m.property()],
a.prototype,"left",void 0);e([m.property()],a.prototype,"top",void 0);e([m.property()],a.prototype,"right",void 0);e([m.property()],a.prototype,"bottom",void 0);return a=e([m.subclass("esri.views.2d.PaddedViewState.Padding")],a)}(m.declared(h));return function(b){function a(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];var g=b.apply(this,a)||this;g.content=new q;g._updateContent=function(){var a=d.vec2f64.create();return function(){var b=g._get("size"),c=g._get("padding");if(b&&c){var d=
g.content;f.vec2.set(a,c.left+c.right,c.top+c.bottom);f.vec2.subtract(a,b,a);f.vec2.copy(d.size,a);if(b=d.viewpoint)g.viewpoint=b}}}();g.watch(["size","padding"],g._updateContent,!0);g.padding=new c;g.size=[0,0];return g}p(a,b);Object.defineProperty(a.prototype,"padding",{set:function(a){this._set("padding",a||new c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewpoint",{set:function(a){if(a){var b=a.clone();this.content.viewpoint=a;g.addPadding(b,a,this._get("size"),this._get("padding"));
a=this._viewpoint2D;var c=b.targetGeometry;a.center[0]=c.x;a.center[1]=c.y;a.rotation=b.rotation;a.scale=b.scale;a.spatialReference=c.spatialReference;this._update()}},enumerable:!0,configurable:!0});e([m.property()],a.prototype,"content",void 0);e([m.property({type:c})],a.prototype,"padding",null);e([m.property()],a.prototype,"viewpoint",null);return a=e([m.subclass("esri.views.2d.PaddedViewState")],a)}(m.declared(q))})},"esri/views/2d/tiling":function(){define("require exports ./tiling/TileInfoView ./tiling/TileKey ./tiling/TileQueue ./tiling/TileStrategy".split(" "),
function(r,l,p,e,h,m){Object.defineProperty(l,"__esModule",{value:!0});l.TileInfoView=p;l.TileKey=e;l.TileQueue=h;l.TileStrategy=m})},"esri/views/2d/tiling/TileInfoView":function(){define("require exports ../../../geometry/support/spatialReferenceUtils ./LODInfo ./TileCoverage ./TileKey ./TileSpan".split(" "),function(r,l,p,e,h,m,f){var d=new m("0/0/0/0"),g=function(){function c(b,a,c,d,e,g,f,q){this.x=b;this.ymin=a;this.ymax=c;this.invM=d;this.leftAdjust=e;this.rightAdjust=g;this.leftBound=f;this.rightBound=
q}c.create=function(b,a){var d;b[1]>a[1]&&(d=[a,b],b=d[0],a=d[1]);d=b[0];b=b[1];var e=a[0];a=a[1];var g=e-d,f=a-b,f=0!==f?g/f:0,q=(Math.ceil(b)-b)*f,h=(Math.floor(b)-b)*f;return new c(d,Math.floor(b),Math.ceil(a),f,0>g?q:h,0>g?h:q,0>g?e:d,0>g?d:e)};c.prototype.incrRow=function(){this.x+=this.invM};c.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)};c.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)};return c}(),q=[[0,0],
[0,0],[0,0],[0,0]];return function(){function c(b,a){var c=this;this.tileInfo=b;this.fullExtent=a;this.scales=[];this._lodInfos=null;this._infoByScale={};this._infoByLevel={};var d=b.lods.slice();d.sort(function(a,b){return b.scale-a.scale});var g=this._lodInfos=d.map(function(c){return e.create(b,c,a)});d.forEach(function(a,b){c._infoByLevel[a.level]=g[b];c._infoByScale[a.scale]=g[b];c.scales[b]=a.scale},this);this._wrap=b.isWrappable}Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},
enumerable:!0,configurable:!0});c.prototype.getLODInfoAt=function(b){return this._infoByLevel["number"===typeof b?b:b.level]};c.prototype.getTileBounds=function(b,a,c){void 0===c&&(c=!1);d.set(a);return(a=this._infoByLevel[d.level])?a.getTileBounds(b,d,c):b};c.prototype.getTileCoords=function(b,a,c){void 0===c&&(c=!1);d.set(a);return(a=this._infoByLevel[d.level])?a.getTileCoords(b,d,c):b};c.prototype.getTileCoverage=function(b,a,c){void 0===a&&(a=192);void 0===c&&(c="closest");c="closest"===c?this.getClosestInfoForScale(b.scale):
this.getSmallestInfoForScale(b.scale);var d=h.pool.acquire(c),e=this._wrap,k;k=Infinity;var m=-Infinity,p,n,l=d.spans;q[0][0]=q[0][1]=q[1][1]=q[3][0]=-a;q[1][0]=q[2][0]=b.size[0]+a;q[2][1]=q[3][1]=b.size[1]+a;for(a=0;a<q.length;a++){var z=q[a];b.toMap(z,z);z[0]=c.getColumnForX(z[0]);z[1]=c.getRowForY(z[1])}b=[];z=3;for(a=0;4>a;a++){if(q[a][1]!==q[z][1]){var x=g.create(q[a],q[z]);k=Math.min(x.ymin,k);m=Math.max(x.ymax,m);void 0===b[x.ymin]&&(b[x.ymin]=[]);b[x.ymin].push(x)}z=a}if(null==k||null==m||
100<m-k)return null;for(z=[];k<m;){null!=b[k]&&(z=z.concat(b[k]));p=Infinity;n=-Infinity;for(a=z.length-1;0<=a;a--)x=z[a],p=Math.min(p,x.getLeftCol()),n=Math.max(n,x.getRightCol());p=Math.floor(p);n=Math.floor(n);if(k>=c.first[1]&&k<=c.last[1])if(e)if(c.size[0]<c.worldSize[0])for(x=Math.floor(n/c.worldSize[0]),a=Math.floor(p/c.worldSize[0]);a<=x;a++)l.push(new f(k,Math.max(c.getFirstColumnForWorld(a),p),Math.min(c.getLastColumnForWorld(a),n)));else l.push(new f(k,p,n));else p>c.last[0]||n<c.first[0]||
(p=Math.max(p,c.first[0]),n=Math.min(n,c.last[0]),l.push(new f(k,p,n)));k+=1;for(a=z.length-1;0<=a;a--)x=z[a],x.ymax>=k?x.incrRow():z.splice(a,1)}return d};c.prototype.getTileParentId=function(b){d.set(b);b=this._lodInfos.indexOf(this._infoByLevel[d.level])-1;if(0>b)return null;this._getTileIdAtLOD(d,this._lodInfos[b],d);return d.id};c.prototype.getTileResolution=function(b){return(b=this._infoByLevel["object"===typeof b?b.level:b])?b.resolution:-1};c.prototype.getTileScale=function(b){return(b=this._infoByLevel[b.level])?
b.scale:-1};c.prototype.intersects=function(b,a){d.set(a);a=this._infoByLevel[d.level];var c=b.lodInfo;if(c.resolution>a.resolution){this._getTileIdAtLOD(d,c,d);for(var e=c.denormalizeCol(d.col,d.world),g=0,f=b.spans;g<f.length;g++){var q=f[g];if(q.row===d.row&&q.colFrom<=e&&q.colTo>=e)return!0}}if(c.resolution<a.resolution){f=b.spans.reduce(function(a,b){a[0]=Math.min(a[0],b.row);a[1]=Math.max(a[1],b.row);a[2]=Math.min(a[2],b.colFrom);a[3]=Math.max(a[3],b.colTo);return a},[Infinity,-Infinity,Infinity,
-Infinity]);b=f[0];var e=f[1],g=f[2],f=f[3],h=a.denormalizeCol(d.col,d.world),q=c.getColumnForX(a.getXForColumn(h)),n=c.getRowForY(a.getYForRow(d.row)),h=c.getColumnForX(a.getXForColumn(h+1))-1;a=c.getRowForY(a.getYForRow(d.row+1))-1;return!(q>f||h<g||n>e||a<b)}var m=c.denormalizeCol(d.col,d.world);return b.spans.some(function(a){return a.row===d.row&&a.colFrom<=m&&a.colTo>=m})};c.prototype.normalizeBounds=function(b,a,c){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];this._wrap&&(a=p.getInfo(this.tileInfo.spatialReference),
c=-c*(a.valid[1]-a.valid[0]),b[0]+=c,b[2]+=c);return b};c.prototype.getSmallestInfoForScale=function(b){var a=this.scales;if(this._infoByScale[b])return this._infoByScale[b];if(b>a[0])return this._infoByScale[a[0]];for(var c=1;c<a.length-1;c++)if(b>a[c])return this._infoByScale[a[c-1]];return this._infoByScale[a[a.length-1]]};c.prototype.getClosestInfoForScale=function(b){var a=this.scales;if(this._infoByScale[b])return this._infoByScale[b];b=a.reduce(function(a,c,d,e){return Math.abs(c-b)<Math.abs(a-
b)?c:a},a[0]);return this._infoByScale[b]};c.prototype.scaleToLevel=function(b){var a=this.scales;if(this._infoByScale[b])return this._infoByScale[b].level;for(var c=a.length-1;0<=c;c--)if(b<a[c])return c===a.length-1?this._infoByScale[a[a.length-1]].level:this._infoByScale[a[c]].level+(a[c]-b)/(a[c]-a[c+1]);return this._infoByScale[a[0]].level};c.prototype.scaleToZoom=function(b){return this.tileInfo.scaleToZoom(b)};c.prototype._getTileIdAtLOD=function(b,a,c){var d=this._infoByLevel[c.level];b.set(c);
if(a.resolution<d.resolution)return null;if(a.resolution===d.resolution)return b;b.level=a.level;b.col=Math.floor(c.col*d.resolution/a.resolution+.01);b.row=Math.floor(c.row*d.resolution/a.resolution+.01);return b};return c}()})},"esri/views/2d/tiling/LODInfo":function(){define(["require","exports","../../../geometry/support/spatialReferenceUtils","./TileKey"],function(r,l,p,e){function h(e,d,g){e[0]=d;e[1]=g;return e}var m=new e("0/0/0/0");return function(){function e(d,e,f,c,b,a,k,h,t,m,p,l){this.level=
d;this.resolution=e;this.scale=f;this.origin=c;this.first=b;this.last=a;this.size=k;this.norm=h;this.worldStart=t;this.worldEnd=m;this.worldSize=p;this.wrap=l}e.create=function(d,g,f){var c=p.getInfo(d.spatialReference),b=[d.origin.x,d.origin.y],a=[d.size[0]*g.resolution,d.size[1]*g.resolution],k=[-Infinity,-Infinity],q=[Infinity,Infinity],t=[Infinity,Infinity];f&&(h(k,Math.max(0,Math.floor((f.xmin-b[0])/a[0])),Math.max(0,Math.floor((b[1]-f.ymax)/a[1]))),h(q,Math.max(0,Math.floor((f.xmax-b[0])/a[0])),
Math.max(0,Math.floor((b[1]-f.ymin)/a[1]))),h(t,q[0]-k[0]+1,q[1]-k[1]+1));var m;d.isWrappable?(d=[Math.ceil(Math.round(2*c.origin[1]/g.resolution)/d.size[0]),t[1]],c=[Math.floor((c.origin[0]-b[0])/a[0]),k[1]],f=[d[0]+c[0]-1,q[1]],m=!0):(c=k,f=q,d=t,m=!1);return new e(g.level,g.resolution,g.scale,b,k,q,t,a,c,f,d,m)};e.prototype.normalizeCol=function(d){if(!this.wrap)return d;var e=this.worldSize[0];return 0>d?e-1-Math.abs((d+1)%e):d%e};e.prototype.denormalizeCol=function(d,e){return this.wrap?this.worldSize[0]*
e+d:d};e.prototype.getWorldForColumn=function(d){return this.wrap?Math.floor(d/this.worldSize[0]):0};e.prototype.getFirstColumnForWorld=function(d){return d*this.worldSize[0]+this.first[0]};e.prototype.getLastColumnForWorld=function(d){return d*this.worldSize[0]+this.first[0]+this.size[0]-1};e.prototype.getColumnForX=function(d){return(d-this.origin[0])/this.norm[0]};e.prototype.getXForColumn=function(d){return this.origin[0]+d*this.norm[0]};e.prototype.getRowForY=function(d){return(this.origin[1]-
d)/this.norm[1]};e.prototype.getYForRow=function(d){return this.origin[1]-d*this.norm[1]};e.prototype.getTileBounds=function(d,e,f){void 0===f&&(f=!1);m.set(e);var c=f?m.col:this.denormalizeCol(m.col,m.world),b=m.row;e=this.getXForColumn(c);f=this.getYForRow(b+1);c=this.getXForColumn(c+1);b=this.getYForRow(b);d[0]=e;d[1]=f;d[2]=c;d[3]=b;return d};e.prototype.getTileCoords=function(d,e,f){void 0===f&&(f=!1);m.set(e);e=f?m.col:this.denormalizeCol(m.col,m.world);Array.isArray(d)?h(d,this.getXForColumn(e),
this.getYForRow(m.row)):(d.x=this.getXForColumn(e),d.y=this.getYForRow(m.row));return d};return e}()})},"esri/views/2d/tiling/TileCoverage":function(){define(["require","exports","../../../core/ArrayPool","../../../core/ObjectPool","./TileSpan"],function(r,l,p,e,h){return function(){function m(e){this.lodInfo=e;this.spans=p.acquire()}m.prototype.release=function(){for(var e=0,d=this.spans;e<d.length;e++)h.pool.release(d[e]);p.release(this.spans)};m.prototype.forEach=function(e,d){var g=this.spans,
f=this.lodInfo,c=f.level;if(0!==g.length)for(var b=0;b<g.length;b++)for(var a=g[b],k=a.row,h=a.colTo,a=a.colFrom;a<=h;a++)e.call(d,c,k,f.normalizeCol(a),f.getWorldForColumn(a))};m.pool=new e(m,!0);return m}()})},"esri/views/2d/tiling/TileSpan":function(){define(["require","exports","../../../core/ObjectPool"],function(r,l,p){return function(){function e(e,m,f){this.row=e;this.colFrom=m;this.colTo=f}e.pool=new p(e,!0);return e}()})},"esri/views/2d/tiling/TileQueue":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../views/support/QueueProcessor".split(" "),
function(r,l,p,e,h,m,f,d){function g(a,b){a.length=0;b.forEach(function(b){return a.push(b)});return a}var q=new Set,c=[],b=new Map,a=[0,0];return function(k){function h(a){a=k.call(this,a)||this;a._keysToRequests=new Map;a.concurrency=6;a.process=null;a.strategy="scale-first";a.tileInfoView=null;a.tileServers=null;return a}p(h,k);h.prototype.initialize=function(){var a=this,b="scale-first"===this.strategy?this._peekByScaleFirst.bind(this):this._peekByCenterFirst.bind(this),c=this.tileServers,e=this.concurrency,
g=this.process;this._queues=c&&0<c.length?c.map(function(c){return new d({concurrency:e,process:function(b){b=a._keysToRequests.get(b);return g(b,c)},peeker:b})}):[new d({concurrency:e,process:function(b){b=a._keysToRequests.get(b);return g(b)},peeker:b})]};h.prototype.destroy=function(){this.clear();for(var a=0,b=this._queues;a<b.length;a++)b[a].destroy();this._queues=null};Object.defineProperty(h.prototype,"length",{get:function(){return this._queues.reduce(function(a,b){return a+b.length},0)},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"onGoingCount",{get:function(){return this._keysToRequests.size},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return 0<this.length||0<this.onGoingCount},enumerable:!0,configurable:!0});h.prototype.clear=function(){for(var a=0,b=this._queues;a<b.length;a++)b[a].clear();this._keysToRequests.clear();this.notifyChange("updating")};h.prototype.find=function(a,b){var c=this;b=0;for(var d=this._queues;b<
d.length;b++){var e=d[b].find(function(b){return a(c._keysToRequests.get(b).key)});if(e)return e}};h.prototype.getPromise=function(a){a="string"===typeof a?a:a.id;for(var b=0,c=this._queues;b<c.length;b++){var d=c[b].get(a);if(d)return d}};h.prototype.getRequest=function(a){return this._keysToRequests.get("string"===typeof a?a:a.id)};h.prototype.has=function(a){return"string"===typeof a?this._keysToRequests.has(a):this._keysToRequests.has(a.id)};h.prototype.isOngoing=function(a){var b="string"===
typeof a?a:a.id;return this.has(b)&&this._queues.some(function(a){return a.isOngoing(b)})};h.prototype.pause=function(){for(var a=0,b=this._queues;a<b.length;a++)b[a].pause()};h.prototype.push=function(a){var b=this,c=a.key.id;if(this.has(c))return this.getPromise(c);var d=this._queues[a.key.row%this._queues.length].push(c),e=function(){b._keysToRequests.delete(c);b.notifyChange("updating")};this._keysToRequests.set(c,a);d.then(e,e);this.notifyChange("updating");return d};h.prototype.reset=function(){for(var a=
0,b=this._queues;a<b.length;a++)b[a].reset();this.notifyChange("updating")};h.prototype.resume=function(){for(var a=0,b=this._queues;a<b.length;a++)b[a].resume()};h.prototype._peekByScaleFirst=function(a){if(!this.state)return a[0];for(var d=this.tileInfoView,e=Number.NEGATIVE_INFINITY,k=Number.POSITIVE_INFINITY,f=0;f<a.length;f++){var h=this._keysToRequests.get(a[f]),m=this.tileInfoView.getTileScale(h.key);b.has(m)||(b.set(m,[]),e=Math.max(m,e),k=Math.min(m,k));b.get(m).push(h.key);q.add(m)}var t=
this.state.scale;b.has(t)||(g(c,q),c.sort(),t=c.reduce(function(a,b,c,d){return Math.abs(b-t)<Math.abs(a-t)?b:a},c[0]));t=Math.min(t,e);t=Math.max(t,k);a=b.get(t);var v=d.getClosestInfoForScale(t),p=v.getColumnForX(this.state.center[0]),l=v.getRowForY(this.state.center[1]);a.sort(function(a,b){var c=v.denormalizeCol(a.col,a.world),d=v.denormalizeCol(b.col,b.world);return Math.sqrt((p-c)*(p-c)+(l-a.row)*(l-a.row))-Math.sqrt((p-d)*(p-d)+(l-b.row)*(l-b.row))});q.clear();b.clear();return a[0].id};h.prototype._peekByCenterFirst=
function(b){if(!this.state)return b[0];for(var c=this.tileInfoView,d=this.state.center,e=Number.POSITIVE_INFINITY,g=null,k=0;k<b.length;k++){var q=this._keysToRequests.get(b[k]);c.getTileCoords(a,q.key);var h=f.vec2.distance(a,d);h<e&&(e=h,g=q.key)}return g.id};e([m.property({constructOnly:!0})],h.prototype,"concurrency",void 0);e([m.property({constructOnly:!0})],h.prototype,"process",void 0);e([m.property()],h.prototype,"state",void 0);e([m.property({constructOnly:!0})],h.prototype,"strategy",void 0);
e([m.property({constructOnly:!0})],h.prototype,"tileInfoView",void 0);e([m.property({constructOnly:!0})],h.prototype,"tileServers",void 0);e([m.property({readOnly:!0})],h.prototype,"updating",null);return h=e([m.subclass()],h)}(m.declared(h))})},"esri/views/support/QueueProcessor":function(){define("require exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/scheduling".split(" "),function(r,l,p,e,h,m){return function(){function f(d){var e=this;this._apiPromises=new Map;this._processingItems=
new Map;this._isPaused=!1;this._task=this._schedule=null;this._pendingProcessing=0;this.concurrency=1;this.ordered=!1;d.concurrency&&(this.concurrency=d.concurrency);d.ordered&&(this.ordered=!0,this._itemsToProcess=[]);this._queue=new h({peeker:d.peeker});this.process=d.process;var f=d.scheduler;d.priority&&f&&(this._task=f.registerTask(d.priority,function(c){return e.update(c)},function(){return e.needsUpdate()}))}f.prototype.destroy=function(){this.clear();this._schedule&&(this._schedule.remove(),
this._schedule=null);this._task&&(this._task.remove(),this._task=null)};Object.defineProperty(f.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length+this._pendingProcessing},enumerable:!0,configurable:!0});f.prototype.clear=function(){this._queue.clear();var d=[];this._processingItems.forEach(function(e){return d.push(e.resultPromise)});this._processingItems.clear();d.forEach(function(d){return d.cancel()});d.length=0;this._apiPromises.forEach(function(e){return d.push(e)});
this._apiPromises.clear();d.forEach(function(d){return d.cancel()});this._cancelNext()};f.prototype.find=function(d,e){var g=this,c=void 0;this._apiPromises.forEach(function(b,a){d.call(e,a)&&(c=g._apiPromises.get(a).promise)});return c};f.prototype.get=function(d){return(d=this._apiPromises.get(d))&&d.promise||void 0};f.prototype.isOngoing=function(d){return this._processingItems.has(d)};f.prototype.has=function(d){return this._apiPromises.has(d)};f.prototype.pause=function(){this._isPaused||(this._isPaused=
!0,this._cancelNext())};f.prototype.push=function(d){var g=this;if(this._apiPromises.has(d))return this._apiPromises.get(d).promise;var f=e.createDeferred(function(c){var b=g._processingItems.get(d);b?b.resultPromise.cancel(c):(g._remove(d),g._scheduleNext())});this._add(d,f);this._scheduleNext();return f.promise};f.prototype.reset=function(){var d=[];this._processingItems.forEach(function(c){return d.push(c)});this._processingItems.clear();for(var e=0;e<d.length;e++){var f=d[e];f.resultPromise.isFulfilled()?
this._processReset(f):(f.isReset=!0,f.resultPromise.cancel())}};f.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};f.prototype.needsUpdate=function(){return!this._isPaused&&0<this._queue.length&&this._processingItems.size<this.concurrency};f.prototype.update=function(d){for(;!d.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),d.madeProgress()};f.prototype._scheduleNext=function(){var d=this;this._task||this._isPaused||
this._schedule||(this._schedule=m.schedule(function(){d._schedule=null;d._next()}))};f.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};f.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)};f.prototype._processResult=function(d,e){this._remove(d.item);this._scheduleNext();d.dfd.resolve(e)};f.prototype._processError=function(d,e){d.isReset?this._processReset(d):(this._remove(d.item),
this._scheduleNext(),d.dfd.reject(e))};f.prototype._processReset=function(d){this._remove(d.item);this._add(d.item,d.dfd);this._scheduleNext()};f.prototype._processOrdered=function(d,e){var g=this;if(d.isReset)this._processReset(d);else{d.result=e;var c=!1;this._processingItems.forEach(function(a){c||(a.result?g._itemsToProcess.push(a):c=!0)});d=0;for(e=this._itemsToProcess;d<e.length;d++){var b=e[d];!1===b.result.ok?this._processError(b,b.result.error):this._processResult(b,b.result.value)}this._itemsToProcess.length=
0}};f.prototype._process=function(d){var e=this;if(!p.isNone(d)){var f=this._apiPromises.get(d);this._pendingProcessing++;var c=this.process(d);this._pendingProcessing--;if(c&&"function"===typeof c.then){var b={item:d,resultPromise:c,result:null,dfd:f,isReset:!1};this._processingItems.set(d,b);this.ordered?c.then(function(a){return e._processOrdered(b,{ok:!0,value:a})},function(a){return e._processOrdered(b,{ok:!1,error:a})}):c.then(function(a){return e._processResult(b,a)},function(a){return e._processError(b,
a)})}else f.resolve(c),this._remove(d)}};f.prototype._add=function(d,e){this._apiPromises.set(d,e);this._queue.push(d)};f.prototype._remove=function(d){this._queue.remove(d);this._apiPromises.delete(d);this._processingItems.delete(d)};Object.defineProperty(f.prototype,"test",{get:function(){var d=this;return{update:function(e){return d.update(e)}}},enumerable:!0,configurable:!0});return f}()})},"esri/core/Queue":function(){define(["require","exports"],function(r,l){return function(){function p(e){this._items=
[];this._itemSet=new Set;this._peeker=function(e){return e[0]};this._length=0;e&&e.peeker&&(this._peeker=e.peeker)}Object.defineProperty(p.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0});p.prototype.clear=function(){this._itemSet.clear();this._length=this._items.length=0};p.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)};p.prototype.push=function(e){this.contains(e)||this._add(e)};p.prototype.contains=function(e){return 0<this._length&&
this._itemSet.has(e)};p.prototype.pop=function(){if(0!==this._length){var e=this.peek();this._remove(e);return e}};p.prototype.remove=function(e){this.contains(e)&&this._remove(e)};p.prototype._add=function(e){this._items.push(e);this._itemSet.add(e);this._length++};p.prototype._remove=function(e){this._itemSet.delete(e);this._items.splice(this._items.indexOf(e),1);this._length--};return p}()})},"esri/views/2d/tiling/TileStrategy":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"./TileKey"],function(r,l,p,e){var h=new e(0,0,0,0),m=new Map,f=[],d=[];return function(){function e(d){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=d.acquireTile;this.releaseTile=d.releaseTile;this.tileInfoView=d.tileInfoView;this.resampling=null==d.resampling||!!d.resampling;d.cachePolicy&&(this.cachePolicy=d.cachePolicy);d.coveragePolicy&&(this.coveragePolicy=
d.coveragePolicy);null!=d.buffer&&(this.buffer=d.buffer)}e.prototype.destroy=function(){this.tileIndex.clear()};e.prototype.update=function(e){var c=this,b=this.resampling,a=this.tileIndex,g=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);d.length=0;f.length=0;m.clear();if(g){var q=this.tileInfoView.tileInfo,t=q.minScale,p=q.maxScale,q=g.spans,l=g.lodInfo,r=l.level,n=e.state.scale,E=!e.stationary&&n>this._previousScale;this._previousScale=n;this.tiles.length=0;if(!b&&(n>
t||n<p))return this.tiles.length=0,m.clear(),a.forEach(function(a){c.releaseTile(a)}),a.clear(),d.length=0,f.length=0,m.clear(),!0;a.forEach(function(a){return a.visible=!0});p=t=0;if(0<q.length)for(n=0;n<q.length;n++){e=q[n];for(var z=e.row,x=e.colTo,y=e.colFrom;y<=x;y++)t++,e=h.set(r,z,l.normalizeCol(y),l.getWorldForColumn(y)).id,a.has(e)?(b=a.get(e),b.isReady?(m.set(e,b),p++):E||this._addParentTile(e,m)):(b=this.acquireTile(h),this.tileIndex.set(e,b),E||this._addParentTile(e,m))}var C=p===t;a.forEach(function(a,
b){h.set(b);if(!m.has(b)){var e=c.tileInfoView.intersects(g,h);!e||!E&&C?"purge"===c.cachePolicy?h.level===r&&e||f.push(b):(h.level>r||!e)&&f.push(b):a.isReady?d.push(b):h.level>r&&f.push(b)}});for(q=0;q<d.length;q++)e=d[q],(b=a.get(e))&&b.isReady&&m.set(e,b);for(q=0;q<f.length;q++)e=f[q],b=a.get(e),this.releaseTile(b),a["delete"](e);m.forEach(function(a){return c.tiles.push(a)});a.forEach(function(a){m.has(a.key.id)||(a.visible=!1)});return C}};e.prototype.clear=function(){var d=this,c=this.tileIndex;
c.forEach(function(b){d.releaseTile(b)});c.clear()};e.prototype._addParentTile=function(d,c){for(var b=null;;){d=this.tileInfoView.getTileParentId(d);if(!d)break;if(this.tileIndex.has(d)&&(b=this.tileIndex.get(d))&&b.isReady){c.has(b.key.id)||c.set(b.key.id,b);break}}};return e}()})},"esri/views/2d/input/MapViewInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragPan ./handlers/DragRotate ./handlers/GamepadNavigation ./handlers/KeyPan ./handlers/KeyRotate ./handlers/KeyZoom ./handlers/MouseWheelZoom ./handlers/PinchAction ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u,w,A,n,E){var z={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},x={zoomIn:["\x3d","+"],zoomOut:["-","_"]},y={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};return function(h){function l(){var a=null!==h&&h.apply(this,arguments)||this;a._handles=new m;return a}p(l,h);l.prototype.initialize=function(){var a=this;this.viewEvents=new n.ViewEvents(this.view);
this._handles.add([f.whenNot(this.view,"ready",function(){return a._disconnect()}),f.when(this.view,"ready",function(){return a._connect()})])};l.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect();this.viewEvents.destroy();this.viewEvents=null};l.prototype._disconnect=function(){this._inputManager&&(this.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)};l.prototype._connect=
function(){var d=new w.BrowserEventSource(this.view.surface,this.view.input),e=new A.InputManager(d);e.installHandlers("prevent-context-menu",[new E.PreventContextMenu]);e.installHandlers("navigation",[new u.PinchRotateAndZoom(this.view),new b.GamepadNavigation(this.view),new t.MouseWheelZoom(this.view),new g.DoubleClickZoom(this.view),new q.DragPan(this.view,"primary"),new a.KeyPan(this.view,z),new v.KeyZoom(this.view,x),new k.KeyRotate(this.view,y),new c.DragRotate(this.view,"secondary"),new g.DoubleClickZoom(this.view,
["Ctrl"])]);this.viewEvents.connect(e);this._source=d;this._inputManager=e};e([d.property()],l.prototype,"view",void 0);return l=e([d.subclass("esri.views.2d.input.MapViewInputManager")],l)}(d.declared(h))})},"esri/views/2d/input/handlers/DoubleClickZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","../../../input/handlers/support"],function(r,l,p,e,h){Object.defineProperty(l,"__esModule",{value:!0});r=function(e){function f(d,g){var f=
e.call(this,!0)||this;f.view=d;f.registerIncoming("double-click",g,function(c){return f._handleDoubleClick(c,g)});return f}p(f,e);f.prototype._handleDoubleClick=function(d,e){h.eventMatchesPointerAction(d.data,"primary")&&(d.stopPropagation(),e?this.view.mapViewNavigation.zoomOut([d.data.x,d.data.y]):this.view.mapViewNavigation.zoomIn([d.data.x,d.data.y]))};return f}(e.InputHandler);l.DoubleClickZoom=r})},"esri/views/2d/input/handlers/DragPan":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/DragEventSeparator ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(r,l,p,e,h,m){Object.defineProperty(l,"__esModule",{value:!0});r=function(f){function d(d,h,c){var b=f.call(this,!0)||this;b.view=d;b.pointerAction=h;b.registerIncoming("drag",c,function(a){return b._handleDrag(a)});b.registerIncoming("pointer-down",function(a){return b.stopMomentumNavigation()});var a=b.view.mapViewNavigation;b.dragEventSeparator=new e.DragEventSeparator({start:function(c,d){a.pan.begin(b.view,d.data);d.stopPropagation()},update:function(c,d){a.pan.update(b.view,d.data);
d.stopPropagation()},end:function(c,d){a.pan.end(b.view,d.data);d.stopPropagation()},condition:function(a,c){return 1===a&&m.eventMatchesPointerAction(c.data,b.pointerAction)}});return b}p(d,f);d.prototype._handleDrag=function(d){var e=this.view.mapViewNavigation;e.pinch.zoomMomentum||e.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(d)};d.prototype.stopMomentumNavigation=function(){this.view.mapViewNavigation.pan.stopMomentumNavigation()};return d}(h.InputHandler);
l.DragPan=r})},"esri/views/2d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/DragEventSeparator ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(r,l,p,e,h,m){Object.defineProperty(l,"__esModule",{value:!0});r=function(f){function d(d,h,c){var b=f.call(this,!0)||this;b.view=d;b.pointerAction=h;var a=b.view.mapViewNavigation;b.dragEventSeparator=new e.DragEventSeparator({start:function(c,d){a.rotate.begin(b.view,
d.data);d.stopPropagation()},update:function(c,d){a.rotate.update(b.view,d.data);d.stopPropagation()},end:function(c,d){a.rotate.end(b.view,d.data);d.stopPropagation()},condition:function(a,c){return 1===a&&m.eventMatchesPointerAction(c.data,b.pointerAction)}});b.registerIncoming("drag",c,function(a){return b.dragEventSeparator.handle(a)});return b}p(d,f);return d}(h.InputHandler);l.DragRotate=r})},"esri/views/2d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/scheduling ../../../../core/watchUtils ../../viewpointUtils ../../../input/InputHandler ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(r,l,p,e,h,m,f,d,g){Object.defineProperty(l,"__esModule",{value:!0});r=function(a){function d(b){var c=a.call(this,!0)||this;c.view=b;c.frameTask=null;c.watchHandles=new e;c.currentDevice=null;c.transformation={translation:[0,0,0],heading:0,tilt:0};c.handle=c.registerIncoming("gamepad",function(a){return c.handleEvent(a)});c.handle.pause();return c}p(d,a);d.prototype.onInstall=function(b){var c=this;a.prototype.onInstall.call(this,b);this.watchHandles.add([m.init(this.view.navigation.gamepad,
"enabled",function(a){a?(c.handle.resume(),c.frameTask||(c.frameTask=h.addFrameTask({update:function(a){return c.frameUpdate(a.deltaTime)}}))):(c.handle.pause(),c.frameTask&&(c.frameTask.remove(),c.frameTask=null))})])};d.prototype.onUninstall=function(){this.watchHandles.removeAll();this.frameTask&&(this.frameTask.remove(),this.frameTask=null);a.prototype.onUninstall.call(this)};d.prototype.handleEvent=function(a){var b=this.view.navigation.gamepad.device;b&&a.data.device!==b||this.currentDevice&&
this.currentDevice!==a.data.device||("end"===a.data.action?(this.currentDevice=null,g.resetTransformation(this.transformation)):(this.currentDevice=a.data.device,g.extractTransformation(a.data,this.view.navigation.gamepad,this.transformation)))};d.prototype.frameUpdate=function(a){var d=this.transformation;if(!g.isZeroTransformation(d)){var e=this.view.viewpoint.clone(),k=c*this.view.navigation.gamepad.velocityFactor*a;f.translateBy(e,e,[d.translation[0]*k,-d.translation[1]*k]);k=this.view.size;f.scaleAndRotateBy(e,
e,1+d.translation[2]*b*a,this.view.constraints.rotationEnabled?-d.heading*q*a:0,[k[0]/2,k[1]],k);a=this.view.constraints.constrain(e,this.view.viewpoint);this.view.viewpoint=a}};return d}(d.InputHandler);l.GamepadNavigation=r;var q=.06,c=.7,b=6E-4})},"esri/views/2d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(r,l,p,e){Object.defineProperty(l,"__esModule",{value:!0});r=function(e){function h(f,d,g){var h,
c=e.call(this,!0)||this;c.view=f;c.keys=d;c._keyMap=(h={},h[d.left]="left",h[d.right]="right",h[d.up]="up",h[d.down]="down",h);c.registerIncoming("key-down",g,function(b){return c._handleKeyDown(b)});c.registerIncoming("key-up",g,function(b){return c._handleKeyUp(b)});return c}p(h,e);h.prototype._handleKeyDown=function(e){e.data.repeat||this._handleKey(e,!0)};h.prototype._handleKeyUp=function(e){this._handleKey(e,!1)};h.prototype._handleKey=function(e,d){var g=this._keyMap[e.data.key];if(null!=g){if(d)switch(g){case "left":this.view.mapViewNavigation.continousPanLeft();
break;case "right":this.view.mapViewNavigation.continousPanRight();break;case "up":this.view.mapViewNavigation.continousPanUp();break;case "down":this.view.mapViewNavigation.continousPanDown()}else this.view.mapViewNavigation.stop();e.stopPropagation()}};return h}(e.InputHandler);l.KeyPan=r})},"esri/views/2d/input/handlers/KeyRotate":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(r,l,p,e){Object.defineProperty(l,"__esModule",
{value:!0});r=function(e){function h(f,d,g){var h,c=e.call(this,!0)||this;c.view=f;c.keys=d;c._keyToDirection=(h={},h[d.clockwiseOption1]="clockwise",h[d.clockwiseOption2]="clockwise",h[d.counterClockwiseOption1]="counterClockwise",h[d.counterClockwiseOption2]="counterClockwise",h[d.resetOption1]="reset",h[d.resetOption2]="reset",h);c.registerIncoming("key-down",g,function(b){return c._handleKeyDown(b)});c.registerIncoming("key-up",g,function(b){return c._handleKeyUp(b)});return c}p(h,e);h.prototype._handleKeyDown=
function(e){e.data.repeat||this._handleKey(e,!0)};h.prototype._handleKeyUp=function(e){this._handleKey(e,!1)};h.prototype._handleKey=function(e,d){var g=e.modifiers;0<g.size&&!g.has("Shift")||!this.view.constraints.rotationEnabled||!(g=this._keyToDirection[e.data.key])||(d?"clockwise"===g?this.view.mapViewNavigation.continousRotateClockwise():"counterClockwise"===g?this.view.mapViewNavigation.continousRotateCounterclockwise():this.view.mapViewNavigation.resetRotation():this.view.mapViewNavigation.stop(),
e.stopPropagation())};return h}(e.InputHandler);l.KeyRotate=r})},"esri/views/2d/input/handlers/KeyZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(r,l,p,e){Object.defineProperty(l,"__esModule",{value:!0});r=function(e){function h(f,d,g){var h=e.call(this,!0)||this;h.view=f;h.keys=d;h._keysToZoomAction={};h.registerIncoming("key-down",g,function(c){return h._handleKeyDown(c)});d.zoomIn.forEach(function(c){return h._keysToZoomAction[c]=
0});d.zoomOut.forEach(function(c){return h._keysToZoomAction[c]=1});return h}p(h,e);h.prototype._handleKeyDown=function(e){this._handleKey(e)};h.prototype._handleKey=function(e){var d=e.modifiers;0<d.size&&!d.has("Shift")||(d=this._keysToZoomAction[e.data.key],0===d?(this.view.mapViewNavigation.zoomIn(),e.stopPropagation()):1===d&&(this.view.mapViewNavigation.zoomOut(),e.stopPropagation()))};return h}(e.InputHandler);l.KeyZoom=r})},"esri/views/2d/input/handlers/MouseWheelZoom":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(r,l,p,e){Object.defineProperty(l,"__esModule",{value:!0});r=function(e){function h(f,d){var g=e.call(this,!0)||this;g.view=f;g._canZoom=!0;g.registerIncoming("mouse-wheel",d,function(d){return g._handleMouseWheel(d)});return g}p(h,e);h.prototype._handleMouseWheel=function(e){var d=this;if(this._canZoom){var g=this.view.mapViewNavigation,f=e.data;if(f=g.zoom(1/Math.pow(.6,1/60*f.deltaY),[f.x,f.y]))this._canZoom=
!1,f.catch(function(c){}).then(function(){d._canZoom=!0;g.end()});e.stopPropagation()}};return h}(e.InputHandler);l.MouseWheelZoom=r})},"esri/views/2d/input/handlers/PinchAction":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/DragEventSeparator","../../../input/InputHandler"],function(r,l,p,e,h){Object.defineProperty(l,"__esModule",{value:!0});r=function(h){function f(d){var g=h.call(this,!0)||this;g.view=d;g.registerIncoming("drag",function(c){return g._handleDrag(c)});
g.registerIncoming("pointer-down",function(c){return g.stopMomentumNavigation()});var f=g.view.mapViewNavigation;g.dragEventSeparator=new e.DragEventSeparator({start:function(c,b){f.pinch.begin(g.view,b.data);b.stopPropagation()},update:function(c,b){f.pinch.update(g.view,b.data);b.stopPropagation()},end:function(c,b){f.pinch.end(g.view,b.data);b.stopPropagation()},condition:function(c){return 2<=c}});return g}p(f,h);f.prototype._handleDrag=function(d){this.dragEventSeparator.handle(d)};f.prototype.stopMomentumNavigation=
function(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()};return f}(h.InputHandler);l.PinchRotateAndZoom=r})},"esri/views/2d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(r,l,p,e,h,m,f){return function(d){function g(){var e=null!==d&&d.apply(this,arguments)||this;e.color=new h([0,255,255]);
e.haloOpacity=1;e.fillOpacity=.25;return e}p(g,d);e([f.property({type:h})],g.prototype,"color",void 0);e([f.property()],g.prototype,"haloOpacity",void 0);e([f.property()],g.prototype,"fillOpacity",void 0);return g=e([f.subclass("esri.views.2d.support.HighlightOptions")],g)}(f.declared(m))})},"esri/views/ui/2d/DefaultUI2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),
function(r,l,p,e,h,m){return function(f){function d(d){d=f.call(this)||this;d.components=["attribution","zoom"];return d}p(d,f);e([h.property()],d.prototype,"components",void 0);return d=e([h.subclass("esri.views.ui.2d.DefaultUI2D")],d)}(h.declared(m))})},"esri/widgets/Search/LocatorSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../tasks/Locator ./SearchSource ./support/locatorUtils".split(" "),
function(r,l,p,e,h,m,f,d,g,q){return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.categories=null;a.countryCode=null;a.localSearchOptions=null;a.locationToAddressDistance=1500;a.locator=null;a.name="";a.placeholder="";a.searchTemplate="";a.singleLineFieldName=null;a.suggestionsEnabled=null;a.zoomScale=null;a.getResults=function(b){return q.getResults(h({source:a},b))};a.getSuggestions=function(b){return q.getSuggestions(h({source:a},b))};return a}p(b,c);a=b;b.prototype.readLocator=
function(a,b){return(a=b.url)?new d({url:a}):null};b.prototype.writeLocator=function(a,b){b.url=a?a.url:null};b.prototype.clone=function(){return new a({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?m.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?
this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?m.clone(this.categories):null,countryCode:this.countryCode,localSearchOptions:this.localSearchOptions?m.clone(this.localSearchOptions):null,locationToAddressDistance:this.locationToAddressDistance,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,
zoomScale:this.zoomScale})};var a;e([f.property()],b.prototype,"categories",void 0);e([f.property()],b.prototype,"countryCode",void 0);e([f.property()],b.prototype,"localSearchOptions",void 0);e([f.property()],b.prototype,"locationToAddressDistance",void 0);e([f.property({type:d})],b.prototype,"locator",void 0);e([f.reader("locator",["url"])],b.prototype,"readLocator",null);e([f.writer("locator")],b.prototype,"writeLocator",null);e([f.property({json:{write:!0}})],b.prototype,"name",void 0);e([f.property({json:{write:!0}})],
b.prototype,"placeholder",void 0);e([f.property()],b.prototype,"searchTemplate",void 0);e([f.property({json:{write:!0}})],b.prototype,"singleLineFieldName",void 0);e([f.property({json:{read:{source:"suggest"},write:{target:"suggest"}}})],b.prototype,"suggestionsEnabled",void 0);e([f.property({json:{write:!0}})],b.prototype,"zoomScale",void 0);return b=a=e([f.subclass("esri.widgets.Search.LocatorSearchSource")],b)}(f.declared(g))})},"esri/tasks/Locator":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/accessorSupport/decorators ../geometry/SpatialReference ./Task ./support/AddressCandidate".split(" "),
function(r,l,p,e,h,m,f,d,g,q){return function(c){function b(a){a=c.call(this,a)||this;a.categories=null;a.countryCode=null;a.outSpatialReference=null;a.url=null;return a}p(b,c);b.prototype.addressToLocations=function(a,b){var c=a.address,d=a.categories,e=a.countryCode,g=a.distance,f=a.forStorage,k=a.location,q=a.magicKey,p=a.maxLocations,l=a.outFields;a=a.searchExtent;var y=k?k.clone().normalize():null,r=a?a.shiftCentralMeridian():null,I=this.outSpatialReference,k=this.parsedUrl;a=this.requestOptions;
d={f:"json",outSR:I?JSON.stringify(I.toJSON()):null,outFields:l?l.join(","):null,searchExtent:r?JSON.stringify(r.toJSON()):null,category:d?d.join(","):null,countryCode:e||null,magicKey:q||null,distance:g||null,location:y,maxLocations:p||null,forStorage:f||null};c={query:this._encode(h({},k.query,c,d))};b=h({},a,b,c);return m(k.path+"/findAddressCandidates",b).then(this._handleAddressToLocationsResponse)};b.prototype.suggestLocations=function(a,b){var c=this.parsedUrl,d=this.requestOptions,e=a.location,
g=a.searchExtent,e=e?e.clone().normalize():null,g=g?g.shiftCentralMeridian():null;a={f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:g?JSON.stringify(g.toJSON()):null,category:a.categories?a.categories.join(","):null,countryCode:a.countryCode||null,location:e,distance:a.distance||null};a={query:this._encode(h({},c.query,a))};b=h({},d,b,a);return m(c.path+"/suggest",b).then(this._handleSuggestLocationsResponse)};b.prototype.addressesToLocations=function(a,b){var c=this.outSpatialReference,
d=this.parsedUrl,e=this.requestOptions,g=a.addresses,f=a.categories;a=a.countryCode;var k=[];Array.isArray(g)&&g.forEach(function(a){k.push({attributes:a})});c={category:f?f.join(","):null,sourceCountry:a||null,addresses:JSON.stringify({records:k}),f:"json",outSR:c?JSON.stringify(c):null};c={query:this._encode(h({},d.query,c))};b=h({},e,b,c);return m(d.path+"/geocodeAddresses",b).then(this._handleAddressesToLocationsResponse)};b.prototype.locationToAddress=function(a,b,c){var d=a?a.clone().normalize():
null,e="undefined"!==typeof d,g="undefined"!==typeof b&&e,f=this.outSpatialReference;a=this.parsedUrl;var k=this.requestOptions;b={outSR:f?JSON.stringify(f.toJSON()):null,location:e?JSON.stringify(d.toJSON()):null,distance:g?b:null,f:"json"};b={query:this._encode(h({},a.query,b))};c=h({},k,c,b);return m(a.path+"/reverseGeocode",c).then(this._handleLocationToAddressResponse)};b.prototype._handleAddressToLocationsResponse=function(a){a=a.data;if(!a)return[];var b=a.candidates,c=a.spatialReference;return b?
b.map(function(a){if(a){var b=a.extent,d=a.location,e=b?b&&"number"===typeof b.xmin&&"number"===typeof b.ymin&&"number"===typeof b.xmax&&"number"===typeof b.ymax:!0;if(d&&"number"===typeof d.x&&"number"===typeof d.x&&e)return b&&(b.spatialReference=c),d.spatialReference=c,q.fromJSON(a)}}):[]};b.prototype._handleSuggestLocationsResponse=function(a){return(a=a.data)?a.suggestions||[]:[]};b.prototype._handleAddressesToLocationsResponse=function(a){a=a.data;if(!a)return[];var b=a.locations,c=a.spatialReference;
return b?b.map(function(a){var b=a.location;b&&(b.spatialReference=c);return q.fromJSON(a)}):[]};b.prototype._handleLocationToAddressResponse=function(a){if(a=a.data){var b=a.address;return q.fromJSON({address:b&&b.Match_addr||"",attributes:b||{},location:a.location,score:100})}};e([f.property()],b.prototype,"categories",void 0);e([f.property()],b.prototype,"countryCode",void 0);e([f.property({type:d})],b.prototype,"outSpatialReference",void 0);e([f.property()],b.prototype,"url",void 0);return b=
e([f.subclass("esri.tasks.Locator")],b)}(f.declared(g))})},"esri/tasks/support/AddressCandidate":function(){define(["../../core/JSONSupport","../../geometry/Extent","../../geometry/Point"],function(r,l,p){return r.createSubclass({declaredClass:"esri.tasks.support.AddressCandidate",properties:{address:{value:null,json:{write:!0}},attributes:{value:null,json:{write:!0}},extent:{value:null,type:l,json:{write:!0}},location:{value:null,type:p,json:{write:!0}},score:{value:null,json:{write:!0}}}})})},"esri/widgets/Search/support/locatorUtils":function(){define(["require",
"exports","../../../Graphic","../../../core/promiseUtils","./geometryUtils"],function(r,l,p,e,h){function m(b){var a=b.source,c=b.spatialReference,d=b.location,e=b.distance,g=b.sourceIndex,f=b.view;b=a.locator;var h=a.zoomScale,m=f&&f.scale;c&&(b.outSpatialReference=c);return b.locationToAddress(d,e).then(function(a){return q([a],{sourceIndex:g,scale:m,view:f,zoomScale:h})})}function f(b,a){var c=b.filter,d=b.searchExtent;b=b.withinViewEnabled;var e=a&&a.extent;return(a=h.createExtentFromGeometry(c&&
c.geometry,a,a&&a.scale))||d||(b&&e?e:void 0)}function d(b){var a=b.source,d=b.suggestResult,g=b.spatialReference,h=b.view,m=b.maxResults,p=b.sourceIndex,l=a&&a.zoomScale;b=d.text.trim();if(!b)return e.resolve();b=""+(!d.key&&a.prefix?a.prefix:"")+b+(!d.key&&a.suffix?a.suffix:"");var n={},r=a.locator,z=h&&h.scale,x=f(a,h);if(!r)return e.resolve();a.categories&&(n.categories=a.categories);g&&(r.outSpatialReference=g);if(g=c(h,a,z))n.location=g.location,n.distance=g.distance;n.maxLocations=m;x&&(n.searchExtent=
x);a.countryCode&&(n.countryCode=a.countryCode);var y=d.key;y&&(n.magicKey=y);n.address={};n.address[a.singleLineFieldName||"Single Line Input"]=b;a.outFields&&(n.outFields=a.outFields);return r.addressToLocations(n).then(function(a){return q(a,{key:y,scale:z,sourceIndex:p,view:h,zoomScale:l})})}function g(b,a){return b.map(function(b){return{text:b.text,key:b.magicKey,sourceIndex:a}})}function q(b,a){return b.map(function(b){var c=a.key,d=a.scale,e=a.sourceIndex,g=a.view,f=a.zoomScale,k=b.extent,
m=b.location,q=b.address;b=new p({geometry:m,attributes:b.attributes});d=h.createExtentFromGeometry(k||m,g,d);g=f?h.scaleExtent(d,g,f):d;m=m?m.x+","+m.y:"";return{extent:g,feature:b,key:c,name:q||m,sourceIndex:e}})}function c(b,a,c){var d=a.localSearchOptions;if(b&&d&&d.hasOwnProperty("distance")&&d.hasOwnProperty("minScale")&&(a=d.minScale,d=d.distance,!a||c&&c<=a))return{location:b.get("extent.center"),distance:d}}Object.defineProperty(l,"__esModule",{value:!0});l.getResults=function(b){return b.location?
m(b):d(b)};l.getSuggestions=function(b){var a=b.source,d=b.spatialReference,h=b.view,m=b.suggestTerm,q=b.maxSuggestions,p=b.sourceIndex;b={};var l=a.locator,n=h&&h.scale,r=f(a,h);if(!l)return e.resolve();a.categories&&(b.categories=a.categories);l.outSpatialReference=d;if(d=c(h,a,n))b.location=d.location,b.distance=d.distance;m=m.trim();if(!m)return e.resolve();d=a.prefix;h=a.suffix;b.text=""+(void 0===d?"":d)+m+(void 0===h?"":h);r&&(b.searchExtent=r);b.maxSuggestions=q;a.countryCode&&(b.countryCode=
a.countryCode);return l.suggestLocations(b).then(function(a){return g(a,p)})};l.isArcGISWorldGeocoder=function(b){return b?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(b)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(b):!1}})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../PopupTemplate ../renderers ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query".split(" "),
function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u,w,A,n,E,z,x,y,C,I,J,B,P,Q,K,N,R){function L(a,b,c){a&&((a=Q.read(a,b,c)||void 0)||F.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var S=["3DObject","Point"],F=q.getLogger("esri.layers.SceneLayer"),D={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
H={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(q){function l(a,b){a=q.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.path=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}e(l,q);l.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?p({url:a},b):a};l.prototype.getField=function(a){return C.getField(this.fields,a)};Object.defineProperty(l.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"geometryType",{get:function(){return H[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,
"renderer",{set:function(a){C.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});l.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};Object.defineProperty(l.prototype,"defaultPopupTemplate",{get:function(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null},enumerable:!0,configurable:!0});l.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===
b.type&&(a=b.name);return!!a});return a||void 0};l.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&D[a])return D[a];F.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};l.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).then(function(){return a._fetchService()},function(){return a._fetchService()}).then(function(){return c.all([a._verifyRootNodeAndUpdateExtent(),a._setAssociatedFeatureLayer()])}).then(function(){return a._validateElevationInfo()}).then(function(){return a._applyAssociatedLayerOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return K.loadStyleRenderer(a,
{origin:"service"})}).then(function(){return C.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(b);return this.when()};l.prototype.createLayerView=function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?c.create(function(a){return r(["../views/3d/layers/SceneLayerView3D"],a)}):c.create(function(a){return r(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(c){return new c({view:a,layer:b})})};l.prototype.createQuery=function(){var a=new R;
"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};l.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};l.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};l.prototype.queryFeatures=function(a){var b=this;
return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,d=a.features;c<d.length;c++){var e=d[c];e.layer=b;e.sourceLayer=b}return a})};l.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||b.createQuery())})};l.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(F.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};l.prototype.createPopupTemplate=function(a){return N.createPopupTemplate(this,a)};l.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?c.resolve(b):c.reject(new g("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};
l.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};l.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return c.reject(new g("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var e=0,f=this.statisticsInfo;e<f.length;e++){var h=f[e];if(h.name===a)return a=b.join(this.parsedUrl.path,h.href),d(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};
l.prototype._validateLayer=function(a){if(a.layerType&&-1===S.indexOf(a.layerType))throw new g("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new g("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new g("layer:service-version-too-new","Service version is too new.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,d=!1;if(null==a)d=c=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;d=b;break;case "vertex-reference-frame":c=!0;d=!b;break;default:c=!1}if(!c)throw new g("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!d)throw new g("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");
};l.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};l.prototype._applyAssociatedLayerOverrides=
function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=t.getProperties(this);for(c=0;c<a.length;c++){var d=a[c];this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}}};l.prototype._setAssociatedFeatureLayer=function(){var a=this;return this._fetchAssociatedFeatureLayer().then(function(b){a.associatedLayer=
b})};l.prototype._fetchAssociatedFeatureLayer=function(){var b=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?c.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchAssociatedFeatureLayerFromRelatedItems(this.portalItem):this._fetchAssociatedFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(c){a.whenValidOnce(b,["popupTemplate","popupEnabled"],function(){return b.popupEnabled&&null!=b.popupTemplate}).then(function(){return function(){var a=
"this SceneLayer: "+b.title;null==b.attributeStorageInfo?F.warn("Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on "+a):F.info("Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on "+a)}});return null})};l.prototype._fetchAssociatedFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===
a.type})[0])?b._fetchAssociatedFeatureLayerFromPortalItem(new P({id:a.id,portal:a.portal})):c.reject()}).catch(function(){return b._fetchAssociatedFeatureLayerFromUrl()})};l.prototype._fetchAssociatedFeatureLayerFromPortalItem=function(a){var b=this;return a.load().then(function(a){return b._findMatchingAssociatedSublayerUrl(a.url)}).then(function(b){return c.resolve(new u({url:b,portalItem:a}))})};l.prototype._fetchAssociatedFeatureLayerFromUrl=function(){return this._findMatchingAssociatedSublayerUrl().then(function(a){return c.resolve(new u({url:a}))})};
l.prototype._findMatchingAssociatedSublayerUrl=function(a){var b=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!b)return c.reject();null==a&&(a=b[1]+"/FeatureServer");var e=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},authMode:"no-prompt",responseType:"json"};var g=b[1]+"/SceneServer",f=parseInt(b[2],10),b=d(g,a).catch(function(a){return{data:{layers:null}}});a=d(e,a);return c.all([a,b]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;
b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===f)return e+"/"+b[c].id}else if(f<b.length)return e+"/"+b[f].id;throw Error("could not find matching associated sublayer");})};l.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=v.nameToId(this.originOf(a));a=v.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=v.OriginId.SERVICE?null==b||b<v.OriginId.SERVICE:
null!=a&&a<=v.OriginId.PORTAL_ITEM?null==b||b<v.OriginId.PORTAL_ITEM:!1};l.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&F.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&F.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};h([k.shared("esri.layers.SceneLayer")],l.prototype,
"declaredClass",void 0);h([k.property({types:{key:"type",base:z.default,typeMap:{selection:x.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],l.prototype,"featureReduction",void 0);h([k.property({type:[B.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],l.prototype,"rangeInfos",void 0);h([k.property({json:{read:!1}})],
l.prototype,"associatedLayer",void 0);h([k.property({type:["show","hide"]})],l.prototype,"listMode",void 0);h([k.property({type:["ArcGISSceneServiceLayer"]})],l.prototype,"operationalLayerType",void 0);h([k.property({json:{read:!1},readOnly:!0})],l.prototype,"type",void 0);h([k.property({type:[y]})],l.prototype,"fields",void 0);h([k.property({readOnly:!0})],l.prototype,"attributeStorageInfo",void 0);h([k.property({readOnly:!0})],l.prototype,"statisticsInfo",void 0);h([k.property({type:String,json:{origins:{service:{read:!1,
write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],l.prototype,"definitionExpression",void 0);h([k.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],l.prototype,"path",void 0);h([k.property(n.elevationInfo)],l.prototype,"elevationInfo",null);h([k.property({type:String,dependsOn:["profile"]})],l.prototype,"geometryType",null);h([k.property(n.labelsVisible)],l.prototype,"labelsVisible",void 0);h([k.property({type:[I],
json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:J.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:J.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],l.prototype,"labelingInfo",void 0);h([k.property(n.legendEnabled)],l.prototype,"legendEnabled",void 0);h([k.property({types:f.rendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:L}}},read:{source:"layerDefinition.drawingInfo.renderer",
reader:L},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],l.prototype,"renderer",null);h([k.property({json:{read:!1}})],l.prototype,"cachedDrawingInfo",void 0);h([k.reader("service","cachedDrawingInfo")],l.prototype,"readCachedDrawingInfo",null);h([k.property(n.popupEnabled)],l.prototype,"popupEnabled",void 0);h([k.property({type:m,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],l.prototype,"popupTemplate",void 0);h([k.property({readOnly:!0,json:{read:!1},dependsOn:["fields",
"title","attributeStorageInfo","associatedLayer"]})],l.prototype,"defaultPopupTemplate",null);h([k.property({type:String,json:{read:!1}})],l.prototype,"objectIdField",void 0);h([k.reader("service","objectIdField",["objectIdField","fields"])],l.prototype,"readObjectIdField",null);h([k.property({json:{read:!1}})],l.prototype,"objectIdFilter",void 0);h([k.property({type:String,json:{read:!1}})],l.prototype,"profile",void 0);h([k.reader("service","profile",["store.profile"])],l.prototype,"readProfile",
null);h([k.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],l.prototype,"normalReferenceFrame",void 0);h([k.property(E.screenSizePerspectiveEnabled)],l.prototype,"screenSizePerspectiveEnabled",void 0);return l=h([k.subclass()],l)}(k.declared(w,A))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl ../support/commonProperties".split(" "),
function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u,w,A,n){var E=f.getLogger("esri.layers.mixins.SceneService");return function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}p(f,d);f.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
f.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return k.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new k(a):null};f.prototype.readFullExtent=function(a,c){a=c.store;c=this._readSpatialReference(c);return null==c||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return-1E38>a})?null:new b({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],
spatialReference:c})};f.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};f.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};f.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return A.titleFromUrlAndName(this.url,
b.name);b=b.name||A.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return A.cleanTitle(b)};f.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(f.prototype,"url",{set:function(a){a=A.sanitizeUrlWithLayerId(this,a,E);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});f.prototype.writeUrl=function(a,b,c,d){A.writeUrlWithLayerId(this,a,"layers",b,d)};Object.defineProperty(f.prototype,
"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=q.urlToObject(a);null!=this.layerId&&A.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});f.prototype.readRootNode=function(a,b){return b.store.rootNode};f.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};f.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&
!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};f.prototype._fetchRootNode=function(){if(!this.rootNode)return g.resolve();var a=q.join(this.parsedUrl.path,this.rootNode);return h(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(b){throw new m("sceneservice:root-node-missing","Root node missing.",{error:b,url:a});})};f.prototype._fetchService=function(){var a=
this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):g.resolve()).then(function(){return a._fetchServiceLayer()})};f.prototype._fetchFirstLayerId=function(){return h(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};f.prototype._fetchServiceLayer=function(){var a=this;return h(this.parsedUrl.path,{query:{f:"json"},
responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};f.prototype._validateLayer=function(a){};e([c.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],f.prototype,"properties",void 0);e([c.property({type:k})],f.prototype,"spatialReference",void 0);e([c.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],f.prototype,"readSpatialReference",
null);e([c.property({type:b})],f.prototype,"fullExtent",void 0);e([c.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],f.prototype,"readFullExtent",null);e([c.property({readOnly:!0,type:a})],f.prototype,"heightModelInfo",void 0);e([c.property({readOnly:!0})],f.prototype,"version",void 0);e([c.reader("version",["store.version"])],f.prototype,"readVersion",null);e([c.property({type:String,json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",
void 0);e([c.property({type:String,json:{read:!1}})],f.prototype,"sublayerTitleMode",void 0);e([c.property({type:String})],f.prototype,"title",void 0);e([c.reader("portal-item","title")],f.prototype,"readTitlePortalItem",null);e([c.reader("service","title",["name"])],f.prototype,"readTitleService",null);e([c.property({type:Number})],f.prototype,"layerId",void 0);e([c.reader("service","layerId",["id"])],f.prototype,"readLayerId",null);e([c.property(n.url)],f.prototype,"url",null);e([c.writer("url")],
f.prototype,"writeUrl",null);e([c.property({dependsOn:["layerId"]})],f.prototype,"parsedUrl",null);e([c.property()],f.prototype,"store",void 0);e([c.property({type:String})],f.prototype,"rootNode",void 0);e([c.reader("rootNode",["store.rootNode"])],f.prototype,"readRootNode",null);return f=e([c.subclass("esri.layers.mixins.SceneService")],f)}(c.declared(v,t,d,u,w))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(r,l,p,e,h,m){Object.defineProperty(l,"__esModule",{value:!0});r=function(f){function d(){var d=null!==f&&f.apply(this,arguments)||this;d.name=null;d.field=null;d.currentRangeExtent=null;d.fullRangeExtent=null;d.type="rangeInfo";return d}p(d,f);e([m.property({type:String,json:{read:!0,write:!0}})],d.prototype,"name",void 0);e([m.property({type:String,json:{read:!0,write:!0}})],d.prototype,"field",void 0);e([m.property({type:[Number],json:{read:!0,write:!0}})],d.prototype,"currentRangeExtent",
void 0);e([m.property({type:[Number],json:{read:!0,write:!0}})],d.prototype,"fullRangeExtent",void 0);e([m.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],d.prototype,"type",void 0);return d=e([m.subclass("esri.layers.support.RangeInfo")],d)}(m.declared(h));l.RangeInfo=r;l.default=r})},"widgets/Search/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/when dojo/promise/all jimu/portalUtils jimu/utils esri/request".split(" "),function(r,l,p,e,h,m,f,d){return{map:null,
layerInfosObj:null,appConfig:null,_esriLocatorRegExp:/geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g,setMap:function(d){this.map=d},setLayerInfosObj:function(d){this.layerInfosObj=d},setAppConfig:function(d){this.appConfig=d},getConfigInfo:function(d){if(d&&d.sources&&0<d.sources.length){var f=null;return this.searchLayer(this.map)&&d.upgradeFromGeocoder?(f=this.map.itemInfo.itemData.applicationProperties.viewing.search,f=l.map(f.layers,r.hitch(this,function(c,b){b.hintText=
c;return this._getQueryTypeGeocoder(b)},f.hintText)),h(f).then(r.hitch(this,function(c){d.sources=[].concat(c).concat(d.sources);return d}))):d}return e(this._getSoucesFromPortalAndWebmap()).then(r.hitch(this,function(c){return{allPlaceholder:"",showInfoWindowOnSelect:!0,sources:c}}))},_getSoucesFromPortalAndWebmap:function(){var d=[],e=null;this.searchLayer(this.map)&&(e=this.map.itemInfo.itemData.applicationProperties.viewing.search,l.forEach(e.layers,r.hitch(this,function(c,b){b.hintText=c;d.push(this._getQueryTypeGeocoder(b))},
e.hintText)));return m.getPortalSelfInfo(this.appConfig.portalUrl).then(r.hitch(this,function(c){if((c=c.helperServices&&c.helperServices.geocode)&&0<c.length)for(var b=0,a=c.length;b<a;b++){var e=c[b];e&&d.push(this._processSingleLine(e))}return h(d).then(r.hitch(this,function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d&&(d&&"query"===d.type||(d={name:d.name||this._getGeocodeName(d.url),url:d.url,singleLineFieldName:d.singleLineFieldName,placeholder:d.placeholder||window.jimuNls.common.findAddressOrPlace||
d.name||this._getGeocodeName(d.url),maxResults:6,searchInCurrentMapExtent:!1,type:"locator"}),b.push(d))}return b}))}))},_getQueryTypeGeocoder:function(d){var e=this.map.findLayerById(d.id),c=null,b=null,b=d.id,c=null;e&&e.allSublayers&&(c=e.allSublayers.find(function(a){return a.id===d.subLayer}));return e?(c="scene"===e.type?e.url+"/layers/"+e.layerId:c?c.url||e.url+"/"+d.subLayer:e.url+"/"+e.layerId,{name:e.title,layerId:b,url:c,placeholder:d.hintText||window.jimuNls.common.findAddressOrPlace,
searchFields:[d.field.name],displayField:d.field.name,exactMatch:d.field.exactMatch||!1,maxResults:6,searchInCurrentMapExtent:!1,type:"query"}):null},_isEsriLocator:function(d){this._esriLocatorRegExp.lastIndex=0;return this._esriLocatorRegExp.test(d)},_processSingleLine:function(e){if(e.singleLineFieldName)return e;if(this._isEsriLocator(e.url))return e.singleLineFieldName="SingleLine",e;var f=new p;d(e.url,{query:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(r.hitch(this,function(c){c.singleLineAddressField&&
c.singleLineAddressField.name?(e.singleLineFieldName=c.singleLineAddressField.name,f.resolve(e)):(console.warn(e.url+"has no singleLineFieldName"),f.resolve(null))}),r.hitch(this,function(c){console.error(c);f.resolve(null)}));return f.promise},_getGeocodeName:function(d){if("string"!==typeof d)return"geocoder";d=d.split("/");return d[d.length-2]||"geocoder"},getGeocoderName:function(d){return this._getGeocodeName(d)},hasAppSearchInfo:function(d){return d.itemInfo&&d.itemInfo.itemData&&d.itemInfo.itemData.applicationProperties&&
d.itemInfo.itemData.applicationProperties.viewing&&d.itemInfo.itemData.applicationProperties.viewing.search},searchLayer:function(d){if(!d||!this.hasAppSearchInfo(d))return!1;d=d.itemInfo.itemData.applicationProperties.viewing.search;return d.enabled&&0!==d.layers.length?!0:!1}}})},"widgets/Search/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Search/Widget.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"searchNode" class\x3d"search-node"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"searchResultsNode" class\x3d"searchResults arcgisSearch esri-search"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Search/css/style.css":".jimu-widget-search{min-height: 32px;}.jimu-widget-search .search-node.default-width-for-openAtStart{width: 300px;}.jimu-widget-search .esri-search__container{border: 1px solid #57585A;}.jimu-widget-search .result-item-selected{background: #eee;}.jimu-widget-search .esri-search .esri-search-button:hover,.jimu-widget-search .esri-search .esri-search-button:focus {background-color: #485566; color: white;}.jimu-widget-search .esri-search .show-all-results{position: absolute; height: 25px; color: #686868; line-height: 25px; display: none; width: 237px; margin: auto; background-color: #fff; padding: 0 12px; cursor: pointer;}.jimu-widget-search .searchResults .esri-menu{border-radius: 0; color: #686868; font-size: 12px; padding: 0; top: 33px; visibility: visible;}.jimu-widget-search .searchMenu {position: absolute; top: 100%; left: 0; z-index: 1000; display: none; float: left; padding: 5px 0; margin: 2px 0 0; font-size: 14px; line-height: 16px; background-color: #fff; -webkit-background-clip: padding-box; background-clip: padding-box; border: 1px solid #57585A; -webkit-border-radius: 4px; border-radius: 4px; overflow: auto; max-height: 300px;}.jimu-widget-search .searchMenu ul {margin: 0; padding: 0; list-style: none;}.jimu-widget-search .esri-search .esri-menu li.active{background-color: #d9dde0; color: #686868; font-size: 14px;}.jimu-widget-search .esri-search .esri-menu li{padding: 0 12px; line-height: 25px; cursor: pointer;}.jimu-widget-search .esri-search .esri-menu li:hover,.jimu-widget-search .esri-search .esri-menu li:focus {background-color: #eee;}.jimu-widget-search .esri-search .esri-menu .menu-header{background-color: #d9dde0; color: #686868; font-size: 14px; min-height: 30px; padding: 0 12px; line-height: 30px;}",
"*now":function(r){r(['dojo/i18n!*preload*widgets/Search/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/when dojo/on dojo/query dojo/keys dojo/Deferred dojo/promise/all jimu/BaseWidget jimu/utils esri/widgets/Search esri/widgets/Search/SearchViewModel esri/tasks/Locator esri/tasks/support/Query esri/layers/FeatureLayer esri/layers/SceneLayer esri/symbols/PictureMarkerSymbol esri/PopupTemplate ./utils dojo/NodeList-dom".split(" "),function(r,l,p,e,h,m,f,d,g,q,c,b,a,k,v,t,u,w,A,n,E){return r([c],{name:"Search",baseClass:"jimu-widget-search",
searchDijit:null,searchResults:null,_highlightedFeatureHandle:null,postCreate:function(){this.listenWidgetIds.push("framework")},startup:function(){this.inherited(arguments);this.config&&this.config.sources||(this.config.sources=[]);E.setMap(this.sceneView.map);E.setAppConfig(this.appConfig);h(E.getConfigInfo(this.config)).then(l.hitch(this,function(a){return q(this._convertConfig(a)).then(function(a){return p.filter(a,function(a){return a})})})).then(l.hitch(this,function(c){this.domNode&&(c=new k({activeSourceIndex:1===
c.length?0:-1,allPlaceholder:b.stripHTML(this.config.allPlaceholder?this.config.allPlaceholder:window.jimuNls.common.findAddressOrPlace),autoSelect:!0,buttonModeEnabled:!1,labelEnabled:!1,popupEnabled:b.isDefined(this.config.showInfoWindowOnSelect)?!!this.config.showInfoWindowOnSelect:!0,view:this.sceneView,sources:c,theme:"arcgisSearch"}),this.searchDijit=new a({viewModel:c,includeDefaultSources:!1,container:this.searchNode}),this.searchDijit.startup(),this._resetSearchDijitStyle(),this.own(this.searchDijit.viewModel.watch("activeSourceIndex",
l.hitch(this,"_onSourceIndexChange"))),this.own(m(this.searchDijit.viewModel,"select-result",l.hitch(this,"_onSelectResult"))),this.own(m(this.searchDijit.domNode,"click",l.hitch(this,"_onSearchDijitClick"))),this.own(m(this.searchDijit._inputNode,"keyup",l.hitch(this,function(a){a.keyCode!==d.ENTER&&this._onClearSearch()}))),this.own(m(this.searchDijit.viewModel,"suggest-results",l.hitch(this,"_onSuggestResults"))),this.own(m(this.searchDijit.viewModel,"search-clear",l.hitch(this,"_onClearSearch"))),
this.fetchData("framework"))}))},_convertConfig:function(a){return p.map(a.sources,l.hitch(this,function(a){var c=new g;if(a&&a.url&&"locator"===a.type)c.resolve({locator:new v(a.url||""),outFields:["*"],singleLineFieldName:a.singleLineFieldName||"",name:b.stripHTML(a.name||""),placeholder:b.stripHTML(a.placeholder||""),highlightSymbol:new A({url:this.folderUrl+"css/images/search-pointer.png",size:36,width:36,height:36,xoffset:9,yoffset:18}),countryCode:a.countryCode||"",maxSuggestions:a.maxSuggestions||
6,maxResults:a.maxResults||6,zoomScale:a.zoomScale||5E4,withinViewEnabled:!!a.searchInCurrentMapExtent});else if(a&&a.url&&"query"===a.type){var d=this._getLayerViewByLayerId(a.layerId),e;e=/\/sceneserver\//gi.test(a.url)?new w({url:a.url||null,outFields:["*"]}):new u({url:a.url||null,outFields:["*"]});e.load().then(l.hitch(this,function(){var f=this._getInfoTemplate(e,a,a.displayField),g=null;a.searchFields&&0<a.searchFields.length?g=a.searchFields:(g=[],p.forEach(e.fields,function(a){"esriFieldTypeOID"!==
a.type&&a.name!==e.objectIdField&&"esriFieldTypeGeometry"!==a.type&&g.push(a.name)}));f={layer:e,outFields:["*"],searchFields:g,displayField:a.displayField||"",exactMatch:!!a.exactMatch,name:b.stripHTML(a.name||""),placeholder:b.stripHTML(a.placeholder||""),maxSuggestions:a.maxSuggestions||6,maxResults:a.maxResults||6,popupTemplate:f||null,zoomScale:a.zoomScale||5E4,withinViewEnabled:!!a.searchInCurrentMapExtent,featureLayerId:a.layerId,featurelayerGeometryType:e.geometryType};d&&(f.resultGraphicEnabled=
!1);"scene"===e.type&&(f.autoNavigate=!1);c.resolve(f)}),l.hitch(this,function(){c.resolve(null)}))}else c.resolve(null);return c}))},_getInfoTemplate:function(a,c){var d,e=[];p.filter(a.fields,function(a){var b=a.name.toLowerCase();0>b.indexOf("shape")&&0>b.indexOf("objectid")&&0>b.indexOf("perimeter")&&e.push(a.name)});(a=b.getDefaultPopupInfo(a,c.name+": {"+c.displayField+"}",e))&&(d=new n({title:a.title,content:[{type:"fields",fieldInfos:a.fieldInfos}]}));return d},destroy:function(){E.setAppConfig(null);
var a=this.sceneView.popup.viewModel;a&&(a.visible=!1);this.searchDijit&&this.searchDijit.viewModel&&(this.searchDijit.viewModel.set("view",null),this.searchDijit.viewModel.clear());this._highlightedFeatureHandle&&this._highlightedFeatureHandle.remove();this.inherited(arguments)},_getLayerViewByLayerId:function(a){return this.sceneView.layerViews.find(l.hitch(this,function(b){return b.layer.id===a}))},_onSelectResult:function(a){var b=a.result;if(b&&b.name){var b=a.result.feature,c=this._getLayerViewByLayerId(a.source.featureLayerId);
if(c){var d=new t;d.where=c.layer.objectIdField+" \x3d "+b.attributes[c.layer.objectIdField];d.outFields=["*"];d.returnGeometry=!0;d.maxAllowableOffset=0;d.outSpatialReference=this.sceneView.spatialReference;c.layer.queryFeatures(d).then(l.hitch(this,function(a){if(a=a.features[0])this._highlightedFeatureHandle&&this._highlightedFeatureHandle.remove(),this._highlightedFeatureHandle=c.highlight(a),"scene"===c.layer.type&&this.sceneView.goTo(a)}))}"point"===a.source.featurelayerGeometryType&&a.source.zoomScale&&
this.sceneView.goTo({scale:a.source.zoomScale})}},_onSearchComplete:function(){},onReceiveData:function(a,b,c){"framework"===a&&"framework"===b&&c&&c.searchString&&(this.searchDijit.viewModel.set("value",c.searchString),this.searchDijit.viewModel.search())},setPosition:function(){this._resetSearchDijitStyle();this.inherited(arguments)},resize:function(){this._resetSearchDijitStyle()},_onSourceIndexChange:function(){this.searchDijit.viewModel.value&&this.searchDijit.viewModel.search(this.searchDijit.viewModel.value)},
_onSuggestResults:function(){this._resetSelectorPosition(".searchMenu");this._hideResultMenu()},_onClearSearch:function(){e.setStyle(this.searchResultsNode,"display","none");this.searchResultsNode.innerHTML="";this.searchResults=null;this.sceneView.popup.close();this._highlightedFeatureHandle&&this._highlightedFeatureHandle.remove()},_onSearchDijitClick:function(){this._resetSelectorPosition(".esri-source-menu")},_resetSelectorPosition:function(a){var c=e.getMarginBox(window.jimuConfig.layoutId);
f(a,this.domNode).forEach(l.hitch(this,function(d){var g=e.position(d),h=l.getObject("viewModel.sources.length",!1,this.searchDijit);if(1<h&&".esri-source-menu"===a){var k=f(a+" li[data-index]",this.domNode)[0],k=b.isDefined(k)?e.getMarginBox(k).h:30;g.h=k*(h+1)}if("none"!==e.getStyle(d,"display")){var h=e.position(this.searchDijit.domNode),k=h.y-2,m=c.h-h.y-h.h;m>g.y+g.h||k>g.h?e.setStyle(d,"top",(m>g.y+g.h?h.h:-g.h-2)+"px"):(e.setStyle(d,"height",Math.max(m,k)+"px"),e.setStyle(d,"top",(m>k?h.h:
-k-2)+"px"))}}))},_onSelectSearchResult:function(a){for(a=a.target;!e.hasAttr(a,"data-source-index")||!e.getAttr(a,"data-index");)a=a.parentNode;var b=null,b=e.getAttr(a,"data-source-index");a=parseInt(e.getAttr(a,"data-index"),10);"all"!==b&&(b=parseInt(b,10));this.searchResults&&this.searchResults[b]&&this.searchResults[b][a]&&(b=this.searchResults[b][a],this.searchDijit.viewModel.select(b))},_hideResultMenu:function(){f(".show-all-results",this.searchResultsNode).style("display","block");f(".searchMenu",
this.searchResultsNode).style("display","none")},_showResultMenu:function(){e.setStyle(this.searchResultsNode,"display","block");f(".show-all-results",this.searchResultsNode).style("display","none");f(".searchMenu",this.searchResultsNode).style("display","block");var a=f(".esri-input-container",this.searchDijit.domNode)[0];if(a){var a=e.getMarginBox(a),b={width:a.w+"px"};if(window.isRTL){var c=e.getMarginBox(this.searchDijit.domNode);b.right=c.w-a.l-a.w+"px"}else b.left=a.l+"px";f(".show-all-results",
this.searchResultsNode).style(b);f(".searchMenu",this.searchResultsNode).style(b)}},_resetSearchDijitStyle:function(){}})});